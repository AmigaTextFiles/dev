@database 089172f8-0
@master Varasto:Lähdekoodit/C/minissc.library/Release/Docs/CodingConventions.guide
@$VER: 1.0
@width 82
@remark Created with Heddley v1.20ß © Edd Dumbill 1994-5

@node "Main" "Coding Conventions"

                    CODING CONVENTIONS FOR MINISSC LIBRARY

             Copyright © 2000 Janne Peräaho. All rights reserved.
 @{u}                                                                             @{uu}

 @{b}Introduction and references@{ub}

 @{" General                  " link "General" 0} General information.
 @{" Glossary                 " link "Glossary" 0} Glossary.
 @{" Definitions              " link "Definitions" 0} C/C++ definitions.
 @{" Functions                " link "Functions" 0} Library functions.

 @{b}Philosophy behind the minissc library@{ub}

 @{" Controllers              " link "Controllers" 0} How minissc sees controllers?
 @{" Servos                   " link "Servos" 0} How minissc sees servos?
 @{" Measurements             " link "Measurements" 0} How servo positions are measured?

 @{b}First steps@{ub}

 @{" Program architecture     " link "Architecture" 0} Overview of your code.
 @{" Opening library          " link "Opening library" 0} How to open minissc library?
 @{" Occupying controller     " link "Occupying controller" 0} How to inform library about controller?
 @{" Occupying servo          " link "Occupying servo" 0} How to inform library about servo?

 @{b}Setting parameters@{ub}

 @{" Configuring controller   " link "Configuring controller" 0} How can controller be configured?
 @{" Configuring servo        " link "Configuring servo" 0} How can servo be configured?

 @{b}It's time for action!@{ub}

 @{" Positioning servo        " link "Positioning servo" 0} How to move servo?
 @{" Inquiring servo position " link "Inquiring servo position" 0} How to find out current servo position?

 @{b}Show is over, folks!@{ub}

 @{" Freeing servo            " link "Freeing servo" 0} How to free occupied servo?
 @{" Freeing controller       " link "Freeing controller" 0} How to free occupied controller?
 @{" Closing library          " link "Closing library" 0} How to close minissc library?

 @{b}How to do it in real life?@{ub}

 @{" Examples                 " link "Examples" 0} Fully working examples.
@endnode

@node "General" "General"

 GENERAL


 The purpose of this document is to illustrate minissc library usage by
 describing the structure of a typical minissc utilizing application and by
 practical examples. It is not intented as a full library documentation but a
 C/C++ programmer's guide to minissc library programming.

 I have divided the document into seven sections as follows:

       Section one: 'Introduction and references'
       Section two: 'Philosophy behind the minissc library'
     Section three: 'First steps'
      Section four: 'Setting parameters'
      Section five: 'It's time for action!'
       Section six: 'Show is over, folks!'
     Section seven: 'How to do it in real life?'

 Section one contains a glossary and autodoc and include file references.
 Section two describes the main library concepts: controller, servo, and those
 concerning position measurement issues. Before you enter into sections 3-6,
 which explain minissc program composing, I recommend reading the second section.
 The last section, section seven, gives real life examples for C/C++ coders. If
 you didn't understand much of my earlier babbling, this should clarify
 everything :-)

 HAPPY CODING!
@endnode

@node "Glossary" "Glossary"
 GLOSSARY


 @{" absolute unit      " link "Glossary" 17}

 @{" communication mode " link "Glossary" 24}
 @{" control mode       " link "Glossary" 32}
 @{" controller         " link "Glossary" 41}

 @{" mini ssc ii        " link "Glossary" 47}
 @{" minissc library    " link "Glossary" 52}
 @{" motion range       " link "Glossary" 59}

 @{" servo              " link "Glossary" 71}


 absolute unit

     Relative measuring unit used by Mini SSC II controller. Absolute unit
     indicates servo position in scale of 0-254. When converted into degrees
     0-254 AUs varies from 0-90° to 0-180°, depending on controller settings.


 communication mode

     Mini SSC II controller has two communication modes: low and high. In low
     mode controller communicates in 2400 baud rate with minissc library, and in
     high mode baud rate is 9600. Controller's jumper B should be on when using
     high communication mode.


 control mode

     Mini SSC II controller has two control modes: narrow and wide. Narrow mode
     limits servo freedom to 90°, while wide mode allows 180° movements. When
     narrow mode is selected (Mini SSC II's jumper R is off), servos can be
     positioned in the accuracy of 0.36°. In wide mode (Mini SSC II's jumper R is
     on) the accuracy is 0.72°.


 controller

     Mini SSC II - electronic module that controls pulse-proportional 'hobby'
     servos according to instructions received serially at 2400 or 9600 baud.


 mini ssc ii

     See controller.


 minissc library

     A shared Amiga library for controlling Mini SSC II compatible controllers.
     Minissc library provides interface between Mini SSC II hardware and Amiga
     applications.


 motion range

     @{u}Controller's motion range@{uu} can be either 90° or 180°. When 90° motion range
     is used, servos connected to controller in question can turn 90° in
     precision of 0.36°. When 180° range is used, servos can turn 180° in
     precision of 0.72°.

     @{u}Servo's motion range@{uu} can vary from 0 to 180°, depending on controller's
     motion range. A servo can have any motion range not exceeding the
     range of the controller that controls it.


 servo

     Servo refers to R/C or 'hobby' servos used in radio-controlled cars, boats
     and planes. These are small, self-contained positioners consisting of a
     motor, geartrain, and control electronics.
@endnode

@node "Definitions" "Definitions"

 DEFINITIONS


 @{b}Library related@{ub}

 SSC_NAME             Library name
 SSC_VERSION          Library version

 @{b}Maximum values@{ub}

 SSC_MAX_SERVOS       Max number of servos per controller
 SSC_MAX_CONTROLLERS  Max number of Mini SSC II Controllers
 SSC_MAX_AVALUE       Max servo position (in absolute units)
 SSC_MAX_VALUE        Max servo position (in degrees)

 @{b}Controller states@{ub}

 SSC_CTRLR_NA         Controller state: not available
 SSC_CTRLR_BUSY       Controller state: busy
 SSC_CTRLR_READY      Controller state: ready
 SSC_CTRLR_LOCKED     Controller state: locked

 @{b}Servo states@{ub}

 SSC_SERVO_NA         Servo state: Not available
 SSC_SERVO_BUSY       Servo state: Busy
 SSC_SERVO_READY      Servo state: ready
 SSC_SERVO_LOCKED     Servo state: locked

 @{b}Communication modes@{ub}

 SSC_COMMMODE_LOW     Comm speed: 2400 baud
 SSC_COMMMODE_HIGH    Comm speed: 9600 baud

 @{b}Controller modes@{ub}

 SSC_CTRLMODE_NARROW  Range of motion (Mini SSC II): 90° in precision of 0.36°
 SSC_CTRLMODE_WIDE    Range of motion (Mini SSC II): 180° in precision of 0.72°
@endnode

@node "Functions" "Functions"

 FUNCTIONS


 @{" ssc_AMove                    " link "/Autodocs/minissc.doc/main" 22}
 @{" ssc_ChangeControllerSettings " link "/Autodocs/minissc.doc/main" 62}
 @{" ssc_ChangeServoSettings      " link "/Autodocs/minissc.doc/main" 103}
 @{" ssc_ControllerRange          " link "/Autodocs/minissc.doc/main" 137}
 @{" ssc_ControllerStatus         " link "/Autodocs/minissc.doc/main" 174}
 @{" ssc_FreeController           " link "/Autodocs/minissc.doc/main" 210}
 @{" ssc_FreeServo                " link "/Autodocs/minissc.doc/main" 240}
 @{" ssc_GetAPosition             " link "/Autodocs/minissc.doc/main" 268}
 @{" ssc_GetPosition              " link "/Autodocs/minissc.doc/main" 297}
 @{" ssc_Move                     " link "/Autodocs/minissc.doc/main" 326}
 @{" ssc_OccupyController         " link "/Autodocs/minissc.doc/main" 366}
 @{" ssc_OccupyServo              " link "/Autodocs/minissc.doc/main" 446}
 @{" ssc_Reset                    " link "/Autodocs/minissc.doc/main" 488}
 @{" ssc_ResetAll                 " link "/Autodocs/minissc.doc/main" 518}
 @{" ssc_ServoRange               " link "/Autodocs/minissc.doc/main" 542}
 @{" ssc_ServoStatus              " link "/Autodocs/minissc.doc/main" 569}
 @{" ssc_SetAPosition             " link "/Autodocs/minissc.doc/main" 603}
 @{" ssc_SetPosition              " link "/Autodocs/minissc.doc/main" 641}
@endnode

@node "Controllers" "Controllers"

 CONTROLLERS


 One Mini SSC II controller can control up to 8 servos. If necessary 32
 controllers can be chained together and gain control over 255 servos in maximum.

 Controllers are numbered from 0 to 31, 0 being the first controller in a chain.
 These numbers act as unique identification numbers from which controllers can be
 recognized.

 Ability to distinguish controllers is important because they may hold different
 (hardware) settings. Eventhough controllers are separated from each other,
 servos are not attached to controllers from minissc library's point of view. You
 refer to servos directly by their ID numbers (0-254) and not by using
 controller-servo-ID pair.

 Before you can change controller @{"settings" link "Configuring controller" 0} or send commands to servos connected
 to it you must reserve it for your use.


 SEE ALSO

 @{" Configuring controller " link "Configuring controller" 0}
 @{" Occupying controller   " link "Occupying controller" 0}
 @{" Servos                 " link "Servos" 0}
 @{" SSC_MAX_CONTROLLERS    " link "Definitions" 13}
 @{" SSC_MAX_SERVOS         " link "Definitions" 12}
@endnode

@node "Servos" "Servos"

 SERVOS


 You can connect eight servos to each Mini SSC II controller. By chaining
 controllers number of controllable servos can be as high as 255.

 Servos are numbered from 0 to 254. These numbers act as unique identification
 numbers from which servos can be recognized. If you want to change servo's
 @{"settings" link "Configuring servo" 0} or want to @{"reposition" link "Positioning servo" 0} it, identification number is required to direct
 changes or positioning commands to the right servo.

 When you are working with servos, you do not need to worry about which
 controller a single servo is connected to. However, controller issue rises up
 when you reserve a servo for your use (this must be done before you can use
 servo). Occupying a servo is a simple and straightforward task, but it can not
 be done before you have reserved a controller which controls the servo in
 question.

 If you have only one Mini SSC II controller, you just occupy the controller
 first and then the desired servos. When you have chained two or more
 controllers, the situation is a bit trickier since you have to know which
 controller each servo is connected to (for example, where the servo number 17 is
 connected to).

 Nevertheless, reserving correct controller is fairly easy, as shown in chapter
 'Occupying controller'.


 SEE ALSO

 @{" Controllers          " link "Controllers" 0}
 @{" Configuring servo    " link "Configuring servo" 0}
 @{" Occupying controller " link "Occupying controller" 0}
 @{" Positioning servo    " link "Positioning servo" 0}
 @{" SSC_MAX_CONTROLLERS  " link "Definitions" 13}
 @{" SSC_MAX_SERVOS       " link "Definitions" 12}
@endnode

@node "Measurements" "Measurements"

 MEASUREMENTS


 A servo position can be expressed in two different ways: by using Mini SSC II's
 absolute units or by using degrees.

 Absolute units (AU) are more accurate but they are also relative, which makes
 them somehow difficult to use. Servo can have positions from 0 to 254 AUs, and,
 depending on controller settings, the maximum value 254 may correspond 90° or
 180°. If you are using AUs, you must know which control mode each controller is
 using in order to position servos correctly.

 Degrees are indenpendent of controller settings (at least from the programmer's
 point of view) and thus easier to use, but they are not as accurate as AUs.
 Steps of 0.36° (narrow control mode) or 0.72° (wide control mode) should in
 theory produce 1 AU precision, but, due to rounding, in practice accuracy is
 closer to something like 0-2 AUs.

 Absolute units are used in positioning and notifying servo position. Degrees are
 used in similar situations and in addition when setting servo's motion range.


 SEE ALSO

 @{" Configuring controller " link "Configuring controller" 0} 
 @{" Configuring servo      " link "Configuring servo" 0}
 @{" Positioning servo      " link "Positioning servo" 0}
 @{" SSC_MAX_AVALUE         " link "Definitions" 14}
 @{" SSC_MAX_VALUE          " link "Definitions" 15}
@endnode

@node "Architecture" "Architecture"

 ARCHITECTURE


 No matter what your superb servo controlling code does, it should always follow
 the following program structure in order to avoid odd behaviour and crashes:

   (1) open the minissc library
   (2) reserve the controllers you need
   (3) reserve servos you need
   (4) place here your code and remember to use only minissc functions to move
       servos

   when exiting

   (5) free reserved servos
   (6) free reserved controllers
   (7) close minissc library

 If you follow this simple structure you should never have any problems with
 the minissc.library.

 WARNING!

 DO NOT TRY TO SEND COMMANDS TO THE SERIAL PORT BY YOURSELF. USE ALWAYS MINISSC
 LIBRARY FUNCTIONS. IT IS VERY LIKELY THAT YOUR COMMANDS MUDDLE UP THE LIBRARY'S
 DATA STRUCTURES AND THUS CAUSE UNPREDICTABLE BEHAVIOUR.
@endnode

@node "Opening library" "Opening library"

 OPENING LIBRARY


 Before you can use minissc library services, i.e. functions, it must be opened
 first. Minissc library is an ordinary shared library so there is no magic in
 here:

   Include first minissc library definitions in your source code

     @{i}#include <minissc.h>@{ui}

   declare library base

     @{i}struct MiniSSCLibrary *MiniSSCBase=NULL;@{ui}

   and then you can open the library

     @{i}MiniSSCBase=(struct MiniSSCLibrary *)OpenLibrary(SSC_NAME,SSC_VERSION);@{ui}


 SEE ALSO

 @{" SSC_NAME    " link "Definitions" 7}
 @{" SSC_VERSION " link "Definitions" 8}
@endnode

@node "Occupying controller" "Occupying controller"

 OCCUPYING CONTROLLER


 Each Mini SSC II can control up to 8 servos. If you want to have access to those
 servos or even to just one of them, you have to occupy the controller
 controlling them. This might be a bit tricky when you are using several Mini SSC
 II controllers, but if there is only one controller, it's a piece of cake.

 Lets take the simple case first when you have only one controller connected to
 your Amiga. You can reserve the controller that uses low communication mode and
 narrow control mode for your use as follows:

   @{i}ssc_OccupyController(0,SSC_COMMMODE_LOW,SSC_CTRLMODE_NARROW);@{ui}

 Then the trickier case where you have 2 Mini SSC II controllers. Let's say you
 want to control only the 16th servo (the last servo which the second controller
 can handle). This servo's ID number is 15 (not 16 because ID numbers start from
 0). We know servo's ID number but not the related controller's ID. Luckily, it
 can be calculated from the servo's ID number quite easily:

   @{i}int controller;

   controller=(int)(15/SSC_MAX_SERVOS);@{ui}

 It gives us 1 which is the correct controller ID. Now we can occupy the
 related controller in the same way as above:

   @{i}ssc_OccupyController(controller,SSC_COMMMODE_LOW,SSC_CTRLMODE_NARROW);@{ui}


 SEE ALSO

 @{" ssc_OccupyController " link "Functions" 15}
 @{" SSC_CTRLMODE_NARROW  " link "Definitions" 38}
 @{" SSC_CTRLMODE_WIDE    " link "Definitions" 39}
 @{" SSC_COMMODE_HIGH     " link "Definitions" 34}
 @{" SSC_COMMODE_LOW      " link "Definitions" 33}
 @{" SSC_MAX_SERVOS       " link "Definitions" 12}
@endnode

@node "Occupying servo" "Occupying servo"

 OCCUPYING SERVO


 Before you can position servo, it must be reserved for use like this:

   @{i}ssc_OccupyServo(0,90);@{ui}

 Line above occupies servo, which id number is 0, for your use with motion range
 of 90°. Notice that you can not occupy a servo if the related controller has not
 been occupied first or the given motion range exceeds controller's motion range.


 SEE ALSO

 @{" Occupying Controller " link "Occupying controller" 0}
 @{" ssc_OccupyServo      " link "Functions" 16}
@endnode

@node "Configuring controller" "Configuring controller"

 CONFIGURING CONTROLLER


 Controller can be configured during occupying or at some later stage.

 You can change controller's communication rate and motion range. Both of these
 two features have two options to choose from. Communication rate can be low or
 high and motion range narrow or wide.

 You can configure occupied controller 0 for high communication mode and wide
 motion range like this:

   @{i}ssc_ChangeControllerSettings(0,SSC_COMMODE_HIGH,SSC_CTRLMODE_WIDE);@{ui}

 Note that by setting one controller's communication mode the change will reflect
 to all controllers. This is because of Mini SSC II hardware limitation. However,
 motion range can vary from one controller to another.


 SEE ALSO

 @{" Occupying Controller         " link "Occupying controller" 0}
 @{" ssc_ChangeControllerSettings " link "Functions" 6}
 @{" SSC_COMMODE_HIGH             " link "Definitions" 34}
 @{" SSC_COMMODE_LOW              " link "Definitions" 33}
 @{" SSC_CTRLMODE_NARROW          " link "Definitions" 38}
 @{" SSC_CTRLMODE_WIDE            " link "Definitions" 39}
@endnode

@node "Configuring servo" "Configuring servo"

 CONFIGURING SERVO


 Servo can be configured during occupying or at some later stage.

 You can, for example, change the motion range of servo 0 to 45° by using
 the following function:

   @{i}ssc_ChangeServoSettings(0,45);@{ui}

 Notice that given motion range may not exceed related controller's motion
 range.


 SEE ALSO

 @{" Occupying servo         " link "Occupying servo" 0}
 @{" ssc_ChangeServoSettings " link "Functions" 7}
@endnode

@node "Positioning servo" "Positioning servo"

 POSITIONING SERVO


 You can move the occupied servo to a precise position or move it in proportion
 to its current position - clockwise or anticlockwise.

   @{i}/* Move servo number 0 to position 254. */
   ssc_SetAPosition(0,254);

   /* Moves servo number 0 in anticlockwise by 2 absolute units. */
   ssc_AMove(0,-2);@{ui}

 If you prefer using degrees instead of absolute units, the corresponding
 functions are:

   @{i}/* Move servo number 0 to position 90°. */
   ssc_SetPosition(0,90);

   /* Moves servo number 0 in anticlockwise by 2 degrees. */
   ssc_Move(0,-2);@{ui}


 SEE ALSO

 @{" Occupying servo  " link "Occupying servo" 0}
 @{" ssc_AMove        " link "Functions" 5}
 @{" ssc_Move         " link "Functions" 14}
 @{" ssc_SetAPosition " link "Functions" 21}
 @{" ssc_SetPosition  " link "Functions" 22}
@endnode

@node "Inquiring servo position" "Inquiring servo position"

 INQUIRING SERVO POSITION


 Minissc library keeps track on servos' positions and you can inquire any servo's
 position at any time. The following example inquires the position of servo
 number 0 in AUs:

     @{i}int position;

     position=ssc_GetAPosition(0);@{ui}

 If you prefer degrees, that is not a problem either:

     @{i}float position;

     position=ssc_GetPosition(0);@{ui}

 NOTE!

 DUE TO MINI SSC II HARDWARE LIMITATIONS, POSITION INFORMATION RETURNED BY THESE
 FUNCTIONS IS BASED ON MINISSC LIBRARY CALCULATIONS AND NOT ON THE ACTUAL SERVOS'
 POSITIONS. IF YOU HAVE OCCUPIED A CONTROLLER(S) AND A SERVO(S) AS DESCRIBED
 EARLIER AND USED ONLY MINISSC LIBRARY'S FUNCTIONS TO MOVE SERVOS, RETURNED
 POSITION INFORMATION IS UP TO DATE AND CORRECT.


 SEE ALSO

 @{" Occupying controller " link "Occupying controller" 0}
 @{" Occupying servo      " link "Occupying servo" 0}
 @{" Positioning servo    " link "Positioning servo" 0}
 @{" ssc_GetAPosition     " link "Functions" 12}
 @{" ssc_GetPosition      " link "Functions" 13}
@endnode

@node "Freeing servo" "Freeing servo"

 FREEING SERVO


 When you stop using minissc library, the first thing you must do is to free all
 occupied servos. The following line frees servo number 0:

     @{i}ssc_FreeServo(0);@{ui}


 SEE ALSO

 @{" Occupying servo " link "Occupying servo" 0}
 @{" ssc_FreeServo   " link "Functions" 11}
@endnode

@node "Freeing controller" "Freeing controller"

 FREEING CONTROLLER


 When you have freed all occupied servos, it is time to free all occupied
 controllers. The following line shows how to free controller number 0:

     @{i}ssc_FreeController(0);@{ui}


 SEE ALSO

 @{" Occupying controller " link "Occupying controller" 0}
 @{" ssc_FreeController   " link "Functions" 10}
@endnode

@node "Closing library" "Closing library"

 CLOSING LIBRARY


 When all occupied servos and controllers have been freed, you can close the
 minissc library:

     @{i}CloseLibrary((struct Library *)MiniSSCBase);@{ui}

 And that is all! You have opened the library, reserved a controller(s), reserved
 a servo(s), moved a servo(s), freed a servo(s), freed a controller(s), and
 finally closed the minissc library according to my advice. Remember this
 algorithm while you write your own minissc applications.

 You are now free to examine closer C example programs included in the next
 section and study other library functions not presented in this guide.


 SEE ALSO

 @{" Opening library           " link "Opening library" 0}
 @{" Examples                  " link "Examples" 0}
 @{" minissc.library functions " link "Functions" 0}
@endnode

@node "Examples" "Examples"

 EXAMPLES


 @{b}HighRateScan@{ub}

     Demonstrates servo control.

     @{" more info   " link "/Examples/HighRateScan/HighRateScan.readme/main" 0}
     @{" source code " link "/Examples/HighRateScan/Source/HighRateScan.c/main" 0}

 @{b}LowRateScan@{ub}

     Demonstrates servo control.

     @{" more info   " link "/Examples/LowRateScan/LowRateScan.readme/main" 0}
     @{" source code " link "/Examples/LowRateScan/Source/LowRateScan.c/main" 0}

 @{b}SetPosition@{ub}

     Commands servo to a new position.

     @{" more info   " link "/Examples/SetPosition/SetPosition.readme/main" 0}
     @{" source code " link "/Examples/SetPosition/Source/SetPosition.c/main" 0}
@endnode

