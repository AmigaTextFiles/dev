/*RX
**
** TTX_AztecError.ttx (C) 1992 by H.P.G
**
** This is a support program for AzecErr
**
** Here are some examples Keyassigns for TTX that should be inserted in the
** Startup.dfn file:
**
** ALT-f ExecArexxString "options results; address AZTECERR FIRST; rs=getenv('AZTECERRLASTLINE');sr=getenv('AZTECERRLASTCOLUMN'); Move FOLDS rs sr"
** ALT-n ExecArexxString "options results; address AZTECERR NEXT ; rs=getenv('AZTECERRLASTLINE');sr=getenv('AZTECERRLASTCOLUMN'); Move FOLDS rs sr"
** ALT-p ExecArexxString "options results; address AZTECERR PREV ; rs=getenv('AZTECERRLASTLINE');sr=getenv('AZTECERRLASTCOLUMN'); Move FOLDS rs sr"
** ALT-l ExecArexxString "options results; address AZTECERR LAST ; rs=getenv('AZTECERRLASTLINE');sr=getenv('AZTECERRLASTCOLUMN'); Move FOLDS rs sr"
** ALT-q ExecArexxString "options results; address AZTECERR QUIT ; rs=getenv('AZTECERRLASTLINE');sr=getenv('AZTECERRLASTCOLUMN'); Move FOLDS rs sr"
**
**/


Options RESULTS

cmd=''

Parse Arg cmd

If cmd =='ERROR' Then Do;
    Address command 'AztecErr 0 AZTECERR SCREEN TURBOTEXT"
    return;

If ~(Show('P','AZTECERR')) Then Do; /* AztecErr is not currently running */
    /* the user wants to dmake */
    df=GetEnv('CCEDIT');
    if df~=='' then do; /* clears out the CCEDIT envvar */
        address command 'Mset *"CCEDIT=*"'
    end;

    address command 'Mset *"CCEDTI="rx *"address TURBOTEXT execarexxcommand TTX_AztecError ERROR*"*"'

    CON="NewShell CON:0/10/1000/65/Compiling.../close/SCREENTURBOTEXT from "
    OPTIONS RESULTS
    GETFILEPATH

    path=RESULT
    ps=lastpos('/',path)
    dir=left(path,ps)

    order="cd" dir

    do while ~EXISTS(dir || "DMakefile")
        ps=lastpos('/',dir,length(dir)-1)
        if ps == 0 then return 5
        dir=left(dir,ps)
        order="cd" dir
    end

    GETFILEINFO

    name="t:" || strip(WORD(RESULT,3),'B','"') || ".tmp"

    if ~open(out,name,'w') then return 10
    Call writeln(out,"stack 10000")
    Call writeln(out,order)             /* cd $dir */
    Call writeln(out,"Dmake")
    Call writeln(out,"C:WaitReturn")
    Call writeln(out,"Endcli >NIL:")
    Call close(out)

    CON=CON || name
    address command CON

End

Address AZTECERR

