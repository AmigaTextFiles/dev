<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<META NAME="Generator" CONTENT="Internet Assistant for Word Version 3.0">
</HEAD>
<BODY>

<FONT SIZE=7><P ALIGN="JUSTIFY">vasm assembler system</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">Volker Barthelmann</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY">  </FONT><FONT SIZE=4>i</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">Table of Contents</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">1 General . .. .. .. .. .. .. ... .. .. .. .. .. .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">1</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">1.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">1</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">1.2 Legal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">1</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">1.3 Installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">1</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2 The Assembler ... .. .. .. .. .. .. .. .. .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">3</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">2.1 General Assembler Options . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">3</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">2.2 Expressions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">4</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">2.3 Include Files . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">5</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">2.4 Macros . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">5</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">2.5 Conditional Assembly . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">5</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">2.6 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">5</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">2.7 Credits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">5</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">2.8 Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">5</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">3 Standard Syntax Module . .. .. .. .. .. .. ... .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">7</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">3.1 Legal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">7</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">3.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">7</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">3.3 General Syntax . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">7</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">3.4 Directives. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">8</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">3.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">12</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">3.6 Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">12</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">4 Mot Syntax Module . .. .. .. .. .. .. .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">15</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">4.1 Legal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">15</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">4.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">15</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">4.3 General Syntax . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">15</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">4.4 Directives. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">16</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">4.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">21</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">4.6 Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">21</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">5 Oldstyle Syntax Module.. .. .. .. .. .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">23</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">5.1 Legal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">23</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">5.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">23</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">5.3 General Syntax . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">23</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">5.4 Directives. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">23</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">5.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">28</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">5.6 Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">29</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>ii</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">6 Simple binary output module. .. .. .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">31</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">6.1 Legal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">31</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">6.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">31</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">6.3 General. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">31</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">6.4 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">31</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">6.5 Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">31</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">7 Test output module. .. .. .. .. .. .. .. .. .. .. ..</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">33</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">7.1 Legal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">33</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">7.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">33</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">7.3 General. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">33</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">7.4 Restrictions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">33</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">7.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">33</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">7.6 Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">33</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">8 ELF output module .. .. .. .. .. .. .. ... .. .. ..</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">35</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">8.1 Legal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">35</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">8.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">35</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">8.3 General. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">35</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">8.4 Restrictions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">35</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">8.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">35</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">8.6 Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">35</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">9 a.out output module .. .. .. .. .. .. .. .. .. .. ..</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">37</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">9.1 Legal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">37</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">9.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">37</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">9.3 General. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">37</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">9.4 Restrictions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">37</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">9.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">37</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">9.6 Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">38</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">10 TOS output module . .. .. .. .. ... .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">39</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">10.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">39</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">10.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">39</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">10.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">39</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">10.4 Restrictions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">39</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">10.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">39</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">10.6 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">39</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">11 vobj output module.. .. .. .. .. .. .. .. .. ... .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">41</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">11.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">41</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">11.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">41</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">11.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">41</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">11.4 Restrictions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">41</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">11.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">41</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">11.6 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">41</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>iii</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">12 Amiga output module.. .. .. .. .. .. .. .. .. ..</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">43</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">12.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">43</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">12.2 Additional options for this version . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">43</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">12.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">43</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">12.4 Restrictions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">43</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">12.5 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">44</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">12.6 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">44</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13 m68k cpu module.. .. ... .. .. .. .. .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">45</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">45</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.2 Additional options for this module . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">45</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.2.1 CPU selections . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">45</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.2.2 Optimization options . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">46</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.2.3 Other options . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">47</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">47</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.4 Extensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">47</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.5 Optimizations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">50</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.6 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">53</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">13.7 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">53</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">14 PowerPC cpu module. .. .. .. .. .. .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">55</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">14.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">55</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">14.2 Additional options for this module . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">55</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">14.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">56</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">14.4 Extensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">56</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">14.5 Optimizations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">56</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">14.6 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">56</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">14.7 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">56</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">15 c16x/st10 cpu module.. .. .. .. .. .. .. .. .. ..</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">59</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">15.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">59</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">15.2 Additional options for this module . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">59</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">15.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">59</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">15.4 Extensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">59</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">15.5 Optimizations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">60</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">15.6 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">60</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">15.7 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">60</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">16 6502 cpu module .. .. .. .. .. .. .. ... .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">61</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">16.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">61</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">16.2 Additional options for this module . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">61</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">16.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">61</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">16.4 Extensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">61</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">16.5 Optimizations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">61</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">16.6 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">62</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">16.7 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">62</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>iv</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">17 ARM cpu module .. .. .. .. .. .. .. .. .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">63</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">17.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">63</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">17.2 Additional options for this module . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">63</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">17.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">64</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">17.4 Extensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">64</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">17.5 Optimizations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">65</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">17.6 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">65</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">17.7 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">65</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">18 80x86 cpu module .. .. .. .. .. .. .. ... .. .. ..</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">67</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">18.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">67</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">18.2 Additional options for this module . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">67</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">18.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">67</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">18.4 Extensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">68</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">18.5 Optimizations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">68</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">18.6 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">68</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">18.7 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">68</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">19 z80 cpu module.. .. .. .. .. .. .. .. ... .. .. .. .</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">71</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">19.1 Legal. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">71</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">19.2 Additional options for this module . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">71</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">19.3 General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">71</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">19.4 Extensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">71</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">19.5 Optimisations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">72</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">19.6 Known Problems . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">72</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">19.7 Error Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">72</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20 Interface .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. ..</P>
</FONT><FONT SIZE=5 COLOR="#0000ff"><P ALIGN="JUSTIFY">73</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">73</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.2 Building vasm . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">73</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.2.1 Directory Structure . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">73</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.2.2 Adapting the Makefile . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">73</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.2.3 Building vasm . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">74</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.3 General data structures . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">75</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.3.1 Source . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">75</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.3.2 Sections . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">76</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.3.3 Symbols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">77</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.3.4 Atoms . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">78</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.3.5 Relocations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">81</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.3.6 Errors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">82</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.4 Syntax modules . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">82</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.4.1 The file ‘syntax.h’ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">82</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.4.2 The file ‘syntax.c’ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">83</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.5 CPU modules . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">84</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.5.1 The file ‘cpu.h’ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">84</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.5.2 The file ‘cpu.c’ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">85</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">20.6 Output modules. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</P>
</FONT><FONT SIZE=4 COLOR="#0000ff"><P ALIGN="JUSTIFY">87</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 1: General</P>
<P ALIGN="JUSTIFY">1</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">1 General</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">1.1 Introduction</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">vasm is a portable and retargetable assembler able to create linkable objects in di erent</P>
<P ALIGN="JUSTIFY">formats as well as absolute code. Di erent CPU-, syntax and output-modules are supported.</P>
<P ALIGN="JUSTIFY">Many common directives/pseudo-opcodes are supported (depending on the syntax module)</P>
<P ALIGN="JUSTIFY">as well as CPU-specific extensions.</P>
<P ALIGN="JUSTIFY">The assembler supports optimizations and relaxations (e.g. choosing the shortest possible</P>
<P ALIGN="JUSTIFY">branch instruction or addressing mode as well as converting a branch to an absolute jump</P>
<P ALIGN="JUSTIFY">if necessary).</P>
<P ALIGN="JUSTIFY">The concept is that you get a special vasm binary for any combination of CPU- and syntax-</P>
<P ALIGN="JUSTIFY">module. All output modules, which make sense for the current CPU, are included in the</P>
<P ALIGN="JUSTIFY">vasm binary and you have to make sure to choose the output file format you need (refer to</P>
<P ALIGN="JUSTIFY">the next chapter for -F option). The default is a test output, only useful for debugging or</P>
<P ALIGN="JUSTIFY">analyzing the output.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">1.2 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">vasm is copyright in 2002-2009 by Volker Barthelmann.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">1.3 Installation</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The vasm binaries do not need additional files, so no further installation is necessary. To use</P>
<P ALIGN="JUSTIFY">vasm with vbcc, copy the binary to ‘vbcc/bin’ after following the installation instructions</P>
<P ALIGN="JUSTIFY">for vbcc.</P>
<P ALIGN="JUSTIFY">The vasm binaries are named vasm&lt;cpu&gt;_&lt;syntax&gt; with &lt;cpu&gt; representing the CPU-</P>
<P ALIGN="JUSTIFY">module and &lt;syntax&gt; the syntax-module, e.g. vasm for PPC with the standard syntax</P>
<P ALIGN="JUSTIFY">module is called vasmppc_std.</P>
<P ALIGN="JUSTIFY">Sometimes the syntax-modifier may be omitted, e.g. vasmppc.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>2</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 2: The Assembler</P>
<P ALIGN="JUSTIFY">3</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">2 The Assembler</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the module-independent part of the assembler. It documents the</P>
<P ALIGN="JUSTIFY">options and extensions which are not specific to a certain target, syntax or output driver.</P>
<P ALIGN="JUSTIFY">Be sure to also read the chapters on the backend, syntax- and output-module you are</P>
<P ALIGN="JUSTIFY">using. They will likely contain important additional information like data-representation</P>
<P ALIGN="JUSTIFY">or additional options.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2.1 General Assembler Options</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">vasm expects the following syntax:</P>
<P ALIGN="JUSTIFY">vasm&lt;target&gt;_&lt;syntax&gt; [options] file</P>
<P ALIGN="JUSTIFY">The following options are supported by the machine independent part of vasm:</P>
<P ALIGN="JUSTIFY">‘-quiet’ Do not print the copyright notice.</P>
<P ALIGN="JUSTIFY">‘-o ofile’ Write the generated assembler output to &lt;ofile&gt; rather than ‘a.out’</P>
<P ALIGN="JUSTIFY">‘-F&lt;fmt&gt;’ Use module &lt;fmt&gt; as output driver. See the chapter on output drivers for</P>
<P ALIGN="JUSTIFY">available formats and options.</P>
<P ALIGN="JUSTIFY">‘-D&lt;name&gt;[=expression]’</P>
<P ALIGN="JUSTIFY">Defines a symbol with the name &lt;name&gt; and assigns the value of the expression</P>
<P ALIGN="JUSTIFY">when given. The assigned value defaults to 1 otherwise.</P>
<P ALIGN="JUSTIFY">‘-I&lt;path&gt;’</P>
<P ALIGN="JUSTIFY">Define another include path. They are searched in the order of occurence on</P>
<P ALIGN="JUSTIFY">the command line.</P>
<P ALIGN="JUSTIFY">‘-w’ Hide all warning messages.</P>
<P ALIGN="JUSTIFY">‘-x’ Show an error message, when referencing an undefined symbol. The default</P>
<P ALIGN="JUSTIFY">behaviour is to declare this symbol as externally defined.</P>
<P ALIGN="JUSTIFY">‘-nosym’ Strips all local symbols from the output file and doesn’t include any other</P>
<P ALIGN="JUSTIFY">symbols than those which are required for external linkage.</P>
<P ALIGN="JUSTIFY">‘-nowarn=&lt;n&gt;’</P>
<P ALIGN="JUSTIFY">Disable warning message &lt;n&gt;. &lt;n&gt; has to be the number of a valid warning</P>
<P ALIGN="JUSTIFY">message, otherwise an error is generated.</P>
<P ALIGN="JUSTIFY">‘-maxerrors=&lt;n&gt;’</P>
<P ALIGN="JUSTIFY">Defines the maximum number of errors to display before assembly is aborted.</P>
<P ALIGN="JUSTIFY">When &lt;n&gt; is 0 then there is no limit.</P>
<P ALIGN="JUSTIFY">‘-unnamed-sections’</P>
<P ALIGN="JUSTIFY">Sections are no longer distinguished by their name, but only by their attributes.</P>
<P ALIGN="JUSTIFY">This has the e ect that when defining a second section with a di erent name</P>
<P ALIGN="JUSTIFY">but same attributes as a first one, it will switch to the first, instead of starting</P>
<P ALIGN="JUSTIFY">a new section.</P>
<P ALIGN="JUSTIFY">‘-ignore-mult-inc’</P>
<P ALIGN="JUSTIFY">When the same file is included multiple times with the same path this is silently</P>
<P ALIGN="JUSTIFY">ignored, causing the file to be processed only once. Note that you can still</P>
<P ALIGN="JUSTIFY">include the same file twice when using di erent paths to access it.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>4</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">‘-nocase’ Disables case-sensitivity for everything - identifiers, directives and instructions.</P>
<P ALIGN="JUSTIFY">‘-noesc’ No escape character sequences. This will make vasm treat the escape character</P>
<P ALIGN="JUSTIFY">\ as any other character. Might be useful for compatibility.</P>
<P ALIGN="JUSTIFY">‘-pic’ Try to generate position independant code. Every relocation is  agged by an</P>
<P ALIGN="JUSTIFY">error message.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2.2 Expressions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Standard expressions are usually evaluated by the main part of vasm rather than by one of</P>
<P ALIGN="JUSTIFY">the modules (unless this is necessary).</P>
<P ALIGN="JUSTIFY">All expressions evaluated by the frontend are calculated in terms of target address values,</P>
<P ALIGN="JUSTIFY">i.e. the range depends on the backend.</P>
<P ALIGN="JUSTIFY">The operators available are similar to the ones available in C expressions and have the same</P>
<P ALIGN="JUSTIFY">precedence and associativity as in the C language. All the standard arithmetic (+,-,*,/,%),</P>
<P ALIGN="JUSTIFY">bitwise (&amp;,|,^), logical (&amp;&amp;,|| and conditional operators (?:,!,&lt;,&gt;,&lt;=,&gt;=,==,!=) are</P>
<P ALIGN="JUSTIFY">allowed. For compatibility also // is allowed to represent a modulo operation.</P>
<P ALIGN="JUSTIFY">Operands are integral values of the target address type. They can either be specified as</P>
<P ALIGN="JUSTIFY">integer constants of di erent bases (see the documentation on the syntax module to see how</P>
<P ALIGN="JUSTIFY">the base is specified) or character constants. Character constants are introduced by ’ or "</P>
<P ALIGN="JUSTIFY">and have to be terminated by the same character that started them.</P>
<P ALIGN="JUSTIFY">Multiple characters are allowed and a constant is built according to the endianess of the</P>
<P ALIGN="JUSTIFY">target.</P>
<P ALIGN="JUSTIFY">Inside character contants, the following escape sequences are allowed (unless ‘-noesc’ was</P>
<P ALIGN="JUSTIFY">specified):</P>
<P ALIGN="JUSTIFY">\\ Produces a single \.</P>
<P ALIGN="JUSTIFY">\b The bell character.</P>
<P ALIGN="JUSTIFY">\f Form feed.</P>
<P ALIGN="JUSTIFY">\n Line feed.</P>
<P ALIGN="JUSTIFY">\r Carriage return.</P>
<P ALIGN="JUSTIFY">\t Tabulator.</P>
<P ALIGN="JUSTIFY">\" Produces a single ".</P>
<P ALIGN="JUSTIFY">\’ Produces a single ’.</P>
<P ALIGN="JUSTIFY">\e Escape character (27).</P>
<P ALIGN="JUSTIFY">\&lt;octal-digits&gt;</P>
<P ALIGN="JUSTIFY">One character with the code specified by the digits as octal value.</P>
<P ALIGN="JUSTIFY">\x&lt;hexadecimal-digits&gt;</P>
<P ALIGN="JUSTIFY">One character with the code specified by the digits as hexadecimal value.</P>
<P ALIGN="JUSTIFY">\X&lt;hexadecimal-digits&gt;</P>
<P ALIGN="JUSTIFY">Same as \x.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 2: The Assembler</P>
<P ALIGN="JUSTIFY">5</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2.3 Include Files</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">vasm supports include files and defining include paths. Whether this functionality is avail-</P>
<P ALIGN="JUSTIFY">able depends on the syntax module, which has to provide the appropriate directives.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2.4 Macros</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Macros are supported by vasm, but the directives for defining them have to be implemented</P>
<P ALIGN="JUSTIFY">in the syntax module. In any case the assembler core allows up to 9 macro parameters to</P>
<P ALIGN="JUSTIFY">be passed in the operand field. They can be referenced inside the macro by \1 to \9.</P>
<P ALIGN="JUSTIFY">Additionally there is a special argument \0 which is set to the first qualifier (mnemonic</P>
<P ALIGN="JUSTIFY">extension) of the macro invocation when given.</P>
<P ALIGN="JUSTIFY">\@ inserts a unique id of the form _nnnnnn (where ’n’ is a digit between 0 and 9) per macro</P>
<P ALIGN="JUSTIFY">invocation. Useful for defining reusable labels in a macro.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2.5 Conditional Assembly</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Has to be provided completely by the syntax module.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2.6 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known module-independent problems of vasm at the moment:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2.7 Credits</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">All those who wrote parts of the vasm distribution, made suggestions, answered my ques-</P>
<P ALIGN="JUSTIFY">tions, tested vasm, reported errors or were otherwise involved in the development of vasm</P>
<P ALIGN="JUSTIFY">(in descending alphabetical order, under work, not complete):</P>
<P ALIGN="JUSTIFY">• Frank Wille</P>
<P ALIGN="JUSTIFY">• Sebastian Pachuta</P>
<P ALIGN="JUSTIFY">• Gunther Nikl</P>
<P ALIGN="JUSTIFY">• Timm S. Mueller</P>
<P ALIGN="JUSTIFY">• Gareth Morris</P>
<P ALIGN="JUSTIFY">• J¨</P>
<P ALIGN="JUSTIFY">org van de Loo</P>
<P ALIGN="JUSTIFY">• Miro Kropacek</P>
<P ALIGN="JUSTIFY">• Mikael Kalms</P>
<P ALIGN="JUSTIFY">• Tom Duin</P>
<P ALIGN="JUSTIFY">• Karoly Balogh</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">2.8 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The frontend has the following error messages:</P>
<P ALIGN="JUSTIFY">- 1: illegal operand types</P>
<P ALIGN="JUSTIFY">- 2: unknown mnemonic &lt;%s&gt;</P>
<P ALIGN="JUSTIFY">- 3: unknown section &lt;%s&gt;</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>6</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">- 4: no current section specified</P>
<P ALIGN="JUSTIFY">- 5: internal error %d in line %d of %s</P>
<P ALIGN="JUSTIFY">- 6: symbol &lt;%s&gt; redefined</P>
<P ALIGN="JUSTIFY">- 7: %c expected</P>
<P ALIGN="JUSTIFY">- 9: division by zero</P>
<P ALIGN="JUSTIFY">- 10: number or identifier expected</P>
<P ALIGN="JUSTIFY">- 11: could not initialize %s module</P>
<P ALIGN="JUSTIFY">- 12: multiple input files</P>
<P ALIGN="JUSTIFY">- 13: could not open &lt;%s&gt; for input</P>
<P ALIGN="JUSTIFY">- 14: could not open &lt;%s&gt; for output</P>
<P ALIGN="JUSTIFY">- 15: unknown option &lt;%s&gt;</P>
<P ALIGN="JUSTIFY">- 16: no input file specified</P>
<P ALIGN="JUSTIFY">- 17: could not initialize output module &lt;%s&gt;</P>
<P ALIGN="JUSTIFY">- 18: out of memory</P>
<P ALIGN="JUSTIFY">- 19: symbol &lt;%s&gt; recursively defined</P>
<P ALIGN="JUSTIFY">- 22: character constant too long</P>
<P ALIGN="JUSTIFY">- 23: undefined local symbol</P>
<P ALIGN="JUSTIFY">- 24: trailing garbage after option -%c</P>
<P ALIGN="JUSTIFY">- 25: undefined macro parameter ’\%d’</P>
<P ALIGN="JUSTIFY">- 26: missing %s directive for macro "%s"</P>
<P ALIGN="JUSTIFY">- 27: macro definition inside macro "%s"</P>
<P ALIGN="JUSTIFY">- 28: maximum number of %d macro arguments exceeded</P>
<P ALIGN="JUSTIFY">- 29: option -%c was specified twice</P>
<P ALIGN="JUSTIFY">- 30: read error on &lt;%s&gt;</P>
<P ALIGN="JUSTIFY">- 31: expression must be constant</P>
<P ALIGN="JUSTIFY">- 32: initialized data in bss</P>
<P ALIGN="JUSTIFY">- 33: missing %s directive in repeat-block</P>
<P ALIGN="JUSTIFY">- 34: #%d is not a valid warning message</P>
<P ALIGN="JUSTIFY">- 35: relocation not allowed</P>
<P ALIGN="JUSTIFY">- 36: illegal escape sequence \%c</P>
<P ALIGN="JUSTIFY">- 37: no current macro to exit</P>
<P ALIGN="JUSTIFY">- 38: fail: %s</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 3: Standard Syntax Module</P>
<P ALIGN="JUSTIFY">7</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">3 Standard Syntax Module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the standard syntax module which is available with the extension</P>
<P ALIGN="JUSTIFY">std.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">3.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002-2008 by Volker Barthelmann.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">3.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This syntax module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-ac’ Immediately allocate common symbols in .bss/.sbss section and define them as</P>
<P ALIGN="JUSTIFY">externally visible.</P>
<P ALIGN="JUSTIFY">‘-nodotneeded’</P>
<P ALIGN="JUSTIFY">Recognize assembly directives without a leading dot (.).</P>
<P ALIGN="JUSTIFY">‘-sdlimit=&lt;n&gt;’</P>
<P ALIGN="JUSTIFY">Put data up to a maximum size of n bytes into the small-data sections. Default</P>
<P ALIGN="JUSTIFY">is n=0, which means the function is disabled.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">3.3 General Syntax</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Labels have to be terminated with a colon (:). Local labels are preceded by ’.’ and have</P>
<P ALIGN="JUSTIFY">to contain digits only. Local labels are valid between two global label definitions.</P>
<P ALIGN="JUSTIFY">Make sure that you don’t define a label on the same line as a directive for conditional</P>
<P ALIGN="JUSTIFY">assembly (if, else, endif)! This is not supported.</P>
<P ALIGN="JUSTIFY">The operands are separated from the mnemonic by whitespace. Multiple operands are</P>
<P ALIGN="JUSTIFY">separated by comma (,).</P>
<P ALIGN="JUSTIFY">Comments are introduced by the comment character #. The rest of the line will be ignored.</P>
<P ALIGN="JUSTIFY">For the c16x, m68k, 650x and ARM backends, the comment character is ; instead of #.</P>
<P ALIGN="JUSTIFY">Example:</P>
<P ALIGN="JUSTIFY">mylabel: inst.q1.q2 op1,op2,op3 # comment</P>
<P ALIGN="JUSTIFY">In expressions, numbers starting with 0x or 0X are hexadecimal (e.g. 0xfb2c). 0b or 0B</P>
<P ALIGN="JUSTIFY">introduces binary numbers (e.g. 0b1100101). Other numbers starting with 0 are assumed</P>
<P ALIGN="JUSTIFY">to be octal numbers, e.g. 0237. All numbers starting with a non-zero digit are decimal, e.g.</P>
<P ALIGN="JUSTIFY">1239.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>8</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">3.4 Directives</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The following directives are supported by this syntax module (if the CPU- and output-</P>
<P ALIGN="JUSTIFY">module allow it):</P>
<P ALIGN="JUSTIFY">.2byte &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">See .uahalf.</P>
<P ALIGN="JUSTIFY">.4byte &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">See .uaword.</P>
<P ALIGN="JUSTIFY">.8byte &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">See .uaquad.</P>
<P ALIGN="JUSTIFY">.ascii &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">See .byte.</P>
<P ALIGN="JUSTIFY">.asciiz "&lt;string1&gt;"[,"&lt;string2&gt;"...]</P>
<P ALIGN="JUSTIFY">See .string.</P>
<P ALIGN="JUSTIFY">.align &lt;bit_count&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert as much fill bytes as required to reach an address where &lt;bit count&gt; low</P>
<P ALIGN="JUSTIFY">order bits are zero. For example .align 2 would make an alignment to the</P>
<P ALIGN="JUSTIFY">next 32-bit boundary. Note that this directive</P>
<P ALIGN="JUSTIFY">.balign &lt;byte_count&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert as much fill bytes as required to reach an address which is dividable by</P>
<P ALIGN="JUSTIFY">&lt;byte count&gt;. For example .balign 2 would make an alignment to the next</P>
<P ALIGN="JUSTIFY">16-bit boundary.</P>
<P ALIGN="JUSTIFY">.bss Equivalent to .section .bss,"aurw4".</P>
<P ALIGN="JUSTIFY">.byte &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">Assign the integer or string constant operands into successive bytes of memory</P>
<P ALIGN="JUSTIFY">in the current section. Any combination of integer and character string constant</P>
<P ALIGN="JUSTIFY">operands is permitted.</P>
<P ALIGN="JUSTIFY">.comm &lt;symbol&gt;,&lt;size&gt;[,&lt;align&gt;]</P>
<P ALIGN="JUSTIFY">Defines a common symbol which has a size of &lt;size&gt; bytes. The final size</P>
<P ALIGN="JUSTIFY">and alignment will be assigned by the linker, which will use the highes size and</P>
<P ALIGN="JUSTIFY">alignment values of all common symbols with the same name found. A common</P>
<P ALIGN="JUSTIFY">symbol is allocated in the .bss section in the final executable. ".comm"-areas</P>
<P ALIGN="JUSTIFY">of less than 8 bytes in size are aligned to word boundaries, other- wise to</P>
<P ALIGN="JUSTIFY">doubleword boundaries.</P>
<P ALIGN="JUSTIFY">.data Equivalent to .section .data,"adrw4".</P>
<P ALIGN="JUSTIFY">.endm Ends a macro definition.</P>
<P ALIGN="JUSTIFY">.endr Ends a repetition block.</P>
<P ALIGN="JUSTIFY">.equ &lt;symbol&gt;,&lt;expression&gt;</P>
<P ALIGN="JUSTIFY">See .set.</P>
<P ALIGN="JUSTIFY">.extern &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">See .global.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 3: Standard Syntax Module</P>
<P ALIGN="JUSTIFY">9</P>
<P ALIGN="JUSTIFY">.file "string"</P>
<P ALIGN="JUSTIFY">Set the filename of the input source. This may be used by some output modules.</P>
<P ALIGN="JUSTIFY">By default, the input filename passed on the command line is used.</P>
<P ALIGN="JUSTIFY">.global &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as an external symbol, which means that &lt;symbol&gt; is visible to</P>
<P ALIGN="JUSTIFY">all modules in the linking process. It may be either defined or undefined.</P>
<P ALIGN="JUSTIFY">.globl &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">See .global.</P>
<P ALIGN="JUSTIFY">.half &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">If the current section location counter is not on a halfword boundary, advance</P>
<P ALIGN="JUSTIFY">it to the next halfword boundary. Then, assign the values of the operands into</P>
<P ALIGN="JUSTIFY">successive halfwords of memory in the current section.</P>
<P ALIGN="JUSTIFY">.if &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is non-zero.</P>
<P ALIGN="JUSTIFY">.ifeq &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is zero.</P>
<P ALIGN="JUSTIFY">.ifne &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is non-zero.</P>
<P ALIGN="JUSTIFY">.ifgt &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is greater than zero.</P>
<P ALIGN="JUSTIFY">.ifge &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is greater than zero</P>
<P ALIGN="JUSTIFY">or equal.</P>
<P ALIGN="JUSTIFY">.iflt &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is less than zero.</P>
<P ALIGN="JUSTIFY">.ifle &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is less than zero or</P>
<P ALIGN="JUSTIFY">equal.</P>
<P ALIGN="JUSTIFY">.ifdef &lt;symbol&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;symbol&gt; is defined.</P>
<P ALIGN="JUSTIFY">.ifndef &lt;symbol&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;symbol&gt; is undefined.</P>
<P ALIGN="JUSTIFY">.incbin &lt;file&gt;</P>
<P ALIGN="JUSTIFY">Inserts the binary contents of &lt;file&gt; into the object code at this position. The</P>
<P ALIGN="JUSTIFY">file will be searched first in the current directory, then in all paths defined by</P>
<P ALIGN="JUSTIFY">‘-I’ or .incdir in the order of occurence.</P>
<P ALIGN="JUSTIFY">.incdir &lt;path&gt;</P>
<P ALIGN="JUSTIFY">Add another path to search for include files to the list of known paths. Paths</P>
<P ALIGN="JUSTIFY">defined with ‘-I’ on the command line are searched first.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>10</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">.include &lt;file&gt;</P>
<P ALIGN="JUSTIFY">Include source text of &lt;file&gt; at this position. The include file will be searched</P>
<P ALIGN="JUSTIFY">first in the current directory, then in all paths defined by ‘-I’ or .incdir in the</P>
<P ALIGN="JUSTIFY">order of occurence.</P>
<P ALIGN="JUSTIFY">.int &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">See .word.</P>
<P ALIGN="JUSTIFY">.lcomm &lt;symbol&gt;,&lt;size&gt;[,&lt;alignment&gt;]</P>
<P ALIGN="JUSTIFY">Allocate &lt;size&gt; bytes of space in the .bss section and assign the value to that</P>
<P ALIGN="JUSTIFY">location to &lt;symbol&gt;. If &lt;alignment&gt; is given, then the space will be aligned</P>
<P ALIGN="JUSTIFY">to an address having &lt;alignment&gt; low zero bits or 2, whichever is greater.</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; may be made globally visible by the .globl directive.</P>
<P ALIGN="JUSTIFY">.local &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as a local symbol, which means that &lt;symbol&gt; is local for the</P>
<P ALIGN="JUSTIFY">current file and invisible to other modules in the linking process.</P>
<P ALIGN="JUSTIFY">.long &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">See .word.</P>
<P ALIGN="JUSTIFY">.macro &lt;name&gt;</P>
<P ALIGN="JUSTIFY">Defines a macro which can be referenced by &lt;name&gt;. The macro definition is</P>
<P ALIGN="JUSTIFY">closed by an .endm directive. When calling a macro you may pass up to 9</P>
<P ALIGN="JUSTIFY">arguments, separated by comma. Those arguments are referenced within the</P>
<P ALIGN="JUSTIFY">macro context as \1 to \9. Argument \0 is set to the macro’s first qualifier</P>
<P ALIGN="JUSTIFY">(mnemonic extension), when given. The special argument \@ inserts a unique</P>
<P ALIGN="JUSTIFY">id, useful for defining labels.</P>
<P ALIGN="JUSTIFY">.quad &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">If the current section location counter is not on a quadword boundary, advance</P>
<P ALIGN="JUSTIFY">it to the next quadword boundary. Then, assign the values of the operands into</P>
<P ALIGN="JUSTIFY">successive quadwords of memory in the current section.</P>
<P ALIGN="JUSTIFY">.rept &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Repeats the assembly of the block between .rept and .endr &lt;expression&gt; num-</P>
<P ALIGN="JUSTIFY">ber of times. &lt;expression&gt; has to be positive.</P>
<P ALIGN="JUSTIFY">.section &lt;name&gt;[,"&lt;attributes&gt;"]</P>
<P ALIGN="JUSTIFY">Starts a new section named &lt;name&gt; or reactivate an old one. If attributes are</P>
<P ALIGN="JUSTIFY">given for an already existing section, they must match exactly. The section’s</P>
<P ALIGN="JUSTIFY">name will also be defined as a new symbol, which represents the section’s start</P>
<P ALIGN="JUSTIFY">address. The "&lt;attributes&gt;" string may consist of the following characters:</P>
<P ALIGN="JUSTIFY">Section Contents:</P>
<P ALIGN="JUSTIFY">c section has code</P>
<P ALIGN="JUSTIFY">d section has initialized data</P>
<P ALIGN="JUSTIFY">u section has uninitialized data</P>
<P ALIGN="JUSTIFY">i section has directives (info section)</P>
<P ALIGN="JUSTIFY">n section can be discarded</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 3: Standard Syntax Module</P>
<P ALIGN="JUSTIFY">11</P>
<P ALIGN="JUSTIFY">R remove section at link time</P>
<P ALIGN="JUSTIFY">a section is allocated in memory</P>
<P ALIGN="JUSTIFY">Section Protection:</P>
<P ALIGN="JUSTIFY">r section is readable</P>
<P ALIGN="JUSTIFY">w section is writable</P>
<P ALIGN="JUSTIFY">x section is executable</P>
<P ALIGN="JUSTIFY">s section is sharable</P>
<P ALIGN="JUSTIFY">Section Alignment (only one):</P>
<P ALIGN="JUSTIFY">0 align to byte boundary</P>
<P ALIGN="JUSTIFY">1 align to halfword boundary</P>
<P ALIGN="JUSTIFY">2 align to word boundary</P>
<P ALIGN="JUSTIFY">3 align to doubleword boundary</P>
<P ALIGN="JUSTIFY">4 align to quadword boundary</P>
<P ALIGN="JUSTIFY">5 align to 32 byte boundary</P>
<P ALIGN="JUSTIFY">6 align to 64 byte boundary</P>
<P ALIGN="JUSTIFY">Memory  ags:</P>
<P ALIGN="JUSTIFY">C load section to Chip RAM</P>
<P ALIGN="JUSTIFY">F load section to Fast RAM</P>
<P ALIGN="JUSTIFY">.set &lt;symbol&gt;,&lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Create a new program symbol with the name &lt;symbol&gt; and assign to it the</P>
<P ALIGN="JUSTIFY">value of &lt;expression&gt;. If &lt;symbol&gt; is already assigned, it will contain a new</P>
<P ALIGN="JUSTIFY">value from now on.</P>
<P ALIGN="JUSTIFY">.size &lt;symbol&gt;,&lt;size&gt;</P>
<P ALIGN="JUSTIFY">Set the size in bytes of an object defined at &lt;symbol&gt;.</P>
<P ALIGN="JUSTIFY">.short &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">See .half.</P>
<P ALIGN="JUSTIFY">.space &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">See .space.</P>
<P ALIGN="JUSTIFY">.space &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; bytes into the current section.</P>
<P ALIGN="JUSTIFY">.stabs "&lt;name&gt;",&lt;type&gt;,&lt;other&gt;,&lt;desc&gt;,&lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Add an stab-entry for debugging, including a symbol-string and an expression.</P>
<P ALIGN="JUSTIFY">.stabn &lt;type&gt;,&lt;other&gt;,&lt;desc&gt;,&lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Add an stab-entry for debugging, without a symbol-string.</P>
<P ALIGN="JUSTIFY">.stabd &lt;type&gt;,&lt;other&gt;,&lt;desc&gt;</P>
<P ALIGN="JUSTIFY">Add an stab-entry for debugging, without symbol-string and value.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>12</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">.string "&lt;string1&gt;"[,"&lt;string2&gt;"...]</P>
<P ALIGN="JUSTIFY">Like .byte, but adds a terminating zero-byte.</P>
<P ALIGN="JUSTIFY">.text Equivalent to .section .text,"acrx4".</P>
<P ALIGN="JUSTIFY">.type &lt;symbol&gt;,&lt;type&gt;</P>
<P ALIGN="JUSTIFY">Set type of symbol called &lt;symbol&gt; to &lt;type&gt;, which must be one of:</P>
<P ALIGN="JUSTIFY">1: Object</P>
<P ALIGN="JUSTIFY">2: Function</P>
<P ALIGN="JUSTIFY">3: Section</P>
<P ALIGN="JUSTIFY">4: File</P>
<P ALIGN="JUSTIFY">The predefined symbols @object and @function are available for this purpose.</P>
<P ALIGN="JUSTIFY">.uahalf &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive two-byte areas of memory in</P>
<P ALIGN="JUSTIFY">the current section regardless of section alignment.</P>
<P ALIGN="JUSTIFY">.ualong &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">See .uaword.</P>
<P ALIGN="JUSTIFY">.uaquad &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive eight-byte areas of memory in</P>
<P ALIGN="JUSTIFY">the current section regardless of section alignment.</P>
<P ALIGN="JUSTIFY">.uashort &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">See .uahalf.</P>
<P ALIGN="JUSTIFY">.uaword &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive four-byte areas of memory in</P>
<P ALIGN="JUSTIFY">the current section regardless of section alignment.</P>
<P ALIGN="JUSTIFY">.weak &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as a weak symbol, which means that &lt;symbol&gt; is visible to all</P>
<P ALIGN="JUSTIFY">modules in the linking process and may be replaced by any global symbol with</P>
<P ALIGN="JUSTIFY">the same name. When a weak symbol remains undefined its value defaults to</P>
<P ALIGN="JUSTIFY">0.</P>
<P ALIGN="JUSTIFY">.word &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">If the current section location counter is not on a word boundary advance it to</P>
<P ALIGN="JUSTIFY">the next word boundary. Then assign the values of the operands into successive</P>
<P ALIGN="JUSTIFY">words of memory in the current section.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">3.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">3.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 1001: mnemonic expected</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 3: Standard Syntax Module</P>
<P ALIGN="JUSTIFY">13</P>
<P ALIGN="JUSTIFY">- 1002: invalid extension</P>
<P ALIGN="JUSTIFY">- 1003: no space before operands</P>
<P ALIGN="JUSTIFY">- 1004: too many closing parentheses</P>
<P ALIGN="JUSTIFY">- 1005: missing closing parentheses</P>
<P ALIGN="JUSTIFY">- 1006: missing operand</P>
<P ALIGN="JUSTIFY">- 1007: scratch at end of line</P>
<P ALIGN="JUSTIFY">- 1008: \" expected</P>
<P ALIGN="JUSTIFY">- 1009: invalid data operand</P>
<P ALIGN="JUSTIFY">- 1010: , expected</P>
<P ALIGN="JUSTIFY">- 1011: identifier expected</P>
<P ALIGN="JUSTIFY">- 1012: illegal escape sequence \\%c</P>
<P ALIGN="JUSTIFY">- 1013: expression must be constant</P>
<P ALIGN="JUSTIFY">- 1014: unexpected endm without macro</P>
<P ALIGN="JUSTIFY">- 1015: endif without if</P>
<P ALIGN="JUSTIFY">- 1016: if without endif</P>
<P ALIGN="JUSTIFY">- 1017: maximum if-nesting depth exceeded (%d levels)</P>
<P ALIGN="JUSTIFY">- 1018: else without if</P>
<P ALIGN="JUSTIFY">- 1019: syntax error</P>
<P ALIGN="JUSTIFY">- 1020: unexpected endr without rept</P>
<P ALIGN="JUSTIFY">- 1021: symbol &lt;%s&gt; already defined with %s scope</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>14</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 4: Mot Syntax Module</P>
<P ALIGN="JUSTIFY">15</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">4 Mot Syntax Module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the Motorola syntax module, mostly used for the M68k family of</P>
<P ALIGN="JUSTIFY">CPUs, which is available with the extension mot.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">4.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002-2009 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">4.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This syntax module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-align’ Enables 16-bit alignment for constant declaration (dc.?, except dc.b) direc-</P>
<P ALIGN="JUSTIFY">tives.</P>
<P ALIGN="JUSTIFY">‘-devpac’ Devpac-compatibility mode. Enables 16-bit alignment for constant declaration</P>
<P ALIGN="JUSTIFY">(dc.?, except dc.b) directives.</P>
<P ALIGN="JUSTIFY">‘-phxass’ PhxAss-compatibilty mode. Enables the following features:</P>
<P ALIGN="JUSTIFY">-section &lt;name&gt; starts a code section named &lt;name&gt;</P>
<P ALIGN="JUSTIFY">instead of a section with also has the type &lt;name&gt;.</P>
<P ALIGN="JUSTIFY">-Defines the symbol _PHXASS_.</P>
<P ALIGN="JUSTIFY">‘-spaces’ Allow blanks in operands.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">4.3 General Syntax</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Labels always start at the first column and may be terminated by a colon (:), but don’t</P>
<P ALIGN="JUSTIFY">need to. In the last case the mnemonic needs to be separated from the label by whitespace</P>
<P ALIGN="JUSTIFY">(not required in any case, e.g. =). Qualifiers are appended to the mnemonic separated</P>
<P ALIGN="JUSTIFY">by a dot (if the CPU-module supports qualifiers). The operands are separated from the</P>
<P ALIGN="JUSTIFY">mnemonic by whitespace. Multiple operands are separated by comma (,).</P>
<P ALIGN="JUSTIFY">Local labels are preceded by ’.’ or terminated by ’$’. For the rest, any alphanumeric</P>
<P ALIGN="JUSTIFY">character including ’_’ is allowed. Local labels are valid between two global label definitions.</P>
<P ALIGN="JUSTIFY">Make sure that you don’t define a label on the same line as a directive for conditional</P>
<P ALIGN="JUSTIFY">assembly (if, else, endif)! This is not supported.</P>
<P ALIGN="JUSTIFY">In this syntax module, the operand field must not contain any whitespace characters!</P>
<P ALIGN="JUSTIFY">Comments are introduced by the comment character ; or *. The rest of the line will be</P>
<P ALIGN="JUSTIFY">ignored. Also everything following the operand field, separated by a whitespace, will be</P>
<P ALIGN="JUSTIFY">regarded as comment. Be careful with * which is recognized as the "current pc symbol" in</P>
<P ALIGN="JUSTIFY">any operand expression</P>
<P ALIGN="JUSTIFY">Example:</P>
<P ALIGN="JUSTIFY">mylabel inst.q op1,op2,op3 ;comment</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>16</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">In expressions, numbers starting with $ are hexadecimal (e.g. $fb2c). % introduces binary</P>
<P ALIGN="JUSTIFY">numbers (e.g. %1100101). Numbers starting with @ are assumed to be octal numbers, e.g.</P>
<P ALIGN="JUSTIFY">@237. All numbers starting with a digit are decimal, e.g. 1239.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">4.4 Directives</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The following directives are supported by this syntax module (if the CPU- and output-</P>
<P ALIGN="JUSTIFY">module allow it):</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; = &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to &lt;symbol&gt; equ &lt;expression&gt;.</P>
<P ALIGN="JUSTIFY">align &lt;bitcount&gt;</P>
<P ALIGN="JUSTIFY">Insert as much zero bytes as required to reach an address where &lt;bit count&gt;</P>
<P ALIGN="JUSTIFY">low order bits are zero. For example align 2 would make an alignment to the</P>
<P ALIGN="JUSTIFY">next 32-bit boundary. Equivalent to cnop 0,1&lt;&lt;bitcount.</P>
<P ALIGN="JUSTIFY">blk.b &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.b &lt;exp&gt;,&lt;fill&gt;.</P>
<P ALIGN="JUSTIFY">blk.d &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.d &lt;exp&gt;,&lt;fill&gt;.</P>
<P ALIGN="JUSTIFY">blk.l &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.l &lt;exp&gt;,&lt;fill&gt;.</P>
<P ALIGN="JUSTIFY">blk.q &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.q &lt;exp&gt;,&lt;fill&gt;.</P>
<P ALIGN="JUSTIFY">blk.s &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.s &lt;exp&gt;,&lt;fill&gt;.</P>
<P ALIGN="JUSTIFY">blk.w &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.w &lt;exp&gt;,&lt;fill&gt;.</P>
<P ALIGN="JUSTIFY">blk.x &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.x &lt;exp&gt;,&lt;fill&gt;.</P>
<P ALIGN="JUSTIFY">bss Equivalent to section bss,bss.</P>
<P ALIGN="JUSTIFY">clrfo Reset stack-frame o set counter to zero. See fo directive.</P>
<P ALIGN="JUSTIFY">clrso Reset structure o set counter to zero. See so directive.</P>
<P ALIGN="JUSTIFY">cnop &lt;offset&gt;,&lt;alignment&gt;</P>
<P ALIGN="JUSTIFY">Insert as much zero bytes as required to reach an address which can be divided</P>
<P ALIGN="JUSTIFY">by &lt;alignment&gt;. Then add &lt;o set&gt; zero bytes.</P>
<P ALIGN="JUSTIFY">code Equivalent to section code,code.</P>
<P ALIGN="JUSTIFY">comment Everything in the operand field is ignored and seen as a comment. There is only</P>
<P ALIGN="JUSTIFY">one exception when the operand contains HEAD=. Then the following expression</P>
<P ALIGN="JUSTIFY">is passed to the TOS output module via the symbol ’ TOSFLAGS’, to define the</P>
<P ALIGN="JUSTIFY">Atari specific TOS  ags.</P>
<P ALIGN="JUSTIFY">cseg Equivalent to section code,code.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 4: Mot Syntax Module</P>
<P ALIGN="JUSTIFY">17</P>
<P ALIGN="JUSTIFY">data Equivalent to section data,data.</P>
<P ALIGN="JUSTIFY">dc.b &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;",’&lt;string2&gt;’...]</P>
<P ALIGN="JUSTIFY">Assign the integer or string constant operands into successive bytes of memory</P>
<P ALIGN="JUSTIFY">in the current section. Any combination of integer and character string constant</P>
<P ALIGN="JUSTIFY">operands is permitted.</P>
<P ALIGN="JUSTIFY">dc.d &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 64-bit words of memory in</P>
<P ALIGN="JUSTIFY">the current section. Also IEEE double precision  oating point constants are</P>
<P ALIGN="JUSTIFY">allowed.</P>
<P ALIGN="JUSTIFY">dc.l &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 32-bit words of memory in the</P>
<P ALIGN="JUSTIFY">current section.</P>
<P ALIGN="JUSTIFY">dc.q &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 32-bit words of memory in the</P>
<P ALIGN="JUSTIFY">current section.</P>
<P ALIGN="JUSTIFY">dc.s &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 64-bit words of memory in the</P>
<P ALIGN="JUSTIFY">current section. Also IEEE single precision  oating point constants are allowed.</P>
<P ALIGN="JUSTIFY">dc.w &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 16-bit words of memory in the</P>
<P ALIGN="JUSTIFY">current section.</P>
<P ALIGN="JUSTIFY">dc.x &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 64-bit words of memory in</P>
<P ALIGN="JUSTIFY">the current section. Also IEEE extended precision  oating point constants are</P>
<P ALIGN="JUSTIFY">allowed.</P>
<P ALIGN="JUSTIFY">dcb.b &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; bytes into the current section.</P>
<P ALIGN="JUSTIFY">dcb.d &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; 64-bit words into the current section. &lt;fill&gt; might</P>
<P ALIGN="JUSTIFY">also be an IEEE double precision constant.</P>
<P ALIGN="JUSTIFY">dcb.l &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; 32-bit words into the current section.</P>
<P ALIGN="JUSTIFY">dcb.q &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; 64-bit words into the current section.</P>
<P ALIGN="JUSTIFY">dcb.s &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; 32-bit words into the current section. &lt;fill&gt; might</P>
<P ALIGN="JUSTIFY">also be an IEEE single precision constant.</P>
<P ALIGN="JUSTIFY">dcb.w &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; 16-bit words into the current section.</P>
<P ALIGN="JUSTIFY">dcb.x &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; 86-bit words into the current section. &lt;fill&gt; might</P>
<P ALIGN="JUSTIFY">also be an IEEE extended precision constant.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>18</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">ds.b &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.b &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">ds.d &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.d &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">ds.l &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.l &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">ds.q &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.q &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">ds.s &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.s &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">ds.w &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.w &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">ds.x &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to dcb.x &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">dseg Equivalent to section data,data.</P>
<P ALIGN="JUSTIFY">else Assemble the following lines if the previous if condition was false.</P>
<P ALIGN="JUSTIFY">end Assembly will terminate behind this line.</P>
<P ALIGN="JUSTIFY">endif Ends a section of conditional assembly.</P>
<P ALIGN="JUSTIFY">endm Ends a macro definition.</P>
<P ALIGN="JUSTIFY">endr Ends a repetition block.</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; equ &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Define a new program symbol with the name &lt;symbol&gt; and assign to it the</P>
<P ALIGN="JUSTIFY">value of &lt;expression&gt;. Defining &lt;symbol&gt; twice will cause an error.</P>
<P ALIGN="JUSTIFY">even Aligns to an even address. Equivalent to cnop 0,2.</P>
<P ALIGN="JUSTIFY">fail &lt;message&gt;</P>
<P ALIGN="JUSTIFY">Immediately break assembly with a fatal error, showing the &lt;message&gt; from</P>
<P ALIGN="JUSTIFY">the operand field.</P>
<P ALIGN="JUSTIFY">&lt;label&gt; fo.&lt;size&gt; &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Assigns the current value of the stack-frame o set counter to &lt;label&gt;. Af-</P>
<P ALIGN="JUSTIFY">terwards the counter is decremented by the instruction’s &lt;size&gt; multiplied by</P>
<P ALIGN="JUSTIFY">&lt;expression&gt;. Any valid M68k size extension is allowed for &lt;size&gt;: b, w, l, q,</P>
<P ALIGN="JUSTIFY">s, d, x, p. The o set counter can also be referenced directly under the name</P>
<P ALIGN="JUSTIFY">__FO.</P>
<P ALIGN="JUSTIFY">idnt &lt;name&gt;</P>
<P ALIGN="JUSTIFY">Sets the file or module name in the generated object file to &lt;name&gt;, when the</P>
<P ALIGN="JUSTIFY">selected output module supports it. By default, the input filename passed on</P>
<P ALIGN="JUSTIFY">the command line is used.</P>
<P ALIGN="JUSTIFY">if &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is non-zero.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 4: Mot Syntax Module</P>
<P ALIGN="JUSTIFY">19</P>
<P ALIGN="JUSTIFY">ifeq &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is zero.</P>
<P ALIGN="JUSTIFY">ifne &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is non-zero.</P>
<P ALIGN="JUSTIFY">ifgt &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is greater than zero.</P>
<P ALIGN="JUSTIFY">ifge &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is greater than zero</P>
<P ALIGN="JUSTIFY">or equal.</P>
<P ALIGN="JUSTIFY">iflt &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is less than zero.</P>
<P ALIGN="JUSTIFY">ifle &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is less than zero or</P>
<P ALIGN="JUSTIFY">equal.</P>
<P ALIGN="JUSTIFY">ifd &lt;symbol&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;symbol&gt; is defined.</P>
<P ALIGN="JUSTIFY">ifnd &lt;symbol&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;symbol&gt; is undefined.</P>
<P ALIGN="JUSTIFY">ifc &lt;string1&gt;,&lt;string2&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;string1&gt; matches &lt;string2&gt;.</P>
<P ALIGN="JUSTIFY">ifnc &lt;string1&gt;,&lt;string2&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;string1&gt; does not match &lt;string2&gt;.</P>
<P ALIGN="JUSTIFY">incbin &lt;file&gt;</P>
<P ALIGN="JUSTIFY">Inserts the binary contents of &lt;file&gt; into the object code at this position. The</P>
<P ALIGN="JUSTIFY">file will be searched first in the current directory, then in all paths defined by</P>
<P ALIGN="JUSTIFY">‘-I’ or incdir in the order of occurence.</P>
<P ALIGN="JUSTIFY">incdir &lt;path&gt;</P>
<P ALIGN="JUSTIFY">Add another path to search for include files to the list of known paths. Paths</P>
<P ALIGN="JUSTIFY">defined with ‘-I’ on the command line are searched first.</P>
<P ALIGN="JUSTIFY">include &lt;file&gt;</P>
<P ALIGN="JUSTIFY">Include source text of &lt;file&gt; at this position. The include file will be searched</P>
<P ALIGN="JUSTIFY">first in the current directory, then in all paths defined by ‘-I’ or incdir in the</P>
<P ALIGN="JUSTIFY">order of occurence.</P>
<P ALIGN="JUSTIFY">list The following lines will appear in the listing file, if it was requested.</P>
<P ALIGN="JUSTIFY">nolist The following lines will not be visible in a listing file.</P>
<P ALIGN="JUSTIFY">macro &lt;name&gt;</P>
<P ALIGN="JUSTIFY">Defines a macro which can be referenced by &lt;name&gt;. The &lt;name&gt; may also</P>
<P ALIGN="JUSTIFY">appear at the left side of the macro directive, starting at the first column.</P>
<P ALIGN="JUSTIFY">Then the operand field is ignored. The macro definition is closed by an endm</P>
<P ALIGN="JUSTIFY">directive. When calling a macro you may pass up to 9 arguments, separated by</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>20</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">comma. Those arguments are referenced within the macro context as \1 to \9.</P>
<P ALIGN="JUSTIFY">Argument \0 is set to the macro’s first qualifier (mnemonic extension), when</P>
<P ALIGN="JUSTIFY">given. The special argument \@ inserts a unique id, useful for defining labels.</P>
<P ALIGN="JUSTIFY">mexit Leave the current macro and continue with assembling the parent context. Note</P>
<P ALIGN="JUSTIFY">that this directive also resets the level of conditional assembly to a state before</P>
<P ALIGN="JUSTIFY">the macro was invoked (which means that it works as a ’break’ command on</P>
<P ALIGN="JUSTIFY">all new if directives).</P>
<P ALIGN="JUSTIFY">org &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Sets the base address for the subsequent code.</P>
<P ALIGN="JUSTIFY">output &lt;name&gt;</P>
<P ALIGN="JUSTIFY">Sets the output file name to &lt;name&gt; when no output name was given on the</P>
<P ALIGN="JUSTIFY">command line. A special case for Devpac-compatibility is when &lt;name&gt; starts</P>
<P ALIGN="JUSTIFY">with a ’.’ and an output name was already given. Then the current output</P>
<P ALIGN="JUSTIFY">name gets &lt;name&gt; appended as an extension.</P>
<P ALIGN="JUSTIFY">plen &lt;len&gt;</P>
<P ALIGN="JUSTIFY">The the page length for a listing file to &lt;len&gt; lines. Currently ignored.</P>
<P ALIGN="JUSTIFY">public &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as an external symbol, which means that &lt;symbol&gt; is visible to</P>
<P ALIGN="JUSTIFY">all modules in the linking process. It may be either defined or undefined.</P>
<P ALIGN="JUSTIFY">rept &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Repeats the assembly of the block between rept and endr &lt;expression&gt; number</P>
<P ALIGN="JUSTIFY">of times. &lt;expression&gt; has to be positive.</P>
<P ALIGN="JUSTIFY">&lt;label&gt; rs.&lt;size&gt; &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Works like the so directive, with the only di erence that the o set symbol is</P>
<P ALIGN="JUSTIFY">named __RS.</P>
<P ALIGN="JUSTIFY">rsreset Equivalent to clrso, but the symbol manipulated is __RS.</P>
<P ALIGN="JUSTIFY">rsset Equivalent to setso, but the symbol manipulated is __RS.</P>
<P ALIGN="JUSTIFY">section [&lt;name&gt;,]&lt;sec_type&gt;[,&lt;mem_type&gt;]]</P>
<P ALIGN="JUSTIFY">Starts a new section named &lt;name&gt; or reactivates an old one. &lt;sec_type&gt;</P>
<P ALIGN="JUSTIFY">defines the section type and may be code, text (same as code), data or bss.</P>
<P ALIGN="JUSTIFY">&lt;sec_type&gt; defaults to code in Phxass mode. Otherwise a single argument</P>
<P ALIGN="JUSTIFY">will start a section with the type and name of &lt;sec_type&gt;. When &lt;mem_type&gt;</P>
<P ALIGN="JUSTIFY">is given it defines the type of memory, where the section can be loaded. This</P>
<P ALIGN="JUSTIFY">is Amiga-specific and allowed identifiers are chip for Chip-RAM and fast for</P>
<P ALIGN="JUSTIFY">Fast-RAM. Optionally it is also possible to attach the su x _C, _F or _P to the</P>
<P ALIGN="JUSTIFY">&lt;sec_type&gt; argument for defining the memory type.</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; set &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Create a new program symbol with the name &lt;symbol&gt; and assign to it the</P>
<P ALIGN="JUSTIFY">value of &lt;expression&gt;. If &lt;symbol&gt; is already assigned, it will contain a new</P>
<P ALIGN="JUSTIFY">value from now on.</P>
<P ALIGN="JUSTIFY">setfo &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Sets the stack-frame o set counter to &lt;expresion&gt;. See fo directive.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 4: Mot Syntax Module</P>
<P ALIGN="JUSTIFY">21</P>
<P ALIGN="JUSTIFY">setso &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Sets the structure o set counter to &lt;expresion&gt;. See so directive.</P>
<P ALIGN="JUSTIFY">&lt;label&gt; so.&lt;size&gt; &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Assigns the current value of the structure o set counter to &lt;label&gt;. Afterwards</P>
<P ALIGN="JUSTIFY">the counter is incremented by the instruction’s &lt;size&gt; multiplied by &lt;expres-</P>
<P ALIGN="JUSTIFY">sion&gt;. Any valid M68k size extension is allowed for &lt;size&gt;: b, w, l, q, s, d, x,</P>
<P ALIGN="JUSTIFY">p. The o set counter can also be referenced directly under the name __SO.</P>
<P ALIGN="JUSTIFY">text Equivalent to section code,code.</P>
<P ALIGN="JUSTIFY">ttl &lt;name&gt;</P>
<P ALIGN="JUSTIFY">PhxAss syntax. Equivalent to idnt &lt;name&gt;.</P>
<P ALIGN="JUSTIFY">&lt;name&gt; ttl</P>
<P ALIGN="JUSTIFY">Motorola syntax. Equivalent to idnt &lt;name&gt;.</P>
<P ALIGN="JUSTIFY">xdef &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as an global symbol, which means that &lt;symbol&gt; is visible to</P>
<P ALIGN="JUSTIFY">all modules in the linking process. See also public.</P>
<P ALIGN="JUSTIFY">xref &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as externally defined, which means it has to be important from</P>
<P ALIGN="JUSTIFY">another module in the linking process. See also public.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">4.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None?</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">4.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 1001: mnemonic expected</P>
<P ALIGN="JUSTIFY">- 1002: invalid extension</P>
<P ALIGN="JUSTIFY">- 1003: no space before oprands</P>
<P ALIGN="JUSTIFY">- 1004: too many closing parentheses</P>
<P ALIGN="JUSTIFY">- 1005: missing closing parentheses</P>
<P ALIGN="JUSTIFY">- 1006: missing operand</P>
<P ALIGN="JUSTIFY">- 1007: garbage at end of line</P>
<P ALIGN="JUSTIFY">- 1008: \ expected</P>
<P ALIGN="JUSTIFY">- 1009: invalid data operand</P>
<P ALIGN="JUSTIFY">- 1010: , expected</P>
<P ALIGN="JUSTIFY">- 1011: identifier expected</P>
<P ALIGN="JUSTIFY">- 1012: illegal escape sequence &lt;c&gt;</P>
<P ALIGN="JUSTIFY">- 1013: expression must be a constant</P>
<P ALIGN="JUSTIFY">- 1014: illegal section type</P>
<P ALIGN="JUSTIFY">- 1015: repeatedly defined symbol</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>22</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">- 1016: illegal memory type</P>
<P ALIGN="JUSTIFY">- 1017: unexpected endm without macro</P>
<P ALIGN="JUSTIFY">- 1018: endif without if</P>
<P ALIGN="JUSTIFY">- 1019: if without endif</P>
<P ALIGN="JUSTIFY">- 1020: maximum if-nesting depth exceeded (%d levels)</P>
<P ALIGN="JUSTIFY">- 1021: else without if</P>
<P ALIGN="JUSTIFY">- 1022: missing %c</P>
<P ALIGN="JUSTIFY">- 1023: cannot open binary file %s</P>
<P ALIGN="JUSTIFY">- 1024: internal symbol %s redefined by user</P>
<P ALIGN="JUSTIFY">- 1025: syntax error</P>
<P ALIGN="JUSTIFY">- 1026: unexpected endr without rept</P>
<P ALIGN="JUSTIFY">- 1027: directive has no e ect</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 5: Oldstyle Syntax Module</P>
<P ALIGN="JUSTIFY">23</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">5 Oldstyle Syntax Module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the oldstyle syntax module suitable for some 8-bit CPUs (6502, 680x,</P>
<P ALIGN="JUSTIFY">Z80, etc.), which is available with the extension oldstyle.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">5.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002-2009 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">5.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This syntax module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-dotdir’ Directives have to be preceded by a dot (.).</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">5.3 General Syntax</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Labels always start at the first column and may be terminated by a colon (:), but don’t</P>
<P ALIGN="JUSTIFY">need to. In the last case the mnemonic needs to be separated from the label by whitespace</P>
<P ALIGN="JUSTIFY">(not required in any case, e.g. =). The operands are separated from the mnemonic by</P>
<P ALIGN="JUSTIFY">whitespace. Multiple operands are separated by comma (,).</P>
<P ALIGN="JUSTIFY">Make sure that you don’t define a label on the same line as a directive for conditional</P>
<P ALIGN="JUSTIFY">assembly (if, else, endif)! This is not supported.</P>
<P ALIGN="JUSTIFY">Comments are introduced by the comment character ;. The rest of the line will be ignored.</P>
<P ALIGN="JUSTIFY">Example:</P>
<P ALIGN="JUSTIFY">mylabel instr op1,op2 ;comment</P>
<P ALIGN="JUSTIFY">In expressions, numbers starting with $ are hexadecimal (e.g. $fb2c). % introduces binary</P>
<P ALIGN="JUSTIFY">numbers (e.g. %1100101). Numbers starting with @ are assumed to be octal numbers, e.g.</P>
<P ALIGN="JUSTIFY">@237. All numbers starting with a digit are decimal, e.g. 1239.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">5.4 Directives</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The following directives are supported by this syntax module (if the CPU- and output-</P>
<P ALIGN="JUSTIFY">module allow it):</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; = &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to &lt;symbol&gt; equ &lt;expression&gt;.</P>
<P ALIGN="JUSTIFY">addr &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Equivalent to word &lt;exp1&gt;[,&lt;exp2&gt;...].</P>
<P ALIGN="JUSTIFY">align &lt;bitcount&gt;</P>
<P ALIGN="JUSTIFY">Insert as much zero bytes as required to reach an address where &lt;bit count&gt;</P>
<P ALIGN="JUSTIFY">low order bits are zero. For example align 2 would make an alignment to the</P>
<P ALIGN="JUSTIFY">next 32-bit boundary.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>24</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">asc &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">Equivalent to byte &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...].</P>
<P ALIGN="JUSTIFY">ascii &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">See defm.</P>
<P ALIGN="JUSTIFY">asciiz "&lt;string1&gt;"[,"&lt;string2&gt;"...]</P>
<P ALIGN="JUSTIFY">See string.</P>
<P ALIGN="JUSTIFY">binary &lt;file&gt;</P>
<P ALIGN="JUSTIFY">Inserts the binary contents of &lt;file&gt; into the object code at this position. The</P>
<P ALIGN="JUSTIFY">file will be searched first in the current directory, then in all paths defined by</P>
<P ALIGN="JUSTIFY">‘-I’ or incdir in the order of occurence.</P>
<P ALIGN="JUSTIFY">blk &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; bytes into the current section.</P>
<P ALIGN="JUSTIFY">blkw &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Insert &lt;exp&gt; zero or &lt;fill&gt; 16-bit words into the current section, using the en-</P>
<P ALIGN="JUSTIFY">dianess of the target CPU.</P>
<P ALIGN="JUSTIFY">byt Increases the program counter by one. Equivalent to blk 1,0.</P>
<P ALIGN="JUSTIFY">byte &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">Assign the integer or string constant operands into successive bytes of memory</P>
<P ALIGN="JUSTIFY">in the current section. Any combination of integer and character string constant</P>
<P ALIGN="JUSTIFY">operands is permitted.</P>
<P ALIGN="JUSTIFY">data &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">Equivalent to byte &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...].</P>
<P ALIGN="JUSTIFY">db &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">Equivalent to byte &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...].</P>
<P ALIGN="JUSTIFY">dc &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to blk &lt;exp&gt;[,&lt;fill&gt;].</P>
<P ALIGN="JUSTIFY">defb &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">Equivalent to byte &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...].</P>
<P ALIGN="JUSTIFY">defc &lt;symbol&gt; = &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Define a new program symbol with the name &lt;symbol&gt; and assign to it the</P>
<P ALIGN="JUSTIFY">value of &lt;expression&gt;. Defining &lt;symbol&gt; twice will cause an error.</P>
<P ALIGN="JUSTIFY">defl &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 32-bit integers of memory in</P>
<P ALIGN="JUSTIFY">the current section, using the endianess of the target CPU.</P>
<P ALIGN="JUSTIFY">defp &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 24-bit integers of memory in</P>
<P ALIGN="JUSTIFY">the current section, using the endianess of the target CPU.</P>
<P ALIGN="JUSTIFY">defm "string"</P>
<P ALIGN="JUSTIFY">Equivalent to text "string".</P>
<P ALIGN="JUSTIFY">defw &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Equivalent to word &lt;exp1&gt;[,&lt;exp2&gt;...].</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 5: Oldstyle Syntax Module</P>
<P ALIGN="JUSTIFY">25</P>
<P ALIGN="JUSTIFY">dfb &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...]</P>
<P ALIGN="JUSTIFY">Equivalent to byte &lt;exp1&gt;[,&lt;exp2&gt;,"&lt;string1&gt;"...].</P>
<P ALIGN="JUSTIFY">dfw &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Equivalent to word &lt;exp1&gt;[,&lt;exp2&gt;...].</P>
<P ALIGN="JUSTIFY">defs &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to blk &lt;exp&gt;[,&lt;fill&gt;].</P>
<P ALIGN="JUSTIFY">ds &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to blk &lt;exp&gt;[,&lt;fill&gt;].</P>
<P ALIGN="JUSTIFY">dsb &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to blk &lt;exp&gt;[,&lt;fill&gt;].</P>
<P ALIGN="JUSTIFY">dsw &lt;exp&gt;[,&lt;fill&gt;]</P>
<P ALIGN="JUSTIFY">Equivalent to blkw &lt;exp&gt;[,&lt;fill&gt;].</P>
<P ALIGN="JUSTIFY">dw &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Equivalent to word &lt;exp1&gt;[,&lt;exp2&gt;...].</P>
<P ALIGN="JUSTIFY">end Assembly will terminate behind this line.</P>
<P ALIGN="JUSTIFY">endif Ends a section of conditional assembly.</P>
<P ALIGN="JUSTIFY">el Equivalent to else.</P>
<P ALIGN="JUSTIFY">else Assemble the following lines when the previous if-condition was false.</P>
<P ALIGN="JUSTIFY">ei Equivalent to endif. (Not available for Z80 CPU)</P>
<P ALIGN="JUSTIFY">endm Ends a macro definition.</P>
<P ALIGN="JUSTIFY">endmac Ends a macro definition.</P>
<P ALIGN="JUSTIFY">endmacro Ends a macro definition.</P>
<P ALIGN="JUSTIFY">endr Ends a repetition block.</P>
<P ALIGN="JUSTIFY">endrep Ends a repetition block.</P>
<P ALIGN="JUSTIFY">endrepeat</P>
<P ALIGN="JUSTIFY">Ends a repetition block.</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; eq &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to &lt;symbol&gt; equ &lt;expression&gt;.</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; equ &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Define a new program symbol with the name &lt;symbol&gt; and assign to it the</P>
<P ALIGN="JUSTIFY">value of &lt;expression&gt;. Defining &lt;symbol&gt; twice will cause an error.</P>
<P ALIGN="JUSTIFY">extern &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">See global.</P>
<P ALIGN="JUSTIFY">even Aligns to an even address. Equivalent to align 1.</P>
<P ALIGN="JUSTIFY">fill &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to blk &lt;exp&gt;,0.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>26</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">global &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as an external symbol, which means that &lt;symbol&gt; is visible to</P>
<P ALIGN="JUSTIFY">all modules in the linking process. It may be either defined or undefined.</P>
<P ALIGN="JUSTIFY">if &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is non-zero.</P>
<P ALIGN="JUSTIFY">ifdef &lt;symbol&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;symbol&gt; is defined.</P>
<P ALIGN="JUSTIFY">ifndef &lt;symbol&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;symbol&gt; is undefined.</P>
<P ALIGN="JUSTIFY">ifeq &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is zero.</P>
<P ALIGN="JUSTIFY">ifne &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is non-zero.</P>
<P ALIGN="JUSTIFY">ifgt &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is greater than zero.</P>
<P ALIGN="JUSTIFY">ifge &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is greater than zero</P>
<P ALIGN="JUSTIFY">or equal.</P>
<P ALIGN="JUSTIFY">iflt &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is less than zero.</P>
<P ALIGN="JUSTIFY">ifle &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Conditionally assemble the following lines if &lt;expression&gt; is less than zero or</P>
<P ALIGN="JUSTIFY">equal.</P>
<P ALIGN="JUSTIFY">incbin &lt;file&gt;</P>
<P ALIGN="JUSTIFY">Inserts the binary contents of &lt;file&gt; into the object code at this position. The</P>
<P ALIGN="JUSTIFY">file will be searched first in the current directory, then in all paths defined by</P>
<P ALIGN="JUSTIFY">‘-I’ or incdir in the order of occurence.</P>
<P ALIGN="JUSTIFY">incdir &lt;path&gt;</P>
<P ALIGN="JUSTIFY">Add another path to search for include files to the list of known paths. Paths</P>
<P ALIGN="JUSTIFY">defined with ‘-I’ on the command line are searched first.</P>
<P ALIGN="JUSTIFY">include &lt;file&gt;</P>
<P ALIGN="JUSTIFY">Include source text of &lt;file&gt; at this position. The include file will be searched</P>
<P ALIGN="JUSTIFY">first in the current directory, then in all paths defined by ‘-I’ or incdir in the</P>
<P ALIGN="JUSTIFY">order of occurence.</P>
<P ALIGN="JUSTIFY">mac &lt;name&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to macro &lt;name&gt;.</P>
<P ALIGN="JUSTIFY">local &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as a local symbol, which means that &lt;symbol&gt; is local for the</P>
<P ALIGN="JUSTIFY">current file and invisible to other modules in the linking process.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 5: Oldstyle Syntax Module</P>
<P ALIGN="JUSTIFY">27</P>
<P ALIGN="JUSTIFY">macro &lt;name&gt;</P>
<P ALIGN="JUSTIFY">Defines a macro which can be referenced by &lt;name&gt;. The &lt;name&gt; may also</P>
<P ALIGN="JUSTIFY">appear at the left side of the macro directive, starting at the first column. The</P>
<P ALIGN="JUSTIFY">macro definition is closed by an endm directive. When calling a macro you may</P>
<P ALIGN="JUSTIFY">pass up to 9 arguments, separated by comma. Those arguments are referenced</P>
<P ALIGN="JUSTIFY">within the macro context as \1 to \9. Argument \0 is set to the macro’s first</P>
<P ALIGN="JUSTIFY">qualifier (mnemonic extension), when given. The special argument \@ inserts a</P>
<P ALIGN="JUSTIFY">unique id, useful for defining labels.</P>
<P ALIGN="JUSTIFY">mdat &lt;file&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to incbin &lt;file&gt;.</P>
<P ALIGN="JUSTIFY">org &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Sets the base address for the subsequent code. This is equivalent to</P>
<P ALIGN="JUSTIFY">*=&lt;expression&gt;.</P>
<P ALIGN="JUSTIFY">repeat &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to rept &lt;expression&gt;.</P>
<P ALIGN="JUSTIFY">rept &lt;expression&gt;</P>
<P ALIGN="JUSTIFY">Repeats the assembly of the block between rept and endr &lt;expression&gt; number</P>
<P ALIGN="JUSTIFY">of times. &lt;expression&gt; has to be positive.</P>
<P ALIGN="JUSTIFY">reserve &lt;exp&gt;</P>
<P ALIGN="JUSTIFY">Equivalent to blk &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">section &lt;name&gt;[,"&lt;attributes&gt;"]</P>
<P ALIGN="JUSTIFY">Starts a new section named &lt;name&gt; or reactivate an old one. If attributes are</P>
<P ALIGN="JUSTIFY">given for an already existing section, they must match exactly. The section’s</P>
<P ALIGN="JUSTIFY">name will also be defined as a new symbol, which represents the section’s start</P>
<P ALIGN="JUSTIFY">address. The "&lt;attributes&gt;" string may consist of the following characters:</P>
<P ALIGN="JUSTIFY">Section Contents:</P>
<P ALIGN="JUSTIFY">c section has code</P>
<P ALIGN="JUSTIFY">d section has initialized data</P>
<P ALIGN="JUSTIFY">u section has uninitialized data</P>
<P ALIGN="JUSTIFY">i section has directives (info section)</P>
<P ALIGN="JUSTIFY">n section can be discarded</P>
<P ALIGN="JUSTIFY">R remove section at link time</P>
<P ALIGN="JUSTIFY">a section is allocated in memory</P>
<P ALIGN="JUSTIFY">Section Protection:</P>
<P ALIGN="JUSTIFY">r section is readable</P>
<P ALIGN="JUSTIFY">w section is writable</P>
<P ALIGN="JUSTIFY">x section is executable</P>
<P ALIGN="JUSTIFY">s section is sharable</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>28</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">Section Alignment (only one):</P>
<P ALIGN="JUSTIFY">0 align to byte boundary</P>
<P ALIGN="JUSTIFY">1 align to halfword boundary</P>
<P ALIGN="JUSTIFY">2 align to word boundary</P>
<P ALIGN="JUSTIFY">3 align to doubleword boundary</P>
<P ALIGN="JUSTIFY">4 align to quadword boundary</P>
<P ALIGN="JUSTIFY">5 align to 32 byte boundary</P>
<P ALIGN="JUSTIFY">6 align to 64 byte boundary</P>
<P ALIGN="JUSTIFY">spc &lt;exp&gt; Equivalent to blk &lt;exp&gt;,0.</P>
<P ALIGN="JUSTIFY">string "&lt;string1&gt;"[,"&lt;string2&gt;"...]</P>
<P ALIGN="JUSTIFY">Like string, but adds a terminating zero-byte.</P>
<P ALIGN="JUSTIFY">text "string"</P>
<P ALIGN="JUSTIFY">Places a single string constant operands into successive bytes of memory in the</P>
<P ALIGN="JUSTIFY">current section.</P>
<P ALIGN="JUSTIFY">weak &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">Flag &lt;symbol&gt; as a weak symbol, which means that &lt;symbol&gt; is visible to all</P>
<P ALIGN="JUSTIFY">modules in the linking process and may be replaced by any global symbol with</P>
<P ALIGN="JUSTIFY">the same name. When a weak symbol remains undefined its value defaults to</P>
<P ALIGN="JUSTIFY">0.</P>
<P ALIGN="JUSTIFY">wor &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Equivalent to word &lt;exp1&gt;[,&lt;exp2&gt;...].</P>
<P ALIGN="JUSTIFY">wrd Increases the program counter by two. Equivalent to blkw 1,0.</P>
<P ALIGN="JUSTIFY">word &lt;exp1&gt;[,&lt;exp2&gt;...]</P>
<P ALIGN="JUSTIFY">Assign the values of the operands into successive 16-bit words of memory in the</P>
<P ALIGN="JUSTIFY">current section, using the endianess of the target CPU.</P>
<P ALIGN="JUSTIFY">xdef &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">See global.</P>
<P ALIGN="JUSTIFY">xlib &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">See global.</P>
<P ALIGN="JUSTIFY">xref &lt;symbol&gt;[,&lt;symbol&gt;...]</P>
<P ALIGN="JUSTIFY">See global.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">5.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- Addresses assigned to org or to the current pc symbol ’*’ (on the z80 the pc symbol</P>
<P ALIGN="JUSTIFY">is ’$’) must be constant.</P>
<P ALIGN="JUSTIFY">- Expressions in an if directive must be constant.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 5: Oldstyle Syntax Module</P>
<P ALIGN="JUSTIFY">29</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">5.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 1001: syntax error</P>
<P ALIGN="JUSTIFY">- 1002: invalid extension</P>
<P ALIGN="JUSTIFY">- 1003: no space before operands</P>
<P ALIGN="JUSTIFY">- 1004: too many closing parentheses</P>
<P ALIGN="JUSTIFY">- 1005: missing closing parentheses</P>
<P ALIGN="JUSTIFY">- 1006: missing operand</P>
<P ALIGN="JUSTIFY">- 1007: garbage at end of line</P>
<P ALIGN="JUSTIFY">- 1008: %c expected</P>
<P ALIGN="JUSTIFY">- 1009: invalid data operand</P>
<P ALIGN="JUSTIFY">- 1010: , expected</P>
<P ALIGN="JUSTIFY">- 1011: identifier expected</P>
<P ALIGN="JUSTIFY">- 1012: illegal escape sequence \%c</P>
<P ALIGN="JUSTIFY">- 1013: expression must be a constant</P>
<P ALIGN="JUSTIFY">- 1014: repeatedly defined symbol</P>
<P ALIGN="JUSTIFY">- 1015: endif without if</P>
<P ALIGN="JUSTIFY">- 1016: if without endif</P>
<P ALIGN="JUSTIFY">- 1017: maximum if-nesting depth exceeded (%d levels)</P>
<P ALIGN="JUSTIFY">- 1018: else without if</P>
<P ALIGN="JUSTIFY">- 1019: unexpected endr without macro</P>
<P ALIGN="JUSTIFY">- 1020: unexpected endr without rept</P>
<P ALIGN="JUSTIFY">- 1021: cannot open binary file "%s"</P>
<P ALIGN="JUSTIFY">- 1022: symbol &lt;%s&gt; already defined with %s scope</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>30</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 6: Simple binary output module</P>
<P ALIGN="JUSTIFY">31</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">6 Simple binary output module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the simple binary output module which can be selected with the</P>
<P ALIGN="JUSTIFY">‘-Fbin’ option.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">6.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002,2008 by Volker Barthelmann.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">6.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">‘-cbm-prg’</P>
<P ALIGN="JUSTIFY">Writes a Commodore PRG header in front of the output file, which consists of</P>
<P ALIGN="JUSTIFY">two bytes in little-endian order, defining the load address of the program.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">6.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This output module outputs the contents of all sections as simple binary data without any</P>
<P ALIGN="JUSTIFY">header or additional information. When there are multiple sections, they must not overlap.</P>
<P ALIGN="JUSTIFY">Gaps between sections are filled with zero bytes. Undefined symbols are not allowed.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">6.4 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">6.5 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 3001: sections must not overlap</P>
<P ALIGN="JUSTIFY">- 3007: undefined symbol &lt;%s&gt;</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>32</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 7: Test output module</P>
<P ALIGN="JUSTIFY">33</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">7 Test output module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the test output module which can be selected with the ‘-Ftest’</P>
<P ALIGN="JUSTIFY">option.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">7.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002 by Volker Barthelmann.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">7.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This output module provides no additional options.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">7.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This output module outputs a textual description of the contents of all sections. It is mainly</P>
<P ALIGN="JUSTIFY">intended for debugging.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">7.4 Restrictions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">7.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">7.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>34</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 8: ELF output module</P>
<P ALIGN="JUSTIFY">35</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">8 ELF output module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the ELF output module which can be selected with the ‘-Felf’</P>
<P ALIGN="JUSTIFY">option.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">8.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002-2008 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">8.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">8.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This output module outputs the ELF (Executable and Linkable Format) format, which is a</P>
<P ALIGN="JUSTIFY">portable object file format which works for a variety of 32- and 64-bit operating systems.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">8.4 Restrictions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The ELF output format, as implemented in vasm, currently supports the following architec-</P>
<P ALIGN="JUSTIFY">tures:</P>
<P ALIGN="JUSTIFY">- PowerPC</P>
<P ALIGN="JUSTIFY">- M68k</P>
<P ALIGN="JUSTIFY">- ARM</P>
<P ALIGN="JUSTIFY">- i386</P>
<P ALIGN="JUSTIFY">The supported relocation types depend on the selected architecture.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">8.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">8.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 3002: output module doesn’t support cpu &lt;name&gt;</P>
<P ALIGN="JUSTIFY">- 3003: write error</P>
<P ALIGN="JUSTIFY">- 3004: section attributes &lt;attr&gt; not suppported</P>
<P ALIGN="JUSTIFY">- 3005: reloc type &lt;m&gt;, size &lt;n&gt;, mask &lt;mask&gt; (symbol &lt;sym&gt; + &lt;o set&gt;) not supported</P>
<P ALIGN="JUSTIFY">- 3006: reloc type &lt;n&gt; not supported</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>36</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 9: a.out output module</P>
<P ALIGN="JUSTIFY">37</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">9 a.out output module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the a.out output module which can be selected with the ‘-Faout’</P>
<P ALIGN="JUSTIFY">option.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">9.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2008 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">9.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">‘-mid=&lt;machine id&gt;’</P>
<P ALIGN="JUSTIFY">Sets the MID field of the a.out header to the specified value. The MID defaults</P>
<P ALIGN="JUSTIFY">to 2 (Sun020 big-endian) for M68k and to 100 (PC386 little-endian) for x86.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">9.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This output module outputs the a.out (assembler output) format, which is an older 32-bit</P>
<P ALIGN="JUSTIFY">format for Unix-like operating systems, originally invented by AT&amp;T.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">9.4 Restrictions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The a.out output format, as implemented in vasm, currently supports the following archi-</P>
<P ALIGN="JUSTIFY">tectures:</P>
<P ALIGN="JUSTIFY">- M68k</P>
<P ALIGN="JUSTIFY">- i386</P>
<P ALIGN="JUSTIFY">The following standard relocations are supported by default:</P>
<P ALIGN="JUSTIFY">- absolute, 8, 16, 32 bits</P>
<P ALIGN="JUSTIFY">- pc-relative, 8, 16, 32 bits</P>
<P ALIGN="JUSTIFY">- base-relative</P>
<P ALIGN="JUSTIFY">Standard relocations occupy 8 bytes and don’t include an addend, so they are not suitable</P>
<P ALIGN="JUSTIFY">for most RISC CPUs. The extended relocations format occupies 12 bytes and also allows</P>
<P ALIGN="JUSTIFY">more relocation types.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">9.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- Support for stab debugging symbols is still missing.</P>
<P ALIGN="JUSTIFY">- The extended relocation format is not supported.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>38</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">9.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 3004: section attributes &lt;attr&gt; not suppported</P>
<P ALIGN="JUSTIFY">- 3008: output module doesn’t allow multiple sections of the same type</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 10: TOS output module</P>
<P ALIGN="JUSTIFY">39</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">10 TOS output module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the TOS output module which can be selected with the ‘-Ftos’</P>
<P ALIGN="JUSTIFY">option.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">10.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2009 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">10.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">‘-tos-flags=&lt;flags&gt;’</P>
<P ALIGN="JUSTIFY">Sets the  ags field in the TOS file header. Defaults to 0. Overwrites a TOS</P>
<P ALIGN="JUSTIFY">ags definition in the assembler source.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">10.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module outputs the TOS executable file format, which is used on Atari 16/32-bit</P>
<P ALIGN="JUSTIFY">computers with 68000 up to 68060 CPU.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">10.4 Restrictions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">-All symbols must be defined, otherwise the generation of the executable</P>
<P ALIGN="JUSTIFY">fails. Unknown symbols are listed by vasm.</P>
<P ALIGN="JUSTIFY">-The only relocations allowed in this format are 32-bit absolute.</P>
<P ALIGN="JUSTIFY">Those are restrictions of the output format, not of vasm.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">10.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">10.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 3004: section attributes &lt;attr&gt; not suppported</P>
<P ALIGN="JUSTIFY">- 3005: reloc type %d, size %d, mask 0x%lx (symbol %s + 0x%lx) not supported</P>
<P ALIGN="JUSTIFY">- 3006: reloc type %d not supported</P>
<P ALIGN="JUSTIFY">- 3007: undefined symbol &lt;%s&gt;</P>
<P ALIGN="JUSTIFY">- 3008: output module doesn’t allow multiple sections of the same type</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>40</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 11: vobj output module</P>
<P ALIGN="JUSTIFY">41</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">11 vobj output module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the simple binary output module which can be selected with the</P>
<P ALIGN="JUSTIFY">‘-Fvobj’ option.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">11.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002-2008 by Volker Barthelmann.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">11.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">11.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This output module outputs the vobj object format, a simple portable proprietary object</P>
<P ALIGN="JUSTIFY">file format of vasm.</P>
<P ALIGN="JUSTIFY">As this format is not yet fixed, it is not described here.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">11.4 Restrictions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">11.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">11.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- None.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>42</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 12: Amiga output module</P>
<P ALIGN="JUSTIFY">43</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">12 Amiga output module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter describes the AmigaOS hunk-format output module which can be selected</P>
<P ALIGN="JUSTIFY">with the ‘-Fhunk’ option to generate objects and with the ‘-Fhunkexe’ option to generate</P>
<P ALIGN="JUSTIFY">executable files.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">12.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002-2009 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">12.2 Additional options for this version</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">These options are valid for the hunkexe module only:</P>
<P ALIGN="JUSTIFY">‘-databss’</P>
<P ALIGN="JUSTIFY">Try to shorten sections in the output file by removing zero words without re-</P>
<P ALIGN="JUSTIFY">location from the end. This technique is only supported by AmigaOS 2.0 and</P>
<P ALIGN="JUSTIFY">higher.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">12.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This output module outputs the hunk object (standard for M68k and extended for PowerPC)</P>
<P ALIGN="JUSTIFY">and hunkexe executable format, which is a proprietary file format used by AmigaOS and</P>
<P ALIGN="JUSTIFY">WarpOS.</P>
<P ALIGN="JUSTIFY">The hunkexe module will generate directly executable files, without the need for another</P>
<P ALIGN="JUSTIFY">linker run. But you have to make sure that there are no undefined symbols, common</P>
<P ALIGN="JUSTIFY">symbols, or unusual relocations (e.g. small data) left.</P>
<P ALIGN="JUSTIFY">It is allowed to define sections with the same name but di erent attributes. They will be</P>
<P ALIGN="JUSTIFY">regarded as di erent entities.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">12.4 Restrictions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The hunk/hunkexe output format is only intended for M68k and PowerPC cpu modules and</P>
<P ALIGN="JUSTIFY">will abort when used otherwise.</P>
<P ALIGN="JUSTIFY">The hunk module supports the following relocation types:</P>
<P ALIGN="JUSTIFY">- absolute, 32-bit</P>
<P ALIGN="JUSTIFY">- absolute, 16-bit</P>
<P ALIGN="JUSTIFY">- absolute, 8-bit</P>
<P ALIGN="JUSTIFY">- relative, 8-bit</P>
<P ALIGN="JUSTIFY">- relative, 14-bit (mask 0x fc) for PPC branch instructions.</P>
<P ALIGN="JUSTIFY">- relative, 16-bit</P>
<P ALIGN="JUSTIFY">- relative, 24-bit (mask 0x3  fc) for PPC branch instructions.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>44</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">- relative, 32-bit</P>
<P ALIGN="JUSTIFY">- base-relative, 16-bit</P>
<P ALIGN="JUSTIFY">- common symbols are supported as 32-bit absolute and relative references</P>
<P ALIGN="JUSTIFY">The hunkexe module supports absolute 32-bit relocations only.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">12.5 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- The hunkexe module won’t process common symbols and allocate them in a BSS section.</P>
<P ALIGN="JUSTIFY">Use a real linker for that.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">12.6 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 3001: multiple sections not supported by this format</P>
<P ALIGN="JUSTIFY">- 3002: output module doesn’t support cpu &lt;name&gt;</P>
<P ALIGN="JUSTIFY">- 3003: write error</P>
<P ALIGN="JUSTIFY">- 3004: section attributes &lt;attr&gt; not suppported</P>
<P ALIGN="JUSTIFY">- 3005: reloc type &lt;m&gt;, size &lt;n&gt;, mask &lt;mask&gt; (symbol &lt;sym&gt; + &lt;o set&gt;) not supported</P>
<P ALIGN="JUSTIFY">- 3006: reloc type &lt;n&gt; not supported</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 13: m68k cpu module</P>
<P ALIGN="JUSTIFY">45</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">13 m68k cpu module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter documents the backend for the Motorola M68k/CPU32/ColdFire micropro-</P>
<P ALIGN="JUSTIFY">cessor family.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002-2009 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.2 Additional options for this module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module provides the following additional options:</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.2.1 CPU selections</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">‘-m68000’ Generate code for the MC68000 CPU.</P>
<P ALIGN="JUSTIFY">‘-m68008’ Generate code for the MC68008 CPU.</P>
<P ALIGN="JUSTIFY">‘-m68010’ Generate code for the MC68010 CPU.</P>
<P ALIGN="JUSTIFY">‘-m68020’ Generate code for the MC68020 CPU.</P>
<P ALIGN="JUSTIFY">‘-m68030’ Generate code for the MC68030 CPU.</P>
<P ALIGN="JUSTIFY">‘-m68040’ Generate code for the MC68040 CPU.</P>
<P ALIGN="JUSTIFY">‘-m68060’ Generate code for the MC68060 CPU.</P>
<P ALIGN="JUSTIFY">‘-m68020up’</P>
<P ALIGN="JUSTIFY">Generate code for the MC68020-68060 CPU. Be careful with instructions like</P>
<P ALIGN="JUSTIFY">PFLUSHA, which exist on 68030 and 68040/060 with a di erent opcode (vasm</P>
<P ALIGN="JUSTIFY">will use the 040/060 version).</P>
<P ALIGN="JUSTIFY">‘-mcpu32’ Generate code for the CPU32 family (MC6833x, MC6834x, etc.).</P>
<P ALIGN="JUSTIFY">‘-mcf5...’</P>
<P ALIGN="JUSTIFY">‘-m5...’ Generate code for a ColdFire family CPU. The following types are recognized:</P>
<P ALIGN="JUSTIFY">5202, 5204, 5206, 520x, 5206e, 5207, 5208, 5210a, 5211a, 5212, 5213, 5214, 5216,</P>
<P ALIGN="JUSTIFY">5224, 5225, 5232, 5233, 5234, 5235, 523x, 5249, 5250, 5253, 5270, 5271, 5272,</P>
<P ALIGN="JUSTIFY">5274, 5275, 5280, 5281, 528x, 52221, 52553, 52230, 52231, 52232, 52233, 52234,</P>
<P ALIGN="JUSTIFY">52235, 52252, 52254, 52255, 52256, 52258, 52259, 52274, 52277, 5307, 5327,</P>
<P ALIGN="JUSTIFY">5328, 5329, 532x, 5372, 5373, 537x, 53011, 53012, 53013, 53014, 53015, 53016,</P>
<P ALIGN="JUSTIFY">53017, 5301x, 5407, 5470, 5471, 5472, 5473, 5474, 5475, 547x, 5480, 5481, 5482,</P>
<P ALIGN="JUSTIFY">5483, 5484, 5485, 548x, 54450, 54451, 54452, 54453, 5445x.</P>
<P ALIGN="JUSTIFY">‘-mcfv2’ Generate code for the V2 ColdFire core. This option selects ISA A (no hard-</P>
<P ALIGN="JUSTIFY">ware division or MAC), which is the most limited ISA supported by 5202, 5204</P>
<P ALIGN="JUSTIFY">and 5206. All other ColdFire chips are backwards compatible to V2.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>46</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">‘-mcfv3’ Generate code for the V3 ColdFire core. This option selects ISA A+, hardware</P>
<P ALIGN="JUSTIFY">division MAC and EMAC instructions, which are supported by nearly all V3</P>
<P ALIGN="JUSTIFY">CPUs, except the 5307.</P>
<P ALIGN="JUSTIFY">‘-mcfv4’ Generate code for the V4 ColdFire core. This option selects ISA B and MAC</P>
<P ALIGN="JUSTIFY">as supported by the 5407.</P>
<P ALIGN="JUSTIFY">‘-mcfv4e’ Generate code for the V4e ColdFire core. This option selects ISA B, USP-,</P>
<P ALIGN="JUSTIFY">FPU-, MAC- and EMAC-instructions (no hardware division) as supported by</P>
<P ALIGN="JUSTIFY">all 547x and 548x CPUs.</P>
<P ALIGN="JUSTIFY">‘-m68851’ Generate code for the MC68851 MMU. May be used in combination with an-</P>
<P ALIGN="JUSTIFY">other -m option.</P>
<P ALIGN="JUSTIFY">‘-m68881’ Generate code for the MC68881 FPU. May be used in combination with another</P>
<P ALIGN="JUSTIFY">-m option.</P>
<P ALIGN="JUSTIFY">‘-m68882’ Generate code for the MC68882 FPU. May be used in combination with another</P>
<P ALIGN="JUSTIFY">-m option.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.2.2 Optimization options</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">‘-no-opt’ Disable all optimizations.</P>
<P ALIGN="JUSTIFY">‘-opt-clr’</P>
<P ALIGN="JUSTIFY">Enables optimization from MOVE #0,&lt;ea&gt; into CLR &lt;ea&gt;. Note that CLR will</P>
<P ALIGN="JUSTIFY">execute a read-modify-write cycle on the MC68000.</P>
<P ALIGN="JUSTIFY">‘-opt-movem’</P>
<P ALIGN="JUSTIFY">Enables optimization from MOVEM &lt;ea&gt;,Rn into MOVE &lt;ea&gt;,Rn (or the other way</P>
<P ALIGN="JUSTIFY">around). This optimization will modify the  ags, when the destination is no</P>
<P ALIGN="JUSTIFY">address register.</P>
<P ALIGN="JUSTIFY">‘-opt-pea’</P>
<P ALIGN="JUSTIFY">Enables optimization from MOVE #x,-(SP) into PEA x. This optimization will</P>
<P ALIGN="JUSTIFY">leave the  ags unmodified, which might not be intended.</P>
<P ALIGN="JUSTIFY">‘-opt-st’ Enables optimization from MOVE.B #-1,&lt;ea&gt; into ST &lt;ea&gt;. This optimization</P>
<P ALIGN="JUSTIFY">will leave the  ags unmodified, which might not be intended.</P>
<P ALIGN="JUSTIFY">‘-opt-fconst’</P>
<P ALIGN="JUSTIFY">Floating point constants are loaded with the lowest precision possible. This</P>
<P ALIGN="JUSTIFY">means that FMOVE.D #1.0,FP0 would be optimized to FMOVE.S #1.0,FP0, be-</P>
<P ALIGN="JUSTIFY">cause it is faster and shorter at the same precision. The optimization will be</P>
<P ALIGN="JUSTIFY">performed on all FPU instructions with immediate addressing mode.</P>
<P ALIGN="JUSTIFY">‘-opt-brajmp’</P>
<P ALIGN="JUSTIFY">Translate relative branch instructions, whose destination is in a di erent section,</P>
<P ALIGN="JUSTIFY">into absolute jump instructions.</P>
<P ALIGN="JUSTIFY">‘-opt-allbra’</P>
<P ALIGN="JUSTIFY">When specified the assembler will also try to optimize branch instructions which</P>
<P ALIGN="JUSTIFY">already have a valid size extension. This option is automatically enabled in</P>
<P ALIGN="JUSTIFY">‘-phxass’ mode.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 13: m68k cpu module</P>
<P ALIGN="JUSTIFY">47</P>
<P ALIGN="JUSTIFY">‘-showopt’</P>
<P ALIGN="JUSTIFY">Print all optimizations and translations vasm is doing (same as opt ow+).</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.2.3 Other options</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">‘-sdreg=&lt;n&gt;’</P>
<P ALIGN="JUSTIFY">Set the small data base register to An. &lt;n&gt; is valid between 2 and 6.</P>
<P ALIGN="JUSTIFY">‘-elfregs’</P>
<P ALIGN="JUSTIFY">Register names are preceded by a ’%’ to prevent confusion with symbol names.</P>
<P ALIGN="JUSTIFY">‘-conv-brackets’</P>
<P ALIGN="JUSTIFY">Brackets (’[’ and ’]’) in an operand are automatically converted into paren-</P>
<P ALIGN="JUSTIFY">theses (’(’ and ’)’) as long as the CPU is 68000 or 68010. This is a compati-</P>
<P ALIGN="JUSTIFY">bility option for some old assemblers.</P>
<P ALIGN="JUSTIFY">‘-rangewarnings’</P>
<P ALIGN="JUSTIFY">Values which are out of range usually produce an error. With this option the</P>
<P ALIGN="JUSTIFY">errors 2026, 2030, 2033 and 2037 will be displayed as a warning, allowing the</P>
<P ALIGN="JUSTIFY">user to create an object file.</P>
<P ALIGN="JUSTIFY">‘-phxass’ PhxAss-compatibilty mode. The "current PC symbol" (e.g. * in mot-syntax</P>
<P ALIGN="JUSTIFY">module) is set to the instruction’s address + 2 whenever an instruction is parsed.</P>
<P ALIGN="JUSTIFY">JMP/JSR (label,PC) will never be optimized (into a branch, for example). It</P>
<P ALIGN="JUSTIFY">will also automatically enable ‘-opt-allbra’.</P>
<P ALIGN="JUSTIFY">‘-devpac’ All options are initially set to be Devpac compatible. Which means that all</P>
<P ALIGN="JUSTIFY">optimizations are disabled, no debugging symbols will be written and vasm will</P>
<P ALIGN="JUSTIFY">warn about any optimization being done. Other options are the same as vasm’s</P>
<P ALIGN="JUSTIFY">defaults.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend accepts M68k and CPU32 instructions as described in Mototola’s M68000</P>
<P ALIGN="JUSTIFY">family Programmer’s Reference Manual. Additionally it supports ColdFire instructions as</P>
<P ALIGN="JUSTIFY">described in Motorola’s ColdFire Microprocessor Family Programmer’s Reference Manual.</P>
<P ALIGN="JUSTIFY">The syntax for the scale factor in ColdFire MAC instruction is &lt;&lt; for left- and &gt;&gt; for right-</P>
<P ALIGN="JUSTIFY">shift. The scale factor may be inserted as an optional operand, when needed. Example:</P>
<P ALIGN="JUSTIFY">mac d0.l,d1.u,&lt;&lt;.</P>
<P ALIGN="JUSTIFY">The mask  ag in MAC instructions is written as &amp; and is appended directly on the e ective</P>
<P ALIGN="JUSTIFY">address operand. Example: mac d0,d1,(a0)&amp;,d2.</P>
<P ALIGN="JUSTIFY">The target address type is 32bit.</P>
<P ALIGN="JUSTIFY">Default alignment for instructions is 2 bytes. Sections will be aligned to 8 bytes by default.</P>
<P ALIGN="JUSTIFY">The default alignment for data is 2 bytes, when the data size is larger than 8 bits.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.4 Extensions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend extends the selected syntax module by the following directives:</P>
<P ALIGN="JUSTIFY">.sdreg &lt;An&gt;</P>
<P ALIGN="JUSTIFY">Equivalents to near &lt;An&gt;.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>48</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">basereg &lt;expression&gt;,&lt;An&gt;</P>
<P ALIGN="JUSTIFY">Starts a block of base-relative addressing through register An (remember that</P>
<P ALIGN="JUSTIFY">A7 is not allowed as a base register). The programmer has to make sure that</P>
<P ALIGN="JUSTIFY">&lt;expression&gt; is placed into An first, while the assembler automatically subtracts</P>
<P ALIGN="JUSTIFY">&lt;expression&gt;, which is usually a program label with an optional o set, from each</P>
<P ALIGN="JUSTIFY">displacement in a (d,An) addressing mode. basereg has priority over the near</P>
<P ALIGN="JUSTIFY">directive. Its e ect can be suspended with the endb directive. It is allowed to</P>
<P ALIGN="JUSTIFY">use several base registers in parallel.</P>
<P ALIGN="JUSTIFY">cpu32 Generate code for the CPU32 family.</P>
<P ALIGN="JUSTIFY">endb &lt;An&gt; Ends a basereg block and suspends its e ect onto the specified base register An.</P>
<P ALIGN="JUSTIFY">It may be reused with a di erent base expression thereafter (refer to basereg).</P>
<P ALIGN="JUSTIFY">far Disables small data (base-relative) mode. All data references will be absolute.</P>
<P ALIGN="JUSTIFY">fpu &lt;cpID&gt;</P>
<P ALIGN="JUSTIFY">Enables 68881/68882 FPU code generation. The &lt;cpID&gt; is inserted into the</P>
<P ALIGN="JUSTIFY">FPU instructions to select the correct coprocessor. Note that &lt;cpID&gt; is always</P>
<P ALIGN="JUSTIFY">1 for the on-chip FPUs in the 68040 and 68060. A &lt;cpID&gt; of zero will disable</P>
<P ALIGN="JUSTIFY">FPU code generation.</P>
<P ALIGN="JUSTIFY">machine &lt;cpu_type&gt;</P>
<P ALIGN="JUSTIFY">Makes the assembler generate code for &lt;cpu type&gt;, which can be the following:</P>
<P ALIGN="JUSTIFY">68000, 68010, 68020, 68030, 68040, 68060, 68851, 68881, 68882, cpu32. And</P>
<P ALIGN="JUSTIFY">various ColdFire CPUs, starting with 5....</P>
<P ALIGN="JUSTIFY">mc68000 Generate code for the MC68000 CPU.</P>
<P ALIGN="JUSTIFY">mc68010 Generate code for the MC68010 CPU.</P>
<P ALIGN="JUSTIFY">mc68020 Generate code for the MC68020 CPU.</P>
<P ALIGN="JUSTIFY">mc68030 Generate code for the MC68030 CPU.</P>
<P ALIGN="JUSTIFY">mc68040 Generate code for the MC68040 CPU.</P>
<P ALIGN="JUSTIFY">mc68060 Generate code for the MC68060 CPU.</P>
<P ALIGN="JUSTIFY">mcf5... Generate code for a ColdFire CPU. The recognized models are listed in the</P>
<P ALIGN="JUSTIFY">assembler-options section.</P>
<P ALIGN="JUSTIFY">near [&lt;An&gt;]</P>
<P ALIGN="JUSTIFY">Enables small data (base-relative) mode and sets the base register to An. near</P>
<P ALIGN="JUSTIFY">without an argument will reactivate a previously defined small data mode, which</P>
<P ALIGN="JUSTIFY">might be switched o  by a far directive.</P>
<P ALIGN="JUSTIFY">opt &lt;option&gt;[,&lt;option&gt;...]</P>
<P ALIGN="JUSTIFY">Sets Devpac-compatible options. When option ‘-phxass’ is given, then it will</P>
<P ALIGN="JUSTIFY">parse PhxAss options (which is discouraged, so there is no detailed description</P>
<P ALIGN="JUSTIFY">here). The supported Devpac2-style options are always su xed by a + or - to</P>
<P ALIGN="JUSTIFY">enable or disable the option:</P>
<P ALIGN="JUSTIFY">a Automatically optimize absolute to PC-relative references. Default</P>
<P ALIGN="JUSTIFY">is on.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 13: m68k cpu module</P>
<P ALIGN="JUSTIFY">49</P>
<P ALIGN="JUSTIFY">c Case-sensitivity for all symbols, instructions and macros. Default</P>
<P ALIGN="JUSTIFY">is on.</P>
<P ALIGN="JUSTIFY">d Include all symbols for debugging in the output file. Default is on.</P>
<P ALIGN="JUSTIFY">o Enable all standard optimizations and branch- and displacement</P>
<P ALIGN="JUSTIFY">optimizations, or disable all optimizations. Default is on.</P>
<P ALIGN="JUSTIFY">o1 Enable branch optimizations. Default is on.</P>
<P ALIGN="JUSTIFY">o2 Enable displacement optimizations. Default is on.</P>
<P ALIGN="JUSTIFY">ow Show all optimizations being peformed. Default is o .</P>
<P ALIGN="JUSTIFY">p Check if code is position independant. This will cause an error on</P>
<P ALIGN="JUSTIFY">each relocation being required. Default is o .</P>
<P ALIGN="JUSTIFY">s Include symbols in listing file. Default is on.</P>
<P ALIGN="JUSTIFY">t Check size and type of all expressions. Default is on.</P>
<P ALIGN="JUSTIFY">w Show assembler warnings. Default is on.</P>
<P ALIGN="JUSTIFY">Also the following Devpac3-style options are supported:</P>
<P ALIGN="JUSTIFY">autopc Corresponds to a+.</P>
<P ALIGN="JUSTIFY">case Corresponds to c+.</P>
<P ALIGN="JUSTIFY">chkpc Corresponds to p+.</P>
<P ALIGN="JUSTIFY">debug Corresponds to d+.</P>
<P ALIGN="JUSTIFY">symtab Corresponds to s+.</P>
<P ALIGN="JUSTIFY">type Corresponds to t+.</P>
<P ALIGN="JUSTIFY">warn Corresponds to w+.</P>
<P ALIGN="JUSTIFY">xdebug Corresponds to x+.</P>
<P ALIGN="JUSTIFY">noautopc Corresponds to a-.</P>
<P ALIGN="JUSTIFY">nocase Corresponds to c-.</P>
<P ALIGN="JUSTIFY">nochkpc Corresponds to p-.</P>
<P ALIGN="JUSTIFY">nodebug Corresponds to d-.</P>
<P ALIGN="JUSTIFY">nosymtab Corresponds to s-.</P>
<P ALIGN="JUSTIFY">notype Corresponds to t-.</P>
<P ALIGN="JUSTIFY">nowarn Corresponds to w-.</P>
<P ALIGN="JUSTIFY">noxdebug Corresponds to x-.</P>
<P ALIGN="JUSTIFY">p=&lt;type&gt; Sets the CPU type to any model vasm supports (original Devpac3</P>
<P ALIGN="JUSTIFY">only allowed 68000-68040, 68332, 68881, 68882 and 68851).</P>
<P ALIGN="JUSTIFY">The following directives are only available for the Motorola syntax module:</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>50</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; equr &lt;Rn&gt;</P>
<P ALIGN="JUSTIFY">Define a new symbol named &lt;symbol&gt; and assign the data or address register</P>
<P ALIGN="JUSTIFY">Rn, which can be used from now on in operands. Note that a register symbol</P>
<P ALIGN="JUSTIFY">must be defined before it can be used!</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; equrl &lt;reglist&gt;</P>
<P ALIGN="JUSTIFY">Equivalents to &lt;symbol&gt; reg &lt;reglist&gt;.</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; fequr &lt;FPn&gt;</P>
<P ALIGN="JUSTIFY">Define a new symbol named &lt;symbol&gt; and assign the FPU register FPn, which</P>
<P ALIGN="JUSTIFY">can be used from now on in operands. Note that a register symbol must be</P>
<P ALIGN="JUSTIFY">defined before it can be used!</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; fequrl &lt;reglist&gt;</P>
<P ALIGN="JUSTIFY">Equivalents to &lt;symbol&gt; freg &lt;reglist&gt;.</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; freg &lt;reglist&gt;</P>
<P ALIGN="JUSTIFY">Defines a new symbol named &lt;symbol&gt; and assign the FPU register list &lt;reglist&gt;</P>
<P ALIGN="JUSTIFY">to it. Registers in a list must be separated by a slash (/) and ranges or registers</P>
<P ALIGN="JUSTIFY">can be defined by using a hyphen (-). Examples for valid FPU register lists</P>
<P ALIGN="JUSTIFY">are: fp0-fp7, fp1-3/fp5/fp7, fpiar/fpcr.</P>
<P ALIGN="JUSTIFY">&lt;symbol&gt; reg &lt;reglist&gt;</P>
<P ALIGN="JUSTIFY">Defines a new symbol named &lt;symbol&gt; and assign the register list &lt;reglist&gt; to</P>
<P ALIGN="JUSTIFY">it. Registers in a list must be separated by a slash (/) and ranges or registers</P>
<P ALIGN="JUSTIFY">can be defined by using a hyphen (-). Examples for valid register lists are:</P>
<P ALIGN="JUSTIFY">d0-d7/a0-a6, d3-6/a0/a1/a4-5.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.5 Optimizations</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend performs the following operand optimizations:</P>
<P ALIGN="JUSTIFY">- (0,An) optimized to (An).</P>
<P ALIGN="JUSTIFY">- (d16,An) translated to (bd32,An,ZDn.w), when d16 is not between -32768 and 32767</P>
<P ALIGN="JUSTIFY">and the selected CPU allows it (68020 up or CPU32).</P>
<P ALIGN="JUSTIFY">- (d16,PC) translated to (bd32,PC,ZDn.w), when d16 is not between -32768 and 32767</P>
<P ALIGN="JUSTIFY">and the selected CPU allows it (68020 up or CPU32).</P>
<P ALIGN="JUSTIFY">- (d8,An,Rn) translated to (bd,An,Rn), when d8 is not between -128 and 127 and the</P>
<P ALIGN="JUSTIFY">selected CPU allows it (68020 up or CPU32).</P>
<P ALIGN="JUSTIFY">- (d8,PC,Rn) translated to (bd,PC,Rn), when d8 is not between -128 and 127 and the</P>
<P ALIGN="JUSTIFY">selected CPU allows it (68020 up or CPU32).</P>
<P ALIGN="JUSTIFY">- &lt;exp&gt;.l optimized to &lt;exp&gt;.w, when &lt;exp&gt; is absolute and between -32768 and 32767.</P>
<P ALIGN="JUSTIFY">- &lt;exp&gt;.w translated to &lt;exp&gt;.l, when &lt;exp&gt; is a program label or absolute and not</P>
<P ALIGN="JUSTIFY">between -32768 and 32767.</P>
<P ALIGN="JUSTIFY">- (0,An,...) optimized to (An,...) (which means the base displacement will be sup-</P>
<P ALIGN="JUSTIFY">pressed). This allows further optimization to (An), when the index is suppressed.</P>
<P ALIGN="JUSTIFY">- (bd16,An,...) translated to (bd32,An,...), when bd16 is not between -32768 and</P>
<P ALIGN="JUSTIFY">32767.</P>
<P ALIGN="JUSTIFY">- (bd32,An,...) optimized to (bd16,An,...), when bd16 is between -32768 and 32767.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 13: m68k cpu module</P>
<P ALIGN="JUSTIFY">51</P>
<P ALIGN="JUSTIFY">- (bd32,An,ZRn) optimized to (d16,An), when bd32 is between -32768 and 32767, and</P>
<P ALIGN="JUSTIFY">the index is suppressed (zero-Rn).</P>
<P ALIGN="JUSTIFY">- (An,ZRn) optimized to (An), when the index is suppressed.</P>
<P ALIGN="JUSTIFY">- (0,PC,...) optimized to (PC,...) (which means the base displacement will be sup-</P>
<P ALIGN="JUSTIFY">pressed).</P>
<P ALIGN="JUSTIFY">- (bd16,PC,...) translated to (bd32,PC,...), when bd16 is not between -32768 and</P>
<P ALIGN="JUSTIFY">32767.</P>
<P ALIGN="JUSTIFY">- (bd32,PC,...) optimized to (bd16,PC,...), when bd16 is between -32768 and 32767.</P>
<P ALIGN="JUSTIFY">- (bd32,PC,ZRn) optimized to (d16,PC), when bd32 is between -32768 and 32767, and</P>
<P ALIGN="JUSTIFY">the index is suppressed (zero-Rn).</P>
<P ALIGN="JUSTIFY">- ([0,Rn,...],...) optimized to ([An,...],...) (which means the base displacement</P>
<P ALIGN="JUSTIFY">will be suppressed).</P>
<P ALIGN="JUSTIFY">- ([bd16,Rn,...],...) translated to ([bd32,An,...],...), when bd16 is not between</P>
<P ALIGN="JUSTIFY">-32768 and 32768.</P>
<P ALIGN="JUSTIFY">- ([bd32,Rn,...],...) optimized to ([bd16,An,...],...), when bd32 is between -</P>
<P ALIGN="JUSTIFY">32768 and 32768.</P>
<P ALIGN="JUSTIFY">- ([...],0) optimized to ([...]) (which means the outer displacement will be sup-</P>
<P ALIGN="JUSTIFY">pressed).</P>
<P ALIGN="JUSTIFY">- ([...],od16) translated to ([...],od32), when od16 is not between -32768 and</P>
<P ALIGN="JUSTIFY">32767.</P>
<P ALIGN="JUSTIFY">- ([...],od32) translated to ([...],od16), when od32 is between -32768 and 32767.</P>
<P ALIGN="JUSTIFY">Note that an operand optimization will only take place when a displacement’s size was not</P>
<P ALIGN="JUSTIFY">enforced by the programmer (e.g. (4.l,a0))!</P>
<P ALIGN="JUSTIFY">This backend performs the following instruction optimizations:</P>
<P ALIGN="JUSTIFY">- MOVE.L #x,Dn optimized to MOVEQ #x,Dn, when x is between -128 and 127.</P>
<P ALIGN="JUSTIFY">- MOVE.L #x,&lt;ea&gt; optimized to MOV3Q #x,&lt;ea&gt;, for ColdFire ISA B and ISA C, when x</P>
<P ALIGN="JUSTIFY">is -1 or between 1 and 7.</P>
<P ALIGN="JUSTIFY">- MOVE.? #0,&lt;ea&gt; optimized to CLR.? &lt;ea&gt;, when allowed by the option -opt-clr or a</P>
<P ALIGN="JUSTIFY">di erent CPU than the MC68000 was selected.</P>
<P ALIGN="JUSTIFY">- MOVE.B #-1,&lt;ea&gt; optimized to ST &lt;ea&gt;, when allowed by the option -opt-st.</P>
<P ALIGN="JUSTIFY">- MOVE.? #x,-(SP) optimized to PEA x, when allowed by the option -opt-pea. The</P>
<P ALIGN="JUSTIFY">move-size must not be byte (.b).</P>
<P ALIGN="JUSTIFY">- MOVEA.? #0,An optimized to SUBA.L An,An.</P>
<P ALIGN="JUSTIFY">- MOVEA.L #x,An optimized to MOVEA.W #x,An, when x is between -32768 and 32767.</P>
<P ALIGN="JUSTIFY">- MOVEA.L #label,An optimized to LEA label,An, which could allow further optimiza-</P>
<P ALIGN="JUSTIFY">tion to LEA label(PC),An.</P>
<P ALIGN="JUSTIFY">- MOVEM.? &lt;reglist&gt; is deleted, when the register list was empty.</P>
<P ALIGN="JUSTIFY">- MOVEM.? &lt;ea&gt;,An optimized to MOVE.? &lt;ea&gt;,An, when the register list only contains a</P>
<P ALIGN="JUSTIFY">single address register.</P>
<P ALIGN="JUSTIFY">- MOVEM.? &lt;ea&gt;,Rn optimized to MOVE.? &lt;ea&gt;,Rn and MOVEM.? Rn,&lt;ea&gt; optimized to</P>
<P ALIGN="JUSTIFY">MOVE.? Rn,&lt;ea&gt;, when allowed by the option -opt-movem and the register list only</P>
<P ALIGN="JUSTIFY">contains a single register.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>52</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">- FMOVEM.? &lt;reglist&gt; is deleted, when the register list was empty.</P>
<P ALIGN="JUSTIFY">- CLR.L Dn optimized to MOVEQ #0,Dn.</P>
<P ALIGN="JUSTIFY">- EORI.? #-1,&lt;ea&gt; optimized to NOT.? &lt;ea&gt;.</P>
<P ALIGN="JUSTIFY">- ADD.? #x,&lt;ea&gt; optimized to ADDQ.? #x,&lt;ea&gt;, when x is between 1 and 8.</P>
<P ALIGN="JUSTIFY">- SUB.? #x,&lt;ea&gt; optimized to SUBQ.? #x,&lt;ea&gt;, when x is between 1 and 8.</P>
<P ALIGN="JUSTIFY">- ADD.? #x,&lt;ea&gt; optimized to SUBQ.? #x,&lt;ea&gt;, when x is between -1 and -8.</P>
<P ALIGN="JUSTIFY">- SUB.? #x,&lt;ea&gt; optimized to ADDQ.? #x,&lt;ea&gt;, when x is between -1 and -8.</P>
<P ALIGN="JUSTIFY">- ADDA.? #0,An and SUBA.? #0,An will be deleted.</P>
<P ALIGN="JUSTIFY">- ADDA.? #x,An optimized to LEA (x,An),(An), when x is between -32768 and 32767.</P>
<P ALIGN="JUSTIFY">- SUBA.? #x,An optimized to LEA (-x,An),(An), when x is between -32767 and 32768.</P>
<P ALIGN="JUSTIFY">- LEA (0,An),An will be deleted.</P>
<P ALIGN="JUSTIFY">- LEA (d,Am),An will be translated into a combination of MOVEA and ADDA.L for 68000</P>
<P ALIGN="JUSTIFY">and 68010, when d is lower than -32768 or higher than 32767.</P>
<P ALIGN="JUSTIFY">- LINK.L An,#x optimized to LINK.W An,#x, when x is between -32768 and 32767.</P>
<P ALIGN="JUSTIFY">- LINK.W An,#x translated to LINK.L An,#x, when x is not between -32768 and 32767</P>
<P ALIGN="JUSTIFY">and selected CPU supports this instruction.</P>
<P ALIGN="JUSTIFY">- CMP.? #0,&lt;ea&gt; optimized to TST.? &lt;ea&gt;. The selected CPU type must be MC68020</P>
<P ALIGN="JUSTIFY">up, ColdFire or CPU32 to support address register direct as e ective address (&lt;ea&gt;).</P>
<P ALIGN="JUSTIFY">- JMP &lt;label&gt; optimized to BRA.? &lt;label&gt;, when &lt;label&gt; is defined in the same section</P>
<P ALIGN="JUSTIFY">and in the range of -32768 to 32767 bytes from the current address.</P>
<P ALIGN="JUSTIFY">- JSR &lt;label&gt; optimized to BSR.? &lt;label&gt;, when &lt;label&gt; is defined in the same section</P>
<P ALIGN="JUSTIFY">and in the range of -32768 to 32767 bytes from the current address.</P>
<P ALIGN="JUSTIFY">- BRA &lt;label&gt; translated to JMP &lt;label&gt;, when &lt;label&gt; is not defined in the same section</P>
<P ALIGN="JUSTIFY">(and option -opt-brajmp is given), or outside the range of -32768 to 32767 bytes</P>
<P ALIGN="JUSTIFY">from the current address when the selected CPU is not 68020 up, CPU32 or ColdFire</P>
<P ALIGN="JUSTIFY">ISA B/C.</P>
<P ALIGN="JUSTIFY">- BSR &lt;label&gt; translated to JSR &lt;label&gt;, when &lt;label&gt; is not defined in the same section</P>
<P ALIGN="JUSTIFY">(and option -opt-brajmp is given), or outside the range of -32768 to 32767 bytes</P>
<P ALIGN="JUSTIFY">from the current address when the selected CPU is not 68020 up, CPU32 or ColdFire</P>
<P ALIGN="JUSTIFY">ISA B/C.</P>
<P ALIGN="JUSTIFY">- B&lt;cc&gt; &lt;label&gt; translated into a combination of B!&lt;cc&gt; *+8 and JMP &lt;label&gt;, when</P>
<P ALIGN="JUSTIFY">&lt;label&gt; is not defined in the same section (and option -opt-brajmp is given), or outside</P>
<P ALIGN="JUSTIFY">the range of -32768 to 32767 bytes from the current address when the selected CPU is</P>
<P ALIGN="JUSTIFY">not 68020 up, CPU32 or ColdFire ISA B/C.</P>
<P ALIGN="JUSTIFY">- B&lt;cc&gt; &lt;label&gt; is automatically optimized to 8-bit, 16-bit or 32-bit (68020 up, CPU32,</P>
<P ALIGN="JUSTIFY">CF5407 only), whatever fits best. When the selected CPU doesn’t support 32-bit</P>
<P ALIGN="JUSTIFY">branches it will try to change the conditional branch into a B&lt;!cc&gt; *+8 and JMP</P>
<P ALIGN="JUSTIFY">&lt;label&gt; sequence.</P>
<P ALIGN="JUSTIFY">- &lt;cp&gt;B&lt;cc&gt; &lt;label&gt; is automatically optimized to 16-bit or 32-bit, whatever fits best.</P>
<P ALIGN="JUSTIFY">&lt;cp&gt; means coprocessor and is P for the PMMU and F for the FPU.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 13: m68k cpu module</P>
<P ALIGN="JUSTIFY">53</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.6 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None?</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">13.7 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 2001: instruction not supported on selected architecture</P>
<P ALIGN="JUSTIFY">- 2002: illegal addressing mode</P>
<P ALIGN="JUSTIFY">- 2003: invalid register list</P>
<P ALIGN="JUSTIFY">- 2004: missing ) in register indirect addressing mode</P>
<P ALIGN="JUSTIFY">- 2005: address register required</P>
<P ALIGN="JUSTIFY">- 2006: bad extension - using default</P>
<P ALIGN="JUSTIFY">- 2007: displacement outside parentheses ignored</P>
<P ALIGN="JUSTIFY">- 2008: base or index register expected</P>
<P ALIGN="JUSTIFY">- 2009: missing ] in memory indirect addressing mode</P>
<P ALIGN="JUSTIFY">- 2010: no extension allowed here</P>
<P ALIGN="JUSTIFY">- 2011: illegal scale factor</P>
<P ALIGN="JUSTIFY">- 2012: can’t scale PC register</P>
<P ALIGN="JUSTIFY">- 2013: index register expected</P>
<P ALIGN="JUSTIFY">- 2014: too many ] in memory indirect addressing mode</P>
<P ALIGN="JUSTIFY">- 2015: missing outer displacement</P>
<P ALIGN="JUSTIFY">- 2016: %c expected</P>
<P ALIGN="JUSTIFY">- 2017: can’t use PC register as index</P>
<P ALIGN="JUSTIFY">- 2018: illegal relocation</P>
<P ALIGN="JUSTIFY">- 2019: data register required</P>
<P ALIGN="JUSTIFY">- 2020: illegal bitfield width/o set</P>
<P ALIGN="JUSTIFY">- 2021: constant integer expression required</P>
<P ALIGN="JUSTIFY">- 2022: value from -64 to 63 required for k-factor</P>
<P ALIGN="JUSTIFY">- 2023: need 32 bits to reference a program label</P>
<P ALIGN="JUSTIFY">- 2024: option expected</P>
<P ALIGN="JUSTIFY">- 2025: absolute value expected</P>
<P ALIGN="JUSTIFY">- 2026: operand value out of range: %ld (valid: %ld..%ld)</P>
<P ALIGN="JUSTIFY">- 2027: label in operand required</P>
<P ALIGN="JUSTIFY">- 2028: using signed operand as unsigned: %ld (valid: %ld..%ld), %ld to fix</P>
<P ALIGN="JUSTIFY">- 2029: branch destination out of range</P>
<P ALIGN="JUSTIFY">- 2030: displacement out of range</P>
<P ALIGN="JUSTIFY">- 2031: absolute displacement expected</P>
<P ALIGN="JUSTIFY">- 2032: unknown option %c%c ignored</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>54</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">- 2033: absolute short address out of range</P>
<P ALIGN="JUSTIFY">- 2034: 8-bit branch with zero displacement was converted to 16-bit</P>
<P ALIGN="JUSTIFY">- 2035: illegal opcode extension</P>
<P ALIGN="JUSTIFY">- 2036: extension for unsized instruction ignored</P>
<P ALIGN="JUSTIFY">- 2037: immediate operand out of range</P>
<P ALIGN="JUSTIFY">- 2038: immediate operand has illegal type or size</P>
<P ALIGN="JUSTIFY">- 2039: data objects with %d bits size are not supported</P>
<P ALIGN="JUSTIFY">- 2040: data out of range</P>
<P ALIGN="JUSTIFY">- 2041: data has illegal type</P>
<P ALIGN="JUSTIFY">- 2042: illegal combination of ColdFire addressing modes</P>
<P ALIGN="JUSTIFY">- 2043: FP register required</P>
<P ALIGN="JUSTIFY">- 2044: unknown cpu type</P>
<P ALIGN="JUSTIFY">- 2045: register expected</P>
<P ALIGN="JUSTIFY">- 2046: link.w changed to link.l</P>
<P ALIGN="JUSTIFY">- 2047: branch out of range changed to jmp</P>
<P ALIGN="JUSTIFY">- 2048: lea-displacement out of range, changed into move/add</P>
<P ALIGN="JUSTIFY">- 2049: translated (A%d) into (0,A%d) for movep</P>
<P ALIGN="JUSTIFY">- 2050: operand optimized: %s</P>
<P ALIGN="JUSTIFY">- 2051: operand translated: %s</P>
<P ALIGN="JUSTIFY">- 2051: instruction optimized: %s</P>
<P ALIGN="JUSTIFY">- 2053: instruction translated: %s</P>
<P ALIGN="JUSTIFY">- 2054: branch optimized into: b&lt;cc&gt;.%c</P>
<P ALIGN="JUSTIFY">- 2055: branch translated into: b&lt;cc&gt;.%c</P>
<P ALIGN="JUSTIFY">- 2056: basereg A%d already in use</P>
<P ALIGN="JUSTIFY">- 2057: basereg A%d is already free</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 14: PowerPC cpu module</P>
<P ALIGN="JUSTIFY">55</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">14 PowerPC cpu module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter documents the Backend for the PowerPC microprocessor family.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">14.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is written in 2002-2006 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">14.2 Additional options for this module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-big’ Select big-endian mode.</P>
<P ALIGN="JUSTIFY">‘-no-regnames’</P>
<P ALIGN="JUSTIFY">Don’t predefine any register-name symbols.</P>
<P ALIGN="JUSTIFY">‘-little’ Select little-endian mode.</P>
<P ALIGN="JUSTIFY">‘-mpwrx, -mpwr2’</P>
<P ALIGN="JUSTIFY">Generate code for the POWER2 family.</P>
<P ALIGN="JUSTIFY">‘-mpwr’ Generate code for the POWER family.</P>
<P ALIGN="JUSTIFY">‘-m601’ Generate code for the 601.</P>
<P ALIGN="JUSTIFY">‘-mppc, -mppc32, -m403, -m603, -m604’</P>
<P ALIGN="JUSTIFY">Generate code for the 32-bit PowerPC family.</P>
<P ALIGN="JUSTIFY">‘-mppc, -mppc64, -m620’</P>
<P ALIGN="JUSTIFY">Generate code for the 64-bit PowerPC family.</P>
<P ALIGN="JUSTIFY">‘-mavec’ Generate code for the Altivec unit.</P>
<P ALIGN="JUSTIFY">‘-mcom’ Allow common PPC instructions.</P>
<P ALIGN="JUSTIFY">‘-many’ Allows any PPC instruction.</P>
<P ALIGN="JUSTIFY">‘-sdreg=&lt;n&gt;’</P>
<P ALIGN="JUSTIFY">Sets small data base register to Rn.</P>
<P ALIGN="JUSTIFY">‘-sd2reg=&lt;n&gt;’</P>
<P ALIGN="JUSTIFY">Sets the 2nd small data base register to Rn.</P>
<P ALIGN="JUSTIFY">‘-opt-branch’</P>
<P ALIGN="JUSTIFY">Enables ’optimization’ of 16-bit branches into "B&lt;!cc&gt; $+8 ; B label" sequences</P>
<P ALIGN="JUSTIFY">when necessary.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>56</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">14.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend accepts PowerPC instructions as described in the instruction set manuals</P>
<P ALIGN="JUSTIFY">from IBM and Motorola (e.g. the PowerPC Programming Environments).</P>
<P ALIGN="JUSTIFY">The target address type is 32bit.</P>
<P ALIGN="JUSTIFY">Default alignment for sections and instructions is 4 bytes. Data is aligned to its natural</P>
<P ALIGN="JUSTIFY">alignment by default.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">14.4 Extensions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend provides the following specific extensions:</P>
<P ALIGN="JUSTIFY">-When not disabled by the option -no-regnames, the registers r0 - r31,</P>
<P ALIGN="JUSTIFY">f0 - f31, v0 - v31, cr0 - cr7, vrsave, sp, rtoc, fp, fpscr, xer, lr, ctr, and the</P>
<P ALIGN="JUSTIFY">symbols lt, gt, so and un will be predefined on startup and may be referenced</P>
<P ALIGN="JUSTIFY">by the program.</P>
<P ALIGN="JUSTIFY">This backend extends the selected syntax module by the following directives:</P>
<P ALIGN="JUSTIFY">.sdreg &lt;n&gt;</P>
<P ALIGN="JUSTIFY">Sets the small data base register to Rn.</P>
<P ALIGN="JUSTIFY">.sd2reg &lt;n&gt;</P>
<P ALIGN="JUSTIFY">Sets the 2nd small data base register to Rn.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">14.5 Optimizations</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend performs the following optimizations:</P>
<P ALIGN="JUSTIFY">-16-bit branches where the destination is out of range are translated</P>
<P ALIGN="JUSTIFY">into B&lt;!cc&gt; $+8 and a 26-bit unconditional branch.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">14.6 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None?</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">14.7 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 2002: instruction not supported on selected architecture</P>
<P ALIGN="JUSTIFY">- 2003: constant integer expression required</P>
<P ALIGN="JUSTIFY">- 2004: trailing garbage in operand</P>
<P ALIGN="JUSTIFY">- 2005: illegal operand type</P>
<P ALIGN="JUSTIFY">- 2006: missing closing parenthesis in load/store addressing mode</P>
<P ALIGN="JUSTIFY">- 2007: relocation does not allow hi/lo modifier</P>
<P ALIGN="JUSTIFY">- 2008: multiple relocation attributes</P>
<P ALIGN="JUSTIFY">- 2009: multiple hi/lo modifiers</P>
<P ALIGN="JUSTIFY">- 2010: data size %d not supported</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 14: PowerPC cpu module</P>
<P ALIGN="JUSTIFY">57</P>
<P ALIGN="JUSTIFY">- 2011: illegal relocation</P>
<P ALIGN="JUSTIFY">- 2012: relocation attribute not supported by operand</P>
<P ALIGN="JUSTIFY">- 2013: operand out of range: %ld (allowed: %ld to %ld)</P>
<P ALIGN="JUSTIFY">- 2014: not a valid register (0-31)</P>
<P ALIGN="JUSTIFY">- 2015: missing base register in load/store addressing mode</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>58</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 15: c16x/st10 cpu module</P>
<P ALIGN="JUSTIFY">59</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">15 c16x/st10 cpu module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter documents the Backend for the c16x/st10 microcontroller family.</P>
<P ALIGN="JUSTIFY">Note that this module is not yet fully completed!</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">15.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002-2004 by Volker Barthelmann.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">15.2 Additional options for this module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-no-translations’</P>
<P ALIGN="JUSTIFY">Do not translate between jump instructions. If the o set of a jmpr instruction</P>
<P ALIGN="JUSTIFY">is too large, it will not be translated to jmps but an error will be emitted.</P>
<P ALIGN="JUSTIFY">Also, jmpa will not be optimized to jmpr.</P>
<P ALIGN="JUSTIFY">The pseudo-instruction jmp will still be translated.</P>
<P ALIGN="JUSTIFY">‘-jmpa’ A jmp or jmpr instruction that is translated due to its o set being larger than</P>
<P ALIGN="JUSTIFY">8 bits will be translated to a jmpa rather than a jmps, if possible.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">15.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend accepts c16x/st10 instructions as described in the Infineon instruction set</P>
<P ALIGN="JUSTIFY">manuals.</P>
<P ALIGN="JUSTIFY">The target address type is 32bit.</P>
<P ALIGN="JUSTIFY">Default alignment for sections and instructions is 2 bytes.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">15.4 Extensions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend provides the following specific extensions:</P>
<P ALIGN="JUSTIFY">- There is a pseudo instruction jmp that will be translated either to a jmpr or</P>
<P ALIGN="JUSTIFY">jmpa instruction, depending on the o set.</P>
<P ALIGN="JUSTIFY">- The sfr pseudo opcode can be used to declare special function registers. It</P>
<P ALIGN="JUSTIFY">has two, three of four arguments. The first argument is the identifier to be</P>
<P ALIGN="JUSTIFY">declared as special function register. The second argument is either the 16bit</P>
<P ALIGN="JUSTIFY">sfr address or its 8bit base address (0xfe for normal sfrs and 0xf0 for extended</P>
<P ALIGN="JUSTIFY">special function registers). In the latter case, the third argument is the 8bit sfr</P>
<P ALIGN="JUSTIFY">number. If another argument is given, it specifies the bit-number in the sfr (i.e.</P>
<P ALIGN="JUSTIFY">the declaration declares a single bit).</P>
<P ALIGN="JUSTIFY">Example:</P>
<P ALIGN="JUSTIFY">.sfr zeros,0xfe,0x8e</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>60</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">- SEG and SOF can be used to obtain the segment or segment o set of a full</P>
<P ALIGN="JUSTIFY">address. Example:</P>
<P ALIGN="JUSTIFY">mov r3,#SEG farfunc</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">15.5 Optimizations</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend performs the following optimizations:</P>
<P ALIGN="JUSTIFY">- jmp is translated to jmpr, if possible. Also, if ‘-no-translations’ was not</P>
<P ALIGN="JUSTIFY">specified, jmpr and jmpa are translated.</P>
<P ALIGN="JUSTIFY">- Relative jump instructions with an o set that does not fit into 8 bits are trans-</P>
<P ALIGN="JUSTIFY">lated to a jmps instruction or an inverted jump around a jmps instruction.</P>
<P ALIGN="JUSTIFY">- For instruction that have two forms gpr,#IMM3/4 and reg,#IMM16 the smaller</P>
<P ALIGN="JUSTIFY">form is used, if possible.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">15.6 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- Lots...</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">15.7 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">FIXME</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 16: 6502 cpu module</P>
<P ALIGN="JUSTIFY">61</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">16 6502 cpu module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter documents the backend for the MOS/Rockwell 6502 microprocessor family.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">16.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2002,2006,2008,2009 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">16.2 Additional options for this module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-opt-branch’</P>
<P ALIGN="JUSTIFY">Enables ’optimization’ of B&lt;cc&gt; branches into "B&lt;!cc&gt; *+3 ; JMP label" se-</P>
<P ALIGN="JUSTIFY">quences when necessary.</P>
<P ALIGN="JUSTIFY">‘-illegal’</P>
<P ALIGN="JUSTIFY">Allow ’illegal’ 6502 instructions to be recognized.</P>
<P ALIGN="JUSTIFY">‘-dtv’ Recognize the three additional C64-DTV instructions.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">16.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend accepts 6502 family instructions as described in the instruction set reference</P>
<P ALIGN="JUSTIFY">manuals from MOS and Rockwell, which are valid for the following CPUs: 6502, 65C02,</P>
<P ALIGN="JUSTIFY">65CE02, 65C102, 65C112, 6503, 6504, 6505, 6507, 6508, 6509, 6510, 6511, 65F11, 6512 -</P>
<P ALIGN="JUSTIFY">6518, 65C00/21, 65C29, 6570, 6571, 6280, 6702, 740, 7501, 8500, 8502, 65802, 65816.</P>
<P ALIGN="JUSTIFY">The target address type is 16 bit.</P>
<P ALIGN="JUSTIFY">Instructions consist of one up to three bytes and require no alignment. There is also no</P>
<P ALIGN="JUSTIFY">alignment requirement for sections and data.</P>
<P ALIGN="JUSTIFY">All known mnemonics for illegal instructions are recognized (e.g. dcm and dcp refer to the</P>
<P ALIGN="JUSTIFY">same instruction). Some illegal insructions (e.g. $ab) are known to show unpredictable</P>
<P ALIGN="JUSTIFY">behaviour, or do not always work the same on di erent CPUs.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">16.4 Extensions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend provides the following specific extensions:</P>
<P ALIGN="JUSTIFY">- The parser understands a lo/hi-modifier to select low- or high-byte of a 16-bit word.</P>
<P ALIGN="JUSTIFY">The character &lt; is used to select the low-byte and &gt; for the high-byte. It has to be the</P>
<P ALIGN="JUSTIFY">first character before an expression.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">16.5 Optimizations</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend performs the following operand optimizations:</P>
<P ALIGN="JUSTIFY">- Branches where the destination is out of range are translated into B&lt;!cc&gt; *+3 and an</P>
<P ALIGN="JUSTIFY">absolute JMP instruction.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>62</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">16.6 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- None?</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">16.7 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 2001: instruction not supported on selected architecture</P>
<P ALIGN="JUSTIFY">- 2002: trailing garbage in operand</P>
<P ALIGN="JUSTIFY">- 2003: missing closing parenthesis in addressing mode</P>
<P ALIGN="JUSTIFY">- 2004: data size %d not supported</P>
<P ALIGN="JUSTIFY">- 2005: relocation does not allow hi/lo modifier</P>
<P ALIGN="JUSTIFY">- 2006: operand doesn’t fit into 8-bits</P>
<P ALIGN="JUSTIFY">- 2007: branch destination out of range</P>
<P ALIGN="JUSTIFY">- 2008: illegal relocation</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 17: ARM cpu module</P>
<P ALIGN="JUSTIFY">63</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">17 ARM cpu module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter documents the backend for the Advanced RISC Machine (ARM) microproces-</P>
<P ALIGN="JUSTIFY">sor family.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">17.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2004,2006 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">17.2 Additional options for this module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-m2’ Generate code for the ARM2 CPU.</P>
<P ALIGN="JUSTIFY">‘-m250’ Generate code for the ARM250 CPU.</P>
<P ALIGN="JUSTIFY">‘-m3’ Generate code for the ARM3 CPU.</P>
<P ALIGN="JUSTIFY">‘-m6’ Generate code for the ARM6 CPU.</P>
<P ALIGN="JUSTIFY">‘-m600’ Generate code for the ARM600 CPU.</P>
<P ALIGN="JUSTIFY">‘-m610’ Generate code for the ARM610 CPU.</P>
<P ALIGN="JUSTIFY">‘-m7’ Generate code for the ARM7 CPU.</P>
<P ALIGN="JUSTIFY">‘-m710’ Generate code for the ARM710 CPU.</P>
<P ALIGN="JUSTIFY">‘-m7500’ Generate code for the ARM7500 CPU.</P>
<P ALIGN="JUSTIFY">‘-m7d’ Generate code for the ARM7d CPU.</P>
<P ALIGN="JUSTIFY">‘-m7di’ Generate code for the ARM7di CPU.</P>
<P ALIGN="JUSTIFY">‘-m7dm’ Generate code for the ARM7dm CPU.</P>
<P ALIGN="JUSTIFY">‘-m7dmi’ Generate code for the ARM7dmi CPU.</P>
<P ALIGN="JUSTIFY">‘-m7tdmi’ Generate code for the ARM7tdmi CPU.</P>
<P ALIGN="JUSTIFY">‘-m8’ Generate code for the ARM8 CPU.</P>
<P ALIGN="JUSTIFY">‘-m810’ Generate code for the ARM810 CPU.</P>
<P ALIGN="JUSTIFY">‘-m9’ Generate code for the ARM9 CPU.</P>
<P ALIGN="JUSTIFY">‘-m9’ Generate code for the ARM9 CPU.</P>
<P ALIGN="JUSTIFY">‘-m920’ Generate code for the ARM920 CPU.</P>
<P ALIGN="JUSTIFY">‘-m920t’ Generate code for the ARM920t CPU.</P>
<P ALIGN="JUSTIFY">‘-m9tdmi’ Generate code for the ARM9tdmi CPU.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>64</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">‘-msa1’ Generate code for the SA1 CPU.</P>
<P ALIGN="JUSTIFY">‘-mstrongarm’</P>
<P ALIGN="JUSTIFY">Generate code for the STRONGARM CPU.</P>
<P ALIGN="JUSTIFY">‘-mstrongarm110’</P>
<P ALIGN="JUSTIFY">Generate code for the STRONGARM110 CPU.</P>
<P ALIGN="JUSTIFY">‘-mstrongarm1100’</P>
<P ALIGN="JUSTIFY">Generate code for the STRONGARM1100 CPU.</P>
<P ALIGN="JUSTIFY">‘-a2’ Generate code compatible with ARM V2 architecture.</P>
<P ALIGN="JUSTIFY">‘-a3’ Generate code compatible with ARM V3 architecture.</P>
<P ALIGN="JUSTIFY">‘-a3m’ Generate code compatible with ARM V3m architecture.</P>
<P ALIGN="JUSTIFY">‘-a4’ Generate code compatible with ARM V4 architecture.</P>
<P ALIGN="JUSTIFY">‘-a4t’ Generate code compatible with ARM V4t architecture.</P>
<P ALIGN="JUSTIFY">‘-little’ Output little-endian code and data (default).</P>
<P ALIGN="JUSTIFY">‘-big’ Output big-endian code and data.</P>
<P ALIGN="JUSTIFY">‘-thumb’ Start assembling in Thumb mode.</P>
<P ALIGN="JUSTIFY">‘-opt-ldrpc’</P>
<P ALIGN="JUSTIFY">The maximum range in which PC-relative symbols can be accessed through</P>
<P ALIGN="JUSTIFY">LDR and STR is extended from +/-4KB to +/-1MB (or +/-256 Bytes to +/-65536</P>
<P ALIGN="JUSTIFY">Bytes when accessing half-words). This is done by automatically inserting an</P>
<P ALIGN="JUSTIFY">additional ADD or SUB instruction before the LDR/STR.</P>
<P ALIGN="JUSTIFY">‘-opt-adr’</P>
<P ALIGN="JUSTIFY">The ADR directive will be automatically converted into ADRL if required (which</P>
<P ALIGN="JUSTIFY">inserts an additional ADD/SUB to calculate an address).</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">17.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend accepts ARM instructions as described in various ARM CPU data sheets. Ad-</P>
<P ALIGN="JUSTIFY">ditionally some architectures support a second, more dense, instruction set, called THUMB.</P>
<P ALIGN="JUSTIFY">There are special directives to switch between those two instruction sets.</P>
<P ALIGN="JUSTIFY">The target address type is 32bit.</P>
<P ALIGN="JUSTIFY">Default alignment for instructions is 4 bytes for ARM and 2 bytes for THUMB. Sections</P>
<P ALIGN="JUSTIFY">will be aligned to 4 bytes by default. Data is aligned to its natural alignment by default.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">17.4 Extensions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend extends the selected syntax module by the following directives:</P>
<P ALIGN="JUSTIFY">.arm Generate 32-bit ARM code.</P>
<P ALIGN="JUSTIFY">.thumb Generate 16-bit THUMB code.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 17: ARM cpu module</P>
<P ALIGN="JUSTIFY">65</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">17.5 Optimizations</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend performs the following optimizations and translations for the ARM instruction</P>
<P ALIGN="JUSTIFY">set:</P>
<P ALIGN="JUSTIFY">- LDR/STR Rd,symbol, with a distance between symbol and PC larger than 4KB, is</P>
<P ALIGN="JUSTIFY">translated to ADD/SUB Rd,PC,#offset&amp;0xff000 + LDR/STR Rd,[Rd,#offset&amp;0xfff],</P>
<P ALIGN="JUSTIFY">when allowed by the option -opt-ldrpc.</P>
<P ALIGN="JUSTIFY">- ADR Rd,symbol is translated to ADD/SUB Rd,PC,#rotated_offset8.</P>
<P ALIGN="JUSTIFY">- ADRL Rd,symbol is translated to ADD/SUB Rd,PC,#hi_rotated8 + ADD/SUB</P>
<P ALIGN="JUSTIFY">Rd,Rd,#lo_rotated8. ADR will be automatically treated as ADRL when required and</P>
<P ALIGN="JUSTIFY">when allowed by the option -opt-adr.</P>
<P ALIGN="JUSTIFY">- The immediate operand of ALU-instructions will be translated into the appropriate</P>
<P ALIGN="JUSTIFY">8-bit-rotated value. When rotation alone doesn’t succeed the backed will try it with</P>
<P ALIGN="JUSTIFY">inverted and negated values (inverting/negating the ALU-instruction too).</P>
<P ALIGN="JUSTIFY">For the THUMB instruction set the following optimizations and translations are done:</P>
<P ALIGN="JUSTIFY">- A conditional branch with a branch-destination being out of range is translated into</P>
<P ALIGN="JUSTIFY">B&lt;!cc&gt; .+4 + B label.</P>
<P ALIGN="JUSTIFY">- The BL instruction is translated into two sub-instructions combining the high- and low</P>
<P ALIGN="JUSTIFY">22 bit of the branch displacement.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">17.6 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- Only instruction sets up to ARM architecture V4t are supported.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">17.7 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 2001: instruction not supported on selected architecture</P>
<P ALIGN="JUSTIFY">- 2002: trailing garbage in operand</P>
<P ALIGN="JUSTIFY">- 2003: label from current section required</P>
<P ALIGN="JUSTIFY">- 2004: branch o set (%ld) is out of range</P>
<P ALIGN="JUSTIFY">- 2005: PC-relative load/store (o set %ld) out of range</P>
<P ALIGN="JUSTIFY">- 2006: cannot make rotated immediate from PC-relative o set (0x%lx)</P>
<P ALIGN="JUSTIFY">- 2007: constant integer expression required</P>
<P ALIGN="JUSTIFY">- 2008: constant (0x%lx) not suitable for 8-bit rotated immediate</P>
<P ALIGN="JUSTIFY">- 2009: branch to an unaligned address (o set %ld)</P>
<P ALIGN="JUSTIFY">- 2010: not a valid ARM register</P>
<P ALIGN="JUSTIFY">- 2011: PC (r15) not allowed in this mode</P>
<P ALIGN="JUSTIFY">- 2012: PC (r15) not allowed for o set register Rm</P>
<P ALIGN="JUSTIFY">- 2013: PC (r15) not allowed with write-back</P>
<P ALIGN="JUSTIFY">- 2014: register r%ld was used multiple times</P>
<P ALIGN="JUSTIFY">- 2015: illegal immediate shift count (%ld)</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>66</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">- 2016: not a valid shift register</P>
<P ALIGN="JUSTIFY">- 2017: 24-bit unsigned immediate expected</P>
<P ALIGN="JUSTIFY">- 2018: data size %d not supported</P>
<P ALIGN="JUSTIFY">- 2019: illegal addressing mode: %s</P>
<P ALIGN="JUSTIFY">- 2020: signed/halfword ldr/str doesn’t support shifts</P>
<P ALIGN="JUSTIFY">- 2021: %d-bit immediate o set out of range (%ld)</P>
<P ALIGN="JUSTIFY">- 2022: post-indexed addressing mode exptected</P>
<P ALIGN="JUSTIFY">- 2023: operation not allowed on external symbols</P>
<P ALIGN="JUSTIFY">- 2024: ldc/stc o set has to be a multiple of 4</P>
<P ALIGN="JUSTIFY">- 2025: illegal coprocessor operation mode or type: %ld\n</P>
<P ALIGN="JUSTIFY">- 2026: %d-bit unsigned immediate o set out of range (%ld)</P>
<P ALIGN="JUSTIFY">- 2027: o set has to be a multiple of %d</P>
<P ALIGN="JUSTIFY">- 2028: instruction at unaligned address</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 18: 80x86 cpu module</P>
<P ALIGN="JUSTIFY">67</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">18 80x86 cpu module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter documents the Backend for the 80x86 microprocessor family.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">18.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is written in 2005-2006 by Frank Wille.</P>
<P ALIGN="JUSTIFY">This archive may be redistributed without modifications and used for non-commercial pur-</P>
<P ALIGN="JUSTIFY">poses.</P>
<P ALIGN="JUSTIFY">Distributing modified versions and commercial usage needs my written consent.</P>
<P ALIGN="JUSTIFY">Certain modules may fall under additional copyrights.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">18.2 Additional options for this module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-m8086’ Generate code for the 8086 CPU.</P>
<P ALIGN="JUSTIFY">‘-mi186’ Generate code for the 80186 CPU.</P>
<P ALIGN="JUSTIFY">‘-mi286’ Generate code for the 80286 CPU.</P>
<P ALIGN="JUSTIFY">‘-mi386’ Generate code for the 80386 CPU.</P>
<P ALIGN="JUSTIFY">‘-mi486’ Generate code for the 80486 CPU.</P>
<P ALIGN="JUSTIFY">‘-mi586’ Generate code for the Pentium.</P>
<P ALIGN="JUSTIFY">‘-mi686’ Generate code for the PentiumPro.</P>
<P ALIGN="JUSTIFY">‘-mpentium’</P>
<P ALIGN="JUSTIFY">Generate code for the Pentium.</P>
<P ALIGN="JUSTIFY">‘-mpentiumpro’</P>
<P ALIGN="JUSTIFY">Generate code for the PentiumPro.</P>
<P ALIGN="JUSTIFY">‘-mk6’ Generate code for the AMD K6.</P>
<P ALIGN="JUSTIFY">‘-mathlon’</P>
<P ALIGN="JUSTIFY">Generate code for the AMD Athlon.</P>
<P ALIGN="JUSTIFY">‘-msledgehammer’</P>
<P ALIGN="JUSTIFY">Generate code for the Sledgehammer CPU.</P>
<P ALIGN="JUSTIFY">‘-debug=&lt;n&gt;’</P>
<P ALIGN="JUSTIFY">Enables debugging output.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">18.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend accepts 80x86 instructions as described in the Intel Architecture Software</P>
<P ALIGN="JUSTIFY">Developer’s Manual.</P>
<P ALIGN="JUSTIFY">The target address type is 32bit.</P>
<P ALIGN="JUSTIFY">Default alignment for sections is 4 bytes. Instructions do not need any alignment. Data is</P>
<P ALIGN="JUSTIFY">aligned to its natural alignment by default.</P>
<P ALIGN="JUSTIFY">The backend uses MIT-syntax! This means the left operands are always the source and</P>
<P ALIGN="JUSTIFY">the right operand is the destination. Also register names have to be prefixed by a ’%’.</P>
<P ALIGN="JUSTIFY">Operation size is indicated by a ’b’, ’w’, ’l’, etc. su x behind the mnemonic.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>68</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">18.4 Extensions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Predefined register symbols in this backend:</P>
<P ALIGN="JUSTIFY">-8-bit registers: al cl dl bl ah ch dh bh axl cxl dxl spl bpl sil dil r8b r9b r10b</P>
<P ALIGN="JUSTIFY">r11b r12b r13b r14b r15b</P>
<P ALIGN="JUSTIFY">-16-bit registers: ax cx dx bx sp bp si di r8w r9w r10w r11w r12w r13w r14w r15w</P>
<P ALIGN="JUSTIFY">-32-bit registers: eax ecx edx ebx esp ebp esi edi r8d r9d r10d r11d r12d r13d r14d</P>
<P ALIGN="JUSTIFY">r15d</P>
<P ALIGN="JUSTIFY">-64-bit registers: rax rcx rdx rbx rsp ebp rsi rdi r8 r9 r10 r11 r12 r13 r14 r15</P>
<P ALIGN="JUSTIFY">-segment registers: es cs ss ds fs gs</P>
<P ALIGN="JUSTIFY">-control registers: cr0 cr1 cr2 cr3 cr4 cr5 cr6 cr7 cr8 cr9 cr10 cr11 cr12 cr13 cr14</P>
<P ALIGN="JUSTIFY">cr15</P>
<P ALIGN="JUSTIFY">-debug registers: dr0 dr1 dr2 dr3 dr4 dr5 dr6 dr7 dr8 dr9 dr10 dr11 dr12 dr13 dr14</P>
<P ALIGN="JUSTIFY">dr15</P>
<P ALIGN="JUSTIFY">-test registers: tr0 tr1 tr2 tr3 tr4 tr5 tr6 tr7</P>
<P ALIGN="JUSTIFY">-MMX and SIMD registers: mm0 mm1 mm2 mm3 mm4 mm5 mm6 mm7 xmm0 xmm1 xmm2 xmm3</P>
<P ALIGN="JUSTIFY">xmm4 xmm5 xmm6 xmm7 xmm8 xmm9 xmm10 xmm11 xmm12 xmm13 xmm14 xmm15</P>
<P ALIGN="JUSTIFY">-FPU registers: st st(0) st(1) st(2) st(3) st(4) st(5) st(6) st(7)</P>
<P ALIGN="JUSTIFY">This backend extends the selected syntax module by the following directives:</P>
<P ALIGN="JUSTIFY">.code16 Sets the assembler into 16-bit addressing mode.</P>
<P ALIGN="JUSTIFY">.code32 Sets the assembler into 32-bit addressing mode, which is the default.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">18.5 Optimizations</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend performs the following optimizations:</P>
<P ALIGN="JUSTIFY">-Immediate operands are optimized to the smallest size which can</P>
<P ALIGN="JUSTIFY">still represent the absolute value.</P>
<P ALIGN="JUSTIFY">-Displacement operands are optimized to the smallest size which</P>
<P ALIGN="JUSTIFY">can still represent the absolute value.</P>
<P ALIGN="JUSTIFY">-Jump instructions are optimized to 8-bit displacements, when possible.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">18.6 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- 64-bit operations are disabled at the moment.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">18.7 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 2001: instruction not supported on selected architecture</P>
<P ALIGN="JUSTIFY">- 2002: trailing garbage in operand</P>
<P ALIGN="JUSTIFY">- 2003: same type of prefix used twice</P>
<P ALIGN="JUSTIFY">- 2004: immediate operand illegal with absolute jump</P>
<P ALIGN="JUSTIFY">- 2005: base register expected</P>
<P ALIGN="JUSTIFY">- 2006: scale factor without index register</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 18: 80x86 cpu module</P>
<P ALIGN="JUSTIFY">69</P>
<P ALIGN="JUSTIFY">- 2007: missing ’)’ in baseindex addressing mode</P>
<P ALIGN="JUSTIFY">- 2008: redundant %s prefix ignored</P>
<P ALIGN="JUSTIFY">- 2009: unknown register specified</P>
<P ALIGN="JUSTIFY">- 2010: using register %%%s instead of %%%s due to ’%c’ su x</P>
<P ALIGN="JUSTIFY">- 2011: %%%s not allowed with ’%c’ su x</P>
<P ALIGN="JUSTIFY">- 2012: illegal su x ’%c’</P>
<P ALIGN="JUSTIFY">- 2013: instruction has no su x and no register operands - size is unknown</P>
<P ALIGN="JUSTIFY">- 2014: illegal relocation</P>
<P ALIGN="JUSTIFY">- 2015: memory operand expected</P>
<P ALIGN="JUSTIFY">- 2016: you cannot pop %%%s</P>
<P ALIGN="JUSTIFY">- 2017: translating to %s %%%s,%%%s</P>
<P ALIGN="JUSTIFY">- 2018: translating to %s %%%s</P>
<P ALIGN="JUSTIFY">- 2019: absolute scale factor required</P>
<P ALIGN="JUSTIFY">- 2020: illegal scale factor (valid: 1,2,4,8)</P>
<P ALIGN="JUSTIFY">- 2021: data objects with %d bits size are not supported</P>
<P ALIGN="JUSTIFY">- 2022: need at least %d bits for a relocatable symbol</P>
<P ALIGN="JUSTIFY">- 2023: pc-relative jump destination out of range (%lld)</P>
<P ALIGN="JUSTIFY">- 2024: instruction doesn’t support these operand sizes</P>
<P ALIGN="JUSTIFY">- 2025: cannot determine immediate operand size without a su x</P>
<P ALIGN="JUSTIFY">- 2026: displacement doesn’t fit into %d bits</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>70</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 19: z80 cpu module</P>
<P ALIGN="JUSTIFY">71</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">19 z80 cpu module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter documents the backend for the 8080/z80/gbz80/64180/RCMx000 micropro-</P>
<P ALIGN="JUSTIFY">cessor family.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">19.1 Legal</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module is copyright in 2009 by Dominic Morris</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">19.2 Additional options for this module</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module provides the following additional options:</P>
<P ALIGN="JUSTIFY">‘-swapixiy’</P>
<P ALIGN="JUSTIFY">Swaps the usage of ix and iy registers. This is useful for compiling generic code</P>
<P ALIGN="JUSTIFY">that uses an index register that is reserved on the target machine.</P>
<P ALIGN="JUSTIFY">‘-8080’ Turns on 8080 compatibility mode. Any use of z80 (or higher) opcodes will</P>
<P ALIGN="JUSTIFY">result in an error being generated.</P>
<P ALIGN="JUSTIFY">‘-hd64180’</P>
<P ALIGN="JUSTIFY">Turns on 64180 mode supporting additional 64180 opcodes.</P>
<P ALIGN="JUSTIFY">‘-gbz80’ Turns on gbz80 compatibility mode. Any use of non-supported opcodes will</P>
<P ALIGN="JUSTIFY">result in an error being generated.</P>
<P ALIGN="JUSTIFY">‘-rcm2000’</P>
<P ALIGN="JUSTIFY">‘-rcm3000’</P>
<P ALIGN="JUSTIFY">‘-rcm4000’</P>
<P ALIGN="JUSTIFY">Turns on Rabbit compatibility mode, generating the correct codes for moved</P>
<P ALIGN="JUSTIFY">opcodes and supporting the additional Rabbit instructions. In this mode, 8 bit</P>
<P ALIGN="JUSTIFY">access to the 16 bit index registers is not permitted.</P>
<P ALIGN="JUSTIFY">‘-rcmemu’ Turns on emulation of some instructions which aren’t available on the Rabbit</P>
<P ALIGN="JUSTIFY">processors.</P>
<P ALIGN="JUSTIFY">‘-z80asm’ Switches on z80asm mode, this translates ASMPC to $ and accepts some pseudo</P>
<P ALIGN="JUSTIFY">opcodes that z80asm supports. Most emulation of z80asm directives is provided</P>
<P ALIGN="JUSTIFY">by the oldsyntax syntax module.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">19.3 General</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend accepts z80 family instructions in standard Zilog syntax. Rabbit opcodes are</P>
<P ALIGN="JUSTIFY">accepted as defined in the publically available reference material from Rabbit Semiconduc-</P>
<P ALIGN="JUSTIFY">tor, with the exception that the ljp and lcall opcodes need to be supplied with a 24 bit</P>
<P ALIGN="JUSTIFY">number rather than an 8 bit xpc and a 16 bit address.</P>
<P ALIGN="JUSTIFY">The target address type is 16 bit.</P>
<P ALIGN="JUSTIFY">Instructions consist of one up to six bytes and require no alignment. There is also no</P>
<P ALIGN="JUSTIFY">alignment requirement for sections and data.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">19.4 Extensions</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Certain Rabbit opcodes can be prefixed by the altd and/or the ioi/ioe modifier. For details</P>
<P ALIGN="JUSTIFY">of which instructions these are valid for please see the documentation from Rabbit.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>72</P>
<P ALIGN="JUSTIFY">vasm manual</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">19.5 Optimisations</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This backend supports the emulation of certain z80 instructions on the Rabbit/gbz80 pro-</P>
<P ALIGN="JUSTIFY">cessor. These instructions are rld, rrd, cpi, cpir, cpd and cpdr. The link stage should provide</P>
<P ALIGN="JUSTIFY">routines with the opcode name prefixed with rcmx (eg rcmx rld) which implements the</P>
<P ALIGN="JUSTIFY">same functionality. Example implementations are available within the z88dk CVS tree.</P>
<P ALIGN="JUSTIFY">Additionally, for the Rabbit targets the missing call cc, opcodes will be emulated.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">19.6 Known Problems</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Some known problems of this module at the moment:</P>
<P ALIGN="JUSTIFY">- Not all RCM4000 opcodes are supported (llcall, lljp are not available).</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">19.7 Error Messages</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This module has the following error messages:</P>
<P ALIGN="JUSTIFY">- 2001: index o set out of bounds (%d)</P>
<P ALIGN="JUSTIFY">- 2002: Opcode not supported by %s (%s)</P>
<P ALIGN="JUSTIFY">- 2003: Index registers not available on 8080</P>
<P ALIGN="JUSTIFY">- 2004: out of range for 8 bit expression (%d)</P>
<P ALIGN="JUSTIFY">- 2005: invalid bit number (%d) should be in range 0..7</P>
<P ALIGN="JUSTIFY">- 2006: rst value out of range (%d/0x%02x)</P>
<P ALIGN="JUSTIFY">- 2007: %s value out of range (%d)</P>
<P ALIGN="JUSTIFY">- 2008: index o set should be a constant</P>
<P ALIGN="JUSTIFY">- 2009: invalid branch type for jr</P>
<P ALIGN="JUSTIFY">- 2010: Rabbit target doesn’t support rst %d</P>
<P ALIGN="JUSTIFY">- 2011: Rabbit target doesn’t support 8 bit index registers</P>
<P ALIGN="JUSTIFY">- 2012: z180 target doesn’t support 8 bit index registers</P>
<P ALIGN="JUSTIFY">- 2013: invalid branch type for jre</P>
<P ALIGN="JUSTIFY">- 2014: Opcode not supported by %s (%s) but it can be emulated (-rcmemu)</P>
<P ALIGN="JUSTIFY">- 2015: %s specifier is only valid for Rabbit processors</P>
<P ALIGN="JUSTIFY">- 2016: Only one of ioi and ioe can be specified at a time</P>
<P ALIGN="JUSTIFY">- 2017: %s specifier is not valid for the opcode %s</P>
<P ALIGN="JUSTIFY">- 2018: %s specifier redundant for the opcode %s</P>
<P ALIGN="JUSTIFY">- 2019: %s specifier has no e ect on the opcode %s</P>
<P ALIGN="JUSTIFY">- 2020: Operand value must evaluate to a constant for opcode %s</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 20: Interface</P>
<P ALIGN="JUSTIFY">73</P>
</FONT><FONT SIZE=6><P ALIGN="JUSTIFY">20 Interface</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.1 Introduction</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This chapter is under construction!</P>
<P ALIGN="JUSTIFY">This chapter describes some of the internals of vasm and tries to explain what has to be</P>
<P ALIGN="JUSTIFY">done to write a cpu module, a syntax module or an output module for vasm. However if</P>
<P ALIGN="JUSTIFY">someone wants to write one, I suggest to contact me first, so that it can be integrated into</P>
<P ALIGN="JUSTIFY">the source tree.</P>
<P ALIGN="JUSTIFY">Note that this documentation may mention explicit values when introducing symbolic con-</P>
<P ALIGN="JUSTIFY">stants. This is due to copying and pasting from the source code. These values may not be</P>
<P ALIGN="JUSTIFY">up to date and in some cases can be overridden. Therefore do never use the absolute values</P>
<P ALIGN="JUSTIFY">but rather the symbolic representations.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.2 Building vasm</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This section deals with the steps necessary to build the typical vasm executable from the</P>
<P ALIGN="JUSTIFY">sources.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.2.1 Directory Structure</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The vasm-directory contains the following important files and directories:</P>
<P ALIGN="JUSTIFY">‘vasm/’ The main directory containing the assembler sources.</P>
<P ALIGN="JUSTIFY">‘vasm/Makefile’</P>
<P ALIGN="JUSTIFY">The Makefile used to build vasm.</P>
<P ALIGN="JUSTIFY">‘vasm/syntax/&lt;syntax-module&gt;/’</P>
<P ALIGN="JUSTIFY">Directories for the syntax modules.</P>
<P ALIGN="JUSTIFY">‘vasm/cpus/&lt;cpu-module&gt;/’</P>
<P ALIGN="JUSTIFY">Directories for the cpu modules.</P>
<P ALIGN="JUSTIFY">‘vasm/obj/’</P>
<P ALIGN="JUSTIFY">Directory the object modules will be stored in.</P>
<P ALIGN="JUSTIFY">All compiling is done from the main directory and the executables will be placed there</P>
<P ALIGN="JUSTIFY">as well. The main assembler for a combination of &lt;cpu&gt; and &lt;syntax&gt; will be called</P>
<P ALIGN="JUSTIFY">vasm&lt;cpu&gt;_&lt;syntax&gt;. All output modules are usually integrated in every executable and</P>
<P ALIGN="JUSTIFY">can be selected at runtime.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.2.2 Adapting the Makefile</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Before building anything you have to insert correct values for your compiler and operating</P>
<P ALIGN="JUSTIFY">system in the ‘Makefile’.</P>
<P ALIGN="JUSTIFY">TARGET Here you may define an extension which is appended to the executable’s name.</P>
<P ALIGN="JUSTIFY">Useful, if you build various targets in the same directory.</P>
<P ALIGN="JUSTIFY">TARGETEXTENSION</P>
<P ALIGN="JUSTIFY">Defines the file name extension for executable files. Not needed for most oper-</P>
<P ALIGN="JUSTIFY">ating systems. For Windows it would be ‘.exe’.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>74</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">CC Here you have to insert a command that invokes an ANSI C compiler you want</P>
<P ALIGN="JUSTIFY">to use to build vasm. It must support the ‘-I’ option the same like e.g. vc or</P>
<P ALIGN="JUSTIFY">gcc.</P>
<P ALIGN="JUSTIFY">COPTS Here you will usually define an option like ‘-c’ to instruct the compiler to</P>
<P ALIGN="JUSTIFY">generate an object file. Additional options, like the optimization level, should</P>
<P ALIGN="JUSTIFY">also be inserted here as well. E.g. if you are compiling for the Amiga with vbcc</P>
<P ALIGN="JUSTIFY">you should add ‘-DAMIGA’.</P>
<P ALIGN="JUSTIFY">CCOUT Here you define the option which is used to specify the name of an output file,</P>
<P ALIGN="JUSTIFY">which is usually ‘-o’.</P>
<P ALIGN="JUSTIFY">LD Here you insert a command which starts the linker. This may be the the same</P>
<P ALIGN="JUSTIFY">as under CC.</P>
<P ALIGN="JUSTIFY">LDFLAGS Here you have to add options which are necessary for linking. E.g. some</P>
<P ALIGN="JUSTIFY">compilers need special libraries for  oating-point.</P>
<P ALIGN="JUSTIFY">LDOUT Here you define the option which is used by the linker to specify the output file</P>
<P ALIGN="JUSTIFY">name.</P>
<P ALIGN="JUSTIFY">RM Specify a command to delete a file, e.g. rm -f.</P>
<P ALIGN="JUSTIFY">An example for the Amiga using vbcc would be:</P>
<P ALIGN="JUSTIFY">TARGET = _os3</P>
<P ALIGN="JUSTIFY">TARGETEXTENSION =</P>
<P ALIGN="JUSTIFY">CC = vc +aos68k</P>
<P ALIGN="JUSTIFY">CCOUT = -o</P>
<P ALIGN="JUSTIFY">COPTS = -c -c99 -cpu=68020 -DAMIGA -O1</P>
<P ALIGN="JUSTIFY">LD = $(CC)</P>
<P ALIGN="JUSTIFY">LDOUT = $(CCOUT)</P>
<P ALIGN="JUSTIFY">LDFLAGS = -lmieee</P>
<P ALIGN="JUSTIFY">RM = delete force quiet</P>
<P ALIGN="JUSTIFY">An example for a typical Unix-installation would be:</P>
<P ALIGN="JUSTIFY">TARGET =</P>
<P ALIGN="JUSTIFY">TARGETEXTENSION =</P>
<P ALIGN="JUSTIFY">CC = gcc</P>
<P ALIGN="JUSTIFY">CCOUT = -o</P>
<P ALIGN="JUSTIFY">COPTS = -c -O2</P>
<P ALIGN="JUSTIFY">LD = $(CC)</P>
<P ALIGN="JUSTIFY">LDOUT = $(CCOUT)</P>
<P ALIGN="JUSTIFY">LDFLAGS = -lm</P>
<P ALIGN="JUSTIFY">RM = rm -f</P>
<P ALIGN="JUSTIFY">Open/Net/Free/Any BSD i386 systems will probably require the following an additional</P>
<P ALIGN="JUSTIFY">‘-D_ANSI_SOURCE’ in COPTS.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.2.3 Building vasm</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Note to users of Open/Free/Any BSD i386 systems: You will probably have to use GNU</P>
<P ALIGN="JUSTIFY">make instead of BSD make, i.e. in the following examples replace "make" with "gmake".</P>
<P ALIGN="JUSTIFY">Type:</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 20: Interface</P>
<P ALIGN="JUSTIFY">75</P>
<P ALIGN="JUSTIFY">make CPU=&lt;cpu&gt; SYNTAX=&lt;syntax&gt;</P>
<P ALIGN="JUSTIFY">For example:</P>
<P ALIGN="JUSTIFY">make CPU=ppc SYNTAX=std</P>
<P ALIGN="JUSTIFY">For Windows and various Amiga targets there are already Makefiles included, which you</P>
<P ALIGN="JUSTIFY">may either copy on top of the default ‘Makefile’, or call it explicitely with make’s ‘-f’</P>
<P ALIGN="JUSTIFY">option:</P>
<P ALIGN="JUSTIFY">make -f Makefile.OS4 CPU=ppc SYNTAX=std</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.3 General data structures</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">This section describes the fundamental data structures used in vasm which are usually</P>
<P ALIGN="JUSTIFY">necessary to understand for writing any kind of module (cpu, syntax or output). More</P>
<P ALIGN="JUSTIFY">detailed information is given in the respective sections on writing specific modules where</P>
<P ALIGN="JUSTIFY">necessary.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.3.1 Source</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">A source structure represents a source text module, which can be either the main source</P>
<P ALIGN="JUSTIFY">text, an included file or a macro. There is always a link to the parent source from where</P>
<P ALIGN="JUSTIFY">the current source context was included or called.</P>
<P ALIGN="JUSTIFY">struct source *parent;</P>
<P ALIGN="JUSTIFY">Pointer to the parent source context. Assembly continues there when the cur-</P>
<P ALIGN="JUSTIFY">rent source context ends.</P>
<P ALIGN="JUSTIFY">int parent_line;</P>
<P ALIGN="JUSTIFY">Line number in the parent source context, from where we were called. This</P>
<P ALIGN="JUSTIFY">information is needed, because line numbers are only reliable during parsing</P>
<P ALIGN="JUSTIFY">and later from the atoms. But an include directive doesn’t create an atom.</P>
<P ALIGN="JUSTIFY">char *name;</P>
<P ALIGN="JUSTIFY">File name of the main source or include file, or macro name.</P>
<P ALIGN="JUSTIFY">char *text;</P>
<P ALIGN="JUSTIFY">Pointer to the source text start.</P>
<P ALIGN="JUSTIFY">size_t size;</P>
<P ALIGN="JUSTIFY">Size of the source text to assemble in bytes.</P>
<P ALIGN="JUSTIFY">unsigned long repeat;</P>
<P ALIGN="JUSTIFY">Number of repetitions of this source text. Usually this is 1, but for text blocks</P>
<P ALIGN="JUSTIFY">between a rept and endr directive, it allows any number of repetitions, which</P>
<P ALIGN="JUSTIFY">is decremented everytime the end of this source text block is reached.</P>
<P ALIGN="JUSTIFY">int cond_level;</P>
<P ALIGN="JUSTIFY">Current level of conditional nesting while calling this macro. The level is pro-</P>
<P ALIGN="JUSTIFY">vided by the syntax module through execute_macro(). The syntax module</P>
<P ALIGN="JUSTIFY">may use this information to restore the last valid level when exiting a macro in</P>
<P ALIGN="JUSTIFY">the middle.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>76</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">int num_params;</P>
<P ALIGN="JUSTIFY">Number of macro parameters passed at the invocation point from the parent</P>
<P ALIGN="JUSTIFY">source. For normal source files this entry will be -1. For macros 0 (no parame-</P>
<P ALIGN="JUSTIFY">ters) or higher.</P>
<P ALIGN="JUSTIFY">char *param[MAXMACPARAMS];</P>
<P ALIGN="JUSTIFY">Pointer to the macro parameters. Parameter 0 is usually reserved for a special</P>
<P ALIGN="JUSTIFY">purpose, like an extension.</P>
<P ALIGN="JUSTIFY">int param_len[MAXMACPARAMS];</P>
<P ALIGN="JUSTIFY">Number of characters per macro parameter.</P>
<P ALIGN="JUSTIFY">unsigned long id;</P>
<P ALIGN="JUSTIFY">Every source has its unique id. Useful for macros supporting the special \@</P>
<P ALIGN="JUSTIFY">parameter.</P>
<P ALIGN="JUSTIFY">char *srcptr;</P>
<P ALIGN="JUSTIFY">The current source text pointer, pointing to the beginning of the next line to</P>
<P ALIGN="JUSTIFY">assemble.</P>
<P ALIGN="JUSTIFY">int line; Line number in the current source context. After parsing the line number of</P>
<P ALIGN="JUSTIFY">the current atom is stored here.</P>
<P ALIGN="JUSTIFY">char *linebuf;</P>
<P ALIGN="JUSTIFY">A MAXLINELENGTH bu er for the current line being assembled in this source</P>
<P ALIGN="JUSTIFY">text. A child-source, like a macro, can refer to arguments from this bu er, so</P>
<P ALIGN="JUSTIFY">every source has got its own. When returning to the parent source, the linebuf</P>
<P ALIGN="JUSTIFY">is deallocated to save memory.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.3.2 Sections</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">One of the top level structures is linked list of sections describing continuous blocks of</P>
<P ALIGN="JUSTIFY">memory. A section is specified by an object of type section with the following members</P>
<P ALIGN="JUSTIFY">that can be accessed by the modules:</P>
<P ALIGN="JUSTIFY">struct section *next;</P>
<P ALIGN="JUSTIFY">A pointer to the next section in the list.</P>
<P ALIGN="JUSTIFY">char *name;</P>
<P ALIGN="JUSTIFY">The name of the section.</P>
<P ALIGN="JUSTIFY">char *attr;</P>
<P ALIGN="JUSTIFY">A string describing the section  ags in ELF notation (see, for example, docu-</P>
<P ALIGN="JUSTIFY">mentation o the .section directive of the standard syntax mopdule.</P>
<P ALIGN="JUSTIFY">atom *first;</P>
<P ALIGN="JUSTIFY">atom *last;</P>
<P ALIGN="JUSTIFY">Pointers to the first and last atom of the section. See following sections for</P>
<P ALIGN="JUSTIFY">information on atoms.</P>
<P ALIGN="JUSTIFY">int align;</P>
<P ALIGN="JUSTIFY">Alignment of the section in bytes.</P>
<P ALIGN="JUSTIFY">int flags;</P>
<P ALIGN="JUSTIFY">Flags of the section. Currently available  ags are:</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 20: Interface</P>
<P ALIGN="JUSTIFY">77</P>
<P ALIGN="JUSTIFY">HAS_SYMBOLS</P>
<P ALIGN="JUSTIFY">At least one symbol is defined in this section.</P>
<P ALIGN="JUSTIFY">taddr org;</P>
<P ALIGN="JUSTIFY">Start address of a section. Usually zero.</P>
<P ALIGN="JUSTIFY">taddr pc; Current o set/program counter in this section. Can be used while traversing</P>
<P ALIGN="JUSTIFY">through section. Has to be updated by a module using it. Is set to org at the</P>
<P ALIGN="JUSTIFY">beginning.</P>
<P ALIGN="JUSTIFY">size_t idx;</P>
<P ALIGN="JUSTIFY">A member usable by the output module for private purposes.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.3.3 Symbols</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Symbols are represented by a linked list of type symbol with the following members that</P>
<P ALIGN="JUSTIFY">can be accessed by the modules:.</P>
<P ALIGN="JUSTIFY">int type; Type of the symbol. Available are:</P>
<P ALIGN="JUSTIFY">#define LABSYM 1</P>
<P ALIGN="JUSTIFY">The symbol is a label defined at a specific location.</P>
<P ALIGN="JUSTIFY">#define IMPORT 2</P>
<P ALIGN="JUSTIFY">The symbol is imported from another file.</P>
<P ALIGN="JUSTIFY">#define EXPRESSION 3</P>
<P ALIGN="JUSTIFY">The symbol is defined using an expressing.</P>
<P ALIGN="JUSTIFY">int flags;</P>
<P ALIGN="JUSTIFY">Flags of this symbol. Available are:</P>
<P ALIGN="JUSTIFY">#define TYPE_UNKNOWN 0</P>
<P ALIGN="JUSTIFY">The symbol has no type information.</P>
<P ALIGN="JUSTIFY">#define TYPE_OBJECT 1</P>
<P ALIGN="JUSTIFY">The symbol defines an object.</P>
<P ALIGN="JUSTIFY">#define TYPE_FUNCTION 2</P>
<P ALIGN="JUSTIFY">The symbol defines a function.</P>
<P ALIGN="JUSTIFY">#define TYPE_SECTION 3</P>
<P ALIGN="JUSTIFY">The symbl defines a section.</P>
<P ALIGN="JUSTIFY">#define TYPE_FILE 4</P>
<P ALIGN="JUSTIFY">The symbol defines a file.</P>
<P ALIGN="JUSTIFY">#define EXPORT (1&lt;&lt;3)</P>
<P ALIGN="JUSTIFY">The symbol is exported to other files.</P>
<P ALIGN="JUSTIFY">#define INEVAL (1&lt;&lt;4)</P>
<P ALIGN="JUSTIFY">Used internally.</P>
<P ALIGN="JUSTIFY">#define COMMON (1&lt;&lt;5)</P>
<P ALIGN="JUSTIFY">The symbol is a common symbol.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>78</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">#define WEAK (1&lt;&lt;6)</P>
<P ALIGN="JUSTIFY">The symbol is weak, which means the linker may overwrite it with</P>
<P ALIGN="JUSTIFY">any global definition of the same name. Weak symbols may also</P>
<P ALIGN="JUSTIFY">stay undefined, in which case the linker would assign them a value</P>
<P ALIGN="JUSTIFY">of zero.</P>
<P ALIGN="JUSTIFY">#define RSRVD_S (1L&lt;&lt;24)</P>
<P ALIGN="JUSTIFY">The range from bit 24 to 27 (counted from the LSB) is reserved for</P>
<P ALIGN="JUSTIFY">use by the syntax module.</P>
<P ALIGN="JUSTIFY">#define RSRVD_O (1L&lt;&lt;28)</P>
<P ALIGN="JUSTIFY">The range from bit 28 to 31 (counted from the LSB) is reserved for</P>
<P ALIGN="JUSTIFY">use by the output module.</P>
<P ALIGN="JUSTIFY">The type- ags can be extracted using the TYPE() macro which expects a pointer</P>
<P ALIGN="JUSTIFY">to a symbol as argument.</P>
<P ALIGN="JUSTIFY">char *name;</P>
<P ALIGN="JUSTIFY">The name of the symbol.</P>
<P ALIGN="JUSTIFY">expr *expr;</P>
<P ALIGN="JUSTIFY">The expression in case of EXPRESSION symbols.</P>
<P ALIGN="JUSTIFY">expr *size;</P>
<P ALIGN="JUSTIFY">The size of the symbol, if specified.</P>
<P ALIGN="JUSTIFY">section *sec;</P>
<P ALIGN="JUSTIFY">The section a LABSYM symbol is defined in.</P>
<P ALIGN="JUSTIFY">taddr pc; The o set of a LABSYM symbol in bytes relative to the beginning of the section.</P>
<P ALIGN="JUSTIFY">taddr align;</P>
<P ALIGN="JUSTIFY">The alignment of the symbol in bytes.</P>
<P ALIGN="JUSTIFY">size_t idx;</P>
<P ALIGN="JUSTIFY">A member usable by the output module for private purposes.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.3.4 Atoms</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">The contents of each section are a linked list built out of non-separable atoms. The general</P>
<P ALIGN="JUSTIFY">structure of an atom is:</P>
<P ALIGN="JUSTIFY">typedef struct atom {</P>
<P ALIGN="JUSTIFY">struct atom *next;</P>
<P ALIGN="JUSTIFY">int type;</P>
<P ALIGN="JUSTIFY">int align;</P>
<P ALIGN="JUSTIFY">source *src;</P>
<P ALIGN="JUSTIFY">int line;</P>
<P ALIGN="JUSTIFY">listing *list;</P>
<P ALIGN="JUSTIFY">union {</P>
<P ALIGN="JUSTIFY">instruction *inst;</P>
<P ALIGN="JUSTIFY">dblock *db;</P>
<P ALIGN="JUSTIFY">symbol *label;</P>
<P ALIGN="JUSTIFY">sblock *sb;</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 20: Interface</P>
<P ALIGN="JUSTIFY">79</P>
<P ALIGN="JUSTIFY">defblock *defb;</P>
<P ALIGN="JUSTIFY">void *opts;</P>
<P ALIGN="JUSTIFY">int srcline;</P>
<P ALIGN="JUSTIFY">} content;</P>
<P ALIGN="JUSTIFY">} atom;</P>
<P ALIGN="JUSTIFY">The members have the following meaning:</P>
<P ALIGN="JUSTIFY">struct atom *next;</P>
<P ALIGN="JUSTIFY">Pointer to the following atom (0 if last).</P>
<P ALIGN="JUSTIFY">int type; The type of the atom. Can be one of</P>
<P ALIGN="JUSTIFY">#define LABEL 1</P>
<P ALIGN="JUSTIFY">A label is defined here.</P>
<P ALIGN="JUSTIFY">#define DATA 2</P>
<P ALIGN="JUSTIFY">Some data bytes of fixed length and constant data are put here.</P>
<P ALIGN="JUSTIFY">#define INSTRUCTION 3</P>
<P ALIGN="JUSTIFY">Generally refers to a machine instruction or pseudo/opcode. These</P>
<P ALIGN="JUSTIFY">atoms can change length during optimization passes and will be</P>
<P ALIGN="JUSTIFY">translated to DATA-atoms later.</P>
<P ALIGN="JUSTIFY">#define SPACE 4</P>
<P ALIGN="JUSTIFY">Defines a block of data filled with one value (byte). BSS sections</P>
<P ALIGN="JUSTIFY">usually contain only such atoms, but they are also sometimes useful</P>
<P ALIGN="JUSTIFY">as shorter versions of DATA-atoms in other sections.</P>
<P ALIGN="JUSTIFY">#define DATADEF 5</P>
<P ALIGN="JUSTIFY">Defines data of fixed size which can contain cpu specific operands</P>
<P ALIGN="JUSTIFY">and expressions. Will be translated to DATA-atoms later.</P>
<P ALIGN="JUSTIFY">#define LINE 6</P>
<P ALIGN="JUSTIFY">A source text line number (usually from a high level language) is</P>
<P ALIGN="JUSTIFY">bound to the atom’s address. Useful for source level debugging in</P>
<P ALIGN="JUSTIFY">certain ABIs.</P>
<P ALIGN="JUSTIFY">#define OPTS 7</P>
<P ALIGN="JUSTIFY">A means to change assembler options at a specific source text line.</P>
<P ALIGN="JUSTIFY">For example optimization settings, or the cpu type to generate code</P>
<P ALIGN="JUSTIFY">for. The cpu module has to define HAVE_CPU_OPTS and export the</P>
<P ALIGN="JUSTIFY">required functions if it wants to use this type of atom.</P>
<P ALIGN="JUSTIFY">int align;</P>
<P ALIGN="JUSTIFY">The alignment of this atom.</P>
<P ALIGN="JUSTIFY">source *src;</P>
<P ALIGN="JUSTIFY">Pointer to the source text object to which this atom belongs.</P>
<P ALIGN="JUSTIFY">int line; The source line number that created this atom.</P>
<P ALIGN="JUSTIFY">listing *list;</P>
<P ALIGN="JUSTIFY">Pointer to the listing object to which this atoms belong.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>80</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">instruction *inst;</P>
<P ALIGN="JUSTIFY">(In union content.) Pointer to an instruction structure in the case of an</P>
<P ALIGN="JUSTIFY">INSTRUCTION-atom. Contains the following elements:</P>
<P ALIGN="JUSTIFY">int code; The cpu specific code of this instruction.</P>
<P ALIGN="JUSTIFY">char *qualifiers[MAX_QUALIFIERS];</P>
<P ALIGN="JUSTIFY">(If MAX_QUALIFIERS!=0.) Pointer to the qualifiers of this instruc-</P>
<P ALIGN="JUSTIFY">tion.</P>
<P ALIGN="JUSTIFY">operand *op[MAX_OPERANDS];</P>
<P ALIGN="JUSTIFY">(If MAX_OPERANDS!=0.) The cpu-specific operands of this instruc-</P>
<P ALIGN="JUSTIFY">tion.</P>
<P ALIGN="JUSTIFY">instruction_ext ext;</P>
<P ALIGN="JUSTIFY">(If the cpu module defines HAVE_INSTRUCTION_EXTENSION.) A cpu-</P>
<P ALIGN="JUSTIFY">module-specific structure. Typically used to store appropriate op-</P>
<P ALIGN="JUSTIFY">codes, allowed addressing modes, supported cpu derivates etc.</P>
<P ALIGN="JUSTIFY">dblock *db;</P>
<P ALIGN="JUSTIFY">(In union content.) Pointer to a dblock structure in the case of a DATA-atom.</P>
<P ALIGN="JUSTIFY">Contains the following elements:</P>
<P ALIGN="JUSTIFY">taddr size;</P>
<P ALIGN="JUSTIFY">The number of bytes stored in this atom.</P>
<P ALIGN="JUSTIFY">char *data;</P>
<P ALIGN="JUSTIFY">A pointer to the data.</P>
<P ALIGN="JUSTIFY">rlist *relocs;</P>
<P ALIGN="JUSTIFY">A pointer to relocation information for the data.</P>
<P ALIGN="JUSTIFY">symbol *label;</P>
<P ALIGN="JUSTIFY">(In union content.) Pointer to a symbol structure in the case of a LABEL-atom.</P>
<P ALIGN="JUSTIFY">sblock *sb;</P>
<P ALIGN="JUSTIFY">(In union content.) Pointer to a sblock structure in the case of a SPACE-atom.</P>
<P ALIGN="JUSTIFY">Contains the following elements:</P>
<P ALIGN="JUSTIFY">taddr space;</P>
<P ALIGN="JUSTIFY">The size of the empty/filled space in bytes.</P>
<P ALIGN="JUSTIFY">expr *space_exp;</P>
<P ALIGN="JUSTIFY">The above size as an expression, which will be evaluated during</P>
<P ALIGN="JUSTIFY">assembly and copied to space in the final pass.</P>
<P ALIGN="JUSTIFY">int size; The size of each space-element and of the fill-pattern in bytes.</P>
<P ALIGN="JUSTIFY">unsigned char fill[MAXBYTES];</P>
<P ALIGN="JUSTIFY">The fill pattern, up to MAXBYTES bytes.</P>
<P ALIGN="JUSTIFY">defblock *defb;</P>
<P ALIGN="JUSTIFY">(In union content.) Pointer to a defblock structure in the case of a DATADEF-</P>
<P ALIGN="JUSTIFY">atom. Contains the following elements:</P>
<P ALIGN="JUSTIFY">taddr bitsize;</P>
<P ALIGN="JUSTIFY">The size of the definition in bits.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 20: Interface</P>
<P ALIGN="JUSTIFY">81</P>
<P ALIGN="JUSTIFY">operand *op;</P>
<P ALIGN="JUSTIFY">Pointer to a cpu-specific operand structure.</P>
<P ALIGN="JUSTIFY">void *opts;</P>
<P ALIGN="JUSTIFY">(In union content.) Points to a cpu module specific options object in the case</P>
<P ALIGN="JUSTIFY">of a OPTS-atom.</P>
<P ALIGN="JUSTIFY">int srcline;</P>
<P ALIGN="JUSTIFY">(In union content.) Line number for source level debugging in the case of a</P>
<P ALIGN="JUSTIFY">LINE-atom.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.3.5 Relocations</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">DATA-atoms can have a relocations list attached that describes how this data must be mod-</P>
<P ALIGN="JUSTIFY">ified when linking/relocating. They always refer to the data in this atom only.</P>
<P ALIGN="JUSTIFY">There are a number of predefined standard relocations and it is possible to add other cpu-</P>
<P ALIGN="JUSTIFY">specific relocations. Note however, that it is always preferrable to use standard relocations,</P>
<P ALIGN="JUSTIFY">if possible. Chances that an output module supports a certain relocation are much higher</P>
<P ALIGN="JUSTIFY">if it is a standard relocation.</P>
<P ALIGN="JUSTIFY">A relocation list uses this structure:</P>
<P ALIGN="JUSTIFY">typedef struct rlist {</P>
<P ALIGN="JUSTIFY">struct rlist *next;</P>
<P ALIGN="JUSTIFY">void *reloc;</P>
<P ALIGN="JUSTIFY">int type;</P>
<P ALIGN="JUSTIFY">} rlist;</P>
<P ALIGN="JUSTIFY">Type identifies the relocation type. All the standard relocations have type numbers between</P>
<P ALIGN="JUSTIFY">FIRST_STANDARD_RELOC and LAST_STANDARD_RELOC. Consider ‘reloc.h’ to see which stan-</P>
<P ALIGN="JUSTIFY">dard relocations are available.</P>
<P ALIGN="JUSTIFY">The detailed information can be accessed via the pointer reloc. It will point to a structure</P>
<P ALIGN="JUSTIFY">that depends on the relocation type, so a module must only use it if it knows the relocation</P>
<P ALIGN="JUSTIFY">type.</P>
<P ALIGN="JUSTIFY">All standard relocations point to a type nreloc with the following members:</P>
<P ALIGN="JUSTIFY">int offset;</P>
<P ALIGN="JUSTIFY">The o set (from the start of the DATA-atom in bits.</P>
<P ALIGN="JUSTIFY">int size; The size of the relocation in bits.</P>
<P ALIGN="JUSTIFY">taddr mask;</P>
<P ALIGN="JUSTIFY">A mask value.</P>
<P ALIGN="JUSTIFY">taddr addend;</P>
<P ALIGN="JUSTIFY">Value to be added to the symbol value.</P>
<P ALIGN="JUSTIFY">symbol *sym;</P>
<P ALIGN="JUSTIFY">The symbol referred by this relocation</P>
<P ALIGN="JUSTIFY">To describe the meaning of these entries, we will define the steps that shall be performed</P>
<P ALIGN="JUSTIFY">when performing a relocation:</P>
<P ALIGN="JUSTIFY">1. Extract the &lt;size&gt; bits from the data atom, starting with bit number &lt;o set&gt;. &lt;o set&gt;</P>
<P ALIGN="JUSTIFY">zero means to start from the first bit.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>82</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">2. Determine the relocation value of the symbol. For a simple absolute relocation, this</P>
<P ALIGN="JUSTIFY">will be the value of the symbol &lt;sym&gt; plus the &lt;addend&gt;. For other relocation types,</P>
<P ALIGN="JUSTIFY">more complex calculations will be needed. For example, in a program-counter relative</P>
<P ALIGN="JUSTIFY">relocation, the value will be obtained by subtracting the address of the data atom</P>
<P ALIGN="JUSTIFY">(possibly o set by a target specific value) from the value of &lt;sym&gt; plus &lt;addend&gt;.</P>
<P ALIGN="JUSTIFY">3. Calculate the bit-wise "and" of the value obtained in the step above and the &lt;mask&gt;</P>
<P ALIGN="JUSTIFY">value.</P>
<P ALIGN="JUSTIFY">4. Shift the value above right as many bit positions as there are low order zero bits in</P>
<P ALIGN="JUSTIFY">&lt;mask&gt;.</P>
<P ALIGN="JUSTIFY">5. Add this value to the value extracted in step 1.</P>
<P ALIGN="JUSTIFY">6. Insert the low order &lt;size&gt; bits of this value into the data atom starting with bit</P>
<P ALIGN="JUSTIFY">&lt;o set&gt;.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.3.6 Errors</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Each module can provide a list of possible error messages contained e.g. in</P>
<P ALIGN="JUSTIFY">‘syntax_errors.h’ or ‘cpu_errors.h’. They are a comma-separated list of a printf-format</P>
<P ALIGN="JUSTIFY">string and error  ags. Allowed  ags are WARNING, ERROR, FATAL and NOLINE. They can</P>
<P ALIGN="JUSTIFY">be combined using or (|). NOLINE has to be set for error messages during initialiation or</P>
<P ALIGN="JUSTIFY">while writing the output, when no source text is available. Errors cause the assembler to</P>
<P ALIGN="JUSTIFY">return false. FATAL causes the assembler to terminate immediately.</P>
<P ALIGN="JUSTIFY">The errors can be emitted using the function syntax_error(int n,...), cpu_error(int</P>
<P ALIGN="JUSTIFY">n,...) or output_error(int n,...). The first argument is the number of the error mes-</P>
<P ALIGN="JUSTIFY">sage (starting from zero). Additional arguments must be passed according to the format</P>
<P ALIGN="JUSTIFY">string of the corresponding error message.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.4 Syntax modules</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">A new syntax module must have its own subdirectory under ‘vasm/syntax’. At least the</P>
<P ALIGN="JUSTIFY">files ‘syntax.h’, ‘syntax.c’ and ‘syntax_errors.h’ must be written.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.4.1 The file ‘syntax.h’</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">#define ISIDSTART(x)/ISIDCHAR(x)</P>
<P ALIGN="JUSTIFY">These macros should return non-zero if and only if the argument is a valid</P>
<P ALIGN="JUSTIFY">character to start and identifier/inside an identifier respectively. ISIDCHAR</P>
<P ALIGN="JUSTIFY">must be a superset of ISIDSTART.</P>
<P ALIGN="JUSTIFY">#define NARGSYM "NARG"</P>
<P ALIGN="JUSTIFY">Defines the name of an optional symbol which contains the number of arguments</P>
<P ALIGN="JUSTIFY">in a macro.</P>
<P ALIGN="JUSTIFY">#define EXPSKIP() s=exp_skip(s)</P>
<P ALIGN="JUSTIFY">Defines an optional replacement for skip() to be used in expr.c, to skip blanks</P>
<P ALIGN="JUSTIFY">in an expression. Useful to forbid blanks in an expression and to ignore the rest</P>
<P ALIGN="JUSTIFY">of the line (e.g. to treat the rest as comment).</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 20: Interface</P>
<P ALIGN="JUSTIFY">83</P>
<P ALIGN="JUSTIFY">#define IGNORE_FIRST_EXTRA_OP 1</P>
<P ALIGN="JUSTIFY">Should be defined when the syntax module wants to ignore the operand field on</P>
<P ALIGN="JUSTIFY">instructions without an operand. Useful, when everything following an operand</P>
<P ALIGN="JUSTIFY">should be regarded as comment, without a comment character.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.4.2 The file ‘syntax.c’</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">A syntax module has to provide the following elements (all other funtions should be static</P>
<P ALIGN="JUSTIFY">to prevent name clashes):</P>
<P ALIGN="JUSTIFY">char *syntax_copyright;</P>
<P ALIGN="JUSTIFY">A string that will be emitted as part of the copyright message.</P>
<P ALIGN="JUSTIFY">char commentchar;</P>
<P ALIGN="JUSTIFY">A character used to introduce a comment until the end of the line.</P>
<P ALIGN="JUSTIFY">char *defsectname;</P>
<P ALIGN="JUSTIFY">Name of a default section which vasm creates when a label or code occurs in</P>
<P ALIGN="JUSTIFY">the source, but the programmer forgot to specify a section. Assigning NULL</P>
<P ALIGN="JUSTIFY">means that there is no default and vasm will show an error in this case.</P>
<P ALIGN="JUSTIFY">char *defsecttype;</P>
<P ALIGN="JUSTIFY">Type of the default section (see above). May be NULL.</P>
<P ALIGN="JUSTIFY">int init_syntax();</P>
<P ALIGN="JUSTIFY">Will be called during startup. Must return zero if initializations failed, non-zero</P>
<P ALIGN="JUSTIFY">otherwise.</P>
<P ALIGN="JUSTIFY">int syntax_args(char *);</P>
<P ALIGN="JUSTIFY">This function will be called with the command line arguments (unless they were</P>
<P ALIGN="JUSTIFY">already recognized by other modules). If an argument was recognized, return</P>
<P ALIGN="JUSTIFY">non-zero.</P>
<P ALIGN="JUSTIFY">char *skip(char *);</P>
<P ALIGN="JUSTIFY">A function to skip whitespace etc.</P>
<P ALIGN="JUSTIFY">char *skip_operand(char *);</P>
<P ALIGN="JUSTIFY">A function to skip an instruction’s operand. Will terminate at end of line or</P>
<P ALIGN="JUSTIFY">the next comma, returning a pointer to the rest of the line behind the comma.</P>
<P ALIGN="JUSTIFY">void eol(char *);</P>
<P ALIGN="JUSTIFY">This function should check that the argument points to the end of a line (only</P>
<P ALIGN="JUSTIFY">comments or whitespace following). If not, an error or warning message should</P>
<P ALIGN="JUSTIFY">be omitted.</P>
<P ALIGN="JUSTIFY">char *const_prefix(char *,int *);</P>
<P ALIGN="JUSTIFY">Check if the first argument points to the start of a constant. If yes return a</P>
<P ALIGN="JUSTIFY">pointer to the real start of the number (i.e. skip a prefix that may indicate the</P>
<P ALIGN="JUSTIFY">base) and write the base of the number through the pointer passed as second</P>
<P ALIGN="JUSTIFY">argument. Return zero if it does not point to a number.</P>
<P ALIGN="JUSTIFY">void parse(void);</P>
<P ALIGN="JUSTIFY">This is the main parsing function. It has to read lines via the read_next_</P>
<P ALIGN="JUSTIFY">line() function, parse them and create sections, atoms and symbols. Pseudo</P>
<P ALIGN="JUSTIFY">directives are usually handled by the syntax module.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>84</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">char *get_local_label(char **);</P>
<P ALIGN="JUSTIFY">Gets a pointer to the current source pointer. Has to check if a valid local label</P>
<P ALIGN="JUSTIFY">is found at this point. If yes return a pointer to the vasm-internal symbol name</P>
<P ALIGN="JUSTIFY">representing the local label and update the current source pointer to point</P>
<P ALIGN="JUSTIFY">behind the label.</P>
<P ALIGN="JUSTIFY">Have a look at the support functions provided by the frontend to help.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.5 CPU modules</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">A new cpu module must have its own subdirectory under ‘vasm/cpus’. At least the files</P>
<P ALIGN="JUSTIFY">‘cpu.h’, ‘cpu.c’ and ‘cpu_errors.h’ must be written.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.5.1 The file ‘cpu.h’</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">A cpu module has to provide the following elements (all other functions should be static</P>
<P ALIGN="JUSTIFY">to prevent name clashes) in cpu.h:</P>
<P ALIGN="JUSTIFY">#define MAX_OPERANDS 3</P>
<P ALIGN="JUSTIFY">Maximum number of operands of one instruction.</P>
<P ALIGN="JUSTIFY">#define CPU_CHECKS_OPCNT 0</P>
<P ALIGN="JUSTIFY">When non-zero, parse_operand() is called with an arbitrary number of</P>
<P ALIGN="JUSTIFY">operands, and it is the task of the cpu module to check it.</P>
<P ALIGN="JUSTIFY">#define MAX_QUALIFIERS 0</P>
<P ALIGN="JUSTIFY">Maximum number of mnemonic-qualifiers per mnemonic.</P>
<P ALIGN="JUSTIFY">typedef long taddr;</P>
<P ALIGN="JUSTIFY">Data type to represent a target-address. Preferrably use the ones from</P>
<P ALIGN="JUSTIFY">‘stdint.h’.</P>
<P ALIGN="JUSTIFY">#define LITTLEENDIAN 1</P>
<P ALIGN="JUSTIFY">#define BIGENDIAN 0</P>
<P ALIGN="JUSTIFY">Define these according to the target endianess. For CPUs which support big-</P>
<P ALIGN="JUSTIFY">and little-endian, you may assign a global variable here. So be aware of it, and</P>
<P ALIGN="JUSTIFY">never use #if BIGENDIAN, but always if(BIGENDIAN) in your code.</P>
<P ALIGN="JUSTIFY">#define VASM_CPU_&lt;cpu&gt; 1</P>
<P ALIGN="JUSTIFY">Insert the cpu specifier.</P>
<P ALIGN="JUSTIFY">#define INST_ALIGN 2</P>
<P ALIGN="JUSTIFY">Minimum instruction alignment.</P>
<P ALIGN="JUSTIFY">#define SECTION_ALIGN 2</P>
<P ALIGN="JUSTIFY">Default section alignment.</P>
<P ALIGN="JUSTIFY">#define DATA_ALIGN(n) ...</P>
<P ALIGN="JUSTIFY">Default alignment for n-bit data. Can also be a function.</P>
<P ALIGN="JUSTIFY">#define DATA_OPERAND(n) ...</P>
<P ALIGN="JUSTIFY">Operand class for n-bit data definitions. Can also be a function. Negative</P>
<P ALIGN="JUSTIFY">values denote a  oating point data definition of -n bits.</P>
<P ALIGN="JUSTIFY">typedef ... operand;</P>
<P ALIGN="JUSTIFY">Structure to store an operand.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 20: Interface</P>
<P ALIGN="JUSTIFY">85</P>
<P ALIGN="JUSTIFY">typedef ... mnemonic_extension;</P>
<P ALIGN="JUSTIFY">Mnemonic extension.</P>
<P ALIGN="JUSTIFY">Optional features, which can be enabled by defining the following macros:</P>
<P ALIGN="JUSTIFY">#define HAVE_INSTRUCTION_EXTENSION 1</P>
<P ALIGN="JUSTIFY">If cpu-specific data should be added to all instruction atoms.</P>
<P ALIGN="JUSTIFY">typedef ... instruction_ext;</P>
<P ALIGN="JUSTIFY">Type for the above extension.</P>
<P ALIGN="JUSTIFY">NEED_CLEARED_OPERANDS</P>
<P ALIGN="JUSTIFY">Backend requires a zeroed operand structure when calling parse_operand()</P>
<P ALIGN="JUSTIFY">for the first time. Defaults to undefined.</P>
<P ALIGN="JUSTIFY">START_PARENTH(x)</P>
<P ALIGN="JUSTIFY">Valid opening parenthesis for instruction operands. Defaults to ’(’.</P>
<P ALIGN="JUSTIFY">END_PARENTH(x)</P>
<P ALIGN="JUSTIFY">Valid closing parenthesis for instruction operands. Defaults to ’)’.</P>
<P ALIGN="JUSTIFY">Implementing additional target-specific unary operations is done by defining the following</P>
<P ALIGN="JUSTIFY">optional macros:</P>
<P ALIGN="JUSTIFY">EXT_UNARY_NAME(s)</P>
<P ALIGN="JUSTIFY">Should return True when the string in s points to an operation name we want</P>
<P ALIGN="JUSTIFY">to handle.</P>
<P ALIGN="JUSTIFY">EXT_UNARY_TYPE(s)</P>
<P ALIGN="JUSTIFY">Returns the operation type code for the string in s. Note that the last valid</P>
<P ALIGN="JUSTIFY">standard operation is defined as LAST_EXP_TYPE, so the target-specific types</P>
<P ALIGN="JUSTIFY">will start with LAST_EXP_TYPE+1.</P>
<P ALIGN="JUSTIFY">EXT_UNARY_EVAL(t,v,r,c)</P>
<P ALIGN="JUSTIFY">Defines a function with the arguments (int t, taddr v, taddr *r, int c) to</P>
<P ALIGN="JUSTIFY">handle the operation type t returning an int to indicate whether this type has</P>
<P ALIGN="JUSTIFY">been handled or not. Your operation will by applied on the value v and the</P>
<P ALIGN="JUSTIFY">result is stored in *r. The  ag c is passed as 1 when the value is constant (no</P>
<P ALIGN="JUSTIFY">relocatable addresses involved).</P>
<P ALIGN="JUSTIFY">EXT_FIND_BASE(e,s,p)</P>
<P ALIGN="JUSTIFY">Defines a function with the arguments (expr *e, section *s, taddr p) to re-</P>
<P ALIGN="JUSTIFY">turn a pointer to the base symbol of expression e. The type in e-&gt;type has to</P>
<P ALIGN="JUSTIFY">checked to be one of the operations to handle. The section pointer s and the</P>
<P ALIGN="JUSTIFY">current pc p are needed to call the standard find_base() function.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.5.2 The file ‘cpu.c’</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">A cpu module has to provide the following elements (all other functions should be static</P>
<P ALIGN="JUSTIFY">to prevent name clashes) in cpu.c:</P>
<P ALIGN="JUSTIFY">int bitsperbyte;</P>
<P ALIGN="JUSTIFY">The number of bits per byte of the target cpu.</P>
<P ALIGN="JUSTIFY">int bytespertaddr;</P>
<P ALIGN="JUSTIFY">The number of bytes per taddr.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>86</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">char *cpu_copyright;</P>
<P ALIGN="JUSTIFY">A string that will be emitted as part of the copyright message.</P>
<P ALIGN="JUSTIFY">char *cpuname;</P>
<P ALIGN="JUSTIFY">A string describing the target cpu.</P>
<P ALIGN="JUSTIFY">int init_cpu();</P>
<P ALIGN="JUSTIFY">Will be called during startup. Must return zero if initializations failed, non-zero</P>
<P ALIGN="JUSTIFY">otherwise.</P>
<P ALIGN="JUSTIFY">int cpu_args(char *);</P>
<P ALIGN="JUSTIFY">This function will be called with the command line arguments (unless they were</P>
<P ALIGN="JUSTIFY">already recognized by other modules). If an argument was recognized, return</P>
<P ALIGN="JUSTIFY">non-zero.</P>
<P ALIGN="JUSTIFY">char *parse_cpu_special(char *);</P>
<P ALIGN="JUSTIFY">This function will be called with a source line as argument and allows the cpu</P>
<P ALIGN="JUSTIFY">module to handle cpu-specific directives etc. Functions like eol() and skip()</P>
<P ALIGN="JUSTIFY">should be used by the syntax module to keep the syntax consistent.</P>
<P ALIGN="JUSTIFY">operand *new_operand();</P>
<P ALIGN="JUSTIFY">Allocate and initialize a new operand structure.</P>
<P ALIGN="JUSTIFY">void free_operand(operand *);</P>
<P ALIGN="JUSTIFY">Free an operand.</P>
<P ALIGN="JUSTIFY">int parse_operand(char *text,int len,operand *out,int requires);</P>
<P ALIGN="JUSTIFY">Parses the source at text with length len to fill the target specific operand</P>
<P ALIGN="JUSTIFY">structure pointed to by out. Returns PO_MATCH when the operand matches the</P>
<P ALIGN="JUSTIFY">operand-type passed in requires and PO_NOMATCH otherwise. When the source</P>
<P ALIGN="JUSTIFY">is definitely identified as garbage, the function may return PO_CORRUPT to tell</P>
<P ALIGN="JUSTIFY">the assembler that it is useless to try matching against any other operand types.</P>
<P ALIGN="JUSTIFY">mnemonic mnemonics[];</P>
<P ALIGN="JUSTIFY">The mnemonic table is usually defined in ‘opcodes.h’ and keeps a list of</P>
<P ALIGN="JUSTIFY">mnemonic names and operand types the assembler with match against using</P>
<P ALIGN="JUSTIFY">parse_operand(). It may also include a target specific mnemonic_extension.</P>
<P ALIGN="JUSTIFY">taddr instruction_size(instruction *ip, section *sec, taddr pc);</P>
<P ALIGN="JUSTIFY">Returns the size of the instruction ip in bytes, which must be identical to the</P>
<P ALIGN="JUSTIFY">number of bytes written by eval_instruction() (see below).</P>
<P ALIGN="JUSTIFY">dblock *eval_instruction(instruction *ip, section *sec, taddr pc);</P>
<P ALIGN="JUSTIFY">Converts the instruction ip into a DATA atom, including relocations, if neces-</P>
<P ALIGN="JUSTIFY">sary.</P>
<P ALIGN="JUSTIFY">dblock *eval_data(operand *op, taddr bitsize, section *sec, taddr pc);</P>
<P ALIGN="JUSTIFY">Converts a data operand into a DATA atom, including relocations.</P>
<P ALIGN="JUSTIFY">void init_instruction_ext(instruction_ext *);</P>
<P ALIGN="JUSTIFY">(If HAVE_INSTRUCTION_EXTENSION is set.) Initialize an instruction extension.</P>
<P ALIGN="JUSTIFY">char *parse_instruction(char *,int *,char **,int *,int *);</P>
<P ALIGN="JUSTIFY">(If MAX_QUALIFIERS is greater than 0.) Parses instruction and saves extension</P>
<P ALIGN="JUSTIFY">locations.</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>Chapter 20: Interface</P>
<P ALIGN="JUSTIFY">87</P>
<P ALIGN="JUSTIFY">int set_default_qualifiers(char **,int *);</P>
<P ALIGN="JUSTIFY">(If MAX_QUALIFIERS is greater than 0.) Saves pointers and lengths of default</P>
<P ALIGN="JUSTIFY">qualifiers for the selected CPU and returns the number of default qualifiers.</P>
<P ALIGN="JUSTIFY">Example: for a M680x0 CPU this would be a single qualifier, called "w". Used</P>
<P ALIGN="JUSTIFY">by execute_macro().</P>
<P ALIGN="JUSTIFY">cpu_opts_init(section *);</P>
<P ALIGN="JUSTIFY">(If HAVE_CPU_OPTS is set.) Gives the cpu module the chance to write out OPTS</P>
<P ALIGN="JUSTIFY">atoms with initial settings before the first atom is generated.</P>
<P ALIGN="JUSTIFY">cpu_opts(void *);</P>
<P ALIGN="JUSTIFY">(If HAVE_CPU_OPTS is set.) Apply option modifications from an OPTS atom. For</P>
<P ALIGN="JUSTIFY">example: change cpu type or optimization  ags.</P>
<P ALIGN="JUSTIFY">print_cpu_opts(FILE *,void *);</P>
<P ALIGN="JUSTIFY">(If HAVE_CPU_OPTS is set.) Called from print_atom() to print an OPTS atom’s</P>
<P ALIGN="JUSTIFY">contents.</P>
</FONT><FONT SIZE=5><P ALIGN="JUSTIFY">20.6 Output modules</P>
</FONT><FONT SIZE=4><P ALIGN="JUSTIFY">Output modules can be chosen at runtime rather than compile time. Therefore, several</P>
<P ALIGN="JUSTIFY">output modules are linked into one vasm executable and their structure di ers somewhat</P>
<P ALIGN="JUSTIFY">from syntax and cpu modules.</P>
<P ALIGN="JUSTIFY">Usually, an output module for some object format fmt should be contained in a file</P>
<P ALIGN="JUSTIFY">‘output_fmt.c’ (it may use/include other files if necessary). To automatically include this</P>
<P ALIGN="JUSTIFY">format in the build process, the ‘make.rules’ has to be extended. The module should be</P>
<P ALIGN="JUSTIFY">added to the OBJS variable at the start of ‘make.rules’. Also, a dependency line should</P>
<P ALIGN="JUSTIFY">be added (see the existing output modules).</P>
<P ALIGN="JUSTIFY">An output module must only export a single function which will return pointers to necessary</P>
<P ALIGN="JUSTIFY">data/functions. This function should have the following prototype:</P>
<P ALIGN="JUSTIFY">int init_output_&lt;fmt&gt;(</P>
<P ALIGN="JUSTIFY">char **copyright,</P>
<P ALIGN="JUSTIFY">void (**write_object)(FILE *,section *,symbol *),</P>
<P ALIGN="JUSTIFY">int (**output_args)(char *)</P>
<P ALIGN="JUSTIFY">);</P>
<P ALIGN="JUSTIFY">In case of an error, zero must be returned. Otherwise, It should perform all necessary</P>
<P ALIGN="JUSTIFY">initializations, return non-zero and return the following output parameters via the pointers</P>
<P ALIGN="JUSTIFY">passed as arguments:</P>
<P ALIGN="JUSTIFY">copyright</P>
<P ALIGN="JUSTIFY">A pointer to the copyright string.</P>
<P ALIGN="JUSTIFY">write_object</P>
<P ALIGN="JUSTIFY">A pointer to a function emitting the output. It will be called after the assembler</P>
<P ALIGN="JUSTIFY">has completed and will receive pointers to the output file, to the first section</P>
<P ALIGN="JUSTIFY">of the section list and to the first symbol in the symbol list. See the section on</P>
<P ALIGN="JUSTIFY">general data structures for further details.</P>
<P ALIGN="JUSTIFY">output_args</P>
<P ALIGN="JUSTIFY">A pointer to a function checking arguments. It will be called with all command</P>
<P ALIGN="JUSTIFY">line arguments (unless already handled by other modules). If the output module</P>
</FONT><FONT SIZE=2><P ALIGN="JUSTIFY"> </FONT><FONT SIZE=4>88</P>
<P ALIGN="JUSTIFY">vasm manual</P>
<P ALIGN="JUSTIFY">recognizes an appropriate option, it has to handle it and return non-zero. If it</P>
<P ALIGN="JUSTIFY">is not an option relevant to this output module, zero must be returned.</P>
<P ALIGN="JUSTIFY">At last, a call to the output_init_&lt;fmt&gt; has to be added in the init_output() function</P>
<P ALIGN="JUSTIFY">in ‘vasm.c’ (should be self-explanatory).</P>
<P ALIGN="JUSTIFY">Some remarks:</P>
<P ALIGN="JUSTIFY">- Some output modules can not handle all supported CPUs. Nevertheless, they</P>
<P ALIGN="JUSTIFY">have to be written in a way that they can be compiled. If code references CPU-</P>
<P ALIGN="JUSTIFY">specifics, they have to be enclosed in #ifdef VASM_CPU_MYCPU ... #endif or</P>
<P ALIGN="JUSTIFY">similar.</P>
<P ALIGN="JUSTIFY">Also, if the selected CPU is not supported, the init function should fail.</P>
<P ALIGN="JUSTIFY">- Error/warning messages can be emitted with the output_error function. As all</P>
<P ALIGN="JUSTIFY">output modules are linked together, they have a common list of error messages</P>
<P ALIGN="JUSTIFY">in the file ‘output_errors.h’. If a new message is needed, this file has to be</P>
<P ALIGN="JUSTIFY">extended (see the section on general data structures for details).</P>
<P ALIGN="JUSTIFY">- vasm has a mechanism to specify rather complex relocations in a standard</P>
<P ALIGN="JUSTIFY">way (see the section on general data structures). They can be extended with</P>
<P ALIGN="JUSTIFY">CPU specific relocations, but usually CPU modules will try to create standard</P>
<P ALIGN="JUSTIFY">relocations (sometimes several standard relocations can be used to implement</P>
<P ALIGN="JUSTIFY">a CPU specific relocation). An output module should try to find appropriate</P>
<P ALIGN="JUSTIFY">relocations supported by the object format. The goal is to avoid special CPU</P>
<P ALIGN="JUSTIFY">specific relocations as much as possible.</P>
<P ALIGN="JUSTIFY">Volker Barthelmann vb@compilers.de</P>
</FONT><FONT SIZE=2><P> </P></FONT></BODY>
</HTML>
