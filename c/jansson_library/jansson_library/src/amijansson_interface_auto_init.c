/*
**	$Id$
**	Generated by IDLTool 53.6
**	Do not edit
**
**	AutoInit stub for amijansson
**
**	Copyright (c) 2010 Hyperion Entertainment CVBA.
**	All Rights Reserved.
*/

#include <interfaces/amijansson.h>
#include <proto/exec.h>
#include <assert.h>

/****************************************************************************/

struct JanssonIFace * IJansson = NULL;
static struct Library * __JanssonBase;
static struct JanssonIFace * __IJansson;

/****************************************************************************/

extern struct Library * JanssonBase;

/****************************************************************************/

void amijansson_main_constructor(void)
{
	if (JanssonBase == NULL) /*  Library base is NULL, we need to open it */ 
		{
			/* We were called before the base constructor.
			 * This means we will be called _after_ the base destructor.
			 * So we cant drop the interface _after_ closing the last library base,
			 * we just open the library here which ensures that.
			 */
			__JanssonBase = JanssonBase = (struct Library *)IExec->OpenLibrary("jansson.library", 0L);
			assert(JanssonBase != NULL);
		}

	__IJansson = IJansson = (struct JanssonIFace *)IExec->GetInterface((struct Library *)JanssonBase, "main", 1, NULL);
	assert(IJansson != NULL);
}
__attribute__((section(".ctors.zzzy"))) static void
(*amijansson_main_constructor_ptr)(void) USED = amijansson_main_constructor;

/****************************************************************************/

void amijansson_main_destructor(void)
{
	if (__IJansson)
		{
			IExec->DropInterface ((struct Interface *)__IJansson);
		}

	if (__JanssonBase)
		{
			IExec->CloseLibrary((struct Library *) __JanssonBase);
		}
}
__attribute__((section(".dtors.zzzy"))) static void
(*amijansson_main_destructor_ptr)(void) USED = amijansson_main_destructor;

/****************************************************************************/

