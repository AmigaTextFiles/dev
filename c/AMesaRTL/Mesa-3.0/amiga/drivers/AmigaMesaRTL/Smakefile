# smakefile for core library for Amiga mesa.library
# Based on the makefile by Stefan Zivkovic

##### MACROS #####

LIBRARYDIR = //library/mesadrivers

TMP_FILE = T:MesaTMP_SCOPTS

DRIVEROBJECTS = amigamesartl.o

DRIVER_LIBRARYSCFLAGS = idlen=63 nocheckabort

# Features to make and link a shared library for amiga

DRIVER_VERSION = 3
DRIVER_REV = 0
DRIVER_LIBRARYFD = //include/fd/mesadriver.fd
DRIVER_LIBRARY = $(LIBRARYDIR)/amigamesartl
DRIVER_MAKELIBRARY = slink with lib:utillib.with lib lib:scm881.lib+lib:sc.lib+lib:amiga.lib libversion $(DRIVER_VERSION) librevision $(DRIVER_REV) libfd $(DRIVER_LIBRARYFD) TO $(DRIVER_LIBRARY) FROM lib:libent.o lib:libinitr.o

CC = sc

##### RULES #####
.a.o:
    $(CC) WITH=$(TMP_File) $*.a

.c.o:
    $(CC) WITH=$(TMP_File) $*.c

##### TARGETS #####

default:
    smake library

library: $(DRIVER_LIBRARY)
    @echo "------- FINISHED ------"

$(DRIVER_LIBRARY): DRIVER_Library $(DRIVEROBJECTS) DeleteTMP
    @echo "------ Making Mesa driver Library -----"
    $(DRIVER_MAKELIBRARY) $(DRIVEROBJECTS)

# Makes temporary scoptions to use in global .c.o

DRIVER_Library:
	@echo >$(TMP_FILE) "$(DRIVER_LIBRARYSCFLAGS)"
DeleteTMP:
    @delete $(TMP_FILE)

