TABLE OF CONTENTS

outputhandler/--background--
outputhandler/InitOutputHandlerA
outputhandler/DeleteOutputHandler
outputhandler/ResizeOutputHandler
outputhandler/ProcessOutput
outputhandler/SetIndexRGBTable
outputhandler/SetOutputHandlerAttrsA
outputhandler/GetOutputHandlerAttr

outputhandler/--background--                     outputhandler/--background--

   NAME
        outputhandler - Output handler plugin library for AmigaMesaRTL.

   PURPOSE
        This document describes the output handler interface that
        AmigaMesaRTL expects.

        An output handler processes the buffer generated by the AmigaMesaRTL
        driver, usually to output it to a window. Both RGBA and Index-mode
        buffers should be supported by an output handler.

        When a new context is created, the output handler library requested
        by the user is opened using OpenLibrary(). If opened successfully,
        InitOutputHandler() is called. Do whatever setup is needed here. If
        all goes well, ResizeOutputHandler() will be the next thing to be
        called. If something goes wrong, or the user wants to destroy the
        context, DeleteOutputHandler() will be called. An output handler
        should be prepared to receive a DeleteOutputHandler() call at any
        time after InitOutputHandler() has been called.

        All the hard work is done by ProcessOutput(). Whatever is necesary to
        draw the given buffer to for example the window is done here.

        An output handler may support multiple output environments, such as a
        window or a rastport+viewport. The type of output environment
        supported by the output handler is gotten with the OH_OutputQuery
        tag. The type of environment to use is set by OH_OutputType, and must
        accompany and be accompanied by a pointer to the environment data
        using the OH_Output tag.

        To enable the user to control some aspects of the output handler
        through an external preference program, output handlers support the
        setting of some parameters through strings parseable with ReadArgs().
        The pattern can be obtained by getting the OH_ParameterQuery tag, and
        the parameters set by passing the parameter string with the
        OH_Parameters tag. An output handler should read default parameters
        from an evironment variable called "AmigaMesaRTL/<handler>.prefs",
        for example the dl1 output handler reads preferences from the
        variable "AmigaMesaRTL/dl1.prefs". The patterns used in the output
        handlers supplied with the distribution of AmigaMesaRTL are augmented
        with strings which the MesaOutput prefence program uses to create a
        GUI. See the documentation for MesaOutput about these strings.

        See the dl1, source for an example implementation.
        
        Szymon Ulatowski has kindly supplied some documentation for the
        RPortVPort output type. See the file "outputtype-RPortVPort.doc".

   SUPPLIED OUTPUT HANDLERS
        There are five output handlers supplied with the distribution of
        AmigaMesaRTL:

           - dl1 : The default output handler. Uses the dl1 quantizer by
                   Dennis Lee. Only understands "Window" output type.
                   Written by Jarno van der Linden.
           - dl1plus : Based on dl1, but uses pen sharing and can also use
                       the "RPortVPort" output type.
                       Written by Szymon Ulatowski.
           - grey: Quantizes fast because it just uses greyscale. Can use
                   "Window" and "RPortVPort" output types.
                   Written by Szymon Ulatowski.
           - quickcolor : Quick&Dirty colour output. Can use "Window" and
                         "RPortVPort" output types.
                         Written by Szymon Ulatowski.
           - magic : Attempts to send the output to the MagicServer to output
                     to applications such as ImageFX.
                     Written by Szymon Ulatowski.

        Some of these may not completely conform to the documentation yet.
        Please direct any problems specific to an output handler to its
        author.


outputhandler/InitOutputHandlerA             outputhandler/InitOutputHandlerA

   NAME
        InitOutputHandlerA - Initialize the output handler.
        InitOutputHandler - Varargs stub for InitOutputHandlerA().

   SYNOPSIS
        result = InitOutputHandlerA(context, tags)
        D0                          A0       A1

        int InitOutputHandlerA(AmigaMesaRTLContext, struct TagItem *);

        result = InitOutputHandler(context, tag1, ...)

        int InitOutputHandler(AmigaMesaRTLContext, ULONG, ...);

   FUNCTION
        The output handler is initialized. This will be called only once for
        a context.

   INPUTS
        context - The AmigaMesaRTL context
        tags - Pointer to a tag list

   TAGS
        OH_Output - The environment to which the output has to be send. What
             exactly is passed as the data is dependend on the value
             passed with the OH_OutputType tag. If the value of OH_Output is
             NULL, the output handler will open an environment for you.

        OH_OutputType (STRPTR) - Type of output environment to use. The
             string is case insensitive. If an OH_Output is specified, this
             tag must also be specified.

        OH_Parameters (STRPTR) - Output handler-specific parameters given as
             a string suitable for parsing with ReadArgs().

        OH_DriverBase (struct Library *) - Pointer to the library base of the
             driver which is using the output handler. The output handler
             uses this pointer to communicate with the driver to get, for
             example, context attributes such as AMRTL_Mode.

   RESULTS
        result - 0 if the quantizer failed to initialize, non-zero otherwise.

   BUGS
        None

   SEE ALSO
        DeleteOutputHandler()

outputhandler/DeleteOutputHandler           outputhandler/DeleteOutputHandler

   NAME
        DeleteOutputHandler - Delete the output handler.

   SYNOPSIS
        DeleteOutputHandler()

        void DeleteOutputHandler(void);

   FUNCTION
        The output handler is deleted. This can be called anytime after the
        InitOutputHandler() function has been called. This includes the case
        when the output handler failed to initialize.

        This function will be called before the output handler library is
        closed.

   INPUTS
        None.

   RESULTS
        None.

   BUGS
        None

   SEE ALSO


outputhandler/ResizeOutputHandler           outputhandler/ResizeOutputHandler

   NAME
        ResizeOutputHandler - Resize the output handler.

   SYNOPSIS
        result = ResizeOutputHandler()
        D0

        int ResizeOutputHandler(void);

   FUNCTION
        When the driver thinks the output handler may want to change the size
        of the output, it will call this function. The output handler can get
        the size of the buffer maintained by the driver through the
        AMRTL_BufferWidth and AMRTL_BufferHeight context attributes.

        ResizeOutputHandler() will be called at least once after
        InitOutputHandler() is called successfully and before ProcessOutput()
        is called, unless the output handler is deleted in the meantime.

   INPUTS
        None

   RESULTS
        result - 0 if the output handler encountered an error, non-zero
                 otherwise.

   BUGS
        None

   SEE ALSO


outputhandler/ProcessOutput                       outputhandler/ProcessOutput

   NAME
        ProcessOutput - Process the buffer and output.

   SYNOPSIS
        result = ProcessOutput()
        D0

        int Quantize(void);

   FUNCTION
        Using the parameters passed to InitOutputHandler() and
        ResizeOutputHandler(), and whatever can be obtained from the context,
        the current buffer is processed and output. The buffer is obtained by
        getting the AMRTL_Buffer attribute of the context.

        For example, in the case where the output is a window such as with
        the dl1 output handler, the buffer is colour quantized (if the buffer
        is an RGBA buffer) and written to the window using a C2P algorithm.

        The buffer should not be modified in any way by the output handler,
        as the user may want to read pixels from it, or process it further.

   INPUTS
        None.

   RESULTS
        result - 0 if the output handler failed to handle the output,
                 non-zero otherwise.

   BUGS
        None

   SEE ALSO
        InitOutputHandler(), ResizeOutputHandler()

outputhandler/SetIndexRGBTable                 outputhandler/SetIndexRGBTable

   NAME
        SetIndexRGBTable - Set colours for an index-mode buffer.

   SYNOPSIS
        SetIndexRGBTable(index, rgbtable, numcolours)
                         D0     A0        D1

        void SetIndexRGBTable(int, ULONG *, int);

   FUNCTION
        In index-mode, each value in the buffer is an index into a palette
        table. This function sets a range of colours in that palette table.
        Note that at present, the index-mode buffer stores one byte per pixel
        so the indices are limited between 0 and 255.

        For example, if the output is a window, this function may set the
        window's palette to the given colours.

   INPUTS
        index - index of first colour to set
        rgbtable - Array of numcolours RGB triples, 32 bits per primary.
        numcolours - Number of RGB triples in the table

   RESULTS
        None.

   BUGS
        This function can't report an error. Any error that does occur should
        be handled gracefully by the output handler by for example remapping
        the colours.

   SEE ALSO


outputhandler/SetOutputHandlerAttrsA     outputhandler/SetOutputHandlerAttrsA

   NAME
        SetOutputHandlerAttrsA - Set output handler attributes
        SetOutputHandlerAttrs - Varargs stub for SetOutputHandlerAttrsA()

   SYNOPSIS
        result = SetOutputHandlerAttrsA(tags)
        D0                              A0

        int SetOutputHandlerAttrsA(struct TagItem *);

        result = SetOutputHandlerAttrs(tag1, ...)

        int SetOutputHandlerAttrs(ULONG, ...);

   FUNCTION
        Set some attributes of the output handler. Not all output handlers
        may support all tags, and some output handlers may have extra custom
        tags.

   INPUTS
        tags - Pointer to a tag list

   TAGS
        OH_Output - Set the output environment. It must be accompanied with
             the OH_OutputType tag. Changing output environments on-the-fly
             can be tricky, and some output handlers may not support it. It
             is a good idea to call glViewport() after changing the output
             environment.

        OH_OutputType (STRPTR) - See OH_Output.

        OH_Parameters (STRPTR) - Output handler-specific parameters given as
             a string suitable for parsing with ReadArgs().

   RESULTS
        result - 0 if there is no significant change, 1 if there is, anything
        else if an error occured.

   BUGS
        None

   SEE ALSO
        InitOutputHandler(), GetOutputHandlerAttr()

outputhandler/GetOutputHandlerAttr         outputhandler/GetOutputHandlerAttr

   NAME
        GetOutputHandlerAttr - Get output handler attributes

   SYNOPSIS
        result = GetOutputHandlerAttr(attr, data)
        D0                            D0    A0

        int GetOutputHandlerAttr(ULONG, ULONG *);

   FUNCTION
        The main way to get information out of an output handler is by
        getting attributes through GetOutputHandlerAttr(). Not all output
        handlers may support all tags, and some may have extra custom tags.

   INPUTS
        attr - attribute to get value for
        data - pointer to allocated memory area to put data in

   TAGS
        OH_Output - Get pointer to the current output environment used by the
             output handler. The type is dependend on the value given by
             OH_OutputType.

        OH_OutputType (STRPTR) - The type of the output environment currently
             in use by the output handler.

        OH_Width (ULONG) - The width the output handler would like the driver
             to use for the buffer width. The buffer width may not actually
             turn out to be exactly this width. The real buffer width is
             given by the AMRTL_BufferWidth context attribute.

        OH_Height (ULONG) - Like OH_Width, only for heights.

        OH_ParameterQuery (STRPTR) - ReadArgs() pattern string that the
             output handler uses to parse strings set by the OH_Parameters
             tag. The pattern can be used by for example preference programs
             to set custom parameters for the output handler.

        OH_OutputQuery (STRPTR *) - Returns an array of string pointers,
             terminated with a NULL pointer, specifying all the output types
             supported by the output handler.
        
        OH_RGBAOrder (ULONG) - If the buffer is in RGBA (truecolour) mode,
             the driver will ask the output handler in what order it would
             like the RGBA tuple to be. At present only ORDER_RGBA and
             ORDER_ARGB are defined. With ORDER_RGBA, the alpha byte is in
             the lowbyte of the ULONG (i.e. the buffer contains RGBARGBA...),
             and with ORDER_ARGB the alpha byte is in the highbyte of the
             ULONG (i.e. the buffer contains bytes in the order ARGBARGB...).

   BUGS
        None

   RESULTS
        result - 1 if the tag was recognised, 0 otherwise.

   SEE ALSO
        SetOutputHandlerAttrsA()

