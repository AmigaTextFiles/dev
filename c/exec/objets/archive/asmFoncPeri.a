   XDEF  _asmOuvrePeri
   XDEF  _asmFermePeri
   XDEF  _asmEpurePeri
   XDEF  _asmFaisES
   XDEF  _asmAvorteES

   XREF  _geta4
   XREF  __Peripherique_ouvre
   XREF  __Peripherique_ferme
   XREF  __Peripherique_epure
   XREF  __Peripherique_faisES
   XREF  __Peripherique_avorteES
;   XREF  _Debug

   CSECT asmFoncPeri

; empiler les arguments de droite à gauche

_asmOuvrePeri:
   movem.l  d1-d7/a0-a6,-(sp)
   jsr      _geta4   ; charge l'@ du segment de donnée
   move.l   d1,-(sp) ; options
   move.l   d0,-(sp) ; numéro d'unité
   move.l   a1,-(sp) ; requête d'ES
   move.l   a6,-(sp) ; 
   jsr      __Peripherique_ouvre
   add.l    #16,sp
   movem.l  (sp)+,d1-d7/a0-a6
   rts

_asmFermePeri:
   movem.l  d1-d7/a0-a6,-(sp)
   jsr      _geta4   ; charge l'@ du segment de donnée
   move.l   a1,-(sp)
   move.l   a6,-(sp)
   jsr      __Peripherique_ferme
   addq.l   #8,sp
   movem.l  (sp)+,d1-d7/a0-a6
;   moveq    #0,d0    ; renvoie 0 pour empêcher le déchargement
   rts

_asmEpurePeri:
   movem.l  d1-d7/a0-a6,-(sp)
   jsr      _geta4   ; charge l'@ du segment de donnée
   move.l   a6,-(sp)
   jsr      __Peripherique_epure
   addq.l   #4,sp
   movem.l  (sp)+,d1-d7/a0-a6
;   moveq    #0,d0    ; renvoie 0 pour empêcher le déchargement
    rts

_asmFaisES:
   movem.l  d1-d7/a0-a6,-(sp)
   jsr      _geta4   ; charge l'@ du segment de donnée
   move.l   a1,-(sp)
   move.l   a6,-(sp)
   jsr      __Peripherique_faisES
   addq.l   #8,sp
   movem.l  (sp)+,d1-d7/a0-a6
   rts

_asmAvorteES:
   movem.l  d1-d7/a0-a6,-(sp)
   jsr      _geta4   ; charge l'@ du segment de donnée
   move.l   a1,-(sp)
   move.l   a6,-(sp)
   jsr      __Peripherique_avorteES
   addq.l   #8,sp
   movem.l  (sp)+,d1-d7/a0-a6
   rts

   END
