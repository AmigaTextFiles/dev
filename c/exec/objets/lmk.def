FLAGS=-csw+
D=PAS_DEBOGUE

# option -v obligatoire; fonction peut être partagée par parent & enfant
.cp.o:
   @echo "$D"
   @echo "Préprocesseur en cours..."
   @cpp <$*.cp >RAM:$*.p -f$* \
    -dc_plusplus=1 -dLATTICE -d$D \
    -iCPinclude:
   @echo ">Terminé"

   @echo "CFront en cours..."
   @CFront <RAM:$*.p +f$*.cp +LM RAM:$*.c
   @echo ">Terminé"
   @delete RAM:$*.p

   LC -RLIB:exec.lib $(FLAGS) -ma -v -o$@ RAM:$*.c
   @delete RAM:$*.c     # pour ne pas effacer le source, commentaire ici.
   @echo "|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\"

# extension pour fonction de tâche utiliser geta4()

# extension pour fonction de bibliothèque; passage de paramètre par pile (-mr)
.cpr.o:
   @echo "$D"
   @echo "Préprocesseur en cours..."
   @cpp <$*.cpr >RAM:$*.p -f$* \
    -dc_plusplus=1 -dLATTICE -d$D \
    -iCPinclude:
   @echo ">Terminé"

   @echo "CFront en cours..."
   @CFront <RAM:$*.p +f$*.cpr +LM RAM:$*.c
   @echo ">Terminé"
   @delete RAM:$*.p

   @grep >$*.chg [(].*[)]$$ RAM:$*.c
   @grep >>$*.chg ^register[\0x20]* RAM:$*.c
   @echo >>$*.chg "Pour empêcher que la commande sort plante"
   @sort $*.chg $*.chg
   @grep -n [0-9] $*.chg
   @copy RAM:$*.c $*.c
   @splat -o "^register[ ]*" "" $*.c
   @echo "-- Vérification par ligne de la subsitution de 'register' par ''"
   @copy $*.chg $*.chg.verif
   @splat -o "[ ][ ]" "grep -q " $*.chg.verif
   @splat -o "[:].*" " RAM:$*.c.verif\n" $*.chg.verif
   @splat -o "^[!g].*" "" $*.chg.verif
   @grep >RAM:$*.c.verif . $*.c
   @execute $*.chg.verif
   @delete RAM:$*.c.verif
   @delete $*.chg
   @delete $*.chg.verif

   @copy $*.c RAM:$*.c
   @delete $*.c         # pour ne pas effacer le source, commentaire ici.

   LC -RLIB:exec.lib $(FLAGS) -mar -v -o$@ RAM:$*.c
   @delete RAM:$*.c
   @echo "|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\"

.a.o:
   @asm $*
   oml lib:exec.lib R $*.o
   @echo "|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\|\/|/\"

