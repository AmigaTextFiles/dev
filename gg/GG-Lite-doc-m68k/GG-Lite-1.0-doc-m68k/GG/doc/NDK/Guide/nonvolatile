@DATABASE "gg:doc/NDK/Guide/nonvolatile"
@MASTER   "gg:doc/NDK/AutoDocs/nonvolatile.doc"
@REMARK   This file was created by ADtoHT 2.1 on 06-Jan-13 19:24:32
@REMARK   Do not edit
@REMARK   ADtoHT is © 1993-1995 Christian Stieber

@NODE MAIN "nonvolatile.doc"
@TOC "gg:doc/NDK/Guide/TOC/MAIN"

                             @{b}nonvolatile.library@{ub}

@{"background" LINK "background"}

@{"DeleteNV()" LINK "DeleteNV"}         @{"FreeNVData()" LINK "FreeNVData"}  @{"GetCopyNV()" LINK "GetCopyNV"}  @{"GetNVInfo()" LINK "GetNVInfo"}  @{"GetNVList()" LINK "GetNVList"}
@{"SetNVProtection()" LINK "SetNVProtection"}  @{"StoreNV()" LINK "StoreNV"}     

@ENDNODE
@NODE "background" "nonvolatile.library/background (information)"


   PURPOSE
        The nonvolatile library provides a simple means for an application
        developer to manage nonvolatile storage.

   OVERVIEW
        The nonvolatile library is meant to be used transparently across all
        configurations. Currently, nonvolatile storage may consist of NVRAM
        and/or disk devices. @{"nonvolatile.library" LINK "gg:doc/NDK/Guide/nonvolatile/MAIN"} will automatically
        access the best nonvolatile storage available in the system. Disk
        based storage will be selected first and if not available, NVRAM
        storage will be accessed.

        * NVRAM

        On low-end diskless Amiga platforms, NVRAM may be available. This
        RAM will maintain its data contents when the system is powered down.
        This is regardless of whether batteries or battery-backed clock are
        present. The data stored in NVRAM is accessible only through the
        ROM-based nonvolatile library funtion calls. The size of NVRAM
        storage is dependant on the system platform and is attainable through
        the @{"GetNVInfo()" LINK "gg:doc/NDK/Guide/nonvolatile/GetNVInfo"} function.

        * Disk

        In keeping with the general configurability of the Amiga, the actual
        disk location used by nonvolatile library when storing to disk may be
        changed by the user.

        The prefs directory is used on the Amiga for storing many user
        configurable options. The location for nonvolatile disk storage
        is contained in the file prefs/env-archive/sys/nv_location. This
        file should contain a data string that specifies a lockable location.
        If the string does not specify a lockable location, the file will
        be ignored.

        When opened, the nonvolatile library will search all drives within
        the system until it finds this file and successfully accomplishes
        a Lock on the location specified in the file. To force a rescan of
        all drives, the library may be closed and reopened or execute the
        @{"GetNVInfo()" LINK "gg:doc/NDK/Guide/nonvolatile/GetNVInfo"} function.

        A simple method for creating a floppy disk for saving nonvolatile
        data is the following:

        Format a disk with the volume name NV
        Create a file prefs/env-archive/sys/nv_location on this disk with
          the following contents:  NV:nonvolatile
        Create a directory nonvolatile

        The following is a script file that can be used to make a floppy
        for use with nonvolatile library:

        .KEY DRIVE/A,DISK
        .BRA {
        .KET }
        format Drive {DRIVE} Name {DISK$NV} noicons ffs
        makedir {DRIVE}prefs
        makedir {DRIVE}nonvolatile
        makedir {DRIVE}prefs/env-archive
        makedir {DRIVE}prefs/env-archive/sys
        echo {DISK$NV}:nonvolatile >{DRIVE}prefs/env-archive/sys/nv_location

        !!!NOTE!!!

        Because NVRAM performs disk access, you must open and use its
        functionality from a DOS process, not an EXEC task.  Normally
        your CDGS application is invoked as a DOS process so this
        requirement generally should cause you no concern.  You just
        need to be aware of this requirement should you create an
        EXEC task and try to invoke @{"nonvolatile.library" LINK "gg:doc/NDK/Guide/nonvolatile/MAIN"} from that task.

@ENDNODE
@NODE "DeleteNV" "nonvolatile.library/DeleteNV()"
@{b}

   NAME@{ub}
        @{"DeleteNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 38} -- remove an entry from nonvoltatile storage. (V40)@{b}

   SYNOPSIS@{ub}
        success = @{"DeleteNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 38}(appName, itemName, killRequesters);
        D0                 A0       A1        D1

        @{"BOOL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 91} @{"DeleteNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 38}(@{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"BOOL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 91});@{b}

   FUNCTION@{ub}
        Searches the nonvolatile storage for the indicated entry and removes
        it.

        The strings appName and itemName may not contain the '/' or ':'
        characters. It is recommended that these characters be blocked
        from user input when requesting AppName and ItemName strings.@{b}

   INPUTS@{ub}
        appName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string identifing the application that
                  created the data. Maximum length is 31.
        ItemName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string uniquely identifing the data
                   within the application. Maximum length is 31.
        killRequesters - suppress system requesters flag. @{"TRUE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 95} if all system
                         requesters are to be suppressed during this function.
                         @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98} if system requesters are allowed.@{b}

   RESULT@{ub}
        success - @{"TRUE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 95} will be returned if the entry is found and deleted.
                  If the entry is not found, @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98} will be returned.

@ENDNODE
@NODE "FreeNVData" "nonvolatile.library/FreeNVData()"
@{b}

   NAME@{ub}
        @{"FreeNVData" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 30} -- release the memory allocated by a function of this
                      library. (V40)@{b}

   SYNOPSIS@{ub}
        @{"FreeNVData" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 30}(data);
                   A0

        @{"VOID" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 24} @{"FreeNVData" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 30}(@{"APTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 49});@{b}

   FUNCTION@{ub}
        Frees a block of memory that was allocated by any of the following:
        @{"GetCopyNV()" LINK "GetCopyNV"}, @{"GetNVInfo()" LINK "GetNVInfo"}, @{"GetNVList()" LINK "GetNVList"}.@{b}

   INPUTS@{ub}
        data - pointer to the memory block to be freed. If passed @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101},
               this function does nothing.@{b}

   SEE ALSO@{ub}
        @{"GetCopyNV()" LINK "GetCopyNV"}, @{"GetNVInfo()" LINK "GetNVInfo"}, @{"GetNVList()" LINK "GetNVList"}

@ENDNODE
@NODE "GetCopyNV" "nonvolatile.library/GetCopyNV()"
@{b}

   NAME@{ub}
        @{"GetCopyNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 26} -- return a copy of an item stored in nonvolatile storage.
                     (V40)@{b}

   SYNOPSIS@{ub}
        data = @{"GetCopyNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 26}(appName, itemName, killRequesters);
        D0               A0       A1        D1

        @{"APTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 49} @{"GetCopyNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 26}(@{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"BOOL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 91});@{b}

   FUNCTION@{ub}
        Searches the nonvolatile storage for the indicated appName and
        itemName. A pointer to a copy of this data will be returned.

        The strings appName and itemName may not contain the '/' or ':'
        characters. It is recommended that these characters be blocked
        from user input when requesting appName and itemName strings.@{b}

   INPUTS@{ub}
        appName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string indicating the application name
                  to be found. Maximum length is 31.
        itemName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string indicated the item within the
                   application to be found. Maximum length is 31.
        killRequesters - Suppress system requesters flag. @{"TRUE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 95} if all system
                         requesters are to be suppressed during this function.
                         @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98} if system requesters are allowed.@{b}

   RESULT@{ub}
        data - pointer to a copy of the data found in the nonvolatile storage
               assocated with appName and itemName. @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} will be returned
               if there is insufficient memory or the appName/itemName does
               not exist.@{b}

   SEE ALSO@{ub}
        @{"FreeNVData()" LINK "FreeNVData"}, <@{"libraries/nonvolatile.h" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File"}>

@ENDNODE
@NODE "GetNVInfo" "nonvolatile.library/GetNVInfo()"
@{b}

   NAME@{ub}
        @{"GetNVInfo" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 42} -- report information on the current nonvolatile storage.
                     (V40)@{b}

   SYNOPSIS@{ub}
        information = @{"GetNVInfo" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 42}(killRequesters);
        D0                      D1

        @{"struct NVInfo" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File" 29} *@{"GetNVInfo" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 42}(@{"BOOL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 91});@{b}

   FUNCTION@{ub}
        Finds the user's preferred nonvolatile device and reports information
        about it.@{b}

   INPUTS@{ub}
        killRequesters - suppress system requesters flag. @{"TRUE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 95} if all system
                         requesters are to be suppressed during this function.
                         @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98} if system requesters are allowed.@{b}

   RESULT@{ub}
        information - pointer to an NVInfo structure. This structure contains
                      information on the NV storage media with the largest
                      storage. The structure contains 2 longword fields:
                      nvi_MaxStorage and nvi_FreeStorage. Both values are
                      rounded down to the nearest ten. The nvi_MaxStorage
                      field is defined as the total amount of nonvolatile
                      storage available on this device. The nvi_FreeStorage is
                      defined as the amount of available space for NVDISK or
                      the amount of non-locked storage for NVRAM. For NVDISK,
                      the nvi_FreeStorage takes into account the amount of
                      overhead room required to store a new App/Item. This
                      amount is 3 blocks to allow room for storing a new Item
                      file and possibly a new App directory. For NVRAM, the
                      amount of overhead is 5 bytes. However, the amount of
                      room required to store a new NVRAM item depends on the
                      length of the App and Item names. Refer to @{"StoreNV()" LINK "StoreNV"}
                      function for storage details.

                      This function may return @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} in the case of failure.@{b}

   SEE ALSO@{ub}
        @{"FreeNVData()" LINK "FreeNVData"}, @{"StoreNV()" LINK "StoreNV"}, <@{"libraries/nonvolatile.h" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File"}>

@ENDNODE
@NODE "GetNVList" "nonvolatile.library/GetNVList()"
@{b}

   NAME@{ub}
        @{"GetNVList" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 46} -- return a list of the items stored in nonvolatile
                     storage. (V40)@{b}

   SYNOPSIS@{ub}
        list = @{"GetNVList" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 46}(appName, killRequesters);
        D0               A0       D1

        @{"struct MinList" LINK "gg:doc/NDK/Guide/Include/exec/lists.h/File" 31} *@{"GetNVList" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 46}(@{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"BOOL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 91});@{b}

   FUNCTION@{ub}
        Returns a pointer to an Exec list of nonvolatile Items associated
        with the appName requested.

        The string appName may not contain the '/' or ':' characters.
        It is recommended that these characters be blocked from user input
        when requesting an appName string.@{b}

   INPUTS@{ub}
        appName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string indicating the application name
                  to be matched. Maximum length is 31.
        killRequesters - Suppress system requesters flag. @{"TRUE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 95} if all system
                         requesters are to be suppressed during this function.
                         @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98} if system requesters are allowed.@{b}

   RESULT@{ub}
        list - a pointer to an Exec MinList of NVEntries. A @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} will be
               returned if there is insufficient memory. If there are no
               entries in the nonvolatile storage for the AppName, an
               empty list will be returned.@{b}

   NOTE@{ub}
        The protection field contains more bits than are required for
        storing the delete protection status. These bits are reserved
        for other system usage and may not be zero. When checking for
        the delete status use either the field mask NVIF_DELETE, or the
        bit definition NVIB_DELETE.@{b}

   SEE ALSO@{ub}
        @{"FreeNVData()" LINK "FreeNVData"}, @{"SetNVProtection()" LINK "SetNVProtection"}

@ENDNODE
@NODE "SetNVProtection" "nonvolatile.library/SetNVProtection()"
@{b}

   NAME@{ub}
        @{"SetNVProtection" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 50} -- set the protection flags. (V40)@{b}

   SYNOPSIS@{ub}
        success = @{"SetNVProtection" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 50}(appName, itemName, mask, killRequesters);
        D0                        A0       A1        D2    D1

        @{"BOOL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 91} @{"SetNVProtection" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 50}(@{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"LONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 51}, @{"BOOL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 91});@{b}

   FUNCTION@{ub}
        Sets the protection attributes for an item currently in the
        nonvolatile storage.

        Although 'mask' is @{"LONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 51} only the delete bit, @{"NVEF_DELETE" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File" 53}/@{"NVEB_DELETE" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File" 50},
        may be set. If any other bits are set this function will return
        @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98}.

        The strings appName and itemName may not contain the '/' or ':'
        characters. It is recommended that these characters be blocked
        from user input when requesting AppName and ItemName strings.@{b}

   INPUTS@{ub}
        appName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string indicating the application name
                  to be matched. Maximum length is 31.
        itemName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string indicated the item within the
                   application to be found. Maximum length is 31.
        mask - the new protection mask. Only set the delete bit otherwise
               this function WILL CRASH.
        killRequesters - suppress system requesters flag. @{"TRUE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 95} if all system
                         requesters are to be suppressed during this function.
                         @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98} if system requesters are allowed.@{b}

   RESULT@{ub}
        success - @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98} if the protection could not be change (ie the data
                  does not exist).@{b}

   SEE ALSO@{ub}
        @{"GetNVList()" LINK "GetNVList"}, <@{"libraries/nonvolatile.h" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File"}>

@ENDNODE
@NODE "StoreNV" "nonvolatile.library/StoreNV()"
@{b}

   NAME@{ub}
        @{"StoreNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 34} -- store data in nonvolatile storage. (V40)@{b}

   SYNOPSIS@{ub}
        error = @{"StoreNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 34}(appName, itemName, data, length, killRequesters);
        D0              A0       A1        A2    D0      D1

        @{"UWORD" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 55} @{"StoreNV" LINK "gg:doc/NDK/Guide/Include/inline/nonvolatile.h/File" 34}(@{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"APTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 49}, @{"ULONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 52}, @{"BOOL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 91});@{b}

   FUNCTION@{ub}
        Saves some data in nonvolatile storage. The data is tagged with
        AppName and ItemName so it can be retrieved later. No single
        item should be larger than one fourth of the maximum storage as
        returned by @{"GetNVInfo()" LINK "GetNVInfo"}.

        There is no data compression associated with this function.

        The strings, AppName and ItemName, should be short, but descriptive.
        They need to be short since the string is stored with the data and
        the nonvolatile storage for a stand alone game system is limited.
        The game system allows the user to selectively remove entries from
        storage, so the string should be desriptive.

        The strings AppName and ItemName may not contain the '/' or ':'
        characters. It is recommended that these characters be blocked
        from user input when requesting AppName and ItemName strings.@{b}

   INPUTS@{ub}
        appName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string identifying the application
                  creating the data. Maximum length is 31.
        itemName - @{"NULL" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 101} terminated string uniquely identifying the data
                   within the application. Maximum length is 31.
        data - pointer to the memory block to be stored.
        length - number of bytes to be stored in the units of tens of
                 bytes. For example, if you have 23 bytes to store length = 3;
                 147 byte then length = 15.
        killRequesters - suppress system requesters flag. @{"TRUE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 95} if all system
                         requesters are to be suppressed during this function.
                         @{"FALSE" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 98} if system requesters are allowed.@{b}

   RESULT@{ub}
        error - 0                means no error,
                @{"NVERR_BADNAME" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File" 61}    error in AppName, or ItemName.
                @{"NVERR_WRITEPROT" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File" 62}  Nonvolatile storage is read only.
                @{"NVERR_FAIL" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File" 63}       Failure in writing data (nonvolatile storage
                                 full, or write protected).
                @{"NVERR_FATAL" LINK "gg:doc/NDK/Guide/Include/libraries/nonvolatile.h/File" 64}      Fatal error when accessing nonvolatile
                                 storage, possible loss of previously saved
                                 nonvolatile data.@{b}

   SEE ALSO@{ub}
        @{"GetCopyNV()" LINK "GetCopyNV"}, @{"GetNVInfo()" LINK "GetNVInfo"}

@ENDNODE
