@DATABASE "gg:doc/NDK/Guide/timer"
@MASTER   "gg:doc/NDK/AutoDocs/timer.doc"
@REMARK   This file was created by ADtoHT 2.1 on 06-Jan-13 19:25:15
@REMARK   Do not edit
@REMARK   ADtoHT is © 1993-1995 Christian Stieber

@NODE MAIN "timer.doc"
@TOC "gg:doc/NDK/Guide/TOC/MAIN"

                                @{b}timer.device@{ub}

@{"background" LINK "background"}

@{"AbortIO()" LINK "AbortIO"}  @{"AddTime()" LINK "AddTime"}      @{"CmpTime()" LINK "CmpTime"}      @{"GetSysTime()" LINK "GetSysTime"}   @{"ReadEClock()" LINK "ReadEClock"}
@{"SubTime()" LINK "SubTime"}  @{"TR_ADDREQUEST" LINK "TR_ADDREQUEST"}  @{"TR_GETSYSTIME" LINK "TR_GETSYSTIME"}  @{"TR_SETSYSTIME" LINK "TR_SETSYSTIME"}  

@ENDNODE
@NODE "background" "timer.device/background (information)"


   TIMER REQUEST
        A time request is a non standard IO Request.  It has an IORequest
        followed by a timeval structure or an eclockval structure.

   TIMEVAL
        A timeval structure consists of two longwords.  The first is
        the number of seconds, the latter is the fractional number
        of microseconds.  The microseconds must always be "normalized"
        e.g. the longword must be between 0 and one million.

   ECLOCKVAL
        A eclockval structure consists of two longwords.  The first is
        the high order 32 bits of a 64 bit number and the second is the
        the low order 32 bits.  The 64 bit number is a count of "E" clock
        ticks.  The "E" clock frequency is related to the master clock
        frequency of the machine and can be determined by calling the
        @{"ReadEClock()" LINK "gg:doc/NDK/Guide/timer/ReadEClock"} library like call.

   UNITS
        The timer contains five units -- two designed to accuratly measure
        short intervals, one that has little system overhead and is very
        stable over time, and two that work like an alarm clock.

   @{"UNIT_MICROHZ" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 22}
        This unit uses the programmable timers in the 8520s to keep track
        of its time.  It has precision down to about 2 microseconds, but
        will drift as system load increases.  The accuracy of this unit
        is the same as that of the master clock of the machine.  This unit
        uses a timeval in its timerequest.

   @{"UNIT_VBLANK" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 23}
        This unit uses a strobe from the power supply to keep track of its
        time or the "E" clock on machines without power supply strobes.
        It is very stable over time, but only has a resolution of that of
        the vertical blank interrupt.  This unit is very cheap to use, and
        should be used by those who are waiting for long periods of time
        (typically 1/2 second or more).  This unit uses a timeval in its
        timerequest.

   @{"UNIT_ECLOCK" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 24}
        This unit is exacly the same as @{"UNIT_MICROHZ" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 22} except that it uses
        an eclockval instead of a timeval in its timerequest.

   @{"UNIT_WAITUNTIL" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 25}
        This unit waits until the systime is greater than or equal to the
        time in the timeval in the timerequest.  This unit has the same
        resolution and accuracy as that of @{"UNIT_VBLANK" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 23}.

   @{"UNIT_WAITECLOCK" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 26}
        This unit waits until the E-Clock value as returned by @{"ReadEClock()" LINK "gg:doc/NDK/Guide/timer/ReadEClock"}
        is greater than or equal to the eclockval in the timerequest. This
        unit has the same resolution and accuracy as that of @{"UNIT_ECLOCK" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 24}.

   LIBRARY
        In addition to the normal device calls, the timer also supports
        several direct, library like calls.

   BUGS
        In the V1.2/V1.3 release, the timer device has problems with
        very short time requests.  When one of these is made, other
        timer requests may be finished inaccurately.  A side effect
        is that AmigaDOS requests such as "@{"Delay" LINK "gg:doc/NDK/Guide/dos/Delay"}(0);" or
        "@{"WaitForChar" LINK "gg:doc/NDK/Guide/dos/WaitForChar"}(x,0);" are unreliable.

@ENDNODE
@NODE "AbortIO" "timer.device/AbortIO()"
@{b}

   NAME@{ub}
        @{"AbortIO" LINK "gg:doc/NDK/Guide/exec/AbortIO"} -- Remove an existing timer request.@{b}

   SYNOPSIS@{ub}
        error = @{"AbortIO" LINK "gg:doc/NDK/Guide/exec/AbortIO"}( timerequest )
        D0               A1

        @{"LONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 51} @{"AbortIO" LINK "gg:doc/NDK/Guide/exec/AbortIO"}( @{"struct timerequest" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 40} * );@{b}

   FUNCTION@{ub}
        This is an @{"exec.library" LINK "gg:doc/NDK/Guide/exec/MAIN"} call.

        This routine removes a timerquest from the timer.  It runs in
        the context of the caller.@{b}

   INPUTS@{ub}
        timerequest - the timer request to be aborted@{b}

   RETURNS@{ub}
        0  if the request was aborted, io_Error will also be set to
            @{"IOERR_ABORTED" LINK "gg:doc/NDK/Guide/Include/exec/errors.h/File" 14}.
        -1 otherwise@{b}

   NOTES@{ub}
        This function may be called from interrupts.@{b}

   SEE ALSO@{ub}
        @{"exec.library/AbortIO()" LINK "gg:doc/NDK/Guide/exec/AbortIO"}@{b}

   BUGS@{ub}

@ENDNODE
@NODE "AddTime" "timer.device/AddTime()"
@{b}

   NAME@{ub}
        @{"AddTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 20} -- Add one time request to another.@{b}

   SYNOPSIS@{ub}
        @{"AddTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 20}( Dest, Source )
                 A0    A1

        void @{"AddTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 20}( @{"struct timeval" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 30} *, @{"struct timeval" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 30} *);@{b}

   FUNCTION@{ub}
        This routine adds one timeval structure to another.  The
        results are stored in the destination (Dest + Source -> Dest)

        A0 and A1 will be left unchanged@{b}

   INPUTS@{ub}
        Dest, Source -- pointers to timeval structures.@{b}

   NOTES@{ub}
        This function may be called from interrupts.@{b}

   SEE ALSO@{ub}
        @{"timer.device/CmpTime()" LINK "CmpTime"},
        @{"timer.device/SubTime()" LINK "SubTime"}@{b}

   BUGS@{ub}

@ENDNODE
@NODE "CmpTime" "timer.device/CmpTime()"
@{b}

   NAME@{ub}
        @{"CmpTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 28} -- Compare two timeval structures.@{b}

   SYNOPSIS@{ub}
        result = @{"CmpTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 28}( Dest, Source )
        D0                A0    A1

        @{"LONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 51} @{"CmpTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 28}( @{"struct timeval" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 30} *, @{"struct timeval" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 30} *);@{b}

   FUNCTION@{ub}
        This routine compares timeval structures

        A0 and A1 will be left unchanged@{b}

   INPUTS@{ub}
        Dest, Source -- pointers to timeval structures.@{b}

   RESULTS@{ub}
        result will be   0 if Dest has same time as source
                        -1 if Dest has more time than source
                        +1 if Dest has less time than source@{b}

   NOTES@{ub}
        This function may be called from interrupts.@{b}

   SEE ALSO@{ub}
        @{"timer.device/AddTime()" LINK "AddTime"},
        @{"timer.device/SubTime()" LINK "SubTime"}@{b}

   BUGS@{ub}
        Older version of this document had the sense of the return
        codes wrong; the code hasn't changed but the document has.

@ENDNODE
@NODE "GetSysTime" "timer.device/GetSysTime()"
@{b}

   NAME@{ub}
        @{"GetSysTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 36} -- Get the system time. (V36)@{b}

   SYNOPSIS@{ub}
        @{"GetSysTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 36}( Dest )
                    A0

        void @{"GetSysTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 36}( @{"struct timeval" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 30} * );@{b}

   FUNCTION@{ub}
        Ask the system what time it is.  The system time starts off at
        zero at power on, but may be initialized via the @{"TR_SETSYSTIME" LINK "TR_SETSYSTIME"}
        timer.device command.

        System time is monotonocally increasing and guarenteed to be
        unique (except when the system time is set back).

        A0 will be left unchanged.

        This function is less expensive to use than the @{"TR_GETSYSTIME" LINK "TR_GETSYSTIME"}
        IORequest.@{b}

   INPUTS@{ub}
        Dest -- pointer to a timeval structure to hold the system time.@{b}

   RESULTS@{ub}
        Dest -- the timeval structure will contain the system time.@{b}

   NOTES@{ub}
        This function may be called from interrupts.@{b}

   SEE ALSO@{ub}
        @{"timer.device/TR_GETSYSTIME" LINK "TR_GETSYSTIME"},
        @{"timer.device/TR_SETSYSTIME" LINK "TR_SETSYSTIME"},@{b}

   BUGS@{ub}

@ENDNODE
@NODE "ReadEClock" "timer.device/ReadEClock()"
@{b}

   NAME@{ub}
        @{"ReadEClock" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 32} -- Get the current value of the E-Clock. (V36)@{b}

   SYNOPSIS@{ub}
        E_Freq = @{"ReadEClock" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 32}( Dest )
        D0                   A0

        @{"ULONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 52} @{"ReadEClock" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 32} ( @{"struct EClockVal" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 35} * );@{b}

   FUNCTION@{ub}
        This routine calculates the current 64 bit value of the E-Clock
        and stores it in the destination EClockVal structure. The count
        rate of the E-Clock is also returned.

        A0 will be left unchanged

        This is a low overhead function designed so that very short
        intervals may be timed.@{b}

   INPUTS@{ub}
        Dest -- pointer to an EClockVal structure.@{b}

   RETURNS@{ub}
        Dest -- the EClockVal structure will contain the E-Clock time
        E_Freq -- The count rate of the E-Clock (tics/sec).@{b}

   NOTES@{ub}
        This function may be called from interrupts.@{b}

   SEE ALSO@{ub}@{b}

   BUGS@{ub}

@ENDNODE
@NODE "SubTime" "timer.device/SubTime()"
@{b}

   NAME@{ub}
        @{"SubTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 24} -- Subtract one time request from another.@{b}

   SYNOPSIS@{ub}
        @{"SubTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 24}( Dest, Source )
                 A0    A1

        void @{"SubTime" LINK "gg:doc/NDK/Guide/Include/inline/timer.h/File" 24}( @{"struct timeval" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 30} *, @{"struct timeval" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 30} *);@{b}

   FUNCTION@{ub}
        This routine subtracts one timeval structure from another.  The
        results are stored in the destination (Dest - Source -> Dest)

        A0 and A1 will be left unchanged@{b}

   INPUTS@{ub}
        Dest, Source -- pointers to timeval structures.@{b}

   NOTES@{ub}
        This function may be called from interrupts.@{b}

   SEE ALSO@{ub}
        @{"timer.device/AddTime()" LINK "AddTime"},
        @{"timer.device/CmpTime()" LINK "CmpTime"}@{b}

   BUGS@{ub}

@ENDNODE
@NODE "TR_ADDREQUEST" "timer.device/TR_ADDREQUEST"
@{b}

   NAME@{ub}
        @{"TR_ADDREQUEST" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 46} -- Submit a request to wait a period of time.@{b}

   FUNCTION@{ub}
        Ask the timer to wait a specified amount of time before
        replying the timerequest.

        The message may be forced to finish early with an
        @{"AbortIO()" LINK "AbortIO"}/@{"WaitIO()" LINK "gg:doc/NDK/Guide/exec/WaitIO"} pair.@{b}

   TIMER REQUEST@{ub}
        io_Message      mn_ReplyPort initialized
        io_Device       preset by timer in @{"OpenDevice" LINK "gg:doc/NDK/Guide/exec/OpenDevice"}
        io_Unit         preset by timer in @{"OpenDevice" LINK "gg:doc/NDK/Guide/exec/OpenDevice"}
        io_Command      @{"TR_ADDREQUEST" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 46}
        io_Flags        @{"IOF_QUICK" LINK "gg:doc/NDK/Guide/Include/exec/io.h/File" 46} permitted (but ignored)
        tr_time         a timeval structure specifying how long the
                            device will wait before replying@{b}

   RESULTS@{ub}
        tr_time         will be zeroed@{b}

   NOTES@{ub}
        This function may be called from interrupts.

        Previous to 2.0, the tr_time field was documented as containing
        junk when the timerequest was returned.@{b}

   SEE ALSO@{ub}
        @{"timer.device/AbortIO()" LINK "AbortIO"},
        timer.device/TimeDelay(),@{b}

   BUGS@{ub}

@ENDNODE
@NODE "TR_GETSYSTIME" "timer.device/TR_GETSYSTIME"
@{b}

   NAME@{ub}
        @{"TR_GETSYSTIME" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 47} -- get the system time.@{b}

   FUNCTION@{ub}
        Ask the system what time it is.  The system time starts off at
        zero at power on, but may be initialized via the @{"TR_SETSYSTIME" LINK "TR_SETSYSTIME"}
        call.

        System time is monotonically increasing, and guaranteed to be
        unique (except when the system time is set backwards).@{b}

   TIMER REQUEST@{ub}
        io_Message      mn_ReplyPort initialized
        io_Device       preset by timer in @{"OpenDevice" LINK "gg:doc/NDK/Guide/exec/OpenDevice"}
        io_Unit         preset by timer in @{"OpenDevice" LINK "gg:doc/NDK/Guide/exec/OpenDevice"}
        io_Command      @{"TR_GETSYSTIME" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 47}
        io_Flags        @{"IOF_QUICK" LINK "gg:doc/NDK/Guide/Include/exec/io.h/File" 46} permitted@{b}

   RESULTS@{ub}
        tr_time         a timeval structure with the current system
                            time@{b}

   NOTES@{ub}
        This function may be called from interrupts.@{b}

   SEE ALSO@{ub}
        @{"timer.device/TR_SETSYSTIME" LINK "TR_SETSYSTIME"},
        @{"timer.device/GetSysTime()" LINK "GetSysTime"},@{b}

   BUGS@{ub}

@ENDNODE
@NODE "TR_SETSYSTIME" "timer.device/TR_SETSYSTIME"
@{b}

   NAME@{ub}
        @{"TR_SETSYSTIME" LINK "gg:doc/NDK/Guide/Include/devices/timer.h/File" 48} -- Set the system time.@{b}

   FUNCTION@{ub}
        Set the system idea of what time it is.  The system starts out
        at time "zero" so it is safe to set it forward to the real
        time.  However, care should be taken when setting the time
        backwards.  System time is generally expected to monotonically
        increasing.@{b}

   TIMER REQUEST@{ub}
        io_Message      mn_ReplyPort initialized
        io_Device       preset by timer in @{"OpenDevice" LINK "gg:doc/NDK/Guide/exec/OpenDevice"}
        io_Unit         preset by timer in @{"OpenDevice" LINK "gg:doc/NDK/Guide/exec/OpenDevice"}
        io_Command      @{"TR_GETSYSTIME" LINK "TR_GETSYSTIME"}
        io_Flags        @{"IOF_QUICK" LINK "gg:doc/NDK/Guide/Include/exec/io.h/File" 46} permitted
        tr_time         a timeval structure with the current system
                            time@{b}

   RESULTS@{ub}
        tr_time         will contain junk@{b}

   NOTES@{ub}
        This function may be called from interrupts.@{b}

   SEE ALSO@{ub}
        @{"timer.device/TR_GETSYSTIME" LINK "TR_GETSYSTIME"},
        @{"timer.device/GetSysTime()" LINK "GetSysTime"},@{b}

   BUGS@{ub}

@ENDNODE
