@DATABASE "gg:doc/NDK/Guide/keymap"
@MASTER   "gg:doc/NDK/AutoDocs/keymap.doc"
@REMARK   This file was created by ADtoHT 2.1 on 06-Jan-13 19:23:47
@REMARK   Do not edit
@REMARK   ADtoHT is © 1993-1995 Christian Stieber

@NODE MAIN "keymap.doc"
@TOC "gg:doc/NDK/Guide/TOC/MAIN"

                               @{b}keymap.library@{ub}

@{"AskKeyMapDefault()" LINK "AskKeyMapDefault"}  @{"MapANSI()" LINK "MapANSI"}  @{"MapRawKey()" LINK "MapRawKey"}  @{"SetKeyMapDefault()" LINK "SetKeyMapDefault"}

@ENDNODE
@NODE "AskKeyMapDefault" "keymap.library/AskKeyMapDefault()"
@{b}

   NAME@{ub}
        @{"AskKeyMapDefault" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 27} -- Ask for a pointer to the current default
                            keymap. (V36)@{b}

   SYNOPSIS@{ub}
        keyMap = @{"AskKeyMapDefault" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 27}()

        @{"struct KeyMap" LINK "gg:doc/NDK/Guide/Include/devices/keymap.h/File" 21} *@{"AskKeyMapDefault" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 27}( @{"VOID" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 24} );@{b}

   FUNCTION@{ub}
        Return a pointer to the keymap used by the keymap library for
        @{"MapRawKey" LINK "MapRawKey"} and @{"MapANSI" LINK "MapANSI"} when a keymap is not specified.@{b}

   RESULTS@{ub}
        keyMap - a pointer to a keyMap structure.  This key map is
            guaranteed to be permanently allocated: it will remain in
            memory till the machine is reset.@{b}

   BUGS@{ub}
        The keymap.h include file should be in the libraries/ or perhaps
        resources/ directory, but is in the devices/ directory for
        compatibility reasons.@{b}

   SEE ALSO@{ub}
        @{"devices/keymap.h" LINK "gg:doc/NDK/Guide/Include/devices/keymap.h/File"}, @{"keymap.library/SetKeyMapDefault()" LINK "SetKeyMapDefault"},
        @{"console.device" LINK "gg:doc/NDK/Guide/console/MAIN"} ...KEYMAP functions

@ENDNODE
@NODE "MapANSI" "keymap.library/MapANSI()"
@{b}

   NAME@{ub}
        @{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35} -- Encode an ANSI string into keycodes. (V36)@{b}

   SYNOPSIS@{ub}
        actual = @{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35}( string, count, buffer, length, keyMap )
        D0                A0      D0     A1      D1      A2

        @{"LONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 51} @{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35}( @{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"LONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 51}, @{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"LONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 51}, @{"struct KeyMap" LINK "gg:doc/NDK/Guide/Include/devices/keymap.h/File" 21} * );@{b}

   FUNCTION@{ub}
        This console function converts an ANSI byte string to the
        code/qualifier pairs of type @{"IECLASS_RAWKEY" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 31} that would
        generate the string and places those pairs in a buffer.
        A code/qualifier pair is a pair of bytes suitable for
        putting in the ie_Code and low byte of ie_Qualifier,
        and for subsequent events, shifted to the @{"ie_Prev1DownCode" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 282}/
        @{"ie_Prev1DownQual" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 283} then @{"ie_Prev2DownCode" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 284}/@{"ie_Prev2DownQual" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 285}
        pairs for any dead or double dead key mapping.@{b}


   INPUTS@{ub}
        string - the ANSI string to convert.
        count - the number of characters in the string.
        buffer - a byte buffer large enough to hold all anticipated
            code/qualifier pairs generated by this conversion.
        length - maximum anticipation, i.e. the buffer size in bytes
            divided by two (the size of the code/qualifier pair).
        keyMap - a KeyMap structure pointer, or null if the default
            key map is to be used.@{b}

   RESULT@{ub}
        actual - the number of code/qualifier pairs in the buffer,
            or negative to describe an error (see below).@{b}

   EXAMPLE@{ub}
        ...
        #include <@{"devices/inputevent.h" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File"}>

        #define STIMSIZE        3       /* two dead keys, one key */
        unsigned char rBuffer[STIMSIZE*2];
        ...
            KeymapBase = (@{"struct Library" LINK "gg:doc/NDK/Guide/Include/exec/libraries.h/File" 34} *) @{"OpenLibrary" LINK "gg:doc/NDK/Guide/exec/OpenLibrary"}("keymap.library", 0);
            ...
            event.ie_NextEvent = 0;
            event.ie_Class = @{"IECLASS_RAWKEY" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 31};
            event.ie_SubClass = 0;

            /* prove keymap code completeness and @{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35} reversibility */
            for (code = 0; code < 256; code++) {
                buffer[0] = code;
                actual = @{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35}(buffer, 1, rBuffer, STIMSIZE, 0);
                r = rBuffer;
                event.@{"ie_Prev2DownCode" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 284} = 0;
                event.@{"ie_Prev2DownQual" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 285} = 0;
                event.@{"ie_Prev1DownCode" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 282} = 0;
                event.@{"ie_Prev1DownQual" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 283} = 0;
                switch (actual) {
                    case -2:
                        @{"printf" LINK "gg:doc/NDK/Guide/amiga_lib/printf"}("@{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35} internal error");
                        goto reportChar;
                    case -1:
                        @{"printf" LINK "gg:doc/NDK/Guide/amiga_lib/printf"}("@{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35} overflow error");
                        goto reportChar;
                    case 0:
                        @{"printf" LINK "gg:doc/NDK/Guide/amiga_lib/printf"}("@{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35} ungeneratable code");
                        goto reportChar;

                    case 3:
                        event.@{"ie_Prev2DownCode" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 284} = *r++;
                        event.@{"ie_Prev2DownQual" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 285} = *r++;
                    case 2:
                        event.@{"ie_Prev1DownCode" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 282} = *r++;
                        event.@{"ie_Prev1DownQual" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 283} = *r++;
                    case 1:
                        event.ie_Code = *r++;
                        event.ie_Qualifier = *r;

                        actual = @{"MapRawKey" LINK "MapRawKey"}(&event, buffer, BUFFERLEN, 0);
                        if ((actual != 1) || (buffer[0] != code)) {
                            @{"printf" LINK "gg:doc/NDK/Guide/amiga_lib/printf"}("@{"MapANSI" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 35} not reversible");
                            for (i = 0; i < actual; i++)
                                ReportChar(buffer[i]);
                            @{"printf" LINK "gg:doc/NDK/Guide/amiga_lib/printf"}(" from");
        reportChar:
                            ReportChar(code);
                            @{"printf" LINK "gg:doc/NDK/Guide/amiga_lib/printf"}("\\n");
                        }
                }
            }
        ...@{b}

   ERRORS@{ub}
        if actual is 0, a character in the string was not generatable
            from the keyMap.
        if actual is -1, a buffer overflow condition was detected.
        if actual is -2, an internal error occurred (e.g. no memory)@{b}

   SEE ALSO@{ub}
        @{"devices/inputevent.h" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File"}, @{"devices/keymap.h" LINK "gg:doc/NDK/Guide/Include/devices/keymap.h/File"}

@ENDNODE
@NODE "MapRawKey" "keymap.library/MapRawKey()"
@{b}

   NAME@{ub}
        @{"MapRawKey" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 31} -- Decode single raw key input event to an ANSI
                     string. (V36)@{b}

   SYNOPSIS@{ub}
        actual = @{"MapRawKey" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 31}(event, buffer, length, keyMap)
        D0                 A0     A1      D1      A2

        @{"WORD" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 54} @{"MapRawKey" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 31}( @{"struct InputEvent" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 257} *, @{"STRPTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 67}, @{"WORD" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 54},
            struct Keymap * );@{b}

   FUNCTION@{ub}
        This console function converts input events of type
        @{"IECLASS_RAWKEY" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 31} to ANSI bytes, based on the keyMap, and
        places the result into the buffer.@{b}

   INPUTS@{ub}
        event -  an InputEvent structure pointer.  The event list is
            not traversed.
        buffer - a byte buffer large enough to hold all anticipated
            characters generated by this conversion.
        length - maximum anticipation, i.e. the buffer size in bytes.
        keyMap - a KeyMap structure pointer, or null if the default
            key map is to be used.@{b}

   RESULT@{ub}
        actual - the number of characters in the buffer, or -1 if
            a buffer overflow was about to occur.@{b}

   EXAMPLE@{ub}
        ...
        #define BUFFERLEN       80      /* length of longest expected mapping /*
        char buffer[BUFFERLEN];
        @{"struct InputEvent" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 257} ie;
        ...
            KeymapBase = @{"OpenLibrary" LINK "gg:doc/NDK/Guide/exec/OpenLibrary"}("keymap.library", 0);
            ...
            ie.ie_Class = @{"IECLASS_RAWKEY" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 31};
            ie.ie_SubClass = 0;
            for (;;) {
                @{"WaitPort" LINK "gg:doc/NDK/Guide/exec/WaitPort"}(window->UserPort);
                while (im = (@{"struct IntuiMessage" LINK "gg:doc/NDK/Guide/Include/intuition/intuition.h/File" 763} *) @{"GetMsg" LINK "gg:doc/NDK/Guide/exec/GetMsg"}(window->UserPort)) {
                    switch (im->Class) {
                        case @{"RAWKEY" LINK "gg:doc/NDK/Guide/Include/intuition/iobsolete.h/File" 119}:
                            ie.ie_Code = im->Code;
                            ie.ie_Qualifier = im->Qualifier;
                            /* recover dead key codes & qualifiers */
                            ie.@{"ie_EventAddress" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File" 281} = (@{"APTR" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 49} *) *((@{"ULONG" LINK "gg:doc/NDK/Guide/Include/exec/types.h/File" 52} *)im->IAddress);
                            actual = @{"MapRawKey" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 31}(&ie, buffer, BUFFERLEN, 0);
                            for (i = 0; i < actual; i++)
                                ReportChar(buffer[i]);
                            break;
                        ...
                    }
                    ...
                }
            }@{b}

   ERRORS@{ub}
        if actual is -1, a buffer overflow condition was detected.
        Not all of the characters in the buffer are valid.@{b}

   SEE ALSO@{ub}
        @{"devices/inputevent.h" LINK "gg:doc/NDK/Guide/Include/devices/inputevent.h/File"}, @{"devices/keymap.h" LINK "gg:doc/NDK/Guide/Include/devices/keymap.h/File"}

@ENDNODE
@NODE "SetKeyMapDefault" "keymap.library/SetKeyMapDefault()"
@{b}

   NAME@{ub}
        @{"SetKeyMapDefault" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 23} -- Set the current default keymap. (V36)@{b}

   SYNOPSIS@{ub}
        @{"SetKeyMapDefault" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 23}(keyMap)

        void @{"SetKeyMapDefault" LINK "gg:doc/NDK/Guide/Include/inline/keymap.h/File" 23}( @{"struct KeyMap" LINK "gg:doc/NDK/Guide/Include/devices/keymap.h/File" 21} * );@{b}

   FUNCTION@{ub}
        A pointer to key map specified is cached by the keymap library
        for use by @{"MapRawKey" LINK "MapRawKey"} and @{"MapANSI" LINK "MapANSI"} when a keymap is not specified.@{b}

   INPUTS@{ub}
        keyMap - a pointer to a keyMap structure.  This key map must be
            permanently allocated: it must remain in memory till the
            machine is reset.  It is appropriate that this keyMap be a
            node on the keymap.resource list.@{b}

   BUGS@{ub}
        The keymap.h include file should be in the libraries/ or perhaps
        resources/ directory, but is in the devices/ directory for
        compatability reasons.@{b}

   SEE ALSO@{ub}
        @{"devices/keymap.h" LINK "gg:doc/NDK/Guide/Include/devices/keymap.h/File"}, @{"keymap.library/AskKeyMapDefault()" LINK "AskKeyMapDefault"},
        @{"console.device" LINK "gg:doc/NDK/Guide/console/MAIN"} ...KEYMAP functions

@ENDNODE
