@database gdbint.guide

@Master /gg-src/gg/fsf/gdb/gdb/doc/gdbint.texinfo

@Width 72


This is the AmigaGuide®  file gdbint.guide, produced by Makeinfo-1.68 from 
the input file /gg-src/gg/fsf/gdb/gdb/doc/gdbint.texinfo.

START-INFO-DIR-ENTRY
* Gdb-Internals: (gdbint).	The GNU debugger's internals.
END-INFO-DIR-ENTRY

   This file documents the internals of the GNU debugger GDB.

   Copyright 1990, 1991, 1992, 1993, 1994 Free Software Foundation, Inc.
Contributed by Cygnus Support.  Written by John Gilmore.

   Permission is granted to make and distribute verbatim copies of this
manual provided the copyright notice and this permission notice are
preserved on all copies.

   Permission is granted to copy or distribute modified versions of this
manual under the terms of the GPL (for which purpose this text may be
regarded as a program in the language TeX).

@node Main "gdbint.guide"
@next "README"

Scope of this Document
**********************

   This document documents the internals of the GNU debugger, GDB.  It
is intended to document aspects of GDB which apply across many different
parts of GDB (for example, see @{"Coding Style" link "Coding Style"}), or which are global
aspects of design (for example, what are the major modules and which
files document them in detail?).  Information which pertains to specific
data structures, functions, variables, etc., should be put in comments
in the source code, not here.  It is more likely to get noticed and kept
up to date there.  Some of the information in this document should
probably be moved into comments.


 @{" README              " link "README"}  The README File
 @{" Getting Started     " link "Getting Started"}  Getting started working on GDB
 @{" Debugging GDB       " link "Debugging GDB"}  Debugging GDB with itself
 @{" New Architectures   " link "New Architectures"}  Defining a New Host or Target Architecture
 @{" Config              " link "Config"}  Adding a New Configuration
 @{" Host                " link "Host"}  Adding a New Host
 @{" Native              " link "Native"}  Adding a New Native Configuration
 @{" Target              " link "Target"}  Adding a New Target
 @{" Languages           " link "Languages"}  Defining New Source Languages
 @{" Releases            " link "Releases"}  Configuring GDB for Release
 @{" Partial Symbol Tables " link "Partial Symbol Tables"}  How GDB reads symbols quickly at startup
 @{" Types               " link "Types"}  How GDB keeps track of types
 @{" BFD support for GDB " link "BFD support for GDB"}  How BFD and GDB interface
 @{" Symbol Reading      " link "Symbol Reading"}  Defining New Symbol Readers
 @{" Cleanups            " link "Cleanups"}  Cleanups
 @{" Wrapping            " link "Wrapping"}  Wrapping Output Lines
 @{" Frames              " link "Frames"}  Keeping track of function calls
 @{" Remote Stubs        " link "Remote Stubs"}  Code that runs in targets and talks to GDB
 @{" Longjmp Support     " link "Longjmp Support"}  Stepping through longjmp's in the target
 @{" Coding Style        " link "Coding Style"}  Strunk and White for GDB maintainers
 @{" Clean Design        " link "Clean Design"}  Frank Lloyd Wright for GDB maintainers
 @{" Submitting Patches  " link "Submitting Patches"}  How to get your changes into GDB releases
 @{" Host Conditionals   " link "Host Conditionals"}  What features exist in the host
 @{" Target Conditionals " link "Target Conditionals"}  What features exist in the target
 @{" Native Conditionals " link "Native Conditionals"}  Conditionals for when host and target are same
 @{" Obsolete Conditionals " link "Obsolete Conditionals"}  Conditionals that don't exist any more
 @{" XCOFF               " link "XCOFF"}  The Object file format used on IBM's RS/6000


@endnode

@node "README" "gdbint.guide/README"
@next "Getting Started"
@prev "Main"
@toc "Main"

The @{b}README@{ub} File
***************

   Check the @{b}README@{ub} file, it often has useful information that does not
appear anywhere else in the directory.


@endnode

@node "Getting Started" "gdbint.guide/Getting Started"
@next "Debugging GDB"
@prev "README"
@toc "Main"

Getting Started Working on GDB
******************************

   GDB is a large and complicated program, and if you first starting to
work on it, it can be hard to know where to start.  Fortunately, if you
know how to go about it, there are ways to figure out what is going on:

   * This manual, the GDB Internals manual, has information which
     applies generally to many parts of GDB.

   * Information about particular functions or data structures are
     located in comments with those functions or data structures.  If
     you run across a function or a global variable which does not have
     a comment correctly explaining what is does, this can be thought
     of as a bug in GDB; feel free to submit a bug report, with a
     suggested comment if you can figure out what the comment should
     say (see @{"Submitting Patches" link "Submitting Patches"}).  If you find a comment which is
     actually wrong, be especially sure to report that.

     Comments explaining the function of macros defined in host,
     target, or native dependent files can be in several places.
     Sometimes they are repeated every place the macro is defined.
     Sometimes they are where the macro is used.  Sometimes there is a
     header file which supplies a default definition of the macro, and
     the comment is there.  This manual also has a list of macros (see
     @{"Host Conditionals" link "Host Conditionals"}, see @{"Target Conditionals" link "Target Conditionals"}, see
     @{"Native Conditionals" link "Native Conditionals"}, and see @{"Obsolete Conditionals" link "Obsolete Conditionals"}) with some
     documentation.

   * Start with the header files.  Once you some idea of how GDB's
     internal symbol tables are stored (see @{b}symtab.h@{ub}, @{b}gdbtypes.h@{ub}), you
     will find it much easier to understand the code which uses and
     creates those symbol tables.

   * You may wish to process the information you are getting somehow, to
     enhance your understanding of it.  Summarize it, translate it to
     another language, add some (perhaps trivial or non-useful) feature
     to GDB, use the code to predict what a test case would do and
     write the test case and verify your prediction, etc.  If you are
     reading code and your eyes are starting to glaze over, this is a
     sign you need to use a more active approach.

   * Once you have a part of GDB to start with, you can find more
     specifically the part you are looking for by stepping through each
     function with the @{b}next@{ub} command.  Do not use @{b}step@{ub} or you will
     quickly get distracted; when the function you are stepping through
     calls another function try only to get a big-picture understanding
     (perhaps using the comment at the beginning of the function being
     called) of what it does.  This way you can identify which of the
     functions being called by the function you are stepping through is
     the one which you are interested in.  You may need to examine the
     data structures generated at each stage, with reference to the
     comments in the header files explaining what the data structures
     are supposed to look like.

     Of course, this same technique can be used if you are just reading
     the code, rather than actually stepping through it.  The same
     general principle applies--when the code you are looking at calls
     something else, just try to understand generally what the code
     being called does, rather than worrying about all its details.

   * A good place to start when tracking down some particular area is
     with a command which invokes that feature.  Suppose you want to
     know how single-stepping works.  As a GDB user, you know that the
     @{b}step@{ub} command invokes single-stepping.  The command is invoked via
     command tables (see @{b}command.h@{ub}); by convention the function which
     actually performs the command is formed by taking the name of the
     command and adding @{b}_command@{ub}, or in the case of an @{b}info@{ub} subcommand,
     @{b}_info@{ub}.  For example, the @{b}step@{ub} command invokes the @{b}step_command@{ub}
     function and the @{b}info display@{ub} command invokes @{b}display_info@{ub}.  When
     this convention is not followed, you might have to use @{b}grep@{ub} or @{b}M-x
     tags-search@{ub} in emacs, or run GDB on itself and set a breakpoint in
     @{b}execute_command@{ub}.

   * If all of the above fail, it may be appropriate to ask for
     information on @{b}bug-gdb@{ub}.  But @{i}never@{ui} post a generic question like "I
     was wondering if anyone could give me some tips about understanding
     GDB"--if we had some magic secret we would put it in this manual.
     Suggestions for improving the manual are always welcome, of course.

   Good luck!


@endnode

@node "Debugging GDB" "gdbint.guide/Debugging GDB"
@next "New Architectures"
@prev "Getting Started"
@toc "Main"

Debugging GDB with itself
*************************

   If GDB is limping on your machine, this is the preferred way to get
it fully functional.  Be warned that in some ancient Unix systems, like
Ultrix 4.2, a program can't be running in one process while it is being
debugged in another.  Rather than typing the command @{b}./gdb ./gdb@{ub}, which
works on Suns and such, you can copy @{b}gdb@{ub} to @{b}gdb2@{ub} and then type
@{b}./gdb ./gdb2@{ub}.

   When you run GDB in the GDB source directory, it will read a
@{b}.gdbinit@{ub} file that sets up some simple things to make debugging gdb
easier.  The @{b}info@{ub} command, when executed without a subcommand in a GDB
being debugged by gdb, will pop you back up to the top level gdb.  See
@{b}.gdbinit@{ub} for details.

   If you use emacs, you will probably want to do a @{b}make TAGS@{ub} after you
configure your distribution; this will put the machine dependent
routines for your local machine where they will be accessed first by @{b}M-.@{ub}

   Also, make sure that you've either compiled GDB with your local cc,
or have run @{b}fixincludes@{ub} if you are compiling with gcc.


@endnode

@node "New Architectures" "gdbint.guide/New Architectures"
@next "Config"
@prev "Debugging GDB"
@toc "Main"

Defining a New Host or Target Architecture
******************************************

   When building support for a new host and/or target, much of the work
you need to do is handled by specifying configuration files; see
@{"Adding a New Configuration" link "Config"}.  Further work can be divided into
"host-dependent" (see @{"Adding a New Host" link "Host"}) and "target-dependent" (see
@{"Adding a New Target" link "Target"}).  The following discussion is meant to explain
the difference between hosts and targets.

What is considered "host-dependent" versus "target-dependent"?
==============================================================

@{i}   Host@{ui} refers to attributes of the system where GDB runs.  @{i}Target@{ui}
refers to the system where the program being debugged executes.   In
most cases they are the same machine, in which case a third type of
@{i}Native@{ui} attributes come into play.

   Defines and include files needed to build on the host are host
support.  Examples are tty support, system defined types, host byte
order, host float format.

   Defines and information needed to handle the target format are target
dependent.  Examples are the stack frame format, instruction set,
breakpoint instruction, registers, and how to set up and tear down the
stack to call a function.

   Information that is only needed when the host and target are the
same, is native dependent.  One example is Unix child process support;
if the host and target are not the same, doing a fork to start the
target process is a bad idea.  The various macros needed for finding the
registers in the @{b}upage@{ub}, running @{b}ptrace@{ub}, and such are all in the
native-dependent files.

   Another example of native-dependent code is support for features
that are really part of the target environment, but which require
@{b}#include@{ub} files that are only available on the host system.  Core file
handling and @{b}setjmp@{ub} handling are two common cases.

   When you want to make GDB work "native" on a particular machine, you
have to include all three kinds of information.

   The dependent information in GDB is organized into files by naming
conventions.

   Host-Dependent Files
@{b}config/*/*.mh@{ub}
     Sets Makefile parameters

@{b}config/*/xm-*.h@{ub}
     Global #include's and #define's and definitions

@{b}*-xdep.c@{ub}
     Global variables and functions

   Native-Dependent Files
@{b}config/*/*.mh@{ub}
     Sets Makefile parameters (for @{i}both@{ui} host and native)

@{b}config/*/nm-*.h@{ub}
     #include's and #define's and definitions.  This file is only
     included by the small number of modules that need it, so beware of
     doing feature-test #define's from its macros.

@{b}*-nat.c@{ub}
     global variables and functions

   Target-Dependent Files
@{b}config/*/*.mt@{ub}
     Sets Makefile parameters

@{b}config/*/tm-*.h@{ub}
     Global #include's and #define's and definitions

@{b}*-tdep.c@{ub}
     Global variables and functions

   At this writing, most supported hosts have had their host and native
dependencies sorted out properly.  There are a few stragglers, which
can be recognized by the absence of NATDEPFILES lines in their
@{b}config/*/*.mh@{ub}.


@endnode

@node "Config" "gdbint.guide/Config"
@next "Host"
@prev "New Architectures"
@toc "Main"

Adding a New Configuration
**************************

   Most of the work in making GDB compile on a new machine is in
specifying the configuration of the machine.  This is done in a
dizzying variety of header files and configuration scripts, which we
hope to make more sensible soon.  Let's say your new host is called an
XXX (e.g.  @{b}sun4@{ub}), and its full three-part configuration name is
@{b}XARCH-XVEND-XOS@{ub} (e.g.  @{b}sparc-sun-sunos4@{ub}).  In particular:

   In the top level directory, edit @{b}config.sub@{ub} and add XARCH, XVEND,
and XOS to the lists of supported architectures, vendors, and operating
systems near the bottom of the file.  Also, add XXX as an alias that
maps to @{b}XARCH-XVEND-XOS@{ub}.  You can test your changes by running

     ./config.sub XXX

and
     ./config.sub @{b}XARCH-XVEND-XOS@{ub}

which should both respond with @{b}XARCH-XVEND-XOS@{ub} and no error messages.

   Now, go to the @{b}bfd@{ub} directory and create a new file
@{b}bfd/hosts/h-XXX.h@{ub}.  Examine the other @{b}h-*.h@{ub} files as templates, and
create one that brings in the right include files for your system, and
defines any host-specific macros needed by BFD, the Binutils, GNU LD,
or the Opcodes directories.  (They all share the bfd @{b}hosts@{ub} directory
and the @{b}configure.host@{ub} file.)

   Then edit @{b}bfd/configure.host@{ub}.  Add a line to recognize your
@{b}XARCH-XVEND-XOS@{ub} configuration, and set @{b}my_host@{ub} to XXX when you
recognize it.  This will cause your file @{b}h-XXX.h@{ub} to be linked to
@{b}sysdep.h@{ub} at configuration time.  When creating the line that recognizes
your configuration, only match the fields that you really need to
match; e.g. don't match the architecture or manufacturer if the OS is
sufficient to distinguish the configuration that your @{b}h-XXX.h@{ub} file
supports.  Don't match the manufacturer name unless you really need to.
This should make future ports easier.

   Also, if this host requires any changes to the Makefile, create a
file @{b}bfd/config/XXX.mh@{ub}, which includes the required lines.

   It's possible that the @{b}libiberty@{ub} and @{b}readline@{ub} directories won't need
any changes for your configuration, but if they do, you can change the
@{b}configure.in@{ub} file there to recognize your system and map to an @{b}mh-XXX@{ub}
file.  Then add @{b}mh-XXX@{ub} to the @{b}config/@{ub} subdirectory, to set any makefile
variables you need.  The only current options in there are things like
@{b}-DSYSV@{ub}.  (This @{b}mh-XXX@{ub} naming convention differs from elsewhere in GDB,
by historical accident.  It should be cleaned up so that all such files
are called @{b}XXX.mh@{ub}.)

   Aha!  Now to configure GDB itself!  Edit @{b}gdb/configure.in@{ub} to
recognize your system and set @{b}gdb_host@{ub} to XXX, and (unless your desired
target is already available) also set @{b}gdb_target@{ub} to something
appropriate (for instance, XXX).  To handle new hosts, modify the
segment after the comment @{b}# per-host@{ub}; to handle new targets, modify
after @{b}# per-target@{ub}.

   Finally, you'll need to specify and define GDB's host-, native-, and
target-dependent @{b}.h@{ub} and @{b}.c@{ub} files used for your configuration; the next
two chapters discuss those.


@endnode

@node "Host" "gdbint.guide/Host"
@next "Native"
@prev "Config"
@toc "Main"

Adding a New Host
*****************

   Once you have specified a new configuration for your host (see
@{"Adding a New Configuration" link "Config"}), there are three remaining pieces to
making GDB work on a new machine.  First, you have to make it host on
the new machine (compile there, handle that machine's terminals
properly, etc).  If you will be cross-debugging to some other kind of
system that's already supported, you are done.

   If you want to use GDB to debug programs that run on the new machine,
you have to get it to understand the machine's object files, symbol
files, and interfaces to processes; see @{"Adding a New Target" link "Target"} and see @{"Adding a New Native Configuration" link "Native"}

   Several files control GDB's configuration for host systems:

@{b}gdb/config/ARCH/XXX.mh@{ub}
     Specifies Makefile fragments needed when hosting on machine XXX.
     In particular, this lists the required machine-dependent object
     files, by defining @{b}XDEPFILES=...@{ub}.  Also specifies the header file
     which describes host XXX, by defining @{b}XM_FILE= xm-XXX.h@{ub}.  You can
     also define @{b}CC@{ub}, @{b}REGEX@{ub} and @{b}REGEX1@{ub}, @{b}SYSV_DEFINE@{ub}, @{b}XM_CFLAGS@{ub},
     @{b}XM_ADD_FILES@{ub}, @{b}XM_CLIBS@{ub}, @{b}XM_CDEPS@{ub}, etc.; see @{b}Makefile.in@{ub}.

@{b}gdb/config/ARCH/xm-XXX.h@{ub}
     (@{b}xm.h@{ub} is a link to this file, created by configure).  Contains C
     macro definitions describing the host system environment, such as
     byte order, host C compiler and library, ptrace support, and core
     file structure.  Crib from existing @{b}xm-*.h@{ub} files to create a new
     one.

@{b}gdb/XXX-xdep.c@{ub}
     Contains any miscellaneous C code required for this machine as a
     host.  On many machines it doesn't exist at all.  If it does
     exist, put @{b}XXX-xdep.o@{ub} into the @{b}XDEPFILES@{ub} line in @{b}gdb/config/mh-XXX@{ub}.

Generic Host Support Files
--------------------------

   There are some "generic" versions of routines that can be used by
various systems.  These can be customized in various ways by macros
defined in your @{b}xm-XXX.h@{ub} file.  If these routines work for the XXX
host, you can just include the generic file's name (with @{b}.o@{ub}, not @{b}.c@{ub}) in
@{b}XDEPFILES@{ub}.

   Otherwise, if your machine needs custom support routines, you will
need to write routines that perform the same functions as the generic
file.  Put them into @{b}XXX-xdep.c@{ub}, and put @{b}XXX-xdep.o@{ub} into @{b}XDEPFILES@{ub}.

@{b}ser-bsd.c@{ub}
     This contains serial line support for Berkeley-derived Unix
     systems.

@{b}ser-go32.c@{ub}
     This contains serial line support for 32-bit programs running
     under DOS using the GO32 execution environment.

@{b}ser-termios.c@{ub}
     This contains serial line support for System V-derived Unix
     systems.

   Now, you are now ready to try configuring GDB to compile using your
system as its host.  From the top level (above @{b}bfd@{ub}, @{b}gdb@{ub}, etc), do:

     ./configure XXX --target=vxworks960

   This will configure your system to cross-compile for VxWorks on the
Intel 960, which is probably not what you really want, but it's a test
case that works at this stage.  (You haven't set up to be able to debug
programs that run @{i}on@{ui} XXX yet.)

   If this succeeds, you can try building it all with:

     make

   Repeat until the program configures, compiles, links, and runs.
When run, it won't be able to do much (unless you have a VxWorks/960
board on your network) but you will know that the host support is
pretty well done.

   Good luck!  Comments and suggestions about this section are
particularly welcome; send them to @{b}bug-gdb@prep.ai.mit.edu@{ub}.


@endnode

@node "Native" "gdbint.guide/Native"
@next "Target"
@prev "Host"
@toc "Main"

Adding a New Native Configuration
*********************************

   If you are making GDB run native on the XXX machine, you have plenty
more work to do.  Several files control GDB's configuration for native
support:

@{b}gdb/config/XARCH/XXX.mh@{ub}
     Specifies Makefile fragments needed when hosting @{i}or native@{ui} on
     machine XXX.  In particular, this lists the required
     native-dependent object files, by defining @{b}NATDEPFILES=...@{ub}.  Also
     specifies the header file which describes native support on XXX,
     by defining @{b}NAT_FILE= nm-XXX.h@{ub}.  You can also define @{b}NAT_CFLAGS@{ub},
     @{b}NAT_ADD_FILES@{ub}, @{b}NAT_CLIBS@{ub}, @{b}NAT_CDEPS@{ub}, etc.; see @{b}Makefile.in@{ub}.

@{b}gdb/config/ARCH/nm-XXX.h@{ub}
     (@{b}nm.h@{ub} is a link to this file, created by configure).  Contains C
     macro definitions describing the native system environment, such
     as child process control and core file support.  Crib from
     existing @{b}nm-*.h@{ub} files to create a new one.

@{b}gdb/XXX-nat.c@{ub}
     Contains any miscellaneous C code required for this native support
     of this machine.  On some machines it doesn't exist at all.

Generic Native Support Files
----------------------------

   There are some "generic" versions of routines that can be used by
various systems.  These can be customized in various ways by macros
defined in your @{b}nm-XXX.h@{ub} file.  If these routines work for the XXX
host, you can just include the generic file's name (with @{b}.o@{ub}, not @{b}.c@{ub}) in
@{b}NATDEPFILES@{ub}.

   Otherwise, if your machine needs custom support routines, you will
need to write routines that perform the same functions as the generic
file.  Put them into @{b}XXX-nat.c@{ub}, and put @{b}XXX-nat.o@{ub} into @{b}NATDEPFILES@{ub}.

@{b}inftarg.c@{ub}
     This contains the @{i}target_ops vector@{ui} that supports Unix child
     processes on systems which use ptrace and wait to control the
     child.

@{b}procfs.c@{ub}
     This contains the @{i}target_ops vector@{ui} that supports Unix child
     processes on systems which use /proc to control the child.

@{b}fork-child.c@{ub}
     This does the low-level grunge that uses Unix system calls to do a
     "fork and exec" to start up a child process.

@{b}infptrace.c@{ub}
     This is the low level interface to inferior processes for systems
     using the Unix @{b}ptrace@{ub} call in a vanilla way.

@{b}core-aout.c::fetch_core_registers()@{ub}
     Support for reading registers out of a core file.  This routine
     calls @{b}register_addr()@{ub}, see below.  Now that BFD is used to read
     core files, virtually all machines should use @{b}core-aout.c@{ub}, and
     should just provide @{b}fetch_core_registers@{ub} in @{b}XXX-nat.c@{ub} (or
     @{b}REGISTER_U_ADDR@{ub} in @{b}nm-XXX.h@{ub}).

@{b}core-aout.c::register_addr()@{ub}
     If your @{b}nm-XXX.h@{ub} file defines the macro @{b}REGISTER_U_ADDR(addr,
     blockend, regno)@{ub}, it should be defined to set @{b}addr@{ub} to the offset
     within the @{b}user@{ub} struct of GDB register number @{b}regno@{ub}.  @{b}blockend@{ub} is
     the offset within the "upage" of @{b}u.u_ar0@{ub}.  If @{b}REGISTER_U_ADDR@{ub} is
     defined, @{b}core-aout.c@{ub} will define the @{b}register_addr()@{ub} function and
     use the macro in it.  If you do not define @{b}REGISTER_U_ADDR@{ub}, but you
     are using the standard @{b}fetch_core_registers()@{ub}, you will need to
     define your own version of @{b}register_addr()@{ub}, put it into your
     @{b}XXX-nat.c@{ub} file, and be sure @{b}XXX-nat.o@{ub} is in the @{b}NATDEPFILES@{ub} list.
     If you have your own @{b}fetch_core_registers()@{ub}, you may not need a
     separate @{b}register_addr()@{ub}.  Many custom @{b}fetch_core_registers()@{ub}
     implementations simply locate the registers themselves.

   When making GDB run native on a new operating system, to make it
possible to debug core files, you will need to either write specific
code for parsing your OS's core files, or customize @{b}bfd/trad-core.c@{ub}.
First, use whatever @{b}#include@{ub} files your machine uses to define the
struct of registers that is accessible (possibly in the u-area) in a
core file (rather than @{b}machine/reg.h@{ub}), and an include file that defines
whatever header exists on a core file (e.g. the u-area or a @{b}struct
core@{ub}).  Then modify @{b}trad_unix_core_file_p()@{ub} to use these values to set
up the section information for the data segment, stack segment, any
other segments in the core file (perhaps shared library contents or
control information), "registers" segment, and if there are two
discontiguous sets of registers (e.g.  integer and float), the "reg2"
segment.  This section information basically delimits areas in the core
file in a standard way, which the section-reading routines in BFD know
how to seek around in.

   Then back in GDB, you need a matching routine called
@{b}fetch_core_registers()@{ub}.  If you can use the generic one, it's in
@{b}core-aout.c@{ub}; if not, it's in your @{b}XXX-nat.c@{ub} file.  It will be passed a
char pointer to the entire "registers" segment, its length, and a zero;
or a char pointer to the entire "regs2" segment, its length, and a 2.
The routine should suck out the supplied register values and install
them into GDB's "registers" array.  (See
@{"Defining a New Host or Target Architecture" link "New Architectures"}, for more info about this.)

   If your system uses @{b}/proc@{ub} to control processes, and uses ELF format
core files, then you may be able to use the same routines for reading
the registers out of processes and out of core files.


@endnode

@node "Target" "gdbint.guide/Target"
@next "Languages"
@prev "Native"
@toc "Main"

Adding a New Target
*******************

   For a new target called TTT, first specify the configuration as
described in @{"Adding a New Configuration" link "Config"}.  If your new target is the
same as your new host, you've probably already done that.

   A variety of files specify attributes of the GDB target environment:

@{b}gdb/config/ARCH/TTT.mt@{ub}
     Contains a Makefile fragment specific to this target.  Specifies
     what object files are needed for target TTT, by defining
     @{b}TDEPFILES=...@{ub}.  Also specifies the header file which describes
     TTT, by defining @{b}TM_FILE= tm-TTT.h@{ub}.  You can also define @{b}TM_CFLAGS@{ub},
     @{b}TM_CLIBS@{ub}, @{b}TM_CDEPS@{ub}, and other Makefile variables here; see
     @{b}Makefile.in@{ub}.

@{b}gdb/config/ARCH/tm-TTT.h@{ub}
     (@{b}tm.h@{ub} is a link to this file, created by configure).  Contains
     macro definitions about the target machine's registers, stack
     frame format and instructions.  Crib from existing @{b}tm-*.h@{ub} files
     when building a new one.

@{b}gdb/TTT-tdep.c@{ub}
     Contains any miscellaneous code required for this target machine.
     On some machines it doesn't exist at all.  Sometimes the macros in
     @{b}tm-TTT.h@{ub} become very complicated, so they are implemented as
     functions here instead, and the macro is simply defined to call
     the function.

@{b}gdb/exec.c@{ub}
     Defines functions for accessing files that are executable on the
     target system.  These functions open and examine an exec file,
     extract data from one, write data to one, print information about
     one, etc.  Now that executable files are handled with BFD, every
     target should be able to use the generic exec.c rather than its
     own custom code.

@{b}gdb/ARCH-pinsn.c@{ub}
     Prints (disassembles) the target machine's instructions.  This
     file is usually shared with other target machines which use the
     same processor, which is why it is @{b}ARCH-pinsn.c@{ub} rather than
     @{b}TTT-pinsn.c@{ub}.

@{b}gdb/ARCH-opcode.h@{ub}
     Contains some large initialized data structures describing the
     target machine's instructions.  This is a bit strange for a @{b}.h@{ub}
     file, but it's OK since it is only included in one place.
     @{b}ARCH-opcode.h@{ub} is shared between the debugger and the assembler, if
     the GNU assembler has been ported to the target machine.

@{b}gdb/config/ARCH/tm-ARCH.h@{ub}
     This often exists to describe the basic layout of the target
     machine's processor chip (registers, stack, etc).  If used, it is
     included by @{b}tm-XXX.h@{ub}.  It can be shared among many targets that
     use the same processor.

@{b}gdb/ARCH-tdep.c@{ub}
     Similarly, there are often common subroutines that are shared by
     all target machines that use this particular architecture.

   When adding support for a new target machine, there are various areas
of support that might need change, or might be OK.

   If you are using an existing object file format (a.out or COFF),
there is probably little to be done.  See @{b}bfd/doc/bfd.texinfo@{ub} for more
information on writing new a.out or COFF versions.

   If you need to add a new object file format, you must first add it to
BFD.  This is beyond the scope of this document right now.  Basically
you must build a transfer vector (of type @{b}bfd_target@{ub}), which will mean
writing all the required routines, and add it to the list in
@{b}bfd/targets.c@{ub}.

   You must then arrange for the BFD code to provide access to the
debugging symbols.  Generally GDB will have to call swapping routines
from BFD and a few other BFD internal routines to locate the debugging
information.  As much as possible, GDB should not depend on the BFD
internal data structures.

   For some targets (e.g., COFF), there is a special transfer vector
used to call swapping routines, since the external data structures on
various platforms have different sizes and layouts.  Specialized
routines that will only ever be implemented by one object file format
may be called directly.  This interface should be described in a file
@{b}bfd/libxxx.h@{ub}, which is included by GDB.

   If you are adding a new operating system for an existing CPU chip,
add a @{b}tm-XOS.h@{ub} file that describes the operating system facilities that
are unusual (extra symbol table info; the breakpoint instruction
needed; etc).  Then write a @{b}tm-XARCH-XOS.h@{ub} that just @{b}#include@{ub}s
@{b}tm-XARCH.h@{ub} and @{b}tm-XOS.h@{ub}.  (Now that we have three-part configuration
names, this will probably get revised to separate the XOS configuration
from the XARCH configuration.)


@endnode

@node "Languages" "gdbint.guide/Languages"
@next "Releases"
@prev "Target"
@toc "Main"

Adding a Source Language to GDB
*******************************

   To add other languages to GDB's expression parser, follow the
following steps:

@{i}Create the expression parser.@{ui}
     This should reside in a file @{b}LANG-exp.y@{ub}.  Routines for building
     parsed expressions into a @{b}union exp_element@{ub} list are in @{b}parse.c@{ub}.

     Since we can't depend upon everyone having Bison, and YACC produces
     parsers that define a bunch of global names, the following lines
     @{i}must@{ui} be included at the top of the YACC parser, to prevent the
     various parsers from defining the same global names:

          #define yyparse 	LANG_parse
          #define yylex 	LANG_lex
          #define yyerror 	LANG_error
          #define yylval 	LANG_lval
          #define yychar 	LANG_char
          #define yydebug 	LANG_debug
          #define yypact  	LANG_pact
          #define yyr1		LANG_r1
          #define yyr2		LANG_r2
          #define yydef		LANG_def
          #define yychk		LANG_chk
          #define yypgo		LANG_pgo
          #define yyact  	LANG_act
          #define yyexca  	LANG_exca
          #define yyerrflag  	LANG_errflag
          #define yynerrs  	LANG_nerrs

     At the bottom of your parser, define a @{b}struct language_defn@{ub} and
     initialize it with the right values for your language.  Define an
     @{b}initialize_LANG@{ub} routine and have it call
     @{b}add_language(LANG_language_defn)@{ub} to tell the rest of GDB that your
     language exists.  You'll need some other supporting variables and
     functions, which will be used via pointers from your
     @{b}LANG_language_defn@{ub}.  See the declaration of @{b}struct language_defn@{ub}
     in @{b}language.h@{ub}, and the other @{b}*-exp.y@{ub} files, for more information.

@{i}Add any evaluation routines, if necessary@{ui}
     If you need new opcodes (that represent the operations of the
     language), add them to the enumerated type in @{b}expression.h@{ub}.  Add
     support code for these operations in @{b}eval.c:evaluate_subexp()@{ub}.
     Add cases for new opcodes in two functions from @{b}parse.c@{ub}:
     @{b}prefixify_subexp()@{ub} and @{b}length_of_subexp()@{ub}.  These compute the
     number of @{b}exp_element@{ub}s that a given operation takes up.

@{i}Update some existing code@{ui}
     Add an enumerated identifier for your language to the enumerated
     type @{b}enum language@{ub} in @{b}defs.h@{ub}.

     Update the routines in @{b}language.c@{ub} so your language is included.
     These routines include type predicates and such, which (in some
     cases) are language dependent.  If your language does not appear
     in the switch statement, an error is reported.

     Also included in @{b}language.c@{ub} is the code that updates the variable
     @{b}current_language@{ub}, and the routines that translate the
     @{b}language_LANG@{ub} enumerated identifier into a printable string.

     Update the function @{b}_initialize_language@{ub} to include your language.
     This function picks the default language upon startup, so is
     dependent upon which languages that GDB is built for.

     Update @{b}allocate_symtab@{ub} in @{b}symfile.c@{ub} and/or symbol-reading code so
     that the language of each symtab (source file) is set properly.
     This is used to determine the language to use at each stack frame
     level.  Currently, the language is set based upon the extension of
     the source file.  If the language can be better inferred from the
     symbol information, please set the language of the symtab in the
     symbol-reading code.

     Add helper code to @{b}expprint.c:print_subexp()@{ub} to handle any new
     expression opcodes you have added to @{b}expression.h@{ub}.  Also, add the
     printed representations of your operators to @{b}op_print_tab@{ub}.

@{i}Add a place of call@{ui}
     Add a call to @{b}LANG_parse()@{ub} and @{b}LANG_error@{ub} in @{b}parse.c:parse_exp_1()@{ub}.

@{i}Use macros to trim code@{ui}
     The user has the option of building GDB for some or all of the
     languages.  If the user decides to build GDB for the language
     LANG, then every file dependent on @{b}language.h@{ub} will have the macro
     @{b}_LANG_LANG@{ub} defined in it.  Use @{b}#ifdef@{ub}s to leave out large routines
     that the user won't need if he or she is not using your language.

     Note that you do not need to do this in your YACC parser, since if
     GDB is not build for LANG, then @{b}LANG-exp.tab.o@{ub} (the compiled form
     of your parser) is not linked into GDB at all.

     See the file @{b}configure.in@{ub} for how GDB is configured for different
     languages.

@{i}Edit @{b}Makefile.in@{ub}@{ui}
     Add dependencies in @{b}Makefile.in@{ub}.  Make sure you update the macro
     variables such as @{b}HFILES@{ub} and @{b}OBJS@{ub}, otherwise your code may not get
     linked in, or, worse yet, it may not get @{b}tar@{ub}red into the
     distribution!


@endnode

@node "Releases" "gdbint.guide/Releases"
@next "Partial Symbol Tables"
@prev "Languages"
@toc "Main"

Configuring GDB for Release
***************************

   From the top level directory (containing @{b}gdb@{ub}, @{b}bfd@{ub}, @{b}libiberty@{ub}, and so
on):
     make -f Makefile.in gdb.tar.gz

   This will properly configure, clean, rebuild any files that are
distributed pre-built (e.g. @{b}c-exp.tab.c@{ub} or @{b}refcard.ps@{ub}), and will then
make a tarfile.  (If the top level directory has already been
configured, you can just do @{b}make gdb.tar.gz@{ub} instead.)

   This procedure requires:
   * symbolic links

   * @{b}makeinfo@{ub} (texinfo2 level)

   * TeX

   * @{b}dvips@{ub}

   * @{b}yacc@{ub} or @{b}bison@{ub}

... and the usual slew of utilities (@{b}sed@{ub}, @{b}tar@{ub}, etc.).

TEMPORARY RELEASE PROCEDURE FOR DOCUMENTATION
---------------------------------------------

@{b}   gdb.texinfo@{ub} is currently marked up using the texinfo-2 macros, which
are not yet a default for anything (but we have to start using them
sometime).

   For making paper, the only thing this implies is the right
generation of @{b}texinfo.tex@{ub} needs to be included in the distribution.

   For making info files, however, rather than duplicating the texinfo2
distribution, generate @{b}gdb-all.texinfo@{ub} locally, and include the files
@{b}gdb.info*@{ub} in the distribution.  Note the plural; @{b}makeinfo@{ub} will split
the document into one overall file and five or so included files.


@endnode

@node "Partial Symbol Tables" "gdbint.guide/Partial Symbol Tables"
@next "Types"
@prev "Releases"
@toc "Main"

Partial Symbol Tables
*********************

   GDB has three types of symbol tables.

   * full symbol tables (symtabs).  These contain the main information
     about symbols and addresses.

   * partial symbol tables (psymtabs).  These contain enough
     information to know when to read the corresponding part of the
     full symbol table.

   * minimal symbol tables (msymtabs).  These contain information
     gleaned from non-debugging symbols.

   This section describes partial symbol tables.

   A psymtab is constructed by doing a very quick pass over an
executable file's debugging information.  Small amounts of information
are extracted - enough to identify which parts of the symbol table will
need to be re-read and fully digested later, when the user needs the
information.  The speed of this pass causes GDB to start up very
quickly.  Later, as the detailed rereading occurs, it occurs in small
pieces, at various times, and the delay therefrom is mostly invisible to
the user.  (See @{"Symbol Reading" link "Symbol Reading"}.)

   The symbols that show up in a file's psymtab should be, roughly,
those visible to the debugger's user when the program is not running
code from that file.  These include external symbols and types, static
symbols and types, and enum values declared at file scope.

   The psymtab also contains the range of instruction addresses that the
full symbol table would represent.

   The idea is that there are only two ways for the user (or much of
the code in the debugger) to reference a symbol:

   * by its address (e.g. execution stops at some address which is
     inside a function in this file).  The address will be noticed to
     be in the range of this psymtab, and the full symtab will be read
     in.  @{b}find_pc_function@{ub}, @{b}find_pc_line@{ub}, and other @{b}find_pc_...@{ub}
     functions handle this.

   * by its name (e.g. the user asks to print a variable, or set a
     breakpoint on a function).  Global names and file-scope names will
     be found in the psymtab, which will cause the symtab to be pulled
     in.  Local names will have to be qualified by a global name, or a
     file-scope name, in which case we will have already read in the
     symtab as we evaluated the qualifier.  Or, a local symbol can be
     referenced when we are "in" a local scope, in which case the first
     case applies.  @{b}lookup_symbol@{ub} does most of the work here.

   The only reason that psymtabs exist is to cause a symtab to be read
in at the right moment.  Any symbol that can be elided from a psymtab,
while still causing that to happen, should not appear in it.  Since
psymtabs don't have the idea of scope, you can't put local symbols in
them anyway.  Psymtabs don't have the idea of the type of a symbol,
either, so types need not appear, unless they will be referenced by
name.

   It is a bug for GDB to behave one way when only a psymtab has been
read, and another way if the corresponding symtab has been read in.
Such bugs are typically caused by a psymtab that does not contain all
the visible symbols, or which has the wrong instruction address ranges.

   The psymtab for a particular section of a symbol-file (objfile)
could be thrown away after the symtab has been read in.  The symtab
should always be searched before the psymtab, so the psymtab will never
be used (in a bug-free environment).  Currently, psymtabs are allocated
on an obstack, and all the psymbols themselves are allocated in a pair
of large arrays on an obstack, so there is little to be gained by
trying to free them unless you want to do a lot more work.


@endnode

@node "Types" "gdbint.guide/Types"
@next "BFD support for GDB"
@prev "Partial Symbol Tables"
@toc "Main"

Types
*****

   Fundamental Types (e.g., FT_VOID, FT_BOOLEAN).

   These are the fundamental types that GDB uses internally.
Fundamental types from the various debugging formats (stabs, ELF, etc)
are mapped into one of these.  They are basically a union of all
fundamental types that gdb knows about for all the languages that GDB
knows about.

   Type Codes (e.g., TYPE_CODE_PTR, TYPE_CODE_ARRAY).

   Each time GDB builds an internal type, it marks it with one of these
types.  The type may be a fundamental type, such as TYPE_CODE_INT, or a
derived type, such as TYPE_CODE_PTR which is a pointer to another type.
Typically, several FT_* types map to one TYPE_CODE_* type, and are
distinguished by other members of the type struct, such as whether the
type is signed or unsigned, and how many bits it uses.

   Builtin Types (e.g., builtin_type_void, builtin_type_char).

   These are instances of type structs that roughly correspond to
fundamental types and are created as global types for GDB to use for
various ugly historical reasons.  We eventually want to eliminate
these.  Note for example that builtin_type_int initialized in
gdbtypes.c is basically the same as a TYPE_CODE_INT type that is
initialized in c-lang.c for an FT_INTEGER fundamental type.  The
difference is that the builtin_type is not associated with any
particular objfile, and only one instance exists, while c-lang.c builds
as many TYPE_CODE_INT types as needed, with each one associated with
some particular objfile.


@endnode

@node "BFD support for GDB" "gdbint.guide/BFD support for GDB"
@next "Symbol Reading"
@prev "Types"
@toc "Main"

Binary File Descriptor Library Support for GDB
**********************************************

   BFD provides support for GDB in several ways:

@{i}identifying executable and core files@{ui}
     BFD will identify a variety of file types, including a.out, coff,
     and several variants thereof, as well as several kinds of core
     files.

@{i}access to sections of files@{ui}
     BFD parses the file headers to determine the names, virtual
     addresses, sizes, and file locations of all the various named
     sections in files (such as the text section or the data section).
     GDB simply calls BFD to read or write section X at byte offset Y
     for length Z.

@{i}specialized core file support@{ui}
     BFD provides routines to determine the failing command name stored
     in a core file, the signal with which the program failed, and
     whether a core file matches (i.e. could be a core dump of) a
     particular executable file.

@{i}locating the symbol information@{ui}
     GDB uses an internal interface of BFD to determine where to find
     the symbol information in an executable file or symbol-file.  GDB
     itself handles the reading of symbols, since BFD does not
     "understand" debug symbols, but GDB uses BFD's cached information
     to find the symbols, string table, etc.


@endnode

@node "Symbol Reading" "gdbint.guide/Symbol Reading"
@next "Cleanups"
@prev "BFD support for GDB"
@toc "Main"

Symbol Reading
**************

   GDB reads symbols from "symbol files".  The usual symbol file is the
file containing the program which GDB is debugging.  GDB can be directed
to use a different file for symbols (with the "symbol-file" command),
and it can also read more symbols via the "add-file" and "load"
commands, or while reading symbols from shared libraries.

   Symbol files are initially opened by @{b}symfile.c@{ub} using the BFD
library.  BFD identifies the type of the file by examining its header.
@{b}symfile_init@{ub} then uses this identification to locate a set of
symbol-reading functions.

   Symbol reading modules identify themselves to GDB by calling
@{b}add_symtab_fns@{ub} during their module initialization.  The argument to
@{b}add_symtab_fns@{ub} is a @{b}struct sym_fns@{ub} which contains the name (or name
prefix) of the symbol format, the length of the prefix, and pointers to
four functions.  These functions are called at various times to process
symbol-files whose identification matches the specified prefix.

   The functions supplied by each module are:

@{b}XXX_symfile_init(struct sym_fns *sf)@{ub}
     Called from @{b}symbol_file_add@{ub} when we are about to read a new symbol
     file.  This function should clean up any internal state (possibly
     resulting from half-read previous files, for example) and prepare
     to read a new symbol file. Note that the symbol file which we are
     reading might be a new "main" symbol file, or might be a secondary
     symbol file whose symbols are being added to the existing symbol
     table.

     The argument to @{b}XXX_symfile_init@{ub} is a newly allocated @{b}struct
     sym_fns@{ub} whose @{b}bfd@{ub} field contains the BFD for the new symbol file
     being read.  Its @{b}private@{ub} field has been zeroed, and can be
     modified as desired.  Typically, a struct of private information
     will be @{b}malloc@{ub}'d, and a pointer to it will be placed in the
     @{b}private@{ub} field.

     There is no result from @{b}XXX_symfile_init@{ub}, but it can call @{b}error@{ub} if
     it detects an unavoidable problem.

@{b}XXX_new_init()@{ub}
     Called from @{b}symbol_file_add@{ub} when discarding existing symbols.
     This function need only handle the symbol-reading module's
     internal state; the symbol table data structures visible to the
     rest of GDB will be discarded by @{b}symbol_file_add@{ub}.  It has no
     arguments and no result.  It may be called after @{b}XXX_symfile_init@{ub},
     if a new symbol table is being read, or may be called alone if all
     symbols are simply being discarded.

@{b}XXX_symfile_read(struct sym_fns *sf, CORE_ADDR addr, int mainline)@{ub}
     Called from @{b}symbol_file_add@{ub} to actually read the symbols from a
     symbol-file into a set of psymtabs or symtabs.

@{b}     sf@{ub} points to the struct sym_fns originally passed to @{b}XXX_sym_init@{ub}
     for possible initialization.  @{b}addr@{ub} is the offset between the
     file's specified start address and its true address in memory.
     @{b}mainline@{ub} is 1 if this is the main symbol table being read, and 0
     if a secondary symbol file (e.g. shared library or dynamically
     loaded file) is being read.

   In addition, if a symbol-reading module creates psymtabs when
XXX_symfile_read is called, these psymtabs will contain a pointer to a
function @{b}XXX_psymtab_to_symtab@{ub}, which can be called from any point in
the GDB symbol-handling code.

@{b}XXX_psymtab_to_symtab (struct partial_symtab *pst)@{ub}
     Called from @{b}psymtab_to_symtab@{ub} (or the PSYMTAB_TO_SYMTAB macro) if
     the psymtab has not already been read in and had its @{b}pst->symtab@{ub}
     pointer set.  The argument is the psymtab to be fleshed-out into a
     symtab.  Upon return, pst->readin should have been set to 1, and
     pst->symtab should contain a pointer to the new corresponding
     symtab, or zero if there were no symbols in that part of the
     symbol file.


@endnode

@node "Cleanups" "gdbint.guide/Cleanups"
@next "Wrapping"
@prev "Symbol Reading"
@toc "Main"

Cleanups
********

   Cleanups are a structured way to deal with things that need to be
done later.  When your code does something (like @{b}malloc@{ub} some memory, or
open a file) that needs to be undone later (e.g. free the memory or
close the file), it can make a cleanup.  The cleanup will be done at
some future point:  when the command is finished, when an error occurs,
or when your code decides it's time to do cleanups.

   You can also discard cleanups, that is, throw them away without doing
what they say.  This is only done if you ask that it be done.

   Syntax:

@{b}struct cleanup *OLD_CHAIN;@{ub}
     Declare a variable which will hold a cleanup chain handle.

@{b}OLD_CHAIN = make_cleanup (FUNCTION, ARG);@{ub}
     Make a cleanup which will cause FUNCTION to be called with ARG (a
     @{b}char *@{ub}) later.  The result, OLD_CHAIN, is a handle that can be
     passed to @{b}do_cleanups@{ub} or @{b}discard_cleanups@{ub} later.  Unless you are
     going to call @{b}do_cleanups@{ub} or @{b}discard_cleanups@{ub} yourself, you can
     ignore the result from @{b}make_cleanup@{ub}.

@{b}do_cleanups (OLD_CHAIN);@{ub}
     Perform all cleanups done since @{b}make_cleanup@{ub} returned OLD_CHAIN.
     E.g.:
          make_cleanup (a, 0);
          old = make_cleanup (b, 0);
          do_cleanups (old);

     will call @{b}b()@{ub} but will not call @{b}a()@{ub}.  The cleanup that calls @{b}a()@{ub}
     will remain in the cleanup chain, and will be done later unless
     otherwise discarded.

@{b}discard_cleanups (OLD_CHAIN);@{ub}
     Same as @{b}do_cleanups@{ub} except that it just removes the cleanups from
     the chain and does not call the specified functions.

   Some functions, e.g. @{b}fputs_filtered()@{ub} or @{b}error()@{ub}, specify that they
"should not be called when cleanups are not in place".  This means that
any actions you need to reverse in the case of an error or interruption
must be on the cleanup chain before you call these functions, since
they might never return to your code (they @{b}longjmp@{ub} instead).


@endnode

@node "Wrapping" "gdbint.guide/Wrapping"
@next "Frames"
@prev "Cleanups"
@toc "Main"

Wrapping Output Lines
*********************

   Output that goes through @{b}printf_filtered@{ub} or @{b}fputs_filtered@{ub} or
@{b}fputs_demangled@{ub} needs only to have calls to @{b}wrap_here@{ub} added in places
that would be good breaking points.  The utility routines will take
care of actually wrapping if the line width is exceeded.

   The argument to @{b}wrap_here@{ub} is an indentation string which is printed
@{i}only@{ui} if the line breaks there.  This argument is saved away and used
later.  It must remain valid until the next call to @{b}wrap_here@{ub} or until
a newline has been printed through the @{b}*_filtered@{ub} functions.  Don't
pass in a local variable and then return!

   It is usually best to call @{b}wrap_here()@{ub} after printing a comma or
space.  If you call it before printing a space, make sure that your
indentation properly accounts for the leading space that will print if
the line wraps there.

   Any function or set of functions that produce filtered output must
finish by printing a newline, to flush the wrap buffer, before
switching to unfiltered ("@{b}printf@{ub}") output.  Symbol reading routines
that print warnings are a good example.


@endnode

@node "Frames" "gdbint.guide/Frames"
@next "Remote Stubs"
@prev "Wrapping"
@toc "Main"

Frames
******

   A frame is a construct that GDB uses to keep track of calling and
called functions.

@{b}FRAME_FP@{ub}
     in the machine description has no meaning to the
     machine-independent part of GDB, except that it is used when
     setting up a new frame from scratch, as follows:

                create_new_frame (read_register (FP_REGNUM), read_pc ()));

     Other than that, all the meaning imparted to @{b}FP_REGNUM@{ub} is imparted
     by the machine-dependent code.  So, @{b}FP_REGNUM@{ub} can have any value
     that is convenient for the code that creates new frames.
     (@{b}create_new_frame@{ub} calls @{b}INIT_EXTRA_FRAME_INFO@{ub} if it is defined;
     that is where you should use the @{b}FP_REGNUM@{ub} value, if your frames
     are nonstandard.)

@{b}FRAME_CHAIN@{ub}
     Given a GDB frame, determine the address of the calling function's
     frame.  This will be used to create a new GDB frame struct, and
     then @{b}INIT_EXTRA_FRAME_INFO@{ub} and @{b}INIT_FRAME_PC@{ub} will be called for
     the new frame.


@endnode

@node "Remote Stubs" "gdbint.guide/Remote Stubs"
@next "Longjmp Support"
@prev "Frames"
@toc "Main"

Remote Stubs
************

   GDB's file @{b}remote.c@{ub} talks a serial protocol to code that runs in the
target system.  GDB provides several sample "stubs" that can be
integrated into target programs or operating systems for this purpose;
they are named @{b}*-stub.c@{ub}.

   The GDB user's manual describes how to put such a stub into your
target code.  What follows is a discussion of integrating the SPARC stub
into a complicated operating system (rather than a simple program), by
Stu Grossman, the author of this stub.

   The trap handling code in the stub assumes the following upon entry
to trap_low:

  1. %l1 and %l2 contain pc and npc respectively at the time of the trap

  2. traps are disabled

  3. you are in the correct trap window

   As long as your trap handler can guarantee those conditions, then
there is no reason why you shouldn't be able to `share' traps with the
stub.  The stub has no requirement that it be jumped to directly from
the hardware trap vector.  That is why it calls @{b}exceptionHandler()@{ub},
which is provided by the external environment.  For instance, this
could setup the hardware traps to actually execute code which calls the
stub first, and then transfers to its own trap handler.

   For the most point, there probably won't be much of an issue with
`sharing' traps, as the traps we use are usually not used by the
kernel, and often indicate unrecoverable error conditions.  Anyway,
this is all controlled by a table, and is trivial to modify.  The most
important trap for us is for @{b}ta 1@{ub}.  Without that, we can't single step
or do breakpoints.  Everything else is unnecessary for the proper
operation of the debugger/stub.

   From reading the stub, it's probably not obvious how breakpoints
work.  They are simply done by deposit/examine operations from GDB.


@endnode

@node "Longjmp Support" "gdbint.guide/Longjmp Support"
@next "Coding Style"
@prev "Remote Stubs"
@toc "Main"

Longjmp Support
***************

   GDB has support for figuring out that the target is doing a @{b}longjmp@{ub}
and for stopping at the target of the jump, if we are stepping.  This
is done with a few specialized internal breakpoints, which are visible
in the @{b}maint info breakpoint@{ub} command.

   To make this work, you need to define a macro called
@{b}GET_LONGJMP_TARGET@{ub}, which will examine the @{b}jmp_buf@{ub} structure and
extract the longjmp target address.  Since @{b}jmp_buf@{ub} is target specific,
you will need to define it in the appropriate @{b}tm-xxx.h@{ub} file.  Look in
@{b}tm-sun4os4.h@{ub} and @{b}sparc-tdep.c@{ub} for examples of how to do this.


@endnode

@node "Coding Style" "gdbint.guide/Coding Style"
@next "Clean Design"
@prev "Longjmp Support"
@toc "Main"

Coding Style
************

   GDB is generally written using the GNU coding standards, as
described in @{b}standards.texi@{ub}, which is available for anonymous FTP from
GNU archive sites.  There are some additional considerations for GDB
maintainers that reflect the unique environment and style of GDB
maintenance.  If you follow these guidelines, GDB will be more
consistent and easier to maintain.

   GDB's policy on the use of prototypes is that prototypes are used to
@{i}declare@{ui} functions but never to @{i}define@{ui} them.  Simple macros are used in
the declarations, so that a non-ANSI compiler can compile GDB without
trouble.  The simple macro calls are used like this:

     extern int
     memory_remove_breakpoint PARAMS ((CORE_ADDR, char *));

   Note the double parentheses around the parameter types.  This allows
an arbitrary number of parameters to be described, without freaking out
the C preprocessor.  When the function has no parameters, it should be
described like:

     void
     noprocess PARAMS ((void));

   The @{b}PARAMS@{ub} macro expands to its argument in ANSI C, or to a simple
@{b}()@{ub} in traditional C.

   All external functions should have a @{b}PARAMS@{ub} declaration in a header
file that callers include.  All static functions should have such a
declaration near the top of their source file.

   We don't have a gcc option that will properly check that these rules
have been followed, but it's GDB policy, and we periodically check it
using the tools available (plus manual labor), and clean up any
remnants.


@endnode

@node "Clean Design" "gdbint.guide/Clean Design"
@next "Submitting Patches"
@prev "Coding Style"
@toc "Main"

Clean Design
************

   In addition to getting the syntax right, there's the little question
of semantics.  Some things are done in certain ways in GDB because long
experience has shown that the more obvious ways caused various kinds of
trouble.  In particular:

*
     You can't assume the byte order of anything that comes from a
     target (including VALUEs, object files, and instructions).  Such
     things must be byte-swapped using @{b}SWAP_TARGET_AND_HOST@{ub} in GDB, or
     one of the swap routines defined in @{b}bfd.h@{ub}, such as @{b}bfd_get_32@{ub}.

*
     You can't assume that you know what interface is being used to
     talk to the target system.  All references to the target must go
     through the current @{b}target_ops@{ub} vector.

*
     You can't assume that the host and target machines are the same
     machine (except in the "native" support modules).  In particular,
     you can't assume that the target machine's header files will be
     available on the host machine.  Target code must bring along its
     own header files - written from scratch or explicitly donated by
     their owner, to avoid copyright problems.

*
     Insertion of new @{b}#ifdef@{ub}'s will be frowned upon.  It's much better
     to write the code portably than to conditionalize it for various
     systems.

*
     New @{b}#ifdef@{ub}'s which test for specific compilers or manufacturers or
     operating systems are unacceptable.  All @{b}#ifdef@{ub}'s should test for
     features.  The information about which configurations contain which
     features should be segregated into the configuration files.
     Experience has proven far too often that a feature unique to one
     particular system often creeps into other systems; and that a
     conditional based on some predefined macro for your current system
     will become worthless over time, as new versions of your system
     come out that behave differently with regard to this feature.

*
     Adding code that handles specific architectures, operating
     systems, target interfaces, or hosts, is not acceptable in generic
     code.  If a hook is needed at that point, invent a generic hook
     and define it for your configuration, with something like:

          #ifdef	WRANGLE_SIGNALS
             WRANGLE_SIGNALS (signo);
          #endif

     In your host, target, or native configuration file, as appropriate,
     define @{b}WRANGLE_SIGNALS@{ub} to do the machine-dependent thing.  Take a
     bit of care in defining the hook, so that it can be used by other
     ports in the future, if they need a hook in the same place.

     If the hook is not defined, the code should do whatever "most"
     machines want.  Using @{b}#ifdef@{ub}, as above, is the preferred way to do
     this, but sometimes that gets convoluted, in which case use

          #ifndef SPECIAL_FOO_HANDLING
          #define SPECIAL_FOO_HANDLING(pc, sp) (0)
          #endif

     where the macro is used or in an appropriate header file.

     Whether to include a @{i}small@{ui} hook, a hook around the exact pieces of
     code which are system-dependent, or whether to replace a whole
     function with a hook depends on the case.  A good example of this
     dilemma can be found in @{b}get_saved_register@{ub}.  All machines that GDB
     2.8 ran on just needed the @{b}FRAME_FIND_SAVED_REGS@{ub} hook to find the
     saved registers.  Then the SPARC and Pyramid came along, and
     @{b}HAVE_REGISTER_WINDOWS@{ub} and @{b}REGISTER_IN_WINDOW_P@{ub} were introduced.
     Then the 29k and 88k required the @{b}GET_SAVED_REGISTER@{ub} hook.  The
     first three are examples of small hooks; the latter replaces a
     whole function.  In this specific case, it is useful to have both
     kinds; it would be a bad idea to replace all the uses of the small
     hooks with @{b}GET_SAVED_REGISTER@{ub}, since that would result in much
     duplicated code.  Other times, duplicating a few lines of code
     here or there is much cleaner than introducing a large number of
     small hooks.

     Another way to generalize GDB along a particular interface is with
     an attribute struct.  For example, GDB has been generalized to
     handle multiple kinds of remote interfaces - not by #ifdef's
     everywhere, but by defining the "target_ops" structure and having
     a current target (as well as a stack of targets below it, for
     memory references).  Whenever something needs to be done that
     depends on which remote interface we are using, a flag in the
     current target_ops structure is tested (e.g.  `target_has_stack'),
     or a function is called through a pointer in the current
     target_ops structure.  In this way, when a new remote interface is
     added, only one module needs to be touched - the one that actually
     implements the new remote interface.  Other examples of
     attribute-structs are BFD access to multiple kinds of object file
     formats, or GDB's access to multiple source languages.

     Please avoid duplicating code.  For example, in GDB 3.x all the
     code interfacing between @{b}ptrace@{ub} and the rest of GDB was duplicated
     in @{b}*-dep.c@{ub}, and so changing something was very painful.  In GDB
     4.x, these have all been consolidated into @{b}infptrace.c@{ub}.
     @{b}infptrace.c@{ub} can deal with variations between systems the same way
     any system-independent file would (hooks, #if defined, etc.), and
     machines which are radically different don't need to use
     infptrace.c at all.

*
@{i}     Do@{ui} write code that doesn't depend on the sizes of C data types,
     the format of the host's floating point numbers, the alignment of
     anything, or the order of evaluation of expressions.  In short,
     follow good programming practices for writing portable C code.


@endnode

@node "Submitting Patches" "gdbint.guide/Submitting Patches"
@next "Host Conditionals"
@prev "Clean Design"
@toc "Main"

Submitting Patches
******************

   Thanks for thinking of offering your changes back to the community of
GDB users.  In general we like to get well designed enhancements.
Thanks also for checking in advance about the best way to transfer the
changes.

   The two main problems with getting your patches in are,

*
     The GDB maintainers will only install "cleanly designed" patches.
     You may not always agree on what is clean design.  see
     @{"Coding Style" link "Coding Style"}, see @{"Clean Design" link "Clean Design"}.

*
     If the maintainers don't have time to put the patch in when it
     arrives, or if there is any question about a patch, it goes into a
     large queue with everyone else's patches and bug reports.

   I don't know how to get past these problems except by continuing to
try.

   There are two issues here - technical and legal.

   The legal issue is that to incorporate substantial changes requires a
copyright assignment from you and/or your employer, granting ownership
of the changes to the Free Software Foundation.  You can get the
standard document for doing this by sending mail to @{b}gnu@prep.ai.mit.edu@{ub}
and asking for it.  I recommend that people write in "All programs
owned by the Free Software Foundation" as "NAME OF PROGRAM", so that
changes in many programs (not just GDB, but GAS, Emacs, GCC, etc) can
be contributed with only one piece of legalese pushed through the
bureacracy and filed with the FSF.  I can't start merging changes until
this paperwork is received by the FSF (their rules, which I follow
since I maintain it for them).

   Technically, the easiest way to receive changes is to receive each
feature as a small context diff or unidiff, suitable for "patch".  Each
message sent to me should include the changes to C code and header
files for a single feature, plus ChangeLog entries for each directory
where files were modified, and diffs for any changes needed to the
manuals (gdb/doc/gdb.texi or gdb/doc/gdbint.texi).  If there are a lot
of changes for a single feature, they can be split down into multiple
messages.

   In this way, if I read and like the feature, I can add it to the
sources with a single patch command, do some testing, and check it in.
If you leave out the ChangeLog, I have to write one.  If you leave out
the doc, I have to puzzle out what needs documenting.  Etc.

   The reason to send each change in a separate message is that I will
not install some of the changes.  They'll be returned to you with
questions or comments.  If I'm doing my job, my message back to you
will say what you have to fix in order to make the change acceptable.
The reason to have separate messages for separate features is so that
other changes (which I @{i}am@{ui} willing to accept) can be installed while one
or more changes are being reworked.  If multiple features are sent in a
single message, I tend to not put in the effort to sort out the
acceptable changes from the unacceptable, so none of the features get
installed until all are acceptable.

   If this sounds painful or authoritarian, well, it is.  But I get a
lot of bug reports and a lot of patches, and most of them don't get
installed because I don't have the time to finish the job that the bug
reporter or the contributor could have done.  Patches that arrive
complete, working, and well designed, tend to get installed on the day
they arrive.  The others go into a queue and get installed if and when
I scan back over the queue - which can literally take months sometimes.
It's in both our interests to make patch installation easy - you get
your changes installed, and I make some forward progress on GDB in a
normal 12-hour day (instead of them having to wait until I have a
14-hour or 16-hour day to spend cleaning up patches before I can
install them).

   Please send patches to @{b}bug-gdb@prep.ai.mit.edu@{ub}, if they are less
than about 25,000 characters.  If longer than that, either make them
available somehow (e.g. anonymous FTP), and announce it on @{b}bug-gdb@{ub}, or
send them directly to the GDB maintainers at @{b}gdb-patches@cygnus.com@{ub}.


@endnode

@node "Host Conditionals" "gdbint.guide/Host Conditionals"
@next "Target Conditionals"
@prev "Submitting Patches"
@toc "Main"

Host Conditionals
*****************

   When GDB is configured and compiled, various macros are defined or
left undefined, to control compilation based on the attributes of the
host system.  These macros and their meanings (or if the meaning is not
documented here, then one of the source files where they are used is
indicated) are:

@{i}   NOTE:  For now, both host and target conditionals are here.
Eliminate target conditionals from this list as they are identified.@{ui}

@{b}BLOCK_ADDRESS_FUNCTION_RELATIVE@{ub}
     dbxread.c

@{b}GDBINIT_FILENAME@{ub}
     The default name of GDB's initialization file (normally @{b}.gdbinit@{ub}).

@{b}MEM_FNS_DECLARED@{ub}
     Your host config file defines this if it includes declarations of
     @{b}memcpy@{ub} and @{b}memset@{ub}.  Define this to avoid conflicts between the
     native include files and the declarations in @{b}defs.h@{ub}.

@{b}NO_SYS_FILE@{ub}
     Define this if your system does not have a @{b}<sys/file.h>@{ub}.

@{b}SIGWINCH_HANDLER@{ub}
     If your host defines @{b}SIGWINCH@{ub}, you can define this to be the name
     of a function to be called if @{b}SIGWINCH@{ub} is received.

@{b}SIGWINCH_HANDLER_BODY@{ub}
     Define this to expand into code that will define the function
     named by the expansion of @{b}SIGWINCH_HANDLER@{ub}.

@{b}ADDITIONAL_OPTIONS@{ub}
     main.c

@{b}ADDITIONAL_OPTION_CASES@{ub}
     main.c

@{b}ADDITIONAL_OPTION_HANDLER@{ub}
     main.c

@{b}ADDITIONAL_OPTION_HELP@{ub}
     main.c

@{b}AIX_BUGGY_PTRACE_CONTINUE@{ub}
     infptrace.c

@{b}ALIGN_STACK_ON_STARTUP@{ub}
     Define this if your system is of a sort that will crash in @{b}tgetent@{ub}
     if the stack happens not to be longword-aligned when @{b}main@{ub} is
     called.  This is a rare situation, but is known to occur on several
     different types of systems.

@{b}CFRONT_PRODUCER@{ub}
     dwarfread.c

@{b}DBX_PARM_SYMBOL_CLASS@{ub}
     stabsread.c

@{b}DEFAULT_PROMPT@{ub}
     The default value of the prompt string (normally @{b}"(gdb) "@{ub}).

@{b}DEV_TTY@{ub}
     symmisc.c

@{b}DO_REGISTERS_INFO@{ub}
     infcmd.c

@{b}FCLOSE_PROVIDED@{ub}
     Define this if the system declares @{b}fclose@{ub} in the headers included
     in @{b}defs.h@{ub}.  This isn't needed unless your compiler is unusually
     anal.

     ANSI definition.

@{b}FILES_INFO_HOOK@{ub}
     target.c

@{b}FLOAT_INFO@{ub}
     infcmd.c

@{b}FOPEN_RB@{ub}
     Define this if binary files are opened the same way as text files.

@{b}GCC2_COMPILED_FLAG_SYMBOL@{ub}
     dbxread.c

@{b}GCC_COMPILED_FLAG_SYMBOL@{ub}
     dbxread.c

@{b}GCC_MANGLE_BUG@{ub}
     symtab.c

@{b}GCC_PRODUCER@{ub}
     dwarfread.c

@{b}GETENV_PROVIDED@{ub}
     Define this if the system declares @{b}getenv@{ub} in its headers included
     in @{b}defs.h@{ub}. This isn't needed unless your compiler is unusually
     anal.

@{b}GPLUS_PRODUCER@{ub}
     dwarfread.c

@{b}HAVE_MMAP@{ub}
     In some cases, use the system call @{b}mmap@{ub} for reading symbol tables.
     For some machines this allows for sharing and quick updates.

@{b}HAVE_SIGSETMASK@{ub}
     Define this if the host system has job control, but does not
     define @{b}sigsetmask()@{ub}.  Currently, this is only true of the RS/6000.

@{b}HAVE_TERMIO@{ub}
     inflow.c

@{b}HOST_BYTE_ORDER@{ub}
     The ordering of bytes in the host.  This must be defined to be
     either @{b}BIG_ENDIAN@{ub} or @{b}LITTLE_ENDIAN@{ub}.

@{b}INT_MAX@{ub}

@{b}INT_MIN@{ub}

@{b}LONG_MAX@{ub}

@{b}UINT_MAX@{ub}

@{b}ULONG_MAX@{ub}
     Values for host-side constants.

@{b}ISATTY@{ub}
     Substitute for isatty, if not available.

@{b}KERNEL_DEBUGGING@{ub}
     tm-ultra3.h

@{b}KERNEL_U_ADDR@{ub}
     Define this to the address of the @{b}u@{ub} structure (the "user struct",
     also known as the "u-page") in kernel virtual memory.  GDB needs
     to know this so that it can subtract this address from absolute
     addresses in the upage, that are obtained via ptrace or from core
     files.  On systems that don't need this value, set it to zero.

@{b}KERNEL_U_ADDR_BSD@{ub}
     Define this to cause GDB to determine the address of @{b}u@{ub} at runtime,
     by using Berkeley-style @{b}nlist@{ub} on the kernel's image in the root
     directory.

@{b}KERNEL_U_ADDR_HPUX@{ub}
     Define this to cause GDB to determine the address of @{b}u@{ub} at runtime,
     by using HP-style @{b}nlist@{ub} on the kernel's image in the root
     directory.

@{b}LCC_PRODUCER@{ub}
     dwarfread.c

@{b}LONGEST@{ub}
     This is the longest integer type available on the host.  If not
     defined, it will default to @{b}long long@{ub} or @{b}long@{ub}, depending on
     @{b}CC_HAS_LONG_LONG@{ub}.

@{b}CC_HAS_LONG_LONG@{ub}
     Define this if the host C compiler supports "long long".  This
     will be defined automatically if GNU CC is used to compile GDB.

@{b}PRINTF_HAS_LONG_LONG@{ub}
     Define this if the host can handle printing of long long integers
     via a format directive "ll".

@{b}LSEEK_NOT_LINEAR@{ub}
     source.c

@{b}L_LNNO32@{ub}
     coffread.c

@{b}L_SET@{ub}
     This macro is used as the argument to lseek (or, most commonly,
     bfd_seek).  FIXME, should be replaced by SEEK_SET instead, which
     is the POSIX equivalent.

@{b}MAINTENANCE_CMDS@{ub}
     If the value of this is 1, then a number of optional maintenance
     commands are compiled in.

@{b}MALLOC_INCOMPATIBLE@{ub}
     Define this if the system's prototype for @{b}malloc@{ub} differs from the
     ANSI definition.

@{b}MMAP_BASE_ADDRESS@{ub}
     When using HAVE_MMAP, the first mapping should go at this address.

@{b}MMAP_INCREMENT@{ub}
     when using HAVE_MMAP, this is the increment between mappings.

@{b}NEED_POSIX_SETPGID@{ub}
     Define this to use the POSIX version of @{b}setpgid@{ub} to determine
     whether job control is available.

@{b}NORETURN@{ub}
     If defined, this should be one or more tokens, such as @{b}volatile@{ub},
     that can be used in both the declaration and definition of
     functions to indicate that they never return.  The default is
     already set correctly if compiling with GCC.  This will almost
     never need to be defined.

@{b}ATTR_NORETURN@{ub}
     If defined, this should be one or more tokens, such as
     @{b}__attribute__ ((noreturn))@{ub}, that can be used in the declarations
     of functions to indicate that they never return.  The default is
     already set correctly if compiling with GCC.  This will almost
     never need to be defined.

@{b}NOTICE_SIGNAL_HANDLING_CHANGE@{ub}
     infrun.c

@{b}NO_HIF_SUPPORT@{ub}
     remote-mm.c

@{b}NO_JOB_CONTROL@{ub}
     signals.h

@{b}NO_MMALLOC@{ub}
     GDB will use the @{b}mmalloc@{ub} library for memory allocation for symbol
     reading, unless this symbol is defined.  Define it on systems on
     which @{b}mmalloc@{ub} does not work for some reason.  One example is the
     DECstation, where its RPC library can't cope with our redefinition
     of @{b}malloc@{ub} to call @{b}mmalloc@{ub}.  When defining @{b}NO_MMALLOC@{ub}, you will
     also have to override the setting of @{b}MMALLOC_LIB@{ub} to empty, in the
     Makefile.  Therefore, this define is usually set on the command
     line by overriding @{b}MMALLOC_DISABLE@{ub} in @{b}config/*/*.mh@{ub}, rather than
     by defining it in @{b}xm-*.h@{ub}.

@{b}NO_MMALLOC_CHECK@{ub}
     Define this if you are using @{b}mmalloc@{ub}, but don't want the overhead
     of checking the heap with @{b}mmcheck@{ub}.

@{b}NO_SIGINTERRUPT@{ub}
     remote-adapt.c

@{b}NUMERIC_REG_NAMES@{ub}
     mips-tdep.c

@{b}N_SETV@{ub}
     dbxread.c

@{b}N_SET_MAGIC@{ub}
     hppabsd-tdep.c

@{b}ONE_PROCESS_WRITETEXT@{ub}
     breakpoint.c

@{b}O_BINARY@{ub}
     exec.c

@{b}O_RDONLY@{ub}
     xm-ultra3.h

@{b}PCC_SOL_BROKEN@{ub}
     dbxread.c

@{b}PC_LOAD_SEGMENT@{ub}
     stack.c

@{b}PRINT_RANDOM_SIGNAL@{ub}
     infcmd.c

@{b}PRINT_REGISTER_HOOK@{ub}
     infcmd.c

@{b}PROCESS_LINENUMBER_HOOK@{ub}
     buildsym.c

@{b}PROLOGUE_FIRSTLINE_OVERLAP@{ub}
     infrun.c

@{b}PUSH_ARGUMENTS@{ub}
     valops.c

@{b}PYRAMID_CONTROL_FRAME_DEBUGGING@{ub}
     pyr-xdep.c

@{b}PYRAMID_CORE@{ub}
     pyr-xdep.c

@{b}PYRAMID_PTRACE@{ub}
     pyr-xdep.c

@{b}REGISTER_BYTES@{ub}
     remote.c

@{b}REG_STACK_SEGMENT@{ub}
     exec.c

@{b}REG_STRUCT_HAS_ADDR@{ub}
     findvar.c

@{b}R_FP@{ub}
     dwarfread.c

@{b}R_OK@{ub}
     xm-altos.h

@{b}SEEK_END@{ub}
     state.c

@{b}SEEK_SET@{ub}
     state.c

@{b}SEM@{ub}
     coffread.c

@{b}SHELL_COMMAND_CONCAT@{ub}
     infrun.c

@{b}SHELL_FILE@{ub}
     infrun.c

@{b}SHIFT_INST_REGS@{ub}
     breakpoint.c

@{b}SIGTRAP_STOP_AFTER_LOAD@{ub}
     infrun.c

@{b}STACK_ALIGN@{ub}
     valops.c

@{b}STOP_SIGNAL@{ub}
     main.c

@{b}SUN4_COMPILER_FEATURE@{ub}
     infrun.c

@{b}SUN_FIXED_LBRAC_BUG@{ub}
     dbxread.c

@{b}SVR4_SHARED_LIBS@{ub}
     solib.c

@{b}SYMBOL_RELOADING_DEFAULT@{ub}
     symfile.c

@{b}TIOCGETC@{ub}
     inflow.c

@{b}TIOCGLTC@{ub}
     inflow.c

@{b}TIOCGPGRP@{ub}
     inflow.c

@{b}TIOCLGET@{ub}
     inflow.c

@{b}TIOCLSET@{ub}
     inflow.c

@{b}TIOCNOTTY@{ub}
     inflow.c

@{b}UPAGES@{ub}
     altos-xdep.c

@{b}USE_O_NOCTTY@{ub}
     inflow.c

@{b}USG@{ub}
     Means that System V (prior to SVR4) include files are in use.
     (FIXME:  This symbol is abused in @{b}infrun.c@{ub}, @{b}regex.c@{ub},
     @{b}remote-nindy.c@{ub}, and @{b}utils.c@{ub} for other things, at the moment.)

@{b}WRS_ORIG@{ub}
     remote-vx.c

@{b}alloca@{ub}
     defs.h

@{b}const@{ub}
     defs.h

@{b}lint@{ub}
     Define this to help lint in some stupid way.

@{b}volatile@{ub}
     Define this to override the defaults of @{b}__volatile__@{ub} or @{b}/**/@{ub}.

   Platform-specific host conditionals.

@{b}ALTOS@{ub}
     altos-xdep.c

@{b}ALTOS_AS@{ub}
     xm-altos.h

@{b}MOTOROLA@{ub}
     xm-altos.h

@{b}NBPG@{ub}
     altos-xdep.c

@{b}BCS@{ub}
     tm-delta88.h

@{b}DELTA88@{ub}
     m88k-xdep.c

@{b}DGUX@{ub}
     m88k-xdep.c

@{b}F_OK@{ub}
     xm-ultra3.h

   Regex conditionals.

@{b}C_ALLOCA@{ub}
     regex.c

@{b}NFAILURES@{ub}
     regex.c

@{b}RE_NREGS@{ub}
     regex.h

@{b}SIGN_EXTEND_CHAR@{ub}
     regex.c

@{b}SWITCH_ENUM_BUG@{ub}
     regex.c

@{b}SYNTAX_TABLE@{ub}
     regex.c

@{b}Sword@{ub}
     regex.c

@{b}sparc@{ub}
     regex.c

@{b}test@{ub}
     regex.c


@endnode

@node "Target Conditionals" "gdbint.guide/Target Conditionals"
@next "Native Conditionals"
@prev "Host Conditionals"
@toc "Main"

Target Conditionals
*******************

   When GDB is configured and compiled, various macros are defined or
left undefined, to control compilation based on the attributes of the
target system.  These macros and their meanings are:

@{i}   NOTE:  For now, both host and target conditionals are here.
Eliminate host conditionals from this list as they are identified.@{ui}

@{b}PUSH_DUMMY_FRAME@{ub}
     Used in @{b}call_function_by_hand@{ub} to create an artificial stack frame.

@{b}POP_FRAME@{ub}
     Used in @{b}call_function_by_hand@{ub} to remove an artificial stack frame.

@{b}BLOCK_ADDRESS_FUNCTION_RELATIVE@{ub}
     dbxread.c

@{b}PYRAMID_CONTROL_FRAME_DEBUGGING@{ub}
     pyr-xdep.c

@{b}ADDITIONAL_OPTIONS@{ub}
     main.c

@{b}ADDITIONAL_OPTION_CASES@{ub}
     main.c

@{b}ADDITIONAL_OPTION_HANDLER@{ub}
     main.c

@{b}ADDITIONAL_OPTION_HELP@{ub}
     main.c

@{b}ADDR_BITS_REMOVE (addr)@{ub}
     If a raw machine address includes any bits that are not really part
     of the address, then define this macro to expand into an expression
     that zeros those bits in ADDR.  For example, the two low-order
     bits of a Motorola 88K address may be used by some kernels for
     their own purposes, since addresses must always be 4-byte aligned,
     and so are of no use for addressing.  Those bits should be
     filtered out with an expression such as @{b}((addr) & ~3)@{ub}.

@{b}ALIGN_STACK_ON_STARTUP@{ub}
     main.c

@{b}ALTOS@{ub}
     altos-xdep.c

@{b}ALTOS_AS@{ub}
     xm-altos.h

@{b}BCS@{ub}
     tm-delta88.h

@{b}BEFORE_MAIN_LOOP_HOOK@{ub}
     Define this to expand into any code that you want to execute before
     the main loop starts.  Although this is not, strictly speaking, a
     target conditional, that is how it is currently being used.  Note
     that if a configuration were to define it one way for a host and a
     different way for the target, GDB will probably not compile, let
     alone run correctly.

@{b}BELIEVE_PCC_PROMOTION@{ub}
     coffread.c

@{b}BELIEVE_PCC_PROMOTION_TYPE@{ub}
     stabsread.c

@{b}BITS_BIG_ENDIAN@{ub}
     Define this if the numbering of bits in the targets does *not*
     match the endianness of the target byte order.  A value of 1 means
     that the bits are numbered in a big-endian order, 0 means
     little-endian.

@{b}BLOCK_ADDRESS_ABSOLUTE@{ub}
     dbxread.c

@{b}BREAKPOINT@{ub}
     tm-m68k.h

@{b}CALL_DUMMY@{ub}
     valops.c

@{b}CALL_DUMMY_LOCATION@{ub}
     inferior.h

@{b}CALL_DUMMY_STACK_ADJUST@{ub}
     valops.c

@{b}CANNOT_FETCH_REGISTER (regno)@{ub}
     A C expression that should be nonzero if REGNO cannot be fetched
     from an inferior process.  This is only relevant if
     @{b}FETCH_INFERIOR_REGISTERS@{ub} is not defined.

@{b}CANNOT_STORE_REGISTER (regno)@{ub}
     A C expression that should be nonzero if REGNO should not be
     written to the target.  This is often the case for program
     counters, status words, and other special registers.  If this is
     not defined, GDB will assume that all registers may be written.

@{b}CFRONT_PRODUCER@{ub}
     dwarfread.c

@{b}DO_DEFERRED_STORES@{ub}

@{b}CLEAR_DEFERRED_STORES@{ub}
     Define this to execute any deferred stores of registers into the
     inferior, and to cancel any deferred stores.

     Currently only implemented correctly for native Sparc
     configurations?

@{b}CPLUS_MARKER@{ub}
     Define this to expand into the character that G++ uses to
     distinguish compiler-generated identifiers from
     programmer-specified identifiers.  By default, this expands into
     @{b}'$'@{ub}.  Most System V targets should define this to @{b}'.'@{ub}.

@{b}DBX_PARM_SYMBOL_CLASS@{ub}
     stabsread.c

@{b}DECR_PC_AFTER_BREAK@{ub}
     Define this to be the amount by which to decrement the PC after
     the program encounters a breakpoint.  This is often the number of
     bytes in BREAKPOINT, though not always.  For most targets this
     value will be 0.

@{b}DECR_PC_AFTER_HW_BREAK@{ub}
     Similarly, for hardware breakpoints.

@{b}DELTA88@{ub}
     m88k-xdep.c

@{b}DEV_TTY@{ub}
     symmisc.c

@{b}DGUX@{ub}
     m88k-xdep.c

@{b}DISABLE_UNSETTABLE_BREAK addr@{ub}
     If defined, this should evaluate to 1 if ADDR is in a shared
     library in which breakpoints cannot be set and so should be
     disabled.

@{b}DO_REGISTERS_INFO@{ub}
     infcmd.c

@{b}END_OF_TEXT_DEFAULT@{ub}
     This is an expression that should designate the end of the text
     section (? FIXME ?)

@{b}EXTRACT_RETURN_VALUE@{ub}
     tm-m68k.h

@{b}EXTRACT_STRUCT_VALUE_ADDRESS@{ub}
     values.c

@{b}EXTRA_FRAME_INFO@{ub}
     If defined, this must be a list of slots that may be inserted into
     the @{b}frame_info@{ub} structure defined in @{b}frame.h@{ub}.

@{b}EXTRA_SYMTAB_INFO@{ub}
     If defined, this must be a list of slots that may be inserted into
     the @{b}symtab@{ub} structure defined in @{b}symtab.h@{ub}.

@{b}FILES_INFO_HOOK@{ub}
     target.c

@{b}FLOAT_INFO@{ub}
     infcmd.c

@{b}FP0_REGNUM@{ub}
     a68v-xdep.c

@{b}FPC_REGNUM@{ub}
     mach386-xdep.c

@{b}FP_REGNUM@{ub}
     parse.c

@{b}FRAMELESS_FUNCTION_INVOCATION@{ub}
     blockframe.c

@{b}FRAME_ARGS_ADDRESS_CORRECT@{ub}
     stack.c

@{b}FRAME_CHAIN@{ub}
     Given FRAME, return a pointer to the calling frame.

@{b}FRAME_CHAIN_COMBINE@{ub}
     blockframe.c

@{b}FRAME_CHAIN_VALID@{ub}
     frame.h

@{b}FRAME_CHAIN_VALID_ALTERNATE@{ub}
     frame.h

@{b}FRAME_FIND_SAVED_REGS@{ub}
     stack.c

@{b}FRAME_GET_BASEREG_VALUE@{ub}
     frame.h

@{b}FRAME_NUM_ARGS (val, fi)@{ub}
     For the frame described by fi, set val to the number of arguments
     that are being passed.

@{b}FRAME_SPECIFICATION_DYADIC@{ub}
     stack.c

@{b}FRAME_SAVED_PC@{ub}
     Given FRAME, return the pc saved there.  That is, the return
     address.

@{b}FUNCTION_EPILOGUE_SIZE@{ub}
     For some COFF targets, the @{b}x_sym.x_misc.x_fsize@{ub} field of the
     function end symbol is 0.  For such targets, you must define
     @{b}FUNCTION_EPILOGUE_SIZE@{ub} to expand into the standard size of a
     function's epilogue.

@{b}GCC2_COMPILED_FLAG_SYMBOL@{ub}
     dbxread.c

@{b}GCC_COMPILED_FLAG_SYMBOL@{ub}
     dbxread.c

@{b}GCC_MANGLE_BUG@{ub}
     symtab.c

@{b}GCC_PRODUCER@{ub}
     dwarfread.c

@{b}GDB_TARGET_IS_HPPA@{ub}
     This determines whether horrible kludge code in dbxread.c and
     partial-stab.h is used to mangle multiple-symbol-table files from
     HPPA's.  This should all be ripped out, and a scheme like
     elfread.c used.

@{b}GDB_TARGET_IS_MACH386@{ub}
     mach386-xdep.c

@{b}GDB_TARGET_IS_SUN3@{ub}
     a68v-xdep.c

@{b}GDB_TARGET_IS_SUN386@{ub}
     sun386-xdep.c

@{b}GET_LONGJMP_TARGET@{ub}
     For most machines, this is a target-dependent parameter.  On the
     DECstation and the Iris, this is a native-dependent parameter,
     since <setjmp.h> is needed to define it.

     This macro determines the target PC address that longjmp() will
     jump to, assuming that we have just stopped at a longjmp
     breakpoint.  It takes a CORE_ADDR * as argument, and stores the
     target PC value through this pointer.  It examines the current
     state of the machine as needed.

@{b}GET_SAVED_REGISTER@{ub}
     Define this if you need to supply your own definition for the
     function @{b}get_saved_register@{ub}.  Currently this is only done for the
     a29k.

@{b}GPLUS_PRODUCER@{ub}
     dwarfread.c

@{b}GR64_REGNUM@{ub}
     Very a29k-specific.

@{b}HAVE_REGISTER_WINDOWS@{ub}
     Define this if the target has register windows.

@{b}REGISTER_IN_WINDOW_P regnum@{ub}
     Define this to be an expression that is 1 is the given register is
     in the window.

@{b}IBM6000_TARGET@{ub}
     Shows that we are configured for an IBM RS/6000 target.  This
     conditional should be eliminated (FIXME) and replaced by
     feature-specific macros.  It was introduced in haste and we are
     repenting at leisure.

@{b}IEEE_FLOAT@{ub}
     Define this if the target system uses IEEE-format floating point
     numbers.

@{b}IGNORE_SYMBOL type@{ub}
     This seems to be no longer used.

@{b}INIT_EXTRA_FRAME_INFO (fromleaf, fci)@{ub}
     If defined, this should be a C expression or statement that fills
     in the @{b}EXTRA_FRAME_INFO@{ub} slots of the given frame FCI.

@{b}INIT_EXTRA_SYMTAB_INFO@{ub}
     symfile.c

@{b}INIT_FRAME_PC (fromleaf, prev)@{ub}
     This is a C statement that sets the pc of the frame pointed to by
     PREV.  [By default...]

@{b}INNER_THAN@{ub}
     Define this to be either @{b}<@{ub} if the target's stack grows downward in
     memory, or @{b}>@{ub} is the stack grows upwards.

@{b}IN_SIGTRAMP pc name@{ub}
     Define this to return true if the given pc and/or name indicates
     that the current function is a sigtramp.

@{b}SIGTRAMP_START@{ub}

@{b}SIGTRAMP_END@{ub}
     Define these to be the start and end address of the sigtramp.
     These will be used if defined, and @{b}IN_SIGTRAMP@{ub} is not; otherwise
     the name of the sigtramp will be assumed to be @{b}_sigtramp@{ub}.

@{b}IN_SOLIB_TRAMPOLINE pc name@{ub}
     Define this to evaluate to nonzero if the program is stopped in
     the trampoline that connects to a shared library.

@{b}IS_TRAPPED_INTERNALVAR name@{ub}
     This is an ugly hook to allow the specification of special actions
     that should occur as a side-effect of setting the value of a
     variable internal to GDB.  Currently only used by the h8500.  Note
     that this could be either a host or target conditional.

@{b}KERNEL_DEBUGGING@{ub}
     tm-ultra3.h

@{b}LCC_PRODUCER@{ub}
     dwarfread.c

@{b}L_LNNO32@{ub}
     coffread.c

@{b}MIPSEL@{ub}
     mips-tdep.c

@{b}MOTOROLA@{ub}
     xm-altos.h

@{b}NBPG@{ub}
     altos-xdep.c

@{b}NEED_TEXT_START_END@{ub}
     Define this if GDB should determine the start and end addresses of
     the text section.  (Seems dubious.)

@{b}NOTICE_SIGNAL_HANDLING_CHANGE@{ub}
     infrun.c

@{b}NO_HIF_SUPPORT@{ub}
     remote-mm.c

@{b}NO_SIGINTERRUPT@{ub}
     remote-adapt.c

@{b}NO_SINGLE_STEP@{ub}
     Define this if the target does not support single-stepping.  If
     this is defined, you must supply, in @{b}*-tdep.c@{ub}, the function
     @{b}single_step@{ub}, which takes a pid as argument and returns nothing.
     It must insert breakpoints at each possible destinations of the
     next instruction.  See @{b}sparc-tdep.c@{ub} and @{b}rs6000-tdep.c@{ub} for examples.

@{b}NUMERIC_REG_NAMES@{ub}
     mips-tdep.c

@{b}N_SETV@{ub}
     dbxread.c

@{b}N_SET_MAGIC@{ub}
     hppabsd-tdep.c

@{b}ONE_PROCESS_WRITETEXT@{ub}
     breakpoint.c

@{b}PCC_SOL_BROKEN@{ub}
     dbxread.c

@{b}PC_IN_CALL_DUMMY@{ub}
     inferior.h

@{b}PC_LOAD_SEGMENT@{ub}
     stack.c

@{b}PC_REGNUM@{ub}
     If the program counter is kept in a register, then define this
     macro to be the number of that register.  This need be defined
     only if @{b}TARGET_WRITE_PC@{ub} is not defined.

@{b}NPC_REGNUM@{ub}
     The number of the "next program counter" register, if defined.

@{b}NNPC_REGNUM@{ub}
     The number of the "next next program counter" register, if defined.
     Currently, this is only defined for the Motorola 88K.

@{b}PRINT_RANDOM_SIGNAL@{ub}
     infcmd.c

@{b}PRINT_REGISTER_HOOK@{ub}
     infcmd.c

@{b}PRINT_TYPELESS_INTEGER@{ub}
     This is an obscure substitute for @{b}print_longest@{ub} that seems to have
     been defined for the Convex target.

@{b}PROCESS_LINENUMBER_HOOK@{ub}
     buildsym.c

@{b}PROLOGUE_FIRSTLINE_OVERLAP@{ub}
     infrun.c

@{b}PS_REGNUM@{ub}
     parse.c

@{b}PUSH_ARGUMENTS@{ub}
     valops.c

@{b}REGISTER_BYTES@{ub}
     remote.c

@{b}REGISTER_NAMES@{ub}
     Define this to expand into an initializer of an array of strings.
     Each string is the name of a register.  [more detail]

@{b}REG_STACK_SEGMENT@{ub}
     exec.c

@{b}REG_STRUCT_HAS_ADDR@{ub}
     findvar.c

@{b}R_FP@{ub}
     dwarfread.c

@{b}R_OK@{ub}
     xm-altos.h

@{b}SDB_REG_TO_REGNUM@{ub}
     Define this to convert sdb register numbers into GDB regnums.  If
     not defined, no conversion will be done.

@{b}SEEK_END@{ub}
     state.c

@{b}SEEK_SET@{ub}
     state.c

@{b}SEM@{ub}
     coffread.c

@{b}SHELL_COMMAND_CONCAT@{ub}
     infrun.c

@{b}SHELL_FILE@{ub}
     infrun.c

@{b}SHIFT_INST_REGS@{ub}
     breakpoint.c

@{b}SIGTRAP_STOP_AFTER_LOAD@{ub}
     infrun.c

@{b}SKIP_PROLOGUE@{ub}
     A C statement that advances the PC across any function entry
     prologue instructions so as to reach "real" code.

@{b}SKIP_PROLOGUE_FRAMELESS_P@{ub}
     A C statement that should behave similarly, but that can stop as
     soon as the function is known to have a frame.  If not defined,
     @{b}SKIP_PROLOGUE@{ub} will be used instead.

@{b}SKIP_TRAMPOLINE_CODE (pc)@{ub}
     If the target machine has trampoline code that sits between callers
     and the functions being called, then define this macro to return a
     new PC that is at the start of the real function.

@{b}SP_REGNUM@{ub}
     parse.c

@{b}STAB_REG_TO_REGNUM@{ub}
     Define this to convert stab register numbers (as gotten from `r'
     declarations) into GDB regnums.  If not defined, no conversion
     will be done.

@{b}STACK_ALIGN@{ub}
     valops.c

@{b}STOP_SIGNAL@{ub}
     main.c

@{b}STORE_RETURN_VALUE (type, valbuf)@{ub}
     A C expression that stores a function return value of type TYPE,
     where VALBUF is the address of the value to be stored.

@{b}SUN4_COMPILER_FEATURE@{ub}
     infrun.c

@{b}SUN_FIXED_LBRAC_BUG@{ub}
     dbxread.c

@{b}SVR4_SHARED_LIBS@{ub}
     solib.c

@{b}SYMBOL_RELOADING_DEFAULT@{ub}
     symfile.c

@{b}TARGET_BYTE_ORDER@{ub}
     The ordering of bytes in the target.  This must be defined to be
     either @{b}BIG_ENDIAN@{ub} or @{b}LITTLE_ENDIAN@{ub}.

@{b}TARGET_CHAR_BIT@{ub}
     Number of bits in a char; defaults to 8.

@{b}TARGET_COMPLEX_BIT@{ub}
     Number of bits in a complex number; defaults to @{b}2 *
     TARGET_FLOAT_BIT@{ub}.

@{b}TARGET_DOUBLE_BIT@{ub}
     Number of bits in a double float; defaults to @{b}8 * TARGET_CHAR_BIT@{ub}.

@{b}TARGET_DOUBLE_COMPLEX_BIT@{ub}
     Number of bits in a double complex; defaults to @{b}2 *
     TARGET_DOUBLE_BIT@{ub}.

@{b}TARGET_FLOAT_BIT@{ub}
     Number of bits in a float; defaults to @{b}4 * TARGET_CHAR_BIT@{ub}.

@{b}TARGET_INT_BIT@{ub}
     Number of bits in an integer; defaults to @{b}4 * TARGET_CHAR_BIT@{ub}.

@{b}TARGET_LONG_BIT@{ub}
     Number of bits in a long integer; defaults to @{b}4 * TARGET_CHAR_BIT@{ub}.

@{b}TARGET_LONG_DOUBLE_BIT@{ub}
     Number of bits in a long double float; defaults to @{b}2 *
     TARGET_DOUBLE_BIT@{ub}.

@{b}TARGET_LONG_LONG_BIT@{ub}
     Number of bits in a long long integer; defaults to @{b}2 *
     TARGET_LONG_BIT@{ub}.

@{b}TARGET_PTR_BIT@{ub}
     Number of bits in a pointer; defaults to @{b}TARGET_INT_BIT@{ub}.

@{b}TARGET_SHORT_BIT@{ub}
     Number of bits in a short integer; defaults to @{b}2 * TARGET_CHAR_BIT@{ub}.

@{b}TARGET_READ_PC@{ub}

@{b}TARGET_WRITE_PC (val, pid)@{ub}

@{b}TARGET_READ_SP@{ub}

@{b}TARGET_WRITE_SP@{ub}

@{b}TARGET_READ_FP@{ub}

@{b}TARGET_WRITE_FP@{ub}
     These change the behavior of @{b}read_pc@{ub}, @{b}write_pc@{ub}, @{b}read_sp@{ub}, @{b}write_sp@{ub},
     @{b}read_fp@{ub} and @{b}write_fp@{ub}.  For most targets, these may be left
     undefined.  GDB will call the read and write register functions
     with the relevant @{b}_REGNUM@{ub} argument.

     These macros are useful when a target keeps one of these registers
     in a hard to get at place;  for example, part in a segment
     register and part in an ordinary register.

@{b}USE_STRUCT_CONVENTION (gcc_p, type)@{ub}
     If defined, this must be an expression that is nonzero if a value
     of the given TYPE being returned from a function must have space
     allocated for it on the stack.  GCC_P is true if the function
     being considered is known to have been compiled by GCC; this is
     helpful for systems where GCC is known to use different calling
     convention than other compilers.

@{b}VARIABLES_INSIDE_BLOCK (desc, gcc_p)@{ub}
     For dbx-style debugging information, if the compiler puts variable
     declarations inside LBRAC/RBRAC blocks, this should be defined to
     be nonzero.  DESC is the value of @{b}n_desc@{ub} from the @{b}N_RBRAC@{ub} symbol,
     and GCC_P is true if GDB has noticed the presence of either the
     @{b}GCC_COMPILED_SYMBOL@{ub} or the @{b}GCC2_COMPILED_SYMBOL@{ub}.  By default, this
     is 0.

@{b}OS9K_VARIABLES_INSIDE_BLOCK (desc, gcc_p)@{ub}
     Similarly, for OS/9000.  Defaults to 1.

@{b}WRS_ORIG@{ub}
     remote-vx.c

@{b}test@{ub}
     (Define this to enable testing code in regex.c.)

   Motorola M68K target conditionals.

@{b}BPT_VECTOR@{ub}
     Define this to be the 4-bit location of the breakpoint trap vector.
     If not defined, it will default to @{b}0xf@{ub}.

@{b}REMOTE_BPT_VECTOR@{ub}
     Defaults to @{b}1@{ub}.


@endnode

@node "Native Conditionals" "gdbint.guide/Native Conditionals"
@next "Obsolete Conditionals"
@prev "Target Conditionals"
@toc "Main"

Native Conditionals
*******************

   When GDB is configured and compiled, various macros are defined or
left undefined, to control compilation when the host and target systems
are the same.  These macros should be defined (or left undefined) in
@{b}nm-SYSTEM.h@{ub}.

@{b}ATTACH_DETACH@{ub}
     If defined, then GDB will include support for the @{b}attach@{ub} and
     @{b}detach@{ub} commands.

@{b}CHILD_PREPARE_TO_STORE@{ub}
     If the machine stores all registers at once in the child process,
     then define this to ensure that all values are correct.  This
     usually entails a read from the child.

     [Note that this is incorrectly defined in @{b}xm-SYSTEM.h@{ub} files
     currently.]

@{b}FETCH_INFERIOR_REGISTERS@{ub}
     Define this if the native-dependent code will provide its own
     routines @{b}fetch_inferior_registers@{ub} and @{b}store_inferior_registers@{ub} in
     @{b}HOST-nat.c@{ub}.  If this symbol is @{i}not@{ui} defined, and @{b}infptrace.c@{ub} is
     included in this configuration, the default routines in
     @{b}infptrace.c@{ub} are used for these functions.

@{b}GET_LONGJMP_TARGET@{ub}
     For most machines, this is a target-dependent parameter.  On the
     DECstation and the Iris, this is a native-dependent parameter,
     since <setjmp.h> is needed to define it.

     This macro determines the target PC address that longjmp() will
     jump to, assuming that we have just stopped at a longjmp
     breakpoint.  It takes a CORE_ADDR * as argument, and stores the
     target PC value through this pointer.  It examines the current
     state of the machine as needed.

@{b}PROC_NAME_FMT@{ub}
     Defines the format for the name of a @{b}/proc@{ub} device.  Should be
     defined in @{b}nm.h@{ub} @{i}only@{ui} in order to override the default definition
     in @{b}procfs.c@{ub}.

@{b}PTRACE_FP_BUG@{ub}
     mach386-xdep.c

@{b}PTRACE_ARG3_TYPE@{ub}
     The type of the third argument to the @{b}ptrace@{ub} system call, if it
     exists and is different from @{b}int@{ub}.

@{b}REGISTER_U_ADDR@{ub}
     Defines the offset of the registers in the "u area"; see @{"Host" link "Host"}.

@{b}SOLIB_ADD (filename, from_tty, targ)@{ub}
     Define this to expand into an expression that will cause the
     symbols in FILENAME to be added to GDB's symbol table.

@{b}SOLIB_CREATE_INFERIOR_HOOK@{ub}
     Define this to expand into any shared-library-relocation code that
     you want to be run just after the child process has been forked.

@{b}START_INFERIOR_TRAPS_EXPECTED@{ub}
     When starting an inferior, GDB normally expects to trap twice;
     once when the shell execs, and once when the program itself execs.
     If the actual number of traps is something other than 2, then
     define this macro to expand into the number expected.

@{b}USE_PROC_FS@{ub}
     This determines whether small routines in @{b}*-tdep.c@{ub}, which
     translate register values between GDB's internal representation
     and the /proc representation, are compiled.

@{b}U_REGS_OFFSET@{ub}
     This is the offset of the registers in the upage.  It need only be
     defined if the generic ptrace register access routines in
     @{b}infptrace.c@{ub} are being used (that is, @{b}infptrace.c@{ub} is configured in,
     and @{b}FETCH_INFERIOR_REGISTERS@{ub} is not defined).  If the default value
     from @{b}infptrace.c@{ub} is good enough, leave it undefined.

     The default value means that u.u_ar0 @{i}points to@{ui} the location of the
     registers.  I'm guessing that @{b}#define U_REGS_OFFSET 0@{ub} means that
     u.u_ar0 @{i}is@{ui} the location of the registers.

@{b}CLEAR_SOLIB@{ub}
     objfiles.c

@{b}DEBUG_PTRACE@{ub}
     Define this to debug ptrace calls.


@endnode

@node "Obsolete Conditionals" "gdbint.guide/Obsolete Conditionals"
@next "XCOFF"
@prev "Native Conditionals"
@toc "Main"

Obsolete Conditionals
*********************

   Fragments of old code in GDB sometimes reference or set the following
configuration macros.  They should not be used by new code, and old
uses should be removed as those parts of the debugger are otherwise
touched.

@{b}STACK_END_ADDR@{ub}
     This macro used to define where the end of the stack appeared, for
     use in interpreting core file formats that don't record this
     address in the core file itself.  This information is now
     configured in BFD, and GDB gets the info portably from there.  The
     values in GDB's configuration files should be moved into BFD
     configuration files (if needed there), and deleted from all of
     GDB's config files.

     Any @{b}FOO-xdep.c@{ub} file that references STACK_END_ADDR is so old that
     it has never been converted to use BFD.  Now that's old!


@endnode

@node "XCOFF" "gdbint.guide/XCOFF"
@prev "Obsolete Conditionals"
@toc "Main"

The XCOFF Object File Format
****************************

   The IBM RS/6000 running AIX uses an object file format called xcoff.
The COFF sections, symbols, and line numbers are used, but debugging
symbols are dbx-style stabs whose strings are located in the @{b}.debug@{ub}
section (rather than the string table).  For more information, See
@{"Top" link "stabs.guide/Main"}, and search for XCOFF.

   The shared library scheme has a nice clean interface for figuring out
what shared libraries are in use, but the catch is that everything which
refers to addresses (symbol tables and breakpoints at least) needs to be
relocated for both shared libraries and the main executable.  At least
using the standard mechanism this can only be done once the program has
been run (or the core file has been read).

@endnode

