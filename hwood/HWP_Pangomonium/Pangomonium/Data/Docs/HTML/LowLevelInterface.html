<html>
<!-- generated from Pangomonium.meta by MetaDoc 1.16 (c) by Andreas Falkenhahn -->
<head>
<title>Using the low-level interface</title>
<meta name="author" content="Andreas Falkenhahn">
<meta name="generator" content="MetaDoc 1.16">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
<!--
body {font-family: sans-serif;}
ul.toc {list-style: none; margin-left: 20px; padding-left: 0px;}
dt.autodoc {font-variant: small-caps; font-size: larger; margin-top: 10px; margin-bottom: 10px; padding-left: 0.2em; padding-top: 0.2em; padding-bottom: 0.2em;
	background-color: #bae1ff; border-width: 1px; border-color: #3baaff; border-style: solid;}
dt.codelist {margin-bottom: 0.2em;}
h2.heading {background-color: #bae1ff; font-family: Arial; padding-top: 0.4em; padding-bottom: 0.4em;}
code {background-color: #f2f2f2; padding: 2px 4px; font-weight: bold;}
pre {background-color: #f2f2f2; border: 1px solid #ddd; padding: 0.3em;}
		
-->
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#0000FF">
<h2 class="heading">3.5 Using the low-level interface</h2>

<p>
Using Pangomonium's low-level interface is more difficult than using the high-level interface
because it allows you to access Pango and Cairo APIs directly. This means that you should first
make yourself familiar with those APIs so that you know how they are designed and how they
can serve your purposes.

<p>
On top of the core Pango and Cairo APIs, Pangomonium also offers some special functions that can
be used to bridge Pango/Cairo calls and Hollywood functions. One of the key functions that serves
as such a bridge is <a href="csurfaceToBrush.html">csurface:ToBrush()</a> which allows you to convert a Cairo surface to a
Hollywood brush. Conversely, it is also possible to create Cairo surfaces from Hollywood brushes
by using the <a href="cairoImageSurfaceFromBrush.html">cairo.ImageSurfaceFromBrush()</a> function.

<p>
By using these bridging functions, you can use Pango/Cairo APIs directly and then convert the
result to a Hollywood brush. For example, drawing text using Pango typically involves the following
steps:

<p>
<ol>
<li>Create a Pango fontmap
</li><li>Create a Pango context from the fontmap
</li><li>Create a Pango layout from the context
</li><li>Create a Pango font description and assign it to the layout
</li><li>Load a font into the fontmap
</li><li>Set text that is to be rendered
</li><li>Create a Cairo surface
</li><li>Create a Cairo context from the surface
</li><li>Show the Pango layout on the Cairo context
</li><li>Convert the Cairo surface to a Hollywood brush
</li></ol>

<p>
As you can see, it's quite some work to draw text with Pangomonium when using the
Pango/Cairo APIs directly. It's much easier to do it with the <a href="HighLevelInterface.html">high-level interface</a>
but only the low-level interface allows you to access all of Pango's and Cairo's features.

<p>
Here is what the steps described above look like in actual code:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>@REQUIRE &quot;pangomonium&quot;
@DISPLAY {Color = #WHITE}

fontmap = pango.FontMap(#CAIRO_FONT_TYPE_FT)
context = fontmap:CreateContext()
layout = pango.Layout(context)
fontdesc = pango.FontDescription(&quot;DejaVu Sans 72&quot;)
layout:SetFontDescription(fontdesc)
fontmap:LoadFont(context, fontdesc)
layout:SetText(&quot;Hello World&quot;)
img = cairo.ImageSurface(#CAIRO_FORMAT_ARGB32, 640, 480)
cr = cairo.Context(img)
cr:ShowLayout(layout)
img:ToBrush(1)
DisplayBrush(1, 0, 0)
</pre></td></tr></table><p>

When using the low-level interface you also need to think about freeing objects
when they are no longer in use. This can be done by calling the <code>Free()</code> methods
of the individual objects, e.g. <a href="pcontextFree.html">pcontext:Free()</a> to free a Pango context.
Alternatively, you can also set the object to <code>Nil</code>. This signals Hollywood's
garbage collector that the object is no longer in use and can be freed. However,
keep in mind that garbage collection will only occur if there are really no more
references to the object anywhere. Thus, it might be safer to explicitly call the
<code>Free()</code> methods instead of setting objects to <code>Nil</code>.

<p>
If you put the code from the example above in a function and use local variables
only, however, you can get away without explicitly calling <code>Free()</code> on all
objects because local variables will automatically be garbage-collected once
they go out of scope. Consider the following code, which is the same as above
with the only difference that the code is now wrapped inside a function:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>Function p_DrawText(t$, brush)
   Local fontmap = pango.FontMap()
   Local context = fontmap:CreateContext()
   Local layout = pango.Layout(context)
   Local fontdesc = pango.FontDescription(&quot;DejaVu Sans 72&quot;)
   layout:SetFontDescription(fontdesc)
   fontmap:LoadFont(context, fontdesc)
   layout:SetText(t$)
   Local img = cairo.ImageSurface(#CAIRO_FORMAT_ARGB32, 640, 480)
   Local cr = cairo.Context(img)
   cr:ShowLayout(layout)
   img:ToBrush(brush)
EndFunction
</pre></td></tr></table><p>

Since all Pango and Cairo objects are stored inside local variables, everything
will be marked for garbage collection as soon as the function returns. Thus, in
this case it isn't necessary to explicitly free objects by calling <code>Free()</code>, even
though it might be considered good practice to do so nevertheless.

<p>
For more information on the Pango and Cairo APIs, please refer to the following
chapters.

<p>
<hr>
<font size=-2><a href="LowLevelInterface_.html" target="_top">Show TOC</a></font>
</body>
</html>