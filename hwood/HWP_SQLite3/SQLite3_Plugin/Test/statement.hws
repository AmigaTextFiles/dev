@require "sqlite3"

local db = sqlite3.open_memory()

db:exec([[
  CREATE TABLE test (
    id        INTEGER PRIMARY KEY,
    content   VARCHAR
  );
]])

local insert_stmt = db:prepare("INSERT INTO test VALUES (NULL, ?)")

local function insert(data)
  insert_stmt:bind_values(data)
  insert_stmt:dostep()
  insert_stmt:reset()
endfunction

local select_stmt = db:prepare("SELECT * FROM test")

local function select()
  for row in select_stmt:nrows()
    debugprint(row.id, row.content)
  next
endfunction

insert("Hello World")
debugprint("First:")
select()

insert("Hello Lua")
debugprint("Second:")
select()

insert("Hello Sqlite3")
debugprint("Third:")
select()
