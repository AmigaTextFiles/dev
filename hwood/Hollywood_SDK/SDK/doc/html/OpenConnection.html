<html>
<!-- generated from hollywood_sdk.meta by MetaDoc 1.13 (c) by Andreas Falkenhahn -->
<head>
<title>OpenConnection</title>
<meta name="author" content="Andreas Falkenhahn">
<meta name="generator" content="MetaDoc 1.13">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
<!--
body {font-family: sans-serif;}
ul.toc {list-style: none; margin-left: 20px; padding-left: 0px;}
dt.autodoc {font-variant: small-caps; font-size: larger; margin-top: 10px; margin-bottom: 10px; padding-left: 0.2em; padding-top: 0.2em; padding-bottom: 0.2em;
	background-color: #bae1ff; border-width: 1px; border-color: #3baaff; border-style: solid;}
dt.codelist {margin-bottom: 0.2em;}
h2.heading {background-color: #bae1ff; font-family: Arial; padding-top: 0.4em; padding-bottom: 0.4em;}
code {background-color: #f2f2f2; padding: 2px 4px; font-weight: bold;}
pre {background-color: #f2f2f2; border: 1px solid #ddd; padding: 0.3em;}
		
-->
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#0000FF">
<dl>
<dt class="autodoc"><b>Name</b></dt><dd>
OpenConnection -- open a connection (V8.0)</dd>
<dt class="autodoc"><b>Synopsis</b></dt><dd>
<pre>
APTR handle = OpenConnection(STRPTR address, int port, struct hwTagList
                                 *tags);</pre>
</dd>
<dt class="autodoc"><b>Function</b></dt><dd>
This function is called when Hollywood tries to connect to a server. Your <code>OpenConnection()</code>
implementation has to check whether your plugin wants to handle this connection or not. If
your plugin wants to handle this connection, your <code>OpenConnection()</code> implementation needs to
open it and return a handle, which will be used to refer to this connection by all other
functions of your network adapter plugin, back to Hollywood. If your plugin doesn't want
to handle the connection, your <code>OpenConnection()</code> implementation has to return <code>NULL</code>. The handle
returned by this function is an opaque data type only your plugin knows about. Hollywood will
just use this handle to refer to the connection.

<p>
The <code>address</code> and <code>port</code> parameters will contain the address and port number of the server to
connect to. Note that <code>address</code> could be an IP address in IPv4 or IPv6 notation or a host name.

<p>
Starting with Hollywood 9.0, <code>OpenConnection()</code> can also be used to implement complete protocol
handling. This makes it possible to add support for new protocols to Hollywood's <code>DownloadFile()</code>
and <code>UploadFile()</code> functions. By default, those functions only support HTTP and FTP. If you want
<code>OpenConnection()</code> to completely take over protocol handling, you have to ignore what is passed in
<code>address</code> and <code>port</code> because it contains no protocol information but just the address and port of
a remote machine. Instead, you have to examine the URL that is passed in the new <code>HWOPENCONNTAG_URL</code>
tag. Hollywood will pass a full URL, i.e. including the protocol identifier, in that tag. If the
URL contains a protocol you would like to handle, you'll have to set the <code>HWOPENCONNTAG_CUSTOMPROTOCOL</code>
tag to <code>True</code> then. See below for details.

<p>
Additionally, Hollywood might pass a tag list containing further parameters to <code>OpenConnection()</code>.
The following tags can currently be set:

<p>
<dl>
<dt class="codelist"><code>HWOPENCONNTAG_SSL:</code></dt>
<dd>
Hollywood functions like <code>DownloadFile()</code> or <code>OpenConnection()</code> support a tag named <code>SSL</code> that
can be set to indicate that the connection should be established using SSL. If this tag
is set to <code>True</code>, the <code>iData</code> member of <code>HWOPENCONNTAG_SSL</code> will also be set to <code>True</code>. How your
plugin interprets this tag, is up to you.

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_TIMEOUT:</code></dt>
<dd>
If this tag is part of the tag list, the <code>iData</code> member will tell your implementation of
<code>OpenConnection()</code> to maximum amount of time that should be used to try to connect to the
server. This timeout value will be specified in milliseconds.

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_URL:</code></dt>
<dd>
The <code>pData</code> member of this tag will be set to a string that contains the full URL the user has
passed to <code>DownloadFile()</code> or <code>UploadFile()</code>. This tag is important if your <code>OpenConnection()</code>
implementation wants to take over protocol handling completely. In that case, you can ignore
what is passed in the <code>address</code> and <code>port</code> arguments and just use the URL specified here. Note
that you have to set <code>HWOPENCONNTAG_CUSTOMPROTOCOL</code> to <code>True</code> to signal to Hollywood that you
want to take over all protocol handling (see below) (V9.0).

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_CUSTOMPROTOCOL:</code></dt>
<dd>
The <code>pData</code> member of this tag will be set to a pointer to an <code>int</code>. You have to write <code>True</code>
to this <code>int</code> pointer to indicate that your plugin wants to do all protocol handling on its
own. In that case, Hollywood won't perform any protocol I/O with your connection but it will
just expect your <a href="ReceiveData.html">ReceiveData()</a> function to provide the data to be
downloaded, or, in case <code>HWOPENCONNTAG_UPLOAD</code> has been set to <code>True</code>, it will just send the
data that should be uploaded by calling <a href="SendData.html">SendData()</a>. Note that if you
set this tag to <code>True</code>, your <a href="GetConnectionInfo.html">GetConnectionInfo()</a> function should
be prepared to return some statistical information about the connection, like the total
number of bytes to be transferred. See <a href="GetConnectionInfo.html">GetConnectionInfo</a> for details. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_UPLOAD:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag contains a boolean value that indicates whether data should be uploaded
or downloaded. Note that even if this is set to <code>True</code>, Hollywood might still call your
<a href="ReceiveData.html">ReceiveData()</a> function as well because protocols like HTTP often
return HTML pages after finishing the upload. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_UPLOADSIZE:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, the <code>pData</code> member of this tag will be set to a pointer to a <code>DOSINT64</code> containing
the size in bytes of the data to be uploaded. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_USERNAME:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, the <code>pData</code> member of this tag will point to a string containing the user name to
be used for protocol authentification. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_PASSWORD:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, the <code>pData</code> member of this tag will point to a string containing the password to
be used for protocol authentification. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_FOLLOWLOCATION:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag will be set to <code>True</code> if redirections to a new address should be allowed
or <code>False</code> if they should be forbidden. Redirections to new addresses are often requested
by HTTP servers. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_TEXTMODE:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag will be set to <code>True</code> if the transfers should be done in text (ASCII)
mode. FTP servers typically distinguish between text and binary transfer modes. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_MULTIPART:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, the <code>pData</code> member of this tag may be set to a <code>struct hwMultiPartInfo</code>
pointer containing a list of multiple parts to be uploaded to a HTTP server by using the
<code>POST</code> method.

<p>
The <code>struct hwMultiPartInfo</code> looks like this:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>struct hwMultiPartInfo
{
    struct hwMultiPartInfo *Succ;
    STRPTR Name;
    STRPTR MIMEType;
    STRPTR DestFile;
    STRPTR Data;
    APTR FileHandle;
    DOSINT64 Length;
};
</pre></td></tr></table><p>

Here is a description of the individual structure members:

<p>
<dl>
<dt class="codelist"><code>Succ:</code></dt>
<dd>
Pointer to the next item in the list.

<p>
</dd>
<dt class="codelist"><code>Name:</code></dt>
<dd>
Name of the part object. This will always be specified.

<p>
</dd>
<dt class="codelist"><code>MIMEType:</code></dt>
<dd>
MIME type of the part object. This may be <code>NULL</code>.

<p>
</dd>
<dt class="codelist"><code>DestFile:</code></dt>
<dd>
If the part is a file that should be uploaded to the server, this member will
be set to the filename that should be used when storing the file on the server.
Note that this will only contain the filename, not any path components. If this
is <code>NULL</code>, then the part object shouldn't be uploaded as a file.

<p>
</dd>
<dt class="codelist"><code>Data:</code></dt>
<dd>
This may be set to a pointer containing the data to be uploaded. Either this
member or <code>FileHandle</code> will always be set. If <code>Data</code> is set, <code>FileHandle</code> will be <code>NULL</code> and
vice versa. The size of the data to be uploaded will be specified in the
<code>Length</code> member. If <code>DestFile</code> is non-<code>NULL</code>, the data must be uploaded as a file, otherwise
it must be uploaded as form data.

<p>
</dd>
<dt class="codelist"><code>FileHandle:</code></dt>
<dd>
This may be set to a pointer to file handle that contains the data to be uploaded.
You can use DOS functions like <a href="hw_FRead.html">hw_FRead()</a> to read data from this
file. Note that if this member is set, the part object must always be stored as a file
on the server. <code>DestFile</code> will contain the name to use for that. The <code>Length</code> member
will contain the file size. If <code>FileHandle</code> is set, <code>Data</code> will always be <code>NULL</code> and
vice versa.

<p>
</dd>
<dt class="codelist"><code>Length:</code></dt>
<dd>
This will be set to the length in bytes of the data to be uploaded for this part
object. The data to be uploaded will be specified either via the <code>Data</code> or the
<code>FileHandle</code> members (see above).
</dd></dl>

<p>
Note that <code>HWOPENCONNTAG_UPLOADSIZE</code> won't contain a valid size when using multi-part
uploads.

<p>
There is also the <code>HWOPENCONNTAG_POST</code> tag which Hollywood can also use to specify data
to be uploaded to a HTTP server (see below). <code>HWOPENCONNTAG_POST</code> and <code>HWOPENCONNTAG_MULTIPART</code>
are mutually exclusive. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_PROXY:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag, if it is set, will contain the address of a server to use as a proxy
server for the connection. The proxy's name will be passed as a string in the <code>pData</code>
tag member. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_USERAGENT:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag, if it is set, will contain the name to pass in the user agent
header of HTTP requests. The name will be passed as a string in the <code>pData</code> tag member.
(V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_CUSTOMHEADERS:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag, if it is set, will contain a list of custom headers to pass to the
HTTP server. The individual headers will be passed as a string in the <code>pData</code> tag member
and they will be separated by \r\n characters (carriage return and line feed). (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_VERBOSE:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag will be set to <code>True</code> if the user has requested verbose mode by setting
the <code>Verbose</code> tag in <code>DownloadFile()</code> or <code>UploadFile()</code> to <code>True</code>. In verbose mode, your plugin
may choose to log some information about the connection to Hollywood's output device. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_POST:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, if the tag is specified, the <code>pData</code> member of this tag will contain data to
be posted to a HTTP server. Note that this isn't limited to text but can also contain
binary data. The size of the data to be posted will be specified in the <code>HWOPENCONNTAG_POSTSIZE</code>
tag and the type will be specified in the <code>HWOPENCONNTAG_POSTTYPE</code> tag. This tag is an
alternative to the <code>HWOPENCONNTAG_MULTIPART</code> tag which is used for multi-part messages.
<code>HWOPENCONNTAG_POST</code> and <code>HWOPENCONNTAG_MULTIPART</code> are mutually exclusive. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_POSTSIZE:</code></dt>
<dd>
If <code>HWOPENCONNTAG_POST</code> has been set, this will contain the size in bytes of the data
to be uploaded. Hollywood will set the <code>pData</code> member of this tag to a pointer to a
<code>DOSINT64</code> that contains the size in bytes of the data to be uploaded. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_POSTTYPE:</code></dt>
<dd>
If <code>HWOPENCONNTAG_POST</code> has been set, the <code>pData</code> member of this tag will contain a
string describing the MIME type of the data to be uploaded. (V9.0)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_FAILONERROR:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag will be set to <code>True</code> if the connection should fail in case the remote
file doesn't exist. For example, when requesting a non-existing file from a HTTP server,
the server will still return data (a 404 error page) instead of failing. If Hollywood
wants your plugin to fail in such cases and not return a 404 error page, it will set
<code>HWOPENCONNTAG_FAILONERROR</code> to <code>True</code>. (V9.1)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_ENCODED:</code></dt>
<dd>
You only need to handle this tag if your plugin wants to take over protocol handling. In
that case, this tag will be set to <code>True</code> if the URL passed in <code>HWOPENCONNTAG_URL</code> is already
escaped. If this tag is set to <code>False</code> or if it isn't present at all, the URL passed in
<code>HWOPENCONNTAG_URL</code> is unescaped and might need escaping before it can be parsed. (V9.1)

<p>
</dd>
<dt class="codelist"><code>HWOPENCONNTAG_USERTAGS:</code></dt>
<dd>
If this is set, <code>pData</code> will point to a <code>struct hwUserTagList</code> containing
a list of user tags passed by the Hollywood script. User tags are a way of
passing additional information from Hollywood scripts to plugin functions.
See <a href="UserTags.html">User tags</a> for details. (V10.0)
</dd></dl>

<p>
</dd>
<dt class="autodoc"><b>Inputs</b></dt><dd>
<dl>
<dt><i>address</i></dt>
<dd>address to connect to (see notes above)</dd>
<dt><i>port</i></dt>
<dd>port number to use</dd>
<dt><i>tags</i></dt>
<dd>a tag list or <code>NULL</code></dl>
</dd>
<dt class="autodoc"><b>Results</b></dt><dd>
<dl>
<dt><i>handle</i></dt>
<dd>handle to refer to this connection later or <code>NULL</code> if your plugin
doesn't want to handle this connection</dd></dl>
</dd></dl>
<hr>
<font size=-2><a href="OpenConnection_.html" target="_top">Show TOC</a></font>
</body>
</html>