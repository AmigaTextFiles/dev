<html>
<!-- generated from hollywood_sdk.meta by MetaDoc 1.13 (c) by Andreas Falkenhahn -->
<head>
<title>Building for 68881 and 68882</title>
<meta name="author" content="Andreas Falkenhahn">
<meta name="generator" content="MetaDoc 1.13">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
<!--
body {font-family: sans-serif;}
ul.toc {list-style: none; margin-left: 20px; padding-left: 0px;}
dt.autodoc {font-variant: small-caps; font-size: larger; margin-top: 10px; margin-bottom: 10px; padding-left: 0.2em; padding-top: 0.2em; padding-bottom: 0.2em;
	background-color: #bae1ff; border-width: 1px; border-color: #3baaff; border-style: solid;}
dt.codelist {margin-bottom: 0.2em;}
h2.heading {background-color: #bae1ff; font-family: Arial; padding-top: 0.4em; padding-bottom: 0.4em;}
code {background-color: #f2f2f2; padding: 2px 4px; font-weight: bold;}
pre {background-color: #f2f2f2; border: 1px solid #ddd; padding: 0.3em;}
		
-->
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#0000FF">
<h2 class="heading">3.5 Building for 68881 and 68882</h2>

<p>
Some extra care needs to be taken when compiling plugins for the 68881 and 68882 FPUs.
Hollywood's plugin interface was designed to allow plugins compiled for 68881/2 to be
used with the non-FPU version of Hollywood as well. This means that return values from
plugins compiled for 68881/2 must never be stored in FPU registers like <code>fp0</code>. Instead,
return values must always be returned in CPU registers. If a 64-bit value is to be
returned from a plugin that has been compiled for 68881/2, it must be returned in
registers <code>d0</code> and <code>d1</code>, not in <code>fp0</code>. Even the FPU version of Hollywood will expect
floating point return values in CPU registers. Hollywood will never look for them
in FPU registers! This design makes it possible to use FPU-compiled plugins with the
non-FPU version of Hollywood and also vice versa.

<p>
Most compilers, however, will use FPU registers for floating point return values
by default. If you're using vbcc, you can change this behaviour by compiling your
source codes using the <code>-no-fp-return</code> command line argument. If this is
specified, vbcc will always use CPU registers for return values. If you compile
your sources with <code>-no-fp-return</code> enabled, however, you'll soon run into
another problem, namely that all the ANSI C runtime library functions which return
floating point values will return them in <code>fp0</code>. This will cause conflicts because
the compiler expects them in <code>d0</code> and <code>d1</code> now. To solve this problem, you will have
to link your project against runtime libraries which also have been compiled using
<code>-no-fp-return</code>. At the time of this writing, the standard vbcc distribution
does not come with these special libraries, but they're available on request from
Frank Wille, who is the maintainer of the Amiga vbcc distribution.

<p>
<hr>
<font size=-2><a href="AmigaOSFPU_.html" target="_top">Show TOC</a></font>
</body>
</html>