<html>
<!-- generated from hollywood_sdk.meta by MetaDoc 1.13 (c) by Andreas Falkenhahn -->
<head>
<title>DecodeVideoFrame</title>
<meta name="author" content="Andreas Falkenhahn">
<meta name="generator" content="MetaDoc 1.13">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
<!--
body {font-family: sans-serif;}
ul.toc {list-style: none; margin-left: 20px; padding-left: 0px;}
dt.autodoc {font-variant: small-caps; font-size: larger; margin-top: 10px; margin-bottom: 10px; padding-left: 0.2em; padding-top: 0.2em; padding-bottom: 0.2em;
	background-color: #bae1ff; border-width: 1px; border-color: #3baaff; border-style: solid;}
dt.codelist {margin-bottom: 0.2em;}
h2.heading {background-color: #bae1ff; font-family: Arial; padding-top: 0.4em; padding-bottom: 0.4em;}
code {background-color: #f2f2f2; padding: 2px 4px; font-weight: bold;}
pre {background-color: #f2f2f2; border: 1px solid #ddd; padding: 0.3em;}
		
-->
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#0000FF">
<dl>
<dt class="autodoc"><b>Name</b></dt><dd>
DecodeVideoFrame -- get video frame from packet (V5.0)</dd>
<dt class="autodoc"><b>Synopsis</b></dt><dd>
<pre>
int more = DecodeVideoFrame(APTR handle, APTR packet,
               struct DecodeVideoFrameCtrl *ctrl);</pre>
</dd>
<dt class="autodoc"><b>Function</b></dt><dd>
This function must decode the specified packet into a video frame. For most
video formats several packets need to be decoded in order to get a single video
frame. If your video decoder needs more packets in order to finish decoding the
video frame, then you have to return <code>True</code> here. This indicates that <code>DecodeVideoFrame()</code>
wants to be fed more packets before handing out a decoded frame.

<p>
Hollywood will pass a pointer to a <code>struct DecodeVideoFrameCtrl</code> structure
to this function. This structure looks like the following:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>struct DecodeVideoFrameCtrl
{
    UBYTE **Buffer;     // [in/out]
    int *BufferWidth;   // [in/out]
    int Delay;          // [out]
    ULONG Offset;       // [out]
    double PTS;         // [out]
    double DTS;         // [out]
};
</pre></td></tr></table><p>

If you return <code>True</code> to indicate that you are not able to decode a full frame
just yet, you don't have to write anything to the <code>struct DecodeVideoFrameCtrl</code>
pointer passed to you by Hollywood. Otherwise you have to set the following
members:

<p>
<dl>
<dt class="codelist"><code>Buffer:</code></dt>
<dd>
This is already initialized to an array of three <code>UBYTE*</code> pointers.
You need to set these pointers to the chunks of memory containing the actual
pixel data of the decoded frame. If you have set the <code>PixFmt</code> member
in <a href="OpenVideo.html">OpenVideo()</a> to <code>HWVIDPIXFMT_ARGB32</code>, you only
need to set the first pointer because ARGB32 frames are stored as chunky
pixels. If you use <code>HWVIDPIXFMT_YUV420P</code>, though, you need to set
all three pointers to point to the individual YUV planes, i.e.

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>ctrl-&gt;Buffer[0] = y_plane;
ctrl-&gt;Buffer[1] = u_plane;
ctrl-&gt;Buffer[2] = v_plane;
</pre></td></tr></table><p>

Make sure that you do not modify the base <code>Buffer</code> pointer! You must
only write to the individual three pointers already allocated for you by Hollywood.

<p>
</dd>
<dt class="codelist"><code>BufferWidth:</code></dt>
<dd>
This is already initialized to an array of three integers. You need to
store the byte length of one row of pixel data for each pixel map
you pass. If you have set the <code>PixFmt</code> member in <a href="OpenVideo.html">OpenVideo()</a>
to <code>HWVIDPIXFMT_ARGB32</code>, you only need to set the first integer
to the byte width of a single row of ARGB32 pixel data because ARGB32
frames are stored as chunky pixels. If you use <code>HWVIDPIXFMT_YUV420P</code>,
though, you need to set all three integers to point to the byte width
of a single row in each of the three individual YUV planes, i.e.

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>ctrl-&gt;BufferWidth[0] = y_plane_bytewidth;
ctrl-&gt;BufferWidth[1] = u_plane_bytewidth;
ctrl-&gt;BufferWidth[2] = v_plane_bytewidth;
</pre></td></tr></table><p>

Make sure that you do not modify the base <code>BufferWidth</code> pointer!
You must only write to the individual integer array items already allocated
for you by Hollywood.

<p>
</dd>
<dt class="codelist"><code>Delay:</code></dt>
<dd>
This member can be used to specify an additional delay for the video frame.
The delay you specify here is multiplied by the <code>FrameTime</code> specified
in <a href="OpenVideo.html">OpenVideo()</a> divided by two. So to delay the current
frame for one <code>FrameTime</code> unit, you'd have to set this member to 2.
This should normally be set to 0.

<p>
</dd>
<dt class="codelist"><code>Offset:</code></dt>
<dd>
This must be set to the current offset in the video stream in bytes. This is
only required if <code>SeekMode</code> in <a href="OpenVideo.html">OpenVideo()</a> has
been set to <code>HWVIDSEEKMODE_BYTE</code>. If that is not the case, you can
set this member to 0.

<p>
</dd>
<dt class="codelist"><code>PTS:</code></dt>
<dd>
This must be set to the video frame's presentation time stamp, i.e. the time when
this frame should be presented to the viewer, relative to the beginning of
the video stream. You have to specify this time stamp as a floating point number
in seconds, i.e. a presentation time stamp of 10.2 means that the frame
is to be shown 10.2 seconds after the start of the video stream. The value you
pass in <code>PTS</code> must be a multiple of the <code>FrameTime</code> fraction
specified in <a href="OpenVideo.html">OpenVideo()</a>.

<p>
</dd>
<dt class="codelist"><code>DTS:</code></dt>
<dd>
This should normally be set to -1. You only need to set this to a time stamp
if the frame's presentation order is different from the encoding order. In that
case you need to set this member to the decoding time stamp. As above, <code>PTS</code>
also needs to be specified as a floating point number in seconds.
</dd></dl>

<p>
This function must be implemented in a thread-safe way.

<p>
</dd>
<dt class="autodoc"><b>Inputs</b></dt><dd>
<dl>
<dt><i>handle</i></dt>
<dd>handle returned by <a href="OpenVideo.html">OpenVideo()</a></dd>
<dt><i>packet</i></dt>
<dd>pointer to a packet allocated by <a href="NextPacket.html">NextPacket()</a></dd>
<dt><i>ctrl</i></dt>
<dd>pointer to a <code>struct DecodeVideoFrameCtrl</code> to be filled out by the function</dl>
</dd>
<dt class="autodoc"><b>Results</b></dt><dd>
<dl>
<dt><i>more</i></dt>
<dd><code>True</code> if function needs more packets to decode a frame, <code>False</code>
if it has successfully decoded a frame</dd></dl>
</dd></dl>
<hr>
<font size=-2><a href="DecodeVideoFrame_.html" target="_top">Show TOC</a></font>
</body>
</html>