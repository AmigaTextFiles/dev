<html>
<!-- generated from hollywood_sdk.meta by MetaDoc 1.13 (c) by Andreas Falkenhahn -->
<head>
<title>Version compatibility</title>
<meta name="author" content="Andreas Falkenhahn">
<meta name="generator" content="MetaDoc 1.13">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
<!--
body {font-family: sans-serif;}
ul.toc {list-style: none; margin-left: 20px; padding-left: 0px;}
dt.autodoc {font-variant: small-caps; font-size: larger; margin-top: 10px; margin-bottom: 10px; padding-left: 0.2em; padding-top: 0.2em; padding-bottom: 0.2em;
	background-color: #bae1ff; border-width: 1px; border-color: #3baaff; border-style: solid;}
dt.codelist {margin-bottom: 0.2em;}
h2.heading {background-color: #bae1ff; font-family: Arial; padding-top: 0.4em; padding-bottom: 0.4em;}
code {background-color: #f2f2f2; padding: 2px 4px; font-weight: bold;}
pre {background-color: #f2f2f2; border: 1px solid #ddd; padding: 0.3em;}
		
-->
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#0000FF">
<h2 class="heading">2.9 Version compatibility</h2>

<p>
It is possible to write plugins which dynamically make use of features of
newer Hollywood versions. However, you need to be very careful when trying
to access structure members or functions that are not available in all
Hollywood versions. For example, let's consider the <code>struct LoadSoundCtrl</code>
structure which looks like this:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>struct LoadSoundCtrl
{
    ULONG Samples;
    int Channels;
    int Bits;
    int Frequency;
    ULONG Flags;
    int SubSong;        // V5.3
    int NumSubSongs;    // V5.3
    STRPTR Adapter;     // V6.0
};
</pre></td></tr></table><p>

You can see that the <code>SubSong</code> and <code>NumSubSongs</code> members are not available
in Hollywood versions before 5.3 and <code>Adapter</code> is not available before
Hollywood 6.0. This means that if your plugin is targetted at Hollywood 5.0
and up, you must only access these fields if you've verified that the user
is running at least Hollywood 5.3 or 6.0 respectively. Otherwise you are
going to access uninitialized memory which can easily lead to a crash.
Hollywood will pass its version and revision numbers to your <a href="InitPlugin.html">InitPlugin()</a>
function. It's recommended to store this information somewhere in your
plugin so that your <a href="OpenStream.html">OpenStream()</a> function can verify
that the user is running Hollywood 5.3 or 6.0 before accessing the new
structure members. Such a check could look like this:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>ctrl-&gt;Frequency = 48000;
ctrl-&gt;Channels = 2;
ctrl-&gt;Bits = 16;
ctrl-&gt;Samples = numsamples;
ctrl-&gt;Flags = HWSNDFLAGS_SIGNEDINT;

// only return NumSubSongs if Hollywood &gt;= 5.3
if(hwver &gt; 5 || (hwver == 5 &amp;&amp; hwrev &gt;= 3)) {
    ctrl-&gt;NumSubSongs = numsubsongs;
}
</pre></td></tr></table><p>

Furthermore, be extra careful when using <code>memset()</code> to zero-out structure
memory. For example, to zero-out <code>struct LoadSoundCtrl</code> you could
do the following inside your <a href="OpenStream.html">OpenStream()</a> implementation:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>memset(ctrl, 0, sizeof(struct LoadSoundCtrl));
</pre></td></tr></table><p>

This, however, will cause memory access faults when the plugin is loaded
by Hollywood versions older than version 6.0 because in that case the
structure pointer passed to your <a href="OpenStream.html">OpenStream()</a> function
will point to a memory block that is smaller than the one used by Hollywood 6.0.
If you just do a <code>memset()</code> without verifying version numbers first, you will
write to unallocated memory which is likely to crash Hollywood. Thus, always
make sure to check version numbers before reading from or writing to structure
memory passed to your plugin by Hollywood.

<p>
If this is too much hassle for you, you can also declare that your
plugin requires at least Hollywood 6.0 in your <a href="InitPlugin.html">InitPlugin()</a>
implementation. If you do that, then you won't have to do all these checks
of course because all Hollywood versions earlier than 6.0 will simply refuse
to load your plugin.

<p>
You also have to be careful when calling Hollywood API functions from
the different library bases. On its man page, every library base API function
is followed by a version number in brackets which indicates the Hollywood version
in which this API was first introduced. Before calling Hollywood API functions you
must make sure that the user is running a Hollywood version that has this API
using one of the methods described above.

<p>
<hr>
<font size=-2><a href="SDKVersions_.html" target="_top">Show TOC</a></font>
</body>
</html>