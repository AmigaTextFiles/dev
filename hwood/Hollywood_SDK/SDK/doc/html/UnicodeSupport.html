<html>
<!-- generated from hollywood_sdk.meta by MetaDoc 1.13 (c) by Andreas Falkenhahn -->
<head>
<title>Unicode support</title>
<meta name="author" content="Andreas Falkenhahn">
<meta name="generator" content="MetaDoc 1.13">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
<!--
body {font-family: sans-serif;}
ul.toc {list-style: none; margin-left: 20px; padding-left: 0px;}
dt.autodoc {font-variant: small-caps; font-size: larger; margin-top: 10px; margin-bottom: 10px; padding-left: 0.2em; padding-top: 0.2em; padding-bottom: 0.2em;
	background-color: #bae1ff; border-width: 1px; border-color: #3baaff; border-style: solid;}
dt.codelist {margin-bottom: 0.2em;}
h2.heading {background-color: #bae1ff; font-family: Arial; padding-top: 0.4em; padding-bottom: 0.4em;}
code {background-color: #f2f2f2; padding: 2px 4px; font-weight: bold;}
pre {background-color: #f2f2f2; border: 1px solid #ddd; padding: 0.3em;}
		
-->
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#0000FF">
<h2 class="heading">2.11 Unicode support</h2>

<p>
Starting with version 7.0, Unicode is now fully supported by Hollywood. By default,
Hollywood always runs in Unicode mode now which means that all strings that your
plugin gets from Hollywood or that your plugin passes to Hollywood must be in the
UTF-8 encoding. This even applies to standard C functions in <a href="CRTBaseOverview.html">CRTBase</a>
like <code>fopen()</code>, <code>stat()</code>, <code>rename()</code>, <code>remove()</code>, etc. Normally, those functions from
the C runtime library aren't UTF-8 compatible on all systems (most notably they
aren't UTF-8 compatible on Windows and AmigaOS), but when calling those standard
C runtime functions through Hollywood's <a href="CRTBaseOverview.html">CRTBase</a> they will
expect UTF-8 strings.

<p>
Note that scripts may explicitly request running in compatibility mode which puts
Hollywood back into ISO 8859-1 mode which was used before Hollywood 7.0. In that
case, all strings that your plugin gets from Hollywood or passes to Hollywood must
be in ISO 8859-1 encoding. Supporting this compatibility mode can greatly increase
the complexity of your plugin which is why you should think about whether your plugin
really needs to support this mode or if you just make Hollywood running in Unicode
mode a requirement for your plugin.

<p>
If you do decide to support compatibility mode in your plugin, the recommended way
to detect the compatibility mode is to install a callback for the <code>HWCB_ENCODINGCHANGE</code>
type in your <a href="InitPlugin.html">InitPlugin()</a> implementation using <a href="hw_RegisterCallback.html">hw_RegisterCallback()</a>.
This callback will then be called if a script explicitly requests running in compatibility
mode.

<p>
Note that if you want your plugin to be compatible with Hollywood versions older than
7.0, you have to support the ISO 8859-1 compatibility mode as well of course, because
before Hollywood 7.0 all strings were in ISO 8859-1 encoding anyway.

<p>
Here's how you could deal with both cases in your <a href="InitPlugin.html">InitPlugin()</a>
implementation. We first check the Hollywood version. If it is older than 7.0,
we run in the ISO 8859-1 encoding. If it is at least 7.0, we install an encoding
change callback to find out whether Hollywood is running in compatibility mode
or UTF-8 mode. Here is the code:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>// we store the encoding used by Hollywood here
static int useencoding;

// this callback will be run if the encoding changes; note that this
// will never be called more than once; the encoding can only change
// during Hollywood's program startup, not on the fly!
static SAVEDS void encodingchange(int encoding, APTR userdata)
{
    useencoding = encoding;
}

HW_EXPORT int InitPlugin(hwPluginBase *self, hwPluginAPI *cl, STRPTR
    path)
{
    // on Hollywood 7 or better, UTF-8 is the default encoding whereas
    // older version use ISO 8859-1 instead
    if(self-&gt;hw_Version &gt; 6) {
        useencoding = HWOS_ENCODING_UTF8;
    } else {
        useencoding = HWOS_ENCODING_ISO8859_1;
    }

    // do initialization here
    ....

    // if we are on Hollywood 7 or better, let us know if the script
    // requests compatibility mode
    if(hwcl-&gt;hwVersion &gt; 6) {
        hwcl-&gt;SysBase-&gt;hw_RegisterCallback(HWCB_ENCODINGCHANGE, (APTR)
            encodingchange, NULL);
    }

    return TRUE;
}
</pre></td></tr></table><p>

To convert between different encodings there is a convenience function
named <a href="hw_ConvertString.html">hw_ConvertString()</a>. See <a href="hw_ConvertString.html">hw_ConvertString</a> for details.

<p>
<hr>
<font size=-2><a href="UnicodeSupport_.html" target="_top">Show TOC</a></font>
</body>
</html>