<html>
<!-- generated from hollywood_sdk.meta by MetaDoc 1.13 (c) by Andreas Falkenhahn -->
<head>
<title>Object identifiers</title>
<meta name="author" content="Andreas Falkenhahn">
<meta name="generator" content="MetaDoc 1.13">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
<!--
body {font-family: sans-serif;}
ul.toc {list-style: none; margin-left: 20px; padding-left: 0px;}
dt.autodoc {font-variant: small-caps; font-size: larger; margin-top: 10px; margin-bottom: 10px; padding-left: 0.2em; padding-top: 0.2em; padding-bottom: 0.2em;
	background-color: #bae1ff; border-width: 1px; border-color: #3baaff; border-style: solid;}
dt.codelist {margin-bottom: 0.2em;}
h2.heading {background-color: #bae1ff; font-family: Arial; padding-top: 0.4em; padding-bottom: 0.4em;}
code {background-color: #f2f2f2; padding: 2px 4px; font-weight: bold;}
pre {background-color: #f2f2f2; border: 1px solid #ddd; padding: 0.3em;}
		
-->
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#0000FF">
<h2 class="heading">2.17 Object identifiers</h2>

<p>
All Hollywood objects like brushes, videos, samples, etc. have an object identifier
that is used to refer to the object when calling a function that deals with this
object type. Hollywood objects can use two different kinds of identifiers: They can
either use a numerical identifier or an automatically chosen identifier that uses the
<code>LUA_TLIGHTUSERDATA</code> object type internally. The user can request an automatically chosen
identifier by passing <code>Nil</code> as the desired identifier when creating the object. In that
case, Hollywood will automatically choose an identifier for the object and return it.
This is usually done by using the raw memory pointer to the newly allocated object as
an identifier because this guarantees its uniqueness.

<p>
Internally, Hollywood object identifiers are managed using the <code>lua_ID</code> structure which
looks like this:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>typedef struct _lua_ID
{
    int num;
    void *ptr;
} lua_ID;
</pre></td></tr></table><p>

Every Hollywood object has such a <code>lua_ID</code> associated with it. The two structure members
are initialized like this:

<p>
<dl>
<dt class="codelist"><code>num:</code></dt>
<dd>
If the object uses a numerical identifier, this identifier is stored in <code>num</code> and the <code>ptr</code>
member is set to <code>NULL</code>. If the <code>ptr</code> member is not <code>NULL</code>, Hollywood will ignore whatever is
in <code>num</code> and the object will automatically use the value in <code>ptr</code> as its identifier.

<p>
</dd>
<dt class="codelist"><code>ptr:</code></dt>
<dd>
If the object has been created using automatic ID selection, this member contains
the object's unique identifier of type <code>LUA_TLIGHTUSERDATA</code>. This is typically set to the
raw memory pointer of the newly allocated object. If <code>ptr</code> is <code>NULL</code>, Hollywood will
automatically use the numerical identifier specified in <code>num</code>.
</dd></dl>

<p>
Whenever you call an API function that expects an object identifier you need to pass
a pointer to a <code>lua_ID</code> to it. For example, let's assume you want to use <a href="hw_LockBrush.html">hw_LockBrush()</a>
to access the raw pixel data of brush 1. In that case, you'd have to call <a href="hw_LockBrush.html">hw_LockBrush()</a>
like this:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>lua_ID id = {1, NULL};
struct hwos_LockBrushStruct lb;
APTR handle;

handle = hw_LockBrush(&amp;id, NULL, &amp;lb);
if(handle) hw_UnLockBrush(handle);
</pre></td></tr></table><p>

If you are writing a plugin that has the <code>HWPLUG_CAPS_LIBRARY</code> capability flag set
and you want to offer a function that accepts either a numerical or an automatically
chosen object identifier, you can use the <a href="luaL_checkid.html">luaL_checkid()</a>
function for that. <a href="luaL_checkid.html">luaL_checkid()</a> will check whether the
value at the specified stack position is a number or a light userdata value and
then it will initialize the <code>lua_ID</code> structure accordingly. The function from above
would look like this then:

<p>
<table cellpadding="0" cellspacing="0"><tr><td>&nbsp;</td><td><pre>static SAVEDS int plug_LockBrush(lua_State *L)
{
    lua_ID id;
    struct hwos_LockBrushStruct lb;
    APTR handle;

    luaL_checkid(L, 1, &amp;id);

    handle = hw_LockBrush(&amp;id, NULL, &amp;lb);
    if(handle) hw_UnLockBrush(handle);
}
</pre></td></tr></table><p>

By using <a href="luaL_checkid.html">luaL_checkid()</a> your function can be made to accept
numerical as well as light user data identifiers without much hassle.

<p>
You can also register your own Hollywood object types by calling the <a href="hw_RegisterUserObject.html">hw_RegisterUserObject()</a>
function. See <a href="hw_RegisterUserObject.html">hw_RegisterUserObject</a> for details.

<p>
<hr>
<font size=-2><a href="LuaID_.html" target="_top">Show TOC</a></font>
</body>
</html>