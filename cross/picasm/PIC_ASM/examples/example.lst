** 12/14-bit PIC assembler v1.0
** example.asm assembled Mon Jan 19 20:10:09 1998

0001            ;
0002            ; example.asm -- a simple LED flasher
0003            ;
0004            
0005            ;
0006            ; example source code for picasm by Timo Rossi
0007            ;
0008            
0009            ;
0010            ; define PIC device type
0011            ;
0012            	device	pic16c84
0013            
0014            ;
0015            ; define config fuses
0016            ;
0017       3FF2 	config	CP=off,WDT=off,PWRT=off,OSC=hs
0018            
0019            ;
0020            ; include PIC register definitions, and some macros
0021            ;
0022            	include "picreg.h"
0023            ;
0024            ; picreg.h
0025            ;
0026            
0027            ; Page 0 
0028  00000000  IND0    equ	00h
0029  00000001  RTCC    equ	01h
0030  00000002  PCL     equ	02h
0031  00000003  STATUS  equ	03h
0032  00000004  FSR     equ	04h     
0033  00000005  PORTA   equ	05h
0034  00000006  PORTB   equ	06h
0035  00000008  EEDATA  equ	08h
0036  00000009  EEADR   equ	09h
0037  0000000A  PCLATH  equ	0ah 
0038  0000000B  INTCON  equ	0bh
0039            
0040            ; Page 1
0041            
0042  00000001  OPTIO   equ	01h
0043  00000005  TRISA   equ	05h
0044  00000006  TRISB   equ	06h
0045  00000008  EECON1  equ	08h
0046  00000009  EECON2  equ	09h
0047            
0048            ;
0049            ; STATUS bits
0050            ;
0051  00000007  IRP     equ	07h
0052  00000006  RP1     equ	06h
0053  00000005  RP0     equ	05h
0054  00000004  TO      equ	04h
0055  00000003  PD      equ	03h
0056  00000002  Z       equ	02h
0057  00000001  DC      equ	01h
0058  00000000  C       equ	00h
0059            
0060            ;
0061            ; INTCON bits
0062            ;
0063  00000007  GIE	equ	7
0064  00000006  EEIE	equ	6
0065  00000005  RTIE	equ	5
0066  00000004  INTE	equ	4
0067  00000003  RBIE	equ	3
0068  00000002  RTIF	equ	2
0069  00000001  INTF	equ	1
0070  00000000  RBIF	equ	0
0071            
0072            ;
0073            ; OPTION bits
0074            ;
0075  00000007  RBPU	equ	7
0076  00000006  INTEDG	equ	6
0077  00000005  RTS	equ	5
0078  00000004  RTE	equ	4
0079  00000003  PSA	equ	3
0080  00000002  PS2	equ	2
0081  00000001  PS1	equ	1
0082  00000000  PS0	equ	0
0083            
0084            ;
0085            ; EECON1 bits
0086            ;
0087  00000004  EEIF	equ	4
0088  00000003  WRERR	equ	3
0089  00000002  WREN	equ	2
0090  00000001  EWR	equ	1
0091  00000000  ERD	equ	0
0092            
0093            ;
0094            ; 'direction' flags
0095            ;
0096  00000000  W	equ	0
0097  00000001  F	equ	1
0098            
0099            
0100            	include "picmac.h"
0101            ;
0102            ; picmac.h
0103            ;
0104            
0105            skipc	macro	; skip if carry
0106            	btfss	STATUS,C
0107            	endm
0108            
0109            skipnc	macro	; skip if not carry
0110            	btfsc	STATUS,C
0111            	endm
0112            
0113            skipz	macro	; skip if zero
0114            	btfss	STATUS,Z
0115            	endm
0116            
0117            skipnz	macro	; skip if not zero
0118            	btfsc	STATUS,Z
0119            	endm
0120            
0121            skpos	macro	; skip if reg >= 0 (reg)
0122            	btfsc	\1,7
0123            	endm
0124            
0125            skneg	macro	; skip if reg < 0 (reg)
0126            	btfss	\1,7
0127            	endm
0128            
0129            setc	macro	; set carry
0130            	bsf	STATUS,C
0131            	endm
0132            
0133            clrc	macro	; clear carry
0134            	bcf	STATUS,C
0135            	endm
0136            
0137            bc	macro	;branch if carry
0138            	skipnc
0139            	goto	\1
0140            	endm
0141            
0142            bnc	macro	;branch if no carry
0143            	skipc
0144            	goto	\1
0145            	endm
0146            
0147            bz	macro	;branch if zero
0148            	skipnz
0149            	goto	\1
0150            	endm
0151            
0152            bnz	macro	;branch if not zero
0153            	skipz
0154            	goto	\1
0155            	endm
0156            
0157            bpos	macro	;branch if reg >= 0 (reg,dest_addr)
0158            	btfss	\1,7
0159            	goto	\2
0160            	endm
0161            
0162            bneg	macro	;branch if reg < 0 (reg,dest_addr)
0163            	btfsc	\1,7
0164            	goto	\2
0165            	endm
0166            
0167            brset	macro	;branch if bit set (reg,bit,dest_addr)
0168            	btfsc	\1,\2
0169            	goto	\3
0170            	endm
0171            
0172            brclr	macro	;branch if bit clear (reg,bit,dest_addr)
0173            	btfss	\1,\2
0174            	goto	\3
0175            	endm
0176            
0177            ;
0178            ; save W/STATUS (interrupt entry)
0179            ;
0180            save_w_stat macro
0181            	movwf	temp_w
0182            	swapf	STATUS,W
0183            	movwf	temp_s
0184            	endm
0185            
0186            restore_w_stat macro
0187            	swapf	temp_s,W
0188            	movwf	STATUS
0189            	swapf	temp_w,F
0190            	swapf	temp_w,W
0191            	endm
0192            
0193            ;
0194            ; bit definitions for two LEDs connected to port A bits 0 and 1
0195            ; bit masks can be computed from bit numbers with the left shift operator.
0196            ;
0197  00000000  A_LED1	equ	0
0198  00000001  A_LED2	equ	1
0199            
0200            ;
0201            ; define some register file variables
0202            ;
0203            
0204  000C      	org	0x0c
0205            
0206  000C      delay_cnt1	ds	1
0207  000D      delay_cnt2	ds	1
0208            
0209            ;
0210            ; code start
0211            ;
0212  0000      	org	0
0213            
0214  0000 30FF 	movlw	0xff
0215  0001 0085 	movwf	PORTA	;initialize port A so that LEDs are off
0216            
0217  0002 1683 	bsf	STATUS,RP0			;register page 1
0218  0003 30FC 	movlw	~((1<<A_LED1)|(1<<A_LED2))	;LEDs as outputs,
0219  0004 0085 	movwf	TRISA				;other PORTA pins as inputs
0220  0005 1283 	bcf	STATUS,RP0			;register page 0
0221            
0222  0006      main_loop
0223  0006 3001 	movlw	1<<A_LED1
0224  0007 0685 	xorwf	PORTA,F		;toggle led1
0225            
0226  0008 0100 	clrw			;maximum delay length (256 counts)
0227  0009?2000 	call	delay
0228            
0229  000A 0100 	clrw			;maximum delay length (256 counts)
0230  000B?2000 	call	delay
0231            
0232  000C 3003 	movlw	(1<<A_LED1)|(1<<A_LED2)
0233  000D 0685 	xorwf	PORTA,F		;toggle both leds
0234            
0235  000E 0100 	clrw			;maximum delay length (256 counts)
0236  000F?2000 	call	delay
0237            
0238  0010 2806 	goto	main_loop
0239            
0240            ;
0241            ; delay subroutine
0242            ; input: delay count in W
0243            ;
0244            ; inner loop duration approx:
0245            ; 5*256+3 = 1283 cycles ->
0246            ; 1.28ms with 4MHz crystal (1MHz instruction time)
0247            ;
0248  0011      delay	movwf	delay_cnt1
0249  0012 018D 	clrf	delay_cnt2
0250  0013      delay_a	nop
0251  0014 0000 	nop
0252  0015 0F8D 	incfsz	delay_cnt2,F
0253  0016 2813 	goto	delay_a
0254  0017 0B8C 	decfsz	delay_cnt1,F
0255  0018 2813 	goto	delay_a
0256  0019 0008 	return
0257            
