;
; $VER: F9DASM 1.80
;
;=============================================================================
; Set defaults

(set #defaultDest "RAM:")
(set #destination "C:")

;----------------------------------------------------------------------------
; /// Checking environment
(set EXEC_ver (getversion "exec.library" (resident)))
(set NEWLIB_ver (getversion "newlib.library" (resident)))
(set AROS_ver (getversion "aros.library" (resident)))

; we use newlib.library to check whether we are running on AmigaOS 4.x
(if (>= NEWLIB_ver (* 4 65536))
    (set #detectedSystem 1)
    (
        ; we are not running on AmigaOS 4.x
        (if (>= AROS_ver (* 40 65536))
            (set #detectedSystem 2)
            (
                ; we are not running on AROS
                ; now check if we are running on MorphOS (exec.library V50+) or on AmigaOS 3.x
                (if (>= EXEC_ver (* 50 65536))
                    (set #detectedSystem 0)
                )
            )
        )
    )
)

(set #detectedSystem
    (askchoice
        (prompt #acknowledgeOS)
        (help @askchoice-help)
        (choices "AmigaOS 3.x"
                 "AmigaOS 4.x"
                 "AROS i386"
        )
        (default #detectedSystem)
    )
)
; finally convert the system number into a string for easier understanding
(set #detectedSystem
    (select #detectedSystem "os3" "os4" "aros-i386")
)

;=============================================================================
; set up the source
(complete 10)

(if (= #detectedSystem "os3") (set #app1 "f9dasm_aos3.exe"))
(if (= #detectedSystem "os3") (set #app2 "hex2bin_aos3.exe"))
(if (= #detectedSystem "os3") (set #app3 "mot2bin_aos3.exe"))

(if (= #detectedSystem "os4") (set #app1 "f9dasm_aos4.exe"))
(if (= #detectedSystem "os4") (set #app2 "hex2bin_aos4.exe"))
(if (= #detectedSystem "os4") (set #app3 "mot2bin_aos4.exe"))

(if (= #detectedSystem "aros-i386") (set #app1 "f9dasm_aros-i386.exe"))
(if (= #detectedSystem "aros-i386") (set #app2 "hex2bin_aros-i386.exe"))
(if (= #detectedSystem "aros-i386") (set #app3 "mot2bin_aros-i386.exe"))

;=============================================================================
; Copy f9dasm
(complete 50)

(copyfiles
    (prompt "Install f9dasm")
	(source #app1)
	(newname "f9dasm")
	(dest (tackon #app1 #destination))
	(help @copyfiles-help)
	(confirm)
)
;=============================================================================
; Copy hex2bin
(complete 60)

(copyfiles
    (prompt "Install hex2bin")
	(source #app2)
	(newname "hex2bin")
	(dest (tackon #app2 #destination))
	(help @copyfiles-help)
	(confirm)
)
;=============================================================================
; Copy mot2bin
(complete 70)

(copyfiles
    (prompt "Install mot2bin")
	(source #app3)
	(newname "mot2bin")
	(dest (tackon #app3 #destination))
	(help @copyfiles-help)
	(confirm)
)
;=============================================================================
; Final message
(complete 100)

(message "Installation complete!")

;----------------------------------------------------------------------------
(exit (QUIET))
