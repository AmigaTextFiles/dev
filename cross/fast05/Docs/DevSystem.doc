                 FAST 68HC05 DEVELOPLEMENT SYSTEM

This is a developement system for the Motorola 6805 series of
microcontrollers. The system consists of several tools or "Commands"
that run from the CLI. The commands work in conjunction with a monitor
and real time debugger, which are programmed into the chip along with
your 6805 code.

COMMANDS

  Asm05   the assembler (see Asm05.doc for full details)
  Pgm8C4  programs empty 68HC805C4 devices
  Pgm7C8  programs 68HC705C8 devices
  Pgm7C9  programs 68HC705C9 devices
  PgmIC   reprograms a 68HC805C4 device in circuit
  Img2s19 converts ROM images to motorola S record files
  rm      Read Memory
  rv      Read Variable      
  rpz     Read Page Zero
  cm      Change Memory
  cv      Change Variable
  go      Run
  stp     Stop

DEBUG CODE
  monitor.asm   basic 6805 reset monitor
  dbug.asm      serial port real time debugger

To use the system you need a 68HC805C4 device. This device has 4K of
EEPROM (or Flash) memory for program storage. This device can be
erased and reprogrammed in the target circuit via its serial port. It
is an ideal device for program developement as it can be reprogramed
any number of times without removing it from the test circuit (unlike
EPROM based devices).

The assembler, monitor and debugger can be used to target any 6805
family device.

The Devlopement cycle goes like this
   1) write some code
   2) join the code to the monitor code using the amigados join command
   3) assemble this with the assembler
   4) program an empty 68HC805C4 using the Pgm8C4 command (empty
      devices require a simple bootstrap circuit).
   5) place the chip in the target circuit
   6) apply power (including VPP) then issue the go command
   7) when it doesn't work hit reset
   8) now use rpz, rm or rv commands to view the insides of the chip
   9) fix the bug
  10) now assemble but use the PgmIC command to download the new code
      in circuit
  11) re issue the go command
  12) if it doesn't work goto 7) again
  13) when you have a fully working device burn an EPROM or OTP
      device using the Pgm7C8 command.
  14) sell the design to a large corporation for a large sum of money
  15) send me 10%


COMMANDS IN DETAIL

 Asm05 <sourcefile> [flag] [flag] [flag]
  Flags:
   Select MCU
      "a" MC68HC805C4 -  4k of flash memory (EEPROM)        -  8K image.
      "b" MC68HC705C8 -  7k of EPROM memory (window or OTP) -  8k image.
      "c" MC68HC705C9 - 15k of EPROM memory (window or OTP) - 16k image.
                default b = 68HC705C8
   Symbol List - s = create text file listing labels
   Debug File  - d = create binary file for debugging
   Variable List - v = create variable list
   Project File - p = use a project source file list

   This is the assembler. It Creates a ROM image file with a .img
   extension or outputs an error listing. See Assembler.doc for full details

 Pgm7C8 <ROM image file name>
   This command progammes the 68HC705C8 EPROM or OTP device via the
   serial port using the Motorola bootstrap circuit.

 Pgm7C9 <ROM image file name>
   This command progammes the 68HC705C9 EPROM or OTP device via the
   serial port using the Motorola bootstrap circuit.

 Pgm8C4 <ROM image file name>
   This command progammes the 68HC805C4 EEPROM device via the
   serial port using the Motorola bootstrap circuit.

 Img2s19 <ROM image file name>
   This utility converts ROM images to motorola S record files. 

 ebf <rom image file name> <start hex addr> <end hex addr> <origin>
   Extract Binary File
   This CLI tool extracts a binary data from a binary file and writes
a smaller file with a .bin extension. The primary use of this tool
is to extract blocks binary of data/code from the rom image files generated
by the Fast Assemlers. However, this tool is not limited to handling rom
image files, you can cut out data from any file up to 64k in size.  
Notes
.all arguments must be given
.when extracting from rom images origin is set to zero
.start, end & origin are limited to word size. ie you can only use this tool
 on binarys up to 64K in size. It was written with 8 bit CPU's in mind.



The following commands work in conjunction with the monitor (see below)
for in circuit emulation program development. They require a 4MHz XTAL
plus VPP on the target circuit with the chips serial port connected to the
Amiga (with RS232 drivers).

 PgmIC <ROM image file name>
   Program In Circuit
   This command programmes the 68HC805 in circuit via the serial port.
   Note that all bytes are verified during programming as part of the
   hanshake protocol.

 VfyIC <ROM image file name>
   Verify In Circuit
   This command will read the ROM from the 68HC805 in circuit via the
   serial port. Then compare each byte to a ROM image file.

 rpz
   Read Page Zero
   This command dumps the contents of page 0 ($0000...$00FF) inside the
   805 to the Amiga screen. And consequently can be redirected to
   a file.

 rm <hex address>
   Read Memory
   This command reads 16 bytes from anywhere in memory and displays them
   on the screen.

 rv <variable name>
   Read Variable
   This command findes the current value of a variable you have declared
   in your code. You must assemble with the "d" flag for this command to
   work.

 go
   Start executing
   This command causes the monitor to jump into the users program. The
   monitor clears to $FF all of the RAM in page 0. Use a hardware reset
   to get back to the monitor.

The following commands work only in conjunction with the real time
debugger & monitor (ie you must join monitor.asm & debug.asm to your code
before assembly).  

 cm <hex address> <hex data byte> [data] [data] ....max 16
   Change Memory
   This command changes the contents of any series of RAM locations inside
   the chip. Note that this command re reads the chip to verify.

 cv <variable name> <new data>
   Change Variable
   This command changes the contents of memory using your variable names.
   ny series of RAM locations.You must assemble with the "d" flag for this
   command to work. When changing individual named bits use either 0 or 1
   to clear or set bits. Note that this command re reads the chip to verify.

 stp
   Stop
   This command stops execution of your program & hands control back
   to the monitor. It saves you the bother of hitting reset. The
   contents of the chip are then frozen so you can examine the damage.
   Then reprogram the chip.

THE MONITOR
  This file (monitor.asm) is a simple reset monitor that you join to the
END of your code insted of the normal ROM vectors (vecC8.asm). When
installed in an EEPROM device like the 68HC805C4 it will allow in
circuit developement. The monitor communicates with the commands PgmIC,
rpz, rm, rv & go.

THE DEBUGGER
  This file (dbug.asm) is a realtime debugger, ie it operates while your
program is running. It takes over the serial port so you must write any
serial port modules just using the reset monitor. Somewhere at the start
of your code you must "JSR dbg_open" ie open the debug port. The
debugger lets you read variables while you program is running (very
handy). Better still you can change the value of any RAM memory
location. The debugger communicates with the commands rpz, rm, rv, cm,
cv, & stp.

GENERAL NOTES

Use script files
  Amigdos scripts are a handy way to automate the developement cycle.
I normally write a simple script to assemble, reprogram the chip and
isue the "go" command. Using this technique you can edit any file with
your text editor, save it then re-run the script. A new version of the
chip will then be running and ready for testing in a few seconds.

Large Projects
Usually large projects are broken up into seperate assembler modules.
The FAST assembler is fast enough that all modules can be re-assembled
every time elimanating the need for a linker and make utilities. Utilise
the assemblers ability to assemble files from a list of source files.
The monitor is placed last in the file list as it supplies the "END"
assembly op code.

ROM Images & S Records
  The FAST series of assemblers generate binary ROM images. These files
can be burned directly into ROM/OTP/EPROM/EEPROM as is. S records are a
Motorola standard file format for representing ROM images in HEX format
(ie they are text files). Some developement systems only support S
records. Use the Img2S19 utility to convert the output of the assembler.
If you use batch files this can be done automatically.

Bootstrap Programming Hardware

  The 68HC705 & 68HC805 devices have self programming algorythms built
into ROM. To access these you need to set up a special RESET circuit and
some switches to one of the chips IO ports. See Page 3-1267 in the
MICROCONTROLLER DATA book. To get the FAST system going you need to
connect the serial port on the chip to the Amiga serial port via RS232
drivers. 705 type devices require 14.5V on VPP. 805 devices require 19.5
via a 10K resistor on VPP.

In Circuit Programming Hardware

  To reprogram devices "in circuit" you must first load the monitor into
a blank 68HC805 device using the above bootstrap method. Once the
monitor resides in memory you can place the device in the target
circuit. The serial port must connected to the Amiga again via RS232
drivers. Also the 19.5V via 10K resistor must be present on the VPP pin
(pin 3). Once powered up you will be able to communicate with the
monitor via the debug commands. When the chip is to be reprogrammed a
small program is loaded into RAM which erases the entire chip then
reprogrames the new code via the serial port. As the entire chip must be
erased each time the monitor must be re-assembled and uploaded along
with the program under test. If this reprogramming process interupted
the monitor can be lost and the device will have to be bootstraped from
scratch.

                      Good Luck

