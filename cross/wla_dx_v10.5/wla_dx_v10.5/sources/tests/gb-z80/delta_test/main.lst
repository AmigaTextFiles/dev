; WLALINK ($VER: wlalink 5.20 (23.6.2023)) listing file
; 2023-06-23 15:57:57

;Line Bank Slot PC   Offset Hex                             Source
                                                            
                                                            ; testing label delta calculation in wla-gb (the assembler, not the linker)
                                                            
                                                            .MEMORYMAP
                                                            DEFAULTSLOT 1
                                                            SLOT 0 $0000 $2000
                                                            SLOT 1 STArT $2000 sIzE $6000
                                                            SLOT 2 START $8000 SIZE $2000
                                                            .ENDME
                                                            
                                                            .ROMBANKMAP
                                                            BANKSTOTAL 2
                                                            BANKSIZE $2000
                                                            BANKS 1
                                                            BANKSIZE $6000
                                                            BANKS 1
                                                            .ENDRO
                                                            
                                                            .EMPTYFILL $ff
                                                                    
                                                            .BANK 0 SLOT 0
                                                            .ORGA 0
                                                            
                                                            ; @BT linked.gb
                                                                    
   26 0000 0000 0000 0000   00                              start:  nop
   27 0000 0000 0001 0001   B7                                      or a,a
   28 0000 0000 0002 0002   F1                                      pop af
   29 0000 0000 0003 0003   31 8A 00                                ld sp,test1
                                                            startend:
                                                            
                                                            .section "Section1" keep
   33 0000 0000 0086 0086   00 01 02 03                             .db 0, 1, 2, 3
                                                            test1:
   35 0000 0000 008A 008A   8A 05 06                                .db test1 & $ff, 5, 6
                                                            test1end:
   37 0000 0000 008D 008D   30 31 3E                                .db "01>"               ; @BT TEST-01 01 START
   38 0000 0000 0090 0090   00 00 00                                .dsb test1end-test1, 0  ; @BT 00 00 00
   39 0000 0000 0093 0093   3C 30 31                                .db "<01"               ; @BT END
                                                            .ends
                                                            
                                                            .section "Section2" keep
   43 0000 0000 0034 0034   63                              test3:  ld h,e
   44 0000 0000 0035 0035   26 64                                   ld h,100
   45 0000 0000 0037 0037   01 34 00                                ld bc,test3
                                                            test3end:
   47 0000 0000 003A 003A   30 32 3E                                .db "02>"               ; @BT TEST-02 02 START
   48 0000 0000 003D 003D   01 01 01 01 01 01 01 01 01              .dsb test1end-test1 + test3end-test3, 1 ; @BT 01 01 01 01 01 01 01 01 01
   49 0000 0000 0046 0046   3C 30 32                                .db "<02"               ; @BT END
                                                            .ends
                                                            
                                                            .section "Section3" keep
                                                            test2:
   54 0000 0000 0076 0076   07 08 09 90 0B 0C 0D 0E                 .db 7, 8, 9, (test1 & $ff) + 6, 11, 12, 13, 14
                                                            test2end:
   56 0000 0000 007E 007E   30 33 3E                                .db "03>"               ; @BT TEST-03 03 START
   57 0000 0000 0081 0081   02 02                                   .dsb test2end-test2 - (test3end-test3), 2 ; @BT 02 02
   58 0000 0000 0083 0083   3C 30 33                                .db "<03"               ; @BT END
                                                            .ends
                                                            
                                                            .section "Section4" keep
   62 0000 0000 00C3 00C3   30 34 3E                                .db "04>"               ; @BT TEST-04 04 START
   63 0000 0000 00C6 00C6   06 06                                   .db test4end-test4, startend-start ; @BT 06 06
   64 0000 0000 00C8 00C8   3C 30 34                                .db "<04"               ; @BT END
                                                            .ends
                                                                    
                                                            .section "Section5" keep
   68 0000 0000 00F5 00F5   8A 00 76 00 34 00               test4:  .dw test1, test2, test3
                                                            test4end:
                                                            .ends
                                                                    
   72 0000 0000 0049 0049   30 35 3E                                .db "05>"               ; @BT TEST-05 05 START
   73 0000 0000 004C 004C   03 03 03 03 03 03                       .dsb startend-start, 3  ; @BT 03 03 03 03 03 03
   74 0000 0000 0052 0052   3C 30 35                                .db "<05"               ; @BT END
                                                            
                                                            TESTSTRINGSTART:
   77 0000 0000 0055 0055   74 65 73 74                         .DB "test"
                                                            TESTSTRINGEND:
                                                            .REPEAT 16+TESTSTRINGSTART-TESTSTRINGEND
   80 0000 0000 0059 0059   20                                  .DB " "
   80 0000 0000 005A 005A   20 
   80 0000 0000 005B 005B   20 
   80 0000 0000 005C 005C   20 
   80 0000 0000 005D 005D   20 
   80 0000 0000 005E 005E   20 
   80 0000 0000 005F 005F   20 
   80 0000 0000 0060 0060   20 
   80 0000 0000 0061 0061   20 
   80 0000 0000 0062 0062   20 
   80 0000 0000 0063 0063   20 
   80 0000 0000 0064 0064   20 
                                                            .ENDR
                                                            
                                                            
                                                                    .section "TEST-06" free
                                                            TestCode:
   86 0000 0000 001D 001D   00                                      nop
   87 0000 0000 001E 001E   00                              -       nop
   88 0000 0000 001F 001F   00                              __      nop
   89 0000 0000 0020 0020   00                              +       nop
   90 0000 0000 0021 0021   00                                      nop
   91 0000 0000 0022 0022   00                                      nop
                                                            @InstructionUnderTest:
   93 0000 0000 0023 0023   00 00 00 00                             .dsb 4, 0
   94 0000 0000 0027 0027   00                                      nop
   95 0000 0000 0028 0028   00                              -       nop
   96 0000 0000 0029 0029   00                              +       nop
                                                            
                                                                    .define OffsetOfInstructionUnderTest1 @InstructionUnderTest - TestCode
                                                                    .export OffsetOfInstructionUnderTest1
                                                                    .define OffsetOfInstructionUnderTest2 TestCode@InstructionUnderTest - TestCode
                                                                    .export OffsetOfInstructionUnderTest2
                                                            
  103 0000 0000 002A 002A   00                              End:    nop
                                                                    
  105 0000 0000 002B 002B   30 36 3E                                .db "06>"                         ; @BT TEST-06 06 START
  106 0000 0000 002E 002E   06                                      .db OffsetOfInstructionUnderTest1 ; @BT 06
  107 0000 0000 002F 002F   0D                                      .db End - TestCode                ; @BT 0D
  108 0000 0000 0030 0030   0E                                      .db End - TestCode + 1            ; @BT 0E
  109 0000 0000 0031 0031   3C 30 36                                .db "<06"                         ; @BT END
                                                                    .ends
                                                            
                                                                    .section "TEST-07" free
  113 0000 0000 00B1 00B1   30 37 3E                                .db "07>"                         ; @BT TEST-07 07 START
  114 0000 0000 00B4 00B4   06                                      .db OffsetOfInstructionUnderTest2 ; @BT 06
  115 0000 0000 00B5 00B5   0D                                      .db End - TestCode                ; @BT 0D
  116 0000 0000 00B6 00B6   0E                                      .db End - TestCode + 1            ; @BT 0E
  117 0000 0000 00B7 00B7   3C 30 37                                .db "<07"                         ; @BT END
                                                                    .ends
                                                                    
                                                                    .section "TEST-08"
                                                            MoreTestCode:
  122 0000 0000 0065 0065   00                                      nop
  123 0000 0000 0066 0066   00                                      nop
                                                            @InstructionUnderTest:
  125 0000 0000 0067 0067   00 00 00 00                             .dsb 4, 0
  126 0000 0000 006B 006B   00                                      nop
                                                            
                                                                    .define OffsetOfInstructionUnderTest3 @InstructionUnderTest - MoreTestCode
                                                                    .export OffsetOfInstructionUnderTest3
                                                                    .define OffsetOfInstructionUnderTest4 MoreTestCode@InstructionUnderTest - MoreTestCode
                                                                    .export OffsetOfInstructionUnderTest4
                                                                    
  133 0000 0000 006C 006C   00                              MoreEnd:nop
                                                            
  135 0000 0000 006D 006D   30 38 3E                                .db "08>"                          ; @BT TEST-08 08 START
  136 0000 0000 0070 0070   02                                      .db OffsetOfInstructionUnderTest3  ; @BT 02
  137 0000 0000 0071 0071   07                                      .db MoreEnd - MoreTestCode         ; @BT 07
  138 0000 0000 0072 0072   08                                      .db MoreEnd - MoreTestCode + 1     ; @BT 08
  139 0000 0000 0073 0073   3C 30 38                                .db "<08"                          ; @BT END
                                                                    .ends
                                                                    
                                                                    .section "TEST-09" free
  143 0000 0000 00BA 00BA   30 39 3E                                .db "09>"                         ; @BT TEST-09 09 START
  144 0000 0000 00BD 00BD   02                                      .db OffsetOfInstructionUnderTest4 ; @BT 02
  145 0000 0000 00BE 00BE   07                                      .db MoreEnd - MoreTestCode        ; @BT 07
  146 0000 0000 00BF 00BF   08                                      .db MoreEnd - MoreTestCode + 1    ; @BT 08
  147 0000 0000 00C0 00C0   3C 30 39                                .db "<09"                         ; @BT END
                                                                    .ends
                                                            
                                                                    .section "TEST-10"
                                                            YUMTestCode:
  152 0000 0000 0096 0096   00                                      nop
  153 0000 0000 0097 0097   00                                      nop
  154 0000 0000 0098 0098   00                                      nop
                                                            @InstructionUnderTest:
  156 0000 0000 0099 0099   00 00                                   .dsb 2, 0
  157 0000 0000 009B 009B   00                                      nop
  158 0000 0000 009C 009C   31 30 3E                                .db "10>"                         ; @BT TEST-10 10 START
  159 0000 0000 009F 009F   03                                      .db @InstructionUnderTest - YUMTestCode ; @BT 03
  160 0000 0000 00A0 00A0   03                                      .db YUMTestCode@InstructionUnderTest - YUMTestCode ; @BT 03
  161 0000 0000 00A1 00A1   3C 31 30                                .db "<10"                         ; @BT END
  162 0000 0000 00A4 00A4   00                              YUMEnd: nop
                                                                    .ends
                                                                    
                                                                    .section "TEST-11" free keep
  166 0000 0000 0006 0006   31 31 3E                                .db "11>"               ; @BT TEST-11 11 START
  167 0000 0000 0009 0009   00                                      nop                     ; @BT 00
  168 0000 0000 000A 000A   00                              -       nop                     ; @BT 00
  169 0000 0000 000B 000B   18 00                           __      jr +                    ; @BT 18 00
  170 0000 0000 000D 000D   18 FC                           +       jr _b                   ; @BT 18 FC
  171 0000 0000 000F 000F   18 02                           --      jr _f                   ; @BT 18 02
  172 0000 0000 0011 0011   18 03                                   jr  +                   ; @BT 18 03
  173 0000 0000 0013 0013   00                              __      nop                     ; @BT 00
  174 0000 0000 0014 0014   18 FE                           -       jr -                    ; @BT 18 FE
  175 0000 0000 0016 0016   18 F7                           +       jr --                   ; @BT 18 F7
  176 0000 0000 0018 0018   18 FA                                   jr  -                   ; @BT 18 FA
  177 0000 0000 001A 001A   3C 31 31                                .db "<11"               ; @BT END
                                                                    .ends
                                                            
                                                                    .section "TEST-12" free keep
  181 0000 0000 00A5 00A5   31 32 3E                        +:      .db "12>"               ; @BT TEST-12 12 START
  182 0000 0000 00A8 00A8   00                              -:      .db - 1 - 2 + 3         ; @BT 00
  183 0000 0000 00A9 00A9   00                              --:     .db -1-2+3              ; @BT 00
  184 0000 0000 00AA 00AA   FF                              ---:    .db 1    +   3   - 5    ; @BT FF
  185 0000 0000 00AB 00AB   01                              ---     .db   2  -  1   +  1-1  ; @BT 01
  186 0000 0000 00AC 00AC   FF FF                           --      .dw start     - 2  +  1 ; @BT FF FF
  187 0000 0000 00AE 00AE   3C 31 32                        -       .db "<12"               ; @BT END
                                                                    .ends
                                                                    
                                                                    .section "TEST-13" free keep
  191 0000 0000 00CB 00CB   31 33 3E                                .db "13>"               ; @BT TEST-13 13 START
  192 0000 0000 00CE 00CE   02 00                                   .dw test13c-test13a     ; @BT 02 00
                                                            test13a
  194 0000 0000 00D0 00D0   00 00                           test13b .dw test13b-test13a     ; @BT 00 00
                                                                    .ends
                                                                    
                                                                    .section "TEST-13 APPEND 1" free appendto "TEST-13"
  198 0000 0000 00D2 00D2   02 00                           test13c .dw test13c - test13b   ; @BT 02 00
  199 0000 0000 00D4 00D4   00 00                                   .dw test13b-test13a     ; @BT 00 00
                                                            @childA
                                                                    .ends
                                                            
                                                                    .section "TEST-13 APPEND 2" free appendto "TEST-13 APPEND 1"
  204 0000 0000 00D6 00D6   04 00                           test13d .dw test13d - test13c   ; @BT 04 00
  205 0000 0000 00D8 00D8   00 00                                   .dw test13b-test13a     ; @BT 00 00
                                                            @child1:
                                                            @child2:
  208 0000 0000 00DA 00DA   00 00                                   .dw test13d@child2 - @child1 ; @BT 00 00
                                                            test13e:
                                                            @child1:
                                                            @child2:
  212 0000 0000 00DC 00DC   00 00                                   .dw test13e@child{1+1} - test13e@child1 ; @BT 00 00
  213 0000 0000 00DE 00DE   06 00                                   .dw @child{2-1+1} - test13c@childA      ; @BT 06 00
  214 0000 0000 00E0 00E0   01 00                                   .dw test13f@childA - test13f            ; @BT 01 00
  215 0000 0000 00E2 00E2   03 03 03 03 03 03                       .dsb startend-start, 3  ; @BT 03 03 03 03 03 03
  216 0000 0000 00E8 00E8   00 00 00                                .dsb test1end-test1, 0  ; @BT 00 00 00
  217 0000 0000 00EB 00EB   01                              test13f:.db 1                   ; @BT 01
                                                            @childA
  219 0000 0000 00EC 00EC   02 00                                   .dw @childA - test13f + 1 ; @BT 02 00
  220 0000 0000 00EE 00EE   02 00                                   .dw 1 + @childA - test13f ; @BT 02 00
  221 0000 0000 00F0 00F0   02 00                                   .dw @childA + 1 - test13f ; @BT 02 00
  222 0000 0000 00F2 00F2   3C 31 33                                .db "<13"               ; @BT END
                                                                    .ends
                                                                    
                                                                    // testing that ROM size indicator is set to emptyfill
                                                                    .org $0148-3
  227 0000 0000 0145 0145   31 34 3E                                .db "14>"               ; @BT TEST-14 14 START
                                                                    //.db $ff               ; @BT FF
                                                                    .org $0148+1
  230 0000 0000 0149 0149   3C 31 34                                .db "<14"               ; @BT END
                                                            
  232 0000 0000 014C 014C   31 35 3E                                .db "15>"               ; @BT TEST-15 15 START
                                                                    .define VALUE_100 = 100
                                                                    .define VALUE_2 = (test13f@childA - test13f)*2 + (VALUE_100 - VALUE_100) + 2 - 1 - 1
                                                                    .rept (test13f@childA - test13f)*2 + (test13d@child2 - test13d@child1) - (test13b - test13a)*(test13c@childA - test13c)
  236 0000 0000 014F 014F   03                                      .db 3                   ; @BT 03 03
  236 0000 0000 0150 0150   03 
                                                                    .endr
                                                                    .rept (test13f@childA - test13f)*2 + (VALUE_100 - VALUE_100) + (VALUE_2 - VALUE_2 - VALUE_2) + 2 - (test13b - test13a)*(test13c@childA - test13c)
  239 0000 0000 0151 0151   04                                      .db 4                   ; @BT 04 04
  239 0000 0000 0152 0152   04 
                                                                    .endr
                                                                    .rept VALUE_2 + (test13f@childA - test13f) - (VALUE_2 - VALUE_2)
  242 0000 0000 0153 0153   05                                      .db 5                   ; @BT 05 05 05
  242 0000 0000 0154 0154   05 
  242 0000 0000 0155 0155   05 
                                                                    .endr
  244 0000 0000 0156 0156   3C 31 35                                .db "<15"               ; @BT END
                                                                    
