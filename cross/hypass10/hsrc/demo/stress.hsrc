@DATABASE
@NODE main
*$VER: HypAss macro stress test V1.0 (19.7.96)
*©1998 RST Ralf Steines Trier, ALL RIGHTS RESERVED
* macros within includes and vice versa



    @{" Define macro in macro   " LINK MacroDef_in_Macro}

    @{" Define macro in include " LINK MacroDef_in_Include}

    @{" Expand macro in include " LINK MacroExp_in_Include}

    @{" Include file in macro   " LINK Include_in_Macro}

    @{" Recursion  desaster     " LINK Recursion_Desaster}



@ENDNODE
@NODE MacroDef_in_Macro
  * macro definitions within macros

    * this is the macro definition

    MACRO mothermacro
      MACRO childmacro\1
        FDB $FFFF
        FDB $0000
      ENDM
    ENDM

    * and here we expand (to define)

    mothermacro 1
    mothermacro 2
    mothermacro 3

    * and here we expand (to expand)

    childmacro1
    childmacro2
    childmacro3

@ENDNODE
@NODE MacroDef_in_Include
  * macro definitions within includes

    * this contains the macro definition

    .include "hsrc:demo/stress_macro.inc"

    * and here we expand

    stressmacro1
    stressmacro2
    stressmacro3


@ENDNODE
@NODE MacroExp_in_Include
  * macro expansion within includes

    * we have already defined our macros,
    * now we move into an include to expand

    .include "hsrc:demo/stress_expand.inc"

@ENDNODE
@NODE Include_In_Macro
  * including files in macros

    * we define a new macro containing an include

    MACRO stressmacro4
      FDB $FFFF
      .include "hsrc:demo/stress_data.inc"
      FDB $0000
    ENDM

    * now we expand 4 times

    stressmacro4
    ;stressmacro4
    ;stressmacro4
    ;stressmacro4

@ENDNODE
@NODE Recursion_Desaster
  * macro and include recursion within each others

  * This should demonstrate, that there are no limits of include and macro
  * nesting within each others. The macro 'nest' loads an include, which
  * just contains the macro call 'nest', which will load the include again
  * and so on. I tested this program with 5000 levels deep nested includes
  * within 5000 levels deep nested macros, HypAss needed less than 3 minutes,
  * about 4MB of macro/include-stack and counted 540000 lines of source.
  * (A4000 EC030/25)

    * we reset our counter

    cnt :=0

    * here we define the macro

    macro nest
      cnt +=1
      mexit cnt>16
      include "hsrc:demo/stress.inc"
      cnt -=1
    endm

    * and let's go in the recursion!

    nest

    * mexit has terminated 1 macro, so
    * we recursively finished all the
    * other macro and include nesting levels.


@ENDNODE
