; WLALINK ($VER: wlalink 5.17 (24.6.2022)) listing file
; 2022-06-24 14:12:31

;Line Bank Slot PC   Offset Hex                             Source
                                                            
                                                                    .MEMORYMAP
                                                                       DEFAULTSLOT 0
                                                                       SLOTSIZE $2000
                                                                       SLOT 0 $8000
                                                                    .ENDME
                                                            
                                                                    .ROMBANKMAP
                                                                       BANKSTOTAL 2
                                                                       BANKSIZE $2000
                                                                       BANKS 2
                                                                    .ENDRO
                                                            
                                                                    .BANK 00  SLOT 0
                                                                    .ORG    0
                                                            
                                                            .define none    $00
                                                            
                                                            ; @BT linked.rom
                                                            
   21 0000 0000 8000 0000   30 32 3E                        .db "02>"      ; @BT TEST-02 02 START
                                                            .if 0 == 1
                                                            	jp pohoih, pojp, egr eg,erg, ege,rg,egr,egr,eg,erg,th,rt,ru,uy,eur,j,yjet,ye,ye,iye,ie,eu,e,i
                                                            	.db 1,2,3,4,5,6,9,23,43,5,5,3,3,4,45,6,4,3,2, none, none, none
                                                               .DB   none, none, none, none, none, none, none, none, none, none, none, none, none, none
                                                            .else
   27 0000 0000 8003 0003   07                                 .DB   7     ; @BT 07
                                                            .endif
   29 0000 0000 8004 0004   3C 30 32                        .db "<02"      ; @BT END
                                                            
                                                            .STRUCT water
                                                            name   ds 8
                                                            age    db
                                                            weight dw
                                                            .ENDST
                                                            
                                                            .struct another
                                                            name   ds 16
                                                            age    db
                                                            height dw
                                                            .endst
                                                            	
   43 0000 0000 8007 0007   30 31 3E                        .db "01>"                                                      ; @BT TEST-01 01 START
   43 0000 0000 800A 000A   74 69 6E 67 6C 65 00 00 
   43 0000 0000 8012 0012   28 
   44 0000 0000 8013 0013   78 00                           .DSTRUCT waterdrop1 INSTANCEOF water DATA "tingle", 40, 120    ; @BT 74 69 6E 67 6C 65 00 00 28 78 00
   44 0000 0000 8015 0015   74 69 6E 67 6C 65 00 00 
   44 0000 0000 801D 001D   28 
   45 0000 0000 801E 001E   78 00                           .DSTRUCT waterdrop2, water, "tingle", 40, 120                  ; @BT 74 69 6E 67 6C 65 00 00 28 78 00
   45 0000 0000 8020 0020   73 6F 6D 65 64 72 6F 70 
   45 0000 0000 8028 0028   00 
   46 0000 0000 8029 0029   00 00                           .DSTRUCT waterdrop3, water, "somedrop"                         ; @BT 73 6F 6D 65 64 72 6F 70 00 00 00 
   47 0000 0000 802B 002B   FF FF                           .db $ff, $ff                                                   ; @BT FF FF
   48 0000 0000 802D 002D   3C 30 31                        .db "<01"                                                      ; @BT END
                                                            
   50 0000 0000 8030 0030   30 33 3E                                .db "03>"                   ; @BT TEST-03 03 START
   51 0000 0000 8033 0033   54 45 53 54 0D 0A 00 09                 .db "TEST\r\n\0\t"          ; @BT 54 45 53 54 0D 0A 00 09
   52 0000 0000 803B 003B   3C 30 33                                .db "<03"                   ; @BT END
                                                            
                                                                    .define STRING_A = "HI \"TIM\""
                                                                    
   56 0000 0000 803E 003E   30 34 3E                                .db "04>"                   ; @BT TEST-04 04 START
   57 0000 0000 8041 0041   48 49 20 22 54 49 4D 22                 .db STRING_A                ; @BT 48 49 20 22 54 49 4D 22
   58 0000 0000 8049 0049   3C 30 34                                .db "<04"                   ; @BT END
                                                            
   60 0000 0000 804C 004C   30 35 3E                                .db "05>"                   ; @BT TEST-05 05 START
   61 0000 0000 804F 004F   01 02 03 04 48 49 00                    .db "\x01\x02\x03\x04HI\0"  ; @BT 01 02 03 04 48 49 00
   62 0000 0000 8056 0056   3C 30 35                                .db "<05"                   ; @BT END
                                                            
   64 0000 0000 8059 0059   30 36 3E                                .db "06>"                   ; @BT TEST-06 06 START
   65 0000 0000 805C 005C   12                                      .db "\x12"                  ; @BT 12
   66 0000 0000 805D 005D   3C 30 36                                .db "<06"                   ; @BT END
                                                            
                                                                    .macro db_string
                                                            label_\1:
                                                                    .db "\x01B\1\0\2"
                                                                    .endm
                                                                    
   73 0000 0000 8060 0060   30 37 3E                                .db "07>"                   ; @BT TEST-07 07 START
   70 0000 0000 8063 0063   01 42 48 49 00 31 
                                                                    db_string "HI", 1           ; @BT 01 42 48 49 00 31
   75 0000 0000 8069 0069   3C 30 37                                .db "<07"                   ; @BT END
                                                                    
                                                            .MACRO make_rst
                                                              .ORG (?1 * $0003 + $203)
                                                              .SECTION "BOOT_RESET_\1_?1" SIZE $0003 FORCE KEEP
                                                            boot_rst_\1_?1:
   81 0000 0000 8218 0218   49 5F 37                              .db "\1_?1"
   81 0000 0000 8215 0215   49 5F 36                          .ENDS
   81 0000 0000 8212 0212   49 5F 35                        .ENDM
   81 0000 0000 820F 020F   49 5F 34                        
   81 0000 0000 820C 020C   49 5F 33                                .org $200
   86 0000 0000 8200 0200   30 38 3E                                .db "08>"             ; @BT TEST-08 08 START
   81 0000 0000 8209 0209   49 5F 32 
   81 0000 0000 8206 0206   49 5F 31                        
   81 0000 0000 8203 0203   49 5F 30                                .REPEAT 8 INDEX I
                                                                    make_rst &I           ; @BT 49 5F 30 49 5F 31 49 5F 32 49 5F 33 49 5F 34 49 5F 35 49 5F 36 49 5F 37
                                                                    .ENDR
                                                            
   92 0000 0000 821B 021B   3C 30 38                                .db "<08"             ; @BT END
                                                                    
                                                            
                                                                    .macro string_macro
                                                                    .db "\\1\?1"
                                                                    .endm
                                                                    
   99 0000 0000 821E 021E   30 39 3E                                .db "09>"             ; @BT TEST-09 09 START
   96 0000 0000 8221 0221   5C 31 3F 31 
                                                                    string_macro &I       ; @BT 5C 31 3F 31
  101 0000 0000 8225 0225   3C 30 39                                .db "<09"             ; @BT END
                                                            
  103 0000 0000 8228 0228   31 30 3E                                .db "10>"             ; @BT TEST-10 10 START
                                                                    .fopen "data.bin" fp
                                                                    .fsize fp t
                                                                    .repeat t
  108 0000 0000 822B 022B   41                                      .fread fp d
  108 0000 0000 822C 022C   42 
  108 0000 0000 822D 022D   43 
                                                                    .db d                 ; @BT 41 42 43
                                                                    .endr
                                                                    .undefine t, d
  111 0000 0000 822E 022E   3C 31 30                                .db "<10"             ; @BT END
                                                            
                                                                    .ftell fp fp_position
                                                                    .if fp_position != 3
                                                                    .fail "fp_position should be 3!"
                                                                    .endif
                                                                    .fclose fp
                                                            
                                                                    .macro read_data
                                                                    .fread \1 d
                                                                    .db d
                                                                    .fread \1 d
                                                                    .db d
                                                                    .fread \1 d
                                                                    .db d
                                                                    .fseek \1 1 start
                                                                    .fread \1 d
                                                                    .db d
                                                                    .ftell \1 fp_position
                                                                    .if fp_position != 2
                                                                    .fail "fp_position should be 2!"
                                                                    .endif
                                                                    .fseek \1 -3 end
                                                                    .fread \1 d
                                                                    .db d
                                                                    .fseek \1 1 current
                                                                    .fread \1 d
                                                                    .db d
                                                                    .ftell \1 fp_position
                                                                    .if fp_position != 3
                                                                    .fail "fp_position should be 3!"
                                                                    .endif
                                                                    .endm
                                                                    
  145 0000 0000 8231 0231   31 31 3E                                .db "11>"             ; @BT TEST-11 11 START
  121 0000 0000 8234 0234   41                                      .fopen "data.bin" fp
  123 0000 0000 8235 0235   42 
  125 0000 0000 8236 0236   43 
  128 0000 0000 8237 0237   42 
  135 0000 0000 8238 0238   41 
  138 0000 0000 8239 0239   43 
                                                                    read_data fp          ; @BT 41 42 43 42 41 43
                                                                    .fclose fp
                                                                    .undefine d
  150 0000 0000 823A 023A   3C 31 31                                .db "<11"             ; @BT END
                                                            
  152 0000 0000 823D 023D   31 32 3E                                .db "12>"             ; @BT TEST-12 12 START
                                                                    ; once we had a bug in WLA that '}' didn't work with .db
  154 0000 0000 8240 0240   7B 7D 7B 7D                             .db "{}", "{", "}"    ; @BT 7B 7D 7B 7D
  155 0000 0000 8244 0244   05                                      .db "hello".length    ; @BT 05
  156 0000 0000 8245 0245   3C 31 32                                .db "<12"             ; @BT END
                                                            
  158 0000 0000 8248 0248   31 33 3E                        --      .db "13>"               ; @BT TEST-13 13 START
  159 0000 0000 824B 024B   D0 FB                           -       bne --                  ; @BT D0 FB
  160 0000 0000 824D 024D   D0 FC                                   bne -                   ; @BT D0 FC
  161 0000 0000 824F 024F   D0 03                                   bne ++                  ; @BT D0 03
  162 0000 0000 8251 0251   D0 00                                   bne +                   ; @BT D0 00
  163 0000 0000 8253 0253   EA                              +       nop                     ; @BT EA
  164 0000 0000 8254 0254   3C 31 33                        ++      .db "<13"               ; @BT END
                                                                    
                                                                    // once more to see that references to local labels stay local...
                                                                    .section "SAME-BUT-SECTION-1" keep
  168 0000 0000 806C 006C   31 34 3E                        --      .db "14>"               ; @BT TEST-14 14 START
  169 0000 0000 806F 006F   D0 FB                           -       bne --                  ; @BT D0 FB
  170 0000 0000 8071 0071   D0 FC                                   bne -                   ; @BT D0 FC
  171 0000 0000 8073 0073   D0 03                                   bne ++                  ; @BT D0 03
  172 0000 0000 8075 0075   D0 00                                   bne +                   ; @BT D0 00
  173 0000 0000 8077 0077   EA                              +       nop                     ; @BT EA
  174 0000 0000 8078 0078   3C 31 34                        ++      .db "<14"               ; @BT END
                                                                    .ends
                                                            
                                                                    // once more to see that references to local labels stay local...
                                                                    .section "SAME-BUT-SECTION-2" keep
  179 0000 0000 807B 007B   31 35 3E                        --      .db "15>"               ; @BT TEST-15 15 START
  180 0000 0000 807E 007E   D0 FB                           -       bne --                  ; @BT D0 FB
  181 0000 0000 8080 0080   D0 FC                                   bne -                   ; @BT D0 FC
  182 0000 0000 8082 0082   D0 03                                   bne ++                  ; @BT D0 03
  183 0000 0000 8084 0084   D0 00                                   bne +                   ; @BT D0 00
  184 0000 0000 8086 0086   EA                              +       nop                     ; @BT EA
  185 0000 0000 8087 0087   3C 31 35                        ++      .db "<15"               ; @BT END
                                                                    .ends
                                                            
                                                                    // once more to see that references to local labels stay local...
  189 0000 0000 8275 0275   31 36 3E                        --      .db "16>"               ; @BT TEST-16 16 START
  190 0000 0000 8278 0278   D0 FB                           -       bne --                  ; @BT D0 FB
  191 0000 0000 827A 027A   D0 FC                                   bne -                   ; @BT D0 FC
  192 0000 0000 827C 027C   D0 03                                   bne ++                  ; @BT D0 03
  193 0000 0000 827E 027E   D0 00                                   bne +                   ; @BT D0 00
  194 0000 0000 8280 0280   EA                              +       nop                     ; @BT EA
  195 0000 0000 8281 0281   3C 31 36                        ++      .db "<16"               ; @BT END
                                                            
                                                                    // once more to see that references to local labels stay local...
  198 0000 0000 8284 0284   31 37 3E                        --      .db "17>"               ; @BT TEST-17 17 START
  199 0000 0000 8287 0287   D0 FB                           -       bne --                  ; @BT D0 FB
  200 0000 0000 8289 0289   D0 FC                                   bne -                   ; @BT D0 FC
  201 0000 0000 828B 028B   D0 03                                   bne ++                  ; @BT D0 03
  202 0000 0000 828D 028D   D0 00                                   bne +                   ; @BT D0 00
  203 0000 0000 828F 028F   EA                              +       nop                     ; @BT EA
  204 0000 0000 8290 0290   3C 31 37                        ++      .db "<17"               ; @BT END
                                                            
  206 0000 0000 8293 0293   31 38 3E                                .DB "18>"               ; @BT TEST-18 18 START
  207 0000 0000 8296 0296   07                                      .DB %00000000000000000000000000000111  ; @BT 07
  208 0000 0000 8297 0297   05                                      .DB 0b00000000000000000000000000000101 ; @BT 05
  209 0000 0000 8298 0298   03                                      .DB %00000000000000000000000000000001 + %00000000000000000000000000000010   ; @BT 03
  210 0000 0000 8299 0299   02                                      .DB 0b00000000000000000000000000000011 - 0b00000000000000000000000000000001 ; @BT 02
  211 0000 0000 829A 029A   3C 31 38                                .DB "<18"               ; @BT END
                                                                    
                                                                    .bank 1 slot 0
                                                                    .org 0
                                                            
                                                            this_is_the_longest_label_for_a_while:
  217 0001 0000 8000 0000   31 39 3E                                .db "19>"               ; @BT TEST-19 19 START
                                                            this_is_a_long_label:
  219 0001 0000 8003 0003   03 80                                   .dw __label__           ; @BT 03 80
  220 0001 0000 8005 0005   03 A0                                   .dw __label__ + $2000   ; @BT 03 A0
  221 0001 0000 8007 0007   3C 31 39                                .db "<19"               ; @BT END
