; WLALINK ($VER: wlalink 5.17 (24.6.2022)) listing file
; 2022-06-24 14:19:21

;Line Bank Slot PC   Offset Hex                             Source
                                                            
                                                            ;»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»
                                                            ; a small example showing the wla huc6280 syntax
                                                            ; written by ville helin <ville.helin@iki.fi> in 2015
                                                            ;»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»
                                                            
                                                            .INCLUDE "defines.i"
                                                            
                                                            ;»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»
                                                            ; main
                                                            ;»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»»
                                                            
                                                            .ramsection "ram man 1" bank 1 slot 1 align 8
                                                            kalkaros_1 db	
                                                            .ends
                                                            
                                                            .bank 0 slot 0
                                                            	
                                                            .section "rom man 1"
   20 0000 0000 006E 006E   01                              start	.db 1
                                                            .ends
                                                            
                                                            .define kalkaros_2 kalkaros_1
                                                            .export kalkaros_2
                                                            
                                                            .macro derp
                                                            	lda \1.w
                                                            .endm
                                                            
                                                            .section "rom man 2"
   31 0000 0000 0059 0059   66 66                           	.dw $6666
   32 0000 0000 005B 005B   00 20                           end:	.dw kalkaros_2
   33 0000 0000 005D 005D   77 77                           	.dw $7777
   34 0000 0000 005F 005F   AD 00 20                        	lda kalkaros_2.w
   35 0000 0000 0062 0062   88 88                           	.dw $8888
   27 0000 0000 0064 0064   AD 00 01 
                                                            	derp $100
                                                            .ends
                                                            
                                                            
                                                            .ramsection "vars 1" bank 0 slot 1
                                                            derps	dw
                                                            .ends
                                                            
                                                            .macro sub1          	; subtract byte-sized value
                                                            	sec
                                                            	sbc \1.w
                                                            .endm
                                                            
                                                            .bank 0 slot 0
                                                            .org 0
   45 0000 0000 0067 0067   38                              .section "code 1"
   46 0000 0000 0068 0068   ED 00 20 
                                                            	sub1 derps
                                                            .ends
                                                            
                                                            
                                                            .ramsection "vars 2" bank 3 slot 1
                                                            tmp	db
                                                            derp dw
                                                            .ends
                                                            
                                                            .bank 1 slot 0
                                                            .org 0
                                                            .section "code 2"
   64 0001 0000 0000 0000   AD 01 20                        	lda derp.w
                                                            .ends
                                                            
                                                            
                                                            .macro sub2          	; subtract byte-sized value
                                                            	sec
                                                            	sbc \1
                                                            .endm
                                                            
                                                            .bank 0 slot 0
                                                            .org 0
                                                            	.section "code 3"
                                                            bl:
                                                            si:
                                                            di:
                                                            cl:
   69 0000 0000 006B 006B   38                              ch:	
   70 0000 0000 006C 006C   E5 20 
                                                            	sub2 $20
                                                            .ends
                                                            	
                                                            
                                                            .macro CALC_PCE_BANK_FROM_WLA_DATABANK
                                                            	lda #>(\1 >> 5) ; converts page-address into bank number offset
                                                            	clc
                                                            	.db $be, $ef
                                                            	adc #:\1    	; get proper bank number
                                                            	.db $be, $ef
                                                            	.dw \1
                                                            .endm
                                                            
                                                            .macro UP_VRAM_DBANK_ADDR ;ARGS label, vram_addr, bytes
                                                            	CALC_PCE_BANK_FROM_WLA_DATABANK \1
                                                            	sta <bl
                                                            
                                                            	lda #<\1
                                                            	sta <si
                                                            	lda #>\1
                                                            	and #$1f    	; mask out page
                                                            	sta <si + 1
                                                            
                                                            	lda \2.w + 0
                                                            	sta <di
                                                            	lda \2.w + 1
                                                            	sta <di + 1
                                                            	lda #<(\3>>1) 	; bytes
                                                            	sta <cl
                                                            	lda #>(\3>>1) 	; bytes
                                                            	sta <ch
                                                            	jsr load_vram
                                                            .endm
                                                            
                                                            
                                                            .bank 0 slot 0
   86 0000 0000 0000 0000   A9 01                           .org 0
   87 0000 0000 0002 0002   18 
   88 0000 0000 0003 0003   BE EF 
   89 0000 0000 0005 0005   69 03 
   90 0000 0000 0007 0007   BE EF 
   91 0000 0000 0009 0009   01 20 
   96 0000 0000 000B 000B   85 6B 
   98 0000 0000 000D 000D   A9 01 
   99 0000 0000 000F 000F   85 6B 
  100 0000 0000 0011 0011   A9 20 
  101 0000 0000 0013 0013   29 1F 
  102 0000 0000 0015 0015   85 6C 
  104 0000 0000 0017 0017   AD 00 80 
  105 0000 0000 001A 001A   85 6B 
  106 0000 0000 001C 001C   AD 01 80 
  107 0000 0000 001F 001F   85 6C 
  108 0000 0000 0021 0021   A9 32 
  109 0000 0000 0023 0023   85 6B 
  110 0000 0000 0025 0025   A9 00 
  111 0000 0000 0027 0027   85 6B 
  112 0000 0000 0029 0029   20 2C 00 
                                                            .section "code 4"
                                                            	UP_VRAM_DBANK_ADDR derp, $8000, 100
  120 0000 0000 002C 002C   EA                              load_vram:	nop
                                                            .ends
                                                            
                                                            
                                                            .macro UP_VRAM_ADDR_2 ARGS label, vram_addr, bytes
                                                            	.db 1, 2, 3, 4, 5
                                                            	lda #:label	; LABEL
                                                            	.db 1, 2, 3, 4, 5
                                                            	sta <bl
                                                            	lda #<label
                                                            	sta <si
                                                            	lda #>label
                                                            	sta <si + 1
                                                            	lda vram_addr.w + 0 ; must force .w + 0 due to another bug (Filed)
                                                            	sta <di
                                                            	lda vram_addr.w + 1
                                                            	sta <di + 1
                                                            	lda #<(\3/2) 	; words
                                                            	sta <cl
                                                            	lda #>(\3/2) 	; words
                                                            	sta <ch
                                                            	jsr load_vram
                                                            .endm
                                                            
                                                            .bank 0 slot 0
                                                            .org 0
  125 0000 0000 002D 002D   01 02 03 04 05                  .section "code 5"
  126 0000 0000 0032 0032   A9 03 
  127 0000 0000 0034 0034   01 02 03 04 05 
  128 0000 0000 0039 0039   85 6B 
  129 0000 0000 003B 003B   A9 01 
  130 0000 0000 003D 003D   85 6B 
  131 0000 0000 003F 003F   A9 20 
  132 0000 0000 0041 0041   85 6C 
  133 0000 0000 0043 0043   AD 00 80 
  134 0000 0000 0046 0046   85 6B 
  135 0000 0000 0048 0048   AD 01 80 
  136 0000 0000 004B 004B   85 6C 
  137 0000 0000 004D 004D   A9 32 
  138 0000 0000 004F 004F   85 6B 
  139 0000 0000 0051 0051   A9 00 
  140 0000 0000 0053 0053   85 6B 
  141 0000 0000 0055 0055   20 2C 00 
                                                            	UP_VRAM_ADDR_2 derp, $8000, 100
  148 0000 0000 0058 0058   EA                              vram_addr:	nop
                                                            .ends
