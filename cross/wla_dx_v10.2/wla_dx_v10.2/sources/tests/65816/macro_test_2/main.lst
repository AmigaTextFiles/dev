; WLALINK ($VER: wlalink 5.17 (24.6.2022)) listing file
; 2022-06-24 14:15:08

;Line Base Bank Slot PC   Offset Hex
                                                                 
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 // macro parser test
                                                                 //////////////////////////////////////////////////////////////////////
                                                                         
                                                                 .memorymap
                                                                         slotsize $8000
                                                                         defaultslot 1
                                                                         slot 0 $0000
                                                                         slot 1 $8000
                                                                 .endme                    
                                                                 
                                                                 .lorom
                                                                 
                                                                 .rombanksize $8000
                                                                 .rombanks 3
                                                                 
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 // test 1
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 
                                                                 .macro FILTER_MACRO_B
                                                                 .redefine _out \1 & $FF
                                                                 .endm
                                                                 
                                                                 .macro FILTER_MACRO_W
                                                                 .redefine _out = \1 & $FFFF
                                                                 .endm
                                                                 
                                                                 .macro FILTER_MACRO_L
                                                                 .redefine _out \1 & $FFFFFF
   22 0000 0000 0001 800D 000D   38                              .endm
   22 0000 0000 0001 800C 000C   37                              
   22 0000 0000 0001 800B 000B   36                              .macro FILTER_MACRO_2
   22 0000 0000 0001 800A 000A   35                              .redefine _out \2
   22 0000 0000 0001 8009 0009   34                              .endm
   26 0000 0000 0001 8029 0029   38 00 
   22 0000 0000 0001 8008 0008   33                              
   26 0000 0000 0001 8027 0027   37 00 
   22 0000 0000 0001 8007 0007   32                              .bank 0 slot 1
   26 0000 0000 0001 8025 0025   36 00 
   22 0000 0000 0001 8006 0006   31                              
   26 0000 0000 0001 8023 0023   35 00 
   22 0000 0000 0001 8005 0005   30                              ; @BT result.rom
   26 0000 0000 0001 8021 0021   34 00 
   30 0000 0000 0001 8051 0051   38 00 00 
   22 0000 0000 0001 8004 0004   EF                              
   26 0000 0000 0001 801F 001F   33 00 
   30 0000 0000 0001 804E 004E   37 00 00 
   22 0000 0000 0001 8003 0003   56                              .section "SectionA" force
   26 0000 0000 0001 801D 001D   32 00 
   30 0000 0000 0001 804B 004B   36 00 00 
   26 0000 0000 0001 801B 001B   31 00                           main:
   30 0000 0000 0001 8048 0048   35 00 00 
   44 0000 0000 0001 8000 0000   30 31 3E                                .db "01>"                                               ; @BT TEST-01 01 START
   26 0000 0000 0001 8019 0019   30 00 
   30 0000 0000 0001 8045 0045   34 00 00 
   45 0000 0000 0001 800E 000E   39                                      .dbm FILTER_MACRO_B, $123456, $ABCDEF, "0123456789"     ; @BT 56 EF 30 31 32 33 34 35 36 37 38 39
   26 0000 0000 0001 8017 0017   EF CD 
   30 0000 0000 0001 8042 0042   33 00 00 
   46 0000 0000 0001 800F 000F   3C 30 31                                .db "<01"                                               ; @BT END
   26 0000 0000 0001 8015 0015   56 34 
   30 0000 0000 0001 803F 003F   32 00 00 
   30 0000 0000 0001 803C 003C   31 00 00                        
   48 0000 0000 0001 8012 0012   30 32 3E                                .db "02>"                                               ; @BT TEST-02 02 START
   30 0000 0000 0001 8039 0039   30 00 00 
   49 0000 0000 0001 802B 002B   39 00                                   .dwm FILTER_MACRO_W, $123456, $ABCDEF, "0123456789"     ; @BT 56 34 EF CD 30 00 31 00 32 00 33 00 34 00 35 00 36 00 37 00 38 00 39 00
   30 0000 0000 0001 8036 0036   EF CD AB 
   34 0000 0000 0001 8062 0062   05 
   50 0000 0000 0001 802D 002D   3C 30 32                                .db "<02"                                               ; @BT END
   30 0000 0000 0001 8033 0033   56 34 12 
   34 0000 0000 0001 8061 0061   04 
   34 0000 0000 0001 8060 0060   03                              
   52 0000 0000 0001 8030 0030   30 33 3E                                .db "03>"                                               ; @BT TEST-03 03 START
   34 0000 0000 0001 805F 005F   02 
   53 0000 0000 0001 8054 0054   39 00 00                                .dlm FILTER_MACRO_L, $123456, $ABCDEF, "0123456789"     ; @BT 56 34 12 EF CD AB 30 00 00 31 00 00 32 00 00 33 00 00 34 00 00 35 00 00 36 00 00 37 00 00 38 00 00 39 00 00
   34 0000 0000 0001 805E 005E   01 
   34 0000 0000 0001 8074 0074   05 00 
   54 0000 0000 0001 8057 0057   3C 30 33                                .db "<03"                                               ; @BT END
   34 0000 0000 0001 805D 005D   00 
   34 0000 0000 0001 8072 0072   04 00 
   34 0000 0000 0001 8070 0070   03 00                           
   56 0000 0000 0001 805A 005A   30 34 3E                                .db "04>"                                               ; @BT TEST-04 04 START
   34 0000 0000 0001 806E 006E   02 00 
   57 0000 0000 0001 8063 0063   06                                      .dbm FILTER_MACRO_2, $123456, $ABCDEF, "01234"          ; @BT 00 01 02 03 04 05 06
   34 0000 0000 0001 806C 006C   01 00 
   34 0000 0000 0001 808D 008D   05 00 00 
   58 0000 0000 0001 8064 0064   3C 30 34                                .db "<04"                                               ; @BT END
   34 0000 0000 0001 806A 006A   00 00 
   34 0000 0000 0001 808A 008A   04 00 00 
   34 0000 0000 0001 8087 0087   03 00 00                        
   60 0000 0000 0001 8067 0067   30 35 3E                                .db "05>"                                               ; @BT TEST-05 05 START
   34 0000 0000 0001 8084 0084   02 00 00 
   61 0000 0000 0001 8076 0076   06 00                                   .dwm FILTER_MACRO_2, $123456, $ABCDEF, "01234"          ; @BT 00 00 01 00 02 00 03 00 04 00 05 00 06 00
   34 0000 0000 0001 8081 0081   01 00 00 
   62 0000 0000 0001 8078 0078   3C 30 35                                .db "<05"                                               ; @BT END
   34 0000 0000 0001 807E 007E   00 00 00 
                                                                 
   64 0000 0000 0001 807B 007B   30 36 3E                                .db "06>"                                               ; @BT TEST-06 06 START
   65 0000 0000 0001 8090 0090   06 00 00                                .dlm FILTER_MACRO_2, $123456, $ABCDEF, "01234"          ; @BT 00 00 00 01 00 00 02 00 00 03 00 00 04 00 00 05 00 00 06 00 00
   66 0000 0000 0001 8093 0093   3C 30 36                                .db "<06"                                               ; @BT END
                                                                 .ends
                                                                 
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 // test 2
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 
                                                                 .bank 1 slot 0
                                                                 
                                                                 .MACRO make_rst
                                                                   // these tests start from 07 (range: 07-14)
                                                                   .DEFINE CHAR = \1+7
                                                                   .IF CHAR < 10
                                                                     .DEFINE CHAR_1 = '0'
                                                                     .DEFINE CHAR_2 = '0'+CHAR
                                                                   .ELSE
                                                                     .DEFINE CHAR_1 = '1'
                                                                     .DEFINE CHAR_2 = '0'+CHAR-10
                                                                   .ENDIF
                                                                         
                                                                   .ORGA (\1 * 8)
                                                                   .SECTION "SectionB_\1" SIZE 8 FORCE KEEP
                                                                         .db CHAR_1, CHAR_2, '>'
                                                                 rts_\1: .db \1, "\2"
                                                                         .db '<', CHAR_1, CHAR_2
                                                                   .ENDS
                                                                 
                                                                   .UNDEFINE CHAR, CHAR_1, CHAR_2
                                                                 .ENDM
                                                                 
                                                                 ; @BT TEST-07 07 START 00 31 END
                                                                 ; @BT TEST-08 08 START 01 32 END
   88 0000 0001 0000 0038 0038   31 34 3E                        ; @BT TEST-09 09 START 02 33 END
   89 0000 0001 0000 003B 003B   07 38 
   90 0000 0001 0000 003D 003D   3C 31 34 
   88 0000 0001 0000 0030 0030   31 33 3E                        ; @BT TEST-10 10 START 03 34 END
   89 0000 0001 0000 0033 0033   06 37 
   90 0000 0001 0000 0035 0035   3C 31 33 
   88 0000 0001 0000 0028 0028   31 32 3E                        ; @BT TEST-11 11 START 04 35 END
   89 0000 0001 0000 002B 002B   05 36 
   90 0000 0001 0000 002D 002D   3C 31 32 
   88 0000 0001 0000 0020 0020   31 31 3E                        ; @BT TEST-12 12 START 05 36 END
   89 0000 0001 0000 0023 0023   04 35 
   90 0000 0001 0000 0025 0025   3C 31 31 
   88 0000 0001 0000 0018 0018   31 30 3E                        ; @BT TEST-13 13 START 06 37 END
   89 0000 0001 0000 001B 001B   03 34 
   90 0000 0001 0000 001D 001D   3C 31 30 
   88 0000 0001 0000 0010 0010   30 39 3E                        ; @BT TEST-14 14 START 07 38 END
   89 0000 0001 0000 0013 0013   02 33 
   90 0000 0001 0000 0015 0015   3C 30 39 
   88 0000 0001 0000 0008 0008   30 38 3E                        
   89 0000 0001 0000 000B 000B   01 32 
   90 0000 0001 0000 000D 000D   3C 30 38 
   88 0000 0001 0000 0000 0000   30 37 3E                        .REPEAT 8 INDEX IDX
   89 0000 0001 0000 0003 0003   00 31 
   90 0000 0001 0000 0005 0005   3C 30 37 
                                                                   make_rst IDX IDX+1
                                                                 .ENDR
                                                                 
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 // test 3
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 
                                                                 .bank 1 slot 0
                                                                 
                                                                 .macro string_macro_deep
                                                                   .db "16>"     ; @BT TEST-16 16 START
                                                                   .db "\1"      ; @BT 48 49
                                                                   .db "\2"      ; @BT 59 4F
                                                                   .db "<16"     ; @BT END
                                                                 .endm
                                                                 
                                                                 .macro string_macro
                                                                   .db "15>"     ; @BT TEST-15 15 START
                                                                 label_\1:
                                                                   .db "\1"      ; @BT 48 49
                                                                 label_\2: 
                                                                   .db "\2"      ; @BT 59 4F
                                                                   .db "<15"     ; @BT END
                                                                   string_macro_deep \1 \2
  116 0000 0001 0000 004A 004A   31 36 3E                        .endm
  117 0000 0001 0000 004D 004D   48 49 
  118 0000 0001 0000 004F 004F   59 4F 
  119 0000 0001 0000 0051 0051   3C 31 36 
  123 0000 0001 0000 0040 0040   31 35 3E                                
  125 0000 0001 0000 0043 0043   48 49 
  127 0000 0001 0000 0045 0045   59 4F 
  128 0000 0001 0000 0047 0047   3C 31 35 
                                                                  string_macro HI "YO"
                                                                         
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 // test 4
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 
                                                                         .macro is_immediate_2
                                                                         .if \?1 != ARG_IMMEDIATE
                                                                         adc \1-2
                                                                         .else
                                                                         adc #\1+2
                                                                         .endif
                                                                         .endm
                                                                         
                                                                         .macro is_immediate_1
                                                                         .if \?1 == ARG_IMMEDIATE
                                                                         adc #\1+1
                                                                         .else
                                                                         adc \1-1
                                                                         .endif
                                                                         is_immediate_2 \1
                                                                         .endm
  142 0000 0001 0000 0059 0059   69 07                           
  155 0000 0001 0000 0054 0054   31 37 3E                                .db "17>"               ; @BT TEST-17 17 START
  148 0000 0001 0000 0057 0057   69 06 
                                                                         is_immediate_1 #5       ; @BT 69 06 69 07
  157 0000 0001 0000 005B 005B   3C 31 37                                .db "<17"               ; @BT END
  140 0000 0001 0000 0063 0063   65 02                           
  159 0000 0001 0000 005E 005E   31 38 3E                                .db "18>"               ; @BT TEST-18 18 START
  150 0000 0001 0000 0061 0061   65 03 
                                                                         is_immediate_1 4        ; @BT 65 03 65 02
  161 0000 0001 0000 0065 0065   3C 31 38                                .db "<18"               ; @BT END
                                                                 
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 // test 5
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 
                                                                         .DEFINE DEFINITION_A 1
                                                                 
                                                                         .MACRO REDEFINER_1
                                                                         .REDEFINE \1 = ?1 + 1        ; \1 here is the definition's name,
                                                                         .ENDM                        ; and ?1 is its value.
                                                                 
                                                                         REDEFINER_1 &DEFINITION_A    ; here we feed the definition's name
                                                                         REDEFINER_1 &DEFINITION_A    ; as first argument, not it's value
                                                                 
                                                                         .DEFINE DEFINITION_B 1
                                                                 
                                                                         .MACRO REDEFINER_2
                                                                         .REDEFINE DEFINITION_B \1 + 1
                                                                         .ENDM
                                                                 
                                                                         REDEFINER_2 DEFINITION_B
                                                                         REDEFINER_2 DEFINITION_B
                                                                 
  185 0000 0001 0000 0068 0068   31 39 3E                                .db "19>"               ; @BT TEST-19 19 START
  186 0000 0001 0000 006B 006B   03                                      .db DEFINITION_A        ; @BT 03
  187 0000 0001 0000 006C 006C   03                                      .db DEFINITION_B        ; @BT 03
  188 0000 0001 0000 006D 006D   3C 31 39                                .db "<19"               ; @BT END
                                                                 
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 // test 6
                                                                 //////////////////////////////////////////////////////////////////////
                                                                 
                                                                         .define FIVE = 5
                                                                         
                                                                         .macro floor_2
                                                                         .db ?1
                                                                         .db 1+?1+1
                                                                         .db \2-4
                                                                         .endm
                                                                 
                                                                         .macro floor_1
                                                                         floor_2 \1 ?1
                                                                         .db ?1-1
                                                                         .endm
                                                                 
                                                                         .macro floor_0
                                                                         floor_1 \1
  197 0000 0001 0000 0073 0073   05                                      .endm
  198 0000 0001 0000 0074 0074   07 
  199 0000 0001 0000 0075 0075   01 
  204 0000 0001 0000 0076 0076   04 
                                                                 
  211 0000 0001 0000 0070 0070   32 30 3E                                .db "20>"       ; @BT TEST-20 20 START
                                                                         floor_0 &FIVE   ; @BT 05 07 01 04
  213 0000 0001 0000 0077 0077   3C 32 30                                .db "<20"       ; @BT END
