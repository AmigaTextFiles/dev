#ifndef CODEGEN__H
#define CODEGEN__H

#include "misc.h"

typedef struct{
	int A;
	int X;
	int Y;
	struct value *pA;
	struct value *pX;
	struct value *pY;
	int Aval;
	int Xval;
	int Yval;
} REGS;

extern REGS *newREGS(void);
extern int REGSget(REGS *pR,int reg);
extern int REGSrel(REGS *pR,int reg);
extern int REGSchk(REGS *pR,int reg);
extern int REGsetValue(REGS *pR,int reg,struct value *pV);
extern struct value *REGgetValue(REGS *pR,int reg);
extern int REGSsetConst(REGS *pR,int reg,int v);
extern int  REGSgetConst(REGS *pR,int reg);
extern int REGSisAnyRegSetTo(REGS *pR, int v);

#define REGS_A		0
#define REGS_X		1
#define REGS_Y		2

extern REGS *Regs;

typedef struct {
	char **Stack;
	int Size;
	int Index;
}STACK;

extern STACK *newStack(int size);
extern char *StackGetTop(STACK *pS);
extern char *StackPop(STACK *pS);
extern void StackPush(STACK *pS,char *s);

extern STACK *ExitStack;
extern STACK *DoLoopStack;
extern STACK *IfStack;

#define LOW(x)	(x&0xff)
#define LOWMID(x)	((x>>8)&0xff)
#define HIGHMID(x)	((x>>16)&0x0ff)
#define HIGH(x)		((x>>24)&0x0ff)

extern symbol *GetCurrentProc(void);
extern void SetCurrentProc(symbol *pS);

extern void OutputInternalStuff(FILE *out);
extern void OutputData(FILE *out,symbol *pSym);
extern int SizeOfType(link *l);
extern int SizeOfRef(link *l);
extern int ArraySize(symbol *pS);
extern char *GetStringData(symbol *pSym);
extern char *GetDataData(symbol *pSym);
extern int SizeOfArgList(symbol *args);
extern void OutputGetArgs(FILE *out,char *FirstArg,int size,char *proc);
extern value *DoBinary(FILE *out,value *v1p,int op, value *v2p,short f1, short f2 ,char *LabTrue,char *LaFalse,value *lv  );
extern value *ConvertTypeUp(FILE *out,value *v1,link *t2);
extern value *DoAssign(FILE *out,value *v1,value *v2,int op,short rFlagV1,short rFlagV2);;
extern value *DoNegative(FILE *out,value *v1);
extern void Passparameter(FILE *out,value *v,PARAMS *pP,int param);
extern value *DoReturn(FILE *OutFile,value *v1,int Nret);;
extern value *DoArrayRef(FILE *out,value *v1,value *v2);
extern void BranchOnValue(FILE *out,value *v,char *False,char *True);

#endif
