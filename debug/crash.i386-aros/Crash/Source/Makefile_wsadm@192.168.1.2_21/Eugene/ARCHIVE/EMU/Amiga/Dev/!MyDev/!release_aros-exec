#Makefile for Crash 1.1 by Eugene aGGreSSor Sobolev
# http://www.m4rko.com/amiga

#   Default compile arguments

project = Crash
file_out = Crash
postfix =
CC = ppc-amigaos-gcc
STRIP=ppc-amigaos-strip --strip-unneeded --remove-section .comment
version = 1.1
libs  = -lz
flags = -flto -O2 -lauto -std=c99 -w -g

c_files = Crash.c
obj = Crash.o

#   AmigaOS 3.1 -- AmigaOS loadseg()ble executable/binary
#   https://github.com/bebbo/amiga-gcc.git
ifeq ($(OS), AOS3)
    postfix=_aos3
    CC=m68k-amigaos-gcc # gcc version 6.5.0b 200712200135 (GCC)
    STRIP=m68k-amigaos-strip --strip-unneeded --remove-section .comment
    libs  = -lm
    flags = -Wall -O0 -noixemul -m68020-60 -fomit-frame-pointer -std=c99 -w -N
else

#   AmigaOS 4.1 -- ELF 32-bit MSB executable, PowerPC or cisco 4500, version 1 (SYSV), statically linked
#   https://github.com/sba1/adtools
ifeq ($(OS), AOS4)
    postfix=_aos4
    CC=ppc-amigaos-gcc  # gcc version 8.4.0 (adtools build 8.4.0)
    STRIP=ppc-amigaos-strip --strip-unneeded --remove-section .comment
    libs  = -lz
    flags = -flto -O0 -lauto -std=c99 -w -N
else

#   AROS i386 --  ELF 32-bit LSB relocatable, Intel 80386, version 1 (SYSV), not stripped
#   http://archives.aros-exec.org/share/development/cross/gcc-4.2.2-i386-aros-cygwin.tar.bz2
ifeq ($(OS), AROS32)
    postfix=_aros-i386
    CC=i386-aros-gcc    # gcc version 4.2.2
    STRIP=i386-aros-strip --strip-unneeded --remove-section .comment
    libs  = -lz
    flags = -Wall -O0 -std=c99 -w -N
endif
endif
endif

all : ${file_out}

${file_out}: ${obj} 
	@echo "Linking!"
	${CC} ${flags} -g ${obj} ${libs} -o ../${file_out}${postfix}
	# ${STRIP} ../${file_out}${postfix}
	@rm -f *.o

${obj}: ${c_files}
	@echo "Compiling!"
	${CC} ${flags} -c ${c_files}

clean: 
	@rm -f *.o ../${file_out}${postfix}
	@echo "Deleting objects and output files"
	@echo "Objects: ${obj} | output file: ${file_out}${postfix}"

clear: clean
