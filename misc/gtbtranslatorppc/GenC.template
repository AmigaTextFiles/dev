/****h* $SourceFileName [$ProjectVersion] ****************
*
* NAME
*    $SourceFileName
*
* DESCRIPTION
* 
* SYNOPSIS 
*    $SourceFileName is a GUI for....
*
* HISTORY
*    $DateToday - Created this file.
*
* COPYRIGHT
*    $SourceFileName $DateToday(C) by $ProjectAuthorName
*
* NOTES
*    Program set up to compile with gcc & AmigaOS4 also.
*
*    $VER: $SourceFileName $ProjectVersion ($DateToday) by $ProjectAuthorName
************************************************************************
*
*/

#include <stdio.h>
#include <string.h>

#include <exec/types.h>

#include <AmigaDOSErrs.h>

#include <intuition/intuition.h>
#include <intuition/classes.h>
#include <intuition/classusr.h>
#include <intuition/imageclass.h>  // for Image Buttons only
#include <intuition/gadgetclass.h>

#include <libraries/gadtools.h>

$ProgramOptionDefines

#ifdef     $IconSupport
# include <workbench/workbench.h>
# include <workbench/startup.h>
# include <workbench/icon.h>
#endif

#ifdef     $ASLSupport
# include <utility/tagitem.h>
# include <dos/dostags.h>
# include <libraries/asl.h>
#endif

#include <graphics/displayinfo.h>
#include <graphics/gfxbase.h>

$IncludePragmas

#ifndef __amigaos4__

# include <proto/locale.h>

# include <clib/exec_protos.h>
# include <clib/intuition_protos.h>
# include <clib/gadtools_protos.h>
# include <clib/graphics_protos.h>
# include <clib/utility_protos.h>
# include <clib/diskfont_protos.h>

#else

# define __USE_INLINE__

# include <proto/exec.h>
# include <proto/dos.h>
# include <proto/intuition.h>
# include <proto/gadtools.h>
# include <proto/graphics.h>
# include <proto/utility.h>
# include <proto/diskfont.h>
# include <proto/locale.h>

# ifdef     $IconSupport
#  include <proto/icon.h>
# endif

#endif

struct Catalog *catalog = NULL;

#define   CATCOMP_ARRAY    1
$LocaleHeader

#define  MY_LANGUAGE "english"

$IncludeCommonFuncs

$GadgetIDs

// ----------------------------------------------------

#ifdef $ImageSupport
# ifndef __amigaos4__
IMPORT Class    *initGet( void ); // in Boopsi.o

struct IClass   *getClass = NULL;
struct _Object  *getImage = NULL;
# endif
#endif

#ifdef $IconSupport

#ifndef __amigaos4__

IMPORT  struct WBStartup  *_WBenchMsg;
struct Library *IconBase;

#else

IMPORT struct WBStartup *__WBenchMsg;

IMPORT struct Library   *IconBase;
IMPORT struct IconIFace *IIcon;

#endif

PRIVATE struct DiskObject *diskobj = NULL;

#endif

#ifndef __amigaos4__

struct IntuitionBase *IntuitionBase;
struct GfxBase       *GfxBase;
struct Library       *GadToolsBase;
struct LocaleBase    *LocaleBase;

PRIVATE char v[] = "\0$VER: $SourceFileName $ProjectVersion " __AMIGADATE__ " by $ProjectAuthorName \0";

#else

IMPORT struct Library *SysBase;
IMPORT struct Library *DOSBase;
IMPORT struct Library *IntuitionBase;
IMPORT struct Library *GfxBase;
IMPORT struct Library *UtilityBase;
IMPORT struct Library *DiskfontBase;
IMPORT struct Library *LocaleBase;

PUBLIC struct Library *GadToolsBase;

IMPORT struct ExecIFace      *IExec;
IMPORT struct DOSIFace       *IDOS;
IMPORT struct IntuitionIFace *IIntuition;
IMPORT struct GraphicsIFace  *IGraphics;
IMPORT struct UtilityIFace   *IUtility;
IMPORT struct DiskfontIFace  *IDiskfont;
IMPORT struct LocaleIFace    *ILocale;

PUBLIC struct GadToolsIFace  *IGadTools;

PRIVATE char v[] = "\0$VER: $SourceFileName $ProjectVersion " __DATE__ " by $ProjectAuthorName \0";

#endif

// ----------------------------------------------------

PRIVATE UBYTE em[512] = { 0, }, *ErrMsg = &em[0];

$GUIVariables

$MXStrings

$CycleStrings

$ListViewStrings

PRIVATE struct TextAttr $MassagedScreenFontName$ScreenFontSize = { "$ScreenFontName.font", $ScreenFontSize, 0x00, 0x62 };

// TTTTTTTTT $SourceFileName ToolTypes: TTTTTTTTT

#ifdef $IconSupport

PRIVATE char Tool1[32]     = "TOOL1";

PRIVATE char DefTool1[128] = { 0, };

PRIVATE char *TTTool1      = &DefTool1[0];

#endif

// TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT

#ifdef $ASLSupport

PRIVATE struct TagItem FileTags[] = {

   ASLFR_Window,          (ULONG) NULL,
   ASLFR_TitleText,       (ULONG) "Obtain a filename...",
   ASLFR_InitialHeight,   400,
   ASLFR_InitialWidth,    500,
   ASLFR_InitialTopEdge,  16,
   ASLFR_InitialLeftEdge, 100,
   ASLFR_PositiveText,    (ULONG) " OKAY! ",
   ASLFR_NegativeText,    (ULONG) " CANCEL! ",
   ASLFR_InitialPattern,  (ULONG) "#?",
   ASLFR_InitialFile,     (ULONG) "",
   ASLFR_InitialDrawer,   (ULONG) "RAM:",
   ASLFR_Flags1,          FRF_DOPATTERNS,
   ASLFR_Flags2,          FRF_REJECTICONS,
   ASLFR_SleepWindow,     TRUE,
   ASLFR_PrivateIDCMP,    TRUE,
   TAG_END 
};

#endif

$MenuFunctionNames
$MenuArray

$IntuiTextArray

$GadgetTypesArray
$GadgetFunctionNames
$GadgetsArray
$GadgetTagsArray

// ----------------------------------------------------

/****i* CMsg() [$ProjectVersion] *************************************************
*
* NAME
*    STRPTR rval = CMsg( int index, char *defaultStr );
*
* DESCRIPTION
*    Obtain a string from the locale catalog file, failing that,
*    return the default string.
**********************************************************************
*
*/

PRIVATE STRPTR CMsg( int strIndex, char *defaultString )
{
   if (catalog) // != NULL)
      return( (STRPTR) GetCatalogStr( catalog, strIndex, defaultString ) );
   else
      return( (STRPTR) defaultString );
}

/****i* SetupCatalog() [$ProjectVersion] *****************************************
*
* NAME
*    SetupCatalog()
*
* DESCRIPTION
**********************************************************************
*
*/

PRIVATE void SetupCatalog( void )
{
$LocaleStrings
   return;
}

// ----------------------------------------------------------------

$SetupScreenCode
$CloseScreenCode
$CloseWindowCode

// ----------------------------------------------------------------

$MenuFunctions
$GadgetFunctions

// ----------------------------------------------------------------

$BevelBoxRenderFunction
$IntuiTextRenderFunction
$OpenWindowDefn
$IDCMPHandlers
$IDCMPCode

// ----------------------------------------------------------------

PRIVATE void closeLibraries( void )
{
#  ifndef __amigaos4__
   CloseLibs();
#  else
   if (IGadTools)
      DropInterface( (struct Interface *) IGadTools );
   
   if (GadToolsBase)
      CloseLibrary( GadToolsBase );
#  endif

   return;
}

PRIVATE void ShutdownProgram( void )
{
$CloseGUI 
   if (catalog) // != NULL)
      CloseCatalog( catalog );

#  ifndef __amigaos4__      
   if (LocaleBase) // != NULL)
      CloseLibrary( (struct Library *) LocaleBase );
#  endif

#  ifdef $IconSupport
#  ifndef __amigaos4__
   if (IconBase) // != NULL)
      CloseLibrary( (struct Library *) IconBase );
#  endif
#  endif

   closeLibraries();
   
   return;
}

PRIVATE int openLibraries( void )
{
   int rval = RETURN_OK;
   
#  ifndef __amigaos4__
   rval = OpenLibs();

#  else // __amigaos4__ is DEFINED!  -lauto does NOT open gadtools.library!

   if ((GadToolsBase = OpenLibrary( "gadtools.library", 50L )))
      {
      if (!(IGadTools = (struct GadToolsIFace *) GetInterface( GadToolsBase, "main", 1, NULL )))
         {
	 closeLibraries();
	 
         rval = ERROR_INVALID_RESIDENT_LIBRARY;
	 }
      }
   else
      rval = ERROR_INVALID_RESIDENT_LIBRARY;
#  endif

#  ifdef $IconSupport
#  ifndef __amigaos4__
   if (!(IconBase = OpenLibrary( "icon.library", 37L ))) // == NULL)
      {
      closeLibraries();	
                  
      rval = ERROR_INVALID_RESIDENT_LIBRARY;
      }
#  endif      
#  endif

   return( rval );
}

PRIVATE int SetupProgram( void )
{
   int rval = RETURN_OK;
   
   if (openLibraries() != RETURN_OK)
      {
      rval = ERROR_INVALID_RESIDENT_LIBRARY;
      
      goto exitSetup;
      }

#  ifndef __amigaos4__      
   if (!(LocaleBase = OpenLibrary( "locale.library", 37L ))) // == NULL)
      {
      fprintf( stderr, CMsg( MSG_FMT_LIB_UNOPENED, MSG_FMT_LIB_UNOPENED_STR ),
                       "locale.library", "37" 
             );

      ShutdownProgram();
            
      rval = ERROR_INVALID_RESIDENT_LIBRARY;
      
      goto exitSetup;
      }
#  endif

   catalog = OpenCatalog( NULL, "$CatalogName",
                                OC_BuiltInLanguage, MY_LANGUAGE,
                                TAG_DONE 
                        );

   (void) SetupCatalog();

$OpenGUI
exitSetup:

   return( rval );
}

#ifdef $IconSupport
PRIVATE void *processToolTypes( STRPTR *toolptr )
{
   if (!toolptr) // == NULL)
      return( NULL );

   // Place your tool grabbers here:

   return( NULL );
}
#endif

PUBLIC int main( int argc, char **argv )
{
#  ifdef $IconSupport   
   struct WBArg  *wbarg;
   STRPTR        *toolptr = (STRPTR *) NULL;
#  endif

   int error = RETURN_OK;

   if ((error = SetupProgram()) != RETURN_OK)
      {
      return( error );
      }
      
#  ifdef $IconSupport   
   if (argc > 0)    // from CLI:
      {
      // We prefer to use the ToolTypes: 
      (void) FindIcon( &processToolTypes, diskobj, argv[0] );
      }
   else             // from Workbench:
      {
#     ifndef __amigaos4__
      wbarg   = &(_WBenchMsg->sm_ArgList[ _WBenchMsg->sm_NumArgs - 1 ]);
#     else
      wbarg   = &( __WBenchMsg->sm_ArgList[ __WBenchMsg->sm_NumArgs - 1 ]);
#     endif

      toolptr = FindTools( diskobj, wbarg->wa_Name, wbarg->wa_Lock );

      processToolTypes( toolptr );
      }
#  endif

$MainSettings

#  ifdef $IconSupport
   FreeDiskObject( diskobj );
#  endif
   
   ShutdownProgram();

   return( RETURN_OK );
}

/* --------------- END of $SourceFileName file! ------------------ */
