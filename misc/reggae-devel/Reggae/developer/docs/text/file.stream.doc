TABLE OF CONTENTS
0001 file.stream/background
0002 file.stream/MMA_StreamLength
0003 file.stream/MMA_StreamMode
0004 file.stream/MMA_StreamName
0005 file.stream/MMA_StreamPosBytes
0006 file.stream/MMA_StreamSeekable
0007 file.stream/MMA_TaskPriority
0008 file.stream/MMM_Pull
0009 file.stream/MMM_Push
0010 file.stream/MMM_Seek
file.stream/background

DESCRIPTION
       The class provides streams API for disk files on local and networked
       (for example SMBFS) filesystems. Every object of file.stream class
       creates a separate task. The task is acessing files using
       asyncio.library efficiently freeing the application of I/O load.
       A file.stream object can be safely shared between tasks (all
       operations are semaphore protected) with one important exception:
       object must be disposed by the task which created it. An object has
       only one port (number 0), it is input in write streams and output in
       read streams. Port format is MMF_STREAM.

       Object construction failure reasons

       MMA_ErrorCode == MMERR_WRONG_ARGUMENTS:
       - no MMA_StreamName specified.
       - unknown MMA_StreamMode specified.
       - specified MMA_TaskPriotity out of <-128, +127> range.

       MMA_ErrorCode == MMERR_OUT_OF_MEMORY:
       - no memory for name string copy.

       MMA_ErrorCode = MMERR_RESOURCE_MISSING:
       - message port creation failed.
       - subprocess creation failed.
       - no multimedia.class.
       - no asyncio.library.
       - no dos.library.

       MMA_ErrorCode == MMERR_NO_STREAM:
       - specified file cannot be opened.


NEW ATTRIBUTES
       Attributes applicability:
         I - may be set at creation time.
         S - may be set on an existing object.
         G - may be get from an object.
         P - may be set for an object's port.
         Q - may be queried from an object's port.

       MMA_StreamLength        (V50) [..G.Q], UQUAD*
       MMA_TaskPriority        (V50) [ISG..], BYTE, optional on init
       MMA_StreamName          (V50) [I.G.Q], STRPTR, required on init
       MMA_StreamMode          (V50) [I.G.Q], ULONG, optional on init
       MMA_StreamSeekable      (V50) [..G.Q], BOOL
       MMA_ErrorCode           (V51) [ISG..], ULONG, optional on init
       MMA_StreamPosBytes      (V51) [..G.Q], UQUAD*


NEW METHODS
       MMM_Pull(port, buffer, length)      (V50)
       MMM_Push(port, buffer, length)      (V50)
       MMM_Seek(port, type, position)      (V50)


NOTES
       MMA_StreamHandle is not supported for file streams.


file.stream/MMA_StreamLength

NAME
       MMA_StreamLength (V50) [..G.Q], UQUAD*


FUNCTION
       Returns current file length in bytes.


NOTES
       File length changes while writing. The attribute returns the file
       length at the time of query as returned by the filesystem.


file.stream/MMA_StreamMode

NAME
       MMA_StreamMode (V50) [I.G.Q], ULONG


FUNCTION
       Stream access mode. It can be MMA_StreamMode_Read (read only stream)
       or MMA_StreamMode_Write (write only stream).


file.stream/MMA_StreamName

NAME
       MMA_StreamName (V50) [I.G.Q], STRPTR


FUNCTION
       Name of file.stream is just path to a file. If MMA_StreamMode is
       MMA_StreamMode_Read, the file must exist already. For write mode the
       file may already exist (it will be overwritten) or not (it will be
       created). The path may be absolute, starting from volume name, or
       relative to application current dir (launched subtrhead inherits
       current directory). The name string is copied, so it may be passed
       as a local or dynamic variable.


NOTES
       Using stream.class on not file oriented DOS devices (like CON: for
       example) is not recommended. It	will probably not work, or give
       unexpected results.


file.stream/MMA_StreamPosBytes

NAME
       MMA_StreamPosBytes (V50) [..G.Q], UQUAD*


FUNCTION
       Returns current stream pointer in bytes.


NOTES
       64-bit attribute, in OM_GET pass a pointer to an UQUAD variable, in
       MMM_GetPort pass pointer to UQUAD as well or use MediaGetPort64()
       macro.


file.stream/MMA_StreamSeekable

NAME
       MMA_StreamSeekable (V50) [..G.Q], BOOL


FUNCTION
       Returns TRUE if the stream is seekable, FALSE otherwise. All
       file.stream objects return TRUE here.


file.stream/MMA_TaskPriority

NAME
       MMA_TaskPriority (V50) [ISG..], BYTE


FUNCTION
       Priority of object's subtask. Defaults to 0.


NOTES
       Do not change without a reason.


file.stream/MMM_Pull

NAME
       MMM_Pull -- Reads a block of data from stream to a buffer. (V50)


SYNOPSIS
       bytes = DoMethod(obj, MMM_Pull, ULONG port, APTR buffer, ULONG
         length);


FUNCTION
       Loads specified number of bytes into a buffer starting from current
       read pointer. This method works only for streams opened in read mode.


INPUTS
       - obj, object to perform the method on.
       - port, must be 0, as it is the only port of a file.stream object.
       - buffer, a memory buffer for read data, must be allocated with
         MediaAllocMem().
       - length, amount of data to be read in bytes.


RESULT
       - bytes, number of bytes read actually.

       Secondary error information available via MMA_ErrorCode attribute:
       - MMERR_WRONG_ARGUMENTS - port is not 0, NULL buffer.
       - MMERR_RESOURCE_MISSING - message to the subtask cannot be sent.
       - MMERR_NOT_IMPLEMENTED - pulling from write-only stream.
       - MMERR_IO_ERROR - write operation failed.


file.stream/MMM_Push

NAME
       MMM_Push -- Writes a block of data to stream from a buffer. (V50)


SYNOPSIS
       bytes = DoMethod(obj, MMM_Push, ULONG port, APTR buffer, ULONG
         length);


FUNCTION
       Writes specified number of bytes into the stream.


INPUTS
       - obj, object to perform the method on.
       - port, ignored.
       - buffer, a memory buffer containing data to be written, must be
         allocated with MediaAllocMem().
       - length, amount of data to write in bytes.


RESULT
       - bytes, number of bytes written actually.
       Secondary error information available via MMA_ErrorCode attribute:
       - MMERR_WRONG_ARGUMENTS - port is not 0, NULL buffer.
       - MMERR_RESOURCE_MISSING - message to the subtask cannot be sent.
       - MMERR_NOT_IMPLEMENTED - pushing to read-only stream.
       - MMERR_IO_ERROR - write operation failed.


file.stream/MMM_Seek

NAME
       MMM_Seek -- Seeks in a file to specified absolute position. (V50)


SYNOPSIS
       result = DoMethod(obj, MMM_Seek, ULONG port, ULONG type,
       UQUAD *position);


FUNCTION
       Seeks in a file to specified absolute position. Seeks past the end of
       file are truncated and MMERR_END_OF_DATA is reported. File.stream
       understand MMM_SEEK_BYTES type only.


INPUTS
       - obj, object to perform the method on.
       - port, always 0, as it is the only port in a file.stream object.
       - type, MMM_SEEK_BYTES.
       - position, pointer to UQUAD variable containing desired position in
         the file.


RESULT
       - result, boolean.
       Secondary error information available via MMA_ErrorCode attribute:
       - MMERR_WRONG_ARGUMENTS - port is not 0, seek position out of LONG
         range.
       - MMERR_RESOURCE_MISSING - message to the subtask cannot be sent.
       - MMERR_SEEK_ERROR - seeking failed.


