TABLE OF CONTENTS
0001 http.stream/background
0002 http.stream/MMA_Http_AutoRedirect
0003 http.stream/MMA_Http_Header
0004 http.stream/MMA_Http_HeaderEntries
0005 http.stream/MMA_Http_NetProcess
0006 http.stream/MMA_Http_NetProcessName
0007 http.stream/MMA_Http_ProxyPort
0008 http.stream/MMA_Http_ProxyServer
0009 http.stream/MMA_Http_Response
0010 http.stream/MMA_Http_UserAgent
0011 http.stream/MMA_StreamLength
0012 http.stream/MMA_StreamMode
0013 http.stream/MMA_StreamName
0014 http.stream/MMA_StreamPosBytes
0015 http.stream/MMA_StreamSeekable
0016 http.stream/MMA_TaskPriority
0017 http.stream/MMM_Http_GetHeaderEntry
0018 http.stream/MMM_Pull
0019 http.stream/MMM_Seek
http.stream/background

DESCRIPTION
       The class provides Reggae API for data accessible on the Internet
       via HTTP/1.1 protocol. Every object of http.stream class creates a
       separate task. The task is acessing files using TCP/IP stack with
       bsdsocket.library interface. A http.stream object can be safely
       shared between tasks (all operations are semaphore protected) with
       one important exception: object must be disposed by the task which
       created it. An object has only one input port (number 0). Port
       format is MMF_STREAM.

       Object construction failure reasons

       MMA_ErrorCode == MMERR_WRONG_ARGUMENTS:
       - no MMA_StreamName specified.
       - unknown or not supported MMA_StreamMode specified.
       - specified MMA_TaskPriotity out of <-128, +127> range.

       MMA_ErrorCode == MMERR_OUT_OF_MEMORY:
       - no memory for name string copy.

       MMA_ErrorCode = MMERR_RESOURCE_MISSING:
       - message port creation failed.
       - subprocess creation failed.
       - no multimedia.class.
       - no bsdsocket.library.
       - no dos.library.

       MMA_ErrorCode == MMERR_NO_STREAM:
       - specified stream cannot be opened.


NEW ATTRIBUTES
       Attributes applicability:
         I - may be set at creation time.
         S - may be set on an existing object.
         G - may be get from an object.
         P - may be set for an object's port.
         Q - may be queried from an object's port.

       MMA_StreamLength        (V50) [..G.Q], UQUAD*
       MMA_TaskPriority        (V50) [ISG..], BYTE, optional on init
       MMA_StreamName          (V50) [I.G.Q], STRPTR, required on init
       MMA_StreamMode          (V50) [I.G.Q], ULONG, optional on init
       MMA_StreamSeekable      (V50) [..G.Q], BOOL
       MMA_ErrorCode           (V51) [ISG..], ULONG, optional on init
       MMA_StreamPosBytes      (V51) [..G.Q], UQUAD*
       MMA_Http_Response       (V51) [..G.Q], STRPTR
       MMA_Http_Header         (V51) [..G.Q], STRPTR*
       MMA_Http_HeaderEntries  (V51) [..G.Q], ULONG
       MMA_Http_NetProcess     (V51) [..G..], struct Process*
       MMA_Http_NetProcessName (V51) [I.G..], STRPTR, optional on init
       MMA_Http_UserAgent      (V51) [I....], STRPTR, optional on init
       MMA_Http_ProxyServer    (V51) [I....], STRPTR, optional on init
       MMA_Http_ProxyPort      (V51) [I....], ULONG, optional on init
       MMA_Http_AutoRedirect   (V51) [I....], BOOL, optional on init


NEW METHODS
       MMM_Pull(port, buffer, length)      (V50)
       MMM_Seek(port, type, position)      (V50)
       MMM_Http_GetHeaderEntry(entry)      (V51)


NOTES
       MMA_StreamHandle is not supported for HTTP streams.


http.stream/MMA_Http_AutoRedirect

NAME
       MMA_Http_AutoRedirect (V51) [I....], BOOL


FUNCTION
       If TRUE, instructs the object to automatically follow redirection
       responses (30x) from the server instead of reporting error and 
       failing in OM_NEW. If this tag is set to TRUE, and server responds
       with 30x code, the header is searched for "Location" field. If this
       field is found, its contents is used as a new target and the request
       is resent. If there is no "Location" for 30x response, OM_NEW will
       fail. Default value for this tag is TRUE.


http.stream/MMA_Http_Header

NAME
       MMA_Http_Header (V51) [..G.Q], STRPTR*


FUNCTION
       This attribte gives access to the complete HTTP response header. The
       header is already parsed and returned as keyword-value pairs. The
       returned value is an address of table of pointers to stings. The
       first string (index 0) is the first keyword, the second one (index 1)
       is the value of this keyword. The third element (index 2) is the
       second keyword and so on. The table is terminated by NULL pointer.
       The header is parsed according to RFC 2616 including multiline
       fields, they are converted to single strings.


NOTES
       The first line of the response, returned by MMA_Http_Response is not
       included in the table returned by MMA_Http_Header.


SEE ALSO
       MMA_Http_HeaderEntries, MMA_Http_Response


http.stream/MMA_Http_HeaderEntries

NAME
       MMA_Http_HeaderEntries (V51) [..G.Q], ULONG


FUNCTION
       Number of entries returned by MMA_Http_Header. The first line of
       header is not counted here, as it is retured separately by
       MMA_Http_Response. The NULL element placed as the last table entry is
       not counted as well.


http.stream/MMA_Http_NetProcess

NAME
       MMA_Http_NetProcess (V51) [..G..], struct Process*


FUNCTION
       The attribute returns a pointer to the Process structure of network
       subprocess of a http.stream object. It can be used to send CTRL-C
       signal to the process to break network operation. Note that you
       cannot break network operations in OM_NEW this way, use
       MMA_Http_NetProcessName for this.


http.stream/MMA_Http_NetProcessName

NAME
       MMA_Http_NetProcessName (V51) [I.G..], STRPTR


FUNCTION
       This attribute specifies or returns the name of the network
       subprocess created by an object. The subprocess performs some network
       operations in OM_NEW, like name resolving, estabilishing a connection
       and sending request. As an application cannot get MMA_Http_NetProcess
       attribute until the object is created, there is no way to break
       mentioned network operations. MMA_Http_NetProcessName allows
       application to specify network process name, then the process can be
       found with FindTask(), and application can sent CTRL-C signal while
       the object is still in OM_NEW. Of course the application must be
       multithreaded to be able to do this (one thread creates object,
       another sends signal).


http.stream/MMA_Http_ProxyPort

NAME
       MMA_Http_ProxyPort (V51) [I....], ULONG


FUNCTION
       Specifies a port, which proxy is connected on. If proxy is not
       specified, this attribute is ignored. The default value for this tag
       is 8080 (usual port for HTTP proxies).


SEE ALSO
       MMA_Http_ProxyServer


http.stream/MMA_Http_ProxyServer

NAME
       MMA_Http_ProxyServer (V51) [I....], STRPTR


FUNCTION
       If not NULL, this attribute instructs http.stream object to connect
       to the destination host not directly, but via specified HTTP proxy.
       The default value for this tag is NULL (no proxy).


SEE ALSO
       MMA_Http_ProxyPort


http.stream/MMA_Http_Response

NAME
       MMA_Http_Response (V51) [..G.Q], STRPTR


FUNCTION
       Returns a read-only string containing the first line of HTTP response
       header. This line consists of HTTP version supported by server, three
       digit result code and textual result description, for example:

       HTTP/1.1 200 OK

       or

       HTTP/1.1 404 Not Found

       An application can analyse this line, inform user and take
       appropriate action. For list of result codes see HTTP protocol
       specification (RFC 2616).


http.stream/MMA_Http_UserAgent

NAME
       MMA_Http_UserAgent (V51) [I....], STRPTR


FUNCTION
       Allows application for identifying itself in HTTP 'User-Agent' header
       field. Note that string passed does not form the field contents
       alone. A string "/http.stream-xx.xx(MorphOS)" is appended to the one
       passed, where 'xx' are replaced by actual version of http.stream
       class. So for example if an application specifies:

       SuperNetMumboJumbo-6.2

       the complete 'User-Agent' field will be:

       SuperNetMumboJumbo-6.2/http.stream-51.1(MorphOS)

       The default value for this attribute is "unknown".


NOTES
       Supplied string must conform RFC 2616. It must not contain newlines.


http.stream/MMA_StreamLength

NAME
       MMA_StreamLength (V50) [..G.Q], UQUAD*


FUNCTION
       Returns stream length in bytes. If "Content-Length" field is found in
       the response header, it is used as stream length. If not found, zero
       is returned. It can happen if either server is not HTTP/1.1
       compilant, or server uses chunked transfer. Zero means unknown
       length.


NOTES
       64-bit attribute, in OM_GET pass a pointer to an UQUAD variable, in
       MMM_GetPort pass pointer to UQUAD as well or use MediaGetPort64()
       macro.


http.stream/MMA_StreamMode

NAME
       MMA_StreamMode (V50) [I.G.Q], ULONG


FUNCTION
       Stream access mode. The only supported mode is MMA_StreamMode_Read
       (read only stream). As it is also the default value, this tag can be
       safely ommited at OM_NEW.


http.stream/MMA_StreamName

NAME
       MMA_StreamName (V50) [I.G.Q], STRPTR


FUNCTION
       Name of http.stream is URL to the resource, but without leading
       "http://". It is not needed, as http.stream supports only HTTP
       protocol. Default TCP port is 80. Other ports are supported via
       "hostname:port" syntax. Note that http.stream DOES NOT perform so
      	called "percent encoding" (see RFC 3986), an application must do it
       itself if needed.


EXAMPLE
       A few examples of good HTTP stream names:

       any.host.com/files/pic4.jpg
       useful.things.net:3000/pub/archive.zip
       www.morphzone.org
       localhost/~user7/


http.stream/MMA_StreamPosBytes

NAME
       MMA_StreamPosBytes (V50) [..G.Q], UQUAD*


FUNCTION
       Returns current stream pointer in bytes.


NOTES
       64-bit attribute, in OM_GET pass a pointer to an UQUAD variable, in
       MMM_GetPort pass pointer to UQUAD as well or use MediaGetPort64()
       macro.


http.stream/MMA_StreamSeekable

NAME
       MMA_StreamSeekable (V50) [..G.Q], BOOL


FUNCTION
       Returns TRUE if the stream is seekable, FALSE otherwise. Newly 
       created objects return TRUE, as seeking is tried with "Range" and 
       "Content-Range" features of HTTP. If seeking fails the first time, it
       is remembered and then object returns FALSE.


NOTES
       Seeking in HTTP object is done by disconnecting and sending another
       request. That is why seeking is not immediate and may take time. Seek
       operation may also fail more often than for example in file streams.


http.stream/MMA_TaskPriority

NAME
       MMA_TaskPriority (V50) [ISG..], BYTE


FUNCTION
       Priority of object's network subtask. Defaults to 0.


NOTES
       Do not change without a reason.


http.stream/MMM_Http_GetHeaderEntry

NAME
       MMM_Http_GetHeaderEntry -- Returns header value for given keyword.
       (V50)


SYNOPSIS
       value = (STRPTR)DoMethod(obj, MMM_Http_GetHeaderEntry,
         STRPTR keyword);


FUNCTION
       Searches parsed HTTP response header table for given keyword and
       returns a pointer to its value (read-only string).


INPUTS
       - obj, object to perform the method on.
       - keyword, a string which is matched against header field names.


RESULT
       - value, NULL-terminated string containing header field contents, or
         NULL pointer if the field is not found. Returned string is
         read-only.


http.stream/MMM_Pull

NAME
       MMM_Pull -- Reads a block of data from stream to a buffer. (V50)


SYNOPSIS
       bytes = DoMethod(obj, MMM_Pull, ULONG port, APTR buffer, ULONG
         length);


FUNCTION
       Loads specified number of bytes into a buffer starting from current
       read pointer. This method works only for streams opened in read mode.
       This method is synchronous, it means an application is in wait state
       until all required data arrive, or operation is stopped because of
       error or break signal. MMM_Pull in progress can be stopped by sending
       CTRL-C signal to the object's network task.


INPUTS
       - obj, object to perform the method on.
       - port, must be 0, as it is the only port of a http.stream object.
       - buffer, a memory buffer for read data, must be allocated with
         MediaAllocMem().
       - length, amount of data to be read in bytes.


RESULT
       - bytes, number of bytes read actually.

       Secondary error information available via MMA_ErrorCode attribute:
       - MMERR_WRONG_ARGUMENTS - port is not 0, NULL buffer.
       - MMERR_RESOURCE_MISSING - message to the subtask cannot be sent.
       - MMERR_NOT_IMPLEMENTED - pulling from write-only stream.
       - MMERR_IO_ERROR - read operation failed because of network layer
         error.


http.stream/MMM_Seek

NAME
       MMM_Seek -- Seeks in a stream to specified absolute position. (V51)


SYNOPSIS
       result = DoMethod(obj, MMM_Seek, ULONG port, ULONG type,
       UQUAD *position);


FUNCTION
       Seeks in a stream to specified absolute position. Seeking in HTTP
       stream is done by reconnecting and sending another request with
       "Range" field. Note that it takes time and do not success always.
       Always check method return value and be prepared for FALSE.


INPUTS
       - obj, object to perform the method on.
       - port, always 0, as it is the only port in a http.stream object.
       - type, MMM_SEEK_BYTES.
       - position, pointer to UQUAD variable containing desired position in
         the file.


RESULT
       - result, boolean.
       Secondary error information available via MMA_ErrorCode attribute:
       - MMERR_WRONG_ARGUMENTS - port is not 0, seek position out of LONG
         range.
       - MMERR_RESOURCE_MISSING - message to the subtask cannot be sent.
       - MMERR_SEEK_ERROR - seeking failed (reconnection problem, or server
         does not support ranges).


