TABLE OF CONTENTS
0001 audiopcm.decoder/background
0002 audiopcm.decoder/MMA_StreamPosFrames
0003 audiopcm.decoder/MMA_StreamPosTime
0004 audiopcm.decoder/MMM_Pull
audiopcm.decoder/background

DESCRIPTION
  This class is a Reggae decoder for decoding common PCM audio formats. Its
  job is sample width reduction/expansion, endianness change or conversion
  from/to floating point format. All conversions are AltiVec accelerated
  (available on G4 machines), giving speedups of 120 to 150% for integer
  formats, 200 to 400% if floating point is involved. An audiopcm.decoder
  object has one input (port 0) and one output (port 1). The input accepts
  following formats (all formats are with interleaved channels):

  - MMF_AUDIO_PCM8, 8-bit signed integers,
  - MMF_AUDIO_PCM8U, 8-bit unsigned integers,
  - MMF_AUDIO_PCM16BE, 16-bit signed integers, big endian,
  - MMF_AUDIO_PCM16LE, 16-bit signed integers, low endian,
  - MMF_AUDIO_PCM24BE, 24-bit signed integers (packed), big endian,
  - MMF_AUDIO_PCM24LE, 24-bit signed integers (packed), low endian,
  - MMF_AUDIO_PCM32BE, 32-bit signed integers, big endian,
  - MMF_AUDIO_PCM32LE, 32-bit signed integers, low endian,
  - MMF_AUDIO_PCMF32LE, single precision IEEE floats, normalized to (-1.0,
    +1.0) range, low endian,
  - MMF_AUDIO_PCMF32BE, single precision IEEE floats, normalized to (-1.0,
    +1.0) range, big endian.
     
  and aliases:

  - MMFC_AUDIO_INT16 (alias to MMF_AUDIO_PCM16BE),
  - MMFC_AUDIO_INT32 (alias to MMF_AUDIO_PCM32BE),
  - MMFC_AUDIO_FLOAT32 (alias to MMF_AUDIO_PCMF32BE). 

  On the output an object can produce following formats:

  - MMFC_AUDIO_INT16, 16-bit signed interegs,
  - MMFC_AUDIO_INT32, 32-bit signed integers,
  - MMFC_AUDIO_FLOAT32, 32-bit single precision floats, normalized to (-1.0,
    +1.0) range.

  Input aliases allow for using audiopcm.decoder object as a converter
  between common sound formats (all possible conversions).


NEW ATTRIBUTES
   Attributes applicability:
     I - may be set at creation time.
     S - may be set on an existing object.
     G - may be get from an object.
     P - may be set for an object's port.
     Q - may be queried from an object's port.

   MMA_StreamPosFrames      (V51) [..G.Q], UQUAD*
   MMA_StreamPosTime        (V51) [..G.Q], UQUAD*


NEW METHODS
   MMM_Pull(port, buffer, length)  (V50)


HISTORY
   51.4 (22.02.2007)
   - Added scalar conversions from MMFC_AUDIO_FLOAT32 to MMFC_AUDIO_INT16
     and to MMFC_AUDIO_INT32.


audiopcm.decoder/MMA_StreamPosFrames

NAME
   MMA_StreamPosFrames (V51) [..G.Q], UQUAD*


FUNCTION
   Returns current absolute stream position in sample frames. It is exactly
   the number of the whole sample frames pulled from object's output. As
   audiopcm.decoder object has no information about sound channels, it
   queries the object connected to the input of MMA_Sound_Channels with
   MMM_GetPortFwd() method.


NOTES
   This is a 64-bit attribute passed by pointer to UQUAD variable, not by
   value.


audiopcm.decoder/MMA_StreamPosTime

NAME
   MMA_StreamPosTime (V51) [..G.Q], UQUAD*


FUNCTION
   Returns absolute stream time position in microseconds. This time position
   is strictly based on MMA_Sound_SampleRate, and reflects only the whole
   sample frames already pulled from the object output. The exact formula
   is:

   time_pos = whole_frames_pulled / MMA_Sound_SampleRate

   The class queries the object connected to the object's input about
   MMA_Sound_SampleRate and MMA_Sound_Channels with MMM_GetPortFwd() method.


NOTES
   This is a 64-bit attribute passed by pointer to UQUAD variable, not by
   value.

   Returned time is not in any way related to playback time for two reasons:
   firstly, there can be an unknown number of buffers between the decoder
   and the output, secondly, playback samplerate may be different than those
   specified in the stream header.


audiopcm.decoder/MMM_Pull

NAME
   MMM_Pull (V50)


SYNOPSIS
   bytes = DoMethod(obj, MMM_Pull, ULONG port, APTR buffer, ULONG length);


FUNCTION
   Places required amount of sound common format data (in bytes) in the
   specified buffer. The method calculates how many bytes it must pull from
   the previous object, to get required amount of output. Then data are
   pulled, converted and placed in the buffer. Note that requested number
   of bytes should be a multiply of sample frame size (for example 8 bytes
   for stereo sound if MMFC_INT32 is set as output format). If it is not, it
   will be rounded down to the nearest sample frame boundary, left bytes are
   undefined.


INPUTS
   - obj, object to perform the method on.
   - port, number of port is always 1 (the output port).
   - buffer, a memory buffer for pulled data, must be aligned to 16-byte
     boundary (preferrably allocated with MediaAllocMem()).
   - length, amount of pulled data in bytes. Will be rounded down to the
     nearest sample frame boundary.


RESULT
   - bytes, number of bytes pulled actually.


NOTES
   In two cases of conversion (MMF_AUDIO_PCM16BE -> MMFC_AUDIO_INT16 and
   MMF_AUDIO_PCM32BE -> MMFC_AUDIO_INT32) the conversion is a no-op. The
   class detects those cases and just passes pull request through, avoiding
   redundant data copying.


