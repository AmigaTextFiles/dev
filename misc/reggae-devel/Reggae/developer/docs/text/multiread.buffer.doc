TABLE OF CONTENTS
0001 multiread.buffer/background
0002 multiread.buffer/MMM_Peek
0003 multiread.buffer/MMM_Restore
0004 multiread.buffer/MMM_Seek
multiread.buffer/background

DESCRIPTION
       The class makes it possible to read the same data from a stream
       multiple times (it is called peeking data). While this functionality
       is easy to achieve for backward seekable streams, for sequential
       access streams data buffering is required. The multiread.buffer
       performs all needed buffering. The three methods related to peeking
       feature are MMM_Peek, MMM_Restore, MMM_Pull and MMM_Seek. These
       methods interacts in the following way:
       1. The stream of data (output port) has associated two data
          pointers: read pointer and peek pointer. Both are set to 0 at
          object creation.
       2. Read pointer can never be greater than peek pointer.
       3. Advancing peek pointer copies data to the buffer, advancing read
          pointer throws read data out of the buffer.
       4. MMM_Peek advances peek pointer and does not touch read pointer.
       5. MMM_Pull advances read pointer and may advance peek pointer too,
          to fulfill rule 2. Some internal buffers may be discarded to
          fulfill rule 3.
       6. MMM_Restore moves peek pointer back to be equal to read pointer,
          but data buffers are not discarded, so following MMM_Peek or
          MMM_Pull will read buffered data again.
       7. MMM_Seek sets both read and peek pointer to the seek position. All
          buffered data are flushed.


NEW METHODS
       MMM_Peek(port, buffer, length)            (V50)
       MMM_Restore(port)                         (V50)
       MMM_Seek(port, type, position)            (V51)


multiread.buffer/MMM_Peek

NAME
       MMM_Peek -- Reads a data block from a port and buffers it internally.
         (V50)


SYNOPSIS
       ULONG DoMethod(Object *obj, MMM_Peek, ULONG port, APTR buffer, ULONG
         length);


FUNCTION
       The method reads a block of data of given length from a port of
       specified object starting from current peek pointer position. Data
       may be read from output ports only. It works similarly to MMM_Pull
       except of data are also copied to an internal buffer. Peek pointer is
       advanced, read pointer is not moved.


INPUTS
       obj - object to perform method on.
       port - number of port to peek data from, must be 1 (output port).
       buffer - address of buffer for peeked data.
       length - number of bytes to peek.


RESULT
       Number of bytes read from port. MMA_ErrorCode contains secondary
       error information:
       - MMERR_WRONG_ARGUMENTS - buffer is NULL, or port is not 1.


multiread.buffer/MMM_Restore

NAME
       MMM_Restore -- Moves stream peeking position back, without clearing
         data buffers. (V50)


SYNOPSIS
       void DoMethod(Object *obj, MMM_Restore);


FUNCTION
       Moves back stream peek pointer to stream read pointer position
       without discarding peek buffers. Following MMM_Pull or MMM_Peek will
       fetch data from buffers.


INPUTS
       obj - object to perform method on.


RESULT
       None


SEE ALSO
       MMM_Peek


multiread.buffer/MMM_Seek

NAME
       MMM_Seek -- Moves stream pointer to a specified position.
         (V51)


SYNOPSIS
       ULONG DoMethod(Object *obj, MMM_Seek, ULONG port, ULONG type,
         UQUAD *position);


FUNCTION
       The method performs seek on the previous object in the pipeline first.
       If previous object seek is OK, all peek buffers are flushed, then both
       peek and read pointer are set to the new position. This way following
       peek or read operation will start at specified stream position. If the
       previous connected object refuses seek operation for any reason,
       buffers and pointers are not changed. Error code from the previous
      	object is set for this object as well.


INPUTS
       obj - object to perform method on.
       port - number of port to seek, must be 1 (output port).
       type - seek type.
       position - a pointer to UQUAD variable containing new position.


RESULT
       Number of bytes read from port. MMA_ErrorCode contains secondary
       error information:
       - MMERR_WRONG_ARGUMENTS - wrong port, unknown type.
       - MMERR_NOT_SEEKABLE - the previous object refused seeking, because
         it is not seekable.
       - MMERR_END_OF_DATA - the previous object refused seeking, because
         desired position is after stream end.
       - MMERR_NOT_IMPLEMENTED - the previous object do not understand
         specified seek type (for example MMM_SEEK_FRAMES on MMF_STREAM).


