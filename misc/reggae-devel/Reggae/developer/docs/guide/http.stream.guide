@database http.stream.guide
@rem Source: class.c
@rem Generated with RoboDoc v3.1a (Jul  3 2005)
@rem RoboDoc is copyright 1994-1997 by Maverick Software Development
@node Main http.stream.guide
@{jcenter}
@{fg highlight}@{b}TABLE OF CONTENTS@{ub}@{fg text}

@{"http.stream/background             " Link "background"}
@{"http.stream/MMA_Http_AutoRedirect  " Link "MMA_Http_AutoRedirect"}
@{"http.stream/MMA_Http_Header        " Link "MMA_Http_Header"}
@{"http.stream/MMA_Http_HeaderEntries " Link "MMA_Http_HeaderEntries"}
@{"http.stream/MMA_Http_NetProcess    " Link "MMA_Http_NetProcess"}
@{"http.stream/MMA_Http_NetProcessName" Link "MMA_Http_NetProcessName"}
@{"http.stream/MMA_Http_ProxyPort     " Link "MMA_Http_ProxyPort"}
@{"http.stream/MMA_Http_ProxyServer   " Link "MMA_Http_ProxyServer"}
@{"http.stream/MMA_Http_Response      " Link "MMA_Http_Response"}
@{"http.stream/MMA_Http_UserAgent     " Link "MMA_Http_UserAgent"}
@{"http.stream/MMA_StreamLength       " Link "MMA_StreamLength"}
@{"http.stream/MMA_StreamMode         " Link "MMA_StreamMode"}
@{"http.stream/MMA_StreamName         " Link "MMA_StreamName"}
@{"http.stream/MMA_StreamPosBytes     " Link "MMA_StreamPosBytes"}
@{"http.stream/MMA_StreamSeekable     " Link "MMA_StreamSeekable"}
@{"http.stream/MMA_TaskPriority       " Link "MMA_TaskPriority"}
@{"http.stream/MMM_Http_GetHeaderEntry" Link "MMM_Http_GetHeaderEntry"}
@{"http.stream/MMM_Pull               " Link "MMM_Pull"}
@{"http.stream/MMM_Seek               " Link "MMM_Seek"}
@{jleft}
@endnode
@Node "background" "http.stream/background"
@{fg shine}http.stream/background@{fg text}

@{b}DESCRIPTION@{ub}
       The class provides Reggae API for data accessible on the Internet
       via HTTP/1.1 protocol. Every object of http.stream class creates a
       separate task. The task is acessing files using TCP/IP stack with
       bsdsocket.library interface. A http.stream object can be safely
       shared between tasks (all operations are semaphore protected) with
       one important exception: object must be disposed by the task which
       created it. An object has only one input port (number 0). Port
       format is MMF_STREAM.

       Object construction failure reasons

       @{"MMA_ErrorCode" Link "multimedia.class.guide/MMA_ErrorCode"} == MMERR_WRONG_ARGUMENTS:
       - no @{"MMA_StreamName" Link "MMA_StreamName"} specified.
       - unknown or not supported @{"MMA_StreamMode" Link "MMA_StreamMode"} specified.
       - specified MMA_TaskPriotity out of <-128, +127> range.

       @{"MMA_ErrorCode" Link "multimedia.class.guide/MMA_ErrorCode"} == MMERR_OUT_OF_MEMORY:
       - no memory for name string copy.

       @{"MMA_ErrorCode" Link "multimedia.class.guide/MMA_ErrorCode"} = MMERR_RESOURCE_MISSING:
       - message port creation failed.
       - subprocess creation failed.
       - no multimedia.class.
       - no bsdsocket.library.
       - no dos.library.

       @{"MMA_ErrorCode" Link "multimedia.class.guide/MMA_ErrorCode"} == MMERR_NO_STREAM:
       - specified stream cannot be opened.


@{b}NEW ATTRIBUTES@{ub}
       Attributes applicability:
         I - may be set at creation time.
         S - may be set on an existing object.
         G - may be get from an object.
         P - may be set for an object's port.
         Q - may be queried from an object's port.

       @{"MMA_StreamLength" Link "MMA_StreamLength"}        (V50) [..G.Q], UQUAD*
       @{"MMA_TaskPriority" Link "MMA_TaskPriority"}        (V50) [ISG..], BYTE, optional on init
       @{"MMA_StreamName" Link "MMA_StreamName"}          (V50) [I.G.Q], STRPTR, required on init
       @{"MMA_StreamMode" Link "MMA_StreamMode"}          (V50) [I.G.Q], ULONG, optional on init
       @{"MMA_StreamSeekable" Link "MMA_StreamSeekable"}      (V50) [..G.Q], BOOL
       @{"MMA_ErrorCode" Link "multimedia.class.guide/MMA_ErrorCode"}           (V51) [ISG..], ULONG, optional on init
       @{"MMA_StreamPosBytes" Link "MMA_StreamPosBytes"}      (V51) [..G.Q], UQUAD*
       @{"MMA_Http_Response" Link "MMA_Http_Response"}       (V51) [..G.Q], STRPTR
       @{"MMA_Http_Header" Link "MMA_Http_Header"}         (V51) [..G.Q], STRPTR*
       @{"MMA_Http_HeaderEntries" Link "MMA_Http_HeaderEntries"}  (V51) [..G.Q], ULONG
       @{"MMA_Http_NetProcess" Link "MMA_Http_NetProcess"}     (V51) [..G..], struct Process*
       @{"MMA_Http_NetProcessName" Link "MMA_Http_NetProcessName"} (V51) [I.G..], STRPTR, optional on init
       @{"MMA_Http_UserAgent" Link "MMA_Http_UserAgent"}      (V51) [I....], STRPTR, optional on init
       @{"MMA_Http_ProxyServer" Link "MMA_Http_ProxyServer"}    (V51) [I....], STRPTR, optional on init
       @{"MMA_Http_ProxyPort" Link "MMA_Http_ProxyPort"}      (V51) [I....], ULONG, optional on init
       @{"MMA_Http_AutoRedirect" Link "MMA_Http_AutoRedirect"}   (V51) [I....], BOOL, optional on init


@{b}NEW METHODS@{ub}
       @{"MMM_Pull" Link "MMM_Pull"}(port, buffer, length)      (V50)
       @{"MMM_Seek" Link "MMM_Seek"}(port, type, position)      (V50)
       @{"MMM_Http_GetHeaderEntry" Link "MMM_Http_GetHeaderEntry"}(entry)      (V51)


@{b}NOTES@{ub}
       MMA_StreamHandle is not supported for HTTP streams.


@endnode
@Node "MMA_Http_AutoRedirect" "http.stream/MMA_Http_AutoRedirect"
@{fg shine}http.stream/MMA_Http_AutoRedirect@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_AutoRedirect@{ub} (V51) [I....], BOOL


@{b}FUNCTION@{ub}
       If TRUE, instructs the object to automatically follow redirection
       responses (30x) from the server instead of reporting error and 
       failing in OM_NEW. If this tag is set to TRUE, and server responds
       with 30x code, the header is searched for "Location" field. If this
       field is found, its contents is used as a new target and the request
       is resent. If there is no "Location" for 30x response, OM_NEW will
       fail. Default value for this tag is TRUE.


@endnode
@Node "MMA_Http_Header" "http.stream/MMA_Http_Header"
@{fg shine}http.stream/MMA_Http_Header@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_Header@{ub} (V51) [..G.Q], STRPTR*


@{b}FUNCTION@{ub}
       This attribte gives access to the complete HTTP response header. The
       header is already parsed and returned as keyword-value pairs. The
       returned value is an address of table of pointers to stings. The
       first string (index 0) is the first keyword, the second one (index 1)
       is the value of this keyword. The third element (index 2) is the
       second keyword and so on. The table is terminated by NULL pointer.
       The header is parsed according to RFC 2616 including multiline
       fields, they are converted to single strings.


@{b}NOTES@{ub}
       The first line of the response, returned by @{"MMA_Http_Response" Link "MMA_Http_Response"} is not
       included in the table returned by @{b}MMA_Http_Header@{ub}.


@{b}SEE ALSO@{ub}
       @{"MMA_Http_HeaderEntries" Link "MMA_Http_HeaderEntries"}, @{"MMA_Http_Response" Link "MMA_Http_Response"}


@endnode
@Node "MMA_Http_HeaderEntries" "http.stream/MMA_Http_HeaderEntries"
@{fg shine}http.stream/MMA_Http_HeaderEntries@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_HeaderEntries@{ub} (V51) [..G.Q], ULONG


@{b}FUNCTION@{ub}
       Number of entries returned by @{"MMA_Http_Header" Link "MMA_Http_Header"}. The first line of
       header is not counted here, as it is retured separately by
       @{"MMA_Http_Response" Link "MMA_Http_Response"}. The NULL element placed as the last table entry is
       not counted as well.


@endnode
@Node "MMA_Http_NetProcess" "http.stream/MMA_Http_NetProcess"
@{fg shine}http.stream/MMA_Http_NetProcess@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_NetProcess@{ub} (V51) [..G..], struct Process*


@{b}FUNCTION@{ub}
       The attribute returns a pointer to the Process structure of network
       subprocess of a http.stream object. It can be used to send CTRL-C
       signal to the process to break network operation. Note that you
       cannot break network operations in OM_NEW this way, use
       @{"MMA_Http_NetProcessName" Link "MMA_Http_NetProcessName"} for this.


@endnode
@Node "MMA_Http_NetProcessName" "http.stream/MMA_Http_NetProcessName"
@{fg shine}http.stream/MMA_Http_NetProcessName@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_NetProcessName@{ub} (V51) [I.G..], STRPTR


@{b}FUNCTION@{ub}
       This attribute specifies or returns the name of the network
       subprocess created by an object. The subprocess performs some network
       operations in OM_NEW, like name resolving, estabilishing a connection
       and sending request. As an application cannot get @{"MMA_Http_NetProcess" Link "MMA_Http_NetProcess"}
       attribute until the object is created, there is no way to break
       mentioned network operations. @{b}MMA_Http_NetProcessName@{ub} allows
       application to specify network process name, then the process can be
       found with FindTask(), and application can sent CTRL-C signal while
       the object is still in OM_NEW. Of course the application must be
       multithreaded to be able to do this (one thread creates object,
       another sends signal).


@endnode
@Node "MMA_Http_ProxyPort" "http.stream/MMA_Http_ProxyPort"
@{fg shine}http.stream/MMA_Http_ProxyPort@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_ProxyPort@{ub} (V51) [I....], ULONG


@{b}FUNCTION@{ub}
       Specifies a port, which proxy is connected on. If proxy is not
       specified, this attribute is ignored. The default value for this tag
       is 8080 (usual port for HTTP proxies).


@{b}SEE ALSO@{ub}
       @{"MMA_Http_ProxyServer" Link "MMA_Http_ProxyServer"}


@endnode
@Node "MMA_Http_ProxyServer" "http.stream/MMA_Http_ProxyServer"
@{fg shine}http.stream/MMA_Http_ProxyServer@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_ProxyServer@{ub} (V51) [I....], STRPTR


@{b}FUNCTION@{ub}
       If not NULL, this attribute instructs http.stream object to connect
       to the destination host not directly, but via specified HTTP proxy.
       The default value for this tag is NULL (no proxy).


@{b}SEE ALSO@{ub}
       @{"MMA_Http_ProxyPort" Link "MMA_Http_ProxyPort"}


@endnode
@Node "MMA_Http_Response" "http.stream/MMA_Http_Response"
@{fg shine}http.stream/MMA_Http_Response@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_Response@{ub} (V51) [..G.Q], STRPTR


@{b}FUNCTION@{ub}
       Returns a read-only string containing the first line of HTTP response
       header. This line consists of HTTP version supported by server, three
       digit result code and textual result description, for example:

       HTTP/1.1 200 OK

       or

       HTTP/1.1 404 Not Found

       An application can analyse this line, inform user and take
       appropriate action. For list of result codes see HTTP protocol
       specification (RFC 2616).


@endnode
@Node "MMA_Http_UserAgent" "http.stream/MMA_Http_UserAgent"
@{fg shine}http.stream/MMA_Http_UserAgent@{fg text}

@{b}NAME@{ub}
       @{b}MMA_Http_UserAgent@{ub} (V51) [I....], STRPTR


@{b}FUNCTION@{ub}
       Allows application for identifying itself in HTTP 'User-Agent' header
       field. Note that string passed does not form the field contents
       alone. A string "/http.stream-xx.xx(MorphOS)" is appended to the one
       passed, where 'xx' are replaced by actual version of http.stream
       class. So for example if an application specifies:

       SuperNetMumboJumbo-6.2

       the complete 'User-Agent' field will be:

       SuperNetMumboJumbo-6.2/http.stream-51.1(MorphOS)

       The default value for this attribute is "unknown".


@{b}NOTES@{ub}
       Supplied string must conform RFC 2616. It must not contain newlines.


@endnode
@Node "MMA_StreamLength" "http.stream/MMA_StreamLength"
@{fg shine}http.stream/MMA_StreamLength@{fg text}

@{b}NAME@{ub}
       @{b}MMA_StreamLength@{ub} (V50) [..G.Q], UQUAD*


@{b}FUNCTION@{ub}
       Returns stream length in bytes. If "Content-Length" field is found in
       the response header, it is used as stream length. If not found, zero
       is returned. It can happen if either server is not HTTP/1.1
       compilant, or server uses chunked transfer. Zero means unknown
       length.


@{b}NOTES@{ub}
       64-bit attribute, in OM_GET pass a pointer to an UQUAD variable, in
       @{"MMM_GetPort" Link "multimedia.class.guide/MMM_GetPort"} pass pointer to UQUAD as well or use MediaGetPort64()
       macro.


@endnode
@Node "MMA_StreamMode" "http.stream/MMA_StreamMode"
@{fg shine}http.stream/MMA_StreamMode@{fg text}

@{b}NAME@{ub}
       @{b}MMA_StreamMode@{ub} (V50) [I.G.Q], ULONG


@{b}FUNCTION@{ub}
       Stream access mode. The only supported mode is MMA_StreamMode_Read
       (read only stream). As it is also the default value, this tag can be
       safely ommited at OM_NEW.


@endnode
@Node "MMA_StreamName" "http.stream/MMA_StreamName"
@{fg shine}http.stream/MMA_StreamName@{fg text}

@{b}NAME@{ub}
       @{b}MMA_StreamName@{ub} (V50) [I.G.Q], STRPTR


@{b}FUNCTION@{ub}
       Name of http.stream is URL to the resource, but without leading
       "http://". It is not needed, as http.stream supports only HTTP
       protocol. Default TCP port is 80. Other ports are supported via
       "hostname:port" syntax. Note that http.stream DOES NOT perform so
        called "percent encoding" (see RFC 3986), an application must do it
       itself if needed.


@{b}EXAMPLE@{ub}
       A few examples of good HTTP stream names:

       any.host.com/files/pic4.jpg
       useful.things.net:3000/pub/archive.zip
       www.morphzone.org
       localhost/~user7/


@endnode
@Node "MMA_StreamPosBytes" "http.stream/MMA_StreamPosBytes"
@{fg shine}http.stream/MMA_StreamPosBytes@{fg text}

@{b}NAME@{ub}
       @{b}MMA_StreamPosBytes@{ub} (V50) [..G.Q], UQUAD*


@{b}FUNCTION@{ub}
       Returns current stream pointer in bytes.


@{b}NOTES@{ub}
       64-bit attribute, in OM_GET pass a pointer to an UQUAD variable, in
       @{"MMM_GetPort" Link "multimedia.class.guide/MMM_GetPort"} pass pointer to UQUAD as well or use MediaGetPort64()
       macro.


@endnode
@Node "MMA_StreamSeekable" "http.stream/MMA_StreamSeekable"
@{fg shine}http.stream/MMA_StreamSeekable@{fg text}

@{b}NAME@{ub}
       @{b}MMA_StreamSeekable@{ub} (V50) [..G.Q], BOOL


@{b}FUNCTION@{ub}
       Returns TRUE if the stream is seekable, FALSE otherwise. Newly 
       created objects return TRUE, as seeking is tried with "Range" and 
       "Content-Range" features of HTTP. If seeking fails the first time, it
       is remembered and then object returns FALSE.


@{b}NOTES@{ub}
       Seeking in HTTP object is done by disconnecting and sending another
       request. That is why seeking is not immediate and may take time. Seek
       operation may also fail more often than for example in file streams.


@endnode
@Node "MMA_TaskPriority" "http.stream/MMA_TaskPriority"
@{fg shine}http.stream/MMA_TaskPriority@{fg text}

@{b}NAME@{ub}
       @{b}MMA_TaskPriority@{ub} (V50) [ISG..], BYTE


@{b}FUNCTION@{ub}
       Priority of object's network subtask. Defaults to 0.


@{b}NOTES@{ub}
       Do not change without a reason.


@endnode
@Node "MMM_Http_GetHeaderEntry" "http.stream/MMM_Http_GetHeaderEntry"
@{fg shine}http.stream/MMM_Http_GetHeaderEntry@{fg text}

@{b}NAME@{ub}
       @{b}MMM_Http_GetHeaderEntry@{ub} -- Returns header value for given keyword.
       (V50)


@{b}SYNOPSIS@{ub}
       value = (STRPTR)DoMethod(obj, @{b}MMM_Http_GetHeaderEntry@{ub},
         STRPTR keyword);


@{b}FUNCTION@{ub}
       Searches parsed HTTP response header table for given keyword and
       returns a pointer to its value (read-only string).


@{b}INPUTS@{ub}
       - obj, object to perform the method on.
       - keyword, a string which is matched against header field names.


@{b}RESULT@{ub}
       - value, NULL-terminated string containing header field contents, or
         NULL pointer if the field is not found. Returned string is
         read-only.


@endnode
@Node "MMM_Pull" "http.stream/MMM_Pull"
@{fg shine}http.stream/MMM_Pull@{fg text}

@{b}NAME@{ub}
       @{b}MMM_Pull@{ub} -- Reads a block of data from stream to a buffer. (V50)


@{b}SYNOPSIS@{ub}
       bytes = DoMethod(obj, @{b}MMM_Pull@{ub}, ULONG port, APTR buffer, ULONG
         length);


@{b}FUNCTION@{ub}
       Loads specified number of bytes into a buffer starting from current
       read pointer. This method works only for streams opened in read mode.
       This method is synchronous, it means an application is in wait state
       until all required data arrive, or operation is stopped because of
       error or break signal. @{b}MMM_Pull@{ub} in progress can be stopped by sending
       CTRL-C signal to the object's network task.


@{b}INPUTS@{ub}
       - obj, object to perform the method on.
       - port, must be 0, as it is the only port of a http.stream object.
       - buffer, a memory buffer for read data, must be allocated with
         MediaAllocMem().
       - length, amount of data to be read in bytes.


@{b}RESULT@{ub}
       - bytes, number of bytes read actually.

       Secondary error information available via @{"MMA_ErrorCode" Link "multimedia.class.guide/MMA_ErrorCode"} attribute:
       - MMERR_WRONG_ARGUMENTS - port is not 0, NULL buffer.
       - MMERR_RESOURCE_MISSING - message to the subtask cannot be sent.
       - MMERR_NOT_IMPLEMENTED - pulling from write-only stream.
       - MMERR_IO_ERROR - read operation failed because of network layer
         error.


@endnode
@Node "MMM_Seek" "http.stream/MMM_Seek"
@{fg shine}http.stream/MMM_Seek@{fg text}

@{b}NAME@{ub}
       @{b}MMM_Seek@{ub} -- Seeks in a stream to specified absolute position. (V51)


@{b}SYNOPSIS@{ub}
       result = DoMethod(obj, @{b}MMM_Seek@{ub}, ULONG port, ULONG type,
       UQUAD *position);


@{b}FUNCTION@{ub}
       Seeks in a stream to specified absolute position. Seeking in HTTP
       stream is done by reconnecting and sending another request with
       "Range" field. Note that it takes time and do not success always.
       Always check method return value and be prepared for FALSE.


@{b}INPUTS@{ub}
       - obj, object to perform the method on.
       - port, always 0, as it is the only port in a http.stream object.
       - type, MMM_SEEK_BYTES.
       - position, pointer to UQUAD variable containing desired position in
         the file.


@{b}RESULT@{ub}
       - result, boolean.
       Secondary error information available via @{"MMA_ErrorCode" Link "multimedia.class.guide/MMA_ErrorCode"} attribute:
       - MMERR_WRONG_ARGUMENTS - port is not 0, seek position out of LONG
         range.
       - MMERR_RESOURCE_MISSING - message to the subtask cannot be sent.
       - MMERR_SEEK_ERROR - seeking failed (reconnection problem, or server
         does not support ranges).


@endnode

