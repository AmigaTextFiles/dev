#
# $PROJECT: rexxxref.library
#
# $VER: makefile 1.1 (08.01.95)
#
# by Stefan Ruppert
#
# (C) Copyright 1995
#

NAME     = rexxxref
SHNAME   = rxref
SUFFIX   = .library
COPYRIGHT= "Copyright by Stefan Ruppert (C) 1994"
REVFILE  = $(NAME)$(SUFFIX).rev

LIBS     = LIBS:$(NAME)$(SUFFIX)
RLIBS    = //libs/$(NAME)$(SUFFIX)

#
# docs and guides
#

AUTODOCS     = //doc/english/$(NAME).doc
GUIDE        = //help/autodoc/$(NAME)
GUIDEDIR     = //help/autodoc

#
# source
#

PROTO    = protos.h
SRCS     = rexxxref.asm rexxxref.c rexxcmdparser.c findxref.c expungexref.c \
           loadxref.c endcode.asm
OBJ      = rexxxrefa.o rexxxrefc.o rexxcmdparser.o findxref.o expungexref.o \
           loadxref.o endcode.o

#
# object dirs and files
#

OD       = otmp:$(SHNAME)
ODD      = $(OD)/db
ODR      = $(OD)/rls

OBJS     = $(OBJ:"*":"$(ODD)/*")
ROBJS    = $(OBJ:"*":"$(ODR)/*")

#
# SAS definition
#

DEBUG    = DEBUG=LINE DEFINE=DEBUG
SDEBUG   = NODEBUG
SCOPTS   = VERBOSE NOSTKCHK
OPTIMIZE = OPT OPTTIME
LIB      = lib:amiga.lib lib:sc.lib

#
# dirs to create
#

DIRCREATE= $(OD) $(ODD) $(ODR)

all: $(DIRCREATE) $(PROTO) $(OBJS) $(LIBS)

$(PROTO) : $(SRCS)
   mkproto %(right) TO %(left)

$(OBJS) : $(SRCS)
   sc $(DEBUG) $(SCOPTS) %(right) OBJNAME %(left)

$(LIBS) : $(OBJS)
   slink from %(right) to %(left) noicons verbose smalldata smallcode \
         LIB $(LIB) lib:debug.lib

#
# dependencies
#

$(ODD)/rexxxref.o : $(REVFILE)

$(ODR)/rexxxref.a : $(REVFILE)

#
# release entry point
#

release: $(DIRCREATE) $(ROBJS) $(RLIBS) $(AUTODOCS) $(GUIDE)

$(ROBJS) : $(SRCS)
   sc $(SCOPTS) OPT OPTTIME %(right:"*.asm":"ASM *.asm") %(right:"*.c":"CSRC *.c") \
      OBJNAME %(left)

$(RLIBS) : $(ROBJS)
   slink from %(right) to %(left) ND NOICONS VERBOSE SMALLDATA SMALLCODE \
         LIB $(LIB)
  copy %(left) to sys:classes/datatypes/$(NAME)$(SUFFIX)

#
# make autodoc for the library
#

autodocs: $(AUTODOCS)

$(AUTODOCS) :: $(SRCS)
   makedoc %(right) AUTODOC %(left) BEGIN "/**LL******" END "******" \
           SKIPSTRING "**" CONVERTCOMMENTS TOC VERBOSE

#
# convert autodoc to an amigaguide
#

$(GUIDE) : $(AUTODOCS)
   cd //doc/english
   makexref rexxxref.doc to t:rexxxref.xref category TEMP NOICON
   cd //Tools/rexx
   loadxref t:rexxxref.xref
   xrefconvert FROM %(right) TO $(GUIDEDIR) VERBOSE
   expungexref category TEMP

#
# some setups for the make
#

$(DIRCREATE) : $(DIRCREATE)
   makedir %(left)

