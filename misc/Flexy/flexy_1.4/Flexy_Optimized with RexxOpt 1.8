/*
   $VER: Flexy 1.4 (19.01.2003) Copyright (c) Hervé Dupont.

        - AWNPipe: ver 2.34 +
        - ClassAct
*/
;numver="1.4";datever="(19-01-2003)";CALL ActiveLangage();CALL Verif();CALL Init();CALL MakeGUI();do while ~eof(flipe1);call topipe('continue');in=readln(flipe1);parse var in typ gad eta ctn ctn2 .;SELECT;WHEN typ='gadget' then call Gadget();WHEN typ='iconify' then call iconify();WHEN typ='menu' then call menus(gad eta ctn);WHEN typ='key' then call clavier(gad);WHEN typ='close' then call fin();WHEN typ='askclose' then call fin();OTHERWISE;NOP;END;END;SAY "JAMAIS !! Fatal error, please repport!!";Set_Ask_Quit=0;CALL Fin();topipe:;parse arg out;call writeln(flipe1,out);res=readln(flipe1);parse var res res1 res2 .;if res1='ok' then return(res2);say 'error from: 'out;say '  responce: ' res;exit;topipe2:;parse arg out;call writeln(flipe2,out);res=readln(flipe2);parse var res res1 res2 .;if res1='ok' then return(res2);say 'error from: 'out;say '  responce: ' res;exit;iconify:;IF gad=1 THEN call topipe('id 0 s 32');ELSE call topipe('id 0 s 64');RETURN;Gadget:;IF gad=onglet then page=eta;tp1=LocaleStr(MSG_OK);tp2=LocaleStr(MSG_Win_Error);SELECT;WHEN page=0 THEN;DO;SELECT;WHEN gad=Gad_OpWarn THEN;do;Option_Warn=eta;call topipe('id 'gad_opWarn1' s='eta' page='onglet'');END;WHEN gad=Gad_OpNoop THEN;do;Option_Noopt=eta;call topipe('id 'gad_opNoop1' s='eta' page='onglet'');END;WHEN gad=Gad_OpFlush THEN;do;Option_Flush=eta;call topipe('id 'gad_opFlush1' s='eta' page='onglet'');END;WHEN gad=Gad_OpNoBip THEN Option_Nobip=eta;WHEN gad=Gad_OpQuiet THEN Option_Quiet=eta;WHEN gad=Gad_OpFill THEN Option_Fill=eta;WHEN gad=Gad_OpNospc THEN Option_Nospc=eta;WHEN gad=Gad_OpMod THEN Option_Mod=eta;WHEN gad=Gad_OpNoBuff THEN Option_NoBuff=eta;WHEN gad=Gad_OpNolang THEN Option_Nolang=eta;WHEN gad=Gad_opNew THEN Option_New=eta;WHEN gad=Gad_opOld THEN;do;Option_Old=eta;DActive_Str1=(1-eta);call topipe('id 'gad_opStr1' dis='DActive_Str1' ref page='onglet'');END;WHEN gad=Gad_opNoDate THEN Option_NoDate=eta;WHEN gad=Gad_opStr1 THEN Option_Str1=eta;OTHERWISE;NOP;END;END;WHEN page=1 THEN;DO;SELECT;WHEN gad=gad_fil.1 THEN;do;old_file_1=file.1;file.1=strip(ctn ctn2);tp3=pos('Ram Disk:',file.1);IF tp3>0 THEN file.1=delstr(file.1,tp3+3,5);call topipe('id 'gad_fil.1' fn="'STRIP(file.1,b,'"')'" ref');IF EXISTS(strip(file.1,'b','"')) THEN;do;IF Set_Clever=1&file.1 ~="" THEN Call Clever1;IF Set_AutoPath=1 THEN;do;Call Chemin(file.1);IF file.2="" THEN call topipe('id 'gad_fil.2' fn="'ChemDir'" ref');IF file.3="" THEN call topipe('id 'gad_fil.3' fn="'ChemDir'" ref');IF file.4="" THEN call topipe('id 'gad_fil.4' fn="'ChemDir'" ref');END;END;ELSE;do;str=LocaleStr(MSG_Error_File_exist2);str=left(str,POS('%s',str)-1)||Strip(file.1,'b','"')||delstr(str,1,POS('%s',str)+1);call rtezrequest(Str,tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');Call Chemin(file.1);file.1=ChemDir;call topipe('id 'gad_fil.1' fn="'file.1'" ref');END;END;WHEN gad=gad_fil.2 THEN;do;file.2=strip(ctn ctn2);tp3=pos('Ram Disk:',file.2);IF tp3>0 THEN file.2=delstr(file.2,tp3+3,5);call topipe('id 'gad_fil.2' fn="'STRIP(file.2,b,'"')'" ref');IF EXISTS(strip(file.2,'b','"'))|Fmode=0 THEN;do;IF Set_AutoPath=1 THEN;do;Call Chemin(file.2);IF file.3="" THEN call topipe('id 'gad_fil.3' fn="'ChemDir'" ref');IF file.4="" THEN call topipe('id 'gad_fil.4' fn="'ChemDir'" ref');END;END;ELSE;do;str=LocaleStr(MSG_Error_File_exist2);str=left(str,POS('%s',str)-1)||Strip(file.2,'b','"')||delstr(str,1,POS('%s',str)+1);call rtezrequest(Str,tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');Call Chemin(file.2);file.2=ChemDir;call topipe('id 'gad_fil.2' fn="'file.2'" ref');END;END;WHEN gad=gad_fil.3 THEN;do;file.3=strip(ctn ctn2);tp3=pos('Ram Disk:',file.3);IF tp3>0 THEN file.3=delstr(file.3,tp3+3,5);call topipe('id 'gad_fil.3' fn="'STRIP(file.3,b,'"')'" ref');END;WHEN gad=gad_fil.4 THEN;do;file.4=strip(ctn ctn2);tp3=pos('Ram Disk:',file.4);IF tp3>0 THEN file.4=delstr(file.4,tp3+3,5);call topipe('id 'gad_fil.4' fn="'STRIP(file.4,b,'"')'" ref');END;WHEN gad=Clever_1 THEN;do;IF LENGTH(file.1)>0 THEN;do;tp3=LastPos('.cd',file.1);old_file_2=file.2;IF tp3>0 THEN file.2=STRIP(left(file.1,tp3-1)||'.ct','b','"');ELSE file.2=STRIP(file.1,'b','"')||'.ct';IF EXISTS(file.2)|Fmode=0 THEN call topipe('id 'gad_fil.2' fn="'STRIP(file.2,b,'"')'" ref');ELSE;do;str=LocaleStr(MSG_Error_File_exist2);str=left(str,POS('%s',str)-1)||file.2||delstr(str,1,POS('%s',str)+1);call rtezrequest(str,tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');file.2=old_file_2;drop old_file_2;call topipe('id 'gad_fil.2' fn="'file.2'" ref');END;END;END;WHEN gad=Clever_2 THEN;do;IF file.2 ~="" THEN;do;tp3=LastPos('.ct',file.2);IF tp3>0 THEN;do;IF Fmode=1 THEN;do;file.3=STRIP(left(file.2,tp3-1)||'.ctN','b','"');call topipe('id 'gad_fil.3' fn="'STRIP(file.3,b,'"')'" ref');END;IF Fmode=2 THEN;do;file.4=STRIP(left(file.2,tp3-1)||'.catalog','b','"');call topipe('id 'gad_fil.4' fn="'STRIP(file.4,b,'"')'" ref');END;END;END;END;WHEN gad=Gad_Mode THEN;do;Fmode=eta;CALL Positionne();call topipe('id 'gad_opFlush1' dis='DActive_Flush' ref ');call topipe('id 'gad_opFlush' dis='DActive_Flush' page='onglet' ref ');call topipe('id 'gad_opnoop1' dis='DActive_Noopt' ref ');call topipe('id 'gad_opnoop' dis='DActive_Noopt' page='onglet' ref ');call topipe('id 'gad_fil.3' dis='DActive_Fil3' ref ');call topipe('id 'clever_2' dis='DActive_clv2' ref ');call topipe('id 'gad_fil.4' dis='DActive_Fil4' ref ');END;WHEN gad=Gad_OpWarn1 THEN;do;Option_Warn=eta;call topipe('id 'gad_opWarn' s='eta' page='onglet'');END;WHEN gad=Gad_OpNoop1 THEN;do;Option_Noopt=eta;call topipe('id 'gad_opNoop' s='eta' page='onglet'');END;WHEN gad=Gad_OpFlush1 THEN;do;Option_Flush=eta;call topipe('id 'gad_opFlush' s='eta' page='onglet'');END;WHEN gad=Gad_action THEN;do;call check_cmp();IF autorise=1 THEN call compilation();END;OTHERWISE;NOP;END;END;WHEN page=2 THEN;DO;SELECT;WHEN gad=Gad_Set1 THEN;do;Set_Clever=eta;IF Set_Clever=1 THEN;do;call topipe('id 'gad_set2' dis=1 ref');Dac_AutoPath=1;END;ELSE;do;call topipe('id 'gad_set2' dis=0 ref');Dac_AutoPath=0;END;END;WHEN gad=Gad_Set2 THEN;do;Set_AutoPath=eta;IF Set_AutoPath=1 THEN;do;call topipe('id 'gad_set1' dis=1 ref');call topipe('id 'Gad_Path' dis=1 ref');Dac_Clever=1;END;ELSE;do;call topipe('id 'gad_set1' dis=0 ref');call topipe('id 'Gad_Path' dis=0 ref');Dac_Clever=0;END;END;WHEN gad=Gad_Path THEN;do;IF length(ctn2)>0 THEN;do;ctn2=strip(ctn2,b,'"');IF right(ctn2,1)~=":" THEN ctn2=ctn2||"/";Set_Path_Str=STRIP(ctn ctn2);Set_Path_Str=STRIP(Set_Path_Str,b,'"');END;ELSE;do;ctn=strip(ctn,b,'"');IF right(ctn,1)~=":" THEN ctn=ctn||"/";Set_Path_Str=STRIP(ctn);Set_Path_Str=STRIP(Set_Path_Str,b,'"');END;call topipe('id 'Gad_Path' fn="'Set_Path_Str'" page='onglet' ref');file.1=Set_Path_Str;file.2=Set_Path_Str;file.3=Set_Path_Str;file.4=Set_Path_Str;call topipe('id 'gad_fil.1' fn="'file.1'" page='onglet' ref');call topipe('id 'gad_fil.2' fn="'file.2'" page='onglet' ref');call topipe('id 'gad_fil.3' fn="'file.3'" page='onglet' ref');call topipe('id 'gad_fil.4' fn="'file.4'" page='onglet' ref');END;WHEN gad=Gad_Set3 THEN Set_AutoLoad=eta;WHEN gad=Gad_Set4 THEN Set_Ask_Quit=eta;WHEN gad=Gad_Set5 THEN Set_Verbose=eta;WHEN gad=gad_load THEN;do;call Charge();call Actionne();END;WHEN gad=gad_save THEN call Sauve();WHEN gad=gad_fin THEN call fin();OTHERWISE;NOP;END;END;OTHERWISE;NOP;END;DROP tp3;RETURN;Clever1:;tp3=LastPos('.cd',file.1);IF tp3>0 THEN file.2=STRIP(left(file.1,tp3-1)||'.ct','b','"');ELSE file.2=STRIP(file.1,'b','"')||'.ct';IF ~EXISTS(file.2)&Fmode~=0 THEN;do;Call Chemin(file.1);file.2=ChemDir;END;call topipe('id 'gad_fil.2' fn="'STRIP(file.2,b,'"')'" ref');IF Fmode=1 THEN;do;IF tp3>0 THEN file.3=STRIP(left(file.1,tp3-1)||'.ctN','b','"');ELSE file.3=STRIP(file.1,'b','"')||'.ctN';call topipe('id 'gad_fil.3' fn="'STRIP(file.3,b,'"')'" ref');END;IF Fmode=2 THEN;do;IF tp3>0 THEN file.4=STRIP(left(file.1,tp3-1)||'.catalog','b','"');ELSE file.4=STRIP(file.1,'b','"')||'.catalog';call topipe('id 'gad_fil.4' fn="'STRIP(file.4,b,'"')'" ref');END;DROP tp3;RETURN;Menus:;PARSE ARG menu item1 item2;IF menu=0 THEN;do;if item1=0 THEN;do;call topipe('id 0 s 256');call InfoWin();do while ~eof(flipe2);call topipe2('continue');line=readln(flipe2);parse var line in1 in2 in3;IF in1="key"&(in2=196|in2=197) THEN break;NOP;end;call close(flipe2);call topipe('id 0 s 512');END;if item1=1 THEN call fin();END;IF menu=1 THEN;do;IF item1=0 THEN;do;Call Charge();CALL Actionne();END;IF item1=1 THEN call Sauve();END;RETURN;Clavier:;PARSE ARG touche;IF touche=197 THEN call fin();RETURN;Check_cmp:;autorise=1;tp1=LocaleStr(MSG_OK);tp2=LocaleStr(MSG_Win_Error);If file.1="" THEN;do;call rtezrequest(LocaleStr(MSG_Error_File1),tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');autorise=0;END;ELSE;do;IF ~EXISTS(strip(file.1,'b','"')) THEN;do;str=LocaleStr(MSG_Error_File_exist);str=left(str,POS('%s',str)-1)||file.1||delstr(str,1,POS('%s',str)+1);tp_pos=POS('\n',str);IF tp_pos>0 THEN str=left(str,tp_pos-1)||'0a'X||delstr(str,1,tp_pos+1);call rtezrequest(str,tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');autorise=0;END;END;If file.2="" THEN;do;call rtezrequest(LocaleStr(MSG_Error_File2),tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');autorise=0;END;ELSE;do;IF ~EXISTS(strip(file.2,'b','"'))&Fmode=1 THEN;do;str=LocaleStr(MSG_Error_File_exist);str=left(str,POS('%s',str)-1)||file.2||delstr(str,1,POS('%s',str)+1);tp_pos=POS('\n',str);IF tp_pos>0 THEN str=left(str,tp_pos-1)||'0a'X||delstr(str,1,tp_pos+1);call rtezrequest(str,tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');autorise=0;END;END;If file.3=""&Fmode=1 THEN;do;call rtezrequest(LocaleStr(MSG_Error_File3),tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');autorise=0;END;If file.4=""&Fmode=2 THEN;do;call rtezrequest(LocaleStr(MSG_Error_File4),tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');autorise=0;END;RETURN;Compilation:;cmd="";SELECT;When Fmode=0 THEN;do;Source=file.1;target=file.2;end;When Fmode=1 THEN;do;Source=file.1 file.2;target=file.3;end;When Fmode=2 THEN;do;Source=file.1 file.2;target=file.4;end;OTHERWISE;NOP;END;cmd='Flexcat ' Source progmode.Fmode target;if Option_Warn=1 then cmd=cmd 'WARNCTGAPS';IF Fmode=2 THEN;do;if Option_Noopt=1 then cmd=cmd 'NOOPTIM';if Option_Flush=1 then cmd=cmd 'FLUSH';END;if Option_Nobip=1 then cmd=cmd 'NOBEEP';if Option_Quiet=1 then cmd=cmd 'QUIET';if Option_Fill=1 then cmd=cmd 'FILL';if Option_Nospc=1 then cmd=cmd 'NOSPACE';if Option_Mod=1 then cmd=cmd 'MODIFIED';if Option_NoBuff=1 then cmd=cmd 'NOBUFFEREDIO';if Option_Nolang=1 then cmd=cmd 'NOLANGTOLOWER';if Option_NoDate=1 then cmd=cmd 'NOAUTODATE';if Option_New=1 then cmd=cmd 'COPYMSGNEW';IF Fmode ~=2 THEN;do;if Option_Old=1 then cmd=cmd 'OLDMSGNEW='||Option_Str1;END;IF Set_Verbose=1 THEN;DO;cmd=cmd ' >ram:Flex_error';END;call topipe('id 0 s 256');ADDRESS COMMAND cmd;call topipe('id 0 s 512');RETURN;Fin:;IF Set_Ask_Quit=1 THEN;do;tp1=LocaleStr(MSG_Request_YN);tp2=" Flexy...";Ret=rtezrequest(LocaleStr(MSG_Request_Quit),tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext rtez_defaultresponse=0');END;IF (Ret=1)|(Set_Ask_Quit=0) THEN;do;IF SHOW('LIBRARIES','locale.library') THEN;do;CALL CLOSECATALOG(catalog);remlib('locale.library');remlib('flexy.catalog');END;IF SHOW('LIBRARIES','rexxreqtools.library') THEN remlib('rexxreqtools.library');CALL close(flipe1);EXIT;END;RETURN;MakeGUI:;call open(flipe1,"awnpipe:FLEXY1/xc");call topipe(' title="'LocaleStr(MSG_Win_Title)'" st="Flexy V 'numver' (c) 1999-2003 - Seahorse Production 21" ig ii="flexy_app" it="Flexy" cg askclose v dg db a cs m sk');call topipe(' menu gt "'LocaleStr(MSG_MenuT_Project)' |'LocaleStr(MSG_Menu_About)' |'LocaleStr(MSG_Menu_Quit)'"');menu2=topipe(' menu gt "'LocaleStr(MSG_MenuT_Prefs)' |'LocaleStr(MSG_Menu_4)'|'LocaleStr(MSG_Menu_5)'"');call topipe(' layout b=0  so');onglet=topipe('clicktab ctl "'localestr(MSG_Win_P1)'|'localestr(MSG_Win_P2)'|'LocaleStr(MSG_Win_P3)'"');call topipe(' layout b=3 v so si page='onglet 'selected=1');call topipe(' layout b=3 si so e cj weih=25');gad_opWarn=topipe('checkbox gt "WARN CT GAPS" s='Option_Warn'');gad_opNoop=topipe('checkbox gt "NO OPTIM" s='Option_Noopt' dis='DActive_Noopt'');gad_opFlush=topipe('checkbox gt "FLUSH" s='Option_Flush' dis='DActive_Flush'');call topipe('le');call topipe(' layout b=0 noms si e weih=20');gad_opNoBip=topipe('checkbox gt "NO BEEP " s='Option_Nobip'');gad_opQuiet=topipe('checkbox gt "QUIET" s='Option_Quiet'');gad_opFill=topipe('checkbox gt "FILL" s='Option_Fill'');call topipe('le');call topipe(' layout b=0 noms si e weih=20');gad_opNospc=topipe('checkbox gt "NO SPACE" s='Option_Nospc'');gad_opMod=topipe('checkbox gt "MODIFIED" s='Option_Mod'');gad_opNobuff=topipe('checkbox gt "NO BUFFER IO" s='Option_NoBuff'');call topipe('le');call topipe(' layout b=0  si  weih=20');gad_opNolang=topipe('checkbox gt "NO LANG TO LOWER" s='Option_NoLang'');gad_opNoDate=topipe('checkbox gt "NO AUTO DATE" s='Option_NoDate'');gad_opNil=topipe('checkbox gt="" dis=1 s=0');call topipe(' le');call topipe(' layout b=0  si ');gad_opNew=topipe('checkbox gt "COPY MSG NEW  " s='Option_New'');gad_opOld=topipe('checkbox gt="OLD MSG NEW" s='Option_Old'');call topipe(' label  gt "" ua');gad_opStr1=topipe('string lj tc minc=9 gt="'Option_Str1'" dis='DActive_Str1' chl');call topipe(' le');call topipe('le');call topipe('layout b 3 v so si page='onglet 'selected=1');call topipe('layout b 1 v so gt="'localestr(MSG_Lbl_fichier)'" ');call topipe('layout b=0 ');call topipe('label  gt "'localestr(MSG_Lbl_description)'" ua');gad_fil.1=topipe('getfile gt="'localestr(MSG_Req_cd)'" fn="'Set_Path_Str'" i weiw=20 chl');clever_1=topipe('button ab=6 weiw=0');call topipe('le');call topipe('layout b=0 ');call topipe(' label  gt "'localestr(MSG_Lbl_traduction)'" ua');gad_fil.2=topipe('getfile gt="'localestr(MSG_Req_ct)'" fn="'Set_Path_Str'" i weiw=20 chl');clever_2=topipe('button ab=6 weiw=0 dis='DActive_clv2'');call topipe('le');call topipe(' label  gt "'localestr(MSG_Lbl_traduction2)'" ua');gad_fil.3=topipe('getfile gt="'localestr(MSG_Req_ct)'" fn="'Set_Path_Str'" i weiw=20 chl dis='DActive_Fil3'');call topipe(' label  gt "'localestr(MSG_Lbl_catalogue)'" ua');gad_fil.4=topipe('getfile gt="'localestr(MSG_Req_cat)'" fn="'Set_Path_Str'" i weiw=20 chl dis='DActive_Fil4'');call topipe(' le');call topipe('layout b=0 so');call topipe('label b=0 weiw=30 ');call topipe('label gt "'localestr(MSG_Bt_Mode)' " ua');gad_mode=topipe('chooser pu s='Fmode'  cl="'localestr(MSG_Bt_Mode1)'|'localestr(MSG_Bt_Mode2)'|'localestr(MSG_Bt_Mode3)'" chl');call topipe(' le');call topipe(' layout b=0  si');gad_opWarn1=topipe('checkbox gt "WARN CT GAPS" s='Option_Warn'');gad_opNoop1=topipe('checkbox gt "NO OPTIM" s='Option_Noopt' dis='DActive_Noopt'');gad_opFlush1=topipe('checkbox gt "FLUSH" s='Option_Flush' dis='DActive_Flush'');call topipe(' le');call topipe(' layout b=0 so');gad_action=topipe('button b=2 gt "'LocaleStr(MSG_Bt_Action)'" ');call topipe(' le');call topipe(' le');call topipe(' layout b=3 v si so page='onglet 'selected=1');call topipe(' layout b=1 v so si  gt="'localestr(MSG_Lbl_Auto)'" ');gad_Set1=topipe('checkbox gt "'localestr(MSG_Lbl_Clever)'" s='Set_Clever' dis='Dac_Clever'');gad_set2=topipe('checkbox gt "'localestr(MSG_Lbl_AutPath)'" s='Set_AutoPath' dis='Dac_AutoPath'');call topipe(' label  gt "'localestr(MSG_Path)'" ua');Gad_Path=topipe('getfile gt="'localestr(MSG_Path)'" fn="'Set_Path_Str'" dr chl dis=0');call topipe('le');call topipe(' layout b=1 v so si  ');call topipe(' layout b=0 noms si  weih=20');gad_set3=topipe('checkbox gt "'localestr(MSG_Lbl_AutoLoad)'  " s='Set_AutoLoad' ');gad_set5=topipe('checkbox gt "'localestr(MSG_Lbl_Verbose)'" s='Set_Verbose' ');call topipe('le');call topipe(' layout b=0 noms si  weih=20');gad_set4=topipe('checkbox gt "'localestr(MSG_Request_Ask)'" s='Set_Ask_Quit' ');call topipe('le');call topipe('le');call topipe('layout b=0 si e so weih=26');gad_load=topipe('button gt 'localestr(MSG_Menu_4)' dis='Dac_Chargement' ');call topipe('label b=0 weiw=65 ');call topipe('label b=0 weiw=65 ');gad_save=topipe('button gt 'localestr(MSG_Menu_5)' weih=26 ');call topipe('le');call topipe('layout b=5 si so');gad_fin=topipe('button b=9 gt 'localestr(MSG_Quit)'');call topipe('le');call topipe('le');call topipe("open");IF Dac_chargement=1 THEN call topipe('id 'menu2' tar=0 dis=1');ELSE call topipe('id 'menu2' tar=0 dis=0');RETURN;InfoWin:;call open(flipe2,"awnpipe:FLEXY2/xc");call topipe2('title="'LocaleStr(MSG_Win_Info)'" st="Flexy V 'numver' (c) 2003 - Seahorse Production 21" v cg dg db so si a cs m sk');call topipe2('layout v so si b=5');Tmp1=STRIP(LocaleStr(MSG_Version));Tmp2=UPPER(LEFT(Tmp1,1))||RIGHT(Tmp1,LENGTH(Tmp1)-1);textInfo="*n--==****  Flexy  ****==--*n*n";textInfo=textInfo||Tmp2 numver datever "*n";textInfo=textInfo||LocaleStr(MSG_CopyRight)||" Seahorse Production 21*nHervé Dupont <herve.dpt@free.fr>";textInfo=textInfo||"*n-----------------*n"LocaleStr(MSG_Info);call topipe2('label gt "'textInfo'" ');call topipe2('le');call topipe2('layout b=0 cj so si ');gad2_Ok=topipe2('button b=2 si gt "'LocaleStr(MSG_OK)'" c');call topipe2('le');call topipe2("open");DROP Tmp1 Tmp2;RETURN;Message:;PARSE ARG TextInfo;call open(flipe2,"awnpipe:FLEXY2/xc");call topipe2('title="'LocaleStr(MSG_Win_Error)'" st="Flexy V 'numver' (c) 2003 - Seahorse Production 21" v cg dg db so si a cs m sk');call topipe2('layout b=5 v so si cj');call topipe2('label gt "'TextInfo'" ');call topipe2('le');call topipe2('layout b=0 cj so si');gad2_Ok=topipe2('button b=2 si gt "'LocaleStr(MSG_OK)'" c');call topipe2('le');call topipe2("open");DROP TextInfo;RETURN;ListeWin:;call open(flipe2,"awnpipe:FLEXY2/xc");call topipe2('title="'LocaleStr(MSG_Win_Info)'" left=0 top=80 width=640 height=100 st="Flexy V 'numver' (c) 2003 - Seahorse Production 21" v cg dg db sg a  m');call topipe2('layout v b=0 ');call topipe2('layout b=0 so');scrl2=call topipe2('Listbrowser  a h v ');call topipe2('le');call topipe2('layout b=0 cj so weih=20');call topipe2('button b=0 ro gt "" weiw=80 weih=20');gad2_Ok=topipe2('button b=2 weih=20 gt "'LocaleStr(MSG_OK)'" c');call topipe2('button b=0 ro gt "" weiw=80 weih=20');call topipe2('le');call topipe2('le');call topipe2("open");RETURN;ActiveLangage:;PARSE SOURCE . . . progdir .;booll=LENGTH(progdir);booli=LASTPOS(":",progdir);boolh=LASTPOS("/",progdir);IF boolh>booli THEN progdir=SUBSTR(progdir,1,boolh-1);IF boolh==0 THEN progdir=SUBSTR(progdir,1,booli);IF RIGHT(progdir,1) ~=':' THEN progdir2=progdir||'/';ELSE progdir2=progdir;CALL PRAGMA('D',progdir);CALL InitLangage();IF ~SHOW('LIBRARIES','locale.library') THEN;CALL ADDLIB('locale.library',0,-30,0);IF SHOW('LIBRARIES','locale.library') THEN;DO;id='req'pragma('id');address command 'rxset' id '`echo $language`';language=getclip(id);call setclip(id,'');IF language ~='' THEN;DO;catalog=OPENCATALOG(progdir2'catalogs/'language'/Flexy.catalog','english',0);IF catalog=0 THEN;catalog=OPENCATALOG(progdir2'Flexy.catalog','english',0);END;IF catalog=0 THEN;catalog=OPENCATALOG('Flexy.catalog','english',0);END;RETURN;LocaleStr:;PARSE ARG stringnumber;IF catalog ~=0 THEN;RETURN(GETCATALOGSTR(catalog,stringnumber,strings.stringnumber));ELSE;RETURN(strings.stringnumber);Chemin:;PARSE ARG nomtp;nomtp=STRIP(nomtp,'b','"');rac=POS('"',nomtp);racine=LASTPOS(":",nomtp);chem=LASTPOS("/",nomtp);IF chem>racine THEN ChemDir=LEFT(nomtp,chem);IF chem==0 THEN ChemDir=LEFT(nomtp,racine);CALL PRAGMA('D',ChemDir);DROP nomtp;RETURN;Verif:;LibOk=0;IF ~EXISTS('L:awnpipe-handler') then;do;IF EXISTS('LIBS:rexxreqtools.library') THEN;do;IF ~SHOW('LIBRARIES','rexxreqtools.library') THEN;do;IF ADDLIB('rexxreqtools.library',10,-30,0) THEN LibOk=1;END;END;IF LibOK=1 THEN;do;call rtezrequest(LocaleStr(MSG_Error_awnp),LocaleStr(MSG_OK),LocaleStr(MSG_Win_Error),'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');END;ELSE;do;OPEN('con',"con:60/80/520/60/"LocaleStr(MSG_Win_Error)"/wait/close");WriteLn('con','0a'X '0a'X"             " LocaleStr(MSG_Error_awnp));WriteLn(STDOUT,'0a'X '0a'X"             " LocaleStr(MSG_Error_awnp));END;Set_Ask_Quit=0;CALL Fin();END;LibOk=0;IF ~SHOW('LIBRARIES','rexxreqtools.library') THEN;do;IF EXISTS('LIBS:rexxreqtools.library') THEN;do;IF ADDLIB('rexxreqtools.library',10,-30,0) THEN LibOk=1;END;If LibOk=0 THEN;do;CALL Message(LocaleStr(MSG_Error_1));do while ~eof(flipe2);call topipe2('continue');line=readln(flipe2);parse var line in1 in2 .;IF in1="key"&(in2=196|in2=197) THEN break;NOP;end;call close(flipe2);Set_Ask_Quit=0;CALL Fin();END;END;test=open(test,"awnpipe:testver/-02034/xc");IF test=0 then;do;tp1=LocaleStr(MSG_OK);tp2=LocaleStr(MSG_Win_Error);call rtezrequest(LocaleStr(MSG_Er_Ver_Awnp),tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');close(test);Set_Ask_Quit=0;CALL Fin();END;close(test);RETURN;InitLangage:;MSG_OK=0;MSG_Win_Title=1;MSG_Win_P1=2;MSG_Win_P2=3;MSG_Win_P3=4;MSG_MenuT_Project=5;MSG_Menu_About=6;MSG_Menu_Quit=7;MSG_Menu_1=8;MSG_Menu_2=9;MSG_MenuT_Prefs=10;MSG_Menu_4=11;MSG_Menu_5=12;MSG_Menu_6=13;MSG_Menu_7=14;MSG_Request_Quit=15;MSG_Request_YN=16;MSG_Request_Ask=17;MSG_Quit=18;MSG_Nil_1=19;MSG_Bt_Action=20;MSG_Bt_Mode=21;MSG_Bt_Mode1=22;MSG_Bt_Mode2=23;MSG_Bt_Mode3=24;MSG_Bt_Mode4=25;MSG_Lbl_Fichier=26;MSG_Lbl_Description=27;MSG_Lbl_Traduction=28;MSG_Lbl_Traduction2=29;MSG_Lbl_Catalogue=30;MSG_Req_cd=31;MSG_Req_ct=32;MSG_Req_cat=33;MSG_Lbl_Auto=34;MSG_Lbl_AutPath=35;MSG_Lbl_Clever=36;MSG_Lbl_AutoLoad=37;MSG_Lbl_Verbose=38;MSG_Flex_Msg=39;MSG_VERSION=40;MSG_Win_Info=41;MSG_Info=42;MSG_Win_Error=43;MSG_Er_Ver_Awnp=44;MSG_Error_Awnp=45;MSG_Error_1=46;MSG_Error_File1=47;MSG_Error_File2=48;MSG_Error_File3=49;MSG_Error_File4=50;MSG_Error_File_Exist=51;MSG_Error_File_Exist2=52;MSG_CopyRight=53;MSG_Error_Conf_File=54;MSG_Msg_fic=55;MSG_Msg_win=56;MSG_Path=57;strings.0="_OK";strings.1="  - Flexy - The FlexCat interface";strings.2="_Options";strings.3="_Commands";strings.4="_Settings";strings.5="Project";strings.6="@?About";strings.7="@QQuit";strings.8="nil";strings.9="nil";strings.10="Settings";strings.11="Load";strings.12="Save";strings.13="nil";strings.14="nil";strings.15="Are you sure you want to quit?";strings.16="Yes|No";strings.17="Ask before to quit";strings.18="Quit";strings.19="nil";strings.20="Com_pile";strings.21="_Mode:";strings.22="Make translation";strings.23="Update translation";strings.24="Make catalog";strings.25="..";strings.26="Files";strings.27="Description:";strings.28="Translation:";strings.29="Updated .ct:";strings.30="    Catalog:";strings.31="`.cd' file";strings.32="`.ct' file";strings.33="`.catalog' file";strings.34="Automatic settings";strings.35="Add path in fields";strings.36="Clever mode (names)";strings.37="Load settings at launch";strings.38="Create log file for Flexcat messages";strings.39="Flexcat's messages";strings.40="version";strings.41="Informations";strings.42="Created with AwnPipe by William H. M. Parker";strings.43="Flexy: Error message";strings.44="AWNPipe Version 2.34+ requiered";strings.45="Please install AWNPipe v2.34+ !";strings.46="Cant Find <RexxReqtools.library>. Please Install...";strings.47="You need to give a description file!";strings.48="You need to give a translation file!";strings.49="You need to give a second translation file!";strings.50="You need to give a catalog file!";strings.51="You need to give a valid name!\nThe file %s doesn't exists.";strings.52="File '%s' not found.";strings.53="Copyright";strings.54="Config file is wrong or obsolete!\nUse 'Save' button to overwrite it.";strings.55="Display messages in window";strings.56="Copy messages to file";strings.57="Default path:";RETURN;Init:;progname="Flexcat";progmode.0="NEWCTFILE";progmode.1="NEWCTFILE";progmode.2="CATALOG";cmd="";Page=1;Fmode=2;DActive_Flush=0;DActive_Noopt=0;DActive_Old=1;DActive_Fil3=1;DActive_Fil4=0;DActive_clv2=0;Option_Warn=1;Option_Noopt=1;Option_Flush=1;Option_Nobip=0;Option_Quiet=0;Option_Fill=0;Option_Nospc=0;Option_Mod=0;Option_NoBuff=0;Option_Nolang=0;Option_NoDate=1;Option_New=0;Option_Old=0;Option_Str1="";Set_Path_Str="";File.1="";File.2="";File.3="";File.4="";Dac_AutoPath=1;Dac_Clever=0;Dac_Chargement=1;Set_AutoPath=0;Set_Clever=1;Set_AutoLoad=0;Set_Ask_Quit=1;Set_Verbose=0;IF exists('S:Flexy.config') THEN;do;open(pref,'S:Flexy.config','R');tmp=readln(pref);IF LEFT(tmp,2) ~='bF' THEN;do;tp1=LocaleStr(MSG_OK);tp2=LocaleStr(MSG_Win_Error);str=LocaleStr(MSG_Error_Conf_File);tp_pos=POS('\n',str);IF tp_pos>0 THEN str=left(str,tp_pos-1)||'0a'X||delstr(str,1,tp_pos+1);call rtezrequest(Str,tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');close(pref);Dac_Chargement=1;END;ELSE;do;Set_AutoLoad=readch(pref,1);close(pref);Dac_Chargement=0;END;END;If Set_AutoLoad ~=0 THEN CALL Charge();CALL Positionne();Drop tmp;RETURN;Positionne:;progmode=progmode.Fmode;SELECT;When Fmode=0 THEN;do;DActive_Flush=1;DActive_NoOpt=1;DActive_Old=0;DActive_Fil3=1;DActive_Fil4=1;DActive_clv2=1;end;When Fmode=1 THEN;do;DActive_Flush=1;DActive_NoOpt=1;DActive_Old=0;DActive_Fil3=0;DActive_Fil4=1;DActive_clv2=0;end;When Fmode=2 THEN;do;DActive_Flush=0;DActive_NoOpt=0;DActive_Old=1;DActive_Fil3=1;DActive_Fil4=0;DActive_clv2=0;end;OTHERWISE;NOP;END;IF Option_Old=0 THEN DActive_Str1=1;ELSE DActive_Str1=0;RETURN;Actionne:;call topipe('id 'gad_opWarn' s='Option_Warn' page='onglet' ref');call topipe('id 'gad_opNoop' s='Option_Noopt' dis='DActive_Noopt' page='onglet' ref');call topipe('id 'gad_opFlush' s='Option_Flush' dis='DActive_Flush' page='onglet'  ref');call topipe('id 'gad_opNoBip' s='Option_Nobip' page='onglet' ref');call topipe('id 'gad_opQuiet' s='Option_Quiet' page='onglet' ref');call topipe('id 'gad_opFill'  s='Option_Fill'  page='onglet' ref');call topipe('id 'gad_opNospc'  s='Option_Nospc' page='onglet' ref');call topipe('id 'gad_opMod'    s='Option_Mod'   page='onglet' ref');call topipe('id 'gad_opNobuff' s='Option_NoBuff' page='onglet' ref');call topipe('id 'gad_opNolang' s='Option_NoLang' page='onglet' ref');call topipe('id 'gad_opNoDate' s='Option_NoDate' page='onglet' ref');call topipe('id 'gad_opNew' s='Option_New' page='onglet' ref');call topipe('id 'gad_opOld' s='Option_Old' page='onglet' ref');call topipe('id 'gad_opStr1' gt="'Option_Str1'" dis='DActive_Str1' page='onglet' ref');call topipe('id 'gad_fil.1' fn="'Set_Path_Str'" page='onglet' ref');call topipe('id 'gad_fil.2' fn="'Set_Path_Str'" page='onglet' ref');call topipe('id 'gad_fil.3' dis='DActive_Fil3' fn="'Set_Path_Str'" page='onglet' ref ');call topipe('id 'gad_fil.4' dis='DActive_Fil4' fn="'Set_Path_Str'" page='onglet' ref ');call topipe('id 'clever_2' dis='DActive_clv2' page='onglet' ref ');call topipe('id 'gad_opWarn1' s='Option_Warn' page='onglet' ref');call topipe('id 'gad_opNoop1' s='Option_Noopt' dis='DActive_Noopt' page='onglet' ref');call topipe('id 'gad_opFlush1' s='Option_Flush' dis='DActive_Flush' page='onglet'  ref');call topipe('id 'gad_mode'  s='Fmode' page='onglet' ref');call topipe('id 'gad_set1' s='Set_Clever' dis='Dac_Clever' page='onglet' ref');call topipe('id 'gad_set2' s='Set_AutoPath' dis='Dac_AutoPath' page='onglet' ref');call topipe('id 'Gad_Path' fn="'Set_Path_Str'" dis='Dac_Clever' page='onglet' ref');call topipe('id 'gad_set3' s='Set_AutoLoad' page='onglet' ref');call topipe('id 'gad_set4' s='Set_Ask_Quit' page='onglet' ref');call topipe('id 'gad_set5' s='Set_Verbose'  page='onglet' ref');RETURN;Charge:;IF exists('S:Flexy.config') THEN;do;call open(pref,'S:Flexy.config','R');tmp=readln(pref);IF LEFT(tmp,2) ~='bF' THEN;do;tp1=LocaleStr(MSG_OK);tp2=LocaleStr(MSG_Win_Error);str=LocaleStr(MSG_Error_Conf_File);tp_pos=POS('\n',str);IF tp_pos>0 THEN str=left(str,tp_pos-1)||'0a'X||delstr(str,1,tp_pos+1);call rtezrequest(Str,tp1,tp2,'rt_reqpos=reqpos_centerscr rtez_flags=ezreqf_centertext');close(pref);Dac_Chargement=1;drop tmp;END;ELSE;do;Set_AutoLoad=readch(pref,1);Fmode=readch(pref,1);DActive_Flush=readch(pref,1);DActive_Noopt=readch(pref,1);DActive_Old=readch(pref,1);DActive_Fil3=readch(pref,1);DActive_Fil4=readch(pref,1);DActive_clv2=readch(pref,1);Option_Warn=readch(pref,1);Option_Noopt=readch(pref,1);Option_Flush=readch(pref,1);Option_Nobip=readch(pref,1);Option_Quiet=readch(pref,1);Option_Fill=readch(pref,1);Option_Nospc=readch(pref,1);Option_Mod=readch(pref,1);Option_NoBuff=readch(pref,1);Option_Nolang=readch(pref,1);Option_NoDate=readch(pref,1);Option_New=readch(pref,1);Option_Old=readch(pref,1);DActive_Str1=readch(pref,1);Option_Str1=readln(pref);Dac_AutoPath=readch(pref,1);Dac_Clever=readch(pref,1);Set_AutoPath=readch(pref,1);Set_Clever=readch(pref,1);Set_Ask_Quit=readch(pref,1);Set_Verbose=readch(pref,1);Set_Path_Str=readln(pref);call close(pref);END;END;ELSE;do;nop;END;RETURN;Sauve:;call topipe('id 0 s 256');open(pref,'S:Flexy.config','W');writeln(pref,'bFlexy_1.4');writech(pref,Set_AutoLoad);writech(pref,Fmode);writech(pref, DActive_Flush);writech(pref, DActive_Noopt);writech(pref, DActive_Old);writech(pref, DActive_Fil3);writech(pref, DActive_Fil4);writech(pref, DActive_clv2);writech(pref,Option_Warn);writech(pref,Option_Noopt);writech(pref,Option_Flush);writech(pref,Option_Nobip);writech(pref,Option_Quiet);writech(pref,Option_Fill);writech(pref,Option_Nospc);writech(pref,Option_Mod);writech(pref,Option_NoBuff);writech(pref,Option_Nolang);writech(pref,Option_NoDate);writech(pref,Option_New);writech(pref,Option_Old);writech(pref, DActive_Str1);writeln(pref,Option_Str1);writech(pref, Dac_AutoPath);writech(pref, Dac_Clever);writech(pref,Set_AutoPath);writech(pref,Set_Clever);writech(pref,Set_Ask_Quit);writech(pref,Set_Verbose);writeln(pref,Set_Path_Str);close(pref);call topipe('id 0 s 512');IF exists('S:Flexy.config') THEN Dac_Chargement=0;IF Dac_chargement=1 THEN call topipe('id 'menu2' tar=0 dis=1');ELSE call topipe('id 'menu2' tar=0 dis=0');call topipe('id 'gad_load' page='onglet' dis='Dac_Chargement' ref');RETURN