SerialManager Version 1.1 - AREXX Microserver (ARexx NOT Required)

     SerialManager is a standalone program to handle communications over the
Amiga's serial port.  This enables your CanDo application to communicate with
external hardware such as a laserdisc player, video equipment, another
computer, and anything else that can receive and/or send text messages
through a serial port connection.
     SerialManager version 1.1 includes new commands and options to allow a
wider range of controls, including single character communication; ASCII,
HEX, or DECIMAL modes of sending and receiving messages from the
SerialManager; control of the SerialManager's internal buffer size, and more.
 A description of the newest command can be found at the end of this
documentation.
     SerialManager must be run from a CLI or Shell, or from CanDo's DOS
command.  The form of this command is as follows:

     SerialManager -l{listento} -t{talkto} -u{unit} -d{devicename} -p{prefix}

where:

     {listento} is the name of the ARexx port that SerialManager creates and
listens to for its commands.  To speak to the SerialManager, your CanDo
application must specify this name using the script command "SpeakTo"
described on page 6-58 of the CanDo HowTo Book.  The default {listento} port
is "Serial#0" where 0 is the selected {unit}.

     {talkto} is the name of the ARexx port to which SerialManager sends
incoming text from the serial port.  To get messages from the SerialManager,
your CanDo application must specify this name using the script command
"ListenTo" as described on page 6-59 of the CanDo HowTo Book.

     {unit} is the unit number of the serial port to use.  This defaults to
0, the internal serial port.  This only needs to be set if you are using a
serial port other than the built-in Amiga Serial Port.  To use more than one
unit, run a SerialManager for each unit used.

     {devicename} is the name of the serial device.  This defaults to
serial.device.  If using the built-in Amiga serial device, this does not need
to be specified; however, this option will allow you to use custom serial
drivers.  As with the {unit} option, if you are using more than one serial
port, you can run a separate SerialManager for each port.

     {prefix} is the AREXX command which the SerialManager sends to the
{talkto} port to indicate incoming text.  To receive original messages from
the SerialManager, create an ARexx Object, described on page 4-39 of the
CanDo HowTo Book, and set the "Message To Wait For" Field to the same name as
the {prefix}.  You can then write a script to occur when any messages come in
from the SerialManager.  The message will be found in the system variable
"TheMessage" described on page 6-59 in the CanDo HowTo Book.  This prefix can
be changed at any time within your application by sending the SerialManager a
SetPrefix message described below, so do not feel trapped into using just a
single {prefix} or ARexx Object, though only one may be used by the
SerialManager at any given time.  An example of starting the SerialManager
from within CanDo looks as follows:

     ListenTo "MyEar"
     SpeakTo "Serial#0"
     IfError
        Dos "run >NIL: <NIL: PATH:SerialManager -tMyEar -pHello"
        Let TimeOut = 50   ; MAX timeout
        Loop
           Delay 0,0,10
           SpeakTo "Serial#0"
           IfError
             Let FoundSerialPort = FALSE
           Else
             Let FoundSerialPort = TRUE
           EndIf
           Let TimeOut = TimeOut - 1
        Until FoundSerialPort OR (TimeOut = 0)
     Else
        Let FoundSerialPort = TRUE
     EndIf
     If FoundSerialPort
        nop ; Do whatever you need to do to set up your application further.
     Else
        Quit
     EndIf

This first line specifies that our application will be listening to a port
called "MyEar".  The second line sets the port we will SpeakTo, and will
cause an error if the default {listento} port, "Serial#0", does not exist.
 If we get the error, we run the SerialManager, finding it in the PATH:
directory, using all the defaults except "MyEar" as the {talkto} and "Hello"
as the {prefix}.  We then attempt to SpeakTo "Serial#0", until it is found,
or until a timeout count goes to zero.
  To receive messages to our ListenTo port, we must also establish an ARexx
Object to wait for "Hello" messages.  We can now send messages to
SerialManager, described below, and receive messages from SerialManager from
within ARexx Objects.  An example ARexx Object Script in CanDo is as follows:

     Let Incoming = TheMessage   ;Get message sent to MyEar with given Prefix
     Print Incoming,10,10          ; and print it to our window at 10,10

This script could also have been written:

     Print TheMessage,10,10

which prints all incoming messages to the graphics screen.  A better approach
would be to use Documents.

NOTE:  The SerialManager must be started with a "run" command as this script
demonstrates; the application will stall if "run" is not used.

ARexx Commands Understood By SerialManager:

The following commands can be sent to the SerialManager by using the CanDo
script command "SendMessage" as described on page 6-59 of the CanDo HowTo
Book.  An example script for sending a text out the serial port looks as
follows:

     SendMessage "Send Hello!",NORESULT

The message "Hello!" will be received by the system you are communicating
with over the serial port.  NORESULT must be specified if you do not expect
an immediate, one line response.  If you do expect such a response, then the
following will work:

     SendMessage "Send What is your name?"
     If MessageErrorCode = 0                 ;0 indicates no error.
          Let Name = MessageReturned
     Else
          Let Name = "NoName"
     EndIf

If all was successful, then the variable "Name" will contain the name
returned by the system with which you are communicating.

The commands are as follows:

     Send {text}  --  tells SerialManager to send the {text} out the serial
port.  See the SetByteMode command below for the various forms which the text
can take.

     SetTalkTo {portname} -- tells SerialManager to send incoming messages to
a different port.  You will also want to change your applications ListenTo.

     SetPrefix {prefix} -- tells SerialManager to change the prefix of all
incoming messages.  This prefix will correspond to the expected message of
one of your applications ARexx Objects, as described above.

     SetConfig {as in F8N1{baud}} -- tells SerialManager the configuration of
the serial.device.  The first character is either F, for full duplex, or H,
for Half duplex.  The second character is the number of bits in the write
word (1-8).  The third character is the parity N = None, E=Even, O=Odd. The
fourth character is the number of stop bits.  And the rest of the line is the
Baud rate.  Example:  SendMessage "SetConfig H7E21200" will set Half duplex,
7 bit word, event parity, 2 stop bits, and 1200 baud.  If you wish to change
any of these options without affecting the others, just use a * character to
replace the character.  For example, using SetConfig ****2400 will only
change the baud rate; SetConfig F will set Full duplex and nothing else;
SetConfig **O will set ODD parity.

     SetCRMode {On,Off}  -- this option allows you to specify the means by
which SerialManager will detect the end of line.  If On is specified, then
all incoming messages will be detected by a Carriage Return character, and
all messages sent out to the serial device will have a Carriage Return added
to them.  If Off is specified then a NULL character, a 0, will indicate the
end of a line of text.  Refer to the documentation of the system you are
communicating with as to the means by which they indicate an end of line.

     SetHandshaking {XON,DTR,NONE}  --  This allows you to specify the
handshaking protocol which SerialManager will use when communicating with
another system.  XON will select XON/XOFF protocol.  NONE will select no
protocol, and DTR will select DTR/RTS protocol.  Refer to the documentation
of the system you are communicating with to determine which protocol is
necessary.  XON/XOFF is the default.  NOTE :  DTR works by setting 7Wire mode
and turning XON/XOFF off.

     Quit -- Tells the SerialManager to shut down.  Do not send messages
after this command is used.

     Abort -- Use when SerialManager hangs on replying to a message from your
application.  This command only works in that case and it must be sent by an
external program, as your main program will be stalled waiting on the reply.

New Commands in Version 1.1
===========================

     QueryLexicon  -- replies a list of the commands which SerialManager
understands, with each line separated by a line feed.  The reply can be
entered into a document by a single Type instruction.
       
     SetAutoEOLMode {ON,OFF}  --  Turn on or off the end of line detect in
SerialManager.  The device you are speaking with no longer has to send a CR
or NULL for you to get a reply.  When SetAutoEOLMode is off, SerialManager
waits for its internal buffer to fill and then replies to your message.  Be
sure that the internal buffer will get filled by setting it to the
appropriate size.  See the SetBufferSize below.

     SetBufferSize {Number} -- Sets the size of the buffer used internally by
the SerialManager.  To allow transmissions of one character at a time, set
the buffer size to 1, and SetAutoEOLMode OFF.  Then, do not set NORESULTS

     SetByteMode {Decimal,Hex,Character} -- allows you to specify in what
form you wish to send and receive messages from the SerialManager.  For some
application hex codes are used as instructions.  To do this you would merely
SetByteMode HEX, and then use the Send command as follows:

  SendMessage "SetByteMode HEX"
  SendMessage "Send 0A 3E 00"

Which would send the three hex bytes 0A 3E 00 out the serial port.  This
command defaults to CHARACTER mode, which is for regular text transmissions.

     SetEOLCharacter {Number} -- like the SetCRMode command, this command
allows you to designate the character you wish the SerialManager to use to
indicate and detect End of lines in serial transmissions.  An example of
setting it to detect line feeds is as follows:
 
  SendMessage "SetEOLCharacter 10"

The number 10 is the ASCII code for the line feed character.  This character
is only used if the SetAutoEOLMode is ON, which is its default setting.

     Version -- Returns a string specifying the version of the SerialManager
currently running.
