(*
(* :Program.    WBuild.mod
** :Contents.   increases build number
** :Author.     Bert Jahn
** :EMail.      jah@pub.th-zwickau.de
** :Address.    Franz-Liszt-Straﬂe 16, Rudolstadt, 07404, Germany
** :History.    0.1 16.06.98
** :Copyright.  Public Domain
** :Language.   Oberon
** :Translator. Amiga Oberon 3.11 (Includes 40.15)
*)
*)

MODULE WBuild;

IMPORT
  SYS  := SYSTEM,
  conv := Conversions,
  d    := Dos,
  fs   := FileSystem;

CONST
  version  = "$VER: WBuild V0.1 (16.06.98) by Bert Jahn";
  defbuildfile = ".build";

VAR
  buffer  : ARRAY 256 OF CHAR; (* the comment *)
  build   : LONGINT;
  file    : fs.File;
  bool    : BOOLEAN;


(* main *)
BEGIN
  SYS.SETREG(8,SYS.ADR(version));    (* that the version string will linked *)
  IF d.base.lib.version < 37 THEN
    HALT(20);
  ELSE
    IF fs.Open(file,defbuildfile,FALSE) THEN
      IF fs.ReadString(file,buffer) THEN
        bool := conv.StringToInt(buffer,build);
      END;
      bool := fs.Close(file);
    END;
    INC(build);
    conv.IntToStringLeft(build,buffer);
    IF fs.Open(file,defbuildfile,TRUE) THEN
      bool := fs.WriteString(file,buffer);
      bool := fs.Close(file);
    END;
    d.PrintF("%ld",build);
  END
END WBuild.

