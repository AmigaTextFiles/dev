<HTML>
<HEAD>
<TITLE>Pouívání resload_Protect#?</TITLE>
<meta name="DC.Language" content="cz">
<meta http-equiv="content-language" content="cz">
<meta http-equiv="content-type" content="text/html; charset=windows-1250">
<!-- $Id: prot.html 1.3 2004/01/16 06:32:49 wepl Exp wepl $ -->
</HEAD>
<BODY>
<h3>Pouívání resload_Protect#?</h3>
<h4>Teorie</h4>
Vyskytnou se rùzné situace, ve kterıch se mùe hodit bıt informován o pøístupech
nainstalovaného programu do urèitıch oblastí pamìti. S pomocí funkcí <a href="../../Autodoc/whdload.doc">resload_Protect#?</a>
je moné chránit urèité oblasti pamìti pøed ètením anebo zapisovaním procesorem.
Chránit znamená, e kadı pøístup do tatko chránìné oblasti vyvolá Access Fault
vyjímku, která vyústí v chybovı requester WHDLoadu. Jestlie oznaèíte oblast pamìti
jako chránìnou pouitím <a href="../../Autodoc/whdload.doc">resload_Protect#?</a> funkce,
WHDLoad zmìní popisy oné oblasti v pøekladaèi MMU. Nyní pøi kadém pøístupu do dané
pamìti CPU vytvoøí vyjímku Access fault. Handler vyjímek uvnitø WHDLoadu ovìøí
dùvod pro vyjímku a WHDLoad vyskoèí s chybovım hlášením. Tato schopnost se ale
projevuje silnım zpomalením bìhu programu, obzvláštì pokud jsou chránìné èásti
kódu ve stejné stránce pamìti. Pokud program závisí na rychlosti bìhu, rozdíly
ve funkènosti jsou moné - nìkteré programy nemusí s ochranou pamìti fungovat.
<h4>Pøíklad: checksums kódu</h4>
Pokud instalujete hru pomocí WHDLoad, budete muset patchnout pùvodní loader
ve høe tak, aby program nahrával pøes WHDLoad. Nìkteré hry provádìjí kontrolní
souèet klíèovıch oblastí programu, aby detekovaly zmìny pùvodního kódu. Tyto
rutiny mùe bıt nìkdy tìké najít. Ale pouití <a href="../../Autodoc/whdload.doc">resload_Protect#?</a> funkcí
ve WHDLoad problém øeší. Všechno, co musíte udìlat, je chránit bajty, které jste
zmìnili v kódu hry pøed pøeètením. Pak kadá rutina, která se pokouší pøeèíst
váš opravenı kód zpùsobí chybu a vy zjistíte, kde kontrola je.
<h4>Omezení</h4>
Nesmíte chránit pamì, kde je SSP. Pokud to udìláte a stane se vyjímka, dojde
k dvojité chybì na sbìrnici, protoe CPU nebude schopné zapsat stackframe vyjímky.
Poté u se dá program jen resetnout. WHDLoad ovìøuje, jestli existuje konflikt chránìné
oblasti se SSP a pokud ano - ukonèí se, ale to nepomùe, pokud se SSP pozdìji zmìní.
<ul>
<li>68020 + 68851
<ul>
<li>tento hardware není momentálnì podpoøen
</ul>
<li>68030
<ul>
<li>3-Byte pøesuny nejsou podporovány a zpùsobí Access Fault, takové pøesuny
se stávají, pokud je pøistupováno k longwordu na liché adrese (napr. tst.l $fff),
zatímco chránìná oblast pamìti zaèíná na $1000). Protoe tohle je nesprávnì i na A500,
moná na to nikdy nenarazíte.
<li>uzamèené pøesuny zpùsobené TAS, CAS or CAS2 nejsou podpoøeny a zahlásí chybu,
to ale není problém, protoe tyto pøesuny nejsou podpoøeny hardwarem Amigy.
</ul>
<li>68040
<ul>
<li>tento hardware není momentálnì podpoøen
</ul>
<li>68060
<ul>
<li>misalignované data stream pøístupy nejsou podpoøeny a zpùsobí chybu
(napø. tst.l $fff, zatímco chránìná oblast pamìti zaèíná na $1000), toto omezení
je problém a obèas je kvùli tomu schopnost resload_Protect témìø neopuitelná,
moná to pozdìji opravím, ale je to tìké
<li>misalignované instructions stream pøístupy nejsou podpoøeny a vytvoøí chybu,
pokud jsou obì zasaené stránky chránìné
<li>uzamèené pøesuny zpùsobené TAS, CAS or CAS2 nejsou podpoøeny a zahlásí chybu,
to ale není problém, protoe tyto pøesuny nejsou podpoøeny hardwarem Amigy.
<li>instrukce, které leí na chránìné stránce pamìti a pøistupují k supervizor
èásti status registeru budou vykonány nepøesnì, tyto instrukce vdy vidí trace bit
jako 1 a masku priority vyjímky jako 7, jakákoliv modifikace supervizor èásti
bude neúèinná
<li>movem instrukce mohou pøistupovat k chránìné oblasti bez ohlášení chyby,
protoe je ovìøen jen první pøístup k chránìné oblasti
<li>move16 a double precision operace (FPU) nejsou podpoøené a ohlásí chybu
<li>"move (mem),(mem)" pøekraèující hranice stránek pamìti budou vykonány nesprávnì
</ul>
</ul>
</BODY>
</HTML>
