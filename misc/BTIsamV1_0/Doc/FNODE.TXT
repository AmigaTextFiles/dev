/*--------------------------------------------------------------------------*
 |                                                                          |
 |    FNODE.H                                                               |
 |                                                                          |
 |    Beschreibung  : Routinen zur Unterstützung von verketteten Listen     |
 |                                                                          |
 |    Autor         :  Olaf Asholz                                          |
 |                                                                          |
 *--------------------------------------------------------------------------*/
typedef enum  {AUTO,SELF} node_mem;
typedef enum  {TOP,BOTTOM,SORTED} node_insert;
typedef int (sortfkt)(const char *buf2,const char *buf1);

typedef struct node{
  struct node *next,*prev;
  char *item;
}t_node;

typedef struct{
  size_t  size;
  int     mem;
  int     insert;
  sortfkt *fkt;
  int     anz;
  t_node  *head,*foot;
  t_node  *akt;
}t_nodepara;

/* runfkt gibt TRUE bei erfolgreicher Abarbeitung zurück */
typedef int (runfkt)(t_node *t);


t_nodepara *listinit(node_mem mem,node_insert insert,sortfkt fkt,size_t size);
  Variablen:
    node_mem mem;            Angabe der Speicherverwaltungsart:
                             AUTO: Die Routinen kopieren den angebenen
                                   Speicherbereich und geben ihn selbst
                                   wieder frei.
                             SELF: Der Anwender reserviert den Speicher
                                   und gibt ihn selber wieder frei.
    node_insert insert;      Angabe des Insertmodus:
                             TOP:    Neuer Knoten wird am Anfang eingefügt
                             BOTTOM: Neuer Knoten wird am Ende eingefügt
                             SORTED: Neue Knoten wird in die Liste einsortiert
                                     optinale Eingabe einer Sortierfunktion
                                     möglich.
    sortfkt fkt;             SORTED: Sortierfunktion oder NULL.
                                     Bei NULL wird strcmp() verwendet.
                             TOP,BOTTOM: ignoriert.
    size_t size;             AUTO: Größe des zu kopierenden Elementes oder 0
                                   0 es wird Platz für einen ASCIIZ-String
                                   geschaffen.
                                   (Größe wird mit strlen() ermittelt.
  Rückgabewert:
    t_nodepara*;             Zeiger auf die t_nodepara-Struktur
  Beschreibung:
    Reserviert Speicher für eine t_nodepara-Struktur und initialisiert sie
    mit den Anfangswerten.

int listexit(t_nodepara *np);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
  Rückgabewert:
    int;                     immer TRUE
  Beschreibung:
    Gibt den Speicher für alle Listenelemente und die t_nodepara-Struktur
    wieder frei. Entfernt alles komplett aus dem Speicher.

size_t listsize(t_nodepara *l);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
  Rückgabewert:
    size_t;                  Anzahl der Elemente in der Liste
  Beschreibung:
    Liest aus der t_nodepara-Struktur die Anzahl der Elemente dieser
    Liste aus; (Nie direkt auf die t_nodepara-Struktur zugreifen)

int runlist(t_nodepara *np,node_insert mode, runfkt fkt);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
    node_insert insert;      Angabe des Insertmodus:
                             TOP:    Abarbeitungsreihenfolge von Oben
                             BOTTOM: Abarbeitungsreihenfolge von Unten
                             SORTED: wie TOP
    runfkt  fkt;             Diese Funktion wird auf jedes Element der Liste
                             angewendet.
  Rückgabewert:
    int;                     Alle Funktionergebnisse der runfkt miteinander
                             logisch und verknüpft. (ret&=fkt)
  Beschreibung:
    Die runfkt wird auf alle Listenelemente angewendet.
    typedef int (runfkt)(t_node *t);

t_node *deleteall(t_nodepara *np);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
  Rückgabewert:
    t_node*;                 Zeiger auf den aktuellen Knoten;
  Beschreibung:
    Löscht die gesamte Liste.

t_node *deletenext(t_nodepara *np,t_node *t);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
    t_node *t;               Zeiger auf den aktuellen Knoten.
  Rückgabewert:
    t_node *;                Zeiger auf den aktuellen Knoten oder NULL.
  Beschreibung:
    Löscht den Nachfolger von t. Bei Fehler wird NULL zurückgegeben.

t_node *insertnode(t_nodepara *np,char *v);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
    char *v;                 Zeiger auf den einzufügenden Datenbereich.
  Rückgabewert:
    t_node *;                Zeiger auf den eingefügten Knoten
  Beschreibung:
    Fügt einen Knoten in die Liste nach den Vorgaben in der
    t_nodepara-Struktur ein(TOP,BOTTOM,SORTED). Dabei wird eventuell
    der Datenbereich kopiert oder nur der Zeiger auf diesen gemerkt.

t_node *insertafternode(t_nodepara *np,char *v,t_node *t);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
    char *v;                 Zeiger auf den einzufügenden Datenbereich.
    t_node *t;               Zeiger auf den Knoten hinter dem Eingefuügt
                             werden soll.
  Rückgabewert:
    t_node *;                Zeiger auf den eingefügten Knoten
  Beschreibung:
    Fügt einen Knoten in die Liste nach dem Knoten t ein.
    Dabei wird eventuell der Datenbereich kopiert oder nur der Zeiger
    auf diesen gemerkt.

t_node *firstnode(t_nodepara *np);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
  Rückgabewert:
    t_node*;                 Zeiger auf den ersten Knoten
  Beschreibung:
    Setzt den aktuellen Zeiger auf den ersten Knoten.

t_node *lastnode(t_nodepara *np);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
  Rückgabewert:
    t_node*;                 Zeiger auf den letzten Knoten
  Beschreibung:
    Setzt den aktuellen Zeiger auf den letzten Knoten.

t_node *nextnode(t_nodepara *np,t_node *t);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
    t_node *t;               Zeiger auf den aktuellen Knoten
  Rückgabewert:
    t_node*;                 Zeiger auf den Nachfolger oder NULL;
  Beschreibung:
    Gibt den auf t folgenden Knoten oder falls t der letzte ist NULL
    zurück.

t_node *prevnode(t_nodepara *np,t_node *t);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
    t_node *t;               Zeiger auf den aktuellen Knoten
  Rückgabewert:
    t_node*;                 Zeiger auf den Vorgänger oder NULL
  Beschreibung:
    Gibt den vor t liegenden Knoten oder falls t der erste ist NULL
    zurück.

t_node *getnode(t_nodepara *np,int nr);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
    int nr;                  Index auf den wievielte Knoten.
  Rückgabewert:
    t_node*;                 Zeiger auf den nr-ten Knoten oder NULL zurück
  Beschreibung:
    Verwaltet die Liste als Array. Ist nr kleiner 0 oder größer als listsize
    wird NULL zurückgegeben.

t_node *searchnode(t_nodepara *np,char *v,t_node *t);
  Variablen:
    t_nodepara *np;          Durch listinit übergebener Zeiger auf die
                             t_nodepara-Struktur.
    char *v;                 Zeiger auf den Vergleichsdatenbereich
    t_node *t;               Zeiger auf den aktuellen Knoten oder NULL
  Rückgabewert:
    t_node*;                 Zeiger auf den nächsten gefundenen Knoten,
                             der die Vergleichsbedingung erfüllt oder
                             NULL zurück
  Beschreibung:
    Sucht nach dem nächsten Knoten der die Vergleichsbedingung erfüllt.
    Die Vergleichsfunktion wurde mit listinit übergeben.
    Wird als aktueller Knoten NULL übergeben wird mit dem ersten Knoten
    begonnen, sonst wird der auf den aktuellen folgende Knoten genommen.
    Ist die Liste nicht sortiert oder es wird kein Knoten gefunden, gibt
    die Funktion NULL zurück.


Beispiel:
/* Diese Sortierfunktion sortiert Zahlen */
int Sort(const char *s1, const char *s2)
{
  int a=atoi(s1),b=atoi(s2);
  return((a>b)?1:(a<b)?-1:0);
}

/* Einfache Run-Funktion: Gibt alle Listenelemente aus */
int Run(t_node *t)
{
  printf("%s ",t->item);
  return(TRUE);
}


void main()
{
  int i;
  char gww[20];
  t_node *akt=NULL;
  t_nodepara *nodepara;

  nodepara=listinit(AUTO,SORTED,Sort/*NULL*/,0);
  akt=nodepara->akt;

  for(i=0;i<10;i++) akt=insertnode(nodepara,itoa(i,gww,10));

  runlist(nodepara,TOP,Run); printf("\n");
  runlist(nodepara,BOTTOM,Run); printf("\n");

  for(i=0;i<listsize(nodepara);i++){
    akt=getnode(nodepara,i);
    if(akt!=NULL) printf("%d %s\n",i,akt->item);
    else printf("%d NULL\n",i);
  }

  listexit(nodepara);
}

