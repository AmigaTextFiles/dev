; -------------------------------------------------------
; Installer script for GOOSA V2.0
; -------------------------------------------------------

(set #welcome "This is the installer for GOOSA V2.0!")

(set #wrongversion
(cat "You have an old version of the program 'Installer' "
     "on your Amiga!\n\n"
     "The installation procedure needs at least Installer 42.9."
     "\n\nPlease check your System & obtain a newer version!"
))

(set #general-help 
(cat "The install script will copy all %s files &"
     "directories to the destination that you specify."
     ""
     "Then it will copy DeckBrowser DeckRunner & DBaseManager"
     "to the command path you supply."
     ""
     "Finally, it will add an Assign GOOSA: Vol:destination/"
     "statement to your User-Startup file located in the "
     "S: directory."
))

(set #destdir-prompt "Select a Volume & Path where GOOSA will be added:")

(set #destdir-help   
(cat "Select the volume that you wish to place GOOSA in."
     "Then select a directory (if any) that will serve as a "
     "parent for GOOSA.  Example:  Select DH0: as the volume,"
     "then select a directory (such as Programs) & the installer"
     "will make a directory called DH0:Programs/GOOSA, where"
     "the GOOSA program will be placed."
     "NOTE:"
     "If this is changed in the future, remember to edit the Icon"
     "ToolTypes to reflect the actual location of the program."
     "The ToolTypes are the reason for the assignment in your"
     "S:User-Startup script file."
))

(set #Cdir-prompt "Select a Path where commands are located (example C:):")

(set #Cdir-help   
(cat "Select the volume & Path that you wish to place GOOSA"
     "support program(s) in.  I recommend the 'C:' directory."
))

(set #no-diskspace "To install GOOSA into '%s', you need at least %ld bytes of free harddrive space!")

(set #startup-prompt "An Assign has to be added to S:User-Startup for GOOSA.")
(set #startup-help   "GOOSA won't work correctly without this!")



;------------------------------------------------------------------------
; Cleanup any temporary mess we created

(procedure CLEANUP
    ; Nothing to cleanup
    (delete (tackon @default-dest ".tempinstall") (all) (optional "force"))
)   ; CLEANUP


;------------------------------------------------------------------------
; Obtain an installation path
(procedure GETPATH #gp_default #gp_remdir #gp_msg #gp_help

    (set #gp_res "")
    (while (= "" #gp_res)
        (set #gp_res #gp_default)
        (if (not (exists #gp_res (noreq)))
          (
            ; Surfer 1.1 Hack:
            (if (= #gp_res "Work:")
              (
                (set #gp_res "")
                (set #gp_default @default-dest)
              )
            ) ; if

          )
        ) ; if

        (if (OR (= "" #gp_res) (= @user-level 2))
          (
            ; We had a problem. So we need to ask the user!
            (set #gp_res
                (expandpath
                    (askdir
                        (prompt #gp_msg)
                        (help #gp_help)
                        (default #gp_default)
                    )
                )
            )
          )
        ) ; if

        ; If the directory does not exist, retry!
        (if (<> "" #gp_res)
          (
            (if (not (exists #gp_res (noreq)))
                (set #gp_res "")
            ) ; if
          )
        ) ; if
    ) ; while

    ; return the result!
    (set #gp_res #gp_res)

) ; GETPATH

;------------------------------------------------------------------------
; We can't handle this script without Installer 42.9 or better!
(if (< @installer-version 2752521)
  (
    ; Big problem!
    (message #wrongversion)
    (exit (quiet))
  )
)

; find out how the user wants to install things
(welcome #welcome)

(complete 0)

; First find the Destination base:

(set #GDirBase (GETPATH "Work:" TRUE #destdir-prompt #destdir-help))

; We have to create a drawer "GOOSA" there!
; if (expr) (true) (false)

(set #DestDir (tackon #GDirBase "GOOSA"))
    
(copyfiles (prompt "Copying Drawer (Icon file)...")
           (help    @copyfiles-help)
           (source  "ENV:sys/def_Drawer.info")
           (dest    #GDirBase)
           (newname "GOOSA.info")
)

; Where we're going to place DeckBrowser & DBaseManager:

(set #CmdDir (GETPATH "C:" TRUE #Cdir-prompt #Cdir-help))

(set @default-dest #DestDir)

; If this is a new installation, we check the diskspace!

    (if (not (exists @default-dest))
      (
        ; For a new setup, we should leave some space!
        (if (< (getdiskspace #GDirBase) 3500000)
            (abort (#no-diskspace #GDirBase 3500000))
        )

        (makedir @default-dest)

        (set #HelpDir (tackon @default-dest "Help"))
        (makedir #HelpDir)

        (set #DBaseDir (tackon @default-dest "DataBases"))
        (makedir #DBaseDir)

        (set #BackupDir (tackon @default-dest "Backup"))
        (makedir #BackupDir)

        (complete 9)

        (copyfiles (prompt  "Copying DeckBrowser (Support Program)...")
                   (help    @copyfiles-help)
                   (source  "DeckBrowser")
                   (dest    #CmdDir)
        )

        (copyfiles (prompt  "Copying DeckRunner (Support Program)...")
                   (help    @copyfiles-help)
                   (source  "DeckRunner")
                   (dest    #CmdDir)
        )

        (copyfiles (prompt  "Copying DBaseManager (Support Program)...")
                   (help    @copyfiles-help)
                   (source  "DBaseManager")
                   (dest    #DestDir)
        )

        (copyfiles (prompt  "Copying DBaseManager (Support Program)...")
                   (help    @copyfiles-help)
                   (source  "DBaseManager")
                   (dest    #CmdDir)
        )

        (copyfiles (prompt  "Copying GOOSA_Deck (Source Deck)...")
                   (help    @copyfiles-help)
                   (source  "GOOSA_deck")
                   (dest    #DestDir)
        )

        (copyfiles (prompt  "Copying Install Script file...")
                   (help    @copyfiles-help)
                   (source  "InstallProgram")
                   (dest    #DestDir)
                   (infos)
        )

        (copyfiles (prompt  "Copying GOOSA_Deck.info (Source Deck)...")
                   (help    @copyfiles-help)
                   (source  "GOOSA_deck.info")
                   (dest    #DestDir)
        )

        (complete 45)

        (copyfiles (prompt  "Copying ARexx Scripts...")
                   (help    @copyfiles-help)
                   (source  "KillDBase.rexx")
                   (dest    #DestDir)
        )

        (copyfiles (prompt  "Copying ARexx Scripts...")
                   (help    @copyfiles-help)
                   (source  "TestDBase.rexx")
                   (dest    #DestDir)
        )

        (copyfiles (prompt  "Copying Help files...")
                   (help    @copyfiles-help)
                   (source  "GOOSA.guide")
                   (dest    #HelpDir)
                   (infos)
        )

        (copyfiles (prompt  "Copying Printout file...")
                   (help    @copyfiles-help)
                   (source  "GOOSA.prt")
                   (dest    #DestDir)
        )
        
        (copyfiles (prompt  "Copying Help files...")
                   (help    @copyfiles-help)
                   (source  "DBaseManager.guide")
                   (dest    #HelpDir)
                   (infos)
        )
        
        (copyfiles (prompt  "Copying Logo file...")
                   (help    @copyfiles-help)
                   (source  "GOOSATitle.iff")
                   (dest    #DestDir)
        )

        (complete 60)

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Assocs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Attrs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.BDEs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Caps")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.CDEs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Comps")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.IDEs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Norms")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.OCTs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.PDEs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Procs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Rels")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Reqs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.States")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Subs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.Supers")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/GOOSA.TechNotes")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Assocs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Attrs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.BDEs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Caps")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.CDEs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Comps")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.IDEs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Norms")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.OCTs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.PDEs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Procs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Rels")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Reqs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.States")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Subs")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.Supers")
                   (dest    #DBaseDir)
        )

        (copyfiles (prompt  "Copying Example DataBase files...")
                   (help    @copyfiles-help)
                   (source  "Demo/Test1.TechNotes")
                   (dest    #DBaseDir)
        )
        
        (complete 75)

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Assocs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Attrs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.BDEs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Caps")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.CDEs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Comps")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.IDEs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Norms")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.OCTs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.PDEs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Procs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Rels")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Reqs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.States")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Subs")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.Supers")
                   (dest    #BackupDir)
        )

        (copyfiles (prompt  "Copying Backup GOOSA Example files...")
                   (help    @copyfiles-help)
                   (source  "Backup/GOOSA.TechNotes")
                   (dest    #BackupDir)
        )

        (complete 83)

        (copyfiles (prompt  "Copying Main program...")
                   (help    @copyfiles-help)
                   (source  "GOOSA")
                   (dest    #DestDir)
                   (infos)
        )

        (copyfiles (prompt  "Copying .readme file...")
                   (help    @copyfiles-help)
                   (source  "GOOSA.readme")
                   (dest    #DestDir)
                   (infos)
        )

        (complete 98)
      )
    )

;(startup    "GOOSA"
;   (prompt  "An Assign needs to be added to the \"S:user-startup\".")
;   (help    "GOOSA has to know where to find certain files.")
;   (command "Assign GOOSA: " #DestDir)
;)

; If we have to add an Assign, we better create one right now
;(makeassign "GOOSA" #DestDir)

;------------------------------------------------------------------------
; That's it!

(complete 100)

(CLEANUP)
(exit)

(abort "Well, I tried!")
