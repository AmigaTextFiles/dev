%!PS-Adobe-2.0
%%Creator: dvips 5.46 Copyright 1986-91 Radical Eye Software
%%Title: PCHG.dvi
%%Pages: 12 1
%%BoundingBox: 0 0 596 843
%%DocumentFonts: Times-Bold Times-Roman Times-Italic Courier
%%EndComments
%%BeginProcSet: tex.pro
/TeXDict 200 dict def TeXDict begin /N /def load def /B{bind def}N /S /exch
load def /X{S N}B /TR /translate load N /isls false N /vsize 10 N /@rigin{
isls{[0 1 -1 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
Resolution VResolution vsize neg mul TR matrix currentmatrix dup dup 4 get
round 4 exch put dup dup 5 get round 5 exch put setmatrix}N /@letter{/vsize 10
N}B /@landscape{/isls true N /vsize -1 N}B /@a4{/vsize 10.6929133858 N}B /@a3{
/vsize 15.5531 N}B /@ledger{/vsize 16 N}B /@legal{/vsize 13 N}B /@manualfeed{
statusdict /manualfeed true put}B /@copies{/#copies X}B /FMat[1 0 0 -1 0 0]N
/FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{/nn 8 dict N nn begin
/FontType 3 N /FontMatrix fntrx N /FontBBox FBB N string /base X array
/BitMaps X /BuildChar{CharBuilder}N /Encoding IE N end dup{/foo setfont}2
array copy cvx N load 0 nn put /ctr 0 N[}B /df{/sf 1 N /fntrx FMat N df-tail}
B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]N df-tail}B /E{pop nn dup definefont
setfont}B /ch-width{ch-data dup length 5 sub get}B /ch-height{ch-data dup
length 4 sub get}B /ch-xoff{128 ch-data dup length 3 sub get sub}B /ch-yoff{
ch-data dup length 2 sub get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B
/ch-image{ch-data dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0
N /rw 0 N /rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S
dup /base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx 0
ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff setcachedevice
ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff .1 add]{ch-image}
imagemask restore}B /D{/cc X dup type /stringtype ne{]}if nn /base get cc ctr
put nn /BitMaps get S ctr S sf 1 ne{dup dup length 1 sub dup 2 index S get sf
div put}if put /ctr ctr 1 add N}B /I{cc 1 add D}B /bop{userdict /bop-hook
known{bop-hook}if /SI save N @rigin 0 0 moveto}N /eop{clear SI restore
showpage userdict /eop-hook known{eop-hook}if}N /@start{userdict /start-hook
known{start-hook}if /VResolution X /Resolution X 1000 div /DVImag X /IE 256
array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for}N /p /show load N
/RMat[1 0 0 -1 0 0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X
/rulex X V}B /V statusdict begin /product where{pop product dup length 7 ge{0
7 getinterval(Display)eq}{pop false}ifelse}{false}ifelse end{{gsave TR -.1 -.1
TR 1 1 scale rulex ruley false RMat{BDot}imagemask grestore}}{{gsave TR -.1
-.1 TR rulex ruley scale 1 1 false RMat{BDot}imagemask grestore}}ifelse B /a{
moveto}B /delta 0 N /tail{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{
S p tail}B /c{-4 M}B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B
/j{3 M}B /k{4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w
}B /q{p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{clear SS restore}B end
%%EndProcSet
%%BeginProcSet: texps.pro
TeXDict begin /rf{655360 div mul Resolution mul 7227 div /PixPerEm X findfont
dup length 1 add dict /nn X{1 index /FID ne{nn 3 1 roll put}{pop pop}ifelse}
forall nn /Encoding get 1 0 1 255{2 index exch get /.notdef ne{1 add}if}for
dict begin 0 1 255{2 copy get 3 index 2 index get 1000 mul PixPerEm div def
pop}for pop pop nn /Metrics currentdict put end{/foo setfont}2 array copy cvx
dup 0 nn dup definefont[PixPerEm 0 0 PixPerEm neg 0 0]makefont put N}N
/ObliqueSlant{dup sin S cos div neg}B /SlantFont{/foo X[1 0 foo 1 0 0]
TransFont}N /ExtendFont{/foo X 3 2 roll[S{foo div}forall]3 1 roll[foo 0 0 1 0
0]TransFont}N /TransFont{S findfont S makefont dup length dict /nn X{1 index
/FID ne{nn 3 1 roll put}{pop pop}ifelse}forall dup nn definefont pop}N end
%%EndProcSet
TeXDict begin 1000 300 300 @start /Fa 1 16 df<03C00FF01FF83FFC7FFE7FFEFFFF
FFFFFFFFFFFFFFFFFFFF7FFE7FFE3FFC1FF80FF003C010127D9317>15
D E /Fb [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 14 19 23 29 29 48 45 19 19 19 29 32 14
19 14 16 29 29 29 29 29 29 29 29 29 29 16 16 32 32 32 25
53 41 38 38 41 35 32 41 41 19 22 41 35 51 41 41 32 41 38
32 35 41 41 54 41 41 35 19 16 19 27 29 19 25 29 25 29 25
19 29 29 16 16 29 16 45 29 29 29 29 19 22 16 29 29 41 29
29 25 28 11 28 31 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 19 29 29 10 29 29 29 29 10
25 29 19 19 32 32 0 29 29 29 14 0 26 20 19 25 25 29 57 57
0 25 0 19 19 19 19 19 19 19 19 0 19 19 0 19 19 19 57 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 51 0 16 0 0 0 0 35 41 51 18
0 0 0 0 0 38 0 0 0 16 0 0 16 29 41 29 0 0 0 0 ] /Times-Roman
1000 905969 rf /Fc [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 18 24 29 36 36 60 56 24 24 24
36 40 18 24 18 20 36 36 36 36 36 36 36 36 36 36 20 20 40
40 40 32 66 52 48 48 52 44 40 52 52 24 28 52 44 64 52 52
40 52 48 40 44 52 52 68 52 52 44 24 20 24 34 36 24 32 36
32 36 32 24 36 36 20 20 36 20 56 36 36 36 36 24 28 20 36
36 52 36 36 32 34 14 34 39 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 24 36 36 12 36 36
36 36 13 32 36 24 24 40 40 0 36 36 36 18 0 32 25 24 32 32
36 72 72 0 32 0 24 24 24 24 24 24 24 24 0 24 24 0 24 24
24 72 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 64 0 20 0 0 0 0 44
52 64 22 0 0 0 0 0 48 0 0 0 20 0 0 20 36 52 36 0 0 0 0 ]
/Times-Roman 1000 1132462 rf /Fd [ 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 27
27 27 27 27 27 27 27 27 27 27 27 27 0 0 0 27 27 27 27 0
27 27 27 27 27 27 27 0 0 27 0 27 27 27 27 27 27 27 27 0
27 27 0 27 27 27 27 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
27 0 0 0 0 27 27 0 27 0 0 0 0 0 0 0 0 0 27 0 0 27 27 0 27
0 0 0 0 ] /Courier 1000 720896 rf /Fe [ 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 11 15 19
23 23 38 36 15 15 15 23 31 11 15 11 13 23 23 23 23 23 23
23 23 23 23 15 15 31 31 31 23 42 28 28 30 33 28 28 33 33
15 20 30 25 38 30 33 28 33 28 23 25 33 28 38 28 25 25 18
13 18 19 23 15 23 23 20 23 20 13 23 23 13 13 20 13 33 23
23 23 23 18 18 13 23 20 30 20 20 18 18 13 18 25 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 18 23 23 8 23 23 23 23 10 25 23 15 15 23 23 0 23 23
23 11 0 24 16 15 25 25 23 41 46 0 23 0 15 15 15 15 15 15
15 15 0 15 15 0 15 15 15 41 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 41 0 13 0 0 0 0 25 33 43 14 0 0 0 0 0 30 0 0 0 13 0
0 13 23 30 23 0 0 0 0 ] /Times-Italic 1000 720896 rf /Ff
[ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 9 12 15 18 18 30 28 12 12 12 18 21 9 12 9 10 18
18 18 18 18 18 18 18 18 18 10 10 21 21 21 16 34 26 24 24
26 22 20 26 26 12 14 26 22 32 26 26 20 26 24 20 22 26 26
34 26 26 22 12 10 12 17 18 12 16 18 16 18 16 12 18 18 10
10 18 10 28 18 18 18 18 12 14 10 18 18 26 18 18 16 18 7
18 20 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 12 18 18 6 18 18 18 18 7 16 18 12 12 20
20 0 18 18 18 9 0 17 13 12 16 16 18 37 37 0 16 0 12 12 12
12 12 12 12 12 0 12 12 0 12 12 12 37 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 32 0 10 0 0 0 0 22 26 32 11 0 0 0 0 0 24 0 0
0 10 0 0 10 18 26 18 0 0 0 0 ] /Times-Roman 1000 576716
rf /Fg [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 18 24 40 36 36 72 60 24 24 24 36 41 18 24
18 20 36 36 36 36 36 36 36 36 36 36 24 24 41 41 41 36 67
52 48 52 52 48 44 56 56 28 36 56 48 68 52 56 44 56 52 40
48 52 52 72 52 52 48 24 20 24 42 36 24 36 40 32 40 32 24
36 40 20 24 40 20 60 40 36 40 40 32 28 24 40 36 52 36 36
32 28 16 28 37 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 24 36 36 12 36 36 36 36 20 36
36 24 24 40 40 0 36 36 36 18 0 39 25 24 36 36 36 72 72 0
36 0 24 24 24 24 24 24 24 24 0 24 24 0 24 24 24 72 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 72 0 22 0 0 0 0 48 56 72 24 0
0 0 0 0 52 0 0 0 20 0 0 20 36 52 40 0 0 0 0 ] /Times-Bold
1000 1132462 rf /Fh [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 15 20 33 30 30 60 50 20 20
20 30 34 15 20 15 17 30 30 30 30 30 30 30 30 30 30 20 20
34 34 34 30 56 43 40 43 43 40 37 47 47 23 30 47 40 56 43
47 37 47 43 33 40 43 43 60 43 43 40 20 17 20 35 30 20 30
33 27 33 27 20 30 33 17 20 33 17 50 33 30 33 33 27 23 20
33 30 43 30 30 27 24 13 24 31 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 20 30 30 10 30
30 30 30 17 30 30 20 20 33 33 0 30 30 30 15 0 32 21 20 30
30 30 60 60 0 30 0 20 20 20 20 20 20 20 20 0 20 20 0 20
20 20 60 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 60 0 18 0 0 0 0
40 47 60 20 0 0 0 0 0 43 0 0 0 17 0 0 17 30 43 33 0 0 0
0 ] /Times-Bold 1000 943718 rf /Fi [ 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 11 15 19 23
23 38 36 15 15 15 23 26 11 15 11 13 23 23 23 23 23 23 23
23 23 23 13 13 26 26 26 20 42 33 30 30 33 28 25 33 33 15
18 33 28 41 33 33 25 33 30 25 28 33 33 43 33 33 28 15 13
15 21 23 15 20 23 20 23 20 15 23 23 13 13 23 13 36 23 23
23 23 15 18 13 23 23 33 23 23 20 22 9 22 25 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
15 23 23 8 23 23 23 23 8 20 23 15 15 25 25 0 23 23 23 11
0 21 16 15 20 20 23 46 46 0 20 0 15 15 15 15 15 15 15 15
0 15 15 0 15 15 15 46 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 41
0 13 0 0 0 0 28 33 41 14 0 0 0 0 0 30 0 0 0 13 0 0 13 23
33 23 0 0 0 0 ] /Times-Roman 1000 720896 rf /Fj [ 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 22 29 48 43 43 86 72 29 29 29 43 49 22 29 22 24 43 43
43 43 43 43 43 43 43 43 29 29 49 49 49 43 80 62 57 62 62
57 53 67 67 34 43 67 57 81 62 67 53 67 62 48 57 62 62 86
62 62 57 29 24 29 50 43 29 43 48 38 48 38 29 43 48 24 29
48 24 72 48 43 48 48 38 34 29 48 43 62 43 43 38 34 19 34
45 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 29 43 43 14 43 43 43 43 24 43 43 29 29 48
48 0 43 43 43 22 0 47 30 29 43 43 43 86 86 0 43 0 29 29
29 29 29 29 29 29 0 29 29 0 29 29 29 86 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 86 0 26 0 0 0 0 57 67 86 28 0 0 0 0 0 62
0 0 0 24 0 0 24 43 62 48 0 0 0 0 ] /Times-Bold 1000 1360527
rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300
TeXDict begin @a4
%%EndSetup
%%Page: 1 1
bop 0 554 a Fj(PCHG)p 0 588 1950 17 v 931 636 a Fi(A)11
b(proposal)g(for)g(a)h(new)g(line-by-line)e(palette)h(control)g(format)
1740 690 y(V)-5 b(ersion)11 b(1.2)0 2533 y Fh(by)k(Sebastiano)g(V)n(igna)p
0 2570 1950 9 v eop
%%Page: 1 2
bop 0 -58 a Fi(Chapter)12 b(1:)k(A)11 b(Look)g(at)h(the)f(Past)1379
b(1)0 417 y Fg(1)36 b(A)15 b(Look)f(at)h(the)g(Past)62 603
y Fi(The)f(capabilities)f(of)h(the)g(Amiga)f(old)h(and)f(enhanced)i(chip)e
(sets)h(are,)i(in)d(terms)h(of)f(palette)h(depth)g(and)g(on-screen)0
665 y(available)g(colors,)i(not)e(dif)o(ferent)g(from)h(those)f(of)g(a)h
(brand)g(new)f('85)h(Amiga)e(1000.)26 b(Hardware)15 b(design)f
(limitations,)0 727 y(such)f(as)g(Chip)g(RAM)h(available)f(bandwidth,)g
(forced)h(Commodore)e(designers)h(to)g(left)g(untouched)f(these)i
(limitations)0 790 y(until)e(the)h(delivery)g(of)h(the)f
Ff(AGA)h Fi(chip)f(set.)22 b(Nonetheless,)14 b(not)f(being)f(able)i(to)f
(display)f(more)h(than)g(16)g(colors)g(in)g(high)0 852 y(resolution)7
b(is)h(a)g(deadly)h(limitation)d(for)i(many)g(applications,)g(and)g(the)g
(installed)g(base)g(of)h(Amigas)e(with)g(old)h(or)h(enhanced)0
914 y(chip)i(sets)g(is)g(very)g(lar)o(ge.)62 1051 y(In)i(the)g(last)g
(years,)h(several)g(people)e(tried)h(to)g(enhance)g(the)g(Amiga)g(video)f
(display)g(by)h(using)f(line-by-line)g(palette)0 1113 y(change)j
(technology)m(.)27 b(In)14 b(short,)i(by)f(using)e(the)i(Copper)g(\(and)g
(possibly)f(the)g Ff(CPU)p Fi(\))i(the)f(colors)g(stored)f(in)h(the)f
(palette)0 1176 y(are)g(changed)g(while)e(the)h(video)g(beam)g(sweeps)h
(across)f(the)g(screen.)23 b(As)13 b(a)h(result,)g(if)f(you)g(synchronize)
g(correctly)g(the)0 1238 y(changes)e(with)g(the)g(vertical/horizontal)g
(blanking)f(time)g(you)h(get)g(a)h(\(partially\))f(dif)o(ferent)h(palette)
f(on)g(each)h(video)f(line.)62 1375 y(The)g(\256rst)g(known)f(attempt)g
(in)h(this)e(direction)i(was)g(Rhett)f(Anderson')m(s)h(Sliced)g
Ff(HAM)p Fi(,)i(commonly)c(named)i Ff(SHAM)h Fi(by)0 1437
y(the)i(identi\256er)g(of)g(the)f(corresponding)h Ff(IFF)g(ILBM)i
Fi(chunk.)24 b Ff(SHAM)15 b Fi(\256xes)g(the)e(color)h(0)g(to)f(pure)i
(black,)f(and)g(reloads)g(the)0 1499 y(other)d(15)f(registers)g(of)h(the)f
Ff(HAM)i Fi(palette)f(with)f(dif)o(ferent)h(values)f(on)g(each)i(line)e
(\(if)h(the)f(image)g(is)h(interlaced,)g(the)f(colors)0
1562 y(are)i(reloaded)g(each)g(two)f(lines)f(instead\).)62
1699 y(The)18 b(following)d(attempts)h(\(by)i(NewT)m(ek)f(and)g
Ff(ASDG)i Fi(mainly\))d(are)i(generally)f(known)g(as)g(Dynamic)g(HiRes,)i
(or)0 1761 y(Advanced)c Ff(HAM)p Fi(,)i Fe(et)e(cetera)f
Fi(\(we)h(will)f(refer)i(to)e(these)h(standards)f(as)h(\252dynamic)f
(modes\272\).)26 b(They)15 b(store)f(in)g(a)h(chunk)0 1823
y(named)9 b Ff(CTBL)j Fi(\(ConT)n(rol)e(BLock)g(I)g(believe\))f(a)h(full)g
(16)f(color)h(palette)f(for)h(each)g(line)g(of)f(a)h(picture.)16
b(The)10 b Ff(CPU)h Fi(is)e(involved)0 1885 y(in)i(loading)f(the)i
(palette,)f(since)g(there)h(is)f(not)g(enough)g(time)f(to)h(do)g(this)g
(with)f(the)h(Copper)h(only)m(.)62 2022 y(However)n(,)j
Ff(SHAM)f Fi(and)f(dynamic)g(modes)f(have)h(major)g(faults)g(both)f(in)h
(the)g(de\256nition)f(of)h(their)g Ff(IFF)h Fi(format)e(and)h(in)0
2085 y(their)e(implementation.)62 2222 y(First)h(of)g(all,)g(the)g
(original)f(computation)g(that)g(led)h(the)g Ff(SHAM)h Fi(designer)f(to)g
(think)f(there)h(was)g(enough)f(time)h(to)f(stuf)o(f)0 2284
y(data)i(in)g(15)g(registers)g(is)g(plainly)f(wrong.)23
b(The)13 b(Copper)h(needs)f(some)g(Chip)g(memory)g(accesses)h(in)f(order)g
(to)g(fetch)h(its)0 2346 y(instructions.)26 b(While)15 b(a)h(picture)f(is)
f(displayed,)i(part)f(of)g(these)g(accesses)h(can)g(be)f(delayed)g
(because)h(the)f(video)g Ff(DMA)0 2408 y Fi(requires)c(Chip)h(memory)e
(access,)j(and)e(of)h(course)f(it)g(has)g(precedence)i(over)f(the)f
(Copper)m(.)62 2545 y(When)i(displaying)e(a)i(320)f(pixel)g(wide)h(lo-res)
f(picture,)h(the)g(video)f Ff(DMA)i Fi(is)e(active)h(during)f(160)g
(clocks)g(of)h(the)g(226)0 2608 y(available)e(\()p Ff(HAM)h
Fi(doesn')o(t)f(steal)f(all)h(of)g(the)g Ff(DMA)h Fi(accesses)g
(available,)f(but)f(we)h(are)h(interested)f(in)f(changing)h(the)f(palette)
0 2670 y(colors)i(during)g(the)g(horizontal)g(blanking,)g(i.e.,)i(when)e
(the)g(image)g(is)g(not)g(displayed\).)19 b(Thus,)13 b(it)f(could)g(seem)g
(we)h(have)p eop
%%Page: 2 3
bop 0 -58 a Fi(Chapter)12 b(1:)k(A)11 b(Look)g(at)h(the)f(Past)1379
b(2)0 183 y(66)14 b(clocks)g(left.)26 b(If)15 b(we)f(subtract)g(6)g
(clocks)g(for)h(a)g(Copper)g Fd(WAIT)h Fi(instruction,)d(we)i(are)g(left)g
(with)e(exactly)h(15)g Fd(MOVE)0 246 y Fi(instructions.)62
390 y(Unfortunately)m(,)h(this)e(considerations)g(skip)g(over)i(a)f(major)
g(point)f(of)h(the)g(Amiga)g(video)f Ff(DMA)j Fi(design:)21
b(the)14 b(video)0 452 y(data)f(fetch)g(starts)f(before)h(the)g(actual)g
(display)f(start,)h(and)f(ends)h(a)g(before)g(the)g(actual)g(display)e
(end.)21 b(This)12 b(implies)g(that)0 515 y(we)k(have)f(some)g(clock)h
(less)f(because)h(of)f(the)h(early)g(data)f(fetch)h(start,)h(but)d(that)h
(we)h(can')o(t)g(recover)h(it)d(after)j(the)e(data)0 577
y(fetch)10 b(end,)h(because)g(for)f(some)g(clocks)f(the)h(video)g
(hardware)h(will)e(be)h(still)f(displaying)f(our)i(picture,)h(and)f
(writing)f(in)g(the)0 639 y(palette)k(registers)f(at)h(this)f(point)g
(would)g(cause)h(an)g(immediate)e(change)j(of)f(the)f(video)g(chip)h
(output.)20 b(A)13 b(more)f(realistic)0 701 y(computation)e(leads)h(to)g
(about)g(13)g(color)g(changes.)62 846 y(But)e(this)e(is)h(not)f(enough.)16
b(When)8 b(the)g(Copper)h(executes)g(a)f(comparison)g(with)f(the)h
(vertical)h(beam,)g(it)f(has)g(a)g(resolution)0 908 y(of)13
b(8)f(bits.)20 b(When)12 b(it)g(arrives)h(at)g(the)f(255th)g(video)g
(line,)h(it)f(wraps)h(up)f(to)g(0.)21 b(Thus,)12 b(if)h(you)f(try)g(to)g
(build)g(a)h(user)g(Copper)0 971 y(list)e(which)h(goes)g(beyond)g(the)g
(255th)f(video)h(line,)g(the)g(system)g(places)g(a)h Fd(WAIT\(226,2)q
(55\))j Fi(Copper)d(instruction)d(in)0 1033 y(order)i(to)f(wait)g
(correctly)g(for)h(the)f(following)f(lines.)62 1178 y(If)g(you)f(want)g
(13)f(changes,)j(you)d(have)i(to)e(start)h(poking)f(the)h(color)g
(registers)g(with)g(the)g(Copper)g(just)f(after)i(a)g(video)f(line)0
1240 y(is)k(\256nished)f(\(as)i Ff(SHAM)p Fi(\).)24 b(But)13
b(on)g(the)g(255th)f(video)h(line,)g Fd(MrgCop\(\))j Fi(will)d(mer)o(ge)g
(your)g(user)g(Copper)h(list)e(with)g(the)0 1302 y(system)g(one)h(in)g
(such)g(a)g(way)h(that)e(the)h Fd(WAIT\(226)q(,25)q(5\))k
Fi(will)12 b(happen)h(after)h(the)f(video)g(vertical)g(position)e(passed)0
1364 y(255,)g(so)f(that)g(the)h(Copper)g(will)e(be)i(locked)g(until)e(the)
i(next)f(vertical)h(blank.)16 b(As)10 b(a)h(result,)g(the)f(following)f
(color)i(changes)0 1427 y(won')o(t)h(be)h(executed,)g(and)g(some)e(trash)i
(will)e(be)i(displayed)e(at)i(the)f(bottom)f(of)h(the)h(screen)g(\(this)e
(indeed)i(happens)f(with)0 1489 y Ff(SHAM)p Fi(\).)18 b(The)11
b(reason)g(no)g(one)g(noticed)f(this)g(problem)g(is)g(that)h
Ff(SHAM)h Fi(was)f(originally)f(hardwired)h(to)f(200)g(lines)g(pictures)0
1551 y(\(400)k(if)f(laced\).)25 b(On)14 b(an)g Ff(NTSC)h
Fi(screen,)h(and)d(in)h(the)g(video)f(default)h(position,)f(the)g(last)h
(line)f(of)h(such)f(a)i(picture)e(won')o(t)0 1613 y(usually)i(pass)g(the)g
(255th)g(video)g(line.)29 b(However)n(,)17 b(on)f(a)f Ff(P)m(AL)i
Fi(screen)f(the)f(255th)g(video)g(line)g(is)g(at)h(about)f(3/4)g(of)g(the)
0 1676 y(screen:)i(the)11 b(bug)g(is)g(readily)g(noticeable)g(as)h(soon)e
(as)i(you)f(drag)g(a)h Ff(SHAM)h Fi(screen.)62 1820 y(In)g(order)h(to)f
(avoid)f(this,)h(it)g(is)f(necessary)i(to)f(use)g(only)f
Fd(WAIT)j Fi(instructions)c(which)i(specify)g(0)g(as)g(horizontal)f(wait)0
1883 y(position.)j(Then,)d(the)f(time)g(available)g(before)h(the)f
(display)f(data)i(fetch)g(start)f(allows)f(only)h(7)g(color)g(changes.)62
2027 y(Another)k(problem)g(with)g Ff(SHAM)i Fi(is)d(that)h(even)h(if)f
(you)g(set)g(up)g(correctly)h(a)g(Copper)g(list)e(in)h(such)g(a)h(way)f
(that)g(the)0 2089 y(palette)f(changes)h(will)f(start)g(just)g(after)h
(the)g(end)g(of)f(the)h(display)m(,)g(under)f(Release)i(2)f(the)f(user)h
(has)f(the)h(possibility)d(of)0 2152 y(horizontally)i(dragging)g(an)h
(Intuition)e(Screen.)29 b(Mr)o(gCop\(\))16 b(is)e(enough)h(kind)f(to)g
(renumber)h(your)g(user)g(Copper)g(lists)0 2214 y(when)e(you)g(drag)g
(vertically)g(a)h(screen,)g(but)f(not)g(when)g(you)g(drag)g(it)g
(horizontally:)18 b(if)c(you)e(do)h(so,)h(a)g(series)f(of)g(fringes)0
2276 y(will)h(appear)h(on)g(one)g(side)f(of)h(the)g Ff(SHAM)h
Fi(picture.)27 b(Again,)15 b(this)f(problem)g(can)i(be)e(avoided)h(by)f
(waiting)g(always)h(for)0 2339 y(horizontal)c(position)e(of)j(0,)f(and)h
(by)f(limiting)e(the)i(number)g(of)g(color)h(changes.)62
2483 y(Dynamic)e(modes,)g(on)g(the)g(other)g(hands,)h(have)f
(programmatically)f(refused)i(to)f(use)g(the)g(Copper)h(only)m(.)16
b(As)10 b(a)g(result,)0 2545 y(you)g(can)g(certainly)g(amaze)h(friends)f
(and)g(relatives)g(with)g(stunning)e(images,)j(but)e(you)h(can')o(t)h(use)
f(any)g(of)g(those)g(beautiful)0 2608 y(pictures)j(in)g(an)h(application.)
23 b(Moreover)n(,)14 b(the)g(display)e(programs)h(commonly)f(used)i(for)g
(such)f(pictures)g(rely)h(on)f Ff(CPU)0 2670 y Fi(busy)f(loops)g(which)h
(have)g(to)f(be)h(rewritten)g(each)g(time)f(a)i(new)f(Amiga)f(with)g(a)h
(new)g Ff(CPU)h Fi(or)f(a)g(new)g(clock)g(rate)g(comes)p
eop
%%Page: 3 4
bop 0 -58 a Fi(Chapter)12 b(2:)k(Why)11 b Ff(PCHG)p Fi(?)1503
b(3)0 183 y(out.)25 b(I)15 b(still)d(haven')o(t)j(found)f(one)g(such)g
(program)g(which)g(will)f(work)h(on)g(my)g(A3000T)g(\(this)f(is)h
(probably)g(one)g(of)g(the)0 246 y(reasons)d(why)g Ff(ASDG)i
Fi(dropped)e(the)h(support)e(for)i(such)f(modes)f(in)h Fd(ADPro)p
Fi(\).)62 385 y(On)h(the)g Ff(IFF)h Fi(side,)g(I)f(can)h(only)e(say)h
(that)g(all)g(these)g(formats)g(are)h(hardwired)f(to)g(sixteen)f(12)h(bit)
f(color)i(registers,)f(and)0 447 y Ff(SHAM)h Fi(even)f(disallows)e
(screens)h(of)h(height)e(dif)o(ferent)i(from)f(200)g(video)g(lines.)62
587 y(These)k(constraints)f(are)i(unacceptable)f(for)h(serious)e
(purposes.)27 b(For)15 b(instance,)h(while)f(preparing)g(a)g
Ff(CDTV)i Fi(video)0 649 y(catalog)e(the)f(programmer)g(could)g(not)g(set)
h(up)f(the)g(user)h(interface)h(event)e(he)h(prefers)g(for)g(stopping)e
(the)h(display)g(of)h(a)0 711 y(picture,)c(because)h(it)e(would)g(have)i
(to)e(use)h(a)g(display)f(program)h(which)g(would)f(freeze)j(the)d
(machine;)h(and)g(the)g(he)g(would)0 773 y(have)h(to)f(rewrite)g(parts)g
(of)h(the)f(display)f(code)i(in)f(order)h(to)f(put)g(in)f(his)h(preferred)
i(exit)e(event.)0 980 y Fg(2)36 b(Why)14 b Fb(PCHG)p Fg(?)62
1178 y Fi(After)f(struggling)e(a)i(lot)f(with)g Ff(CTBL)p
Fi(,)i Ff(SHAM)p Fi(,)h(and)e(whatever)g(else)f(was)h(invented)f(for)h
(specifying)f(palette)g(changes)0 1241 y(in)f(order)g(to)f(implement)g
(them)g(in)h Fd(Mostra)i Fi(\(my)e Ff(ILBM)h Fi(viewer\),)g(I)f(decided)g
(there)g(was)g(no)g(way)g(to)g(make)g(them)f(really)0 1303
y(work.)28 b(Each)15 b(program)g(uses)g(them)f(in)h(a)g(dif)o(ferent)h
(way)m(,)g(with)e(dif)o(ferent)i(non-documented)e(speci\256cations.)27
b Ff(SHAM)0 1365 y Fi(is)15 b(hardwired)g(to)g(200)g(lines,)h(and)f(the)g
(color)h(of)f(the)g(last)g(pixels)f(of)i(a)f(screen)h(depends)f(on)g(the)g
(horizontal)g(position)0 1427 y(of)g(the)g(screen)h(itself)e(because)i(of)
f(a)g(wrong)g(computation)e(of)i(the)g(free)h(Copper)g Ff(DMA)g
Fi(slots.)27 b Ff(CTBL)16 b Fi(is)f(theoretically)0 1490
y(undisplayable)c(without)f(freezing)j(everything)e(and)h(yet)g(all)g
(images)f(I)h(ever)h(saw)f(changed)g(much)g(less)f(than)h(15)f(colors)0
1552 y(per)k(scan)g(line,)h(which)f(you)f(can)h(perfectly)h(do)e(with)g
(the)h(Copper)g(\(thanks)g(to)f Ff(ASDG)p Fi(')m(s)j Fd(DDHR)g
Fi(utility)c(for)i(this)f(info\).)0 1614 y(There)e(is)f(moveover)g(a)g
(great)h(confusion)f(about)g(the)g(role)g(of)h(the)f Ff(CMAP)i
Fi(chunk)e(with)f(respect)i(to)f(all)g(those)g(guys.)62
1754 y(Y)-5 b(et)12 b(the)f(technology)f(is)g(very)i(simple.)j(Just)c
(change)g(some)g(color)g(register)g(each)h(scan)f(line.)16
b(V)-5 b(ery)12 b(Amiga)e(speci\256c,)0 1816 y(but)h(it)g(works,)g(and)g
(it)g(works)g(really)h(well.)62 1955 y(This)k(document)f(describes)i(the)f
Ff(PCHG)h Fi(\(Palette)g(Changes\))g(chunk,)h(an)e Ff(ILBM)i
Fi(property)e(chunk)g(for)h(controlling)0 2018 y(ef)o(\256ciently)e(and)f
(reasonably)g(the)g(palette)g(changes)g(at)g(each)h(scan)f(line.)25
b(Also,)15 b(I)f(included)g(technical)g(info)g(and)g(code)0
2080 y(about)e(the)g(current)g(allowable)g(per)h(line)f(palette)g
(changes.)19 b(A)12 b(picture)g(with)g(a)g Ff(PCHG)i Fi(chunk)e(is)g
(called)g(a)h Fe(multi-palette)0 2142 y Fi(picture,)d(just)f(like)h(a)g
(picture)f(with)g(a)i Ff(CTBL)g Fi(chunk)e(is)h(called)g(a)g
Fe(dynamic)f Fi(or)h Fe(enhanced)h Fi(picture.)16 b(Multi-palette)8
b(pictures)0 2204 y(are)k(not)f(restricted)g(to)g(a)h(particular)f(video)g
(mode.)17 b(Y)-5 b(ou)11 b(can)h(have)f Ff(EHB)p Fi(,)i(hires,)f
Ff(HAM)p Fi(,)h(etc.)k(multi-palette)10 b(pictures.)62 2344
y(This)j(proposal)f(is)h(a)g(team)g(work.)22 b(It)13 b(was)h(lively)e
(discussed)g(with)h(many)f(other)h(people,)h(including)e(Joanne)h(Dow)m(,)
0 2406 y(Andy)c(Finkel,)g(J.)g(Edward)g(Hanway)m(,)i(Charles)e(Heath,)h
(David)f(Joiner)n(,)g(Jim)g(Kent,)g(Ilya)g(Shubentsov)m(,)g(Mike)g(Sinz,)h
(Loren)0 2468 y(W)n(ilton.)16 b(There)c(is)f(certainly)g(some)g(other)g
(people)g(I'm)g(for)o(getting)g(to)g(mention)f(though.)62
2608 y(What')m(s)17 b(good)f(in)g(what)g(follows)g(was)g(suggested)g(by)g
(them.)31 b(I'm)17 b(responsable)f(for)g(any)h(error)n(,)i(omission,)d
(bad)0 2670 y(English)10 b(and)h(bad)h(design.)p eop
%%Page: 4 5
bop 0 -58 a Fi(Chapter)12 b(4:)k(Informal)11 b(description)1344
b(4)0 183 y Fg(3)36 b(Design)14 b(goals)37 359 y Fa(\017)30
b Fi(Being)12 b(able)f(to)g(specify)g Fe(only)g Fi(the)g(changes)h(which)f
(are)h(really)g(required.)37 431 y Fa(\017)30 b Fi(Being)12
b(able)f(to)g(specify)g(24-bit)g(precision)g(color)g(changes,)h(and)f(an)h
(alpha)f(channel.)37 503 y Fa(\017)30 b Fi(Specifying)11
b(correctly)h(the)f(relation)g Ff(PCHG)p Fi(/)p Ff(CMAP)p
Fi(.)37 574 y Fa(\017)30 b Fi(Getting)10 b(a)i(chunk)f(which)g(is)g
(usually)f(smaller)h(than)g Ff(SHAM)i Fi(or)f Ff(CTBL)p
Fi(.)37 646 y Fa(\017)30 b Fi(Having)11 b(a)h(policy)e(about)h(Copper)o
(-only)g(displayability)m(.)37 718 y Fa(\017)30 b Fi(Being)12
b(able)f(to)g(change)h(65536)e(registers.)37 790 y Fa(\017)30
b Fi(Specifying)13 b(two)g(storage)h(formats:)20 b(a)14
b(very)f(dense)h(4-bit)e(32)i(register)f(format)g(for)h(current)g
(technology)m(,)f(and)h(an)90 852 y(open-ended,)e(24-bit)p
Fd(+)p Fi(alpha)f(channel,)g(65536)g(register)g(format)h(with)e
(compression)g(for)i(all)f(future)h(uses.)37 924 y Fa(\017)30
b Fi(Distributing)9 b(public)i(domain)f(code)i(for)f Ff(PCHG)i
Fi(compression/decompression)c(and)i(Copper)h(list)f(building.)0
1100 y Fg(4)36 b(Informal)14 b(description)62 1275 y Ff(PCHG)f
Fi(starts)e(with)g(the)g(following)f(header:)120 1400 y
Fd(struct)30 b(PCHGHeader)h({)202 1450 y(UWORD)f(Compressio)q(n;)202
1499 y(UWORD)g(Flags;)202 1549 y(WORD)57 b(StartLine;)202
1599 y(UWORD)30 b(LineCount;)202 1649 y(UWORD)g(ChangedLin)q(es;)202
1699 y(UWORD)g(MinReg;)202 1748 y(UWORD)g(MaxReg;)202 1798
y(UWORD)g(MaxChanges)q(;)202 1848 y(ULONG)g(TotalChang)q(es;)120
1898 y(};)0 2035 y Fi(The)8 b(only)f Fd(Compressio)q(n)k
Fi(values)d(currently)f(de\256ned)i(are)f Fd(PCHG_COMP)q(_N)q(ONE)k
Fi(and)7 b Fd(PCHG_COM)q(P_H)q(UF)q(FMA)q(NN)q Fi(.)0 2097
y(The)h Fd(Flags)i Fi(\256eld)f(has)f(three)g(bits)g(currently)g
(de\256ned,)h Fd(PCHGF_12)q(BIT)q Fi(,)j Fd(PCHGF_32B)q(IT)p
Fi(,)h Fd(PCHGF_USE_)q(ALP)q(HA)q Fi(.)0 2159 y(The)c Fd(StartLine)k
Fi(and)c Fd(LineCoun)q(t)j Fi(\256elds)d(specify)h(the)f(range)g
(controlled)g(by)g(the)g(line)g(mask,)g(as)g(we)h(will)e(see)i(later)m(.)0
2222 y(The)g Fd(ChangedLin)q(es)j Fi(\256eld)d(specify)g(the)g(number)f
(of)h(lines)f(on)g(which)h(at)f(least)h(a)g(change)g(happens)f(\(i.e.,)j
(the)e(number)0 2284 y(of)i(1')m(s)f(in)h(the)f(line)g(mask\).)17
b(The)11 b Fd(MinReg)j Fi(and)e Fd(MaxReg)i Fi(\256elds)d(specify)h(the)f
(minimum)e(and)j(the)f(maximum)f(register)0 2346 y(changed)15
b(in)f(the)g(chunk:)23 b(their)14 b(purpose)g(is)g(to)h(allow)f
(optimization)e(\(such)j(as)g(grouping)e(of)i(the)f(modi\256ed)g
(registers)0 2408 y(in)d(some)h(special)g(bank\).)18 b(The)12
b Fd(MaxChange)q(s)j Fi(\256eld)d(specify)g(the)g(maximum)e(number)h(of)h
(changes)g(on)g(a)g(single)f(line.)0 2471 y(The)g Fd(TotalCha)q(nge)q(s)k
Fi(\256eld)c(specify)g(the)h(total)e(number)h(of)h(color)f(changes)g(in)g
(the)h(whole)f Ff(PCHG)h Fi(chunk.)62 2608 y(If)f(Compression)f(is)g
Fd(PCHG_COMP_)q(HU)q(FFM)q(AN)q(N)p Fi(,)k(the)d(rest)f(of)h(the)f(chunk)g
(is)g(a)h(compressed)f(format.)17 b(It)10 b(is)g(formed)0
2670 y(by)h(a)p eop
%%Page: 5 6
bop 0 -58 a Fi(Chapter)12 b(4:)k(Informal)11 b(description)1344
b(5)120 183 y Fd(struct)30 b(PCHGCompHe)q(ad)q(er)h({)202
233 y(ULONG)f(CompInfoSi)q(ze;)202 283 y(ULONG)g(OriginalDa)q(taS)q(iz)q
(e;)120 333 y(};)0 483 y Fi(followed)13 b(by)h Fd(CompInfoSi)q(ze)j
Fi(bytes)d(which)f(contain)g(the)h(decompression)f(tree,)i(after)g(which)e
(there)h(is)g(the)f(com-)0 545 y(pressed)h(chunk)f(\(originally)g
Fd(OriginalDa)q(ta)q(Siz)q(e)k Fi(bytes)c(long\).)24 b(For)14
b(information)f(about)g(the)h(coding)f(used)g(by)0 608 y
Ff(PCHG)p Fi(,)g(see)f(Chapter)g(5)f([Compression],)g(page)h(6.)62
758 y(The)f(unpacked)f(data)h(\(or)g(the)f(data)h(following)e(the)h
Fd(PCHGHeade)q(r)k Fi(in)c(the)g(non-compressed)g(case\))h(are)g(divided)f
(as)0 820 y(follows.)62 971 y(First)16 b(of)f(all,)i(there)f(is)f(a)h
(array)h(of)e Fd(\(LineCoun)q(t+)q(31\))q(/3)q(2)k Fi(longwords)14
b(\(that)i(is,)g(a)g(bit)f(mask)g(of)h(LineCount)0 1033
y(bits)c(rounded)g(up)g(to)g(the)h(nearest)g(longword\).)19
b(Each)13 b(bit)f(in)g(the)g(mask)g(tells)g(you)g(if)h(there)g(are)g
(palette)f(changes)h(in)f(the)0 1096 y(corresponding)g(line.)21
b(Bit)12 b(0)h(of)g(the)f(mask)h(\(i.e.,)h(bit)e(31)h(of)f(the)h(\256rst)g
(longword\))f(corresponds)g(to)h(line)f Fd(StartLine)q Fi(,)0
1158 y(bit)f(1)i(\(i.e.,)g(bit)f(30)g(of)g(the)g(\256rst)g(longword\))g
(to)f(line)h Fd(StartLine)q(+1)k Fi(and)c(so)g(on.)19 b(The)12
b(number)g(of)g(1')m(s)g(will)g(be)g(equal)0 1220 y(to)f
Fd(ChangedLi)q(nes)q Fi(.)20 b(Note)11 b(that)g Fd(StartLine)k
Fi(is)c(a)g(\(possibly)f(negative\))h(of)o(fset)h(from)f(the)g(top)g(of)h
(the)f(screen.)62 1371 y(The)i(information)f(about)g(the)h(palette)f
(changes)h(is)g(stored)f(immediately)g(after)h(the)g(bit)f(mask.)21
b(For)13 b(each)h(bit)e(set)g(to)0 1433 y(1)g(in)g(the)g(mask)g(there)h
(is)f(a)g(variable)h(length)e(structure.)20 b(These)13 b(structures)f(are)
h(recorded)g(contiguously)m(,)e(and)h(they)g(are)0 1495
y(dif)o(ferent)g(depending)e(on)h(the)g Fd(PCHGF_12)q(BIT)k
Fi(or)c(the)h Fd(PCHGF_32BI)q(T)i Fi(\257ags)e(being)f(set.)16
b(In)c(the)f(\256rst)g(case,)i(we)e(use)120 1633 y Fd(struct)30
b(SmallLineC)q(ha)q(nge)q(s)h({)202 1683 y(UBYTE)f(ChangeCoun)q(t16)q(;)
202 1733 y(UBYTE)g(ChangeCoun)q(t32)q(;)202 1783 y(UWORD)g(PaletteCha)q
(nge)q([])q(;)120 1832 y(};)0 1983 y Fi(The)17 b Fd(PaletteCha)q(nge)j
Fi(array)e(contains)d Fd(ChangeCo)q(unt)q(16)q(+Ch)q(an)q(geC)q(ou)q(nt3)q
(2)20 b Fi(elements.)31 b(For)17 b(each)h(ele-)0 2045 y(ment,)10
b(the)h(lower)f(12)g(bits)g(specify)g(a)h(color)f(in)g(4-bit)g
Ff(RGB)h Fi(form,)g(while)f(the)g(upper)h(4)f(bits)g(specify)g(the)g
(register)h(number)m(.)0 2107 y(More)h(precisely)m(,)h(for)f(the)g
(\256rst)g Fd(ChangeCou)q(nt1)q(6)j Fi(elements)d(you)f(take)i(as)f
(register)g(number)f(the)h(upper)g(4)g(bits,)g(and)0 2170
y(for)g(the)f(following)g Fd(ChangeCoun)q(t3)q(2)k Fi(elements)c(you)g
(take)h(as)f(register)h(number)f(the)h(upper)g(4)f(bits)p
Fd(+)p Fi(16.)17 b(Thus,)12 b(you)0 2232 y(can)g(address)f(a)h(32)f
(register)g(palette.)62 2383 y(In)h(the)f(second)g(case,)i(we)e(use)120
2521 y Fd(struct)30 b(BigLineCha)q(ng)q(es)h({)202 2570
y(UWORD)f(ChangeCoun)q(t;)202 2620 y(struct)g(BigPalett)q(eCh)q(an)q(ge)h
(PaletteCha)q(nge)q([])q(;)120 2670 y(};)p eop
%%Page: 6 7
bop 0 -58 a Fi(Chapter)12 b(5:)k(Compression)1477 b(6)0
183 y(where)120 309 y Fd(struct)30 b(BigPalette)q(Ch)q(ang)q(e)h({)202
359 y(UWORD)f(Register;)202 409 y(UBYTE)g(Alpha,)f(Red,)g(Blue,)h(Green;)
120 459 y(};)0 598 y Fi(The)10 b(array)h Fd(PaletteCha)q(nge)j
Fi(contains)9 b Fd(ChangeCoun)q(t)k Fi(elements.)j(For)10
b(each)h(elements,)f(Register)g(speci\256es)g(the)0 660
y(register)j(number)n(,)h(while)f(the)g Fd(Alpha)p Fi(,)k
Fd(Red)p Fi(,)e Fd(Blue)p Fi(,)h Fd(Green)f Fi(values)e(specify)h(the)f
(8-bit)f(content)h(of)h(the)f(respective)0 722 y(channels.)j
Fd(Alpha)d Fi(should)d(be)g(parsed)h(only)f(if)h(the)f Fd(PCHGF_USE)q(_A)q
(LPH)q(A)k Fi(\257ag)d(is)f(set)h(in)f(the)g(header)m(.)18
b(The)11 b(meaning)0 784 y(of)h(the)f Fd(Alpha)j Fi(bits)d(is)g(currently)
h(unde\256ned;)g(it)f(will)g(be)h(speci\256ed)g(later)m(.)19
b(For)12 b(they)f(time)g(being,)h(they)f Fe(must)h Fi(be)g(set)f(to)0
847 y(0.)62 985 y Ff(CMAP)i Fi(and)e Ff(PCHG)i Fi(don')o(t)e(interfere.)18
b(It')m(s)12 b(up)f(to)f(the)i(intelligence)e(of)h(the)h
Ff(IFF)g(ILBM)h Fi(writer)e(using)f Ff(CMAP)j Fi(for)f(the)f(\256rst)0
1048 y(line)g(color)h(register)g(values,)g(and)g(then)g(specifying)f(the)h
(changes)g(from)g(line)f(1)h(\(2)g(for)g(laced)h(pictures\))e(onwards)h
(using)0 1110 y Ff(PCHG)p Fi(.)18 b Ff(CMAP)13 b Fi(has)f(to)e(be)i
(loaded,)g(as)f(speci\256ed)h(by)f(the)g Ff(IFF)h(ILBM)h
Fi(specs.)62 1249 y(Note)j(that)f Ff(PCHG)i Fi(is)e(mainly)f(a)i(time)e
(saver)i(chunk.)29 b(The)16 b(\252right)f(thing\272)f(for)i(a)g(program)f
(should)g(be)g(generating)0 1311 y(at)f(run-time)f(the)g(palette)h
(changes)g(when)f(a)i(picture)e(with)g(more)h(colors)f(than)h(available)f
(on)h(the)f(hardware)i(has)f(to)f(be)0 1373 y(shown.)19
b(However)n(,)13 b(the)f(current)g(computational)f(power)h(make)g(this)g
(goal)f(unrealistic.)19 b Ff(PCHG)14 b Fi(allows)d(to)h(display)f(in)h(a)0
1435 y(very)f(short)g(time)f(images)h(with)f(lot)h(of)g(colors)g(on)f(the)
h(current)h(Amiga)e(hardware.)18 b(It)11 b(can)h(be)f(also)g(used)g(to)g
(write)g(down)0 1498 y(a)h(custom)e(Copper)i(list)e(\(maybe)h(changing)g
(only)g(the)g(background)g(color)g(register\))h(together)f(with)g(an)g
(image.)62 1636 y(Some)k(politeness)e(is)h(required)g(from)g(the)h
Ff(PCHG)g Fi(writer)m(.)27 b Ff(PCHG)16 b Fi(allows)d(you)h(to)g(specify)g
(as)h(many)f(as)g(65535)g(per)0 1699 y(line)f(color)h(changes,)g(which)f
(are)i(a)f(little)e(bit)h(unrealistic)g(on)g(the)g(current)h(hardware.)25
b(Programs)13 b(should)g(never)h(save)0 1761 y(with)9 b(a)i(picture)f
(more)g(changes)g(than)g(available)g(by)g(using)f(Copper)h(lists)f(only)m
(.)16 b(This)9 b(issue)h(is)f(thoroughly)g(explained)g(in)0
1823 y(Chapter)i(6)f([W)n(riting)f(changes],)i(page)f(8.)17
b(Moreover)n(,)11 b(under)f(Release)h(2)f(you)f(may)h(want)g(to)g(set)f
(the)h Fd(USER_COPP)q(ER)q(_)0 1885 y(CLIP)18 b Fi(of)f(your)f
Fd(ColorMap)j Fi(\(via)e(the)f Fd(VideoCont)q(ro)q(l\(\))k
Fi(function\);)e(this)e(will)f(stop)h(your)g(Copper)h(list)e(from)0
1948 y(debording)c(on)g(another)g(screen.)62 2086 y(This)h(kind)h(of)g
(politeness)e(is)i(enforced)h(by)e(the)h(speci\256cation.)22
b(I)13 b(have)g(yet)g(to)g(see)g(people)g(which)f(is)h(interested)f(in)0
2149 y(freezing)j(their)g(machine)f(just)g(in)g(order)h(to)g(view)f(a)h
(picture.)27 b Ff(DMA)16 b Fi(contention)e(is)g(a)h(thing,)g(lockup)f(is)g
(another)h(one.)0 2211 y Ff(PCHG)c Fi(chunks)d(which)h(do)g(not)f(conform)
h(to)g(the)g(rules)g(explained)g(below)f(are)i(to)f(be)g(considered)g
(syntactically)f(incorrect.)0 2273 y(If)13 b(you)f(want)g(specify)h(more)f
(changes)h(than)f(available)h(through)e(the)i(system)e(Copper)i(macro)g
(calls)f Fd(CWAIT/CMO)q(VE)q Fi(,)0 2335 y(please)e(have)g(good)f(reasons)
h(\(such)g(as)g(a)g(new)g(Commodore)g(chip)f(set)h(or)g
Ff(OS)h Fi(upgrade\);)f(otherwise,)g(please)g(use)g(another)0
2398 y(chunk)h(and)g(don')o(t)g(mess)g(up)g(the)g Ff(PCHG)i
Fi(interpretation.)0 2598 y Fg(5)36 b(Compr)o(ession)p eop
%%Page: 7 8
bop 0 -58 a Fi(Chapter)12 b(5:)k(Compression)1477 b(7)62
183 y(\(Caveat:)27 b(you)15 b(don')o(t)h(need)g(to)f(read)i(this)e(if)h
(you're)g(not)f(really)h(interested)g(because)g(there)h(are)f
(ready-to-use)h(C)0 246 y(functions)9 b(for)i(compression)e(and)h
(decompression;)f(moreover)n(,)i(4-bit)f Ff(PCHG)h Fi(chunks)f(are)h
(usually)e(so)h(entropic)f(that)h(the)0 308 y(size)h(gain)g(is)g(less)g
(than)g(the)h(size)f(of)g(the)h(tree,)g(so)f(you)g(shouldn')o(t)f
(compress)h(them.\))62 542 y Ff(PCHG)k Fi(uses)f(a)g(classical)f(static)g
(Huf)o(fmann)h(encoding)f(for)h(the)g(line)f(mask)g(and)h(the)f
Fd(LineChang)q(es)k Fi(array)m(.)25 b(The)0 604 y(coding)13
b(tree)h(is)f(recorded)i(just)d(before)i(the)g(compressed)f(data)h(in)f(a)
h(form)f(which)h(takes)f(1022)g(bytes)g(or)h(less)f(\(usually)0
666 y Fd(\304)p Fi(700\).)40 b(Its)18 b(\(byte\))h(length)f(is)h(stored)f
(in)h(the)g Fd(CompInfoSi)q(ze)j Fi(\256eld)e(of)f(the)f
Fd(PCHGCompH)q(ea)q(der)23 b Fi(structure.)0 729 y(Moreover)n(,)16
b(this)e(form)h(is)f(ready)i(for)f(a)g(fast)g(and)g(short)f(decompression)
g(algorithm\320no)e(preprocessing)j(is)f(needed.)0 791 y(For)h(references)
h(about)e(the)g(Huf)o(fmann)g(encoding,)h(see)f(Sedgewick')m(s)i
Fe(Algorithms)c(in)i(C)p Fi(.)h(Note)f(that)g(the)g(number)g(of)0
853 y(compressed)c(data)g(bits)f(stored)h(is)f(rounded)h(up)g(to)f(a)i
(multiple)d(of)i(32)g(\(the)g(decompression)f(routine)h(knows)f(the)h
(original)0 915 y(length)j(of)h(the)g(data,)h(so)f(the)g(exceeding)g(bits)
f(won')o(t)h(be)g(parsed\).)25 b(Note)14 b(also)g(that)f(left)h(branches)h
(are)f(labelled)g(by)g(0,)0 978 y(right)d(branches)g(are)i(labelled)e(by)g
(1.)62 1212 y(The)j(format)g(of)g(the)f(tree)i(is)e(recursive.)24
b(W)l(e)15 b(start)e(to)h(code)g(from)f(the)h(end)g(of)g(a)g(511)f
Fd(WORD)j Fi(array)m(,)f(and)f(we)g(work)0 1274 y(backwards.)28
b(T)m(o)14 b(code)h(an)g(internal)g(node)f(at)h(the)g(position)e
Fd(WORD)g(*Pos)p Fi(,)18 b(the)d(left)f(subtree)h(is)f(recorded)i(at)f
Fd(Pos-1)0 1336 y Fi(with)e(a)i(code)f(of)g(length)g Fd(t)p
Fi(,)h(and)f(the)g(left)g(subtree)g(is)g(coded)g(at)g Fd(Pos-1-t)p
Fi(.)28 b(Then)14 b(an)g(of)o(fset)g Fd(\(-t-1\)*2)k Fi(is)13
b(stored)0 1399 y(in)f Fd(Pos)p Fi(,)j(and)d(the)g(length)g(of)h(the)f
(resulting)g(coding)f(is)h Fd(1+t+)p Fi(length)i(of)e(the)h(left)f
(subtree)h(code.)20 b(An)13 b(external)f(node)h(is)0 1461
y(coded)e(as)g(the)g(character)i(associated)d(with)h(the)g(ninth)f(bit)g
(set.)17 b(As)10 b(a)i(\256nal)f(optimization,)f(if)h(the)g(left)g
(subtree)g(to)f(code)i(is)0 1523 y(an)g(external)f(node,)h(we)f(just)g
(store)g(the)g(character)i(associated)e(in)g(the)g(place)h(of)f(the)g
(negative)h(of)o(fset)62 1757 y(For)g(instance,)g(the)f(tree)805
2023 y Fd(/\\)778 2085 y(/)55 b(\\)750 2148 y(a)110 b(b)0
2374 y Fi(is)7 b(coded)h(as)g(the)f(word)g(array)i Fd([)j(a)g(|)f(0x100)j
(])e([)f(b)h(])p Fi(.)k(Note)8 b(that)f(without)f(the)i(ninth)e(bit)h
(trick,)h(it)g(would)e(be)i(impossible)0 2436 y(to)j(store)g(this)g(tree,)
h(since)f(it)g(would)f(be)i(confused)f(with)g(the)g(tree)h(formed)f(by)g
(the)g(external)h(node)f(b)g(only)m(.)62 2670 y(Another)g(simple)g
(example:)p eop
%%Page: 8 9
bop 0 -58 a Fi(Chapter)12 b(6:)k(W)n(riting)11 b(changes)1420
b(8)750 227 y Fd(/\\)723 290 y(/)55 b(\\)695 352 y(/)110
b(\\)668 414 y(/\\)g(/\\)641 476 y(/)55 b(\\)g(/)g(\\)613
539 y(a)83 b(b)55 b(c)g(/\\)860 601 y(/)g(\\)832 663 y(d)110
b(e)0 856 y Fi(is)11 b(coded)g(as)120 981 y Fd([)28 b(d)g(|)f(0x100)j(])e
([)f(e)h(])g([)g(c)g(|)f(0x100)j(])e([)f(-4)h(])g([)g(a)g(|)g(0x100)h(])f
([)g(b)f(])h([)g(-6)g(].)62 1119 y Fi(Decompression)11 b(is)g(very)g(easy)
m(.)17 b(W)l(e)12 b(start)f(from)h(the)f(end)g(of)h(the)f(tree)h(code.)62
1258 y(If)k(we)g(pick)f(a)h(0)f(bit)g(in)g(the)g(packed)h(data,)h(we)f
(move)f(a)h(word)f(to)g(the)g(left)h(and)f(fetch)h(the)f(current)h(word.)
29 b(If)16 b(it')m(s)0 1320 y(positive)c(and)h(with)g(the)g(ninth)f(bit)g
(set)h(the)g(tree)h(is)f(\256nished)g(and)g(we)g(store)g(to)g(the)g
(destination)f(the)h(lower)g(byte)g(of)g(the)0 1382 y(word)e(we)h
(fetched,)g(otherwise)f(we)h(pick)f(another)g(bit.)62 1520
y(If)k(we)g(pick)f(a)h(1)f(bit,)h(we)g(fetch)g(the)f(current)h(word.)26
b(If)15 b(it')m(s)f(positive,)g(we)h(store)f(it.)26 b(Otherwise)14
b(we)h(add)f(it)g(to)g(the)0 1583 y(current)h(position)f(and)h(we)g(pick)g
(another)g(bit.)27 b(\(Here)16 b(you)e(can)i(see)f(the)g(reason)g(why)g
(the)g(of)o(fset)g(is)g(not)f(stored)h(as)g(a)0 1645 y(word)c(of)o(fset,)h
(but)e(rather)h(as)h(a)f(byte)g(of)o(fset.)16 b(W)l(e)c(avoid)f(a)g
(conversion)f(word-)p Fd(>)p Fi(byte)i(of)o(fset)f(for)g(each)h(bit)e(set)
h(to)f(1)h(of)g(the)0 1707 y(source\).)0 1903 y Fg(6)36
b(W)o(riting)14 b(changes)62 2096 y Ff(PCHG)k Fi(is)f(a)g
(machine-independent)e(format.)33 b(Nonetheless,)18 b(it')m(s)e(been)h
(developed)g(mainly)e(for)i(supporting)e(the)0 2158 y(Amiga)f(Copper)g
(list)g(palette)g(changes.)25 b(Thus,)15 b(it')m(s)f(not)g(a)h(surprise)f
(to)g(\256nd)g(included)g(with)f(the)h(format)g(de\256nition)g(a)0
2221 y(policy)d(about)f(the)i(amount)e(of)i(color)f(changes)g(which)g(you)
g(should)f(write.)62 2359 y(Under)h(the)f(current)h(Amiga)f(hardware)h
(and)f(system)g(software,)h(you)f(should)f(never)i(generate)g(more)f(than)
g(7)h(\(seven\))0 2421 y(changes)i(per)g(line.)20 b(Moreover)n(,)14
b(in)e(laced)h(pictures)f(the)h(changes)g(can)g(only)f(happen)g(on)h(even)
g(lines.)20 b(Thus,)13 b(for)g(a)g(400)0 2483 y(lines)d(laced)i(picture)f
(you)f(have)h(200*7=1400)f(color)g(changes)i(at)f(lines)f(0,)h(2,)h(4,)f
(etc.,)h(while)f(for)g(a)g(256)g(lines)f(non)h(laced)0 2545
y(picture)f(you)f(have)i(256*7=)e(1792)g(color)h(changes)g(at)g(lines)g
(0,)g(1,)h(2,)f(etc.)17 b(Of)10 b(course)h(you)e(can)i(save)f(less)f
(changes,)i(or)f(no)0 2608 y(changes)i(at)g(all)f(on)h(some)f(lines.)17
b(\(When)c(displaying)d(a)i(scrolling)e(play\256eld)i(the)g
Ff(DMA)h Fi(prefetch)f(needed)g(by)g(the)g(video)0 2670
y(hardware)h(limits)c(the)j(changes)f(to)h(5.)17 b(High)11
b(resolution)f(screens)i(with)f(more)h(than)f(5)g(changes)h(can)g(exhibit)
f(glitches)f(in)p eop
%%Page: 9 10
bop 0 -58 a Fi(Chapter)12 b(7:)k(Code)c(and)f(T)m(ools)1432
b(9)0 183 y(some)10 b(positions)f(if)h(scrolled,)h(for)g(instance,)g(with)
f(a)g(viewer)h(which)g(supports)e(the)h(new)h Fd(AUTOSCROL)q(L)j
Fi(screens.)j(This)0 246 y(constraint,)11 b(however)n(,)h(is)f(not)g
(relevant)g(enough)g(to)g(force)h(the)f(general)h(bound)f(to)g(5)g
(changes.\))62 385 y(The)j(point)f(here)i(is)f(that)f(you)h(shouldn')o(t)f
(save)h(more)g(changes)g(than)g(that.)25 b(If)14 b(you)g(want)g(to)f
(write)h(a)h(picture)f(with)0 447 y(more)h(changes,)h(or)f(changes)g(on)f
(odd)g(laced)i(lines,)f(please)g(make)g(aware)g(the)g(user)g(of)g(the)f
(fact)i(that)e(probably)g(most)0 509 y(viewer)e(supporting)f
Ff(PCHG)j Fi(won')o(t)d(be)i(able)f(to)g(display)f(it.)18
b(The)12 b(Amiga)g(community)e(has)i(been)h(already)f(bitten)f(by)h(the)0
572 y(problems)e(of)h Ff(SHAM)h Fi(and)f Ff(CTBL)p Fi(,)i(and)d(we)i(have)
f(neither)f(need)h(nor)g(willing)e(of)i(repeating)g(the)g(experience.)17
b(\(Of)11 b(course,)0 634 y(this)f(limitation)f(pertains)h(to)h(the)g(old)
f(chip)h(set)g(and)f(to)h(the)g(enhanced)g(chip)g(set)g(only;)f(see)h(the)
g(end)g(of)g(this)f(section)g(for)i(a)0 696 y(discussion)e(about)h(the)g
Ff(AGA)h Fi(chip)f(set.\))62 836 y(If)h(you)f(have)h(a)f(technical)h
(background)f(about)f(the)i(Copper)n(,)g(that')m(s)f(why:)62
975 y(The)j(Copper)h(y)f(register)g(has)g(8-bits)f(resolution.)24
b(When)15 b(it)e(arrives)i(at)f(the)g(255th)f(video)h(line,)g(it)g(wraps)g
(up)g(to)g(0.)0 1037 y(Thus,)c(the)g(system)e(places)j(a)f
Fd(WAIT\(226,2)q(55)q(\))j Fi(Copper)d(instruction)e(in)i(order)g(to)g
(stop)f(correctly)h(the)g(video)f(display)0 1099 y(on)i
Ff(P)m(AL)h Fi(screens.)62 1239 y(If)h(you)e(want)g(more)h(than)g(7)f
(changes,)i(you)e(have)h(to)g(start)f(poking)g(the)g(color)h(registers)g
(with)f(the)g(Copper)i(just)d(after)0 1301 y(a)i(video)f(line)h(is)f
(\256nished.)17 b(But)12 b(on)g(the)f(255th)g(video)g(line,)h
Fd(MrgCop\(\))j Fi(will)c(mer)o(ge)h(your)g(user)f(Copper)i(list)d(with)h
(the)0 1363 y(system)e(one)i(in)f(such)g(a)h(way)g(that)f(the)g
Fd(WAIT\(226,)q(255)q(\))k Fi(will)9 b(happen)i Fe(after)f
Fi(the)g(counter)h(wrapped,)g(so)f(the)h(Copper)0 1426 y(will)f(be)h
(locked)f(until)g(the)g(next)h(vertical)f(blank.)16 b(As)11
b(a)g(result,)g(the)f(following)g(color)g(changes)h(won')o(t)g(be)f
(executed,)i(and)0 1488 y(some)f(trash)g(will)f(be)i(displayed)e(at)i(the)
f(bottom)f(of)h(the)h(screen)g(\(this)e(indeed)h(happens)g(with)g
Ff(SHAM)p Fi(\).)62 1627 y(In)i(order)h(to)e(avoid)g(this,)h(it)g(is)f
(necessary)h(to)g(use)g(only)f Fd(WAIT\(0,<li)q(ne)q(>\))k
Fi(instructions.)k(The)13 b(time)f(available)0 1689 y(before)g(the)f
(display)g(data)g(fetch)h(start)f(allows)f(only)h(7)g(color)g(changes,)h
(and)g(wide)f(range)g(experiments)g(con\256rmed)h(this.)62
1829 y(Finally)m(,)c(due)f(to)g(a)g(limitation)g(of)g Fd(MrgCop\(\))p
Fi(,)k(it')m(s)c(not)g(possible)g(specifying)g Fd(WAIT)g
Fi(instructions)g(on)g(odd)g(interlaced)0 1891 y(lines)12
b(\(it)g(is)g(because)i(interlaced)e(screens)i(are)f(displayed)f(in)g(two)
g(passes\).)21 b(It)13 b(is)f(theoretically)g(possible)f(to)h(play)h(with)
0 1953 y(the)f(intermediate)f(copper)h(\(CopIns\))g(instructions)e(in)i
(order)g(to)g(obtain)f(changes)h(on)f(odd)h(interlaced)g(lines,)f(but)h
(this)f(is)0 2016 y(not)g(guaranteed)h(to)e(work)i(in)f(a)g(future)h
(release)g(of)f(the)h(OS.)62 2155 y(The)19 b Ff(AGA)h Fi(chip)f(set,)h
(and)f(future)g(chip)g(sets,)h(have)f(of)g(course)g(much)f(less)h
(stringent)e(limitations.)37 b(However)n(,)0 2217 y(Commodore)11
b(did)g(not)g(still)f(upgrade)i(the)g(Copper)g(and)g(the)f(system)g
(interface)h(to)f(Copper)h(lists.)17 b(This)11 b(means)g(that,)h(for)0
2279 y(the)g(time)f(being,)h(you)g(cannot)f(produce)i(24)e(bit)h(color)f
(changes.)19 b(Moreover)n(,)13 b(the)f(power)g(of)g(the)g(new)g(chip)g
(sets)f(makes)0 2342 y(unnecessary)g(to)f(diddle)f(with)h(palette)g
(changing.)16 b(If,)c(and)e(when,)h(new)g(approaches)f(to)g(Copper)h
(programming)e(will)h(be)0 2404 y(available,)i(this)e(proposal)h(will)f
(be)i(updated)f(and)g(redistributed.)0 2610 y Fg(7)36 b(Code)14
b(and)h(T)-7 b(ools)p eop
%%Page: 10 11
bop 0 -58 a Fi(Chapter)12 b(8:)k(Formal)11 b(speci\256cation)1322
b(10)62 183 y(This)16 b(speci\256cation)g(is)g(distributed)f(with)h(a)h
(complete)f(set)g(of)g(C)h(functions)f(which)g(take)h(care)g(of)g
(compression,)0 246 y(decompression)g(and)h(Copper)g(list)f(building.)34
b(Adding)17 b(support)g(for)h Ff(PCHG)h Fi(in)f(your)f(programs)h(should)e
(be)i(pretty)0 308 y(straightforward:)24 b(you)14 b(simply)g(have)i(to)e
(link)h(with)f Fd(pchg.lib)19 b Fi(\(or)c Fd(pchgr.li)q(b)p
Fi(,)20 b(if)15 b(you)g(want)g(to)g(use)g(register)0 370
y(parameter)e(passing)e(under)h(SAS/C\).)i(Documentation)d(is)h(provided)f
(in)h(the)g(standard)g(Amiga)f(autodoc)h(format)g(\(thus,)0
432 y(you)f(can)h(turn)f(it)f(in)h(an)h(AmigaGuide)e(hypertext)h(document)
g(via)g(the)g(suitable)g(utility\).)62 569 y(A)17 b(simple)e(utility)m(,)i
Fd(ToPCHG)p Fi(,)j(allows)c(to)g(produce)h(sample)f(multipalette)f
(pictures)h(of)g(any)h(kind)f(starting)f(from)0 632 y Ff(SHAM)e
Fi(or)e Ff(CTBL)i Fi(pictures.)k(It)11 b(can)h(be)f(used)g(in)g(order)h
(to)f(test)g(esoteric)g(features.)62 769 y(Ed)18 b(Hanway')m(s)h
Fd(HamLab)i Fi(and)d(Steven)g(Reiz')m(s)i Fd(wasp)g Fi(currently)e
(support)f(conversion)h(to)f(multipalette.)36 b(The)0 831
y(images)11 b(which)g(\(should\))f(accompany)i(this)e(documentation)g
(were)i(produced)f(by)h Fd(HamLab)p Fi(.)0 1009 y Fg(8)36
b(Formal)14 b(speci\256cation)120 1176 y Fd(struct)30 b(PCHGHeader)h({)202
1225 y(UWORD)f(Compressio)q(n;)202 1275 y(UWORD)g(Flags;)202
1325 y(WORD)57 b(StartLine;)202 1375 y(UWORD)30 b(LineCount;)202
1425 y(UWORD)g(ChangedLin)q(es;)202 1474 y(UWORD)g(MinReg;)202
1524 y(UWORD)g(MaxReg;)202 1574 y(UWORD)g(MaxChanges)q(;)202
1624 y(ULONG)g(TotalChang)q(es;)120 1674 y(};)120 1773 y(struct)g
(PCHGCompHe)q(ad)q(er)h({)202 1823 y(ULONG)f(CompInfoSi)q(ze;)202
1873 y(ULONG)g(OriginalDa)q(taS)q(iz)q(e;)120 1923 y(};)120
2022 y(struct)g(SmallLineC)q(ha)q(nge)q(s)h({)202 2072 y(UBYTE)f
(ChangeCoun)q(t16)q(;)202 2122 y(UBYTE)g(ChangeCoun)q(t32)q(;)202
2172 y(UWORD)g(PaletteCha)q(nge)q([])q(;)120 2222 y(};)120
2321 y(struct)g(BigLineCha)q(ng)q(es)h({)202 2371 y(UWORD)f(ChangeCoun)q
(t;)202 2421 y(struct)g(BigPalett)q(eCh)q(an)q(ge)h(PaletteCha)q(nge)q([])
q(;)120 2471 y(};)120 2570 y(struct)f(BigPalette)q(Ch)q(ang)q(e)h({)202
2620 y(UWORD)f(Register;)202 2670 y(UBYTE)g(Alpha,)f(Red,)g(Blue,)h
(Green;)p eop
%%Page: 11 12
bop 0 -58 a Fi(Chapter)12 b(9:)k(Author)11 b(Info)1479 b(11)120
183 y Fd(};)120 283 y(PCHG)29 b(::=)g("PCHG")g(#{)g(\(struct)h(PCHGHeader)
q(\))g(\(LINEDAT)q(A)g(|)e(HUFFCOMPL)q(IN)q(EDA)q(TA)q(\))i(})p
2037 290 21 37 v 120 432 a(HUFFCOMPL)q(INE)q(DA)q(TA)h(::=)d({)g(\(struct)
i(PCHGCompH)q(ea)q(der)q(\))h(TREE)e(HUFFCOMPDA)q(TA)i(})120
482 y(TREE)e(::=)g({)e(UWORD*)j(})120 532 y(HUFFCOMPD)q(ATA)h(::=)e({)f
(ULONG*)h(})120 632 y(HUFFCOMPD)q(ATA)q(,)i(when)e(unpacked,)i(gives)e(a)f
(LINEDATA.)120 781 y(LINEDATA)j(::=)d({)g(LINEMASK)j(\(\(struct)f
(SmallLine)q(Cha)q(ng)q(es\))q(*)h(|)805 831 y(\(struct)f(BigLineCh)q(ang)
q(es)q(\)*\))h(})120 881 y(LINEMASK)g(::=)d({)g(ULONG*)i(})120
980 y(The)f(following)i(relations)g(hold:)120 1080 y(#LINEDATA)g(==)d
(PCHGCompH)q(ea)q(der)q(.O)q(rig)q(in)q(alD)q(ata)q(Si)q(ze)120
1130 y(#TREE)57 b(==)28 b(PCHGCompH)q(ead)q(er)q(.Co)q(mp)q(Inf)q(oS)q
(ize)120 1180 y(#LINEMASK)j(==)d(\(\(PCHGHea)q(de)q(r.L)q(in)q(eCo)q(un)q
(t+3)q(1\)/)q(32)q(\)*4)0 1316 y Ff(PCHG)13 b Fi(is)d(a)i(property)f
(chunk.)16 b(For)c(the)f(meaning)f(of)i(the)f(above)g(grammar)n(,)h(see)f
(the)g Ff(IFF)h Fi(documentation)e(\(the)h(grammar)0 1379
y(does)g(not)g(give)g(account)h(for)g(all)f(the)g(aspects)h(of)f
Ff(PCHG)i Fi(though\).)k(Note)11 b(that)g(my)g(use)h(of)f(the)h
Fd([])g Fi(notation)e(for)i(variable)0 1441 y(length)f(arrays)h(is)e(not)h
(a)h(C)g(feature,)g(but)f(a)h(shorthand.)0 1628 y Fg(9)36
b(Author)14 b(Info)230 1802 y Fd(Sebastiano)31 b(Vigna)230
1852 y(Via)d(Californi)q(a)j(22)230 1902 y(I-20144)f(Milano)g(MI)230
2001 y(BIX:)f(svigna@bix)q(.co)q(m)230 2051 y(INTERNET:)i(vigna@dsi.)q
(uni)q(mi)q(.it)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
