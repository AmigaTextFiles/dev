%!PS-Adobe-1.0
%%Creator: psgrind
%% File VINIT.PS contains initialization routines for PFONTEDPR.C
userdict begin

/inch { 72 mul } def
/@dlsep { 1 6 div inch neg } def	% default line seperation 
/@BSKIP { .25 inch } def
/@TSIZE { .15 inch } def
/@COMMENTSIZE @TSIZE def		% comment text size
/@CODESIZE @TSIZE def			% code text size
/@STRINGSIZE { .14 inch } def		% string text size
/@PROCSIZE { 3 16 div inch } def	% procedure name size
/@LNUMSIZE { 1.5 16 div inch } def	% line number size
/@BTSIZE { 2 16 div inch } def		% bottom title size
/@TTSIZE { 3 16 div inch } def		% top title size
/@TABWIDTH { 7 inch } def		% width for 80 chars for tabs
/@PAGESIZE { 9.5 inch } def
/@TOPMARGIN { 10.5 inch  } def
/@LMARGIN { .75 inch  } def
/@WIDTH { 7 inch    } def
/@BOTTOM { @TOPMARGIN @PAGESIZE sub } def
/@DOWIDE	false	def		% set if we have to do wide every time
/@2MODE false def			% true if 2 pages per page

/@WIDE {				% execute this function
					% to set up rotated 132 column
					% printouts
	/@WIDTH { 11.0 inch } def 
	/@DOWIDE true def
	} def

/@DOITWIDE {
	 8.5 inch 0 inch moveto
	 90 rotate currentpoint translate
	 .9 .72 scale
	 } def


/@PAGECOUNT { 0 } def

/@CURRENTPROC  () def

/@FILE {
	/@FDATE exch def
	/@FTIME exch def
	/@FNAME exch def
     } def				% (fname) (ftime) (fdate) @FILE


/@DO2	{				% do 2 pages per physical page
	/@2MODE	true def
	@SETUP2
	} def

/@SETUP2	{			% setup a 2 page page
	8.5  inch 0 inch moveto
	90 rotate
	currentpoint translate
	.66 .71 scale			% setup our scale
	} def

/@2OF2 {				% move to the second page of 2
	initmatrix			% clear any change made by @WIDE
	@SETUP2
	8.25 inch 0 inch moveto
	currentpoint translate
	} def


/@SH {					% @SH show the string
	show
     } def

/@C {					% @C begin comment text
	/Times-Italic findfont 
	@COMMENTSIZE scalefont setfont
     } def

/@CE {					% @CE end comment, use code size
	/Times-Roman findfont
	@CODESIZE scalefont setfont
     } def

/@S {					% @S string text begin
	/Courier-Bold findfont
	@STRINGSIZE scalefont setfont
	show				% show the current text
	@CE				% back to code
      } def

/@K {					% @K keyword text begins
	/Times-Bold findfont
	@CODESIZE scalefont setfont
	show
	@CE
      } def

/@RJUST {				% @RJUST right justify current text
	gsave
	dup
	stringwidth
	pop				% discard y value
	@WIDTH @LMARGIN add exch sub	% >> rmargin - delta_x
	currentpoint
	pop
	sub				% >> width - delta_x - currentpoint
	0 rmoveto			% moveto point
	show				% show the string
	grestore
      } def

/@BT {					% @BT bottom title setup
	/Times-Italic findfont
	@BTSIZE scalefont setfont
     } def
	
/@PROC {				% @PROC  new procedure
	dup
	/@CURRENTPROC exch def		% save the current proc	
	/Times-Roman findfont
	@PROCSIZE scalefont setfont
	@RJUST
	@CE
      } def

/@N	{				% @N put a linenumber
	   /Helvetica findfont
	@LNUMSIZE scalefont setfont
	@RJUST
	@CE
	} def

/@PROCC {				% @PROCC continue procedure
	/Times-Roman findfont
	@PROCSIZE scalefont setfont
	(...) exch strcat
	@RJUST
	@CE
     } def

/strcat {				% s1 s2 strcat s3 cat s2 onto s1
	/s2 exch def
	/s1 exch def
	s1 length
	dup /s1l exch def
	s2 length
	add
	string
	/s3 exch def
	s3 0 s1 putinterval		% copy s1
	s3 s1l s2  putinterval		% alldone
	s3
      } def

/@NEXTPAGE {				% the next page routine
	@LMARGIN @BOTTOM @BSKIP sub moveto
	@BT
	@FTIME show
	( ) show
	@FDATE show 
	(Page )
	@PAGECOUNT 1 add dup /@PAGECOUNT exch def 
	(   ) cvs strcat
	( of ) strcat
	@FNAME strcat
	@RJUST				% right print the string
   
	currentdict /@OLDPROC known { 
		@CURRENTPROC @OLDPROC eq
		     {
			@OLDPROC}
		     { @OLDPROC (\261\261) strcat
			@CURRENTPROC strcat}ifelse
		}
	{@CURRENTPROC}ifelse


	(\() strcat @FNAME strcat (\)) strcat
					% string is ready for output
	@TT				% set up for top text
	/@OLDPROC @CURRENTPROC def 	% save current proc as old proc

	@LMARGIN @TOPMARGIN moveto	
	@RJUST				% show the current line
	@LMARGIN @TOPMARGIN moveto
	currentdict /@header known { @header show }if
	@PAGECOUNT 1 and 1 eq @2MODE and {@2OF2}{showpage @2MODE{@SETUP2}if }ifelse
	@NEWPAGE			% set up for new page
     } def

/@Head {				% Do something with the header
	 /@header exch def
       } def

/@TT	{				% setup for top title
	  /Times-Bold findfont
	@TTSIZE scalefont setfont
 	} def

/@NEWPAGE {				% set up a new page
	
	@DOWIDE{@DOITWIDE}if		% do it wide if we have to
	@CE
	@LMARGIN @TOPMARGIN moveto
	0 @dlsep rmoveto		% skip one line
	} def
		
/@NL {					% @NL  new line	
	
	currentpoint
	@dlsep add
	exch pop
	@LMARGIN exch 
	dup /CY exch def moveto		% goto next line
	CY @BOTTOM le {@NEXTPAGE}
	   {}ifelse
      } def

/@TAB {					% go to a tab column
	@TABWIDTH 80 div
	mul				% stack now has tab * space size
	@LMARGIN add
	currentpoint exch pop moveto	% go to that spot
       } def
/@FLUSHPAGE {				% force out the current page
	@NEXTPAGE
	@PAGECOUNT 1 and 1 eq @2MODE and {showpage}if
	/@PAGECOUNT 0 def
	/@CURRENTPROC () def
	/@OLDPROC  () def
	@2MODE {@SETUP2} if
	@NEWPAGE
	} def
	
/@ENDFILE {				% what to do at end of file?
	@NEXTPAGE
	} def
% ------------ Regular text goes here ------------------------------
