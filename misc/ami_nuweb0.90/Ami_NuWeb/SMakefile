CC = sc

OPT = 	VERBOSE UNSCHAR STRMERGE STREQ CPU=ANY OPTIMIZE OPTIMIZERINLINELOCAL \
	UTILITYLIBRARY OPTIMIZERTIME OPTIMIZERALIAS OPTIMIZERCOMPLEXITY=30 \
	OPTIMIZERDEPTH=5 OPTIMIZERRECURDEPTH=3 CONSTLIBBASE \
	DEF=__USE_SYSBASE MATH=IEEE IGNORE=306 NOICONS

CFLAGS = $(OPT)

MAKE   = smake

TARGET = ami_nuweb
VERSION = 0.90

OBJS = main.o pass1.o latex.o html.o output.o input.o scraps.o names.o \
	arena.o global.o

SRCS = main.c pass1.c latex.c html.c output.c input.c scraps.c names.c \
	arena.c global.c

CONTENTS = Makefile SMakefile README literate.bib \
	nuweb.w nuweb.ch $(TARGET).w $(TARGET)doc.dvi \
	$(SRCS) global.h wc.w

AMIGACONTENTS = ami_nuweb0.90.readme \
	catalogs/nuweb.cd catalogs/nuweb.d.ct catalogs/nuweb.h

.SUFFIXES: .dvi .tex .w .hw

.w.tex:
	$(TARGET) $*.w

.hw.tex:
	$(TARGET) $*.hw

.tex.dvi:
	- latex $*.tex

.w.dvi:
	- $(MAKE) $*.tex
	- $(MAKE) $*.dvi

install:
	$(MAKE) $(TARGET)
	- latex $(TARGET)doc.tex

all:
	$(MAKE) $(TARGET).tex
	$(MAKE) $(TARGET)

tgz:	$(TARGET)doc.dvi
	- tar cvf $(TARGET)$(VERSION).tar $(CONTENTS)
	- gzip $(TARGET).tar

lha:	$(TARGET)doc.dvi
	- lha u -r -x $(TARGET)$(VERSION).lha $(TARGET) \
		$(CONTENTS) $(AMIGACONTENTS)

$(TARGET)doc.tex: $(TARGET).tex
	@echo ""
	@echo "To create $(TARGET)doc.tex, replace"
	@echo "\\showcodetrue by \\showcodefalse"
	@echo "in $(TARGET).tex and rename the file."
	@echo ""
	stop

clean:
	- delete \#?.(aux|bak|blg|dvi|log|tex|toc)

veryclean: clean
	- delete \#?.(c|h|o|lnk|bbl|1) $(TARGET).w wc

view:	$(TARGET).dvi
	showdvi $(TARGET).dvi

print:	$(TARGET).dvi
	showdvi $(TARGET).dvi

$(OBJS): global.h catalogs/nuweb.h
main.o: main.c
pass1.o: pass1.c
latex.o: latex.c
html.o: html.c
output.o: output.c
input.o: input.c
scraps.o: scraps.c
names.o: names.c
arena.o: arena.c
global.o: global.c

$(TARGET).w: nuweb.w nuweb.ch
	wmerge nuweb.w nuweb.ch $(TARGET).w

$(TARGET): $(OBJS)
	$(CC) TO $(TARGET) LINK $(OBJS) NOICONS

wc:
	$(TARGET) -n wc.w
	$(CC) TO wc LINK wc.c NOICONS
	latex wc.tex
