	/*******************************************************
	*            JavaScript Email address hider            *
	*            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~            *
	* Generates the JavaScript section to add directly     *
        * into HTML web page code in order to hide email       *
        * addresses from spam spiders.                         *
        * JavaScript code generated is sent to console window  *
        * and to system clipboard.                             *
        *                                                      *
	* Author: Anthony Hoffman                              *
	* Version: 1.0                                         *
	* Date: 06/6/05                                        *
	* Target compiler: SAS/C 6.58                          *
        * OS compatibility: AmigaOS 2.x or higher              *
	*                                                      *
	*******************************************************/


// Set up Workbench window
char __stdiowin[] = "CON:10/10/600/350/JavaScript Email address hider";  // Set console window position & size
char __stdiov37[] = "/AUTO";    // Automatically close console window on program termination


// Program version info
const char version_string[] = "\0$VER:  JavaScript Email hider  ver 1.0  06/6/05  Anthony Hoffman";


// Include files
#include <exec/exec.h>
#include <exec/execbase.h>
#include <exec/memory.h>
#include <dos/dosextens.h>
#include <dos/rdargs.h>
#include <dos/dostags.h>
#include <string.h>
#include <stdio.h>
#include <ctype.h>
#include <dos.h>
#include <proto/dos.h>
#include <proto/exec.h>
#include "clip.h"


// Constant definitions
#define str_length 100



/**********************************************************
main program
Main body of the program.

Arguments: none
Return: none
Working: char output_buffer[], char short_buffer[],
char link_name[], char email_address[], int loop,
struct IOClipReq *clip 
**********************************************************/

int main(void)
{
    // Variable definitions
    char output_buffer[2000];
    char short_buffer[str_length];
    char link_name[str_length];
    char email_address[str_length];
    char subject[str_length];
    int loop;
    struct IOClipReq *clip;
    
    // Print instructions to screen
    printf("\n JavaScript Email address hider\n");
    printf(" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~");
    printf("\n");
    printf("This program will generate the JavaScript code which you can copy from\n");
    printf("this window directly into your HTML code to generate mailto: links which\n");
    printf("are hidden from spam spiders.");
    printf("\n\n\n");
    
    // Prompt user to enter link name
    printf("Enter the name for the email line, E.G.'Email Bob Smith': ");
    gets(link_name);
    printf("\n");
    
    // Prompt user to enter Email address
    printf("Enter the Email address to encode: ");
    gets(email_address);
    printf("\n");
    
    // Prompt user to enter the Email subject
    printf("Enter Email subject to encode: ");
    gets(subject);
    printf("\n\n");
    
    // Announce start of code to copy
    printf("JavaScript code to insert into your HTML document:\n\n");
    
    // Create code in output buffer
    strcpy(output_buffer, "<SCRIPT LANGUAGE=\"JavaScript\" TYPE=\"text/javascript\"> <!--\n");
    strcat(output_buffer, "document.write('<A HREF=\"&#32;&#109;&#97;&#105;&#108;&#116;&#111;&#58;");
    
    // Write email address
    for (loop=0; loop<str_length; loop++)
    {
        // Stop writing if end of line is found
        if(email_address[loop] == NULL)
        {
            break;
        }
        
        strcat(output_buffer, "&#");
        sprintf(short_buffer, "%d", email_address[loop]);
        strcat(output_buffer, short_buffer);
        strcat(output_buffer, ";");
    }
    
    // Write "?SUBJECT="
    strcat(output_buffer, "&#63;&#83;&#85;&#66;&#74;&#69;&#67;&#84;&#61;");
    
    // Write subject
    for (loop=0; loop<str_length; loop++)
    {
        // Stop writing if end of line is found
        if(subject[loop] == NULL)
        {
            break;
        }
        
        strcat(output_buffer, "&#");
        sprintf(short_buffer, "%d", subject[loop]);
        strcat(output_buffer, short_buffer);
        strcat(output_buffer, ";");
    }
         
    // Write end of line and link name
    sprintf(short_buffer, "\">%s</A>');\n", link_name);
    strcat(output_buffer, short_buffer);
    
    // Write last line
    strcat(output_buffer,"// --> </SCRIPT>\n");
    
    // Print buffer contents
    printf("%s", output_buffer);
    
    // Write footer
    printf("\n\n");
   
    // Open clipboard.device unit 0
    if((clip = ClipOpen(0)) == NULL)
    {
        printf("Unable to open clipboard.device unit 0\n\n");
    }
    
    else
    {
        //Send string to clipboard
        ClipWrite(clip, output_buffer, -1);
        
        // Close clipboard.device
        ClipClose(clip);
        
        // Announce clipboard write
        printf("Copied into clipboard, select PASTE in your text editor.\n\n");
    }
        
    // Prompt to exit
    printf("Press any key to exit...");
    
    // Clear keyboard buffer and wait for exit key to be pressed
    rewind(stdin);    
    getch(); 
    
    return(0);    
}

