********************************************************************************
*
*	Program:	Relocate
*	Filename:	Load_SFile.a
*
*	Contents:	Examines and loads source file SFile.
*
*	Language:	68000 Assembler
*
*	Author:		Johannes R. Geiss
*
*	Copyright:	Amigavisions
*
********************************************************************************


*------ Includes
	include 'exec/types.i'
	include 'libraries/dos.i'
	include 'xref.i'
	include 'call.i'


*------ Imports
	XLIB	FreeMem
	xref	OpenData
	xref	DOSError
	xref	SFname
	xref	Exit_Am
	xref	_SysBase


*------ Exports
	xdef	Load_SFile
	xdef	FreeSMem
	xdef	SFMem
	xdef	SFSize


********************************************************************************

	SECTION Load_SFile

*------ Load_SFile procedure
Load_SFile
	movea.l SFname,a0
	bsr	OpenData
	tst.l	d0
	beq.s	1$
	move.l	d0,d2
	bsr	DOSError
	move.l	d2,d0
	bra	Exit_Am
1$	move.l	a0,SFMem
	move.l	d1,SFSize
	rts


*------ Free source file memory
FreeSMem
	move.l	SFMem,d0		; free source file memory
	beq.s	NoFree
	move.l	d0,a1
	move.l	SFSize,d0
	CALLEXE FreeMem
	clr.l	SFMem
NoFree	rts


********************************************************************************

	section DATA

*------ Datafield
SFMem	dc.l	0
SFSize	dc.l	0

	END
