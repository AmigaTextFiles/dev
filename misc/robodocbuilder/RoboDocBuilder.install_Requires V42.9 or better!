; -------------------------------------------------------
; Installer script for RoboDocBuilderPPC V3.0
; -------------------------------------------------------

(set #welcome "This is the installer for RoboDocBuilderPPC V3.0!")

(set #wrongversion
(cat "You have an old version of the program 'Installer' "
     "on your Amiga!\n\n"
     "The installation procedure needs at least Installer 42.9."
     "\n\nPlease check your System & obtain a newer version!"
))

(set #general-help 
(cat "The install script will copy all %s files &"
     "directories to the destination that you specify."
     ""
     "Then it will copy RoboDoc to the command path you supply."
     ""
     "Finally, it will add an Assign RoboDoc: Vol:destination/"
     "statement to your User-Startup file located in the "
     "S: directory."
))

(set #destdir-prompt "Select a Volume & Path where RoboDocBuilderPPC will be added:")

(set #destdir-help   
(cat "Select the volume that you wish to place RoboDocBuilderPPC in."
     "Then select a directory (if any) that will serve as a "
     "parent for RoboDocBuilderPPC.  Example:  Select DH0: as the volume,"
     "then select a directory (such as Programs) & the installer"
     "will make a directory called DH0:Programs/RoboDocBuilder, where"
     "the RoboDocBuilderPPC program will be placed."
     "NOTE:"
     "If this is changed in the future, remember to edit the Icon"
     "ToolTypes to reflect the actual location of the program."
))

(set #includedir-prompt "Select a Volume & Path where your Compiler #includes are located:")

(set #includedir-help   
(cat "Select the directory that you wish to place RoboDocBuilder"
     "source #includes in."
))

(set #Cdir-prompt "Select a Path where commands are located (example C:):")

(set #Cdir-help   
(cat "Select the volume & Path that you wish to place RoboDocBuilder"
     "support program(s) in.  I recommend the 'C:' directory."
))

(set #no-diskspace "To install RoboDocBuilderPPC into '%s', you need at least %ld bytes of free harddrive space!")

(set #startup-prompt "An Assign has to be added to S:User-Startup for RoboDocBuilder.")
(set #startup-help   "RoboDocBuilder won't work correctly without this!")

;------------------------------------------------------------------------
; Cleanup any temporary mess we created
(procedure CLEANUP
    ; Nothing to cleanup
    (delete (tackon @default-dest ".tempinstall") (all) (optional "force"))
)   ; CLEANUP

;------------------------------------------------------------------------
; Obtain an installation path
(procedure GETPATH #gp_default #gp_remdir #gp_msg #gp_help

    (set #gp_res "")
    (while (= "" #gp_res)
        (set #gp_res #gp_default)
        (if (not (exists #gp_res (noreq)))
          (
            ; Surfer 1.1 Hack:
            (if (= #gp_res "Work:")
              (
                (set #gp_res "")
                (set #gp_default @default-dest)
              )
            ) ; if

          )
        ) ; if

        (if (OR (= "" #gp_res) (= @user-level 2))
          (
            ; We had a problem. So we need to ask the user!
            (set #gp_res
                (expandpath
                    (askdir
                        (prompt #gp_msg)
                        (help #gp_help)
                        (default #gp_default)
                    )
                )
            )
          )
        ) ; if

        ; If the directory does not exist, retry!
        (if (<> "" #gp_res)
          (
            (if (not (exists #gp_res (noreq)))
                (set #gp_res "")
            ) ; if
          )
        ) ; if
    ) ; while

    ; return the result!
    (set #gp_res #gp_res)

) ; GETPATH

;------------------------------------------------------------------------
; We can't handle this script without Installer 42.9 or better!
(if (< @installer-version 2752521)
  (
    ; Big problem!
    (message #wrongversion)
    (exit (quiet))
  )
)

; find out how the user wants to install things
(welcome #welcome)

(complete 0)

; First find the Destination base:

(set #RDBldDirBase (GETPATH "Work:" TRUE #destdir-prompt #destdir-help))

; Next find the Include base:

(set #IncludeDirBase (GETPATH "Work:" TRUE #includedir-prompt #includedir-help))

; We have to create a drawer "RoboDocBuilder" there!
; if (expr) (true) (false)

(set #RDBldDir (tackon #RDBldDirBase "RoboDocBuilder"))

(set #SrcDir (tackon #RDBldDir "Source"))
    
(copyfiles (prompt "Copying Drawer (Icon file)...")
           (help    @copyfiles-help)
           (source  "ENV:sys/def_Drawer.info")
           (dest    #RDBldDirBase)
           (newname "RoboDocBuilder.info")
)

; Where are we going to place RoboDoc:
(set #CmdDir (GETPATH "C:" TRUE #Cdir-prompt #Cdir-help))

(set @default-dest #RDBldDir)

; If this is a new installation, we check the diskspace!

    (if (not (exists @default-dest))
      (
        ; For a new setup, we should leave some space!
        (if (< (getdiskspace #RDBldDirBase) 5000000)
            (abort (#no-diskspace #RDBldDirBase 5000000))
        )

        (makedir @default-dest)

        (set #TemplateDir (tackon @default-dest "RodoDocTemplates"))
        (makedir #TemplateDir)

        (complete 9)

        (copyfiles (prompt  "Copying RoboDoc (Support Program)...")
                   (help    @copyfiles-help)
                   (source  "RoboDoc")
                   (dest    #CmdDir)
        )

        (copyfiles (prompt  "Copying ToolTypesEditorPPC (Support Program)...")
                   (help    @copyfiles-help)
                   (source  "ToolTypesEditorPPC")
                   (dest    #RDBldDir)
                   (infos)
        )

        (copyfiles (prompt  "Copying .defaults file...")
                   (help    @copyfiles-help)
                   (source  "RoboDocTemplates/RoboDoc.defaults")
                   (dest    #CmdDir)
        )

        (copyfiles (prompt  "Copying Source files...")
                   (help    @copyfiles-help)
                   (source  "RoboDocBuilderLocale.h")
                   (dest    #SrcDir)
        )

        (copyfiles (prompt  "Copying Source files...")
                   (help    @copyfiles-help)
                   (source  "RoboDocBuilder.c")
                   (dest    #SrcDir)
        )

        (copyfiles (prompt  "Copying Source files...")
                   (help    @copyfiles-help)
                   (source  "RoboDocBuilder.cd")
                   (dest    #SrcDir)
        )

        (copyfiles (prompt  "Copying Source files...")
                   (help    @copyfiles-help)
                   (source  "RoboDocBuilder.ct")
                   (dest    #SrcDir)
        )

        (copyfiles (prompt  "Copying Source files...")
                   (help    @copyfiles-help)
                   (source  "SMakeFile")
                   (dest    #SrcDir)
        )

        (copyfiles (prompt  "Copying Source files...")
                   (help    @copyfiles-help)
                   (source  "MakeFile")
                   (dest    #SrcDir)
        )

        (copyfiles (prompt  "Copying Source files...")
                   (help    @copyfiles-help)
                   (source  "cprinit")
                   (dest    #SrcDir)
        )

        (copyfiles (prompt  "Copying Source files...")
                   (help    @copyfiles-help)
                   (source  "CommonFuncsPPC.o")
                   (dest    #SrcDir)
        )

        (complete 25)

        (copyfiles (prompt  "Copying Include files...")
                   (help    @copyfiles-help)
                   (source  "AmigaDOSErrs.h")
                   (dest    #IncludeDirBase)
        )

        (copyfiles (prompt  "Copying Include files...")
                   (help    @copyfiles-help)
                   (source  "CommonFuncs.h")
                   (dest    #IncludeDirBase)
        )

        (copyfiles (prompt  "Copying Include files...")
                   (help    @copyfiles-help)
                   (source  "Author.h")
                   (dest    #IncludeDirBase)
        )

        (copyfiles (prompt  "Copying Help file(s)...")
                   (help    @copyfiles-help)
                   (source  "RoboDocBuilder.guide")
                   (dest    #RDBldDir)
                   (infos)
        )

        (copyfiles (prompt  "Copying CommonFuncs Help file...")
                   (help    @copyfiles-help)
                   (source  "CommonFuncs.guide")
                   (dest    #RDBldDir)
                   (infos)
        )

        (copyfiles (prompt  "Copying ToolTypesEditor Help file...")
                   (help    @copyfiles-help)
                   (source  "ToolTypesEditor.guide")
                   (dest    #RDBldDir)
                   (infos)
        )
        
        (copyfiles (prompt  "Copying .readme file...")
                   (help    @copyfiles-help)
                   (source  "RoboDocBuilderPPC.readme")
                   (dest    #SrcDir)
        )

        (complete 60)

        (copyfiles (prompt  "Copying Example output file...")
                   (help    @copyfiles-help)
                   (source  "RoboDocBuilder.html")
                   (dest    #SrcDir)
        )

        (copyfiles (prompt  "Copying Template files...")
                   (help    @copyfiles-help)
                   (source  "RoboDocTemplates")
                   (dest    #TemplateDir)
                   (pattern "#?") 
        )

        (complete 83)

        (copyfiles (prompt  "Copying Main program...")
                   (help    @copyfiles-help)
                   (source  "RoboDocBuilderPPC")
                   (dest    #RDBldDir)
                   (infos)
        )

        (complete 98)
      )
    )

(startup    "RoboDocBuilderPPC"
   (prompt  "An Assign needs to be added to the \"S:user-startup\".")
   (help    "RoboDocBuilderPPC has to know where to find certain files.")
   (command "Assign RoboDoc: " #RDBldDir)
)

; If we have to add an Assign, we better create one right now
(makeassign "RoboDoc" #RDBldDir)

;------------------------------------------------------------------------
; That's it!

(complete 100)

(CLEANUP)
(exit)

(abort "Well, I tried!")
