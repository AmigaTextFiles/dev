@database "Amigamain.guide"
@author "Matthias Rustler"
@remark "$VER: Mainmaker Guide 1.1 (5.8.2005)"
@remark "Created with golded 7.18 (2.6.4)"

@node MAIN "About"

Generic.tg is an input file for TemGen. It creates the files amigamain.c and amigamain.h.
You can switch on/off several common Amiga features like:
* Command line parameters (ReadArg)
* Tooltype parameters
* open shared libraries
* forbid start from Workbench or Shell
* localisation

  @{"TemGen" link "TEMGEN"}
  @{"How to use" link "HOWTOUSE"}
  @{"Switches" link "SWITCHES"}
  @{"Configuration functions" link "CONFIGURATIONFUNCTIONS"}
  @{"Functions" link "FUNCTIONS"}
  @{"struct Config" link "CONFIG"}
  @{"Application exit" link "EXIT"}

  @{"Copyright" link "COPYRIGHT"}
  @{"Author" link "AUTHOR"}

@endnode

@node TEMGEN "TemGen"

The template generator 'TemGen' has its own documentation.

Some quick notes:
Commands start with '\@' as first character in a line.
Some characters (#, $, ") have a special meaning. If they should appear in the
resulting code they must be prefixed with '\\'. Example '\\#include <stdio.h>'.

@endnode

@node HOWTOUSE "How to use"

Copy the TemGen binary bin/tg to your search path.

Make a copy of generic.tg and open it in an editor.
Ajust the switches and functions to your needs. The switches are at the
beginning and the functions at the end of the #?.tg file.

Run 'tg' with the file. The files amigamain.c and amigamain.h are created.
Normally you shouldn't never change this files manually.

If you want locale support you have to make a copy of generic.cd and add
your strings. Don't remove the existing strings. Create #?_strings.h
for example with 'catcomp app.cd CTFILE app_strings.h'.

Create at least one #?.c file with the application code.

Build the binary.

@endnode

@node SWITCHES "Switches"

You can switch on/off several features. Most of them are bool values. Don't
forget to prefix true and false with a '$' character.

@{b}\@ $version = "MyApp 0.1 (1.1.2004)"@{ub}
Version string (without '\VER:')
Use "" if you don't want a version string

@{b}\@ $application = ["APP_run()", "APP_clean()", "app.h"]@{ub}
The first function is called in 'main' after the libraries have successfully
been opened. The second function is called in the cleanup function.
The third entry is the name of file which is included with '#include "..."'.

@{b}\@ $forbidwb = $false@{ub}
Set this to $true if you don't want the application to start from Workbench

@{b}\@ $forbidcli = $false@{ub}
Set this to $true if you don't want the application to start from Shell

@{b}\@ $opencon = $true@{ub}
If you start your application from Workbench your input/output to stdin, stdout,
Output() and Input() would go to NIL:. $true opens con: windows in auto mode
for stdin, stdout and Output(). This means that up to 3 con: windows are opened.
This is ugly but it's indended as a backdoor if a Workbench application
prints to console.

@{b}\@ $delay = 200@{ub}
The con: windows created with $opencon are closed in the cleanup function.
The delay time in 1/50 seconds gives the user some time to read the content
of the con: windows before they are closed

@{b}\@ $message_request = $true@{ub}
Set this to $true if the message functions shall open an EasyRequest.

@{b}\@ $message_output = $true@{ub}
Set this to $true if the message functions shall print to Output().

@{b}\@ $request_title = "APP Problem"@{ub}
This text is shown as title in the Easyrequest of the message functions
if you don't have locale support.

@{b}\@ $tooltypes = $true@{ub}
$true inserts code to read tooltype arguments

@{b}\@ $readargs = $true@{ub}
$true inserts code to read command line arguments

@{b}\@ $locale = $true@{ub}
$true switches on locale support.

@{b}\@ $loc_builtin = "english"@{ub}
@{b}\@ $loc_header = "app_strings.h"@{ub}
@{b}\@ $loc_catalog = "app.catalog"@{ub}
This are additional parameters for locale support.

@endnode


@node CONFIGURATIONFUNCTIONS "Configuration functions"

@{b}\@ $library( Basevariable, Libraryname, Minversion , Basetype )@{ub}
Inserts code to open and close a shared library.
Use "" for Basetype if it's "struct Library *"

Examples:
\@ $library( "WorkbenchBase" , "workbench.library" , 40 , "" )
\@ $library( "LocaleBase"    , "locale.library"    , 40 , "LocaleBase" )
\@ $library( "TimerBase      , ""                  , 0  , "")
The last one only creates the base variable.

@{u}Note:@{uu}
Most available libraries are already in generig.tg. Just remove the
commend char '#' to switch them on.

@{b}\@ $add_config( type, variable name, default value)@{ub}
Adds a member to struct Config.
Type can be "L" (LONG), "B" (BOOL) or "S" (STRING)

Examples:
\@ $add_config("L", "xvalue", 5)
\@ $add_config("B", "print", "TRUE")
\@ $add_config("S", "pubscreen", "")

@{b}\@ $add_tooltype( tooltype , config variable, type)@{ub}
Querys the icon for a tooltype. If found it is stored in struct Config.
You have to create the config variable with $add_config. The type
of the tooltype must be the same as the type of the config variable.
Tooltypes are case sensitive.

Examples:
\@ $add_tooltype("PUBSCREEN", "pubscreen" , "S")
\@ $add_tooltype("PRINT"    , "print"     , "B")
\@ $add_tooltype("XVALUE"   , "xvalue"    , "L")

@{b}\@ $add_arg( arg, config variable, type)@{ub}
Adds a single entry to the readarg template. If found it is stored
in struct Config. You have to create the config variable with $add_config.
The type of arg must be the same as the type of the config variable.

Examples:
\@ $add_arg( "P=PUBSCREEN/K", "pubscreen", "S")
\@ $add_arg( "XVALUE/N"     , "xvalue"   , "L")
\@ $add_arg( "PRINT/S"      , "print"    , "B")

@{b}\@ $finish_arg()@{ub}
This function must be called after the last $add_arg

@endnode

@node FUNCTIONS "Functions"

The resulting amigamain.c contains this functions:

@{b}LONG show_request( char *title, char *text, char *button, ... );@{ub}
Opens an EasyRequest.

Example:
show_request("Error", "Couldn't open %s %ld", "OK", "foo.library", 32);

@{b}LONG show_request_args( char *title, char *text, char *button, va_list ap );@{ub}
Like show_request, but with va_list

@{b}void vmessagef(char *format, va_list ap);@{ub}
Like vprintf, but you can adjust with switches whether output goes to
Easyrequest and/or Output().

@{b}void messagef(char *format, ... );@{ub}
Like printf, but you can adjust with switches whether output goes to
Easyrequest and/or Output().

@{b}void messagef_loc(LONG msgid, ...);@{ub}
Like messagef, but with msgid as parameter. This function is only created
if you set $locale to $true.

@{b}char *strcpy_malloc(const char *s );@{ub}
Allocates some RAM and copies the string s to it.

@{b}@{u}Important Note@{uu}@{ub}
All vararg parameters must be 32 bit. Use %ld instead of %d.

@endnode

@node CONFIG "Config"

amigamain.h contains the struct Config. The following entries are always created:

@{b}BOOL all_libraries_open:@{ub}
Readonly; TRUE after all libraries have successfully been opended

@{b}BOOL start_from_wb@{ub}
Readonly; TRUE if application was started from Workbench

@{b}struct Window *reqwin@{ub}
Read/Write: reference window for Easyrequest

@{b}BOOL message_request@{ub}
Read/Write: TRUE if message functions shall open EasyRequest

@{b}BOOL message_output@{ub}
Read/Write: TRUE if message functions shall print to Output()


Additional entries are created with $add_config

The variable 'config' is created in amigamain.c

@endnode

@node EXIT "Exit"

The cleanup function is used with 'atexit'. If you want to exit your application
just call 'exit(EXIT_SUCCESS);' and the cleanup function is automatically called.
Query config.all_libraries_open to avoid calling library functions if the
libraries couldn't be opened.

@endnode

@node COPYRIGHT "Copyright"

TemGen is open source (GPL) by Marek Letowski

generic.tg and the examples are public domain.

@endnode

@node AUTHOR "Author"

Please report bugs, changes and feature requests to:

Matthias Rustler
MAIL: mrustler@gmx.de
WWW:  http://www.mazze-online.de

@endnode

