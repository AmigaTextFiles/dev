.key INCDIR/A,PAT/A,HTML/S
.bra [
.ket ]

; $VER: GenIncludeIndex 39.2 (25.7.95)
; by Bruce M. Simpson <bsimpson@touchdwn.demon.co.uk>
;
; Generate an AmigaGuide or HTML index file for the include directory
; specified, descending into directories one level below, and only
; gathering files according to a specified pattern.

if not val [HTML]
; build AmigaGuide header
echo >t:__makeindx_temp_$$ "@database include_index.guide*n@remark Generated on `Date`*n@node main *"Include File Index*"*n@contents *"Autodocs/main*"*n*n@{b}Include Directories@{ub}*n"

; build list of directories
pipe list DIR=[INCDIR] PAT=#? dirs lformat " @{*"%n*" link *"%n*"}" || psort >>t:__makeindx_temp_$$

; build list of files in root of INCDIR
echo >>t:__makeindx_temp_$$ "*n*n@{b}Include Files@{ub}*n"
pipe list DIR=[INCDIR] p=[PAT] files lformat " @{*"%n*" link *"[INCDIR]%n/main*"}" || psort >>t:__makeindx_temp_$$

; append end of node for 'main' (root of INCDIR)
echo >>t:__makeindx_temp_$$ "*n@endnode"

; now create nodes for each directory
list DIR=[INCDIR] PAT=#? dirs lformat "DoIncludeDir [INCDIR] %n [PAT]" >T:__makeindx2_temp_$$
execute T:__makeindx2_temp_$$

; cleanup
copy T:__makeindx_temp_$$ [INCDIR]Include_Index.guide quiet noreq
delete T:__makeindx_temp_$$ T:__makeindx2_temp_$$ FORCE QUIET

else

; build HTML header
echo >t:__makeindx_temp_$$ "<!DOCTYPE HTML PUBLIC *"-//IETF//DTD HTML//EN*">*n<!-- Generated on `Date` -->*n<HTML>*n<HEADER>*n<TITLE>Index of Include Directory [INCDIR]</TITLE>*n</HEADER>*n*n<BODY><P>*n<H2>Include Directories</H2>*n<P>*n<UL>*n"

; build list of directories in root of INCDIR
list DIR=[INCDIR] PAT=#? DIRS LFORMAT "<li><a HREF=*"%n/index.html*">%n</a>" | psort >>t:__makeindx_temp_$$

; build list of files in root of INCDIR
echo >>t:__makeindx_temp_$$ "</ul>*n<P>*n<P>*n<H2>Include Files</H2>*n<P>*n<UL>*n"
list DIR=[INCDIR] PAT=[PAT] files lformat "*<li*>*<a HREF=*"%n*"*>%n*</a*>" | psort >>t:__makeindx_temp_$$

; append end of file for 'Includes_Index.html' (root of INCDIR)
echo >>t:__makeindx_temp_$$ "</ul>*n*n<P><HR><P></BODY></HTML>"

; copy root dir index as it's ready.
copy T:__makeindx_temp_$$ [INCDIR]index.html quiet noreq

; now create nodes for each directory
list DIR=[INCDIR] PAT=#? dirs lformat "DoIncludeDirHTML [INCDIR] %n [PAT]" >T:__makeindx2_temp_$$
execute T:__makeindx2_temp_$$

; cleanup
delete T:__makeindx_temp_$$ T:__makeindx2_temp_$$ FORCE QUIET

endif
