<html>
<head>
<title>Ada 95 RM - 13.13.2 Stream-Oriented Attributes</title>
<link rev="made" href="mailto:Magnus.Kempe@di.epfl.ch">
</head>

<body>
<h4><a href="13-13-01.htm"><img src="left.gif" alt="Prev"></a> | <a href="13-13.htm"><img src="up.gif" alt="Up"></a> | <img src="noright.gif" alt="____"> | <a href="13-13-01.htm"><img src="back.gif" alt="Back"></a> | <a href="13-14.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<hr>
<h3><a name="0">13.13.2 Stream-Oriented Attributes</a></h3>
<dl><dt><a name="1">(1)</a><dd>The Write, Read, Output, and Input attributes convert values to a stream
of elements and reconstruct values from a stream.
</dl><h5 align="center">Static Semantics</h5>
<dl><dt><a name="2">(2)</a><dd>For every subtype S of a specific type T, the following attributes are
defined.
<dt><a name="3">(3)</a><dd>S'Write
<ul>S'Write denotes a procedure with the following specification:
</ul></dl><pre><a name="4">(4)</a>
           procedure S'Write(
              Stream : access Ada.Streams.Root_Stream_Type'Class;
              Item : in T)
</pre><dl><dt><a name="5">(5)</a><dd><ul>S'Write writes the value of Item to Stream.
</ul><dt><a name="6">(6)</a><dd>S'Read
<ul>S'Read denotes a procedure with the following specification:
</ul></dl><pre><a name="7">(7)</a>
           procedure S'Read(
              Stream : access Ada.Streams.Root_Stream_Type'Class;
              Item : out T)
</pre><dl><dt><a name="8">(8)</a><dd><ul>S'Read reads the value of Item from Stream.
</ul><dt><a name="9">(9)</a><dd>For elementary types, the representation in terms of stream elements is
implementation defined.  For composite types, the Write or Read attribute for
each component is called in a canonical order.  The canonical order of
components is last dimension varying fastest for an array, and positional
aggregate order for a record.  Bounds are not included in the stream if T is
an array type.  If T is a discriminated type, discriminants are included only
if they have defaults.  If T is a tagged type, the tag is not included.
<dt><a name="10">(10)</a><dd>For every subtype S'Class of a class-wide type T'Class:
<dt><a name="11">(11)</a><dd>S'Class'Write
<ul>S'Class'Write denotes a procedure with the following
specification:
</ul></dl><pre><a name="12">(12)</a>
           procedure S'Class'Write(
              Stream : access Ada.Streams.Root_Stream_Type'Class;
              Item   : in T'Class)
</pre><dl><dt><a name="13">(13)</a><dd><ul>Dispatches to the subprogram denoted by the Write
attribute of the specific type identified by the tag of Item.
</ul><dt><a name="14">(14)</a><dd>S'Class'Read
<ul>S'Class'Read denotes a procedure with the following
specification:
</ul></dl><pre><a name="15">(15)</a>
           procedure S'Class'Read(
              Stream : access Ada.Streams.Root_Stream_Type'Class;
              Item : out T'Class)
</pre><dl><dt><a name="16">(16)</a><dd><ul>Dispatches to the subprogram denoted by the Read
attribute of the specific type identified by the tag of Item.
</ul></dl><h5 align="center">Implementation Advice</h5>
<dl><dt><a name="17">(17)</a><dd>If a stream element is the same size as a storage element, then the
normal in-memory representation should be used by Read and Write for scalar
objects.  Otherwise, Read and Write should use the smallest number of stream
elements needed to represent all values in the base range of the scalar type.
</dl><h5 align="center">Static Semantics</h5>
<dl><dt><a name="18">(18)</a><dd>For every subtype S of a specific type T, the following attributes are
defined.
<dt><a name="19">(19)</a><dd>S'Output
<ul>S'Output denotes a procedure with the following specification:
</ul></dl><pre><a name="20">(20)</a>
           procedure S'Output(
              Stream : access Ada.Streams.Root_Stream_Type'Class;
              Item : in T)
</pre><dl><dt><a name="21">(21)</a><dd><ul>S'Output writes the value of Item to Stream, including
any bounds or discriminants.
</ul><dt><a name="22">(22)</a><dd>S'Input
<ul>S'Input denotes a function with the following specification:
</ul></dl><pre><a name="23">(23)</a>
           function S'Input(
              Stream : access Ada.Streams.Root_Stream_Type'Class)
              return T
</pre><dl><dt><a name="24">(24)</a><dd><ul>S'Input reads and returns one value from Stream, using
any bounds or discriminants written by a corresponding
S'Output to determine how much to read.
</ul><dt><a name="25">(25)</a><dd>Unless overridden by an attribute_definition_clause, these subprograms
execute as follows:
<dt><a name="26">(26)</a><dd><ul><li>If T is an array type, S'Output first writes the bounds, and
S'Input first reads the bounds.  If T has discriminants without
defaults, S'Output first writes the discriminants (using S'Write
for each), and S'Input first reads the discriminants (using
S'Read for each).
</ul><dt><a name="27">(27)</a><dd><ul><li>S'Output then calls S'Write to write the value of Item to the
stream.  S'Input then creates an object (with the bounds or
discriminants, if any, taken from the stream), initializes it
with S'Read, and returns the value of the object.
</ul><dt><a name="28">(28)</a><dd>For every subtype S'Class of a class-wide type T'Class:
<dt><a name="29">(29)</a><dd>S'Class'Output
<ul>S'Class'Output denotes a procedure with the following
specification:
</ul></dl><pre><a name="30">(30)</a>
           procedure S'Class'Output(
              Stream : access Ada.Streams.Root_Stream_Type'Class;
              Item   : in T'Class)
</pre><dl><dt><a name="31">(31)</a><dd><ul>First writes the external tag of Item to Stream (by
calling String'Output(Tags.External_Tag(Item'Tag) -- <a href="03-09.htm">see 3.9)</a>
and then dispatches to the subprogram denoted by the Output
attribute of the specific type identified by the tag.
</ul><dt><a name="32">(32)</a><dd>S'Class'Input
<ul>S'Class'Input denotes a function with the following
specification:
</ul></dl><pre><a name="33">(33)</a>
           function S'Class'Input(
              Stream : access Ada.Streams.Root_Stream_Type'Class)
              return T'Class
</pre><dl><dt><a name="34">(34)</a><dd><ul>First reads the external tag from Stream and determines
the corresponding internal tag (by calling Tags.Internal_Tag(String'Input(Stream)) -- <a href="03-09.htm">see 3.9)</a> and then dispatches to
the subprogram denoted by the Input attribute of the specific
type identified by the internal tag; returns that result.
</ul><dt><a name="35">(35)</a><dd>In the default implementation of Read and Input for a composite type,
for each scalar component that is a discriminant or whose component_declaration includes a default_expression, a check is made that the value
returned by Read for the component belongs to its subtype.  Constraint_Error
is raised if this check fails.  For other scalar components, no check is
made.  For each component that is of an access type, if the implementation
can detect that the value returned by Read for the component is not a value
of its subtype, Constraint_Error is raised.  If the value is not a value of
its subtype and this error is not detected, the component has an abnormal
value, and erroneous execution can result <a href="13-09-01.htm">(see 13.9.1)</a>.
<dt><a name="36">(36)</a><dd>The stream-oriented attributes may be specified for any type via an
attribute_definition_clause.  All nonlimited types have default implementations for these operations.  An attribute_reference for one of these
attributes is illegal if the type is limited, unless the attribute has been
specified by an attribute_definition_clause.  For an attribute_definition_clause specifying one of these attributes, the subtype of the Item parameter
shall be the base subtype if scalar, and the first subtype otherwise.  The
same rule applies to the result of the Input function.
<p><dt><dd><ul>NOTES</ul>
<dt><a name="37">(37)</a><dd><ul>(31) For a definite subtype S of a type T, only T'Write and T'Read are
needed to pass an arbitrary value of the subtype through a stream.  For
an indefinite subtype S of a type T, T'Output and T'Input will normally
be needed, since T'Write and T'Read do not pass bounds, discriminants,
or tags.
</ul><dt><a name="38">(38)</a><dd><ul>(32) User-specified attributes of S'Class are not inherited by other
class-wide types descended from S.
</ul></dl><h5 align="center">Examples</h5>
<dl><dt><a name="39">(39)</a><dd><em>Example of user-defined Write attribute:
</em>
</dl><pre><a name="40">(40)</a>
       procedure My_Write(
         Stream : access Ada.Streams.Root_Stream_Type'Class; Item : My_Integer'Base);
       for My_Integer'Write use My_Write;
</pre><hr>
<h4><a href="13-13-01.htm"><img src="left.gif" alt="Prev"></a> | <a href="13-13.htm"><img src="up.gif" alt="Up"></a> | <img src="noright.gif" alt="____"> | <a href="13-13-01.htm"><img src="back.gif" alt="Back"></a> | <a href="13-14.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<p>
<a href="http://lglwww.epfl.ch/Ada/"><img src="la-icon.gif" alt="Ada WWW Home"></a>
 -- Email comments, additions, corrections, gripes, kudos, etc. to:
<address>
<a href="author.htm">Magnus Kempe</a>
 -- <a href="mailto:Magnus.Kempe@di.epfl.ch">Magnus.Kempe@di.epfl.ch</a><br>
<a href="cright.htm">Copyright statement</a><br>
Page last generated: 95-03-12
</address>
</body>
</html>
