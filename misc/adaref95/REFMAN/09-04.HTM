<html>
<head>
<title>Ada 95 RM - 9.4 Protected Units and Protected Objects</title>
<link rev="made" href="mailto:Magnus.Kempe@di.epfl.ch">
</head>

<body>
<h4><a href="09-03.htm"><img src="left.gif" alt="Prev"></a> | <a href="09.htm"><img src="up.gif" alt="Up"></a> | <a href="09-05.htm"><img src="right.gif" alt="Next"></a> | <a href="09-03.htm"><img src="back.gif" alt="Back"></a> | <a href="09-05.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<hr>

<h2><a name="0">9.4 Protected Units and Protected Objects</a></h2>
<dl><dt><a name="1">(1)</a><dd>A protected object provides coordinated access to shared data, through
calls on its visible protected operations, which can be protected subprograms
or protected entries.  A protected unit is declared by a protected
declaration, which has a corresponding protected_body.  A protected
declaration may be a protected_type_declaration, in which case it declares a
named protected type; alternatively, it may be a single_protected_declaration, in which case it defines an anonymous protected type, as well as
declaring a named protected object of that type.
</dl><h5 align="center"><a name="syntax">Syntax</a></h5>
<pre><a name="2">(2)</a>
       protected_type_declaration ::=
         protected type defining_identifier [known_discriminant_part] is protected_definition;
<a name="3">(3)</a>
       single_protected_declaration ::=
         protected defining_identifier is protected_definition;
<a name="4">(4)</a>
       protected_definition ::=
           { protected_operation_declaration }
       [ private
           { protected_element_declaration } ]
         end [protected_identifier]
<a name="5">(5)</a>
       protected_operation_declaration ::= subprogram_declaration
            | entry_declaration
            | representation_clause
<a name="6">(6)</a>
       protected_element_declaration ::= protected_operation_declaration
            | component_declaration
<a name="7">(7)</a>
       protected_body ::=
         protected body defining_identifier is
          { protected_operation_item }
         end [protected_identifier];
<a name="8">(8)</a>
       protected_operation_item ::= subprogram_declaration
            | subprogram_body
            | entry_body
            | representation_clause
</pre><dl><dt><a name="9">(9)</a><dd><ul><li>If a protected_identifier appears at the end of a protected_definition or protected_body, it shall repeat the defining_identifier.
</ul></dl><h5 align="center">Legality Rules</h5>
<dl><dt><a name="10">(10)</a><dd>A protected declaration requires a completion, which shall be a
protected_body, and every protected_body shall be the completion of some
protected declaration.
</dl><h5 align="center">Static Semantics</h5>
<dl><dt><a name="11">(11)</a><dd>A protected_definition defines a protected type and its first subtype.
The list of protected_operation_declarations of a protected_definition,
together with the known_discriminant_part, if any, is called the visible part
of the protected unit.  The optional list of protected_element_declarations
after the reserved word private is called the private part of the protected
unit.
</dl><h5 align="center">Dynamic Semantics</h5>
<dl><dt><a name="12">(12)</a><dd>The elaboration of a protected declaration elaborates the protected_definition.  The elaboration of a single_protected_declaration also creates
an object of an (anonymous) protected type.
<dt><a name="13">(13)</a><dd>The elaboration of a protected_definition creates the protected type and
its first subtype; it also includes the elaboration of the component_declarations and protected_operation_declarations in the given order.
<dt><a name="14">(14)</a><dd>As part of the initialization of a protected object, any per-object
constraints <a href="03-08.htm">(see 3.8)</a> are elaborated.
<dt><a name="15">(15)</a><dd>The elaboration of a protected_body has no other effect than to
establish that protected operations of the type can from then on be called
without failing the Elaboration_Check.
<dt><a name="16">(16)</a><dd>The content of an object of a given protected type includes:
<dt><a name="17">(17)</a><dd><ul><li>The values of the components of the protected object, including
(implicitly) an entry queue for each entry declared for the
protected object;
</ul><dt><a name="18">(18)</a><dd><ul><li>A representation of the state of the execution resource
associated with the protected object (one such resource is
associated with each protected object).
</ul><dt><a name="19">(19)</a><dd>The execution resource associated with a protected object has to be
acquired to read or update any components of the protected object; it can be
acquired (as part of a protected action -- <a href="09-05-01.htm">see 9.5.1)</a> either for concurrent
read-only access, or for exclusive read-write access.
<dt><a name="20">(20)</a><dd>As the first step of the finalization of a protected object, each call
remaining on any entry queue of the object is removed from its queue and
Program_Error is raised at the place of the corresponding entry_call_statement.
<p><dt><dd><ul>NOTES</ul>
<dt><a name="21">(21)</a><dd><ul>(13) Within the declaration or body of a protected unit, the name of the
protected unit denotes the current instance of the unit <a href="08-06.htm">(see 8.6)</a>,
rather than the first subtype of the corresponding protected type (and
thus the name cannot be used as a subtype_mark).
</ul><dt><a name="22">(22)</a><dd><ul>(14) A selected_component can be used to denote a discriminant of a
protected object <a href="04-01-03.htm">(see 4.1.3)</a>.  Within a protected unit, the name of a
discriminant of the protected type denotes the corresponding
discriminant of the current instance of the unit.
</ul><dt><a name="23">(23)</a><dd><ul>(15) A protected type is a limited type <a href="07-05.htm">(see 7.5)</a>, and hence has neither
an assignment operation nor predefined equality operators.
</ul><dt><a name="24">(24)</a><dd><ul>(16) The bodies of the protected operations given in the protected_body
define the actions that take place upon calls to the protected
operations.
</ul><dt><a name="25">(25)</a><dd><ul>(17) The declarations in the private part are only visible within the
private part and the body of the protected unit.
</ul></dl><h5 align="center">Examples</h5>
<dl><dt><a name="26">(26)</a><dd><em>Example of declaration of protected type and corresponding body:
</em>
</dl><pre><a name="27">(27)</a>
       protected type Resource is
          entry Seize;
          procedure Release;
       private
          Busy : Boolean := False;
       end Resource;
<a name="28">(28)</a>
       protected body Resource is
          entry Seize when not Busy is
          begin
             Busy := True;
          end Seize;
<a name="29">(29)</a>
          procedure Release is
          begin
             Busy := False;
          end Release;
       end Resource;
</pre><dl><dt><a name="30">(30)</a><dd><em>Example of a single protected declaration and corresponding body:
</em>
</dl><pre><a name="31">(31)</a>
       protected Shared_Array is
          <em>--  Index, Item, and Item_Array are global types</em>
          function  Component    (N : in Index) return Item;
          procedure Set_Component(N : in Index; E : in  Item);
       private
          Table : Item_Array(Index) := (others =&gt; Null_Item);
       end Shared_Array;
<a name="32">(32)</a>
       protected body Shared_Array is
          function Component(N : in Index) return Item is
          begin
             return Table(N);
          end Component;
<a name="33">(33)</a>
          procedure Set_Component(N : in Index; E : in Item) is
          begin
             Table(N) := E;
          end Set_Component;
       end Shared_Array;
</pre><dl><dt><a name="34">(34)</a><dd><em>Examples of protected objects:
</em>
</dl><pre><a name="35">(35)</a>
       Control  : Resource;
       Flags    : array(1 .. 100) of Resource;
</pre><p>
<hr>
<h4><a href="09-03.htm"><img src="left.gif" alt="Prev"></a> | <a href="09.htm"><img src="up.gif" alt="Up"></a> | <a href="09-05.htm"><img src="right.gif" alt="Next"></a> | <a href="09-03.htm"><img src="back.gif" alt="Back"></a> | <a href="09-05.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<p>
<a href="http://lglwww.epfl.ch/Ada/"><img src="la-icon.gif" alt="Ada WWW Home"></a>
 -- Email comments, additions, corrections, gripes, kudos, etc. to:
<address>
<a href="author.htm">Magnus Kempe</a>
 -- <a href="mailto:Magnus.Kempe@di.epfl.ch">Magnus.Kempe@di.epfl.ch</a><br>
<a href="cright.htm">Copyright statement</a><br>
Page last generated: 95-03-12
</address>
</body>
</html>
