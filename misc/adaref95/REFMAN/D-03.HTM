<html>
<head>
<title>Ada 95 RM - D.3 Priority Ceiling Locking</title>
<link rev="made" href="mailto:Magnus.Kempe@di.epfl.ch">
</head>

<body>
<h4><a href="D-02.htm"><img src="left.gif" alt="Prev"></a> | <a href="D.htm"><img src="up.gif" alt="Up"></a> | <a href="D-04.htm"><img src="right.gif" alt="Next"></a> | <a href="D-02-02.htm"><img src="back.gif" alt="Back"></a> | <a href="D-04.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<hr>

<h2><a name="0">D.3 Priority Ceiling Locking</a></h2>
<dl><dt><a name="1">(1)</a><dd>This clause specifies the interactions between priority task scheduling
and protected object ceilings.  This interaction is based on the concept of
the ceiling priority of a protected object.
</dl><h5 align="center"><a name="syntax">Syntax</a></h5>
<dl><dt><a name="2">(2)</a><dd><ul><li>The form of a pragma Locking_Policy is as follows:
</ul></dl><pre><a name="3">(3)</a>
         pragma Locking_Policy(policy_identifier);
</pre><h5 align="center">Legality Rules</h5>
<dl><dt><a name="4">(4)</a><dd>The policy_identifier shall either be Ceiling_Locking or an
implementation-defined identifier.
</dl><h5 align="center">Post-Compilation Rules</h5>
<dl><dt><a name="5">(5)</a><dd>A Locking_Policy pragma is a configuration pragma.
</dl><h5 align="center">Dynamic Semantics</h5>
<dl><dt><a name="6">(6)</a><dd>A locking policy specifies the details of protected object locking.
These rules specify whether or not protected objects have priorities, and the
relationships between these priorities and task priorities.  In addition, the
policy specifies the state of a task when it executes a protected action, and
how its active priority is affected by the locking.  The locking policy is
specified by a Locking_Policy pragma.  For implementation-defined locking
policies, the effect of a Priority or Interrupt_Priority pragma on a
protected object is implementation defined.  If no Locking_Policy pragma
appears in any of the program units comprising a partition, the locking
policy for that partition, as well as the effect of specifying either a
Priority or Interrupt_Priority pragma for a protected object, are
implementation defined.
<dt><a name="7">(7)</a><dd>There is one predefined locking policy, Ceiling_Locking; this policy is
defined as follows:
<dt><a name="8">(8)</a><dd><ul><li>Every protected object has a ceiling priority, which is
determined by either a Priority or Interrupt_Priority pragma as
defined in <a href="D-01.htm">D.1</a>.  The ceiling priority of a protected object (or
ceiling, for short) is an upper bound on the active priority a
task can have when it calls protected operations of that
protected object.
</ul><dt><a name="9">(9)</a><dd><ul><li>The expression of a Priority or Interrupt_Priority pragma is
evaluated as part of the creation of the corresponding protected
object and converted to the subtype System.Any_Priority or
System.Interrupt_Priority, respectively.  The value of the
expression is the ceiling priority of the corresponding protected
object.
</ul><dt><a name="10">(10)</a><dd><ul><li>If an Interrupt_Handler or Attach_Handler pragma <a href="C-03-01.htm">(see C.3.1)</a>
appears in a protected_definition without an Interrupt_Priority
pragma, the ceiling priority of protected objects of that type is
implementation defined, but in the range of the subtype
System.Interrupt_Priority.
</ul><dt><a name="11">(11)</a><dd><ul><li>If no pragma Priority, Interrupt_Priority, Interrupt_Handler, or
Attach_Handler is specified in the protected_definition, then the
ceiling priority of the corresponding protected object is
System.Priority'Last.
</ul><dt><a name="12">(12)</a><dd><ul><li>While a task executes a protected action, it inherits the ceiling
priority of the corresponding protected object.
</ul><dt><a name="13">(13)</a><dd><ul><li>When a task calls a protected operation, a check is made that its
active priority is not higher than the ceiling of the
corresponding protected object; Program_Error is raised if this
check fails.
</ul></dl><h5 align="center">Implementation Permissions</h5>
<dl><dt><a name="14">(14)</a><dd>The implementation is allowed to round all ceilings in a certain
subrange of System.Priority or System.Interrupt_Priority up to the top of
that subrange, uniformly.
<dt><a name="15">(15)</a><dd>Implementations are allowed to define other locking policies, but need
not support more than one such policy per partition.
<dt><a name="16">(16)</a><dd>Since implementations are allowed to place restrictions on code that
runs at an interrupt-level active priority <a href="C-03-01.htm">(see C.3.1</a> and <a href="D-02-01.htm">D.2.1)</a>, the
implementation may implement a language feature in terms of a protected
object with an implementation-defined ceiling, but the ceiling shall be no
less than Priority'Last.
</dl><h5 align="center">Implementation Advice</h5>
<dl><dt><a name="17">(17)</a><dd>The implementation should use names that end with ``_Locking'' for
implementation-defined locking policies.
<p><dt><dd><ul>NOTES</ul>
<dt><a name="18">(18)</a><dd><ul>(16) While a task executes in a protected action, it can be preempted
only by tasks whose active priorities are higher than the ceiling
priority of the protected object.
</ul><dt><a name="19">(19)</a><dd><ul>(17) If a protected object has a ceiling priority in the range of
Interrupt_Priority, certain interrupts are blocked while protected
actions of that object execute.  In the extreme, if the ceiling is
Interrupt_Priority'Last, all blockable interrupts are blocked during
that time.
</ul><dt><a name="20">(20)</a><dd><ul>(18) The ceiling priority of a protected object has to be in the
Interrupt_Priority range if one of its procedures is to be used as an
interrupt handler <a href="C-03.htm">(see C.3)</a>.
</ul><dt><a name="21">(21)</a><dd><ul>(19) When specifying the ceiling of a protected object, one should
choose a value that is at least as high as the highest active priority
at which tasks can be executing when they call protected operations of
that object.  In determining this value the following factors, which can
affect active priority, should be considered: the effect of Set_Priority, nested protected operations, entry calls, task activation, and
other implementation-defined factors.
</ul><dt><a name="22">(22)</a><dd><ul>(20) Attaching a protected procedure whose ceiling is below the
interrupt hardware priority to an interrupt causes the execution of the
program to be erroneous <a href="C-03-01.htm">(see C.3.1)</a>.
</ul><dt><a name="23">(23)</a><dd><ul>(21) On a single processor implementation, the ceiling priority rules
guarantee that there is no possibility of deadlock involving only
protected subprograms (excluding the case where a protected operation
calls another protected operation on the same protected object).
</ul></dl><p>
<hr>
<h4><a href="D-02.htm"><img src="left.gif" alt="Prev"></a> | <a href="D.htm"><img src="up.gif" alt="Up"></a> | <a href="D-04.htm"><img src="right.gif" alt="Next"></a> | <a href="D-02-02.htm"><img src="back.gif" alt="Back"></a> | <a href="D-04.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<p>
<a href="http://lglwww.epfl.ch/Ada/"><img src="la-icon.gif" alt="Ada WWW Home"></a>
 -- Email comments, additions, corrections, gripes, kudos, etc. to:
<address>
<a href="author.htm">Magnus Kempe</a>
 -- <a href="mailto:Magnus.Kempe@di.epfl.ch">Magnus.Kempe@di.epfl.ch</a><br>
<a href="cright.htm">Copyright statement</a><br>
Page last generated: 95-03-12
</address>
</body>
</html>
