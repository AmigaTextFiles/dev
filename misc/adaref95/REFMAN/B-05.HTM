<html>
<head>
<title>Ada 95 RM - B.5 Interfacing with Fortran</title>
<link rev="made" href="mailto:Magnus.Kempe@di.epfl.ch">
</head>

<body>
<h4><a href="B-04.htm"><img src="left.gif" alt="Prev"></a> | <a href="B.htm"><img src="up.gif" alt="Up"></a> | <img src="noright.gif" alt="____"> | <a href="B-04.htm"><img src="back.gif" alt="Back"></a> | <a href="C.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<hr>

<h2><a name="0">B.5 Interfacing with Fortran</a></h2>
<dl><dt><a name="1">(1)</a><dd>The facilities relevant to interfacing with the Fortran language are the
package Interfaces.Fortran and support for the Import, Export and Convention
pragmas with convention_identifier Fortran.
<dt><a name="2">(2)</a><dd>The package Interfaces.Fortran defines Ada types whose representations
are identical to the default representations of the Fortran intrinsic types
Integer, Real, Double Precision, Complex, Logical, and Character in a
supported Fortran implementation.  These Ada types can therefore be used to
pass objects between Ada and Fortran programs.
</dl><h5 align="center">Static Semantics</h5>
<dl><dt><a name="3">(3)</a><dd>The library package Interfaces.Fortran has the following declaration:
</dl><pre><a name="4">(4)</a>
       with Ada.Numerics.Generic_Complex_Types;  <em>-- <a href="G-01-01.htm">see G.1.1</a></em>
       pragma Elaborate_All(Ada.Numerics.Generic_Complex_Types);
       package Interfaces.Fortran is
          pragma Pure(Fortran);
<a name="5">(5)</a>
          type Fortran_Integer is range implementation-defined;
<a name="6">(6)</a>
          type Real             is digits implementation-defined;
          type Double_Precision is digits implementation-defined;
<a name="7">(7)</a>
          type Logical is new Boolean;
<a name="8">(8)</a>
          package Single_Precision_Complex_Types is
             new Ada.Numerics.Generic_Complex_Types (Real);
<a name="9">(9)</a>
          type Complex is new Single_Precision_Complex_Types.Complex;
<a name="10">(10)</a>
          subtype Imaginary is Single_Precision_Complex_Types.Imaginary;
          i : Imaginary renames Single_Precision_Complex_Types.i;
          j : Imaginary renames Single_Precision_Complex_Types.j;
<a name="11">(11)</a>
          type Character_Set is implementation-defined character type;
<a name="12">(12)</a>
          type Fortran_Character is array (Positive range &lt;&gt;) of Character_Set;
          pragma Pack (Fortran_Character);
<a name="13">(13)</a>
          function To_Fortran (Item : in Character) return Character_Set;
          function To_Ada (Item : in Character_Set) return Character;
<a name="14">(14)</a>
          function To_Fortran (Item : in String) return Fortran_Character;
          function To_Ada     (Item : in Fortran_Character) return String;
<a name="15">(15)</a>
          procedure To_Fortran (Item       : in String;
                                Target     : out Fortran_Character;
                                Last       : out Natural);
<a name="16">(16)</a>
          procedure To_Ada (Item     : in Fortran_Character;
                            Target   : out String;
                            Last     : out Natural);
<a name="17">(17)</a>
       end Interfaces.Fortran;
</pre><dl><dt><a name="18">(18)</a><dd>The types Fortran_Integer, Real, Double_Precision, Logical, Complex, and
Fortran_Character are Fortran-compatible.
<dt><a name="19">(19)</a><dd>The To_Fortran and To_Ada functions map between the Ada type Character
and the Fortran type Character_Set, and also between the Ada type String and
the Fortran type Fortran_Character.  The To_Fortran and To_Ada procedures
have analogous effects to the string conversion subprograms found in
Interfaces.COBOL.
</dl><h5 align="center">Implementation Requirements</h5>
<dl><dt><a name="20">(20)</a><dd>An implementation shall support pragma Convention with a Fortran
convention_identifier for a Fortran-eligible type <a href="B-01.htm">(see B.1)</a>.
</dl><h5 align="center">Implementation Permissions</h5>
<dl><dt><a name="21">(21)</a><dd>An implementation may add additional declarations to the Fortran
interface packages.  For example, the Fortran interface package for an
implementation of Fortran 77 (ANSI X3.9-1978) that defines types like
Integer*n, Real*n, Logical*n, and Complex*n may contain the declarations of
types named Integer_Star_n, Real_Star_n, Logical_Star_n, and Complex_Star_n.
(This convention should not apply to Character*n, for which the Ada analog is
the constrained array subtype Fortran_Character (1..n).)  Similarly, the
Fortran interface package for an implementation of Fortran 90 that provides
multiple kinds of intrinsic types, e.g. Integer (Kind=n), Real (Kind=n),
Logical (Kind=n), Complex (Kind=n), and Character (Kind=n), may contain the
declarations of types with the recommended names Integer_Kind_n, Real_Kind_n,
Logical_Kind_n, Complex_Kind_n, and Character_Kind_n.
</dl><h5 align="center">Implementation Advice</h5>
<dl><dt><a name="22">(22)</a><dd>An Ada implementation should support the following interface
correspondences between Ada and Fortran:
<dt><a name="23">(23)</a><dd><ul><li>An Ada procedure corresponds to a Fortran subroutine.
</ul><dt><a name="24">(24)</a><dd><ul><li>An Ada function corresponds to a Fortran function.
</ul><dt><a name="25">(25)</a><dd><ul><li>An Ada parameter of an elementary, array, or record type T is
passed as a T  argument to a Fortran procedure, where T  is the
F                                         F
Fortran type corresponding to the Ada type T, and where the
INTENT attribute of the corresponding dummy argument matches the
Ada formal parameter mode; the Fortran implementation's parameter
passing conventions are used.  For elementary types, a local copy
is used if necessary to ensure by-copy semantics.
</ul><dt><a name="26">(26)</a><dd><ul><li>An Ada parameter of an access-to-subprogram type is passed as a
reference to a Fortran procedure whose interface corresponds to
the designated subprogram's specification.
</ul><p><dt><dd><ul>NOTES</ul>
<dt><a name="27">(27)</a><dd><ul>(17) An object of a Fortran-compatible record type, declared in a
library package or subprogram, can correspond to a Fortran common block;
the type also corresponds to a Fortran ``derived type''.
</ul></dl><h5 align="center">Examples</h5>
<dl><dt><a name="28">(28)</a><dd><em>Example of Interfaces.Fortran:
</em>
</dl><pre><a name="29">(29)</a>
       with Interfaces.Fortran;
       use Interfaces.Fortran;
       procedure Ada_Application is
<a name="30">(30)</a>
          type Fortran_Matrix is array (Integer range &lt;&gt;,
                                        Integer range &lt;&gt;) of Double_Precision;
          pragma Convention (Fortran, Fortran_Matrix);    <em>-- stored in Fortran's</em>
                                                          <em>-- column-major order</em>
          procedure Invert (Rank : in Fortran_Integer; X : in out Fortran_Matrix);
          pragma Import (Fortran, Invert);                <em>-- a Fortran subroutine</em>
<a name="31">(31)</a>
          Rank      : constant Fortran_Integer := 100;
          My_Matrix : Fortran_Matrix (1 .. Rank, 1 .. Rank);
<a name="32">(32)</a>
       begin
<a name="33">(33)</a>
          ...
          My_Matrix := ...;
          ...
          Invert (Rank, My_Matrix);
          ...
<a name="34">(34)</a>
       end Ada_Application;
</pre><p>
<hr>
<h4><a href="B-04.htm"><img src="left.gif" alt="Prev"></a> | <a href="B.htm"><img src="up.gif" alt="Up"></a> | <img src="noright.gif" alt="____"> | <a href="B-04.htm"><img src="back.gif" alt="Back"></a> | <a href="C.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<p>
<a href="http://lglwww.epfl.ch/Ada/"><img src="la-icon.gif" alt="Ada WWW Home"></a>
 -- Email comments, additions, corrections, gripes, kudos, etc. to:
<address>
<a href="author.htm">Magnus Kempe</a>
 -- <a href="mailto:Magnus.Kempe@di.epfl.ch">Magnus.Kempe@di.epfl.ch</a><br>
<a href="cright.htm">Copyright statement</a><br>
Page last generated: 95-03-12
</address>
</body>
</html>
