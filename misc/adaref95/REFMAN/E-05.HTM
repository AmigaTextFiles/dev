<html>
<head>
<title>Ada 95 RM - E.5 Partition Communication Subsystem</title>
<link rev="made" href="mailto:Magnus.Kempe@di.epfl.ch">
</head>

<body>
<h4><a href="E-04.htm"><img src="left.gif" alt="Prev"></a> | <a href="E.htm"><img src="up.gif" alt="Up"></a> | <img src="noright.gif" alt="____"> | <a href="E-04-02.htm"><img src="back.gif" alt="Back"></a> | <a href="F.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<hr>

<h2><a name="0">E.5 Partition Communication Subsystem</a></h2>
<dl><dt><a name="1">(1)</a><dd>The Partition Communication Subsystem (PCS) provides facilities for
supporting communication between the active partitions of a distributed
program.  The package System.RPC is a language-defined interface to the PCS.
An implementation conforming to this Annex shall use the RPC interface to
implement remote subprogram calls.
</dl><h5 align="center">Static Semantics</h5>
<dl><dt><a name="2">(2)</a><dd>The following language-defined library package exists:
</dl><pre><a name="3">(3)</a>
       with Ada.Streams; <em>-- <a href="13-13-01.htm">see 13.13.1</a></em>
       package System.RPC is
<a name="4">(4)</a>
          type Partition_ID is range 0 .. implementation-defined;
<a name="5">(5)</a>
          Communication_Error : exception;
<a name="6">(6)</a>
          type Params_Stream_Type(
             Initial_Size : Ada.Streams.Stream_Element_Count) is new
             Ada.Streams.Root_Stream_Type with private;
<a name="7">(7)</a>
          procedure Read(
             Stream : in out Params_Stream_Type;
             Item : out Ada.Streams.Stream_Element_Array;
             Last : out Ada.Streams.Stream_Element_Offset);
<a name="8">(8)</a>
          procedure Write(
             Stream : in out Params_Stream_Type;
             Item : in Ada.Streams.Stream_Element_Array);
<a name="9">(9)</a>
          <em>-- Synchronous call</em>
          procedure Do_RPC(
             Partition  : in Partition_ID;
             Params     : access Params_Stream_Type;
             Result     : access Params_Stream_Type);
<a name="10">(10)</a>
          <em>-- Asynchronous call</em>
          procedure Do_APC(
             Partition  : in Partition_ID;
             Params     : access Params_Stream_Type);
<a name="11">(11)</a>
          <em>-- The handler for incoming RPCs</em>
          type RPC_Receiver is access procedure(
             Params     : access Params_Stream_Type;
             Result     : access Params_Stream_Type);
<a name="12">(12)</a>
          procedure Establish_RPC_Receiver(
             Partition : in Partition_ID;
             Receiver  : in RPC_Receiver);
<a name="13">(13)</a>
       private
          ... <em>-- not specified by the language</em>
       end System.RPC;
</pre><dl><dt><a name="14">(14)</a><dd>A value of the type Partition_ID is used to identify a partition.
<dt><a name="15">(15)</a><dd>An object of the type Params_Stream_Type is used for identifying the
particular remote subprogram that is being called, as well as marshalling and
unmarshalling the parameters or result of a remote subprogram call, as part
of sending them between partitions.
<dt><a name="16">(16)</a><dd>The Read and Write procedures override the corresponding abstract
operations for the type Params_Stream_Type.
</dl><h5 align="center">Dynamic Semantics</h5>
<dl><dt><a name="17">(17)</a><dd>The Do_RPC and Do_APC procedures send a message to the active partition
identified by the Partition parameter.
<dt><a name="18">(18)</a><dd>After sending the message, Do_RPC blocks the calling task until a reply
message comes back from the called partition or some error is detected by the
underlying communication system in which case Communication_Error is raised
at the point of the call to Do_RPC.
<dt><a name="19">(19)</a><dd>Do_APC operates in the same way as Do_RPC except that it is allowed to
return immediately after sending the message.
<dt><a name="20">(20)</a><dd>Upon normal return, the stream designated by the Result parameter of Do_RPC contains the reply message.
<dt><a name="21">(21)</a><dd>The procedure System.RPC.Establish_RPC_Receiver is called once,
immediately after elaborating the library units of an active partition (that
is, right after the elaboration of the partition) if the partition includes
an RCI library unit, but prior to invoking the main subprogram, if any.  The
Partition parameter is the Partition_ID of the active partition being
elaborated.  The Receiver parameter designates an implementation-provided
procedure called the RPC-receiver which will handle all RPCs received by the
partition from the PCS.  Establish_RPC_Receiver saves a reference to the
RPC-receiver; when a message is received at the called partition, the
RPC-receiver is called with the Params stream containing the message. When
the RPC-receiver returns, the contents of the stream designated by Result is
placed in a message and sent back to the calling partition.
<dt><a name="22">(22)</a><dd>If a call on Do_RPC is aborted, a cancellation message is sent to the
called partition, to request that the execution of the remotely called
subprogram be aborted.
<dt><a name="23">(23)</a><dd>The subprograms declared in System.RPC are potentially blocking
operations.
</dl><h5 align="center">Implementation Requirements</h5>
<dl><dt><a name="24">(24)</a><dd>The implementation of the RPC-receiver shall be reentrant, thereby
allowing concurrent calls on it from the PCS to service concurrent remote
subprogram calls into the partition.
</dl><h5 align="center">Documentation Requirements</h5>
<dl><dt><a name="25">(25)</a><dd>The implementation of the PCS shall document whether the RPC-receiver is
invoked from concurrent tasks.  If there is an upper limit on the number of
such tasks, this limit shall be documented as well, together with the
mechanisms to configure it (if this is supported).
</dl><h5 align="center">Implementation Permissions</h5>
<dl><dt><a name="26">(26)</a><dd>The PCS is allowed to contain implementation-defined interfaces for
explicit message passing, broadcasting, etc. Similarly, it is allowed to
provide additional interfaces to query the state of some remote partition
(given its partition ID) or of the PCS itself, to set timeouts and retry
parameters, to get more detailed error status, etc.  These additional
interfaces should be provided in child packages of System.RPC.
<dt><a name="27">(27)</a><dd>A body for the package System.RPC need not be supplied by the
implementation.
</dl><h5 align="center">Implementation Advice</h5>
<dl><dt><a name="28">(28)</a><dd>Whenever possible, the PCS on the called partition should allow for
multiple tasks to call the RPC-receiver with different messages and should
allow them to block until the corresponding subprogram body returns.
<dt><a name="29">(29)</a><dd>The Write operation on a stream of type Params_Stream_Type should raise
Storage_Error if it runs out of space trying to write the Item into the
stream.
<p><dt><dd><ul>NOTES</ul>
<dt><a name="30">(30)</a><dd><ul>(8) The package System.RPC is not designed for direct calls by user
programs.  It is instead designed for use in the implementation of
remote subprograms calls, being called by the calling stubs generated
for a remote call interface library unit to initiate a remote call, and
in turn calling back to an RPC-receiver that dispatches to the receiving
stubs generated for the body of a remote call interface, to handle a
remote call received from elsewhere.
</ul></dl><p>
<hr>
<h4><a href="E-04.htm"><img src="left.gif" alt="Prev"></a> | <a href="E.htm"><img src="up.gif" alt="Up"></a> | <img src="noright.gif" alt="____"> | <a href="E-04-02.htm"><img src="back.gif" alt="Back"></a> | <a href="F.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<p>
<a href="http://lglwww.epfl.ch/Ada/"><img src="la-icon.gif" alt="Ada WWW Home"></a>
 -- Email comments, additions, corrections, gripes, kudos, etc. to:
<address>
<a href="author.htm">Magnus Kempe</a>
 -- <a href="mailto:Magnus.Kempe@di.epfl.ch">Magnus.Kempe@di.epfl.ch</a><br>
<a href="cright.htm">Copyright statement</a><br>
Page last generated: 95-03-12
</address>
</body>
</html>
