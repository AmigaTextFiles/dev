<html>
<head>
<title>Ada 95 RM - 4.8 Allocators</title>
<link rev="made" href="mailto:Magnus.Kempe@di.epfl.ch">
</head>

<body>
<h4><a href="04-07.htm"><img src="left.gif" alt="Prev"></a> | <a href="04.htm"><img src="up.gif" alt="Up"></a> | <a href="04-09.htm"><img src="right.gif" alt="Next"></a> | <a href="04-07.htm"><img src="back.gif" alt="Back"></a> | <a href="04-09.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<hr>

<h2><a name="0">4.8 Allocators</a></h2>
<dl><dt><a name="1">(1)</a><dd>The evaluation of an allocator creates an object and yields an access
value that designates the object.
</dl><h5 align="center"><a name="syntax">Syntax</a></h5>
<pre><a name="2">(2)</a>
       allocator ::=
          new subtype_indication | new qualified_expression
</pre><h5 align="center">Name Resolution Rules</h5>
<dl><dt><a name="3">(3)</a><dd>The expected type for an allocator shall be a single access-to-object
type whose designated type covers the type determined by the subtype_mark of
the subtype_indication or qualified_expression.
</dl><h5 align="center">Legality Rules</h5>
<dl><dt><a name="4">(4)</a><dd>An initialized allocator is an allocator with a qualified_expression.  An
uninitialized allocator is one with a subtype_indication.  In the subtype_indication of an uninitialized allocator, a constraint is permitted only if
the subtype_mark denotes an unconstrained composite subtype; if there is no
constraint, then the subtype_mark shall denote a definite subtype.
<dt><a name="5">(5)</a><dd>If the type of the allocator is an access-to-constant type, the allocator
shall be an initialized allocator.  If the designated type is limited, the
allocator shall be an uninitialized allocator.
</dl><h5 align="center">Static Semantics</h5>
<dl><dt><a name="6">(6)</a><dd>If the designated type of the type of the allocator is elementary, then
the subtype of the created object is the designated subtype.  If the
designated type is composite, then the created object is always constrained;
if the designated subtype is constrained, then it provides the constraint of
the created object; otherwise, the object is constrained by its initial value
(even if the designated subtype is unconstrained with defaults).
</dl><h5 align="center">Dynamic Semantics</h5>
<dl><dt><a name="7">(7)</a><dd>For the evaluation of an allocator, the elaboration of the subtype_indication or the evaluation of the qualified_expression is performed first.
For the evaluation of an initialized allocator, an object of the designated
type is created and the value of the qualified_expression is converted to the
designated subtype and assigned to the object.
<dt><a name="8">(8)</a><dd>For the evaluation of an uninitialized allocator:
<dt><a name="9">(9)</a><dd><ul><li>If the designated type is elementary, an object of the designated
subtype is created and any implicit initial value is assigned;
</ul><dt><a name="10">(10)</a><dd><ul><li>If the designated type is composite, an object of the designated
type is created with tag, if any, determined by the subtype_mark
of the subtype_indication; any per-object constraints on
subcomponents are elaborated and any implicit initial values for
the subcomponents of the object are obtained as determined by the
subtype_indication and assigned to the corresponding subcomponents.      A check is made that the value of the object
belongs to the designated subtype.    Constraint_Error is raised
if this check fails.  This check and the initialization of the
object are performed in an arbitrary order.
</ul><dt><a name="11">(11)</a><dd>If the created object contains any tasks, they are activated <a href="09-02.htm">(see 9.2)</a>.
Finally, an access value that designates the created object is returned.
<p><dt><dd><ul>NOTES</ul>
<dt><a name="12">(12)</a><dd><ul>(24) Allocators cannot create objects of an abstract type.  <a href="03-09-03.htm">See 3.9.3</a>.
</ul><dt><a name="13">(13)</a><dd><ul>(25) If any part of the created object is controlled, the initialization
includes calls on corresponding Initialize or Adjust procedures.  See <a href="07-06.htm">7.6</a>.
</ul><dt><a name="14">(14)</a><dd><ul>(26) As explained <a href="13-11.htm">in 13.11</a>, ``Storage Management'', the storage for an
object allocated by an allocator comes from a storage pool (possibly
user defined).  The exception Storage_Error is raised by an allocator if
there is not enough storage.  Instances of Unchecked_Deallocation may be
used to explicitly reclaim storage.
</ul><dt><a name="15">(15)</a><dd><ul>(27) Implementations are permitted, but not required, to provide garbage
collection <a href="13-11-03.htm">(see 13.11.3)</a>.
</ul></dl><h5 align="center">Examples</h5>
<dl><dt><a name="16">(16)</a><dd><em>Examples of allocators:
</em>
</dl><pre><a name="17">(17)</a>
       new Cell'(0, null, null)                          <em>-- initialized explicitly, <a href="03-10-01.htm">see 3.10.1</a></em>
       new Cell'(Value =&gt; 0, Succ =&gt; null, Pred =&gt; null) <em>-- initialized explicitly</em>
       new Cell                                          <em>-- not initialized</em>
<a name="18">(18)</a>
       new Matrix(1 .. 10, 1 .. 20)                      <em>-- the bounds only are given</em>
       new Matrix'(1 .. 10 =&gt; (1 .. 20 =&gt; 0.0))          <em>-- initialized explicitly</em>
<a name="19">(19)</a>
       new Buffer(100)                                   <em>-- the discriminant only is given</em>
       new Buffer'(Size =&gt; 80, Pos =&gt; 0, Value =&gt; (1 .. 80 =&gt; 'A')) <em>-- initializedexplicitly</em>
<a name="20">(20)</a>
       Expr_Ptr'(new Literal)                        <em>-- allocator for access-to-class-wide type, <a href="03-09-01.htm">see 3.9.1</a></em>
       Expr_Ptr'(new Literal'(Expression with 3.5)) <em>-- initialized explicitly</em>
</pre><p>
<hr>
<h4><a href="04-07.htm"><img src="left.gif" alt="Prev"></a> | <a href="04.htm"><img src="up.gif" alt="Up"></a> | <a href="04-09.htm"><img src="right.gif" alt="Next"></a> | <a href="04-07.htm"><img src="back.gif" alt="Back"></a> | <a href="04-09.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<p>
<a href="http://lglwww.epfl.ch/Ada/"><img src="la-icon.gif" alt="Ada WWW Home"></a>
 -- Email comments, additions, corrections, gripes, kudos, etc. to:
<address>
<a href="author.htm">Magnus Kempe</a>
 -- <a href="mailto:Magnus.Kempe@di.epfl.ch">Magnus.Kempe@di.epfl.ch</a><br>
<a href="cright.htm">Copyright statement</a><br>
Page last generated: 95-03-12
</address>
</body>
</html>
