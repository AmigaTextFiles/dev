<html>
<head>
<title>Ada 95 RM - 9.6 Delay Statements, Duration, and Time</title>
<link rev="made" href="mailto:Magnus.Kempe@di.epfl.ch">
</head>

<body>
<h4><a href="09-05.htm"><img src="left.gif" alt="Prev"></a> | <a href="09.htm"><img src="up.gif" alt="Up"></a> | <a href="09-07.htm"><img src="right.gif" alt="Next"></a> | <a href="09-05-04.htm"><img src="back.gif" alt="Back"></a> | <a href="09-07.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<hr>

<h2><a name="0">9.6 Delay Statements, Duration, and Time</a></h2>
<dl><dt><a name="1">(1)</a><dd>A delay_statement is used to block further execution until a specified
expiration time is reached.  The expiration time can be specified either as a
particular point in time (in a delay_until_statement), or in seconds from the
current time (in a delay_relative_statement).  The language-defined package
Calendar provides definitions for a type Time and associated operations,
including a function Clock that returns the current time.
</dl><h5 align="center"><a name="syntax">Syntax</a></h5>
<pre><a name="2">(2)</a>
       delay_statement ::= delay_until_statement | delay_relative_statement
<a name="3">(3)</a>
       delay_until_statement ::= delay until delay_expression;
<a name="4">(4)</a>
       delay_relative_statement ::= delay delay_expression;
</pre><h5 align="center">Name Resolution Rules</h5>
<dl><dt><a name="5">(5)</a><dd>The expected type for the delay_expression in a delay_relative_statement
is the predefined type Duration.  The delay_expression in a delay_until_statement is expected to be of any nonlimited type.
</dl><h5 align="center">Legality Rules</h5>
<dl><dt><a name="6">(6)</a><dd>There can be multiple time bases, each with a corresponding clock, and a
corresponding time type.  The type of the delay_expression in a delay_until_statement shall be a time type -- either the type Time defined in the
language-defined package Calendar (see below), or some other implementation--
defined time type <a href="D-08.htm">(see D.8)</a>.
</dl><h5 align="center">Static Semantics</h5>
<dl><dt><a name="7">(7)</a><dd>There is a predefined fixed point type named Duration, declared in the
visible part of package Standard; a value of type Duration is used to
represent the length of an interval of time, expressed in seconds.  The type
Duration is not specific to a particular time base, but can be used with any
time base.
<dt><a name="8">(8)</a><dd>A value of the type Time in package Calendar, or of some other
implementation-defined time type, represents a time as reported by a
corresponding clock.
<dt><a name="9">(9)</a><dd>The following language-defined library package exists:
</dl><pre><a name="10">(10)</a>
       package Ada.Calendar is
         type Time is private;
<a name="11">(11)</a>
         subtype Year_Number  is Integer range 1901 ..  2099;
         subtype Month_Number is Integer range 1 ..  12;
         subtype Day_Number   is Integer range 1 ..  31;
         subtype Day_Duration is Duration range 0.0 ..  86_400.0;
<a name="12">(12)</a>
         function Clock return Time;
<a name="13">(13)</a>
         function Year   (Date : Time) return Year_Number;
         function Month  (Date : Time) return Month_Number;
         function Day    (Date : Time) return Day_Number;
         function Seconds(Date : Time) return Day_Duration;
<a name="14">(14)</a>
         procedure Split (Date  : in Time;
                          Year    : out Year_Number;
                          Month   : out Month_Number;
                          Day     : out Day_Number;
                          Seconds : out Day_Duration);
<a name="15">(15)</a>
         function Time_Of(Year  : Year_Number;
                          Month   : Month_Number;
                          Day     : Day_Number;
                          Seconds : Day_Duration := 0.0)
          return Time;
<a name="16">(16)</a>
         function "+" (Left : Time;   Right : Duration) return Time;
         function "+" (Left : Duration; Right : Time) return Time;
         function "-" (Left : Time;   Right : Duration) return Time;
         function "-" (Left : Time;   Right : Time) return Duration;
<a name="17">(17)</a>
         function "&lt;" (Left, Right : Time) return Boolean;
         function "&lt;="(Left, Right : Time) return Boolean;
         function "&gt;" (Left, Right : Time) return Boolean;
         function "&gt;="(Left, Right : Time) return Boolean;
<a name="18">(18)</a>
         Time_Error : exception;
<a name="19">(19)</a>
       private
          ... <em>-- not specified by the language</em>
       end Ada.Calendar;
</pre><h5 align="center">Dynamic Semantics</h5>
<dl><dt><a name="20">(20)</a><dd>For the execution of a delay_statement, the delay_expression is first
evaluated.  For a delay_until_statement, the expiration time for the delay is
the value of the delay_expression, in the time base associated with the type
of the expression.  For a delay_relative_statement, the expiration time is
defined as the current time, in the time base associated with relative
delays, plus the value of the delay_expression converted to the type
Duration, and then rounded up to the next clock tick.  The time base
associated with relative delays is as defined <a href="D-09.htm">in D.9</a>, ``Delay Accuracy'' or
is implementation defined.
<dt><a name="21">(21)</a><dd>The task executing a delay_statement is blocked until the expiration
time is reached, at which point it becomes ready again.  If the expiration
time has already passed, the task is not blocked.
<dt><a name="22">(22)</a><dd>If an attempt is made to cancel the delay_statement (as part of an
asynchronous_select or abort -- <a href="09-07-04.htm">see 9.7.4</a> and <a href="09-08.htm">9.8)</a>, the _statement is
cancelled if the expiration time has not yet passed, thereby completing the
delay_statement.
<dt><a name="23">(23)</a><dd>The time base associated with the type Time of package Calendar is
implementation defined.  The function Clock of package Calendar returns a
value representing the current time for this time base.  The
implementation-defined value of the named number System.Tick <a href="13-07.htm">(see 13.7)</a> is an
approximation of the length of the real-time interval during which the value
of Calendar.Clock remains constant.
<dt><a name="24">(24)</a><dd>The functions Year, Month, Day, and Seconds return the corresponding
values for a given value of the type Time, as appropriate to an
implementation-defined timezone; the procedure Split returns all four
corresponding values.  Conversely, the function Time_Of combines a year
number, a month number, a day number, and a duration, into a value of type
Time.  The operators "+" and "-" for addition and subtraction of times and
durations, and the relational operators for times, have the conventional
meaning.
<dt><a name="25">(25)</a><dd>If Time_Of is called with a seconds value of 86_400.0, the value
returned is equal to the value of Time_Of for the next day with a seconds
value of 0.0.  The value returned by the function Seconds or through the
Seconds parameter of the procedure Split is always less than 86_400.0.
<dt><a name="26">(26)</a><dd>The exception Time_Error is raised by the function Time_Of if the actual
parameters do not form a proper date.  This exception is also raised by the
operators "+" and "-" if the result is not representable in the type Time or
Duration, as appropriate.  This exception is also raised by the function Year
or the procedure Split if the year number of the given date is outside of the
range of the subtype Year_Number.
</dl><h5 align="center">Implementation Requirements</h5>
<dl><dt><a name="27">(27)</a><dd>The implementation of the type Duration shall allow representation of
time intervals (both positive and negative) up to at least 86400 seconds (one
day); Duration'Small shall not be greater than twenty milliseconds.  The
implementation of the type Time shall allow representation of all dates with
year numbers in the range of Year_Number; it may allow representation of
other dates as well (both earlier and later).
</dl><h5 align="center">Implementation Permissions</h5>
<dl><dt><a name="28">(28)</a><dd>An implementation may define additional time types <a href="D-08.htm">(see D.8)</a>.
<dt><a name="29">(29)</a><dd>An implementation may raise Time_Error if the value of a
delay_expression in a delay_until_statement of a select_statement represents
a time more than 90 days past the current time.  The actual limit, if any, is
implementation-defined.
</dl><h5 align="center">Implementation Advice</h5>
<dl><dt><a name="30">(30)</a><dd>Whenever possible in an implementation, the value of Duration'Small
should be no greater than 100 microseconds.
<dt><a name="31">(31)</a><dd>The time base for delay_relative_statements should be monotonic; it need
not be the same time base as used for Calendar.Clock.
<p><dt><dd><ul>NOTES</ul>
<dt><a name="32">(32)</a><dd><ul>(31) A delay_relative_statement with a negative value of the
delay_expression is equivalent to one with a zero value.
</ul><dt><a name="33">(33)</a><dd><ul>(32) A delay_statement may be executed by the environment task;
consequently delay_statements may be executed as part of the elaboration
of a library_item or the execution of the main subprogram.  Such
statements delay the environment task <a href="10-02.htm">(see 10.2)</a>.
</ul><dt><a name="34">(34)</a><dd><ul>(33) A delay_statement is an abort completion point and a potentially
blocking operation, even if the task is not actually blocked.
</ul><dt><a name="35">(35)</a><dd><ul>(34) There is no necessary relationship between System.Tick (the
resolution of the clock of package Calendar) and Duration'Small (the
small of type Duration).
</ul><dt><a name="36">(36)</a><dd><ul>(35) Additional requirements associated with delay_statements are given
<a href="D-09.htm">in D.9</a>, ``Delay Accuracy''.
</ul></dl><h5 align="center">Examples</h5>
<dl><dt><a name="37">(37)</a><dd><em>Example of a relative delay statement:
</em>
</dl><pre><a name="38">(38)</a>
       delay 3.0;  <em>-- delay 3.0 seconds</em>
</pre><dl><dt><a name="39">(39)</a><dd><em>Example of a periodic task:
</em>
</dl><pre><a name="40">(40)</a>
       declare
          use Ada.Calendar;
          Next_Time : Time := Clock + Period;
                             <em>-- Period is a global constant of type Duration</em>
       begin
          loop               <em>-- repeated every Period seconds</em>
             delay until Next_Time;
             ... <em>-- perform some actions</em>
             Next_Time := Next_Time + Period;
          end loop;
       end;
</pre><p>
<hr>
<h4><a href="09-05.htm"><img src="left.gif" alt="Prev"></a> | <a href="09.htm"><img src="up.gif" alt="Up"></a> | <a href="09-07.htm"><img src="right.gif" alt="Next"></a> | <a href="09-05-04.htm"><img src="back.gif" alt="Back"></a> | <a href="09-07.htm"><img src="forward.gif" alt="Forward"></a><br>   <a href="toc.htm">TOC --</a> / <a href="toc-l1.htm">--.--</a> / <a href="toc-l2.htm">--.--.--</a> | <a href="index.htm">Index</a> | <a href="search.htm">Search</a> | <a href="syntax.htm">Syntax</a> | <a href="help.htm">Help</a></h4>

<p>
<a href="http://lglwww.epfl.ch/Ada/"><img src="la-icon.gif" alt="Ada WWW Home"></a>
 -- Email comments, additions, corrections, gripes, kudos, etc. to:
<address>
<a href="author.htm">Magnus Kempe</a>
 -- <a href="mailto:Magnus.Kempe@di.epfl.ch">Magnus.Kempe@di.epfl.ch</a><br>
<a href="cright.htm">Copyright statement</a><br>
Page last generated: 95-03-12
</address>
</body>
</html>
