<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>

<HEAD>
<META NAME="Description" CONTENT="Important to program anything in the 3D world of Wild, and even to make objects to be used in Wild.">

	<META NAME="GENERATOR" Content="Visual Page 1.0 for Windows">
	<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=iso-8859-1">
	<TITLE>Wild Philosopy : The 3D world.</TITLE>
</HEAD>

<BODY TEXT="#FFFFFF" BGCOLOR="#000000" LINK="#FF0000" VLINK="#FF6600" ALINK="#FFCC33">

<H3 ALIGN="CENTER"><FONT COLOR="#FFFF00">The Animation Engine...</FONT></H3>
<P></P>

<P>That doc will explain you something about Wild's animation engine. To understand everything, it's VERY important
that you know perfectly the <A HREF="phy-3DWorld.htm">3D World</A> rappresention in Wild, so if you have any doubt
please re-read the doc (or ask me if something is reaaly obscure...).</P>

<P>The most important object in animation is an <FONT COLOR="#00EE00">Action</FONT>. This <FONT COLOR="#66FFFF">defines
a complex movement of an Alien</FONT> (so also an Arena can be animated, because it is also an Alien... remember
?). An action can be something like &quot;kick&quot;, &quot;jump&quot;, &quot;open the door&quot;, &quot;prepare
to shoot&quot;, or anything else wich involves the full Alien.</P>

<P>An Action is split into Moves. <FONT COLOR="#66FFFF">A</FONT> <FONT COLOR="#00EE00">Move</FONT> <FONT COLOR="#66FFFF">defines
a simple movement (so a rotation + traslation) of a Sector</FONT>, so a part of an Alien, for example a leg, an
arm... A Move has a starting time and a duration, and can do a traslation, a rotation, or both.</P>

<P>Those (Actions and Moves) are fixed structs, so they are valid for any Alien. What I mean is that a &quot;jump&quot;
action will contain a list of Moves to move the legs, and a bit more, but will NOT contain the starting time when
the single Alien started jumping.</P>

<P>This is handled by the <FONT COLOR="#00EE00">Doing</FONT> struct. <FONT COLOR="#66FFFF">This is allocated every
time you call the DoAction()</FONT>, and will take the current time (or a specified time) as start, <FONT COLOR="#66FFFF">and
will contain all the temp data, </FONT>the temp ref, and everything is needed to calc the positions <FONT COLOR="#66FFFF">of
any SPECIFIC Alien</FONT>: the Action is the model, the instructions to make someone doing  something, the Doing
is the data of the single animated object. There is also a substruct, the DoingSector, wich contains the data of
the single animated Sector, but is not important for you because is only internally used.</P>

<P>Now some more specific stuff... . We will concentrate on Moves, infact the Action struct contains (nearly) only
a list of moves sorted in starting order... . A Move is defined by: 1) a Starting time, relative to the action's
starting time, so if you set a starting time of 10 means that this move is executed 10 ticks after the DoAction()'s
call time. 2) a Duration, wich means the time needed by this movement to be executed. 3) a CommandList, wich contains
an array of commands to set the X,Y,Z,R,RV. That's the most important part; let's see what those X,Y,Z,R,RV are.</P>

<P><FONT COLOR="#66FFFF">The X,Y,Z are the coords of the origin of the Sector's ref (the ref_O)</FONT>, and are
relative to the parent (so they are the Rel ones). You can set, for these, the C,V or A: the C means the current
value (at the starting time of the move), the V means the speed of changing for this variable, and the A is the
acceleration. So, the position of the ref_O at the tick t (relative to the starting of the move (so t=0 at start
of move)) is:</P>
<PRE>O(Ox,Oy,Oz)</PRE>

<PRE>Ox = CX+t*VX+t^2*AX/2</PRE>

<PRE>Oy = CY+t*VY+t^2*AY/2</PRE>

<PRE>Oz = CZ+t*VZ+t^2*AZ/2</PRE>
<P>The speed vector at the tick t is:</P>
<PRE>V(Vx,Vy,Vz)</PRE>

<PRE>Vx = VX+t*AX</PRE>

<PRE>Vy = VY+t*AY</PRE>

<PRE>Vz = VZ+t*AZ</PRE>
<P>Those are simple cynematic rules...</P>

<P><FONT COLOR="#66FFFF">The R is the rotation of the Sector, and it rotates around the RV vector</FONT>. For R
you can set only V,A : the C makes no sense, you can't set a point where R=0: you can only rotate with a certain
speed and acceleration. (If anybody thinks different and knows a way to set an absolute R, so can set C, tell-me
!). For RV you can only set C, because this is the rotation axis (relative to the parent sector, and passing through
the origin (the ref_O)) and is a vector, and it can't move during the move. If you want it moving, you have to
make it child of another rotating Sector, but we will see some examples later...</P>

<P><FONT COLOR="#66FFFF">An important thing: the C format is 32.0 bit (long integer), the V and A is 16.16 bit
</FONT>(so you can obtain it by having the correct value ang multiplying it for 65536 (=2^16) : this allow fractional
numbers). <FONT COLOR="#66FFFF">The tick unit is 1/50 of second</FONT>. Now, it's done by using a vertical blank
interrupt, so it may be variable depending on the screenmode: I'll fix soon by using a cia timer interrupt...</P>

<P>Let's see some code !</P>
<PRE>static struct WildMoveCommand DropCommands[]={</PRE>

<PRE>	{MOVECOMMAND_SET,TARGET_Y|TARGET_V,-100000},</PRE>

<PRE>	{MOVECOMMAND_SET,TARGET_Y|TARGET_A,1200},</PRE>

<PRE>	{MOVECOMMAND_SET,TARGET_X|TARGET_V,0},</PRE>

<PRE>	{MOVECOMMAND_SET,TARGET_Z|TARGET_V,0},</PRE>

<PRE>	{MOVECOMMAND_END,0,0}};</PRE>
<P>These are the command for the unique move wich defines the Drop action in the Fountain Of Fire demo. As you
see, any drop makes a movement starting with a speed to the high (remember that in Wild the Y axis is positive
in the low part of the screen) and with an acceleration (that we can call gravity) to the bottom. The speed of
X and Z is 0 here, so the movement is vertical. In the demo, these are modified by a Rnd() value. Remember that
you can reutilize the WildMoveCommand array, because when using BuildWildObject() a copy is made. Here is the code
to make an action:</P>
<PRE>   action=BuildWildObjectTags(	WIBU_ObjectType,OBJECT_Action,</PRE>

<PRE>   				WIBU_BuildObject,TRUE,</PRE>

<PRE>   				WIBU_WildApp,SimpleApp,</PRE>

<PRE>   				ATTR_ACTION_SECTORS,1,</PRE>

<PRE>   				ATTR_ACTION_STOPCALL,&amp;KillDropHook,</PRE>

<PRE>   				0,0);</PRE>

<PRE>   BuildWildObjectTags(		WIBU_ObjectType,OBJECT_Move,</PRE>

<PRE>   				WIBU_BuildObject,TRUE,</PRE>

<PRE>   				WIBU_WildApp,SimpleApp,</PRE>

<PRE>   				ATTR_MOVE_SECTORID,1,</PRE>

<PRE>   				ATTR_MOVE_STARTER,0,</PRE>

<PRE>   				ATTR_MOVE_DURATION,200,</PRE>

<PRE>   				ATTR_MOVE_COMMANDLIST,&amp;DropCommands[0],</PRE>

<PRE>   				FRIEND_MOVE_ACTION,action,0,0);</PRE>
<P>The tags explained: the ATTR_ACTION_SECTOR means the number of sectors involved in the action: for example,
if you have to animate a leg, you can have 3 sectors: the topleg, the bottomleg, the foot; here you have just one.
The ATTR_ACTION_STOPCALL is a Hook to be called when the action is finished, here is used to kill the Drop sector.
The ATTR_MOVE_SECTORID is the ID of the sector this move is referred to: here, there is only one. The IDs are assigned
basing in the order you specify the sectors in the DoAction call... see above...</P>
<PRE>   struct WildSector *sects[2]={newdrop,0};</PRE>

<PRE>   DoActionTags(SimpleApp,	WIDA_Alien,SimpleArena,</PRE>

<PRE>   				WIDA_Action,action,</PRE>

<PRE>   				WIDA_Sectors,&amp;sects[0],0,0);</PRE>
<P>That's the call that starts the animation. The tags: WIDA_Alien is the alien wich contains the sectors involved;
WIDA_Action is the action to do; WIDA_Sectors is an array containing the sectors involved in the action. The order
IS meaningful: if you have the &quot;Jump&quot; action, and you decide in the Moves defining that ID 1 is the topleg,
ID 2 is the bottomleg, ID 3 is the foot, you must specify them in this order: topleg,bottomleg,foot.</P>

<P>To complete the whole, remember to call the WildAnimate() in the main cycle...

</BODY>

</HTML>