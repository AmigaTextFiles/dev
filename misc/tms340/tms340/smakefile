LIBFLAGS = libcode nolink nostackcheck saveds ign=93 ign=304 ign=100 ign=161
EXEC_FLAGS = nolibcode link debug=fullflush saveds ign=93 ign=304 ign=100 ign=161

all: tms340class.library A2410.class DirectorII.class ClassTest

# Generate the Basic Class Handle Library :

tms340class.library: BaseClass.o JmpTbl.o
    @echo "*e[32mLinking BaseClass TO tms340class.libray*e[0m"
    @slink libfd tms340class_lib.fd TO tms340class.library \
        FROM lib:libent.o lib:libinit.o JmpTbl.o BaseClass.o \
        libVersion 0 libRevision 1 
    @echo "*e[32mUpdating libs:tms340class.libray...*e[0m"
    @copy tms340class.library libs:
    @avail flush >nil:

BaseClass.o: BaseClass.c
    @echo "*e[32mCompiling the TMS340 BaseClass.c*e[0m"
    @sc $*.c $(LIBFLAGS)

JmpTbl.o: JmpTbl.a
    @echo "*e[32mAssembling the Jumptable for the BaseClass*e[0m"
    @sc $*.a $(LIBFLAGS)
    

# Make the A2410 Class Library :

A2410.class: A2410Class.o A2410ClassFunc.o
    @echo "*e[32mLinking A2410 Class Library TO A2410.class*e[0m"
    @slink libfd A2410Class.fd TO A2410.class \
        FROM lib:libent.o lib:libinit.o A2410ClassFunc.o A2410Class.o \
        libVersion 0 libRevision 1 
    @echo "*e[32mUpdating sys:classes/tms340/A2410.class...*e[0m"
    @copy a2410.class sys:classes/tms340
    @avail flush >nil:

A2410Class.o: A2410Class.c
    @echo "*e[32mCompiling the A2410 Class Library*e[0m"
    @sc $*.c $(LIBFLAGS) debug=ff

A2410ClassFunc.o: A2410ClassFunc.a
    @echo "*e[32massembling the A2410 Function core*e[0m"
    @sc $*.a $(LIBFLAGS) debug=ff

# Make the Director II Class Library :

DirectorII.class: DirectorIIClass.o
    @echo "*e[32mLinking Director II Class Library TO DirectorII.class*e[0m"
    @slink libfd DirectorIIClass.fd TO DirectorII.class FROM lib:libent.o lib:libinit.o DirectorIIClass.o libVersion 0 libRevision 1 
    @echo "*e[32mUpdating sys:classes/tms340/DirectorII.class...*e[0m"
    @copy DirectorII.class sys:classes/tms340
    @avail flush >nil:

DirectorIIClass.o: DirectorIIClass.c
    @echo "*e[32mCompiling the Director II Class Library*e[0m"
    @sc $*.c $(LIBFLAGS)

ClassTest: ClassTest.c
    @echo "*e[32mCompiling the $*.c *e[0m"
    @sc $*.c $(EXEC_FLAGS) 
