TABLE OF CONTENTS

Socket.class/--preface--
Socket.class/ESA_Socket_AllowUDP
Socket.class/ESA_Socket_Child
Socket.class/ESA_Socket_Flags
Socket.class/ESA_Socket_HostName
Socket.class/ESA_Socket_HostPort
Socket.class/ESA_Socket_KeepAlive
Socket.class/ESA_Socket_MsgBufSize
Socket.class/ESA_Socket_NBIO
Socket.class/ESA_Socket_RemoteAddr
Socket.class/ESA_Socket_RemoteIP
Socket.class/ESA_Socket_RequestEvents
Socket.class/ESA_Socket_Resource
Socket.class/ESA_Socket_Socket
Socket.class/ESA_Socket_Type
Socket.class/ESA_Socket_URL
Socket.class/ESA_Socket_UserAgent
Socket.class/ESA_Socket_UserData
Socket.class/ESM_Socket_Close
Socket.class/ESM_Socket_Connect2Host
Socket.class/ESM_Socket_Error
Socket.class/ESM_Socket_EventAccept
Socket.class/ESM_Socket_EventClosed
Socket.class/ESM_Socket_EventConnected
Socket.class/ESM_Socket_EventRead
Socket.class/ESM_Socket_EventWrite
Socket.class/ESM_Socket_Open
Socket.class/ESM_Socket_Read
Socket.class/ESM_Socket_ReadRaw
Socket.class/ESM_Socket_Shutdown
Socket.class/ESM_Socket_Write
Socket.class/--preface--                            Socket.class/--preface--

        Socket.class is a base class for all kinds of communication.  It
        offers basic components of Internet communication and is capable of
        communicating with text based services (SMTP,HTTP,FTP etc.) but can
        be customized with subclassing to suit your needs.

Socket.class/ESA_Socket_AllowUDP            Socket.class/ESA_Socket_AllowUDP

   NAME
        ESA_Socket_AllowUDP -- (V1 ) [IS.], BOOL

   FUNCTION
        This special flag is used by certain classes in order to enable UDP
        communication. TCP communication still remains and is possible.

   SEE ALSO
        EasySocket.class/ESM_Socket_Write

Socket.class/ESA_Socket_Child                  Socket.class/ESA_Socket_Child

   NAME
        ESA_Socket_Child -- (V1 ) [I..], *Object

   FUNCTION
        Add new member.  When the parent object gets disposed all member
        objects are disposed as well.

   BUGS
        Take great care when removing individual objects from an object tree.

   SEE ALSO
        intuition.library/OM_ADDMEMBER

Socket.class/ESA_Socket_Flags                  Socket.class/ESA_Socket_Flags

   NAME
        ESA_Socket_Flags -- (V1 ) [IS.], ULONG

   SPECIAL INPUTS
        ESV_Socket_Flags_Set
        ESV_Socket_Flags_Clear
        ESV_Socket_Flags_NBIO
        ESV_Socket_Flags_AsyncIO
        ESV_Socket_Flags_NoDelay
        ESV_Socket_Flags_OOBInline
        ESV_Socket_Flags_KeepAlive
        ESV_Socket_Flags_Default

   FUNCTION
        Set socket specific flags.

        First you must choose one of the two following:

        ESV_Socket_Flags_Set:
           Set selected options.

        ESV_Socket_Flag_Clear:
           Clear selected options.


        Changeable options are:

        ESV_Socket_Flags_NBIO           - equivalent to ESA_Socket_NBIO
           Default is ON.

        ESV_Socket_Flags_AsyncIO        - equivalent to ESA_Socket_AsyncIO
           Default is ON.

        ESV_Socket_Flags_NoDelay        - equivalent to ESA_Socket_NoDelay
           Default is ON.

        ESV_Socket_Flags_OOBInline      - equivalent to ESA_Socket_OOBInline
           Default is OFF.

        ESV_Socket_Flags_KeepAlive      - equivalent to ESA_Socket_KeepAlive
           Default is OFF.


        Default settings:

        ESV_Socket_Flags_Default
           Default settings.

Socket.class/ESA_Socket_HostName            Socket.class/ESA_Socket_HostName

   NAME
        ESA_Socket_HostName -- (V1 ) [ISG], *STRPTR

   FUNCTION
        Name of the remote host.

Socket.class/ESA_Socket_HostPort            Socket.class/ESA_Socket_HostPort

   NAME
        ESA_Socket_HostPort -- (V1 ) [ISG], LONG

   FUNCTION
        Destination port for connect().

   BUGS
        Valid range is actually UWORD (0...65535)

Socket.class/ESA_Socket_KeepAlive          Socket.class/ESA_Socket_KeepAlive

   NAME
        ESA_Socket_KeepAlive -- (V1 ) [IS.], BOOL

   FUNCTION
        Enables/disables SO_KEEPALIVE option.

        The SO_KEEPALIVE option causes a packet to be sent to the remote
        system if a long time (by default, more than 2 hours) passes with no
        other data being sent or received. This enables detection of a peer
        which has become unreachable (e.g. powered off or disconnected from
        the net).

   SEE ALSO
        bsdsocket.library/setsockop()

Socket.class/ESA_Socket_MsgBufSize        Socket.class/ESA_Socket_MsgBufSize

   NAME
        ESA_Socket_MsgBufSize -- (V1 ) [I..], LONG

   FUNCTION
        Set messaging buffer size. Up to this many bytes can be read at once
        from the networking interface.

        Default is 8192 bytes.

Socket.class/ESA_Socket_NBIO                    Socket.class/ESA_Socket_NBIO

   NAME
        ESA_Socket_NBIO -- (V1 ) [IS.], BOOL

   FUNCTION
        Disables/enables non-blocking I/O.  When FALSE some methods may
        block and Wait() until request is finished by TCP/IP stack.

        Defaults to TRUE.

Socket.class/ESA_Socket_RemoteAddr        Socket.class/ESA_Socket_RemoteAddr

   NAME
        ESA_Socket_RemoteAddr -- (V1 ) [..G], ULONG

   FUNCTION
        Contains an address of the remote peer in binary format.

Socket.class/ESA_Socket_RemoteIP            Socket.class/ESA_Socket_RemoteIP

   NAME
        ESA_Socket_RemoteIP -- (V1 ) [..G], *STRPTR

   FUNCTION
        Contains address of the remote peer in text format.

Socket.class/ESA_Socket_RequestEvents  Socket.class/ESA_Socket_RequestEvents

   NAME
        ESA_Socket_RequestEvents -- (V1 ) [IS.], ULONG

   SPECIAL INPUTS
        ESV_Socket_RequestEvents_Client
        ESV_Socket_RequestEvents_Server
        ESV_Socket_RequestEvents_UDP

   FUNCTION
        Choose which events are notified by bsdsocket.library.  Usually you
        don't need to care about this.

        ESV_Socket_RequestEvents_Client
             This is default. Suitable for the most communication in
             the client side.

        ESV_Socket_Request_Events_Server
             Selects events required for incoming connections.

        ESV_Socket_RequestEvents_IDP
             Selects events suitable for UDP communication.

   SEE ALSO
        bsdsocket.library/setsockop(), socket.h

Socket.class/ESA_Socket_Resource            Socket.class/ESA_Socket_Resource

   NAME
        ESA_Socket_Resource -- (V1 ) [ISG], *STRPTR

   FUNCTION
        Resource part of the URI. This tag is automatically set by
        ESM_Socket_SetURI method call.

   SEE ALSO
        ESM_Socket_SetURI

Socket.class/ESA_Socket_Socket                Socket.class/ESA_Socket_Socket

   NAME
        ESA_Socket_Socket -- (V1 ) [..G], LONG

   FUNCTION
        If you need to use bsdsocket.library interface directly you can use
        this attribute to get socket descriptor.

Socket.class/ESA_Socket_Type                    Socket.class/ESA_Socket_Type

   NAME
        ESA_Socket_Type -- (V1 ) [IS.], LONG

   FUNCTION
        Type of socket.  For class developers only.

        Default is SOCK_STREAM.

Socket.class/ESA_Socket_UserAgent          Socket.class/ESA_Socket_UserAgent

   NAME
        ESA_Socket_UserAgent -- (V1 ) [ISG], *STRPTR

   FUNCTION
        The name of the application doing request. This tag is used to form
        HTTP requests and such.

Socket.class/ESA_Socket_UserData            Socket.class/ESA_Socket_UserData

   NAME
        ESA_Socket_UserData -- (V1 ) [ISG], LONG

   FUNCTION
        Use freely.

Socket.class/ESM_Socket_Close                  Socket.class/ESM_Socket_Close

   NAME
        ESM_Socket_Close (V1 )

   SYNOPSIS
        DoMethod(obj,ESM_Socket_Close);

   FUNCTION
        Closes an underlying connection and frees associated buffers. Does
        nothing if already closed.

Socket.class/ESM_Socket_Error                  Socket.class/ESM_Socket_Error

   NAME
        ESM_Socket_Error (V1 ) [NOTIFY]

   SYNOPSIS
        DoMethod(obj,ESM_Socket_Error,LONG network_error,LONG class_error);
        [For use within custom classes only]

   FUNCTION
        If an error is detected library invokes this method with error value.
        First long contains an error value returned by TCP/IP stack.  May be
        NULL.

   NOTE
        This method is allowed to be invoked by custom class.

Socket.class/ESM_Socket_EventAccept      Socket.class/ESM_Socket_EventAccept

   NAME
        ESM_Socket_EventAccept (V1 ) [NOTIFY]

   SYNOPSIS
        DoMethod(obj,ESM_Socket_EventAccept);
        [For use within custom classes only]

   FUNCTION
        This method is invoked when socket has new connection waiting for an
        accept().

   SEE ALSO
        bsdsocket.library/accept()

Socket.class/ESM_Socket_EventClosed      Socket.class/ESM_Socket_EventClosed

   NAME
        ESM_Socket_EventClosed (V1 ) [NOTIFY]

   SYNOPSIS
        LONG autoDispose = DoMethod(obj,ESM_Socket_EventClosed);
        [For use within custom classes only]

   FUNCTION
        When underlying TCP/IP stack detects connection is closed this method
        is invoked.

   RESULT
        autoDispose - whether dispose object immediately or not.

   EXAMPLE

        myEventClose(struct IClass *cl,Object *obj,struct ESP_EventClosed *msg)
        {
                /* Do your own stuff here */
                .
                .
                .

                return(DoSuperMethodA(cl,obj,msg);
        }

   SEE ALSO
        ESM_Socket_Close

Socket.class/ESM_Socket_EventConnected Socket.class/ESM_Socket_EventConnected

   NAME
        ESM_Socket_EventConnected (V1 ) [NOTIFY]

   SYNOPSIS
        DoMethod(obj,ESM_Socket_EventConnected);
        [For use within custom classes only]

   FUNCTION
        This method is invoked right after the socket has established
        connection to remote host. After this point you can start sending
        data to remote peer.

   SEE ALSO
        ESM_Socket_Open, bsdsocket.library/connect()

Socket.class/ESM_Socket_EventRead          Socket.class/ESM_Socket_EventRead

   NAME
        ESM_Socket_EventRead (V1 ) [NOTIFY]

   SYNOPSIS
        DoMethod(obj,ESM_Socket_EventRead);
        [For use within custom classes only]

   FUNCTION
        This method is invoked when new data arrives.  By default
        socket.class takes care of this.

   NOTE
        This method is called only when NEW data has arrived.

   SEE ALSO
        ESM_Socket_ReadRaw, bsdsocket.library/recv()

Socket.class/ESM_Socket_EventWrite        Socket.class/ESM_Socket_EventWrite

   NAME
        ESM_Socket_EventWrite (V1 ) [NOTIFY]

   SYNOPSIS
        DoMethod(obj,ESM_Socket_EventWrite);
        [For use within custom classes only]

   FUNCTION
        This method is invoked when a socket is again writeable. Usually you
        don't need to care about this.

   NOTE
        After this point socket is again writeable but further actions are
        up to you.

Socket.class/ESM_Socket_Open                    Socket.class/ESM_Socket_Open

   NAME
        ESM_Socket_Open (V1 )

   SYNOPSIS
        BOOL result = DoMethod(obj,ESM_Socket_Open);

   FUNCTION
        Attempts resolve remote host address and make a connection.
        Connection is not established immediately but returns immediately
        and invokes ESM_Socket_EventConnected when connection is ready.

        If unsuccesful, ESM_Socket_Error is invoked.

   RESULT
        result - TRUE or FALSE.

   SEE ALSO
        ESM_Socket_EventConnected

Socket.class/ESM_Socket_Read                    Socket.class/ESM_Socket_Read

   NAME
        ESM_Socket_Read (V1 ) [NOTIFY]

   SYNOPSIS
        DoMethod(obj,ESM_Socket_Read,void *message,LONG msgsize);
        [For use within custom classes only]

   FUNCTION
        After parsing data messages are invoked via this method for you.

        Messages are parsed by ESM_Socket_ReadRaw

   SEE ALSO
        ESM_Socket_Write, ESM_Socket_ReadRaw

Socket.class/ESM_Socket_ReadRaw              Socket.class/ESM_Socket_ReadRaw

   NAME
        ESM_Socket_ReadRaw (V1 ) [NOTIFY]

   SYNOPSIS
        LONG msgsize = DoMethod(obj,ESM_Socket_ReadRaw,void *buffer,LONG length);
        [For use within custom classes only]

   FUNCTION
        Before calling ESM_Socket_Read socket.class invokes ESM_Socket_ReadRaw
        which is supposed to split raw data to messages.

        For example text document could be parsed to lines by this method and
        this is actually the default behaviour for this method if not
        overridden.

   RESULT
        msgsize - size of the message in the buffer or NULL if the message was
                not complete yet. Socket.class will then call method later on
                when new data has arrived.

   NOTE
        Socket.class guarantees that buffer has at least one byte.

        In addition it is OK to modify buffer in fly, e.g. replace line feeds
        with NULL byte.

   EXAMPLE

        LONG mReadRaw(struct IClass *cl,Object *obj,struct ESP_ReadRaw *msg);
        {
                int msglen=1, length;
                char *text;

                text = msg->buf;
                length = msg->len;

                while (length--)
                {
                        if (text[0] == "\n")    // "\n" == line feed
                        {
                                return(msglen); // return the length
                        }

                        text++;
                        msglen++;       // msglen is our linelen
                }
                return(NULL);           // lf was not found
        }


        Or in ASM:

        Socket_ReadRaw:
                move.l  4(a1),a0        ; get buffer
                move.l  8(a1),d7        ; length of data
                moveq   #1,d0
        .loop   cmp.b   #10,(a0)+       ; Check for linefeed
                beq.b   .found
                addq.l  #1,d0
                subq.l  #1,d7           ; End of buffer?
                bne.b   .loop
                moveq   #0,d0
        .found  rts

   SEE ALSO
        ESM_Socket_Read

Socket.class/ESM_Socket_SetURI                Socket.class/ESM_Socket_SetURI

   NAME
        ESM_Socket_SetURI (V1 )

   SYNOPSIS
        BOOL result = DoMethod(obj,ESM_Socket_SetURI,STRPTR URI,LONG defaultPort,ULONG flags);

   FUNCTION
        Set new target for socket. URI is parsed and tags in the object are
        changed (ESM_Socket_HostName, HostPort and Resource) respectively.

   INPUTS
        URI - e.g. "http://www.amiga.com:80/3.9/"

        defaultPort - default port number to be used if not specified by URI

        flags - URI parsing control

                ESV_Socket_SetURI_IgnoreProtocol

                By default port number is taken from protocol string (e.g.
                "http" and such) but sometimes it is misleading. Use this
                flag to ignore protocol name in the URI.

   NOTE
        Port number in the URI string overrides always defaultPort and port
        number guessed by protocol name.

Socket.class/ESM_Socket_Shutdown            Socket.class/ESM_Socket_Shutdown

   NAME
        ESM_Socket_Shutdown (V1 )

   SYNOPSIS
        DoMethod(obj,ESM_Socket_Shutdown,LONG how);

   FUNCTION
        Shut down part of a full duplex connection

   INPUTS
        how - 0 -> further receives will be disallowed
              1 -> further sends will be disallowed
              2 -> further sends and receives will be disallowed

                or

              ESV_Socket_Shutdown_Receive
              ESV_Socket_Shutdown_Send
              ESV_Socket_Shutdown_Both

   SEE ALSO
        bsdsocket.library/shutdown()

Socket.class/ESM_Socket_Write                  Socket.class/ESM_Socket_Write

   NAME
        ESM_Socket_Write (V1 )

   SYNOPSIS
        DoMethod(obj,ESM_Socket_Write,void *buffer,LONG length,ULONG flags);

   FUNCTION
        Send data to remote host.

   INPUTS
        buffer - pointer to the buffer

        length - integer

        flags - special actions

                ESV_Socket_Write_OOB
                ESV_Socket_Write_NoAck
                ESV_Socket_Write_UseUDP
