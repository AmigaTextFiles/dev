@DATABASE Libraries Manual
@NODE MAIN "RKM Библиотеки: 2 Intuition и Графический Интерфейс Amiga"
@INDEX Lib_Index/MAIN
@TOC Libraries_Manual/User
Intuition - это общее имя для библиотек, функций, структур данных и других
элементов, нужных для создания графического интерфейса приложений на Amiga.
Программисты используют Intuition для организации интерфейса пользователя,
такого как открытие окон, управление меню и кнопками, считывание позицию
мышки и т.д.

Новички, порой, думают об Intuition, как об операционной системе Amiga, но
это не так.  Intuition - это только один компонент, который вместе с @{"Exec" link Lib_17/MAIN},
AmigaDOS и другими подсистемами образуют целую ОС. Intuition - наиболее
заметная часть ОС, ведь она обеспечивает графический интерфейс пользователя,
знакомый всем амижникам.

@{" Об Интерфейсах Пользователя " link 2-1}
@{" Intuition с точки зрения Приложения " link 2-3}
@{" Intuition с точки зрения Пользователя " link 2-2}
@{" Простейшая Программа " link 2-4}

@ENDNODE

@NODE 2-1 "2 Intuition и Графический Интерфейс Пользователя / Об Интерфейсах Пользователя"
Что такое интерфейс пользователя? Это словосочитание охватывает все аспекты
коммуникаций между пользователем и компьютером. Оно включает в себя сокравенные
механизмы компьютера и восходит к высотам философии взаимодействия человека
и машины. Более этого, Intuition -  это философия, обращённая в программу.

Философию Intuition описать просто: взаимодействие между пользователем и 
компьютером должно быть последовательным, простым и приятным; одним словом,
интуитивным.  Intuition содержит инструменты, реализующие это философию на
практике.

Основная идея - интерфейс пользователя должен быть графическим.
Графический интерфейс пользователя или GUI - это визуально-ориентированный
мотод взаимодействия с компьютером, в котором системные ресурсы представлены
пиктограммами, которыми можно управлять, используя указывающее устройство,
такое как @{"мышка" link 2-2 8}.  Существуют и другие интерфейсы, как Shell,
где команды вводятся с помощью клавиатуры.  Более подробно интерфесы
пользователя описаны в Amiga User Interface Style Guide.

@{" Элементы Системы Графического Интерфейса Пользователя " link 2-1-1}
@{" Цели Intuition " link 2-1-2}

@ENDNODE

@NODE 2-1-1 "2 / Интерфейсы Пользователя / Элементы Системы Графического Интерфейса Пользователя"
Intuition - не единственная часть интерфейса пользователя.  Для того, чтобы
создать законченный GUI, программисту нужно знать обо всех элементах интерфейса
пользователя на Amiga.


    Table 2-1: Элементы Системы Графического Интерфейса Пользователя Amiga
  ______________________________________________________________________
 |									|
 |  Системный Элемент  Назначение					|
 |======================================================================|
 |  Intuition	       Основной пакет разработчика и библиотека функций |
 |		       создания графического интерфейса (GUI) на Amiga. |
 |									|
 |  @{"Workbench" link Lib_14/MAIN}	       GUI файловой системы Amiga, в котором иконки 	|
 |		       представляют приложения и файлы.			|
 |									|
 |  @{"Preferences" link Lib_13/MAIN}        Семейство редакторов и файлов конфигурации для 	|
 |		       установок системных опций Amiga.			|
 |									|
 |  @{"BOOPSI" link Lib_12/MAIN}	       Подсистема Intuition, которая позволяет		|
 |		       приложениям добавлять расширения к Intuition с   |
 |                     помощью объектно-ориентированной технологии	|
 |                     (только для Версии 2).				|
 |----------------------------------------------------------------------|
 |  @{"Gadtools Library" link Lib_15/MAIN}   Вспомогательная библиотека для создания кнопок	|
 |                     (gadgets) и меню (только для Версии 2).		|
 |									|
 |  @{"ASL Library" link Lib_16/MAIN}        Вспомогательная библиотека для создания		|
 |                     реквестеров (только для Версии 2).		|
 |									|
 |  @{"Icon Library" link Lib_14/14-3}       Библиотека для использования иконок Workbench. 	|
 |									|
 |  @{"Workbench Library" link Lib_14/14-4}  Вспомогательная библиотека для иконок и меню	|
 |	                Workbench (только для Версии 2).		|
 |----------------------------------------------------------------------|
 |  @{"Console Device" link Lib_9/9-4}     Модуль поддержки Ввода/Вывода, позволяющий 	|
 |	 	        использовать окна, как виртуальные тектовые	|
 |                      терминалы.					|
 |									|
 |  @{"Graphics Library" link Lib_27/27-1}  Библиотека создания графики.			|
 |									|
 |  @{"Layers Library" link Lib_30/30-1 22}    Вспомогательная библиотека, управляющая		|
 |                     совпадениями четырёхугольных областей (слоёв),   |
 |                     которую Intuition использует для окон.		|
 |______________________________________________________________________|


В дальнейшем мы будем знакомиться с каждым элементом Amiga GUI подробнее.

@ENDNODE

@NODE 2-1-2 "2 / Об Интерфейсах Пользователя / Цели Intuition"
Intuition была создана с двумя основными целями.  Первая - дать пользователям
дружественный и согласующийся с функциями контроля операционной системы Amiga
и её приложений, интерфейс.

Вторая - (наиболее обширная) предоставить программистам пакет разработки GUI,
который управляет всеми сложностями разделения системы с другими программами.
Так как Amiga - @{"многозадачный" link Lib_1/1-1-4-1} компьютер, несколько
программ могут располагаться в памяти в одно время, разделяя системные
ресурсы.

Дезайн GUI должен позволять пользователю контролировать многжество программ
с помощью одного монитора, одной клавиатуры и одной мышки. (Представте себе
управление несколькими машинами одновременно одним рулём.)  Intuition имеет
набор инструментов, позволяющих решить эту проблему.

@ENDNODE

@NODE 2-2 "2 Intuition и Графический Интерфейс Пользователя / Intuition с точки зрения Пользователя"
Intuition решает проблемы взаимодействия множества программ, деля дисплей на
@{"экраны" link Lib_3/3-1-1} и частично перекрывающие друг друга @{"окна" link Lib_4/4-1},
таким образом каждое приложение имеет свою собственную рабочую область.
Пользователь видет Amiga через эти окна, представляющих порой разные задачи
и приложения.

    @{" Figure 2-1: Экран Workbench с Окнами " system "run >NIL: Cats_CD:Utilities/WDisplay Cats_CD:reference_library/Lib_pics/2-1.pic"}

Пользователь выполняет какие-то действия в экране и окнах @{"мышкой" link Lib_10/10-1},
механическим устройством, которое перемещает @{"указатель" link Lib_10/10-2} по дисплею Amiga.

Пользователь может переключаться между разными работами, такими как составление
документа, рисование иллюстрации, печатания текста, перемещая курсор мышки из
одного окна в другое. С помощью мышки пользователь может также менять размер
и форму @{"окон" link Lib_4/4-1-1} приложений, передвигать их по экрану,
переносить их вперёд, или отправлять назад.  Изменяя расположение окон, он
выбирает, какая информация должна быть видима. (@{"Экраны" link Lib_3/3-1-3} также могут быть
сдвинуты вверх или вниз дисплея, и могут быть размещены вперёди или позади
других экранов.)

@{" Workbench и Установки " link 2-2-1}
@{" 3D Вид Intuition " link 2-2-2}

@ENDNODE

@NODE 2-2-1 "2 / Intuition с точки зрения Пользователя / Workbench и Установки"
Обычно, экран Workbench (@{"см. выше" system "run >NIL: Cats_CD:Utilities/WDisplay Cats_CD:reference_library/Lib_pics/2-1.pic"}) - первый экран, который
пользователь видит после бутирования Amiga.  Workbench - специальная программа
поставляемая с каждой Amiga, которая предоставляет пользователю дружественный
GUI для файловой системы.

В Workbench, диски, директории, файлы и другие объекты символизируются 
маленькими картинками, названными иконками, с которыми можно обращаться 
с помощью мышки.
К примеру, программный файл может быть запущен ( наведя на его иконку указатель)
двойным щелчком левой кнопки мышки. @{"Экран Workbench" link Lib_3/3-1-2} автоматически
открывается Intuition и может быть легко разделён, таким образом много программ
могут использовать его.

Контроль ОС пользователем также поддерживается через Установки (Preferences).
Установки - семейство редакторов и конфигурационных файлов, которые позволяют
пользователю контролировать ОС.  Например: Prefs/Printer определяет все
опции принтера.

Workbench, вместе с Установками, дают поьзователю простой способ управления 
ОС и приложениями. Эти программы написаны с помощью тех же инструментов 
Intuition, дающими всей системе Amiga целосный вид и ощущение единообразия.
@{"Workbench" link Lib_14/MAIN} и @{"Установки" link Lib_13/MAIN} - важные
части Amiga GUI и описаны подробно в следующих главах.

@ENDNODE

@NODE 2-2-2 "2 / Intuition с точки зрения Пользователя / 3D Вид Intuition"
Amiga ОС выходила в разных @{"версиях" link Lib_1/1-1-4}.  Последняя версия,
@{"Версия 2" link Lib_1/1-1-4-1}, содержит существенные усовершенствования
в наружном виде GUI, как правило заметен 3D Вид в Intuition.

    @{" Figure 2-2: Пример 3D Вида в Intuition " system "run >NIL: Cats_CD:Utilities/WDisplay Cats_CD:reference_library/Lib_pics/2-2.pic"}

В новом 3D виде Intuition, объекты прорисовываются так, что кажется свет
падает из верхнего левого угла дисплея с тенью в нижнем правым. Это даёт
иллюзию глубины и изображения расположены, как-бы, вне дисплея.

@ENDNODE

@NODE 2-3 "2 Intuition и Графический Интерфейс Пользователя / Intuition с точки зрения Приложения"
Intuition организована как библиотека с более 100 функций.  До использования
функций Intuition, вы должны открыть библиотеку Intuition.
См. Главу 1, "@{"Введение в Систему Библиотек Amiga" link Lib_1/1-1-2}".)

@{" Компоненты Intuition " link 2-3-1}
@{" Экраны и Окна " link 2-3-2}
@{" Кнопки, Меню и Реквесторы " link 2-3-3}

@ENDNODE

@NODE 2-3-1 "2 / Intuition с точки зрения Приложения / Компоненты Intuition"
Типы данных, которые создаёт Intuition можно разделить на шесть категорий.

		Table 2-2: @{"GUI" link 2-1-1} Компоненты Intuition
  ____________________________________________________________________
 |								      |
 |  @{"Экраны" link 2-3-2}	  Среда дисплея. Имеет разрешение и		      |
 |		  цвета.					      |
 |								      |
 |  @{"Окна" link 2-3-2}	  Прямоугольник в экране, представляющий	      |
 |		  программу.					      |
 |								      |
 |  @{"Меню" link 2-3-3-2}	  Список альтернатив, расположенный в верхней части   |
 |		  экрана, которые могут быть выбраны мышкой.	      |
 |								      |
 |  @{"Кнопки" link 2-3-3-1}	  Управление представленное графическим изображением. |
 |								      |
 |  @{"Реквесторы" link 2-3-3-3}	  Вид окон для подтверждения действий,доступа к файлам|
 |		  и другим подобным задачам.			      |
 |								      |
 |  @{"События ввода" link 2-3-3-4}  Мышь, клавиатура другая активность.		      |
 |____________________________________________________________________|

@ENDNODE

@NODE 2-3-2 "2 / Intuition с точки зрения Приложения / Экраны и Окна"
Как упоминалось ранее, Intuition позволяет программам разделять дисплей,
руководя системой @{"экранов" link Lib_3/3-1-1} и @{"окон" link Lib_4/4-1}.

@{"Экраны" link Lib_3/3-1-1} и @{"окна" link Lib_4/4-1} дают каждому приложению собственный
визуальный контекст, поэтому несколько программ могут выводить графику или 
текст на дисплей одновременно без взаимоналожения. Intuition (используя
@{"layers.library" link Lib_30/30-1}) управляет всеми деталями графики, та которая
находится в границах окна остаётся, та что вне - запоминается до того как
пользователь @{"изменит размеры окна" link Lib_4/4-5}.

Клавиатура и мышка разделяются между приложениями по простой технологии:
только одно приложение в момент времени может иметь @{"фокус ввода" link Lib_9/9-2-3}.  
Следовательно, Intuition гарантирует, что только одно окно, названное
@{"активным" link Lib_4/4-3-3}, узнаёт о вводе с клавиатуры, мышки или других
типов ввода.

Каждое окно - как будто виртуальный терминал или консоль. Ваша программа
будет считать, что имеет всю машину и дисплей в своём распоряжении. Она может
напечатать текст или графику на своём окне, или запросить ввод из произвольного
кол-ва источников, игнорируя тот факт, что другие программы могут делать
тоже самое.  Всем этим хозяйством управляет Intuition. Фактически ваша
программа может открывать несколько окон и обращаться с каждым так, как если
бы она была запущена одна.

@ENDNODE

@NODE 2-3-3 "2 / Intuition с точки зрения Приложения / Кнопки, Меню и Реквесторы"
@{"Экраны и окна" link 2-3-2} обеспечивают аккуратный способ разделения
дисплея и устройств ввода между программами. Кроме того, каждое приложение
нуждается в методе приёма команд от пользователя и наоборот. Для этого в
Intuition есть кнопки (gadgets), меню и реквесторы (requesters).

@{" Кнопки " link 2-3-3-1}
@{" Реквесторы " link 2-3-3-3}
@{" Меню " link 2-3-3-2}
@{" Цикл ввода Intuition " link 2-3-3-4}

@ENDNODE

@NODE 2-3-3-1 "2 / / Кнопки, Меню и Реквесторы / Кнопки"
Кнопка - часть управления приложением, представленное графическим изображением,
которая, в свою очередь, может управляться с помощью мышки или клавиатуры.
Изображение кнопки может быть как переключатель , ручка или что-то ещё.
Intuition содержит несколько стандартных кнопок, названных @{"system gadgets" link Lib_5/5-1-1},
для контроля окнами и экранами.  Другие @{"типы кнопок" link Lib_5/5-1-2} позволяют
пользователю выбирать цвета, вводить текст или числа, выполнять простейшие
операции.

    @{" Figure 2-3: Окно с кнопками " system "run >NIL: Cats_CD:Utilities/WDisplay Cats_CD:reference_library/Lib_pics/2-3.pic"}

Большенство действий пользователя в типичном приложении Intuition будут
связаны с кнопками. В деталях они рассмотрены в Главе 5,
"@{"Intuition Кнопки" link Lib_5/MAIN}".  Дополнительно см. Главу 15,
"@{"Библиотека GadTools" link Lib_15/15-3}".

@ENDNODE

@NODE 2-3-3-2 "2 / / Кнопки, Меню и Реквесторы / Меню"
Также Intuition поддерживает @{"систему меню" link Lib_6/6-1-2} для принятия команд
и опций. Меню - список альтернатив, изображённый в верхней части экрана.
Каждый экран имеет одно меню, с которой работают все окна данного приложения.

    @{" Figure 2-4: Меню Intuition " system "run >NIL: Cats_CD:Utilities/WDisplay Cats_CD:reference_library/Lib_pics/2-4.pic"}

Меню может быть вызвано нажатием правой кнопки мышки (кнопка меню). Меню
позволяют пользователю выбирать из возможного множества действий.

Меню описаны в деталях в Главе 6, "@{"Intuition Меню" link Lib_6/MAIN}" и в Главе 15,
"@{"GadTools Library" link Lib_15/15-2}".

@ENDNODE

@NODE 2-3-3-3 "2 / / Кнопки, Меню и Реквесторы / Реквесторы"
@{"Кнопки" link 2-3-3-1} и @{"меню" link 2-3-3-2} делают много работы по 
получению комонд от пользователя. Но иногда приложение нуждается в подтверждении
такой команды. В этом слячае могут пригодиться реквесторы.
Реквестор - @{"тип окна" link Lib_7/7-1}, обычно содержащее несколько кнопок,
целью которого стоит получение от пользователя ответа на запрос.

    @{" Figure 2-5: Реквесторы Intuition " system "run >NIL: Cats_CD:Utilities/WDisplay Cats_CD:reference_library/Lib_pics/2-5.pic"}

См. Главы "@{"7 Intuition Реквесторы и Предупреждения" link Lib_7/MAIN}",
"@{"16 Библиотека ASL" link Lib_16/MAIN}".

@ENDNODE

@NODE 2-3-3-4 "2 / / Кнопки, Меню и Реквесторы / Цикл Ожидания Событий Intuition"
Однажды открыв @{"экран" link 2-3-2}, @{"окно" link 2-3-2}, @{"кнопки" link 2-3-3-1}
@{"меню" link 2-3-3-2} и @{"реквесторы" link 2-3-3-3}, приложение ждёт действий от пользователя.
Intuition может извещать приложение всякий раз, когда пользователь что-то
делает, посылая @{"сообщение" link Lib_9/9-2}.  Сообщение - это просто указатель
на область памяти, принадлежащей Intuition, которая содержит структуру
@{"IntuiMessage" link Lib_9/9-5-4}, описывающую действия пользователя.

Для ожидания активности пользователя или других событий, Exec имеет специальную
функцию @{"Wait()" link Lib_24/24-2-2}.	Она подвешивает вашу задачу, давая
исполняться другим приложениям или системным задачам пока ваше ждёт событий
ввода от Intuition или других источников.

Таким образом, простейший шаблон для любой программы Intuition:

  * Устанавливаем @{"окно" link 2-3-2}, @{"экран" link 2-3-2} и другие необходимые элементы:
    @{"кнопки" link 2-3-3-1}, @{"меню" link 2-3-3-2} или @{"реквесторы" link 2-3-3-3}.

  * @{"Ждём" link Lib_24/24-2-2} сообщения от Intuition об активности пользователя
    или других событий. Копируем необходимые данные из сообщения и говорим
    Intuition, что мы получили его.

  * Повторяем пока пользователь не захочет выйти из приложения.

Эти шаги, порой называемые @{"циклом ожидания событий" link Lib_9/9-5-1} Intuition -
основа для любого приложения AmigaOS.

Как вы могли заметить, Intuition может посылать сообщения вашему приложению
как только пользователь нажмёт клавишу на клавиатуре или двинит мышкой. Но и
другие типы событий ввода Intuition будут вам известны включая нажатия на
кнопки (gadgets), выбор меню, приход времени, вставку или извлечение диска и
перегруппировку окна.

@{"Кнопки" link 2-3-3-1}, @{"меню" link 2-3-3-2}, @{"реквесторы" link 2-3-3-3} - винтики Intuition @{"GUI" link 2-1-1}.
Большая часть кода приложения, используемого Intuition, имеет дело с установкой
и оперированием этими объектами. Неважно как просто, сложно или причудливо
построена ваша программа, она будет стандартно выглядить как множество @{"окон и экранов" link 2-3-2},
кнопок, меню и реквесторов.  Пользователь Amiga знает эти элементы Intuition.
Это позволяет, хорошо спланированной программе, быть понятной любому
пользователю.

@ENDNODE

@NODE 2-4 "2 Intuition и Графический Интерфейс Пользователя / Простейшая Программа"
Примерная программа Intuition, которая позволяет продемонстрировать все 
простейшие требывания к приложению Intuition. Есть три наиболее важных
пункта:

  * Вы должны открыть библиотеку Intuition до того, как будете использовать
    её функции. Определённые языки, как @{"C" link Lib_1/1-1-2-1}, требуют
    указатель на Intuition, записанный в переменную IntuitionBase (см.
    @{"Главу 1" link Lib_1/1-1-2}).

  * Когда вы открываете @{"окно" link 2-3-2}, вы также указываете события, о
    которых хотите знать. Если пользователь сделал что-то, что вызвало одно
    из них, Intuition сигнализирует вам и пошлёт @{"сообщение" link Lib_9/9-2}. Сообщение -
    указатель на структуру @{"IntuiMessage" link Lib_9/9-5-4}, которая описывает
    событие более детально.  Сообщение о событие Intuition посылается в
    @{"MsgPort" link Lib_24/24-1} - очередь сообщений.

  * Реcурсы должны быть @{"возвращены" link Lib_27/27-2-8-2 14} системе.
    В этом случае все окна, экраны или библиотеки будут закрыты до завершения
    программы.

@{" Пример цикла событий " link 2-4-1}
@{" Пример (V36 и позже) " link lib_examples/easyintuition37.c/MAIN}
@{" Пример (Все версии) " link lib_examples/easyintuition.c/MAIN}

@ENDNODE

@NODE 2-4-1 "2 / Простейшая Программа / Пример Цикл Событий Intuition"
@{"Цикл событий" link Lib_9/9-5-1} Intuition, использованный в примере очень
прост.  Пример открывает @{"заказной экран" link Lib_3/3-3}, на нём @{"открывает окно" link Lib_4/4-2-1},
потом ждёт пока Intuition пошлёт ему сообщения о действиях пользователя:

    winsignal = 1L << window1->UserPort->mp_SigBit;  /* сигнал от окна */
    signalmask = winsignal;   /* программа ждёт только событий окна */

    while( !done )  {
	signals = Wait(signalmask);
	if (signals & winsignal)
	    done = handleIDCMP(window1);
    }

Intuition посылает сообщения об активности пользователя в специальный порт,
известный как @{"IDCMP" link Lib_9/9-2-2}. Любое окно может иметь свой IDCMP
(в примере IDCMP - это window1->UserPort). Для ожидания сообщений о событиях
в IDCMP порту, программа вызывает функцию Exec @{"Wait()" link Lib_24/24-2-2}
Потом она передаёт управление обработчику события handleIDCMP().  Для этого
примера Intuition сообщит о событии закрытия окна.  Когда программа определит
это, она @{"закроет окно" link Lib_4/4-2-2}, @{"закрает экран" link Lib_3/3-3-1-4},
@{"закроет библиотеку Intuition" link Lib_17/17-5 91} и выйдет.
@{"Циклы событий" link Lib_9/9-5-1}, подобны этому, используются в примерах
Intuition везде в этом пособии.  Для большей информации об IDCMP см.
главы "@{"Intuition Окна" link Lib_4/4-3}" и "@{"Intuition Ввод и Вывод" link Lib_9/MAIN}".

@ENDNODE
