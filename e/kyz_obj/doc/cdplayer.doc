TABLE OF CONTENTS

cdplayer.m/--overview--
cdplayer.m/currenttrack
cdplayer.m/discchanged
cdplayer.m/discinserted
cdplayer.m/eject
cdplayer.m/ejected
cdplayer.m/end
cdplayer.m/insert
cdplayer.m/length
cdplayer.m/location
cdplayer.m/maketime
cdplayer.m/open
cdplayer.m/pause
cdplayer.m/paused
cdplayer.m/play
cdplayer.m/playing
cdplayer.m/search
cdplayer.m/spindown
cdplayer.m/spinning
cdplayer.m/spinup
cdplayer.m/stop
cdplayer.m/timeval
cdplayer.m/trackinfo
cdplayer.m/tracks
cdplayer.m/unpause
cdplayer.m/waitfordisc
cdplayer.m/--overview--                               cdplayer.m/--overview--
 
   PURPOSE
	To provide an interface to the cd.device for playing Audio CDs.
 
   OVERVIEW
	This  object  simulates the high-level idea of 'CD Controls', such
	as  play(),  pause(), stop() and so on. It also allows querying of
	the  CD  drive, such as whether the door is open or if the disc is
	spinning.
	
	Audio  play  is,  of  course,  asynchronous,  and the audio can be
	manipulated while play is in progress.

	Construction and destruction:
	  open(), end()
	
	CD Controls:
	  play(), stop(), search()

	CD State controls:
	  pause(), unpause(), paused() - pause control
	  eject(), insert(), ejected() - door control
	  spinup(), spindown(), spinning() - motor control
	  playing(), location()

	Disc information:
	  discchanged(), discinserted(), waitfordisc()

	Track information:
	  length(), tracks(), trackinfo(), currenttrack()

	Timing specifications

	    Audio CDs are marked in minutes, seconds and frames. There are
	    75 frames in a second, and 60 seconds in a minute.
	
	    To work with Audio CDs, there must be some way of representing
	    a  time  values.  Time values are used to specify positions on
	    the  CD,  offsets  from the beginning of the CD or tracks, the
	    length of tracks, the total time on the CD, amounts of time to
	    be played, and so on.
	
	    There  are two standard ways to represent time values for CDs.
	    One  is  called  'LSN  format',  where LSN stands for 'Logical
	    Sector  Numbers'.  LSN  format  is  basically a mass number of
	    frames,  where  a  minute  is  4500 frames, and a second is 75
	    frames.  The  advantage  of  this  format is that times can be
	    worked  with  like  normal numbers. You can add them, subtract
	    them and compare them with normal number math.
	
	    The  other standard time representation is 'MSF format', where
	    MSF  stands  for  'Minutes,  Seconds,  Frames'. Just as an LSN
	    value  is  an unsigned 32-bit LONG value, so is an MSF value -
	    but  each  byte  of  the  LONG is used individually to store a
	    minute  count,  second  count,  and  a  frame  count. The most
	    significant  byte is unused, the next most significant byte is
	    a number from 0 to 255 representing the number of minutes, the
	    next  byte is a number from 0 to 59 representing the number of
	    seconds,  and  the least significant byte holds a value from -
	    to 74 containing a number of frames.
	
	    A  fair  analogy for MSF format would be the well known Binary
	    Coded  Decimal  (BCD) format supported by most processors. The
	    numbers   cannot  be  added  or  manipulated  without  special
	    instructions,  and  'invalid'  values  are  possible,  but the
	    values  themselves  are  more  readable  and 'splittable' than
	    normal integers.
	
	    Before an argument breaks out, it must be said that this class
	    always  uses  LSN format time values - in all instances. It is
	    far  more  practical  to  do  so  than  to support MSF format.
	    However,  there are two functions to provide the functionality
	    inherent  in  the MSF format. maketime() will take a number of
	    minutes,  seconds  and frames, and create an LSN format number
	    from  them.  timeval()  will  take  an  LSN format number, and
	    return a number of minutes, seconds and frames.

	    The unit of time value measurement is referred to as 'frames'.
	
	Error handling

	    When  the  functions of the cdplayer object mention 'failure',
	    'errors'  and  so  on,  they  refer to logical errors that the
	    functions specifically expect and report. However, they do not
	    expect  I/O  errors  with  the  CD  device.  If  the CD device
	    returns an errors, the exception CDPERR_DEVICE will be thrown,
	    and the device error will be in exceptioninfo. In their normal
	    operation,  the  functions  do  not cause or expect any device
	    errors. However, events beyond their control can cause them.
	    In practise, it is very difficult to cause them.

cdplayer.m/currenttrack                               cdplayer.m/currenttrack

   NAME
       cdplayer.currenttrack() -- report track being played.

   SYNOPSIS
       track := currenttrack()

   FUNCTION
	Returns  the  latest known currently playing track. The CD must be
	playing, but it does not matter if play is paused or searching.

   RESULT
	track - CDTRACK_INVALID  if  the  CD is not playing, otherwise the
	        track number.

   SEE ALSO
       play(), playing(), location()

cdplayer.m/discchanged                                 cdplayer.m/discchanged

   NAME
	cdplayer.discchanged() -- report if disc has been changed.

   SYNOPSIS
	changed := discchanged()

   FUNCTION
	This function returns TRUE if the disc in the CD drive has changed
	since  you last called this function. To help you, the function is
	called  automatically  on  your  behalf  when you first create the
	cdplayer object.

   RESULT
	changed - TRUE if the disc in the CD drive has changed since this
	          function was last called, FALSE otherwise.

   NOTE
	A disc change does not imply that there is a disc in the drive!

   SEE ALSO
	discinserted(), waitfordisc()

cdplayer.m/discinserted                               cdplayer.m/discinserted

   NAME
	cdplayer.discinserted() -- report if a disc is in the drive.

   SYNOPSIS
	inserted := discinserted()

   FUNCTION
	Reports if a readable disc is ready and in the CD drive.

   RESULT
	inserted - TRUE if a disc is inserted, FALSE otherwise.

   NOTE
	Discs  may  be  removed at any time, even just after this call has
	returned TRUE! A TRUE result from this function is no guarantee of
	permanent disc availability.

   SEE ALSO
	discchanged(), waitfordisc()

cdplayer.m/eject                                             cdplayer.m/eject

   NAME
	cdplayer.eject() -- open the CD drawer/door.

   SYNOPSIS
	eject()

   FUNCTION
	Requests the CD drive to open its drawer or door.

   NOTE
	You  must have a CD drive with a motorized drawer or door for this
       call to work. The CD³² drive throws IO error CDERR_NOCMD.

   SEE ALSO
	insert(), ejected()

cdplayer.m/ejected                                         cdplayer.m/ejected

   NAME
	cdplayer.ejected() -- report if CD drawer/door is open.

   SYNOPSIS
	door_open := ejected()

   FUNCTION
	Reports the current state of the CD drawer or door.

   RESULT
	Returns TRUE if the door is open, FALSE otherwise.

   NOTE
	Cartridge-based CD drives do not normally report being 'open'.

   SEE ALSO
	eject(), insert()

cdplayer.m/end                                                 cdplayer.m/end

   NAME
	cdplayer.end() -- Destructor.

   SYNOPSIS
	end()

   FUNCTION
	Frees resources used by an instance of the cdplayer class.

   SEE ALSO
	new()

cdplayer.m/insert                                           cdplayer.m/insert

   NAME
	cdplayer.insert() -- close the CD drawer/door.

   SYNOPSIS
	insert()

   FUNCTION
	Requests the CD drive to close its drawer or door.

   NOTE
	You  must have a CD drive with a motorized drawer or door for this
       call to work. The CD³² drive throws IO error CDERR_NOCMD.

   SEE ALSO
	eject(), ejected()

cdplayer.m/length                                           cdplayer.m/length

   NAME
	cdplayer.length() -- report the running time for the CD.

   SYNOPSIS
	length := length()

   FUNCTION
	Returns the length in time of the CD currently inserted.

   RESULT
	length - A time value in frames, or CDTIME_INVALID in error.

   SEE ALSO
	tracks()

cdplayer.m/location                                       cdplayer.m/location

   NAME
       cdplayer.location() -- report current location of laser on the CD.

   SYNOPSIS
       position := location()

   FUNCTION
	Returns  the  latest known position of play on the CD. The CD must
	be playing, but it does not matter if play is paused or searching.

   RESULT
	position - CDTIME_INVALID  if  the  CD is not playing, otherwise a
	           time offset in frames from the start of the disc.

   SEE ALSO
       play(), playing(), currenttrack()

cdplayer.m/maketime                                       cdplayer.m/maketime

   NAME
	maketime() -- Create an LSN time value.

   SYNOPSIS
	time := maketime()
	time := maketime(minutes)
	time := maketime(minutes, seconds)
	time := maketime(minutes, seconds, frames)

   FUNCTION
	Creates an LSN time value from the 3 component parts, for use with
	the  cdplayer class. Any component part you do not specify will be
	assumed to be zero.

   INPUTS
	minutes - A number of minutes of time
	seconds - A number of seconds of time
	frames  - A number of frames (1/75 s) of time

	Parameters you do not specify will be assumed to be zero.
	
   RESULT
	time - a  time  value  in a suitable form for adding, subtracting,
	       comparing, and passing to cdplayer functions.

   NOTE
	This is not a member function of the cdplayer class.

   SEE ALSO
	timeval()
	
cdplayer.m/open                                               cdplayer.m/open

   NAME
	cdplayer.open() -- Constructor.

   SYNOPSIS
	open()
	open(device)
	open(device, unit)

   FUNCTION
	Initialises  an  instance  of the cdplayer class. Raises exception
	CDPERR_INIT if it cannot allocate required memory and resources.

	By  default, this opens "cd.device" unit 0. You can change this by
	passing  an  alternate  device name. Similarly, you can provide an
	alternate  unit  to  open. This option should be made available to
	the user if at all possible. Note that the device opened *must* be
	compatible  to  the  cd.device  interface  -  scsi.device  is  not
	acceptable,  even  though  many  CD-ROMs  are  controlled with the
	scsi.device, in that case they must be sent SCSI commands.

	If  opening the device fails, CDPERR_OPENDEV will be thrown, along
	with the OpenDevice() error code.

   INPUTS
	device - device to be opened, default is 'cd.device'
	unit   - unit of device to be opened, default is 0.
   
   SEE ALSO
	end()

cdplayer.m/pause                                             cdplayer.m/pause

   NAME
       cdplayer.pause() -- put CD player in pause mode.

   SYNOPSIS
       pause()

   FUNCTION
       If the CD player is currently playing, it will be paused. If it is
       not playing, it will pause when the next play() is issued.

   SEE ALSO
       unpause(), paused()

cdplayer.m/paused                                           cdplayer.m/paused

   NAME
       cdplayer.paused() -- report if CD player is paused.

   SYNOPSIS
       paused := paused()

   FUNCTION
       Returns the state of the 'pause button' in the CD player.

   RESULT
       Returns TRUE if in pause mode, otherwise FALSE.

   SEE ALSO
     pause(), unpause()

cdplayer.m/play                                               cdplayer.m/play

   NAME
	cdplayer.play() -- play audio on the CD.

   SYNOPSIS
	playing := play(offset, length)

   FUNCTION
	Attempts to start playing a specified area of the CD.

	If  any  previous play request is still running, it is immediately
	stopped, regardless of whether this new request succeeds.

	There  must  be  a  valid CD in the drive, and the area you select
	must  be  within  the  bounds  of  the disc, otherwise an error is
	returned.  Similarly,  failure occurs if the CD drive reports that
	the disc is currently playing, but it is not us who is playing it.

	If  successful, a CD play request will be issued, and the CD drive
	should  begin asynchronously playing the specified audio area. Any
	errors with the CD drive playing will not be reported.

	Play continues until one of the following occurs:
	- play reaches the end of the selected area.
	- you stop() the CD, or play() a new area.
	- you eject() the CD, or the user ejects it himself.
	- you search() backwards to a point before play started.

   INPUTS
	offset - the  location  on  the  CD  from  which you want to start
	         playing.

	length - the  duration  for  which  the play should last. The area
	         played  is therefore from (offset) to (offset+length).

   RESULT
	playing - TRUE if succeeded, FALSE for failure

   NOTE
	You are not currently prohibited from playing data tracks, which
	sound rather unpleasent. This may change in future.

   SEE ALSO
	stop(), pause(), search(), playing()

cdplayer.m/playing                                         cdplayer.m/playing

   NAME
	cdplayer.playing() -- report if we are playing the CD.

   SYNOPSIS
	playing := playing()

   FUNCTION
	Reports  on  whether  or  not there is a play request in progress.
	That is, whether or not we are playing the CD.

   RESULT
	playing - TRUE if play is in progress, FALSE otherwise.

   SEE ALSO
	play(), stop()

cdplayer.m/search                                           cdplayer.m/search

   NAME
	cdplayer.search() -- search CD in 'scan mode' while playing.

   SYNOPSIS
	oldmode := search(mode)

   FUNCTION
	Allows  a  playing  CD to play in 'fast forward' or 'fast reverse'
	modes.  If,  in  these modes, the position of play goes beyond the
	boundaries selected in the original call to play(), then play will
	finish.  If  play is currently paused(), the search mode will take
	effect when the play is unpaused().

   INPUTS
	mode - one of the following modes:
	       CDSEARCH_STOP - turn off search mode
	       CDSEARCH_FWD  - enter 'fast forward' mode
	       CDSEARCH_BACK - enter 'fast reverse' mode

   RESULT
	oldmode - the previous state - one of the above 3 modes.

   SEE ALSO
	play()

cdplayer.m/spindown                                       cdplayer.m/spindown

   NAME
	cdplayer.spindown() -- turn the CD motor off.

   SYNOPSIS
	spindown()

   FUNCTION
	Turns  the CD motor off. If the CD player is currently playing, it
	will stop until the motor is turned back on again.

   SEE ALSO
	spinup(), spinning()

cdplayer.m/spinning                                       cdplayer.m/spinning

   NAME
	cdplayer.spinning() -- report if CD motor is running.

   SYNOPSIS
	spinning := spinning()

   FUNCTION
	Reports the current state of the CD motor.

   RESULT
	Returns TRUE if the motor is spinning, FALSE otherwise.

   SEE ALSO
	spinup(), spindown()

cdplayer.m/spinup                                           cdplayer.m/spinup

   NAME
	cdplayer.spinup() -- turn the CD motor on.

   SYNOPSIS
	spinup()

   FUNCTION
	Turns the CD motor on. If the CD player was playing when the
	motor was spun down, it will continue where it left off.

   NOTE
	The CD motor automatically turns itself on if it recieves any
	request to read data/audio from the drive while it is off.

   SEE ALSO
	spindown(), spinning()

cdplayer.m/stop                                               cdplayer.m/stop

   NAME
	cdplayer.stop() -- stop any currently running play request.

   SYNOPSIS
	stop()

   FUNCTION
	Stops playing the CD.

   SEE ALSO
	play(), pause()

cdplayer.m/timeval                                         cdplayer.m/timeval

   NAME
	timeval() -- Break an LSN time value into its component parts.

   SYNOPSIS
	minutes, seconds, frames := timeval(time)
	
   FUNCTION
	Breaks an integral LSN time value into a number of minutes,
	seconds and frames (1/75 s).
	
   INPUTS
	time - an LSN time value that you have calculated or recieved from
	       a function in the cdplayer class. For correct operation, it
	       should  range  between  0 and about 80*60*75 (the '80' is a
	       nominal  value  for the maximum number of minutes likely to
	       be represented on a CD.
	
   RESULT
	minutes - the number of whole minutes in the time (from 0 to 80)
	seconds - the number of whole seconds in the time (from 0 to 59)
	frames  - the number of frames left (from 0 to 75)
	
   NOTE
	This is not a member function of the cdplayer class.

   SEE ALSO
	maketime()

cdplayer.m/trackinfo                                     cdplayer.m/trackinfo

   NAME
	cdplayer.trackinfo() -- retrieve information about a track.

   SYNOPSIS
	type, offset, length := trackinfo(track)

   FUNCTION
	Retrieves  information  from  the  table  of  contents  (TOC)  the
	requested track on the CD in the drive. This data is simplified to
	just 'track type', position on the disc, and running time.

   INPUTS
	track - the  track to get information about. Must be between 1 and
	        tracks(), otherwise an error will occur.

   RESULT
	type   - Will be one of the following three types:

	         CDTRACK_INVALID:
	         An  error has occured. For example, there may be no valid
	         disc  in  the  drive, or the track you requested does not
	         exist. In this case, the other results returned will also
	         be invalid.

	         CDTRACK_DATA:
	         The track is certainly valid, however you should not play
	         it as it is actually CD-ROM data, not an audio track.

	         CDTRACK_AUDIO:
	         The track is both valid and playable.

	offset - The position in frames where the track begins on the CD.

	length - The running time of the track, in frames.

   SEE ALSO
	tracks(), play()

cdplayer.m/tracks                                           cdplayer.m/tracks

   NAME
	cdplayer.tracks() -- report the number of tracks on the CD.

   SYNOPSIS
	tracks := tracks()

   FUNCTION
	Returns  the  total number of tracks on the CD. The result is also
	the track number of the last track (the first track is always 1).

   RESULT
	tracks - the number of tracks, or CDTRACK_INVALID in error.

   SEE ALSO
	length()

cdplayer.m/unpause                                         cdplayer.m/unpause

   NAME
       cdplayer.unpause() -- take CD player out of pause mode.

   SYNOPSIS
       unpause()

   FUNCTION
       If the CD player is currently playing, it will be paused. If it is
       not playing, it will pause when the next play() is issued.

   SEE ALSO
     pause(), paused()

cdplayer.m/waitfordisc                                 cdplayer.m/waitfordisc

   NAME
	cdplayer.waitfordisc() -- efficiently wait for a disc to be ready.

   SYNOPSIS
	waitfordisc()

   FUNCTION
	Will  wait indefinately until a readable disc is inserted into the
	drive. A more efficent form of "REPEAT UNTIL discinserted()".

   SEE ALSO
	discinserted()

