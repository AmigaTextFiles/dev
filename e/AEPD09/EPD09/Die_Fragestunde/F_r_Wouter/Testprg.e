/* E Source generated by SRCGEN v0.1 */

OPT OSVERSION=37

MODULE 'gadtools','libraries/gadtools','intuition/intuition',
       'intuition/screens', 'intuition/gadgetclass', 'graphics/text',
       'graphics/gfx','graphics/gfxbase'

ENUM NONE,NOCONTEXT,NOGADGET,NOWB,NOVISUAL,OPENGT,NOWINDOW,NOMENUS

DEF     project0wnd:PTR TO window,
        project0glist,
        infos:PTR TO gadget,
        scr:PTR TO screen,
        visual=NIL,
        offx,offy,tattr,
        exit,
        realgadget:PTR TO gadget

PROC setupscreen()
  IF (gadtoolsbase:=OpenLibrary('gadtools.library',37))=NIL THEN RETURN OPENGT
  IF (scr:=LockPubScreen('Workbench'))=NIL THEN RETURN NOWB
  IF (visual:=GetVisualInfoA(scr,NIL))=NIL THEN RETURN NOVISUAL
  offy:=scr.wbortop+Int(scr.rastport+58)-10
  tattr:=['topaz.font',8,0,0]:textattr
ENDPROC

PROC closedownscreen()
  IF visual THEN FreeVisualInfo(visual)
  IF scr THEN UnlockPubScreen(NIL,scr)
  IF gadtoolsbase THEN CloseLibrary(gadtoolsbase)
ENDPROC

PROC openproject0window()
  DEF g:PTR TO gadget
  IF (g:=CreateContext({project0glist}))=NIL THEN RETURN NOCONTEXT
  IF (g:=CreateGadgetA(BUTTON_KIND,g,
    [offx+29,offy+21,103,44,'Nr.1',tattr,0,16,visual,0]:newgadget,
    [NIL]))=NIL THEN RETURN NOGADGET
  IF (g:=CreateGadgetA(BUTTON_KIND,g,
    [offx+29,offy+70,103,44,'Nr.2',tattr,1,16,visual,0]:newgadget,
    [NIL]))=NIL THEN RETURN NOGADGET
  IF (project0wnd:=OpenWindowTagList(NIL,
    [WA_LEFT,0,
     WA_TOP,11,
     WA_WIDTH,offx+500,
     WA_HEIGHT,offy+137,
     WA_IDCMP,$24C077E,
     WA_FLAGS,$100F,
     WA_TITLE,'Work Window',
     WA_CUSTOMSCREEN,scr,
     WA_MINWIDTH,67,
     WA_MINHEIGHT,21,
     WA_MAXWIDTH,$2D2,
     WA_MAXHEIGHT,283,
     WA_AUTOADJUST,1,
     WA_AUTOADJUST,1,
     WA_GADGETS,project0glist,
     NIL]))=NIL THEN RETURN NOWINDOW
  Gt_RefreshWindow(project0wnd,NIL)
ENDPROC

PROC closeproject0window()
  IF project0wnd THEN CloseWindow(project0wnd)
  IF project0glist THEN FreeGadgets(project0glist)
ENDPROC

PROC wait4message(win:PTR TO window)
  DEF mes:PTR TO intuimessage,type
  REPEAT
    infos:=NIL
    type:=NIL
    IF mes:=Gt_GetIMsg(win.userport)
      type:=mes.class
      IF type=IDCMP_MENUPICK
        infos:=mes.code
      ELSEIF (type=IDCMP_GADGETDOWN) OR (type=IDCMP_GADGETUP)
        infos:=mes.iaddress
        realgadget:=mes.iaddress
      ELSEIF type=IDCMP_REFRESHWINDOW
        Gt_BeginRefresh(win)
        Gt_EndRefresh(win,TRUE)
        type:=0
      ELSEIF type=IDCMP_CLOSEWINDOW  /* remove these IF you like */
        exit:=10
        type:=0
      ENDIF
      Gt_ReplyIMsg(mes)
    ELSE
      WaitPort(win.userport)
    ENDIF
  UNTIL type
ENDPROC type

PROC reporterr(er)
  DEF erlist:PTR TO LONG
  IF er
    erlist:=['get context','create gadget','lock wb','get visual infos',
      'open "gadtools.library" v37+','open window','create menus']
    EasyRequestArgs(0,[20,0,0,'Could not \s!','ok'],0,[erlist[er-1]])
  ENDIF
ENDPROC er

PROC main()
  exit:=0
  IF reporterr(setupscreen())=0
    reporterr(openproject0window())
    REPEAT
        wait4message(project0wnd)
        IF infos<>NIL
            ausgabe()                       /* testroutine für gadgets pointer*/
        ENDIF
    UNTIL exit=10
    closeproject0window()
    IF CtrlC() THEN BRA x
  ENDIF
  x: closedownscreen()
ENDPROC

PROC ausgabe()
    DEF gadget1:PTR TO gadget                   /* zwei testpointer für gadgets*/
    DEF gadget2:PTR TO gadget
    DEF gadget3:PTR TO gadget
    DEF gadget4:PTR TO gadget
    DEF gadget5:PTR TO gadget
    DEF dummy:PTR TO gadget
    DEF typ1,typ2,typ3,typ4,typ5,id1,id2,id3,id4,id5
    SetStdRast(project0wnd.rport)               /* rastport von project0wnd setzten*/
    SetAPen(project0wnd.rport,2)

/*  Hier gebe ich nun die Werte aus die ich aus der
    IntuiMessage-Datenstruktur ausgelesen habe. */

    TextF(150,50,'mes.iaddress: $\h/ID: $\h/Type: \h             ',realgadget,realgadget.gadgetid,realgadget.gadgettype)
    dummy:=realgadget.nextgadget
    TextF(150,60,'mes.iaddress2:$\h/ID: $\h/Type: \h             ',realgadget.nextgadget,dummy.gadgetid,dummy.gadgettype)

/*  Hier versuche ich die selbe Adresse des ersten Gadgets
    aus der Window-Struktur zu ermitteln, aber komischerweise
    erhalte ich dafür andere Werte. */
    
    gadget1:=project0wnd.firstgadget
    typ1:=gadget1.gadgettype
    id1:=gadget1.gadgetid
    gadget2:=gadget1.nextgadget
    typ2:=gadget2.gadgettype
    id2:=gadget2.gadgetid
    gadget3:=gadget2.nextgadget
    typ3:=gadget3.gadgettype
    id3:=gadget3.gadgetid
    gadget4:=gadget3.nextgadget
    typ4:=gadget4.gadgettype
    id4:=gadget4.gadgetid
    gadget5:=gadget4.nextgadget
    typ5:=gadget5.gadgettype
    id5:=gadget5.gadgetid

    TextF(150,80,'Or  :$\h-$\h-$\h-$\h-$\h',gadget1,gadget2,gadget3,gadget4,gadget5)
    TextF(150,90,'{}  :$\h-$\h-$\h-$\h-$\h',{gadget1},{gadget2},{gadget3},{gadget4},{gadget5})
    TextF(150,100,'^   :$\h-$\h-$\h-$\h-$\h',^gadget1,^gadget2,^gadget3,^gadget4,^gadget5)
    TextF(150,110,'Type:$\h-$\h-$\h-$\h-$\h',typ1,typ2,typ3,typ4,typ5)
    TextF(150,120,'ID  :$\h-$\h-$\h-$\h-$\h',id1,id2,id3,id4,id5)

    IF realgadget
        OffGadget(realgadget,project0wnd,NIL)       /* Der Test ob ich mit den Adressen die Gadgets */
        Delay(10)                                   /* auch wirklich ansprechen kann. */
        OnGadget(realgadget,project0wnd,NIL)
    ENDIF
ENDPROC

