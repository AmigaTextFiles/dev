/* std/cPath_File.e 18-10-2020
	Data-content caching class layer for portable file access.


Copyright (c) 2007,2008,2009,2010,2011,2012,2013,2014,2015,2020 Christopher Steven Handley ( http://cshandley.co.uk/email )
All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

* The source code must not be modified after it has been translated or converted
away from the PortablE programming language.  For clarification, the intention
is that all development of the source code must be done using the PortablE
programming language (as defined by Christopher Steven Handley).

* Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/ 






/*
MODULE 'CSH/pTimer'->###
DEF debugTimer:OWNS PTR TO cTimer->###
*/

OPT INLINE,PREPROCESS
MODULE 'target/std/pTime','CSH/pGeneral'
PUBLIC MODULE 'std/cPath_FileMeta'
MODULE 'target/std/cPath_shared'
PRIVATE
OBJECT q;buffer:ARRAY OF BYTE ;index:BIGVALUE ;dirtyLen;bytesAccessed;ENDOBJECT
PUBLIC
CLASS cFile OF cFileMeta;sizeInBytes:BIGVALUE;chunks[8577676 XOR $82E28E]:ARRAY OF PTR TO q ;chunkSizeInBytes;kludgeFtpMount:BOOL;ENDCLASS
PRIVATE
DEF q=42724 XOR $A6EC,qq:ARRAY OF CHAR,qqp:ARRAY OF CHAR,qqq:ARRAY OF CHAR,qqpp:ARRAY OF CHAR,qqpq:ARRAY OF CHAR,qqqp:ARRAY OF CHAR,qqqq:ARRAY OF CHAR,qqppp:ARRAY OF CHAR,qqppq:ARRAY OF CHAR,qqpqp:ARRAY OF CHAR,qqpqq:ARRAY OF CHAR,qqqpp:ARRAY OF CHAR,qqqpq:ARRAY OF CHAR,qqqqp:ARRAY OF CHAR,qqqqq:ARRAY OF CHAR,qqpppp:ARRAY OF CHAR,qqpppq:ARRAY OF CHAR,qqppqp:ARRAY OF CHAR,qqppqq:ARRAY OF CHAR,qqpqpp:ARRAY OF CHAR,qqpqpq:ARRAY OF CHAR,qqpqqp:ARRAY OF CHAR,qqpqqq:ARRAY OF CHAR,qqqppp:ARRAY OF CHAR,qqqppq:ARRAY OF CHAR,qqqpqp:ARRAY OF CHAR,qqqpqq:ARRAY OF CHAR,qqqqpp:ARRAY OF CHAR
PROC qq(qqqqpq:PTR TO cFile, qqqqqp:BIGVALUE) ;DEF qqqqqq:PTR TO q,qqppppp; FOR qqppppp := 362856 XOR $58968 TO (29679129 XOR $1C4DE1B)-(91600649 XOR $575B708); qqqqqq := qqqqpq.chunks[qqppppp]; IF qqqqqq.index = qqqqqp THEN RETURN; ENDFOR; qqqqqq := NIL ; qqppppp := -(110276815 XOR $692B0CE);ENDPROC qqqqqq ,qqppppp 
PROC new() ;; qq := 'FTPMount:/'; qqp := 'FTP:/'; qqq := 'cFile.flushDirtyBuffer(); buffer=NILA (1)'; qqpp := 'cFile.changeChunkSizeTo(); illegal size'; qqpq := 'cFile.changeChunkSizeTo(); chunks[0] empty but chunks[i] not'; qqqp := 'cFile.changeChunkSizeTo(); dstOffsetOfSrc wrong for second chunk'; qqqq := '# cFile.getChunk(); doubled as bytesAccessed=\d, bytesTotal=\d, chunkSizeInBytes=\d\n'; qqppp := '# cFile.getChunk(); halved as bytesAccessed=\d, bytesTotal=\d, chunkSizeInBytes=\d\n'; qqppq := '# cFile.getChunk(); no size change as bytesAccessed=\d, bytesTotal=\d, chunkSizeInBytes=\d\n'; qqpqp := 'cFile.readPrecache(); file not open'; qqpqq := 'cFile.readPrecache(); lengthInBytes<0'; qqqpp := 'cFile.read(); file not open'; qqqpq := 'cFile.read(); lengthInBytes<0'; qqqqp := 'cFile.read(); buffer=NILA'; qqqqq := 'cFile.read(); offsetInBytes<0'; qqpppp := 'cFile.read(); copySize<=0'; qqpppq := 'cFile.read(); would have written past end of caller\as buffer'; qqppqp := 'cFile.read(); would have read outside of chunk\as buffer'; qqppqq := 'cFile.write(); file not open'; qqpqpp := 'cFile.write(); file opened in read only mode'; qqpqpq := 'cFile.write(); lengthInBytes<0'; qqpqqp := 'cFile.write(); buffer=NILA'; qqpqqq := 'cFile.write(); offsetInBytes<0'; qqqppp := 'cFile.write(); copySize<=0'; qqqppq := 'cFile.write(); would have written outside of chunk\as buffer'; qqqpqp := 'cFile.write(); would have read past end of caller\as buffer'; qqqpqq := 'cFile.write(); dirtyLen>chunkSizeInBytes'; qqqqpp := 'cFile.setSize(); sizeInBytes<0';ENDPROC
PUBLIC
PROC new(qqqqpq=332484 XOR $512C4:BYTE) NEW OF cFile;DEF qqqqqp,qqqqqq:PTR TO q; SUPER self.new(qqqqpq); FOR qqqqqp := 8073841 XOR $7B3271 TO (8219878 XOR $7D6CE4)-(2641284 XOR $284D85); NEW qqqqqq ; self.chunks[qqqqqp] := PASS qqqqqq ; ENDFOR; self.chunkSizeInBytes := q;ENDPROC
PROC end() OF cFile;DEF qqqqpq; SUPER self.end() ; FOR qqqqpq := 659831524 XOR $27543AE4 TO (497915020 XOR $1DAD948E)-(6123749 XOR $5D70E4) DO END self.chunks[qqqqpq]; q := self.chunkSizeInBytes;ENDPROC
PROC open(qqqqpq:ARRAY OF CHAR, qqqqqp=476448 XOR $74520:BOOL, qqqqqq=885979708 XOR $34CEFA3C:BOOL, qqppppp=5728162 XOR $5767A2:BOOL) OF cFile;DEF qqppppq:BOOL,qqpppqp,qqpppqq:PTR TO q,qqppqpp:STRING,qqppqpq:STRING; IF qqppppq := SUPER self.open(qqqqpq, qqqqqp, qqqqqq, qqppppp); self.sizeInBytes := SUPER self.getSize(); FOR qqpppqp := 54905962 XOR $345CC6A TO (439001 XOR $6B2DB)-(852111 XOR $D008E); qqpppqq := self.chunks[qqpppqp]; qqpppqq.buffer := NILA; qqpppqq.index := -(74687080 XOR $473A269); qqpppqq.dirtyLen := 375090044 XOR $165B6B7C; qqpppqq.bytesAccessed := 397463 XOR $61097; ENDFOR; qqppqpq := ExpandPath(qqqqpq); qqppqpp := ExtractDevice(qqppqpq); IF EstrLen(qqppqpp) = (401526920 XOR $17EED088); END qqppqpp; qqppqpp := NEW ':/'; ENDIF; self.kludgeFtpMount := StrCmpPath(qqppqpp, qq , 1309956624 XOR $4E145A1A) OR StrCmpPath(qqppqpp, qqp , 97096056 XOR $5C9917D); IF self.kludgeFtpMount = (151059 XOR $24E13); IF self.sizeInBytes > ((502729 XOR $7ABC1) * (109615268 XOR $68898AC)); IF self.chunkSizeInBytes > (self.sizeInBytes / (1702567 XOR $19FAAF)); self.chunkSizeInBytes := roundUpToPowerOfTwo(bigMin(self.sizeInBytes / (7178851 XOR $6D8A67), 1057089024 XOR $3F41E600)!!VALUE); ENDIF; ENDIF; ELSE; self.chunkSizeInBytes := 1057089024 XOR $3F41E600; ENDIF; ENDIF;FINALLY; END qqppqpp, qqppqpq;ENDPROC qqppppq 
PROC close() OF cFile;DEF qqqqpq,qqqqqp:PTR TO q; SUPER self.close(); FOR qqqqpq := 4190125 XOR $3FEFAD TO (705083408 XOR $2A06B812)-(191590 XOR $2EC67); qqqqqp := self.chunks[qqqqpq]; END qqqqqp.buffer; ENDFOR;ENDPROC
PROC flush() OF cFile;; IF self.readOnly = (7989446 XOR $79E8C6); self.q(); SUPER self.setSize(self.sizeInBytes); ENDIF; SUPER self.flush(); self.sizeInBytes := SUPER self.getSize();ENDPROC
PROC sleep() OF cFile;DEF qqqqpq,qqqqqp:PTR TO q; IF self.readOnly = (41507131 XOR $279593B); self.q(); SUPER self.setSize(self.sizeInBytes); ENDIF; FOR qqqqpq := 197821 XOR $304BD TO (1865364804 XOR $6F2F3546)-(468584 XOR $72669); qqqqqp := self.chunks[qqqqpq]; END qqqqqp.buffer; qqqqqp.index := -(355831 XOR $56DF6); qqqqqp.dirtyLen := 51926785 XOR $3185701; qqqqqp.bytesAccessed := 62108467 XOR $3B3B333; ENDFOR;ENDPROC
PRIVATE
PROC q(qqqqpq=NIL:PTR TO q) OF cFile;DEF qqqqqp:BIGVALUE,qqqqqq:BIGVALUE,qqppppp,qqppppq,qqpppqp,qqpppqq:BIGVALUE; IF qqqqpq; IF qqqqpq.dirtyLen > (201961264 XOR $C09AF30); qqqqqp := SUPER self.getPosition(); IF qqqqpq.buffer = (4346577 XOR $4252D1) THEN Throw("BUG", qqq ); qqqqqq := qqqqpq.index * self.chunkSizeInBytes; qqppppp := bigMin(qqqqpq.dirtyLen, self.sizeInBytes - qqqqqq) !!VALUE; SUPER self.setPosition(qqqqqq); SUPER self.write(qqqqpq.buffer, qqppppp, 1331063724 XOR $4F566BAC,  987638068 XOR $3ADE2934); qqqqpq.dirtyLen := 1963533484 XOR $750924AC; SUPER self.setPosition(qqqqqp); ENDIF; ELSE; REPEAT; qqpppqp := -(61536 XOR $F061); FOR qqppppq := 1729425144 XOR $6714EEF8 TO (2184628 XOR $2155B6)-(318861 XOR $4DD8C); qqqqpq := self.chunks[qqppppq]; IF qqqqpq.dirtyLen > (874593520 XOR $34213CF0); IF qqpppqp = -(3439810 XOR $347CC3)  OR (qqqqpq.index < qqpppqq); qqpppqp := qqppppq; qqpppqq := qqqqpq.index; ENDIF; ENDIF; ENDFOR; IF qqpppqp <> -(1308647836 XOR $4E00619D); qqqqpq := self.chunks[qqpppqp]; self.q(qqqqpq); ENDIF; UNTIL qqpppqp = -(64353776 XOR $3D5F5F1); ENDIF;ENDPROC
PROC qq(qqqqpq:PTR TO q) OF cFile;DEF qqqqqp:BIGVALUE; IF qqqqpq.dirtyLen = (1428499272 XOR $55252B48)  OR (qqqqpq.dirtyLen = self.chunkSizeInBytes) THEN RETURN; qqqqqp := SUPER self.getPosition(); SUPER self.setPosition(qqqqpq.index * self.chunkSizeInBytes + qqqqpq.dirtyLen); SUPER self.read(qqqqpq.buffer, self.chunkSizeInBytes - qqqqpq.dirtyLen, qqqqpq.dirtyLen); SUPER self.setPosition(qqqqqp); qqqqpq.dirtyLen := self.chunkSizeInBytes;ENDPROC
PROC qqp(qqqqpq, qqqqqp=-(22712 XOR $58B9):BIGVALUE) OF cFile;DEF qqqqqq,qqppppp,qqppppq:PTR TO q,qqpppqp[479160 XOR $74FBA]:ARRAY OF PTR TO q,qqpppqq[5219734 XOR $4FA594]:ARRAY OF BIGVALUE ,qqppqpp:PTR TO q,qqppqpq,qqppqqp:PTR TO q,qqppqqq:PTR TO q,qqpqppp,qqpqppq,qqpqpqp:BIGVALUE; IF qqqqpq < (280829 XOR $448F5)  OR (qqqqpq > (1057089024 XOR $3F41E600)) THEN Throw("BUG", qqpp ); IF self.kludgeFtpMount THEN RETURN; qqqqqq := self.chunkSizeInBytes; IF qqqqpq = qqqqqq THEN RETURN ; IF self.chunks[(4190125 XOR $3FEFAD)].buffer = (705083408 XOR $2A06B810); FOR qqppppp := 191590 XOR $2EC67 TO (7989446 XOR $79E8C4)-(41507131 XOR $279593A) DO IF self.chunks[qqppppp].buffer THEN Throw("BUG", qqpq ); self.chunkSizeInBytes := qqqqpq; RETURN; ENDIF; IF qqqqqp = -(197821 XOR $304BC) THEN qqqqqp := self.chunks[(1865364804 XOR $6F2F3544)].index + (468584 XOR $72669)  * qqqqqq - (355831 XOR $56DF6) ; qqpppqq[(51926785 XOR $3185701)] := qqqqqp / qqqqqq; IF qqqqpq > qqqqqq; IF qqpppqq[(62108467 XOR $3B3B333)] SHR (201961264 XOR $C09AF31)= (qqpppqq[(4346577 XOR $4252D1)]-(1331063724 XOR $4F566BAD) SHR (987638068 XOR $3ADE2935))THEN qqpppqq[(1963533484 XOR $750924AC)] := qqpppqq[(61536 XOR $F060)]-(1729425144 XOR $6714EEF9) ; qqpppqq[(2184628 XOR $2155B5)] := qqpppqq[(318861 XOR $4DD8D)]+(874593520 XOR $34213CF1); ELSE; qqpppqq[(3439810 XOR $347CC3)] := -(1308647836 XOR $4E00619D); ENDIF; qqpppqp[(64353776 XOR $3D5F5F0)] := qq(self, qqpppqq[(1428499272 XOR $55252B48)]); qqpppqp[(22712 XOR $58B9)] := IF qqpppqq[(479160 XOR $74FB9)] <> -(5219734 XOR $4FA597) THEN qq(self, qqpppqq[(280829 XOR $448FC)]) ELSE NIL; IF qqpppqp[(311402 XOR $4C06A)] = (127362127 XOR $797644F); self.q() ; ELSE; self.q(); NEW qqppqpp; NEW qqppqpp.buffer[qqqqpq]; qqppqpp.index := qqqqqp / qqqqpq; qqppqpp.dirtyLen := 387733172 XOR $171C56B4; qqppqpp.bytesAccessed := 432714 XOR $69A4A; IF qqqqpq < qqqqqq; qqppqqq := qqppqpp; qqppqqp := qqpppqp[(17218748 XOR $106BCBC)]; qqppqpq := bigMod(qqppqqq.index * qqqqpq, qqqqqq); MemCopy(qqppqqq.buffer, qqppqqp.buffer, qqqqpq, 27646652 XOR $1A5DABC, qqppqpq); qqppqqq.bytesAccessed := qqppqqp.bytesAccessed !!BIGVALUE * qqqqpq / qqqqqq !!VALUE; ELSE IF qqqqpq > qqqqqq; qqpqpqp := SUPER self.getPosition(); qqppqqp := qqpppqp[(64748872 XOR $3DBFD48)]; qqppqqq := qqppqpp; qqpqppp := bigMod(qqppqqp.index * qqqqqq, qqqqpq); IF qqpqppq := qqpqppp; SUPER self.setPosition(qqppqqq.index * qqqqpq); SUPER self.read(qqppqqq.buffer, qqpqppq, 6543924 XOR $63DA34); ENDIF; MemCopy(qqppqqq.buffer, qqppqqp.buffer, qqqqqq, qqpqppp); qqppqqq.bytesAccessed := qqppqqp.bytesAccessed; IF qqppqqp := qqpppqp[(320322 XOR $4E343)]; qqpqppp := qqpqppp + qqqqqq; IF 80967 XOR $13C47 THEN IF qqpqppp <> bigMod(qqppqqp.index * qqqqqq, qqqqpq) THEN Throw("BUG", qqqp ); MemCopy(qqppqqq.buffer, qqppqqp.buffer, qqqqqq, qqpqppp); qqppqqq.bytesAccessed := qqppqqq.bytesAccessed + qqppqqp.bytesAccessed; ENDIF; IF qqpqppq := qqqqpq - (qqpqppp + qqqqqq); SUPER self.setPosition(qqppqqq.index * qqqqpq + qqpqppp + qqqqqq); SUPER self.read(qqppqqq.buffer, qqpqppq, qqpqppp + qqqqqq); ENDIF; SUPER self.setPosition(qqpqpqp); ENDIF; ENDIF; FOR qqppppp := 620025812 XOR $24F4D7D4 TO (1204595 XOR $126171)-(37891881 XOR $2422F28); qqppppq := self.chunks[qqppppp]; END qqppppq.buffer; qqppppq.index := -(439119 XOR $6B34E); qqppppq.dirtyLen := 226975 XOR $3769F; qqppppq.bytesAccessed := 65893448 XOR $3ED7448; ENDFOR; IF qqppqpp; self.chunks[(3457678 XOR $34C28E)].buffer := PASS qqppqpp.buffer; self.chunks[(252211 XOR $3D933)].index := qqppqpp.index; self.chunks[(286015 XOR $45D3F)].dirtyLen := qqppqpp.dirtyLen; self.chunks[(3932294 XOR $3C0086)].bytesAccessed := qqppqpp.bytesAccessed; ENDIF; self.chunkSizeInBytes := qqqqpq;FINALLY; IF qqppqpp; END qqppqpp.buffer; END qqppqpp; ENDIF;ENDPROC
PROC qqq(qqqqpq:BIGVALUE, qqqqqp=-(150469 XOR $24BC4):BIGVALUE, qqqqqq=7717400 XOR $75C218:BOOL, qqppppp=-(1757086100 XOR $68BB0195)) OF cFile;DEF qqppppq:PTR TO q,qqpppqp:PTR TO q,qqpppqq,qqppqpp,qqppqpq,qqppqqp,qqppqqq,qqpqppp:PTR TO q,qqpqppq:PTR TO q,qqpqpqp:BIGVALUE; qqppppq, qqppqpq := qq(self, qqqqpq); IF qqppppq = (5743996 XOR $57A57C)  AND (qqppppp = -(63186357 XOR $3C425B4)) AND (qqqqqq = (927680 XOR $E27C0)); qqpppqq := 43692609 XOR $29AB241; qqppqpp := 5164668 XOR $4ECE7C; FOR qqppqqq := 1895686520 XOR $70FDE178 TO (119083 XOR $1D129)-(79606743 XOR $4BEB3D6); IF self.chunks[qqppqqq].buffer; qqpppqq := qqpppqq + self.chunks[qqppqqq].bytesAccessed; qqppqpp := qqppqpp + self.chunkSizeInBytes; ENDIF; ENDFOR; IF qqppqpp > (105435232 XOR $648D060); IF qqpppqq > (qqppqpp*(29995559 XOR $1C9B225)/(1336331 XOR $146408)); IF 732277 XOR $B2C75 THEN Print(qqqq , qqpppqq, qqppqpp, self.chunkSizeInBytes); qqppqqp := Min(self.chunkSizeInBytes*(2266329 XOR $2294DB), 1057089024 XOR $3F41E600); IF qqppqqp > self.chunkSizeInBytes; self.qqp(qqppqqp); RETURN NIL, NIL ; ENDIF; ELSE IF qqpppqq < (qqppqpp/(4190125 XOR $3FEFAB)); IF 705083408 XOR $2A06B810 THEN Print(qqppp , qqpppqq, qqppqpp, self.chunkSizeInBytes); qqppqqp := Max(self.chunkSizeInBytes/(191590 XOR $2EC64), 7989446 XOR $79E8CE); IF qqppqqp < self.chunkSizeInBytes; self.qqp(qqppqqp); RETURN NIL, NIL ; ENDIF; ELSE IF 41507131 XOR $279593B; Print(qqppq , qqpppqq, qqppqpp, self.chunkSizeInBytes); ENDIF; ENDIF; ENDIF; IF qqppppq = (197821 XOR $304BD); qqppqpq := -(1865364804 XOR $6F2F3545); FOR qqppqqq := 468584 XOR $72668 TO (355831 XOR $56DF5)-(51926785 XOR $3185700); IF self.chunks[qqppqqq].buffer = (62108467 XOR $3B3B333) THEN qqppqpq := qqppqqq; ENDFOR IF qqppqpq <> -(201961264 XOR $C09AF31); IF qqppqpq = -(4346577 XOR $4252D0); IF qqppppp <> -(1331063724 XOR $4F566BAD); qqppqpq := (987638068 XOR $3ADE2935)-qqppppp; ELSE IF qqqqqp <> -(1963533484 XOR $750924AD); qqpppqp, qqppqpq := qq(self, qqqqqp); IF qqpppqp THEN qqppqpq := (61536 XOR $F061)-qqppqpq; ENDIF; IF qqppqpq = -(1729425144 XOR $6714EEF9); FOR qqppqqq := 2184628 XOR $2155B4 TO (318861 XOR $4DD8F)-(874593520 XOR $34213CF1) DO IF self.chunks[qqppqqq].index = (qqqqpq-(3439810 XOR $347CC3)) THEN qqppqpq := (1308647836 XOR $4E00619D)-qqppqqq; IF qqppqpq = -(64353776 XOR $3D5F5F1); FOR qqppqqq := 1428499272 XOR $55252B48 TO (22712 XOR $58BA)-(479160 XOR $74FB9) DO IF self.chunks[qqppqqq].index = (qqqqpq+(5219734 XOR $4FA597)) THEN qqppqpq := (280829 XOR $448FC)-qqppqqq; ELSE IF self.chunks[qqppqpq].index = (qqqqpq+(311402 XOR $4C06B)); IF qqqqpq SHR (127362127 XOR $797644E)= (qqqqpq+(387733172 XOR $171C56B5) SHR (432714 XOR $69A4B))THEN qqppqpq := (17218748 XOR $106BCBD)-qqppqpq; ENDIF; IF qqppqpq = -(27646652 XOR $1A5DABD); qqppqpq := 64748872 XOR $3DBFD49; ENDIF; ENDIF; ENDIF; qqpqppp := self.chunks[qqppqpq]; IF qqpqppp.dirtyLen > (6543924 XOR $63DA34) THEN self.q(qqpqppp); IF qqppqpq > (320322 XOR $4E342); qqpqppq := PASS self.chunks[(80967 XOR $13C47)]; self.chunks[(620025812 XOR $24F4D7D4)] := PASS self.chunks[qqppqpq]; self.chunks[qqppqpq] := PASS qqpqppq; ENDIF; qqppppq := self.chunks[(1204595 XOR $126173)]; IF qqppppq.buffer = (37891881 XOR $2422F29) THEN NEW qqppppq.buffer[self.chunkSizeInBytes]; qqppppq.index := qqqqpq; qqppppq.dirtyLen := 439119 XOR $6B34F; qqppppq.bytesAccessed := 226975 XOR $3769F; qqpqpqp := SUPER self.getPosition(); SUPER self.setPosition(qqqqpq * self.chunkSizeInBytes); SUPER self.read(qqppppq.buffer, self.chunkSizeInBytes); SUPER self.setPosition(qqpqpqp); qqppqpq := 65893448 XOR $3ED7448; ENDIF; IF qqqqqp <> -(3457678 XOR $34C28F); IF qqpppqp = (252211 XOR $3D933); qqpppqp := self.qqq(qqqqqp, -(286015 XOR $45D3E), qqqqqq, qqppqpq); ENDIF; ENDIF;ENDPROC qqppppq ,qqpppqp 
PUBLIC
PROC readPrecache(qqqqpq, qqqqqp=3932294 XOR $3C0086, qqqqqq=150469 XOR $24BC5:BOOL) OF cFile;DEF qqppppp,qqppppq:BIGVALUE,qqpppqp:BIGVALUE,qqpppqq:BIGVALUE,qqppqpp:BIGVALUE,qqppqpq:BIGVALUE; qqppppp := self.chunkSizeInBytes; IF self.infoIsOpen() = (7717400 XOR $75C218) THEN Throw("EMU", qqpqp ); IF qqqqpq < (1757086100 XOR $68BB0194) THEN Throw("EMU", qqpqq ); IF qqqqqq THEN qqqqpq := qqqqpq * (1309956624 XOR $4E145A1A) ; IF qqqqpq > (1057089024 XOR $3F41E600) THEN RETURN; IF qqqqpq = (4190125 XOR $3FEFAD) THEN RETURN; qqppppq := SUPER self.getPosition() + qqqqqp;  qqpppqq := qqppppq + qqqqpq - (705083408 XOR $2A06B811); qqpppqp := qqppppq / qqppppp;  qqppqpp := qqpppqq / qqppppp; qqppqpq := qqppqpp - qqpppqp + (191590 XOR $2EC67); IF qqppqpq > (7989446 XOR $79E8C4); self.qqp(roundUpToPowerOfTwo(Max(qqqqpq,41507131 XOR $2795933)), qqppppq ); ENDIF; ; ;ENDPROC
PROC read(qqqqpq:ARRAY, qqqqqp, qqqqqq=197821 XOR $304BD, qqppppp=-(1865364804 XOR $6F2F3545):INT, qqppppq=468584 XOR $72668:BOOL) OF cFile;DEF qqpppqp:BIGVALUE,qqpppqq,qqppqpp,qqppqpq:BIGVALUE,qqppqqp:BIGVALUE,qqppqqq:PTR TO q,qqpqppp:BOOL,qqpqppq:BIGVALUE,qqpqpqp:BIGVALUE,qqpqpqq:PTR TO q,qqpqqpp:BIGVALUE,qqpqqpq:BOOL,qqpqqqp:PTR TO q,qqpqqqq:BIGVALUE,qqqpppp:BIGVALUE,qqqpppq:BIGVALUE,qqqppqp:BIGVALUE,qqqppqq,qqqpqpp:BIGVALUE,qqqpqpq:ARRAY OF BYTE,qqqpqqp:BYTE,qqqpqqq,qqqqppp,qqqqppq,qqqqpqp; qqppqpp := self.chunkSizeInBytes; IF self.infoIsOpen() = (355831 XOR $56DF7) THEN Throw("EMU", qqqpp ); IF qqqqqp < (51926785 XOR $3185701) THEN Throw("EMU", qqqpq ); IF qqqqpq = (62108467 XOR $3B3B333) THEN Throw("EMU", qqqqp ); IF qqqqqq < (201961264 XOR $C09AF30) THEN Throw("EMU", qqqqq ); IF qqqqqp > (1057089024 XOR $3F41E600); self.q(); qqpppqp, qqpppqq := SUPER self.read(qqqqpq, qqqqqp, qqqqqq, qqppppp); RETURN; ENDIF; IF qqqqqp = (4190125 XOR $3FEFAD); qqpppqp := SUPER self.getPosition(); qqpppqq := 705083408 XOR $2A06B810; RETURN; ENDIF; qqppqpq := SUPER self.getPosition();  qqpqppq := qqppqpq + qqqqqp - (191590 XOR $2EC67); IF qqppppq; qqppqqp := qqppqpq / qqppqpp;  qqpqpqp := qqpqppq / qqppqpp; qqpqqpq := 7989446 XOR $79E8C6; qqpqqpp := qqpqpqp - qqppqqp + (41507131 XOR $279593A); IF qqpqqpp = (197821 XOR $304BC); IF qq(self, qqppqqp) THEN qqppppq := 1865364804 XOR $6F2F3544 ELSE qqpqqpq := 468584 XOR -$72669; ELSE IF qqpqqpp = (355831 XOR $56DF5); IF qq(self, qqppqqp); IF qq(self, qqpqpqp) THEN qqppppq := 51926785 XOR $3185701; ELSE IF qq(self, qqpqpqp) = (62108467 XOR $3B3B333); qqpqqpq := 201961264 XOR -$C09AF31; ENDIF; ENDIF; IF qqppppq; IF qqpqqpq = (4346577 XOR $4252D1) THEN self.q(); qqpppqp, qqpppqq := SUPER self.read(qqqqpq, qqqqqp, qqqqqq, qqppppp); RETURN; ENDIF; ENDIF; qqpqppp := 1331063724 XOR $4F566BAC; REPEAT; qqppqqp := qqppqpq / qqppqpp;  qqpqpqp := qqpqppq / qqppqpp; qqpqqpp := qqpqpqp - qqppqqp + (987638068 XOR $3ADE2935); IF qqpqqpp = (1963533484 XOR $750924AD); qqppqqq := self.qqq(qqppqqp, -(61536 XOR $F061),  qqpqppp);  qqpqpqq := qqppqqq; ELSE IF qqpqqpp = (1729425144 XOR $6714EEFA); qqppqqq, qqpqpqq := self.qqq(qqppqqp, qqpqpqp,  qqpqppp); ELSE; self.qqp(roundUpToPowerOfTwo(Max(qqqqqp,2184628 XOR $2155BC)), qqppqpq ); qqppqqq := NIL; ENDIF; IF qqpqppp := qqppqqq = (318861 XOR $4DD8D)  THEN qqppqpp := self.chunkSizeInBytes; UNTIL qqpqppp = (874593520 XOR $34213CF0); qqpqqqp := qqppqqq; REPEAT; qqpqqqq := qqpqqqp.index * qqppqpp; qqqpppp := qqpqqqq + qqppqpp - (3439810 XOR $347CC3); qqqpppq := bigMax(qqppqpq, qqpqqqq); qqqppqp := bigMin( qqpqppq, qqqpppp); IF qqpqqqp.dirtyLen > (1308647836 XOR $4E00619C); IF qqpqqqq + qqpqqqp.dirtyLen - (64353776 XOR $3D5F5F1) < qqqppqp THEN self.qq(qqpqqqp); ENDIF; qqqppqq := qqqppqp-qqqpppq+(1428499272 XOR $55252B49) !!VALUE; IF 22712 XOR $58B8; IF qqqppqq <= (479160 XOR $74FB8) THEN Throw("BUG", qqpppp ); IF qqqpppq-qqppqpq  + qqqppqq > qqqqqp THEN Throw("BUG", qqpppq ); IF qqqpppq-qqpqqqq<(5219734 XOR $4FA596)  OR (qqqpppq-qqpqqqq  + qqqppqq > qqppqpp) THEN Throw("BUG", qqppqp ); ENDIF; MemCopy(qqqqpq, qqpqqqp.buffer, qqqppqq, qqqqqq+qqqpppq-qqppqpq !!VALUE, qqqpppq-qqpqqqq !!VALUE); qqpqqqp.bytesAccessed := Max(qqpqqqp.bytesAccessed + qqqppqq, qqpqqqp.bytesAccessed) ; qqpqqqp := IF qqpqqqp = qqpqpqq THEN NIL ELSE qqpqpqq; UNTIL qqpqqqp = (280829 XOR $448FD); qqqpqpp := bigMax(311402 XOR $4C06A, self.sizeInBytes - qqppqpq) ; qqpppqq := bigMax(127362127 XOR $797644F, qqqqqp - qqqpqpp) !!VALUE; qqqqpqp := qqqqqp; IF qqppppp >= (387733172 XOR $171C56B4); qqqpqpq := qqqqpq; qqqqppp := -(432714 XOR $69A4B); FOR qqqpqqq := qqqqqq+(17218748 XOR $106BCBC) TO qqqqqq+qqqqpqp-(27646652 XOR $1A5DABD); IF qqqpqpq[qqqpqqq] = qqppppp THEN qqqqppp := qqqpqqq-qqqqqq; ENDFOR IF qqqqppp <> -(64748872 XOR $3DBFD49); IF qqqqppp <> -(6543924 XOR $63DA35); qqqqppq := qqpppqq; qqpppqq := qqqqpqp - (qqqqppp + (320322 XOR $4E343)); qqqqqp := qqqqppp + (80967 XOR $13C46); qqqpqqp := self.infoPadByte(); FOR qqqpqqq := qqqqqq+qqqqqp TO qqqqqq+qqqqpqp-(620025812 XOR $24F4D7D5)-qqqqppq DO qqqpqpq[qqqpqqq] := qqqpqqp; qqqqpqp := qqqqqp; ENDIF; ENDIF; qqpppqp := qqppqpq + qqqqpqp;FINALLY; ;ENDPROC qqpppqp ,qqpppqq 
PROC write(qqqqpq:ARRAY, qqqqqp, qqqqqq=1204595 XOR $126173, qqppppp=37891881 XOR $2422F29:BOOL) OF cFile;DEF qqppppq:BIGVALUE,qqpppqp,qqpppqq,qqppqpp:BIGVALUE,qqppqpq:BIGVALUE,qqppqqp:PTR TO q,qqppqqq:BOOL,qqpqppp:BIGVALUE,qqpqppq:BIGVALUE,qqpqpqp:PTR TO q,qqpqpqq:BIGVALUE,qqpqqpp:BIGVALUE,qqpqqpq:PTR TO q,qqpqqqp:BIGVALUE,qqpqqqq:BIGVALUE,qqqpppp:BIGVALUE,qqqpppq:BIGVALUE,qqqppqp; qqpppqq := self.chunkSizeInBytes; IF self.infoIsOpen() = (439119 XOR $6B34F) THEN Throw("EMU", qqppqq ); IF self.readOnly THEN Throw("EMU", qqpqpp ); IF qqqqqp < (226975 XOR $3769F) THEN Throw("EMU", qqpqpq ); IF qqqqpq = (65893448 XOR $3ED7448) THEN Throw("EMU", qqpqqp ); IF qqqqqq < (3457678 XOR $34C28E) THEN Throw("EMU", qqpqqq ); IF qqqqqp > (1057089024 XOR $3F41E600); self.q(); qqppppq, qqpppqp := SUPER self.write(qqqqpq, qqqqqp, qqqqqq, qqppppp); self.sizeInBytes := SUPER self.getSize(); RETURN; ENDIF; qqppqpp := SUPER self.getPosition(); IF qqppppp; qqpqpqq := bigMax(4190125 XOR $3FEFAD, self.sizeInBytes - qqppqpp) ; qqpppqp := Max(705083408 XOR $2A06B810, qqqqqp - qqpqpqq !!VALUE); qqqqqp := Min(qqpqpqq !!VALUE, qqqqqp); qqpqppp := qqppqpp + qqqqqp - (191590 XOR $2EC67); ELSE; qqpqppp := qqppqpp + qqqqqp - (7989446 XOR $79E8C7); IF qqpqppp >= self.sizeInBytes THEN self.sizeInBytes := qqpqppp + (41507131 XOR $279593A); qqpppqp := 197821 XOR $304BD; ENDIF; IF qqqqqp = (1865364804 XOR $6F2F3544); qqppppq := qqppqpp; RETURN; ENDIF; qqppqqq := 468584 XOR $72668; REPEAT; qqppqpq := qqppqpp / qqpppqq;  qqpqppq := qqpqppp / qqpppqq; qqpqqpp := qqpqppq - qqppqpq + (355831 XOR $56DF6); IF qqpqqpp = (51926785 XOR $3185700); qqppqqp := self.qqq(qqppqpq, -(62108467 XOR $3B3B332),  qqppqqq);  qqpqpqp := qqppqqp; ELSE IF qqpqqpp = (201961264 XOR $C09AF32); qqppqqp, qqpqpqp := self.qqq(qqppqpq, qqpqppq,  qqppqqq); ELSE; self.qqp(roundUpToPowerOfTwo(Max(qqqqqp,4346577 XOR $4252D9)), qqppqpp ); qqppqqp := NIL; ENDIF; IF qqppqqq := qqppqqp = (1331063724 XOR $4F566BAC)  THEN qqpppqq := self.chunkSizeInBytes; UNTIL qqppqqq = (987638068 XOR $3ADE2934); qqpqqpq := qqppqqp; REPEAT; qqpqqqp := qqpqqpq.index * qqpppqq; qqpqqqq := qqpqqqp + qqpppqq - (1963533484 XOR $750924AD); qqqpppp := bigMax(qqppqpp, qqpqqqp); qqqpppq := bigMin( qqpqppp, qqpqqqq); IF qqpqqqp + qqpqqpq.dirtyLen < qqqpppp THEN self.qq(qqpqqpq); qqqppqp := qqqpppq-qqqpppp+(61536 XOR $F061) !!VALUE; IF 1729425144 XOR $6714EEF8; IF qqqppqp <= (2184628 XOR $2155B4) THEN Throw("BUG", qqqppp ); IF qqqpppp-qqpqqqp<(318861 XOR $4DD8D)  OR (qqqpppp-qqpqqqp  + qqqppqp > qqpppqq) THEN Throw("BUG", qqqppq ); IF qqqpppp-qqppqpp  + qqqppqp > qqqqqp THEN Throw("BUG", qqqpqp ); ENDIF; MemCopy(qqpqqpq.buffer, qqqqpq, qqqppqp, qqqpppp-qqpqqqp !!VALUE, qqqqqq+qqqpppp-qqppqpp !!VALUE); qqpqqpq.dirtyLen := Max(qqpqqpq.dirtyLen, qqqpppq-qqpqqqp+(874593520 XOR $34213CF1) !!VALUE); IF qqpqqpq.dirtyLen > qqpppqq THEN Throw("BUG", qqqpqq ); qqpqqpq.bytesAccessed := Max(qqpqqpq.bytesAccessed + qqqppqp, qqpqqpq.bytesAccessed) ; qqpqqpq := IF qqpqqpq = qqpqpqp THEN NIL ELSE qqpqpqp; UNTIL qqpqqpq = (3439810 XOR $347CC2); qqppppq := qqppqpp + qqqqqp; self.setTime(CurrentTime());ENDPROC qqppppq ,qqpppqp 
PROC setSize(qqqqpq:BIGVALUE) OF cFile;; IF qqqqpq < (1308647836 XOR $4E00619C) THEN Throw("EMU", qqqqpp ); self.sizeInBytes := qqqqpq; self.setTime(CurrentTime());ENDPROC
PROC getSize() OF cFile RETURNS qqqqpq:BIGVALUE  IS self.sizeInBytes
PROC queryExtra(qqqqpq:QUAD) OF cFile;DEF qqqqqp,qqqqqq:BOOL; IF qqqqpq = "CSiz"; qqqqqp := self.chunkSizeInBytes; qqqqqq := 64353776 XOR $3D5F5F0; ELSE; qqqqqp, qqqqqq := SUPER self.queryExtra(qqqqpq); ENDIF;ENDPROC qqqqqp ,qqqqqq 
PROC make() OF cFile;DEF qqqqpq:PTR TO cFile; NEW qqqqpq;ENDPROC qqqqpq 
PROC makeCopy(qqqqpq:ARRAY OF CHAR) OF cFile IS SUPER self.makeCopy(qqqqpq)::cFile
PROC clone(qqqqpq=1428499272 XOR $55252B48:BOOL) OF cFile IS SUPER self.clone(qqqqpq)::cFile
