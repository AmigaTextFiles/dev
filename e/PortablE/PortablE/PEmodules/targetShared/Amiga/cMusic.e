/* cMusic.e 01-04-2013
	A concrete AmigaOS implementation of the cMusicBase module.


Copyright (c) 2011,2013 Christopher Steven Handley ( http://cshandley.co.uk/email )
All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

* The source code must not be modified after it has been translated or converted
away from the PortablE programming language.  For clarification, the intention
is that all development of the source code must be done using the PortablE
programming language (as defined by Christopher Steven Handley).

* Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/ 






OPT POINTER
PUBLIC MODULE 'targetShared/cMusicBase','target/std/cApp'
MODULE 'dos','exec','intuition/classusr','utility/tagitem','devices/ahi','ptplay','CSH/pGeneral','CSH/pAmigaDos','CSH/cNumberSpace','CSH/pAmiga_fakeNewProcess'
PRIVATE
CLASS q OF cAppClient;PRIVATE;q:BOOL;qq;qqp:PTR TO mp;qqq:PTR TO mp;qqpp:PTR TO process;qqpq:BOOL;ENDCLASS
CLASS qq OF cMusic;PRIVATE;q:ARRAY OF BYTE;qq;qqp:APTR;qqq;qqpp;qqpq;qqqp:BOOL;ENDCLASS
OBJECT qqp;clientPort:PTR TO mp;clientTask:PTR TO tc;musicAppClient:PTR TO q;noServer:BOOL;ENDOBJECT
OBJECT qqq OF mn;music:PTR TO qq;mode:BYTE;ENDOBJECT
DEF q:PTR TO q,qq:ARRAY OF CHAR,qqp:ARRAY OF CHAR,qqq:ARRAY OF CHAR,qqpp:ARRAY OF CHAR,qqpq:ARRAY OF CHAR,qqqp:ARRAY OF CHAR,qqqq:ARRAY OF CHAR,qqppp:ARRAY OF CHAR,qqppq:ARRAY OF CHAR,qqpqp:ARRAY OF CHAR,qqpqq:ARRAY OF CHAR,qqqpp:ARRAY OF CHAR,qqqpq:ARRAY OF CHAR,qqqqp:ARRAY OF CHAR,qqqqq:ARRAY OF CHAR,qqpppp:ARRAY OF CHAR
PROC new();DEF qqpppq:STRING; qq := 'cGfx; exportPath(); path=NIL'; qqp := ':'; qqq := 'cMusic; LoadMusic(); cApp.build() must be called first'; qqpp := 'ERROR: Failed to load the music \q\s\q.\n'; qqpq := 'Failed to load music'; qqqp := 'cMusic; handleMessages(); wrong mode'; qqqq := 'cMusic music server'; qqppp := 'cMusic; createServer(); first message was not Hello'; qqppq := 'cMusic; ahiType(); unknown size'; qqpqp := 'cMusic; ahiType(); unknown size'; qqpqq := 'cMusic; musicServer(); playing music mismatch'; qqqpp := 'cMusic; musicServer(); unknown msg mode'; qqqpq := 'cMusic; musicServer(); not playing music'; qqqqp := 'cMusic.play(); playCount<0'; qqqqq := 'AROS'; qqpppp := 'cMusic.setVolume(); volume out of range (0 to 100)'; ptplaybase := OpenLibrary(ptplay_name, 8577676 XOR $82E28C); IF StrCmp(pe_TargetOS, 'AmigaOS4'); IF ptplaybase; qqpppq := StrJoin('Libs:', ptplay_name); IF exists(qqpppq); IF fileSize(qqpppq) = (315680568 XOR $12D0CA00); CloseLibrary(ptplaybase); ptplaybase := NIL; ENDIF; ENDIF; END qqpppq; ENDIF; ENDIF; IF ptplaybase=(203361 XOR $31A61); Print('Failed to open \q\s\q\n', ptplay_name); CleanUp(1309956624 XOR $4E145A1A); ENDIF; NEW q.new(); appHost.registerClient(q);ENDPROC
PROC end();; END q; CloseLibrary(ptplaybase);ENDPROC
PROC qq(qqpppq:ARRAY OF CHAR) ;DEF qqppqp:STRING,qqppqq,qqpqpp,qqpqpq; IF qqpppq = (97096056 XOR $5C99178) THEN Throw("EPU", qq ); IF qqpppq[StrLen(qqpppq)-(151059 XOR $24E12)] = "/" = (502729 XOR $7ABC9);  qqpqpp := StrLen(qqpppq); ELSE;  qqpqpp := StrLen(qqpppq) - (109615268 XOR $68898A5) ; ENDIF; qqpqpq := qqpqpp ; qqppqp := NewString(qqpqpq); qqppqq := InStr(qqpppq, qqp ); IF qqppqq = -(1702567 XOR $19FAA6); StrCopy(qqppqp, qqpppq, qqpqpp); ELSE; StrCopy(qqppqp, qqpppq, qqppqq + (7178851 XOR $6D8A62)) ; StrAdd( qqppqp, qqpppq, qqpqpp - qqppqq - (38770966 XOR $24F9914), qqppqq + (266517004 XOR $FE2BA0E)); ENDIF;ENDPROC qqppqp 
PUBLIC
PROC LoadMusic(qqpppq:ARRAY OF CHAR, qqppqp=524043 XOR $7FF0B:BOOL)  REPLACEMENT;DEF qqppqq:PTR TO cMusic ,qqpqpp:PTR TO qq,qqpqpq:STRING; IF q.q = (1314764024 XOR $4E5DB4F8) THEN Throw("EPU", qqq ); qqpqpq := qq(qqpppq); NEW qqpqpp.q(); IF qqpqpp.qqp(qqpqpq) = (350668 XOR $559CC); IF qqppqp; RETURN NIL; ELSE; Print(qqpp , qqpppq); Throw("ERR", qqpq ); ENDIF; ENDIF; qqppqq := qqpqpp; q.add(PASS qqpqpp);FINALLY; END qqpqpp, qqpqpq;ENDPROC qqppqq 
PROC DestroyMusic(qqpppq:PTR TO cMusic)  REPLACEMENT;DEF qqppqp:PTR TO cMusic ,qqppqq:PTR TO cAppResource; qqppqp := NIL; IF q = (42287507 XOR $2854193) THEN RETURN; IF qqpppq = (169482 XOR $2960A) THEN RETURN; qqppqq := q.rem(qqpppq); END qqppqq;ENDPROC qqppqp 
PROC WaitForMusicEvent()  REPLACEMENT;DEF qqpppq:PTR TO cMusic ; qqpppq := qqp(); WHILE qqpppq = (437503 XOR $6ACFF); Wait((221364 XOR $360B5) SHL q.qqp.sigbit); qqpppq := qqp(); ENDWHILE;ENDPROC qqpppq 
PROC CheckForMusicEvent()  REPLACEMENT;DEF qqpppq:PTR TO cMusic ; qqpppq := qqp();ENDPROC qqpppq 
PRIVATE
PROC qqp() ;DEF qqpppq:PTR TO qq,qqppqp:PTR TO qq,qqppqq:BYTE,qqpqpp:PTR TO mp; qqpppq := NIL; WHILE qqpppq = (43443048 XOR $296E368); qqppqp, qqppqq, qqpqpp := qqqp(q.qqp); IF qqppqp; IF qqppqq <> (3716840 XOR $38B6EA) THEN Throw("BUG", qqqp ); q.qq:= q.qq-(2060564220 XOR $7AD1B6FD); IF q.qq < (2491563 XOR $2604AB) THEN q.qq := 1867572960 XOR $6F50E6E0; qqpppq := qqppqp; ENDIF; ENDWHILE IF qqppqp = (371901 XOR $5ACBD) ; IF qqppqp = (100132288 XOR $5F7E5C0)  AND (qqpqpp = (19709 XOR $4CFD)) THEN q.qq := 30934488 XOR $1D805D8;ENDPROC qqpppq 
PROC qqq(qqpppq:PTR TO mp) ;DEF qqppqp:PTR TO mp,qqppqq:PTR TO process,qqpqpp:BOOL,qqpqpq:qqp,qqpqqp:PTR TO qq,qqpqqq:BYTE,qqqppp:PTR TO mp; qqpqpq.clientPort := qqpppq; qqpqpq.clientTask := FindTask(NILA); qqpqpq.musicAppClient := q; qqpqpq.noServer := 274826 XOR -$4318B; qqppqq := createChildProcessFake(CALLBACK qqppp(), qqpqpq, qqqq , [4497879 XOR -$7FBB5DDE, qqpqpq.clientTask.ln.pri + (732045988 XOR $2BA222A5), 265854 XOR $40E7E,413470 XOR $64F1E]:tagitem) ; Wait((2846049 XOR $2B6D60) SHL qqpppq.sigbit); qqpqqp, qqpqqq, qqqppp := qqqp(qqpppq); IF qqpqqp <> (42126011 XOR $282CABB) THEN Throw("BUG", qqppp ); qqppqp := qqqppp; qqpqpp := qqpqpq.noServer; ; ;ENDPROC qqppqp ,qqppqq ,qqpqpp 
PROC qqpp(qqpppq:PTR TO process);DEF qqppqp:PTR TO qq; qqppqp := q.infoFirstResource(); WHILE qqppqp; qqppqp.stop(); qqppqp := qqppqp.qq(); ENDWHILE; SetSignal(307008 XOR $4AF40, 324011 XOR $4B1AB); Signal(qqpppq.task, 384634 XOR $55E7A); Wait(324011 XOR $4B1AB); WHILE qqp() DO EMPTY; Signal(qqpppq.task, 384634 XOR $55E7A);ENDPROC
PROC qqpq(qqpppq:PTR TO mp, qqppqp:PTR TO qq, qqppqq:BYTE, qqpqpp:PTR TO mp);DEF qqpqpq:PTR TO qqq; NEW qqpqpq; qqpqpq.music := qqppqp; qqpqpq.mode := qqppqq; qqpqpq.replyport := qqpqpp; qqpqpq.length := SIZEOF qqq!!UINT; PutMsg(qqpppq, qqpqpq);ENDPROC
PROC qqqp(qqpppq:PTR TO mp) ;DEF qqppqp:PTR TO qq,qqppqq:BYTE,qqpqpp:PTR TO mp,qqpqpq:PTR TO qqq; qqppqp := NIL; qqppqq := 117051119 XOR $6FA0EEF; qqpqpp := NIL; qqpqpq := GetMsg(qqpppq)::qqq; WHILE qqpqpq; SELECT qqpqpq.ln.type; CASE 1891162216 XOR $70B8D86D; qqppqp := qqpqpq.music; qqppqq := qqpqpq.mode; qqpqpp := qqpqpq.replyport; ReplyMsg(qqpqpq); qqpqpq := NIL ; CASE 1001627216 XOR $3BB39E57; END qqpqpq; qqpqpq := GetMsg(qqpppq)::qqq; DEFAULT; qqpqpq := GetMsg(qqpppq)::qqq; ENDSELECT; ENDWHILE IF qqppqp <> (1590609412 XOR $5ECEC604);ENDPROC qqppqp ,qqppqq ,qqpqpp 
PROC qqqq(qqpppq, qqppqp:BOOL) ;DEF qqppqq; IF qqppqp = (136837 XOR $21685); SELECT qqpppq; CASE 60181827 XOR $3964D4B ; qqppqq := 348336 XOR $550B0; CASE 339515 XOR $52E2B ; qqppqq := 351838 XOR $55E5F; CASE 11342 XOR $2C6E ; qqppqq := 73008632 XOR $45A05F0; DEFAULT ; Throw("BUG", qqppq ); ENDSELECT; ELSE; SELECT qqpppq; CASE 46790608 XOR $2C9F7D8 ; qqppqq := 38716995 XOR $24EC641; CASE 339515 XOR $52E2B ; qqppqq := 351838 XOR $55E5D; CASE 11342 XOR $2C6E ; qqppqq := 1309956624 XOR $4E145A1A; DEFAULT ; Throw("BUG", qqpqp ); ENDSELECT; ENDIF;ENDPROC qqppqq 
PROC qqppp();DEF qqpppq:PTR TO mp,qqppqp:PTR TO ahirequest,qqppqq,qqpqpp:ARRAY OF BYTE,qqpqpq:PTR TO ahirequest,qqpqqp,qqpqqq:ARRAY OF BYTE,qqqppp:PTR TO ahirequest,qqqppq:PTR TO ahirequest,qqqpqp:ARRAY OF BYTE,qqqpqq:PTR TO mp,qqqqpp:PTR TO mp,qqqqpq:PTR TO qq,qqqqqp:BYTE,qqqqqq:PTR TO qqp,qqppppp:PTR TO tc,qqppppq:PTR TO q,qqpppqp:PTR TO qq,qqpppqq:BOOL,qqppqpp,qqppqpq:BOOL,qqppqqp,qqppqqq:PTR TO qqq,qqpqppp:PTR TO ahirequest; qqppqq := -(97096056 XOR $5C99179); qqqqqq := infoParameterOfChildProcessFake() !!PTR TO qqp; qqppppp := qqqqqq.clientTask; qqqpqq := qqqqqq.clientPort; qqppppq := qqqqqq.musicAppClient; NEW qqpqpp [(351759 XOR $51AE7)], qqpqpq; NEW qqpqqq[(351759 XOR $51AE7)], qqqppp; qqpppq := CreateMsgPort(); IF (71161857 XOR $43DD801)= qqpppq THEN Raise("RES" ); qqppqp := CreateIORequest(qqpppq, SIZEOF ahirequest); IF (1811593732 XOR $6BFABA04)= qqppqp THEN Raise("MEM" ); qqppqp.version := 324009 XOR $4F1AD; qqppqq := OpenDevice(ahiname, 1978598760 XOR $75EF0568, qqppqp !!PTR!!PTR TO io, NIL); IF qqppqq; qqqqpp := CreateMsgPort(); IF (465050 XOR $7189A)= qqqqpp THEN Raise("RES" ); qqpq(qqqpqq, NIL, 1488305644 XOR $58B5BDEC, qqqqpp); RETURN; ENDIF; qqqqqq.noServer := 1913945904 XOR $72147F30; MemCopy(qqpqpq, qqppqp, SIZEOF ahirequest); MemCopy(qqqppp, qqppqp, SIZEOF ahirequest); qqqqpp := CreateMsgPort(); IF (4188934 XOR $3FEB06)= qqqqpp THEN Raise("RES" ); qqpq(qqqpqq, NIL, 3749485 XOR $39366D, qqqqpp); qqpppqp := NIL; qqqppq := NIL; qqpqqp := 114765723 XOR $6D72F9B; qqppqpq := 5338949 XOR $517745; REPEAT; IF qqpppqp <> (113536 XOR $1BB80)  AND (qqpqqp < (774552848 XOR $2E2ABD12)); qqppqqp := 1968118 XOR $1E07F6; ELSE; qqppqqp := Wait((802738660 XOR $2FD8C1E4) OR (384634 XOR $55E7A) OR ((117051119 XOR $6FA0EEE) SHL qqqqpp.sigbit) OR ((1891162216 XOR $70B8D869) SHL qqpppq.sigbit)); ENDIF; IF qqppqqp AND (802738660 XOR $2FD8C1E4); Signal(qqppppp, 802738660 XOR $2FD8C1E4); ENDIF; IF qqppqqp AND (384634 XOR $55E7A); qqppqpq := 117051119 XOR -$6FA0EF0; ENDIF; qqqqpq, qqqqqp := qqqp(qqqqpp); WHILE qqqqpq; SELECT qqqqqp; CASE 1891162216 XOR $70B8D869; IF qqpppqp; qqpppqp.qqqp := 1001627216 XOR $3BB39E50; qqppppq.qq:= qqppppq.qq+(1590609412 XOR $5ECEC605); qqpq(qqqpqq, qqpppqp, 136837 XOR $21687, qqqqpp); qqpppqp := NIL; ENDIF; PtSeek(qqqqpq.qqp, 60181827 XOR $3964D43); qqqqpq.qqqp := 348336 XOR -$550B1; qqpppqp := qqqqpq; CASE 88561538 XOR $5475781; IF qqqqpq.qqqp; IF qqpppqp <> qqqqpq THEN Throw("BUG", qqpqq ); qqpppqp.qqqp := 513458392 XOR $1E9AC0D8; qqppppq.qq:= qqppppq.qq+(1941913860 XOR $73BF4105); qqpq(qqqpqq, qqpppqp, 11727976 XOR $B2F46A, qqqqpp); qqpppqp := NIL; ENDIF; DEFAULT; Throw("BUG", qqqpp ); ENDSELECT; qqqqpq, qqqqqp := qqqp(qqqqpp); ENDWHILE; qqpppqq := qqpppqp <> (85356644 XOR $5167064)  AND (qqpqqp < (5664 XOR $1622)) ; IF qqpqppp := GetMsg(qqpppq) !!PTR!!PTR TO ahirequest; qqpqqp := qqpqqp -(663431964 XOR $278B2B1D); IF qqpqqp = (198922 XOR $3090A) THEN qqqppq := NIL; IF qqpppqp; IF qqpqppp.iostd.error = (1033165640 XOR $3D94DB48); qqpppqq := 4521776 XOR -$44FF31; ELSE; qqpppqq := 258593 XOR $3F221; qqpppqp.qqqp := 543080 XOR $84968; qqppppq.qq:= qqppppq.qq+(1861059892 XOR $6EED8535); qqpq(qqqpqq, qqpppqp, 142247 XOR $22BA5, qqqqpp); qqpppqp := NIL; ENDIF; ENDIF; SetSignal(-(27528 XOR $6B89), (503742 XOR $7AFBF) SHL qqpppq.sigbit); ENDIF; IF qqpppqq; IF qqpppqp = (375163568 XOR $165C8AB0) THEN Throw("BUG", qqqpq ); qqqqpq := qqpppqp; PtRender( qqqqpq.qqp, qqpqpp, qqpqpp + (2248697 XOR $224FFB), (5747699 XOR $57B3F1) * (245924 XOR $3C0A6), 132811 XOR $217F1,  57370455 XOR $36B6756, 339515 XOR $52E2B, 351838 XOR $55E5C); PtGetAttr(qqqqpq.qqp, 8008421 XOR -$7F85CD1C, ADDRESSOF  qqppqpp); IF qqppqpp AND (294111 XOR $47CD7); IF qqqqpq.qqpp <> (706070204 XOR $2A15C6BD); IF qqqqpq.qqpp >= (277327 XOR $43B4D) THEN qqqqpq.qqpp:= qqqqpq.qqpp-(68261010 XOR $4119493); PtSeek(qqqqpq.qqp, 120905126 XOR $734DDA6); PtGetAttr( qqqqpq.qqp, 8008421 XOR -$7F85CD1C, ADDRESSOF  qqppqpp); PtSetAttrs(qqqqpq.qqp, [8008421 XOR -$7F85CD1C, qqppqpp AND NOT (294111 XOR $47CD7), 706070204 XOR $2A15C6BC,277327 XOR $43B4F]:tagitem); ELSE; qqqqpq.qqqp := 68261010 XOR $4119492; qqppppq.qq:= qqppppq.qq+(120905126 XOR $734DDA7); qqpq(qqqpqq, qqqqpq, 1621302004 XOR $60A31AF6, qqqqpp); qqpppqp := NIL; ENDIF; ENDIF; qqpqpq.iostd.mn.ln.pri := 70804670 XOR $43864BE; qqpqpq.iostd.command := 55248500 XOR $34B0677; qqpqpq.iostd.data := qqpqpp; qqpqpq.iostd.length := 351759 XOR $51AE7; qqpqpq.iostd.offset := 71161857 XOR $43DD801; qqpqpq.frequency := 3207267 XOR $305C27; qqpqpq.type := qqqq(339515 XOR $52E2B, (351838 XOR $55E5C) = (6181091 XOR $5E50E1)); qqpqpq.volume := qqqqpq.qqpq; qqpqpq.position := 384634 XOR $55E7A ; qqpqpq.link := qqqppq; SendIO(qqpqpq !!PTR!!PTR TO io); qqpqqp:= qqpqqp+(117051119 XOR $6FA0EEE); qqqppq := qqpqpq; qqpqpq := qqqppp; qqqppp := qqqppq; qqqpqp := qqpqpp; qqpqpp := qqpqqq; qqpqqq := qqqpqp; ENDIF; UNTIL qqppqpq; Signal(qqppppp, 324011 XOR $4B1AB); Wait(384634 XOR $55E7A);FINALLY; PrintException(); IF qqppqq = (117051119 XOR $6FA0EEF); IF qqpqqp >= (1891162216 XOR $70B8D869); AbortIO(qqqppp !!PTR!!PTR TO io); WaitIO( qqqppp !!PTR!!PTR TO io); ENDIF; IF qqpqqp = (1001627216 XOR $3BB39E52); AbortIO(qqpqpq !!PTR!!PTR TO io); WaitIO( qqpqpq !!PTR!!PTR TO io); ENDIF; ENDIF; IF qqqqpp; Forbid(); WHILE qqppqqq := GetMsg(qqqqpp)::qqq; SELECT qqppqqq.ln.type; CASE 1590609412 XOR $5ECEC601 ; ReplyMsg(qqppqqq); CASE 136837 XOR $21682 ; END qqppqqq; ENDSELECT; ENDWHILE; DeleteMsgPort(qqqqpp); Permit(); ENDIF; END qqpqpp, qqpqpq; END qqpqqq, qqqppp; IF qqppqq = (60181827 XOR $3964D43); CloseDevice(qqppqp !!PTR!!PTR TO io); ENDIF; IF qqppqp THEN DeleteIORequest(qqppqp !!PTR!!PTR TO io); IF qqpppq THEN DeleteMsgPort(qqpppq); exception:=348336 XOR $550B0;ENDPROC
PUBLIC
PROC new() NEW OF q;; self.q := 88561538 XOR $5475782; self.qqq := NIL; self.qqpq := 513458392 XOR -$1E9AC0D9;ENDPROC
PROC end() OF q;DEF qqpppq:PTR TO qqq; SUPER self.end() ; IF self.qqq; qqpp(self.qqpp); Forbid(); WHILE qqpppq := GetMsg(self.qqp)::qqq; SELECT qqpppq.ln.type; CASE 1941913860 XOR $73BF4101 ; ReplyMsg(qqpppq); CASE 11727976 XOR $B2F46F ; END qqpppq; ENDSELECT; ENDWHILE; DeleteMsgPort(self.qqp); Permit(); ENDIF;ENDPROC
PROC reset() OF q;; self.q := 85356644 XOR $5167064;ENDPROC
PROC appIsBuilt(qqpppq:PTR TO cApp) OF q;DEF qqppqp:PTR TO cAppHost; qqppqp := qqpppq::cAppHost; IF self.qqq = (5664 XOR $1620); self.qq := 663431964 XOR $278B2B1C; self.qqp := CreateMsgPort(); IF (198922 XOR $3090A)= self.qqp THEN Raise("RES" ); self.qqp := self.qqp ; self.qqq, self.qqpp, self.qqpq := qqq(self.qqp); ENDIF; self.q := 1033165640 XOR -$3D94DB49;ENDPROC
PROC infoFirstResource() OF q IS SUPER self.infoFirstResource()::qq
PRIVATE
PROC q() NEW OF qq;; self.q := NILA; self.qqp := NILA; self.qqpq := 5270768 XOR $516CF0; self.qqqp := 3559588 XOR $3650A4;ENDPROC
PROC qq() OF qq RETURNS qqpppq:PTR TO qq  IS self.next::qq
PROC qqp(qqpppq:ARRAY OF CHAR) OF qq;DEF qqppqp:BOOL,qqppqq,qqpqpp:BPTR,qqpqpq; qqppqp := 1935184144 XOR $73589110; IF q.qqpq THEN RETURN ; IF exists(qqpppq,  432876 XOR $69AED) = (14570047 XOR $DE523F) THEN RETURN; qqppqq := fileSize(qqpppq) !!VALUE; NEW self.q[qqppqq]; qqpqpp := Open(qqpppq, 178382080 XOR $AA1E6ED); qqppqq := Read(qqpqpp, self.q, qqppqq); Close(qqpqpp); self.qq := PtTest(qqpppq, self.q, qqppqq); self.qqp := PtInit(self.q, qqppqq, 3207267 XOR $305C27, self.qq); IF self.qqp = (1343102 XOR $147E7E) THEN RETURN; PtSetAttrs(self.qqp, [8008421 XOR -$7F85CD1C,(294111 XOR $47CDE) OR (706070204 XOR $2A15C6BE) OR (277327 XOR $43B4B), 68261010 XOR $4119492,120905126 XOR $734DDA6]:tagitem) ; PtGetAttr(self.qqp, 265209328 XOR -$70313A05, ADDRESSOF  qqpqpq); self.qqq := qqpqpq * (1902881948 XOR $716BAF74); qqppqp := 5370818 XOR -$51F3C3;ENDPROC qqppqp 
PUBLIC
PROC end() OF qq;; IF self.qqqp; self.stop(); self.waitForPlayToFinish() ; ENDIF; IF self.qqp; PtCleanup(self.qqp); self.qqp := NILA; ENDIF; END self.q; SUPER self.end();ENDPROC
PROC play(qqpppq=641346752 XOR $263A2CC1) OF qq;; IF qqpppq < (130216986 XOR $7C2F41A) THEN Throw("EMU", qqqqp ); WHILE q.qq > (5314914 XOR $511906) DO qqp(); self.qqpp := qqpppq; qqpq(q.qqq, self, 675224760 XOR $283F1CB9, q.qqp); IF StrCmp(pe_TargetOS, qqqqq ); Delay(1522413592 XOR $5ABE3019); ENDIF;ENDPROC
PROC stop() OF qq;; qqpq(q.qqq, self, 128690698 XOR $7ABAA09, q.qqp);ENDPROC
PROC infoLength() OF qq RETURNS qqpppq IS self.qqq
PROC infoIsPlaying() OF qq;DEF qqpppq:BOOL; IF self.qqqp; qqp() ; ENDIF; qqpppq := self.qqqp;ENDPROC qqpppq 
PROC waitForPlayToFinish() OF qq;; WHILE self.qqqp DO WaitForMusicEvent();ENDPROC
PROC setVolume(qqpppq) OF qq;DEF qqppqp:PTR TO cMusic; IF qqpppq < (6882208 XOR $6903A0)  OR (qqpppq > (5314914 XOR $511906)) THEN Throw("EMU", qqpppp ); self.qqpq := qqpppq*(5270768 XOR $516CF0)/(5314914 XOR $511906); qqppqp := self;ENDPROC qqppqp 
PROC getVolume() OF qq RETURNS qqpppq IS self.qqpq
