<html>
<head>
  <title>PowerD.html - definice OBJECT</title>
  <meta http-equiv="Content-Type" content="text/html">
</head>
<body bgcolor=#ffffff>
<ul type=square>
<li><big>Popis:</big><br>
  Objekt je neco, jako pole typu, nebo otypovana pamet... blbe se to vysvetluje ;)<br>
<br><br>

<li><big>Novinky:</big><br>
  <ul type=disc>
  <li>Od verze 0.02<br>
    <ul type=circle>
    <li>Pridana podpora spojeni <a href="#union">UNION</a>.
    </ul>
  <li>Od verze 0.05b<br>
    <ul type=circle>
    <li>Pridana podpora <a href="#pad">vyrovnavajicich</a> bajtu.
    </ul>
  <li>Od verze 0.15<br>
    <ul type=circle>
    <li>Lze pouzit zkracene <a href="#short">&lt;/&gt;</a> pro vice polozek o stejnem typu.
    </ul>
  <li>Od verze 0.16
    <ul type=circle>
    <li>Lze pouzi<a href="#multio"> vice nazvu pro jeden objekt</a>.
    <li>Polozky mohou zacinat s <a href="#number">cislem</a>.
    </ul>
  <li>Od verze 0.17
    <ul type=circle>
    <li>Pridana klicova slova <a href="#offset">OFFSET</a> a <a href="#relofs">RELOFS</a> pro vlastni pozicovani polozek v objektu.
      <ul type=circle>
      <li>Kazda polozka muze mit svou <a href="#dirofs">pozici</a> danou primo.
      </ul>
    <li>Opet pridana podpora <a href="oop.html">OOP</a>, ktera byla ponekud meni <a href="#oop">strukturu</a> objektu.
    <li>Pridana podpora <a href="#cunion">sjednoceni</a> jako v C.
    </ul>
  <li>Od verze 0.19
    <ul type=circle>
    <li>Objekty mohou byt definovany i uvnitr procedur, a jsou pouze lokalni
    <li>Pridana podpora pro <a href="#multi"> vice rozmerne</a> polozny (az tri rozmerne)
    <li>kazde 'PTR TO ' za znakem ':' muze byt nahrazeno jednim '[]' pred znakem ':'
    </ul>
  </ul>
<br><br>

<li><big>Syntaxe:</big>
<font color=#ff0000><pre>
  OBJECT &lt;nazev&gt; [ OF &lt;pripojeny-nazev&gt; ]
    &lt;polozka&gt; [ &lt;[velikost]&gt; ] [ &lt;:typ&gt; ] [ ,
    &lt;polozka&gt; ]
</pre></font><br>
  Kde <font color=#ff0000>&lt;nazev&gt;</font> je nazev noveho objektu.
  <font color=#ff0000>&lt;pripojeny-nazev&gt;</font> je nazev objektu, jehoz polozky budou
  pripojeny na zacatek noveho objektu pred vlastni polozky.
  <font color=#ff0000>&lt;polozka&gt;</font> je jmeno nove polozky.
  <font color=#ff0000>&lt;[velikost]&gt;</font> znamena pocet elementu (typu) teto polozky,
  pozor na to, ze maximalni velikost celeho objektu nesmi presahnout 32 kB.
  <font color=#ff0000>&lt;:typ&gt;<font color=#000000> je jeden z <a href="types.html">typu</a>.<br><br>

<a name="multii"></a>
<li><big>Synonyma polozek:</big><br>
  Kazda polozka muze mit az 31 synonym, vsechny musi byt oddeleny operatorem '|'.
<font color=#ff0000><pre>
  OBJECT Point
    X|x|R|r:FLOAT,
    Y|y|G|g:FLOAT,
    Z|z|B|b:FLOAT
</pre></font><br><br>

<a name="short"></a>
<li><big>Zkraceny zapis polozek:</big><br>
  Toto umoznuje zkratit vypis polozek, jenz po sobe nasleduji a maji totozny typ.
<font color=#ff0000><pre>
  OBJECT vertex
    X|x:FLOAT,
    Y|y:FLOAT,
    Z|z:FLOAT
</pre></font><br>
  Tento dlouhy zapis muze byt nahrazen pomoci operatoru '/' timto:
<font color=#ff0000><pre>
  OBJECT vertex
    X|x/Y|y/Z|z:FLOAT
</pre></font><br>
  Toto vytvare uplne to same jako je vise, ale pocet takto definovanych
  nazvu polozek vcetne synonym nesmi presahnout 32 nazvu!
<br><br>

<a name="multio"></a>
<li><big>Synonyma nazvu objektu:</big><br>
  Kazdy nazev objektu muze mit az 7 synonym, vsechny museji byt
  oddeleny operatorem '|'.
<font color=#ff0000><pre>
  OBJECT point|vector|vertex|d3d
    x/y/z:FLOAT
</pre></font><br>
  Poznamka: Pokud kompilujete modul, ktery obsahuje takovyto objekt, bude
  binarni modul obsahovat ctyri objektu, nikoliv jeden se ctyrmi jmeny!
<br><br>

<a name="union"></a>
<li><big>Sjednoceni:</big><br>
  Toto je velmi uzitecne, pokud potrebujete pouzit jeden objekt, a ten muze obsahovat
  vice typu dat na stejnem miste.

<font color=#ff0000><pre>
  OBJECT Help
    Type:UWORD,             // druh napovedy
    NEWUNION AmigaGuide     // amigaguide napoveda
      File:PTR TO UBYTE,    // jmeno amigaguide souboru
      Node:PTR TO UBYTE     // jmeno uzlu v amigaguide souboru
    UNION LocalHelp         // vnitrni napoveda
      Text:PTR TO UBYTE,    // ukazatel na text napovedy
      Length:UWORD          // delka textu napovedy
    ENDUNION,               // konec sjednoceni
    HelpTitle:PTR TO UBYTE  // titul napovedy
</pre></font><br>
  Tento objekt je dlouhy 14 bajtu. Type ma 2 bajty. Kazda polozka, ktera nasleduje
  za klicovym slovem NEWUNION nebo UNION zacina na stejne pozici. V nasem pripade na
  pozici 2 bajty od zacatku objektu. Potom se vyhleda nejdelsi sjednoceni, v nasem
  prikladu mame dve sjednoceni, prvni ma 8 bajtu, druhe ma 6 bajtu, takze bereme v
  uvahu to 8mi bajtove. K pozici sjednoceni (2 bajty) tedy pripocteme 8 bajtu. Tim
  ziskame pozici polozky HelpTitle, coz je 10 bajtu od zacatku objektu.
  <br><br>

  <font size=+1>UPOZORNENI:</font> sledujte v predchozi ukazce umisteni carek, ty museji byt
  umisteny presne<br><br>

<a name="cunion"></a>
<li><big>Sjednoceni jako v Cecku:</big><br>
  Tento rys je pridan hlavne kvuli zjednoduseni prekladani Ceckovskych include souboru.
<font color=#ff0000><pre>
  OBJECT xxx
    x:W,
    CUNION
      a:L,
      b:D,
      [i,j,k]:c
    ENDUNION,
    y:L
</pre></font><br>
  Toto nastavi pro polozky a, b, c pozici 2 bajty od zacatku objektu. A protoze
  c je dlouhe 12 bajtu (3x long) a x je dlouhe 2 bajty, bude mit y pozici 14 bajtu
  od zacatku objektu.
<br><br>

<a name="pad"></a>
<li><big>Vyrovnavajici bajty:</big><br>
  Kazda polozka, ktera neni typu BYTE nebo UBYTE musi zacinat na sude pozici:
<font color=#ff0000><pre>
  OBJECT xxx               // SIZEOF_xxx = 6 bajtu
    a:BYTE,                // pozice=0
    b:BYTE,                // pozice=1
    c:BYTE,                // pozice=2
    d:WORD                 // pozice=4
</pre></font><br><br>

<li><big>Pripojene objekty:</big>
<font color=#ff0000><pre>
  OBJECT PointList OF Point  // kuk na definici objektu Point nahore
    Next:PTR TO Point,
    Prev:PTR TO Point
</pre></font><br>
  je to same jako:
<font color=#ff0000><pre>
  OBJECT PointList
    X|x|R|r:FLOAT,
    Y|y|G|g:FLOAT,
    Z|z|B|b:FLOAT,
    Next:PTR TO Point,
    Prev:PTR TO Point
</pre></font><br><br>

<a name="offset"></a>
<a name="relofs"></a>
<li><big>Vlastni pozice polozek:</big><br>
  <font color=#ff0000>OFFSET &lt;x&gt;</font> nastavi aktualni pozici ma hodnotu &lt;x&gt;.<br>
  <font color=#ff0000>RELOFS &lt;x&gt;</font> pride &lt;x&gt; k aktualni pozici.<br><br>

  Toto umoznuje napriklad zaporne pozice pro polozky v objektu.<br><br>

  Dulezita poznamka: Objekty, ktere obsahuji tato klicova slova NESMEJI byt pouzita
  jako staticke objekty ([a,b,1,2]:obj), protoze mohou obsahovat pozice, ktere se takto
  nedaji definovat, podivejte se treba na toto:
<font color=#ff0000><pre>
  OBJECT test
    a:W,
    OFFSET 4,
    b:W,
    RELOFS -4,
    c:W
</pre></font><br>
  Toto vytvori slozky o pozicich: a=0, b=4 a c=2, to by se staticky definovalo dost tezko ;)<br>

<font color=#ff0000><pre>
  OBJECT mem
    long:L,
    OFFSET 2,
    word:W,
    OFFSET 3,
    byte:B
</pre></font><br>
  Davejte pozor, kdyz tato klicova slova pouzivate s OOP!
<br><br>

<a name="dirofs"></a>
<li><big>Zjednodusene prime nastavovani pozice polozek:</big><br>
  Tento rys pracuje stejne jako klicove slovo OFFSET, jeho zapis je ale
  kratsi a jednodussi k pouziti:
<font color=#ff0000><pre>
  OBJECT mem
    long:L,
    word=2:W,
    byte=3:B
</pre></font><br>
  Toto vytvori to same jako v predchozi ukazce, myslim, ze neni co vysvetlovat ;)
<br><br>

<li><big>Velikosti objektu:</big><br>
  Kazdy objekt vytvari jednu konstantu nazvanou SIZEOF_xxx, kde xxx je nazev daneho
  objektu. Tato konstanta obsahuje delku objektu v bajtech.
<br><br>

<a name="numbers"></a>
<li><big>Polozke zacinajici cislici:</big><br>
  Od verze 0.16 je mozne pouzit nazvy polozek jako:
<font color=#ff0000><pre>
  OBJECT xxx
    0:WORD,
    1:LONG,
    3:DOUBLE,
    0name:PTR TO CHAR,
    1name:PTR TO CHAR
</pre></font><br>
  atd. Davejte pozor na pouziti <a href="prepro.html">rysu preprocessoru
  a:=.b</a>, jenz je normalne prevedeno na a:=a.b, toto nepracuje s polozkamy,
  ktere zacinaji cislici!!!
<br><br>

<a name="multi"></a>
<li><big>Vice rozmerne polozky:</big><br>
  Od verze 0.19 alpha 5 je mozne definovat a pouzivat pole o vice rozmerech.
  Lze pouzit az tri-rozmerne pole:
<font color=#ff0000><pre>
  OBJECT test
    array[10,5,2]:UB
</pre></font><br>
  Pro pristup k temto polozkam, napiste:
<font color=#ff0000><pre>
  x:=test.array[5,3,1]
</pre></font><br>
  to je to same jako:
<font color=#ff0000><pre>
  x:=test.array[5*10+3*5+1]
</pre></font><br>
<br><br>

<a name="oop"></a>
<li><big>OOP a objekty:</big><br>
  Jak muzete videt (v assemblerovem vystupu), prvni polozka u kazdeho
  objektu, jenz funguje jako trida (class), je ukazatel na seznam OOP metod.
  Tim se tedy vsechny ostatni polozky posouvaji o 4 bajty dale, protoze na
  pozici 0 je tento ukazatel.<br>
  Davejte pozor na pouziti OFFSET/RELOFS, pokud nejaka polozka bude zacinat
  na adrese, kde je ukazatel seznamu metod, pravdepodobne to povede ke zhrouceni
  systemu. Nejlepe se tomu vyhnete tim, ze tato klicova slova nebudete vubec pouzivat.
</ul><br><br>
</body>
</html>
