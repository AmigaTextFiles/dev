<html>
<head>
  <title>PowerD.html - projekt o vice zdrojovych kodech</title>
  <meta http-equiv="Content-Type" content="text/html">
</head>
<body bgcolor=#ffffff>
<ul type=square>
<li><big>uvod:</big><br>
  kazdy programator, ktery nekdy pracoval na vetsim projektu velice brzy pocitil pomalost
  kompilace. to same (bohuzel) plati i u PowerD. pak se rozhodnout nejak urychlit kompilaci.
  jednoduchym resenim (obvykle na jine platforme) je upgradovat hw pocitace... ale jsou i
  jine cesty... napriklad rozdelit zdrojovy kod do mensich casti, kde kazda jednotliva cast
  bude zkompilovana podstatne rychleji. nicmene neni to tak snadne.
<br><br>

<li><big>sdileni promennych:</big><br>
  jedna z nejdulezitejsich veci pri pouziti vicero zdrojovych kodu je sdileni globalnich promennych
  mezi zdrojovymi kody. musite definovat (<a href="def.html">DEF</a>) tyto promenne pouze v jednom
  zdrojovem kodu. ve vsech ostatnich, kde se pouzivaji je lze definovat pouze jako referenci (<a href="def.html">EDEF</a>).
  oboji by melo byt definovano stejnym typem, aby nedochazelo k nepredvidatelnym chybam, ktere si
  kompilator nedokaze ohlidat.
<br><br>

<li><big>sdileni funkci:</big><br>
  stejne jako promenne, je treba definovat i reference funkci, ktere jsou v jinych zdrojovych kodech
  pomoci <a href="proc.html">EPROC</a>.
<br><br>

<li><big>sdileni modulu:</big><br>
  pri pouziti vice zdrojovych kodu je lepsi vytvorit pro kazdy zdrojovy kod modul s referencemi z
  daneho zdrojoveho kodu. takovy module lze snadno vygenerovat pomoci:
<font colour=#0000ff><pre>
  1.> dc program1.d gm
</pre></font><br>
  tento GM=GENMODULE/S argument zajisti vytvoreni modulu s nazvem 'source1.m', ktery bude obsahovat vsechny
  reference proedur a promennych. tento <a href="module.html">modul</a> by pak mel byt pouzit ve vsech zdrojovych kodech, jenz tyto
  procedury a promenne pouziva. vygenerovany modul obsahuje take reference na linkovaci objekt puvodniho zdrojoveho kodu: program1.o.
  of the source1.d called usualy source1.o.
<br><br>

<li><big>kompilace maleho projektu o vice zdrojovych kodech:</big><br>
  pro maly projekt, ktery ma jen par zdrojovych kodu staci obvykle kazdy zdrojovy kod kompilovat
  samostatne pomoci 'dc program'. kazdy zdrojovy kod, ktery neobsahuje proceduru main() by mel
  obsahovat volbu 'OPT NOEXE', aby se vytvoril pouze linkovaci objekt, nikoliv spustitelny soubor
  (ktery by stejne nesel zkompilovat kvuli chybejici procedure main() ). v nasem pripade staci
  pridat pouze dane moduly:<br><br>

  hlavni zdrojovy kod nazveme main.d:
<font colour=#ff0000><pre>
  MODULE  '*read','*save'

  PROC main()
    read()
    save('ram:file.txt')
  ENDPROC
</pre></font>
<br><br>
  dalsi zdrojovy kod nazveme read.d:
<font colour=#ff0000><pre>
  OPT NOEXE

  DEF str[32]:STRING

  PROC read()
    WriteF('Enter a string: ')
    ReadEStr(stdout,str)
  ENDPROC
</pre></font><br>
<br><br>
  a posledni zdrojovy kod nazveme save.d:
<font colour=#ff0000><pre>
  OPT NOEXE

  MODULE  '*read'

  PROC save(name)
    DEF f
    IF f:=Open(name,NEWFILE)
      Write(f,str,StrLen(str))
      Close(f)
    ENDIF
  ENDPROC
</pre></font><br>
  tomto jsou nase zdrojove kody hotove. hlavni zdrojovy kod, respektive procedura main() pouziva
  obe procedury z ostatnich zdrojovych kodu jak read.d tak save.d. nyni tedy musime vytvorit
  moduly s referencemi, aby bylo mozne moduly save.d a read.d pouzit i mimo je samotne. prvni
  zdrojak read.d obsahuje promennou str. funkce read() vypise text, a ceka na zadani retezce pro
  ulozeni do promenne str. druhy zdrojak save.d otevre soubor 'ram:file.txt' pro zapis, a zapise
  to nej obsah promenne str, ktera v tomto zdrojovem kodu neni definovana, a proto je potreba
  i zde pouzit referencni modul (MODULE '*read') aby promenna existovala.<br>

  nyni musim zkompilovat zdrojoe kody, nejdrive musime zkompilovat read.d, protoze jeho reference
  je pouzita v obouch zbylich zdrojovych kodech. v cli napiste:
<font colour=#0000ff><pre>
  1.> dc read gm
</pre></font><br>
  ted, pokud je vsechno v poradku se muzete podivat, ze je vytvoren novy soubor read.m, ktery obsahuje:
<font colour=#ff0000><pre>
  OPT	LINK='*read.o'

  EPROC read()


  EDEF	str:PTR TO CHAR
</pre></font><br>
  pak napiste:
<font colour=#0000ff><pre>
  1.> dc save gm
</pre></font><br>
  ted, pokud je vsechno v poradku se muzete podivat, ze je vytvoren novy soubor save.m, ktery obsahuje:
<font colour=#ff0000><pre>
  OPT	LINK='*save.o'

  EPROC save(name)
</pre></font><br>
  a nyni:
<font colour=#0000ff><pre>
  1.> dc main
</pre></font><br>
  ted, pokud je vsechno v poradku napiste nasledujici, a pak nejaky text:
<font colour=#0000ff><pre>
  1.> main
  Enter a string: hello world
</pre></font><br>
  a nyni je v ram disku nazvane file.txt, ktere obsahuje Vami napsany retezec.
<br><br>

<li><big>kompilace projektu o vice zdrojovych kodech:</big><br>
  pro vetsi projekty je ten zpusob uvedeny vice prakticky nepouzitelny, protoze kdyz cokoliv
  zmenite, musite prekompilovat zmeneny zdrojovy kod, a samozrejme hlavni zdrojovy kod (obsahujici
  proceduru main() ). vsechno je stejne jako vylo uvedeno vyse krome toho, ze nemusite nic kompilovat
  primo s DC, ale pomoci inteligentnejsiho <a href="project.html">pc</a> (project compiler) a musite
  si napsat vlastni projekt jak je popsano <a href="project.html">zde</a>.<br><br>

  projektovy soubor pro nas maly projekt (nazvemeho test.dpr) by vypadal takto:
<font colour=#0000ff><pre>
  PowerD Project v1

  // main source file:
  obj='main.o'

  // rest objects:
  obj='read.o'
  obj='save.o'

  // executeble file:
  exe='main'
</pre></font><br>
  a kdyz napisete:
<font colour=#0000ff><pre>
  1.> pc test
</pre></font><br>
  tak pc zkompiluje vsechny zmenene zdrojove kody, a spoji je do jednoho spustitelneho souboru s nazvem 'main'.
</ul>
</body>
</html>
