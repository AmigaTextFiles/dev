<html>
<head>
  <title>PowerD.html - popis binarniho formatu modulu</title>
  <meta http-equiv="Content-Type" content="text/html">
</head>
<body bgcolor=#ffffff>
<ul type=square>
<li><big>Popis:</big><br>
  Poradi musi byt nasledujici: "DMOD", "MODS", "CNST", "OBJC", "#def", "LIBR",
  "EXPR", "EDEF", "LINK", "HEAD", "TDEF". Zatim co kazdy z vyse uvedenych smi
  byt vynechan.<br>
  V casti <a href="#fmt">Format</a> jsou pouzity nasledujici klicova slova:<br><br>
  LONG znaci 4 bajtovou hodnotu v modulu<br>
  WORD znaci 2 bajtovou hodnotu v modulu<br>
  BYTE/UBYTE znaci 1 bajtovou hodnotu v modulu<br>
  CHAR znamena, ze v modulu je ulozen text ukonceny nulovym znakem<br>
  EVEN zajisti, ze adresa v souboru nebude licha, ale suda (pridanim nuloveho bajtu)<br><br>
  WHILE/ENDWHILE podminena smycka<br>
  IF/ELSEIF/ELSE/ENDIF podminka<br><br>
  Pro jakekoliv dotazy mi <a href="author.html">napiste</a>.
<br><br>
<a name="fmt"></a>
<li><big>Format:</big>
<pre>
    // hlavicka binarniho modulu:
  LONG  "DMOD"
  WORD  verze, revize
<hr>
    // nacitane moduly:
  LONG  "MODS"
  WORD  pocet modulu
  WHILE modul
      // kazdy vlozeny modul:
    WORD  StrLen(modul.jmeno)
    CHAR  modul.jmeno,0
    EVEN
    modul:=modul.dalsi      // dalsi modul
  ENDWHILE
<hr>
    // Konstanty:
  LONG  "CNST"
  WORD  pocet konstant
  LONG  delka dat
    // toto je delka v bajtech cele databaze konstant
  LONG  delka jmen
    // toto je delka v bajtech nazvu vsech konstant vcetne nuloveho znaku na konci

  prvni:=konstanta          // ulozit prvni konstantu
  WHILE konstanta
    // zname flagy:
    // %001 - S_PRIVATE    // pro privatni konstanty
    // %010 - S_INTERNAL   // pro interni konstanty, nikdy nepouzivat, pouze pro vlastni pouziti PowerD
    // %100 - S_TAG        // potreba pouze pro tagy

    IF typ=DOUBLE nebo FLOAT konstanta:
      // DOUBLE/FLOAT konstanta:
      UBYTE  8, flags
      DOUBLE hodnota

    ELSEIF highword=$8000
      // tag konstanta:
      UBYTE  1, flags|%100
      WORD   spodnich 16 bitu hodnoty

    ELSEIF highword=$0000 or $ffff
      // 16 bitova konstanta (hornich 16 bitu=$0000 nebo $ffff):
      UBYTE  3, flags
      WORD   spodnich 16 bitu hodnoty

    ELSEIF konstanta=0
      // nula (konstanta=0):
      UBYTE  $ff,flags

    ELSE
      // konstanta (i vsechny predchozi krome DOUBLE zde smi byt pouzito):
      UBYTE  1, flags
      LONG   hodnota

    ENDIF

    konstanta:=konstanta.dalse     // dalsi konstanta
  ENDWHILE

  konstanta:=prvni               // obnovit prvni konstantu
  WHILE konstanta
    CHAR  konstanta.jmeno,0
    konstanta:=konstanta.dalse     // dalsi konstanta
  ENDWHILE

  EVEN
<hr>
  LONG "OBJC"
  LONG delka dat, delka jmen
  WORD pocet objektu, pocet polozek

<hr>
    // LINK OPTions
  LONG  "LINK"
  WORD  pocet linku
  WHILE link
    WORD  StrLen(link.jmeno)
    CHAR  link.jmeno,0
    EVEN
    link:=link.dalsi      // dalsi link
  ENDWHILE
<hr>
    // HEAD OPTion
  LONG  "HEAD"
  WORD  StrLen(head.jmeno)
  CHAR  head.jmeno,0
  EVEN
</pre>
</ul>
</body>
</html>
