<html>
<head>
  <title>PowerD.html - Binary module format description</title>
  <meta http-equiv="Content-Type" content="text/html">
</head>
<body bgcolor=#ffffff>
<ul type=square>
<li><big>Description:</big><br>
  Order must be following: "DMOD", "MODS", "CNST", "OBJC", "#def", "LIBR",
  "EXPR", "EDEF", "LINK", "HEAD", "TDEF". While each of the above can be skipped.<br>
  In the <a href="#fmt">Format</a> part are used following keywords:<br><br>
  LONG store a long with given data(s)<br>
  WORD store a word with given data(s)<br>
  BYTE/UBYTE store a byte with given data(s)<br>
  CHAR store a name including termination zero<br>
  EVEN make the address in file even (by adding a zero byte)<br><br>
  WHILE/ENDWHILE conditional loop<br>
  IF/ELSEIF/ELSE/ENDIF conditional statemens<br><br>
  For any questions <a href="author.html">e-mail</a> me.
<br><br>
<a name="fmt"></a>
<li><big>Format:</big>
<pre>
    // binary module head:
  LONG  "DMOD"
  WORD  version, revision
<hr>
    // included modules:
  LONG  "MODS"
  WORD  count of modules
  WHILE module
      // each included module:
    WORD  StrLen(module.name)
    CHAR  module.name,0
    EVEN
    module:=module.next      // get next module
  ENDWHILE
<hr>
    // Constants:
  LONG  "CNST"
  WORD  count of constants
  LONG  data part length
    // this is length in bytes of whole datatable of constants
  LONG  name list length
    // this is length in bytes of all constant names including string terminating zeros

  first:=constant          // store first constant
  WHILE constant
    // known flags are currently:
    // %001 - S_PRIVATE    // for private constants
    // %010 - S_INTERNAL   // for internal constants, never use, only for internal powerd module writer
    // %100 - S_TAG        // needed only for tags

    IF type=DOUBLE or FLOAT constant:
      // DOUBLE/FLOAT constant:
      UBYTE  8, flags
      DOUBLE value

    ELSEIF highword=$8000
      // tag constant:
      UBYTE  1, flags|%100
      WORD   lowword value

    ELSEIF highword=$0000 or $ffff
      // word constant (high-word=$0000 or $ffff):
      UBYTE  3, flags
      WORD   low-word value

    ELSEIF constant=0
      // zero constant (constant=0):
      UBYTE  $ff,flags

    ELSE
      // constant (tag, word and zero constants can be used also here):
      UBYTE  1, flags
      LONG   value    

    ENDIF

    constant:=constant.next     // get next constant
  ENDWHILE

  constant:=first               // restore first constant
  WHILE constant
    CHAR  constant.name,0
    constant:=constant.next     // get next constant
  ENDWHILE

  EVEN
<hr>
  LONG "OBJC"
  LONG data length, name list length
  WORD object count, item count

<hr>
    // LINK OPTions
  LONG  "LINK"
  WORD  count of links
  WHILE link
    WORD  StrLen(link.name)
    CHAR  link.name,0
    EVEN
    link:=link.next      // get next module
  ENDWHILE
<hr>
    // HEAD OPTion
  LONG  "HEAD"
  WORD  StrLen(head.name)
  CHAR  head.name,0
  EVEN
</pre>
</ul>
</body>
</html>
