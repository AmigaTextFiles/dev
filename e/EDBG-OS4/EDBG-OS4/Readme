INTRODUCTION

EDBG-OS4 is a specially modified OS4 compatible version of the AmigaE EC compiler and EDBG debugger so that EDBG can be used to source level debug an E program running directly on OS4.

It is by no means exclusive to OS4 as the modifications are to 68K code only and so it should also be fine on a real Amiga as well as systems like OS4 and MorphOS. And possibly the AROS 68K emulator.

The dates if you look go back from years ago as well as to today. Over ten. Shockingly, that is as far back as I had a working version, but I never released it. Until now. I always intended too. I did mention it briefly on Amiga forums but never recall being asked for a copy. So it got left on that dusty todo list.

I've included the sources so you can see what I have modified. There are clues in the source and comments there as well. Essentially it is fairly simple what I did to get it working. OS4 has broken support for trap code exceptions and these are used by every 68K debugger I know of. (Except this one. ;-) Usually an ILLEGAL instruction is inserted into the code to breakpoint it. A TRAP instruction is also another one used. What I did was substitute a JSR in place of a TRAP. JSR worked well because it stores the next instruction PC on the stack which is needed. So I simply JSR to my own user mode trap code routine, store the CCR in place of the SR and pull the PC off the stack for returning to it later. A customised compiler inserts the JSR instruction in the code where one NOP would have taken place. As it stands, this method and the code in place, can be used as the basis for an OS4 compatible debugger that is also backwards compatible. I hope it can help in this regard. A fix for the OS4 trap code handlers is unlikely by now.

For whatever reason the ASM source of the E compiler Wouter released was broken and would not assemble. I recall I had to hack it a bit to fix some errors. I don't recall all the details but just tried again to compile EC with ASM-One 1.48 and the EC prefs file included and it still broke . I did actually modify it again recently because whatever happened to it the inbuilt Val() function was broken and anything using it just threw back an error from EC about an unknown function.  I wrote a substitute for when I needed it so left that for the time being. But a few days ago I examined the source again and found the bug! The original source used a "VAL" label that ASM-One rejected as a reserved keyword which had to be changed. This resulted in a typo where Val() was broken. Well, all fixed now! :-D


USAGE

To use it you will need to compile your E source with the ec.os4 compiler included with the DEBUG switch on as usual. Then run edbg.os4 with the generated binary. You should then be able to source debug your E program live on OS4 just like you did on a real 68K Amiga! :-)

I've included a small script I use myself for when I am debugging a program called ECD. Meaning E Compiler Debugger.  Or something like that.  This is a useful little script that will take a source file, compile it with debug info and then run EDBG for you. I use it a bit. 

Also I modified the behaviour of the about window so can get rid of it with just a click.

INSTALLING

To install it just copy all the binaries included and the script to where your EC binaries are. I didn't provide an installer but did put it in a bin dir for you. If it helps. :-)


CONTACT

You can contact me on the following email and I'm also on the E emailing list. Thanks for reading.


Damien Stewart.

hypexed@yahoo.com.au
