
OPT MODULE


MODULE 'intuition/intuition','exec/memory'


MODULE 'grio/copydata','grio/newm'


OBJECT lockwindow
 pointer:LONG
 sizey:LONG
 request:requester
ENDOBJECT




EXPORT CONST STOP_POINTER=0,ZZ_POINTER=1


EXPORT PROC initLockWin(pointer_type=0)
DEF point,lw:PTR TO lockwindow,sizey
IF lw:=newM(SIZEOF lockwindow,MEMF_ANY)
   SELECT pointer_type
      CASE STOP_POINTER
	  point:={data1}
	  sizey:=16
      CASE ZZ_POINTER
	  point:={data2}
	  sizey:=22
      DEFAULT
	  RETURN NIL
   ENDSELECT
   IF point:=copyData(point,sizey*4+8,MEMF_CHIP)
      lw.pointer:=point
      lw.sizey:=sizey
      InitRequester(lw.request)
      RETURN lw
   ENDIF
   Dispose(lw)
ENDIF
ENDPROC NIL


data1:
   LONG 0
   INT  %0000010000000000,%0000011111000000
   INT  %0000000000000000,%0000011111000000
   INT  %0000000100000000,%0000001110000000
   INT  %0000000000000000,%0000011111100000
   INT  %0000011111000000,%0001111111111000
   INT  %0001111111110000,%0011111111101100
   INT  %0011111111111000,%0111111111011110
   INT  %0011111111111000,%0111111110111110
   INT  %0111111111111100,%1111111101111111
   INT  %0111111011111100,%1111111111111111
   INT  %0111111111111100,%1111111111111111
   INT  %0011111111111000,%0111111111111110
   INT  %0011111111111000,%0111111111111110
   INT  %0001111111110000,%0011111111111100
   INT  %0000011111000000,%0001111111111000
   INT  %0000000000000000,%0000011111100000
   LONG 0

data2:
   LONG 0
   INT  %0000011000000000,%0000011000000000
   INT  %0000111101000000,%0000111101000000
   INT  %0011111111100000,%0011111111100000
   INT  %0111111111100000,%0111111111100000
   INT  %0110000111110000,%0111111111110000
   INT  %0111101111111000,%0111111111111000
   INT  %1111011111111000,%1111111111111000
   INT  %0110000111111100,%0111111111111100
   INT  %0111111100001100,%0111111111111100
   INT  %0011111111011110,%0011111111111110
   INT  %0111111110111100,%0111111111111100
   INT  %0011111100001100,%0011111111111100
   INT  %0001111111111000,%0001111111111000
   INT  %0000011111110000,%0000011111110000
   INT  %0000000111000000,%0000000111000000
   INT  %0000011100000000,%0000011100000000
   INT  %0000111111000000,%0000111111000000
   INT  %0000011110000000,%0000011110000000
   INT  %0000000000000000,%0000000000000000
   INT  %0000000011000000,%0000000011000000
   INT  %0000000011100000,%0000000011100000
   INT  %0000000001000000,%0000000001000000
   LONG 0


EXPORT PROC lockWin(window:PTR TO window,lockwin:PTR TO lockwindow)
DEF numreq
IF window
   IF lockwin
      numreq:=window.reqcount
      IF findRequest(lockwin,window)=FALSE
	 Request(lockwin.request,window)
	 IF window.reqcount>numreq
	    SetPointer(window,lockwin.pointer,lockwin.sizey,16,-6,0)
	    RETURN TRUE
	 ENDIF
      ENDIF
   ENDIF
ENDIF
ENDPROC FALSE


PROC findRequest(lockwin:PTR TO lockwindow,win:PTR TO window)
DEF req:PTR TO requester
req:=win.firstrequest
WHILE req
      IF req=lockwin.request THEN RETURN TRUE
      req:=req.olderrequest
ENDWHILE
ENDPROC FALSE



EXPORT PROC unLockWin(window,lockwin:PTR TO lockwindow)
IF lockwin
   IF window
      IF findRequest(lockwin,window)
	 ClearPointer(window)
	 EndRequest(lockwin.request,window)
	 RETURN TRUE
      ENDIF
   ENDIF
ENDIF
ENDPROC FALSE


EXPORT PROC endLockWin(lockwin:PTR TO lockwindow)
IF lockwin
   IF lockwin.pointer THEN Dispose(lockwin.pointer)
   Dispose(lockwin)
ENDIF
ENDPROC


