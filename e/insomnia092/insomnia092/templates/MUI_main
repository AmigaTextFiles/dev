INSOMNIA_E_SOURCE_EDITOR_TEMPLATE

OPT PREPROCESS

MODULE 'muimaster'
MODULE 'libraries/mui'
MODULE 'libraries/muip'
MODULE 'mui/muicustomclass'
MODULE 'intuition/classes'
MODULE 'intuition/classusr'
MODULE 'intuition/screens'
MODULE 'intuition/intuition'
MODULE 'utility'
MODULE 'utility/tagitem'
MODULE 'utility/hooks'
MODULE 'amigalib/boopsi'
MODULE 'amigalib/lists'
MODULE 'exec/lists'
MODULE 'exec/nodes'
MODULE 'dos/dos'
MODULE 'tools/installhook'

ENUM ARG_BLA, NROFARGS
       
PROC main() HANDLE
   DEF application=NIL,window, myobj, mcc=NIL:PTR TO mui_customclass
   DEF sigs=0, result, exit=FALSE, rdargs=NIL, args:PTR TO LONG

   NEW args[NROFARGS]

   rdargs := ReadArgs('BLA/S', args, NIL)
   IF rdargs = NIL THEN Raise("ARGS")

   muimasterbase := OpenLibrary(MUIMASTER_NAME, MUIMASTER_VMIN)
   IF muimasterbase = NIL THEN Throw("LIB", 'muimaster.library')


   mcc := eMui_CreateCustomClass(NIL,MUIC_Area,NIL,SIZEOF mydata,{myDispatcher})
   IF mcc = NIL THEN Throw("MCC", 'myclass')


   application:=ApplicationObject,
      MUIA_Application_Title      , 'Title',
      MUIA_Application_Version    , '$VER: version',
      MUIA_Application_Copyright  , 'Copyright',
      MUIA_Application_Author     , 'Author',
      MUIA_Application_Description, 'Description',
      MUIA_Application_Base       , 'MYBASE',
   End
   IF application=NIL THEN Raise("APP")


   window := WindowObject,
          MUIA_Window_Title, 'Title',
          MUIA_Window_ID   , "MAIN",
          WindowContents, VGroup,

          ...    

       End,
   End
   IF window = NIL THEN Raise("WIN")
   
   doMethodA(window, [MUIM_Notify,MUIA_Window_CloseRequest, MUI_TRUE,
            application, 2, MUIM_Application_ReturnID, MUIV_Application_ReturnID_Quit])

   doMethodA(application, [OM_ADDMEMBER, window])
   set(window, MUIA_Window_Open, TRUE)

   REPEAT
      result := doMethodA(application,[MUIM_Application_NewInput,{sigs}]) 
      SELECT result 
      CASE MUIV_Application_ReturnID_Quit
         exit := TRUE
      DEFAULT
         IF sigs 
            sigs := Wait(SIGBREAKF_CTRL_C OR sigs)
            IF sigs AND SIGBREAKF_CTRL_C THEN exit := TRUE
         ENDIF   
      ENDSELECT   
   UNTIL exit

   set(window, MUIA_Window_Open, FALSE)
   doMethodA(application, [OM_REMMEMBER, window])
   Mui_DisposeObject(window)
   

EXCEPT DO

    IF application THEN Mui_DisposeObject(application) 
    IF mcc THEN Mui_DeleteCustomClass(mcc)            
    IF muimasterbase THEN CloseLibrary(muimasterbase) 
    IF rdargs THEN FreeArgs(rdargs)
    
    SELECT exception 
    CASE "ARGS"
    CASE "LIB"
    CASE "MCC"
    CASE "APP"
    CASE "WIN"
    ENDSELECT

ENDPROC

   
    






