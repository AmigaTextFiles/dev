/*
**	Original C Code written by Stefan Stuntz
**
**	Translation into E by Jan Hendrik Schulz
**
** To compile this source you need the files muimaster.m,
** mui.m and mui.e that came with this source and Mac2E.
** (And of course the E Compiler "EC".)
*/


/*
** Loading the needed MODULEs
*/

MODULE 'muimaster', 'libraries/mui'
MODULE 'utility/tagitem', 'utility/hooks'
MODULE 'intuition/classes', 'intuition/classusr'
MODULE 'libraries/asl'


/*
** defining some CONSTs
*/

ENUM ER_NON, ER_MUILIB, ER_APP


/*
** DEFining the global vars
*/

DEF setAttrsA=0		/* for the SetAttrsA()-problem */


/*
** Now the two hook-functions
*/

PROC hook_StrObjFunc(pop,str)

   DEF x,s,i

   GetAttr(MUIA_String_Contents,str,{s})

   i:=0
   LOOP
      doMethod(pop,[MUIM_List_GetEntry,i,{x}])

      IF x=NIL

	 SetAttrsA(pop,[setAttrsA+(MUIA_List_Active),MUIV_List_Active_Off,TAG_DONE])
	 RETURN MUI_TRUE

      ELSEIF StrCmp(x,s,ALL)

	 SetAttrsA(pop,[setAttrsA+(MUIA_List_Active),i,TAG_DONE])
	 RETURN MUI_TRUE

      ENDIF
   INC i
   ENDLOOP
ENDPROC


PROC hook_ObjStrFunc(pop,str)

   DEF x

   doMethod(pop,[MUIM_List_GetEntry,MUIV_List_GetEntry_Active,{x}])
   SetAttrsA(str,[setAttrsA+(MUIA_String_Contents),x,TAG_DONE])

ENDPROC


/*
** main PROC with exception handling
*/

PROC main() HANDLE

   DEF popNames
   DEF hookStrObj:hook, hookObjStr:hook
   DEF app,window,pop1,pop2,pop3,pop4,pop5,plist
   DEF signals, result, active, running=TRUE

/*
** creating the hooks
*/

   installhook(hookStrObj, {hook_StrObjFunc})
   installhook(hookObjStr, {hook_ObjStrFunc})

/*
** creating array for PopUp
*/

  popNames := [ 'Stefan Becker',
		'Martin Berndt',
		'Georg Heﬂmann',
		'Martin Horneffer',
		'Martin Huttenloher',
		'Kai Iske',
		'Oliver Kilian',
		'Franke Mariak',
		'Klaus Melchior',
		'Armin Sander',
		'Matthias Scheler',
		'Andreas Schildbach',
		'Wolfgang Schildbach',
		'Christian Scholz',
		'Markus Stipp',
		'Ibrahim Solmaz',
		'Henri Veistera',
		'Alber Weinert',
		NIL ]

/*
** open muimaster.library
*/

   IF (muimasterbase := OpenLibrary('muimaster.library',MUIMASTER_VMIN))=NIL THEN Raise(ER_MUILIB)

/*
** creating the application
*/

   app := MuI_NewObjectA('Application.mui',[TAG_IGNORE,0,
	MUIA_Application_Title      , 'Popup-Demo',
	MUIA_Application_Version    , '$VER: Popup-Demo 8.37 (03.07.94)',
	MUIA_A