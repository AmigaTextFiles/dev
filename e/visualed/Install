; $VER: Visual EDEV Install Program Version 1.0 (12Feb96)

;----------------------------- Text Strings -------------------------------

(set msg_Examples		"Visual EDEV Examples")
(set msg_Modules		"Visual EDEV Modules for E")
(set msg_Icons 		"Visual EDEV Icons")
(set msg_Boopsi                       "Visual EDEV Boopsi defines")
(set msg_NoSelect	"You did not select anything. Please try again.")
(set msg_NoDrawer	("You must select a drawer to install %s. Please make a new drawer, or select an existing drawer." @app-name))
(set msg_ChooseWhat	("Please select which parts of %s you would like to install:" @app-name))
(set msg_AppChooseDest ("Please select where you want %s to be installed:" @app-name))
(set msg_OldWorkbench	("You need at least Worbench 2.04 to install %s" @app-name))
(set msg_Startup	("Do you want %s to start up automatically every time you turn on your Amiga?" @app-name))
(set msg_ErrorRam	"Error while copying files to Ram Disk.")
(set msg_Insert		"Please insert Disk %ld in any drive")
(set msg_Installing	"Installing %s...")
;-------------------------------- Disks -----------------------------------
(set num_Examples 1)
(set num_EDEV     1)
(set num_Modules  1)
(set num_Icons    1)
(set num_Boopsi   1)
;------------------------------ lha files ---------------------------------
(set lha_Examples "examples.lha")
(set lha_Modules  "modules.lha")
(set lha_EDEV     "vedev.lha")
(set lha_Icons    "icons.lha")
(set lha_Boopsi   "boopsi.lha")
;------------------------------ Constants ---------------------------------
(set opt_EDEV	%00000001)
(set opt_Examples	%00000010)
(set opt_Icons	%00000100)
(set opt_Modules	%00001000)
(set opt_Boopsi	%00010000)
 ;-------------------------- Utility procedures ----------------------------

(Procedure CheckConfig
    (set OS_Version (/ (getversion) 65536))
    (if (< OS_Version 37)
	(abort msg_OldWorkbench)
    )
)

(Procedure InstallFile
;    (askdisk (dest ("Disk%ld" DiskNum))
;	     (prompt (msg_Insert DiskNum)) 
;	     (help @askdisk-help)
;    )
    (working (msg_Installing Installing))
    (run ("RAM:LHa -N x %s \"%s/\"" LhaFile @Dest))
)

;-------------------------- Cleanup procedures ----------------------------

;-------------------------- Menu procedures -------------------------------

(Procedure InstallMenu
	(until (<> Selection 0)
 	(
		(set Selection
	   	(askoptions
	      	(prompt msg_ChooseWhat)
	         	(help @askoptions-help)
               	(choices @app-name
	msg_Examples
	msg_Icons
	msg_Modules
	msg_Boopsi)
		   )
		)
	)

	
	(if (= Selection 0)    
   	(message msg_NoSelect)
   )
)
)

(Procedure CopyTools
    (copyfiles
	(prompt "")
	(help @copyfiles-help)
	(source "Tools")
	(all)
	(dest "RAM:")
    )
    (if (not (exists "RAM:LHa")) 
	(abort msg_ErrorRam)
    )
)

(Procedure DeleteTools
    (delete "RAM:Lha")
)

(Procedure DestMenu
	(set @dest "")
   (while (= @dest (pathonly @dest))
   	(set @dest
      	(askdir
         	(prompt msg_ChooseDest)
            	(help @askdir-help)
               (newpath)
               (default @default-dest)
	    	)
      )
      (if (= @dest (pathonly @dest))
	   	(message msg_NoDrawer)
		)
	)
   (if (not (exists @dest))
   (
		(makedir @dest (infos))
     	(tooltype (dest @dest) (noposition))
	)
   ) 
	(set @default-dest @dest)
)

;-------------------------
;Installation             procedures
;------------------------ 
(Procedure InstallEDEV
    (set Installing app-name)
    (set LhaFile lha_EDEV)
    (set DiskNum num_EDEV)
    (InstallFile)
)

(Procedure InstallModules
	 (set msg_ChooseDest	("Please select your drawer with E Modules, it's very important that this is the correct drawer:"))

	 (DestMenu)

    (set Modules (tackon @dest "VEDM"))
    (makedir Modules)
    (tooltype (dest Modules) (noposition))

    (set Installing msg_Modules)
    (set LhaFile lha_Modules)
    (set DiskNum num_Modules)
    (InstallFile)

)

(Procedure InstallExamples
    (set Examples (tackon @dest "Examples"))
    (makedir Examples (infos))
    (tooltype (dest Examples) (noposition))

    (set Installing msg_Examples)
    (set LhaFile lha_Examples)
    (set DiskNum num_Examples)
    (InstallFile)
)

(Procedure InstallBoopsi
    (set Boopsi (tackon @dest "Boopsi"))
    (makedir Boopsi (infos))
    (tooltype (dest Boopsi) (noposition))

    (set Installing msg_Boopsi)
    (set LhaFile lha_Boopsi)
    (set DiskNum num_Boopsi)
    (InstallFile)
)

(Procedure InstallIcons
    (set Icons (tackon @dest "Icons"))
    (makedir Icons (infos))
    (tooltype (dest Icons) (noposition))

    (set Installing msg_Icons)
    (set LhaFile lha_Icons)
    (set DiskNum num_Icons)
    (InstallFile)
)


;------------------------------- Main program -----------------------------

(CheckConfig)
(CopyTools)
(InstallMenu)

; Disk 1
(if (bitand Selection opt_Modules)	(InstallModules))
(set msg_ChooseDest	msg_AppChooseDest)
(DestMenu)
(if (bitand Selection opt_EDEV)	(InstallEDEV))
(if (bitand Selection opt_Icons)      (InstallIcons))
(if (bitand Selection opt_Examples)	(InstallExamples))
(if (bitand Selection opt_Boopsi)	(InstallBoopsi))
(DeleteTools)
(exit)
