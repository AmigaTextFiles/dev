;rE
	machine mc68020
	fpu	1

	dsource	"re:lib/elib_68k/Val.e"
;MOD:re:modules/lib/restd_68k.m
	xdef	_Val
_Val:
Val_s	equ	12
Val_read	equ	8
	link	a5,#-16
	movem.l	a0,-(a7)
;DEF  num=0,sign=1,running=TRUE,n
Val_num	equ	-16
	move.l	#0,Val_num(a5)
Val_sign	equ	-12
	move.l	#1,Val_sign(a5)
Val_running	equ	-8
	move.l	#-1,Val_running(a5)
Val_n	equ	-4
;n := s                
	move.l	Val_s(a5),Val_n(a5)
;
;WHILE (s[]="\t") OR (s[]=" ") OR (s[]="+") DO s++
Val_while1:
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	cmpi.l	#9,d0
	seq	d0
	extb.l	d0
	movea.l	Val_s(a5),a0
	move.b	(a0),d1
	and.l	#$FF,d1
	cmpi.l	#32,d1
	seq	d1
	extb.l	d1
	or.l	d1,d0
	movea.l	Val_s(a5),a0
	move.b	(a0),d1
	and.l	#$FF,d1
	cmpi.l	#43,d1
	seq	d1
	extb.l	d1
	or.l	d1,d0
	tst.l	d0
	beq	Val_elsewhile1_0
;s++
	add.l	#1,Val_s(a5)
	bra	Val_while1
Val_elsewhile1_0:
;
;IF s[]="-"
;Val_if2
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	cmpi.l	#45,d0
	bne	Val_else2_0
;sign:=-1
	move.l	#-1,Val_sign(a5)
;
;s++
	add.l	#1,Val_s(a5)
;
;ENDIF
Val_else2_0:
;
;IF (s[]="0") THEN s++
;Val_if3
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	cmpi.l	#48,d0
	bne	Val_else3_0
;s++
	add.l	#1,Val_s(a5)
Val_else3_0:
;IF (s[]="%") OR (s[]="b")                            
;Val_if4
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	cmpi.l	#37,d0
	seq	d0
	extb.l	d0
	movea.l	Val_s(a5),a0
	move.b	(a0),d1
	and.l	#$FF,d1
	cmpi.l	#98,d1
	seq	d1
	extb.l	d1
	or.l	d1,d0
	tst.l	d0
	beq	Val_else4_0
;s++
	add.l	#1,Val_s(a5)
;
;WHILE (s[]="0") OR (s[]="1")
Val_while5:
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	cmpi.l	#48,d0
	seq	d0
	extb.l	d0
	movea.l	Val_s(a5),a0
	move.b	(a0),d1
	and.l	#$FF,d1
	cmpi.l	#49,d1
	seq	d1
	extb.l	d1
	or.l	d1,d0
	tst.l	d0
	beq	Val_elsewhile5_0
;num<<=1
	move.l	#1,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	lsl.l	d0,d1
	move.l	d1,(a0)
;
;num|=s[]-"0"
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	subi.l	#48,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	or.l	d0,d1
	move.l	d1,(a0)
;
;s++
	add.l	#1,Val_s(a5)
;
;ENDWHILE
Val_nextloop5:
	bra	Val_while5
Val_elsewhile5_0:
Val_endloop5:
;
;ELSEIF (s[]="$") OR (s[]="x")                             
	bra	Val_endif4
Val_else4_0:
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	cmpi.l	#36,d0
	seq	d0
	extb.l	d0
	movea.l	Val_s(a5),a0
	move.b	(a0),d1
	and.l	#$FF,d1
	cmpi.l	#120,d1
	seq	d1
	extb.l	d1
	or.l	d1,d0
	tst.l	d0
	beq	Val_else4_1
;WHILE running
Val_while6:
	move.l	Val_running(a5),d0
	tst.l	d0
	beq	Val_elsewhile6_0
;s++
	add.l	#1,Val_s(a5)
;
;SELECT s[]
Val_select7:
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
;CASE "0" TO "9"
	cmpi.l	#48,d0
	blt	Val_casenext7_11
	cmpi.l	#57,d0
	ble	Val_casecode7_1
Val_casenext7_11:
	bra	Val_case7_1
Val_casecode7_1:
;num<<= 4
	move.l	#4,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	lsl.l	d0,d1
	move.l	d1,(a0)
;
;num |= s[]-"0"
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	subi.l	#48,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	or.l	d0,d1
	move.l	d1,(a0)
;
;CASE "a" TO "f"
	bra	Val_endselect7
Val_case7_1:
	cmpi.l	#97,d0
	blt	Val_casenext7_21
	cmpi.l	#102,d0
	ble	Val_casecode7_2
Val_casenext7_21:
	bra	Val_case7_2
Val_casecode7_2:
;num<<= 4
	move.l	#4,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	lsl.l	d0,d1
	move.l	d1,(a0)
;
;num |= s[]-"a"+10
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	addi.l	#-87,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	or.l	d0,d1
	move.l	d1,(a0)
;
;CASE "A" TO "F"
	bra	Val_endselect7
Val_case7_2:
	cmpi.l	#65,d0
	blt	Val_casenext7_31
	cmpi.l	#70,d0
	ble	Val_casecode7_3
Val_casenext7_31:
	bra	Val_case7_3
Val_casecode7_3:
;num<<= 4
	move.l	#4,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	lsl.l	d0,d1
	move.l	d1,(a0)
;
;num |= s[]-"A"+10
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	addi.l	#-55,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	or.l	d0,d1
	move.l	d1,(a0)
;
;DEFAULT
	bra	Val_endselect7
Val_case7_3:
;
;running:=FALSE
	move.l	#0,Val_running(a5)
;
;ENDSELECT
Val_endselect7:
;
;ENDWHILE
Val_nextloop6:
	bra	Val_while6
Val_elsewhile6_0:
Val_endloop6:
;
;ELSE                                                 
	bra	Val_endif4
Val_else4_1:
;
;WHILE (s[]>="0") AND (s[]<="9")
Val_while8:
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	cmpi.l	#48,d0
	sge	d0
	extb.l	d0
	movea.l	Val_s(a5),a0
	move.b	(a0),d1
	and.l	#$FF,d1
	cmpi.l	#57,d1
	sle	d1
	extb.l	d1
	and.l	d1,d0
	beq	Val_elsewhile8_0
;num*=10
	move.l	#10,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	muls.l	d0,d1
	move.l	d1,(a0)
;
;num+=s[]-"0"
	movea.l	Val_s(a5),a0
	move.b	(a0),d0
	and.l	#$FF,d0
	subi.l	#48,d0
	lea	Val_num(a5),a0
	move.l	(a0),d1
	add.l	d0,d1
	move.l	d1,(a0)
;
;s++
	add.l	#1,Val_s(a5)
;
;ENDWHILE
Val_nextloop8:
	bra	Val_while8
Val_elsewhile8_0:
Val_endloop8:
;
;ENDIF
Val_endif4:
;
;n:=s-n
	move.l	Val_s(a5),d0
	sub.l	Val_n(a5),d0
	move.l	d0,Val_n(a5)
;
;IF read THEN read[] := n
;Val_if9
	move.l	Val_read(a5),d0
	tst.l	d0
	beq	Val_else9_0
;read[] := n
	move.l	Val_n(a5),d0
	movea.l	Val_read(a5),a0
	move.l	d0,(a0)
Val_else9_0:
;
;ENDPROC num*sign,n
	xdef	_Val_end
_Val_end:
	move.l	Val_num(a5),d0
	muls.l	Val_sign(a5),d0
	move.l	Val_n(a5),d1
_Val_finish:
	movem.l	(a7)+,a0
	unlk	a5
	rts
; END
; NOX
	cnop	0,2

	section	".tocd",data
	xref	_stdrast
