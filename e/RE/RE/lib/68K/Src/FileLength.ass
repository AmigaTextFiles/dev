;rE
	machine mc68020
	fpu	1

	dsource	"re:lib/elib_68K/FileLength.e"
;MOD:re:modules/dos.m
;MOD:re:modules/dos/dos.m
;MOD:re:modules/exec/types.m
;MOD:re:modules/lib/restd_68k.m
	xdef	_FileLength
_FileLength:
FileLength_name	equ	8
	link	a5,#-272
	movem.l	a0,-(a7)
;DEF	lock:BPTR,fib:FileInfoBlock,l=TRUE
FileLength_lock	equ	-272
FileLength_fib	equ	-268
	lea	FileLength_fib(a5),a0
	move.l	a0,d0
	addi.l	#4,d0
	move.l	d0,(a0)
FileLength_l	equ	-4
	move.l	#-1,FileLength_l(a5)
;IF lock:=Lock(name,ACCESS_READ)
;EFileLength_if1
	move.l	d0,-(a7)
	move.l	FileLength_name(a5),d0
	move.l	d0,-(a7)
	move.l	#-2,d2
	move.l	(a7)+,d1
	movea.l	_DOSBase,a6
	jsr	-84(a6)
	move.l	d0,d1
	move.l	(a7)+,d0
	move.l	d1,FileLength_lock(a5)
	tst.l	d1
	beq	EFileLength_else1_0
;IF Examine(lock,fib)
;EFileLength_if2
	move.l	d0,-(a7)
	move.l	FileLength_lock(a5),d0
	move.l	d0,-(a7)
	lea	FileLength_fib(a5),a0
	move.l	a0,d2
	move.l	(a7)+,d1
	movea.l	_DOSBase,a6
	jsr	-102(a6)
	move.l	d0,d1
	move.l	(a7)+,d0
	tst.l	d1
	beq	EFileLength_else2_0
;l:=fib.Size
	lea	FileLength_fib(a5),a0
	move.l	124(a0),FileLength_l(a5)
;
;ENDIF
EFileLength_else2_0:
;
;UnLock(lock)
	move.l	d0,-(a7)
	move.l	FileLength_lock(a5),d1
	movea.l	_DOSBase,a6
	jsr	-90(a6)
	adda.l	#1*4,a7
;
;ENDIF
EFileLength_else1_0:
;
;ENDPROC l
	xdef	_FileLength_end
_FileLength_end:
	move.l	FileLength_l(a5),d0
_FileLength_finish:
	movem.l	(a7)+,a0
	unlk	a5
	rts
;
; END
; NOX
	cnop	0,2

	section	".tocd",data
	xref	_DOSBase
	xref	_stdrast
