#rE
	.include	ppcmacros.pasm
	.text
	.sdreg	r2
	.align	2
#MOD:re:modules/dos.m
#MOD:re:modules/lib/restd_PPC.m
	.global	_ReadEStr
_ReadEStr:
.set	ReadEStr_fh,12
.set	ReadEStr_estr,8
	link	a5,0
	push	a0
#FGets(fh,estr,EStrMax(estr))
	push	d0
	lwz	d1,ReadEStr_fh(a5)
	push	d1
	lwz	d1,ReadEStr_estr(a5)
	push	d1
	push	d0
	lwz	d0,ReadEStr_estr(a5)
	lhz	d0,-4(d0)
	mr	d1,d0
	pop	d0
	mr	d3,d1
	pop	d2
	pop	d1
	RUN_68K	_DOSBase,-336
	mr	d1,d0
	pop	d0
#
#SetEStr(estr,StrLen(estr)-1)
	push	d0
	lwz	d1,ReadEStr_estr(a5)
	push	d1
	push	d0
	lwz	d0,ReadEStr_estr(a5)
	bl	_StrLen
	mr	d1,d0
	pop	d0
	subiw	d1,d1,1
	mr	d0,d1
	pop	a0
	bl	_SetEStr
	mr	d1,d0
	pop	d0
#
#ENDPROC
	.global	_ReadEStr_end
_ReadEStr_end:
_ReadEStr_finish:
	pop	a0
	unlk	a5
	blr

	.type	_ReadEStr,2
	.size	_ReadEStr,$-_ReadEStr

	.extern	_SetEStr
	.extern	_StrLen
	.align	2
	.tocd
	.extern	_DOSBase_
	.extern	_stdrast_

	.tocd
	.extern	_PowerPCBase_
_ReadEStr_:	.long	_ReadEStr
_ReadEStr_end_:	.long	_ReadEStr_end
_ReadEStr_finish_:	.long	_ReadEStr_finish
