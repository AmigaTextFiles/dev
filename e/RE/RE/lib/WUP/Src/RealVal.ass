#rE
	.include	ppcmacros.pasm
	.text
	.sdreg	r2
	.align	2
	.global	_RealVal
_RealVal:
.set	RealVal_str,8
	link	a5,-28
	push	a0
#DEF divider=1.0,fraction=0.0,sign=1.0
	law	a0,_fltn_1
	lfs	fp0,0(a0)
.set	RealVal_divider,-28
	stfs	fp0,RealVal_divider(a5)
	law	a0,_fltn_2
	lfs	fp0,0(a0)
.set	RealVal_fraction,-24
	stfs	fp0,RealVal_fraction(a5)
	law	a0,_fltn_3
	lfs	fp0,0(a0)
.set	RealVal_sign,-20
	stfs	fp0,RealVal_sign(a5)
#DEF x=0
.set	RealVal_x,-16
	liw	d0,0
	stw	d0,RealVal_x(a5)
#DEF pre=TRUE,n,oldstr
.set	RealVal_pre,-12
	liw	d0,-1
	stw	d0,RealVal_pre(a5)
.set	RealVal_n,-8
.set	RealVal_oldstr,-4
#oldstr:=str
	lwz	d0,RealVal_str(a5)
	stw	d0,RealVal_oldstr(a5)
#WHILE (str[]=" ") OR (str[]="\n") OR (str[]="\t") OR (str[]="+") DO str++
RealVal_while1:
	lwz	a0,RealVal_str(a5)
	lbz	d0,0(a0)
	cmpiw	d0,32
	scc	eq,d0
	lbz	d1,0(a0)
	cmpiw	d1,10
	scc	eq,d1
	or	d0,d0,d1
	cmpiw	d1,9
	scc	eq,d1
	or	d0,d0,d1
	cmpiw	d1,43
	scc	eq,d1
	or	d0,d0,d1
	tstw	d0
	beq	RealVal_elsewhile1_0
#str++
	addi	a6,a5,RealVal_str
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
	b	RealVal_while1
RealVal_elsewhile1_0:
#IF str[]="-"
	lbz	d0,RealVal_str(a5)
	cmpiw	d0,45
	bne	RealVal_else2_0
#sign:=-1.0
	law	a0,_fltn_4
	lfs	fp0,0(a0)
	stfs	fp0,RealVal_sign(a5)
#str++
	addi	a6,a5,RealVal_str
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
#ENDIF
RealVal_else2_0:
#WHILE str[]
RealVal_while3:
	lbz	d0,RealVal_str(a5)
	tstw	d0
	beq	RealVal_elsewhile3_0
#SELECT str[]
	lwz	a0,RealVal_str(a5)
	lbz	d0,0(a0)
#CASE "0" TO "9"
	cmpiw	d0,48
	blt	RealVal_casenext4_11
	cmpiw	d0,57
	ble	RealVal_casecode4_1
RealVal_casenext4_11:
	b	RealVal_case4_1
RealVal_casecode4_1:
#n:=(str[]-"0")
	lbz	d0,RealVal_str(a5)
	subiw	d0,d0,48
	stw	d0,RealVal_n(a5)
#IF pre
	lwz	d0,RealVal_pre(a5)
	tstw	d0
	beq	RealVal_else5_0
#x:=x*10+n
	lwz	d0,RealVal_x(a5)
	mulliw	d0,d0,10
	lwz	d1,RealVal_n(a5)
	add	d0,d0,d1
	stw	d0,RealVal_x(a5)
#ELSE
	b	RealVal_endif5
RealVal_else5_0:
#fraction:=!fraction*10.0+(n!)
	addi	a0,a5,RealVal_fraction
	lfs	fp0,0(a0)
	law	a0,_fltn_5
	lfs	fp1,0(a0)
	fmuls	fp0,fp0,fp1
	lwz	d1,RealVal_n(a5)
	fmovs	fp1,d1
	fadds	fp0,fp0,fp1
	stfs	fp0,RealVal_fraction(a5)
#divider:=!divider*10.0
	addi	a0,a5,RealVal_divider
	lfs	fp0,0(a0)
	law	a0,_fltn_6
	lfs	fp1,0(a0)
	fmuls	fp0,fp0,fp1
	stfs	fp0,RealVal_divider(a5)
#ENDIF
RealVal_endif5:
#CASE "."
	b	RealVal_endselect4
RealVal_case4_1:
	cmpiw	d0,46
	beq	RealVal_casecode4_2
	b	RealVal_case4_2
RealVal_casecode4_2:
#pre:=FALSE
	liw	d0,0
	stw	d0,RealVal_pre(a5)
#ENDSELECT
RealVal_case4_2:
RealVal_endselect4:
#str++
	addi	a6,a5,RealVal_str
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
#ENDWHILE
RealVal_nextloop3:
	b	RealVal_while3
RealVal_elsewhile3_0:
RealVal_endloop3:
#x:=!(x!)+(!fraction/divider)                                 
	lwz	d0,RealVal_x(a5)
	fmovs	fp0,d0
	addi	a0,a5,RealVal_fraction
	lfs	fp1,0(a0)
	addi	a0,a5,RealVal_divider
	lfs	fp2,0(a0)
	fdivs	fp1,fp1,fp2
	fadds	fp0,fp0,fp1
	stfs	fp0,RealVal_x(a5)
#ENDPROC !x*sign,str-oldstr
	.global	_RealVal_end
_RealVal_end:
	addi	a0,a5,RealVal_x
	lfs	fp0,0(a0)
	addi	a0,a5,RealVal_sign
	lfs	fp1,0(a0)
	fmuls	fp0,fp0,fp1
	stfs	fp0,-4(a7)
	lwz	d0,-4(a7)
	lwz	d1,RealVal_str(a5)
	lwz	d2,RealVal_oldstr(a5)
	sub	d1,d1,d2
_RealVal_finish:
	pop	a0
	unlk	a5
	blr

	.type	_RealVal,2
	.size	_RealVal,$-_RealVal

	.align	2
	.tocd
fconv:	.long	0x43300000,0x80000000
	.extern	_stdrast_
_fltn_1:
	.float	1.0
_fltn_2:
	.float	0.0
_fltn_3:
	.float	1.0
_fltn_4:
	.float	-1.0
_fltn_5:
	.float	10.0
_fltn_6:
	.float	10.0

	.tocd
fconv_:	.long	fconv
	.extern	_PowerPCBase_
_RealVal_:	.long	_RealVal
_RealVal_end_:	.long	_RealVal_end
_RealVal_finish_:	.long	_RealVal_finish
_fltn_1_:	.long	_fltn_1
_fltn_2_:	.long	_fltn_2
_fltn_3_:	.long	_fltn_3
_fltn_4_:	.long	_fltn_4
_fltn_5_:	.long	_fltn_5
_fltn_6_:	.long	_fltn_6
