
# EStrAdd(a0:PTR TO CHAR,a1:PTR TO CHAR,d0=-1:LONG)

	.include	ppcmacros.pasm
	.text
	.global	_EStrAdd

_EStrAdd:
.set	len,r7
.set	maxlen,r8
	mr	a6,a0		# store address
	cmpwi	d0,0
	beq	.stop
	lhz	len,-2(a0)
	lhz	maxlen,-4(a0)
	cmpw	len,maxlen
	beq	.stop
	add	a0,a0,len
	sub	maxlen,maxlen,len
	cmplw	d0,maxlen
	blt	.skip
	mr	d0,maxlen	# Min(maxlen,d0)
.skip:
	mtctr	d0
	subi	a0,a0,1
	subi	a1,a1,1
.loop:	lbzu	r0,1(a1)	# get char from source
	mr.	r0,r0		# source end?
	beq	.end
	stbu	r0,1(a0)	# put char to destination
	bdnz	.loop

.end:	li	r0,0		# finish with zero byte
	stbu	r0,1(a0)
	sub	len,a0,a6
	sth	len,-2(a6)
.stop:	mr	d0,a6
	blr			# d0 contains destination string pointer
	
	.type	_EStrAdd,@function
	.size	_EStrAdd,$-_EStrAdd
