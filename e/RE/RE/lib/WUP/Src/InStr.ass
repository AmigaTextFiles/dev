# a0 - string
# a1 - string to find
# d0 - startindex=0
#pasm -F 2 -mo -O -1 -I re:lib/ re:lib/elib_PPC/InStr.ass

	.include	ppcmacros.pasm
	.text

	.global	_InStr
_InStr:	
	push	d2
	add	a0,a0,d0
	mr	d2,a0

	subi	a0,a0,1
	subi	a1,a1,1
	lbzu	d0,1(a1)
.loop:	
	lbzu	d1,1(a0)
	mr.	d1,d1		# zero (eos) byte?
	beq	.nof
	cmpw	d1,d0
	bne	.loop
	subi	a2,a0,1
	subi	a3,a1,1
.next:
	lbzu	d1,1(a3)
	mr.	d1,d1		# zero (eos) byte?
	beq	.end
	lbzu	r0,1(a2)
	cmpw	d1,r0
	bne	.loop
	beq	.next
.end:	sub	d0,a0,d2
	b	.fin
.nof:
	li	d0,-1
.fin:	pop	d2
	blr

	.tocd
	.global	_InStr_
_InStr_:	.long	_InStr
