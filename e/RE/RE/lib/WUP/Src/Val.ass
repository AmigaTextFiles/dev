#rE
	.include	ppcmacros.pasm
	.text
	.sdreg	r2
	.align	2
#MOD:re:modules/lib/restd_PPC.m
	.global	_Val
_Val:
.set	Val_s,12
.set	Val_read,8
	link	a5,-16
	push	a0
#DEF  num=0,sign=1,running=TRUE,n
.set	Val_num,-16
	liw	d0,0
	stw	d0,Val_num(a5)
.set	Val_sign,-12
	liw	d0,1
	stw	d0,Val_sign(a5)
.set	Val_running,-8
	liw	d0,-1
	stw	d0,Val_running(a5)
.set	Val_n,-4
#n := s                
	addi	a0,a5,Val_s
	lwz	d0,0(a0)
	stw	d0,Val_n(a5)
#
#WHILE (s[]="\t") OR (s[]=" ") OR (s[]="+") DO s++
Val_while1:
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	cmpiw	d0,9
	scc	eq,d0
	lwz	a0,Val_s(a5)
	lbz	d1,0(a0)
	cmpiw	d1,32
	scc	eq,d1
	or	d0,d0,d1
	lwz	a0,Val_s(a5)
	lbz	d1,0(a0)
	cmpiw	d1,43
	scc	eq,d1
	or	d0,d0,d1
	tstw	d0
	beq	Val_elsewhile1_0
#s++
	addi	a6,a5,Val_s
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
	b	Val_while1
Val_elsewhile1_0:
#
#IF s[]="-"
#Val_if2
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	cmpiw	d0,45
	bne	Val_else2_0
#sign:=-1
	liw	d0,-1
	stw	d0,Val_sign(a5)
#
#s++
	addi	a6,a5,Val_s
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
#
#ENDIF
Val_else2_0:
#
#IF (s[]="0") THEN s++
#Val_if3
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	cmpiw	d0,48
	bne	Val_else3_0
#s++
	addi	a6,a5,Val_s
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
Val_else3_0:
#IF (s[]="%") OR (s[]="b")                            
#Val_if4
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	cmpiw	d0,37
	scc	eq,d0
	lwz	a0,Val_s(a5)
	lbz	d1,0(a0)
	cmpiw	d1,98
	scc	eq,d1
	or	d0,d0,d1
	tstw	d0
	beq	Val_else4_0
#s++
	addi	a6,a5,Val_s
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
#
#WHILE (s[]="0") OR (s[]="1")
Val_while5:
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	cmpiw	d0,48
	scc	eq,d0
	lwz	a0,Val_s(a5)
	lbz	d1,0(a0)
	cmpiw	d1,49
	scc	eq,d1
	or	d0,d0,d1
	tstw	d0
	beq	Val_elsewhile5_0
#num<<=1
	liw	d0,1
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	slw	d1,d1,d0
	stw	d1,0(a0)
#
#num|=s[]-"0"
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	subiw	d0,d0,48
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	or	d1,d1,d0
	stw	d1,0(a0)
#
#s++
	addi	a6,a5,Val_s
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
#
#ENDWHILE
Val_nextloop5:
	b	Val_while5
Val_elsewhile5_0:
Val_endloop5:
#
#ELSEIF (s[]="$") OR (s[]="x")                             
	b	Val_endif4
Val_else4_0:
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	cmpiw	d0,36
	scc	eq,d0
	lwz	a0,Val_s(a5)
	lbz	d1,0(a0)
	cmpiw	d1,120
	scc	eq,d1
	or	d0,d0,d1
	tstw	d0
	beq	Val_else4_1
#WHILE running
Val_while6:
	lwz	d0,Val_running(a5)
	tstw	d0
	beq	Val_elsewhile6_0
#s++
	addi	a6,a5,Val_s
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
#
#SELECT s[]
Val_select7:
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
#CASE "0" TO "9"
	cmpiw	d0,48
	blt	Val_casenext7_11
	cmpiw	d0,57
	ble	Val_casecode7_1
Val_casenext7_11:
	b	Val_case7_1
Val_casecode7_1:
#num<<= 4
	liw	d0,4
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	slw	d1,d1,d0
	stw	d1,0(a0)
#
#num |= s[]-"0"
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	subiw	d0,d0,48
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	or	d1,d1,d0
	stw	d1,0(a0)
#
#CASE "a" TO "f"
	b	Val_endselect7
Val_case7_1:
	cmpiw	d0,97
	blt	Val_casenext7_21
	cmpiw	d0,102
	ble	Val_casecode7_2
Val_casenext7_21:
	b	Val_case7_2
Val_casecode7_2:
#num<<= 4
	liw	d0,4
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	slw	d1,d1,d0
	stw	d1,0(a0)
#
#num |= s[]-"a"+10
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	addiw	d0,d0,-87
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	or	d1,d1,d0
	stw	d1,0(a0)
#
#CASE "A" TO "F"
	b	Val_endselect7
Val_case7_2:
	cmpiw	d0,65
	blt	Val_casenext7_31
	cmpiw	d0,70
	ble	Val_casecode7_3
Val_casenext7_31:
	b	Val_case7_3
Val_casecode7_3:
#num<<= 4
	liw	d0,4
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	slw	d1,d1,d0
	stw	d1,0(a0)
#
#num |= s[]-"A"+10
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	addiw	d0,d0,-55
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	or	d1,d1,d0
	stw	d1,0(a0)
#
#DEFAULT
	b	Val_endselect7
Val_case7_3:
#
#running:=FALSE
	liw	d0,0
	stw	d0,Val_running(a5)
#
#ENDSELECT
Val_endselect7:
#
#ENDWHILE
Val_nextloop6:
	b	Val_while6
Val_elsewhile6_0:
Val_endloop6:
#
#ELSE                                                 
	b	Val_endif4
Val_else4_1:
#
#WHILE (s[]>="0") AND (s[]<="9")
Val_while8:
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	cmpiw	d0,48
	scc	ge,d0
	lwz	a0,Val_s(a5)
	lbz	d1,0(a0)
	cmpiw	d1,57
	scc	le,d1
	and.	d0,d0,d1
	tstw	d0
	beq	Val_elsewhile8_0
#num*=10
	liw	d0,10
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	mullw	d1,d1,d0
	stw	d1,0(a0)
#
#num+=s[]-"0"
	lwz	a0,Val_s(a5)
	lbz	d0,0(a0)
	subiw	d0,d0,48
	addi	a0,a5,Val_num
	lwz	d1,0(a0)
	add	d1,d1,d0
	stw	d1,0(a0)
#
#s++
	addi	a6,a5,Val_s
	lwz	r7,0(a6)
	addi	r7,r7,1
	stw	r7,0(a6)
#
#ENDWHILE
Val_nextloop8:
	b	Val_while8
Val_elsewhile8_0:
Val_endloop8:
#
#ENDIF
Val_endif4:
#
#n:=s-n
	lwz	d0,Val_s(a5)
	lwz	d1,Val_n(a5)
	sub	d0,d0,d1
	stw	d0,Val_n(a5)
#
#IF read THEN read[] := n
#Val_if9
	lwz	d0,Val_read(a5)
	tstw	d0
	beq	Val_else9_0
#read[] := n
	lwz	d0,Val_n(a5)
	lwz	a0,Val_read(a5)
	stw	d0,0(a0)
Val_else9_0:
#
#ENDPROC num*sign,n
	.global	_Val_end
_Val_end:
	lwz	d0,Val_num(a5)
	lwz	d1,Val_sign(a5)
	mullw	d0,d0,d1
	lwz	d1,Val_n(a5)
_Val_finish:
	pop	a0
	unlk	a5
	blr

	.type	_Val,2
	.size	_Val,$-_Val

	.align	2
	.tocd
	.extern	_stdrast_

	.tocd
	.extern	_PowerPCBase_
_Val_:	.long	_Val
_Val_end_:	.long	_Val_end
_Val_finish_:	.long	_Val_finish
