# d0 - exception
# d1 - exceptioninfo
#pasm -F 2 -mo -O -1 -I re:lib/ re:lib/elib_PPC/Raise.ass


	.text
	.include	ppcmacros.pasm

	.global	_Raise
	.global	_exception_
	.global	_exceptioninfo_
	.global	_lastexceptptr_
	.global	_laststackptr_
	.global	_lastframeptr_

_Raise:
	law	a0,_exception
	stw	d0,0(a0)
	law	a0,_exceptioninfo
	stw	d1,0(a0)
	law	a0,_lastexceptptr
	lwz	d0,0(a0)
	tstw	d0
	beq	.exitRaise
	law	a0,_laststackptr
	lwz	a7,0(a0)
	law	a0,_lastframeptr
	lwz	a5,0(a0)
	pop	d1
	law	a0,_lastframeptr
	stw	d1,0(a0)
	pop	d1
	law	a0,_laststackptr
	stw	d1,0(a0)
	pop	d1
	law	a0,_lastexceptptr
	stw	d1,0(a0)
	mr	a0,d0
	mtlr	a0
	blr
.exitRaise:
	unlk	a5
	b	_main_end

_exception:	.long	0
_exceptioninfo:	.long	0
_lastexceptptr:	.long	0
_laststackptr:	.long	0
_lastframeptr:	.long	0

	.tocd
_exception_:	.long	_exception
_exceptioninfo_:.long	_exceptioninfo
_lastexceptptr_:.long	_lastexceptptr
_laststackptr_:	.long	_laststackptr
_lastframeptr_:	.long	_lastframeptr

	.extern	_main_end
