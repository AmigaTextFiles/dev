<html>
<head>
  <title>../../../amigaos4/source/os_main.c</title>
</head>
<body bgcolor="#ffffff" text="#000000">
<pre>
<font color="#444444">/*
 *---------------------------------------------------------------------
 * Original Author: Jamie Krueger
 * Creation Date  : 9/25/2003
 *---------------------------------------------------------------------
 * Copyright (c) 2003 BITbyBIT Software Group, All Rights Reserved.
 *
 * This software is the confidential and proprietary information of
 * BITbyBIT Software Group (Confidential Information).  You shall not
 * disclose such Confidential Information and shall use it only in
 * accordance with the terms of the license agreement you entered into
 * with BITbyBIT Software Group.
 *
 * BITbyBIT SOFTWARE GROUP MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE
 * SUITABILITY OF THE SOFTWARE, EITHER EXPRESS OR IMPLIED, INCLUDING
 * FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. 
 * BITbyBIT Software Group LLC SHALL NOT BE LIABLE FOR ANY DAMAGES SUFFERED BY
 * LICENSEE AS A RESULT OF USING, MODIFYING OR DISTRIBUTING THIS
 * SOFTWARE OR ITS DERIVATIVES.
 *---------------------------------------------------------------------
 *
 *  Template Application for writing AVD aware software
 *
 *  Project: AVD_Template
 *
 *  Description: OS Specific Project Entry Point (os_main.c)
 *               Completes by jumping into Common Project Main AVD_Main(),
 *               in (avd_template.c)
 *
 * $VER: $
 * $History: os_main.c $
 * 
 * *****************  Version 1  *****************
 */</font>

<font color="0000ff"><strong>#include <font color="#008000">&quot;os_main.h&quot;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;common.h&gt;</font></strong></font>

<font color="#444444">/* Declare the Project's Global App Pointer */</font>
<font color="#2040a0">AVDAPP</font> <font color="4444FF">*</font><font color="#2040a0">PApp</font> <font color="4444FF">=</font> <font color="#2040a0">AVD_NULL</font><font color="4444FF">;</font>

<strong>int</strong> <font color="#2040a0">main</font><font color="4444FF">(</font><strong>int</strong> <font color="#2040a0">argc</font>, <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">argv</font><font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
    <strong>char</strong>               <font color="#2040a0">sErrorString</font><font color="4444FF">[</font><font color="#FF0000">160</font><font color="4444FF">]</font><font color="4444FF">;</font>
    <strong>int</strong>                <font color="#2040a0">nOpenArg1</font>          <font color="4444FF">=</font> <font color="#2040a0">AVD_NULL</font><font color="4444FF">;</font>
    <font color="#2040a0">AVD_ERRORCODE</font>      <font color="#2040a0">Results</font>            <font color="4444FF">=</font> <font color="#2040a0">AVDERR_NOERROR</font><font color="4444FF">;</font>
    <font color="#2040a0">AVDAPP</font>             <font color="4444FF">*</font><font color="#2040a0">pApp</font>              <font color="4444FF">=</font> <font color="#2040a0">AVD_NULL</font><font color="4444FF">;</font>

    <font color="#444444">/*
     * Initialize (Create) the Project App Object
     */</font>
    <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVD_NULL</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">pApp</font> <font color="4444FF">=</font> <font color="#2040a0">AVD_InitApp</font><font color="4444FF">(</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">)</font>
    <font color="4444FF"><strong>{</strong></font>
        <font color="#2040a0">PApp</font> <font color="4444FF">=</font> <font color="#2040a0">pApp</font><font color="4444FF">;</font> <font color="#444444">/* Assign the Global AVDAPP pointer */</font>
        <font color="#444444">/*
         * Parse the Cmd Args List &amp; update Config as Needed
         */</font>
        <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVDERR_NOERROR</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVD_InitArgs</font><font color="4444FF">(</font><font color="#2040a0">pApp</font>,<font color="#2040a0">argc</font>,<font color="#2040a0">argv</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">)</font>
        <font color="4444FF"><strong>{</strong></font>
            <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVD_TRUE</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">pApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oApp</font>.<font color="#2040a0">bHelpRequest</font> <font color="4444FF">)</font>
            <font color="4444FF"><strong>{</strong></font>
                <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_HELPREQUEST</font><font color="4444FF">;</font>
            <font color="4444FF"><strong>}</strong></font>
            <strong>else</strong> <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVD_TRUE</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">pApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oApp</font>.<font color="#2040a0">bVersionRequest</font> <font color="4444FF">)</font>
            <font color="4444FF"><strong>{</strong></font>
                <font color="#2040a0">snprintf</font><font color="4444FF">(</font><font color="#2040a0">sErrorString</font>,<strong>sizeof</strong><font color="4444FF">(</font><font color="#2040a0">sErrorString</font><font color="4444FF">)</font>,<font color="#008000">&quot;%s version: %s  Build date: %s %s&quot;</font>,<font color="#2040a0">PRODUCT_NAME</font>,<font color="#2040a0">PRODUCT_VER</font>,<font color="#2040a0">__DATE__</font>,<font color="#2040a0">__TIME__</font><font color="4444FF">)</font><font color="4444FF">;</font>
                <font color="#2040a0">os_OutputString</font><font color="4444FF">(</font><font color="#2040a0">pApp</font>,<font color="4444FF">(</font><strong>char</strong> <font color="4444FF">*</font><font color="4444FF">)</font><font color="#2040a0">sErrorString</font><font color="4444FF">)</font><font color="4444FF">;</font>
                <font color="#2040a0">os_OutputString</font><font color="4444FF">(</font><font color="#2040a0">pApp</font>,<font color="4444FF">(</font><strong>char</strong> <font color="4444FF">*</font><font color="4444FF">)</font><font color="#2040a0">PRODUCT_DESCRIPTION</font><font color="4444FF">)</font><font color="4444FF">;</font>
                <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_VERSIONREQUEST</font><font color="4444FF">;</font>
            <font color="4444FF"><strong>}</strong></font>
            <strong>else</strong>
            <font color="4444FF"><strong>{</strong></font>
                <font color="#444444">/*
                 * Check for required arguments
                 */</font>
                <font color="#444444">/* Results = AVDERR_ARGREQUIRED; */</font>
                <font color="#444444">/* Add any must have (required) argument tests here */</font>
                <font color="#444444">/*
                 * OS Specific startup &amp; Initialization code
                 */</font>
                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVDERR_NOERROR</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">os_Init</font><font color="4444FF">(</font><font color="4444FF">&amp;</font><font color="#2040a0">pApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oOSApp</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">)</font>
                <font color="4444FF"><strong>{</strong></font>
                    <font color="#444444">/* Create GUI (Main App Window) */</font>
                    <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVDERR_NOERROR</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">os_CreateGUI</font><font color="4444FF">(</font><font color="4444FF">&amp;</font><font color="#2040a0">pApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oOSApp</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">)</font>
                    <font color="4444FF"><strong>{</strong></font>
                        <font color="#444444">/*
                         * Jump into Project's common code engine!!!
                         */</font>
                        <font color="#2040a0">pApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oApp</font>.<font color="#2040a0">bRunning</font> <font color="4444FF">=</font> <font color="#2040a0">AVD_TRUE</font><font color="4444FF">;</font> <font color="#444444">/* Set Run State to TRUE */</font>
                        <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVD_Main</font><font color="4444FF">(</font><font color="#2040a0">pApp</font><font color="4444FF">)</font><font color="4444FF">;</font>       <font color="#444444">/* Jump into main engine */</font>
                    <font color="4444FF"><strong>}</strong></font>
                <font color="4444FF"><strong>}</strong></font>
            <font color="4444FF"><strong>}</strong></font>
        <font color="4444FF"><strong>}</strong></font>
        <font color="#444444">/* Check if Usage needs to be output */</font>
        <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVDERR_NOERROR</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">Results</font> <font color="4444FF">)</font>
        <font color="4444FF"><strong>{</strong></font>
            <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVDERR_VERSIONREQUEST</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">Results</font> <font color="4444FF">)</font>
            <font color="4444FF"><strong>{</strong></font>
                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">AVDERR_ALREADYRUNNING</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">Results</font> <font color="4444FF">)</font>
                <font color="4444FF"><strong>{</strong></font>
                    <font color="#444444">/* Invoke Usage dump with an Additional OS Specific Msg */</font>
                    <font color="#2040a0">AVD_Usage</font><font color="4444FF">(</font><font color="#2040a0">pApp</font>,<font color="4444FF">(</font><strong>char</strong> <font color="4444FF">*</font><font color="4444FF">)</font><font color="#2040a0">os_ReturnErrorMsg</font><font color="4444FF">(</font><font color="#2040a0">sErrorString</font>,<strong>sizeof</strong><font color="4444FF">(</font><font color="#2040a0">sErrorString</font><font color="4444FF">)</font>,<font color="#2040a0">Results</font><font color="4444FF">)</font><font color="4444FF">)</font><font color="4444FF">;</font>
                <font color="4444FF"><strong>}</strong></font>
            <font color="4444FF"><strong>}</strong></font>
        <font color="4444FF"><strong>}</strong></font>

        <font color="#444444">/*
         * Dispose App Object and all associated Objects
         */</font>
        <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVD_DisposeApp</font><font color="4444FF">(</font><font color="#2040a0">pApp</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>
    <strong>else</strong>
    <font color="4444FF"><strong>{</strong></font>
        <font color="#2040a0">snprintf</font><font color="4444FF">(</font><font color="#2040a0">sErrorString</font>,<strong>sizeof</strong><font color="4444FF">(</font><font color="#2040a0">sErrorString</font><font color="4444FF">)</font>,<font color="#008000">&quot;%s Error: Failed to Setup NO Memory!&quot;</font>,<font color="#2040a0">PRODUCT_NAME</font><font color="4444FF">)</font><font color="4444FF">;</font>
        <font color="#2040a0">os_OutputString</font><font color="4444FF">(</font><font color="#2040a0">AVD_NULL</font>,<font color="#2040a0">sErrorString</font><font color="4444FF">)</font><font color="4444FF">;</font>
        <font color="#444444">/* App Failed to setup - No Memory?!? */</font>
        <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_INITAPPFAILED</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>

    <font color="#2040a0">exit</font><font color="4444FF">(</font> <font color="#2040a0">Results</font> <font color="4444FF">)</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>
</pre>
<hr>
syntax highlighted by <a href="http://www.palfrader.org/code2html">Code2HTML</a>, v. 0.9.1
</body>
</html>
