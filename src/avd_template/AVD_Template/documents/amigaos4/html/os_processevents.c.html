<html>
<head>
  <title>../../../amigaos4/source/functions/os_processevents.c</title>
</head>
<body bgcolor="#ffffff" text="#000000">
<pre>
<font color="#444444">/*
 *---------------------------------------------------------------------
 * Original Author: Jamie Krueger
 * Creation Date  : 9/25/2003
 *---------------------------------------------------------------------
 * Copyright (c) 2003 BITbyBIT Software Group, All Rights Reserved.
 *
 * This software is the confidential and proprietary information of
 * BITbyBIT Software Group (Confidential Information).  You shall not
 * disclose such Confidential Information and shall use it only in
 * accordance with the terms of the license agreement you entered into
 * with BITbyBIT Software Group.
 *
 * BITbyBIT SOFTWARE GROUP MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE
 * SUITABILITY OF THE SOFTWARE, EITHER EXPRESS OR IMPLIED, INCLUDING
 * FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. 
 * BITbyBIT Software Group LLC SHALL NOT BE LIABLE FOR ANY DAMAGES SUFFERED BY
 * LICENSEE AS A RESULT OF USING, MODIFYING OR DISTRIBUTING THIS
 * SOFTWARE OR ITS DERIVATIVES.
 *---------------------------------------------------------------------
 *
 *  Template Application for writing AVD aware software
 *
 *  Function Name: os_ProcessEvents()
 *
 *  Project: AVD_Template
 *
 *  Description: Handles all event messages until &quot;quit&quot; is indicated
 *
 *  Entry Values: pOSApp = Pointer to the OS Specific structure
 *
 *  Exit Values: AVD_ERRORCODE (if any)
 *
 * $VER: $
 * $History: os_processevents.c $
 * 
 * *****************  Version 1  *****************
 */</font>

<font color="#444444">/* Include Operating Specific Functions header file */</font>
<font color="0000ff"><strong>#include <font color="#008000">&quot;os_functions.h&quot;</font></strong></font>

<font color="#2040a0">AVD_ERRORCODE</font> <font color="#2040a0">os_ProcessEvents</font><font color="4444FF">(</font><font color="#2040a0">OSAPP</font> <font color="4444FF">*</font><font color="#2040a0">pOSApp</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
    <strong>struct</strong> <font color="#2040a0">AVD_WindowHandle</font> <font color="4444FF">*</font><font color="#2040a0">pWindowHandle</font> <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
    <strong>struct</strong> <font color="#2040a0">List</font>             <font color="4444FF">*</font><font color="#2040a0">pWindowList</font>   <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
    <strong>struct</strong> <font color="#2040a0">Node</font>             <font color="4444FF">*</font><font color="#2040a0">pNextNode</font>     <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
    <font color="#2040a0">uint32</font>                  <font color="#2040a0">sigcxmask</font>      <font color="4444FF">=</font> <font color="#FF0000">0</font><font color="4444FF">;</font>
    <font color="#2040a0">uint32</font>                  <font color="#2040a0">siggot</font>         <font color="4444FF">=</font> <font color="#FF0000">0</font><font color="4444FF">;</font>
    <font color="#2040a0">CxMsg</font>                   <font color="4444FF">*</font><font color="#2040a0">CXMsg</font>         <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
    <font color="#2040a0">uint32</font>                  <font color="#2040a0">nMsgID</font>         <font color="4444FF">=</font> <font color="#FF0000">0</font><font color="4444FF">;</font>
    <font color="#2040a0">uint32</font>                  <font color="#2040a0">nMsgType</font>       <font color="4444FF">=</font> <font color="#FF0000">0</font><font color="4444FF">;</font>
    <font color="#2040a0">uint32</font>                  <font color="#2040a0">result</font>         <font color="4444FF">=</font> <font color="#FF0000">0</font><font color="4444FF">;</font>
    <font color="#2040a0">uint32</font>                  <font color="#2040a0">code</font>           <font color="4444FF">=</font> <font color="#FF0000">0</font><font color="4444FF">;</font>
    <font color="#2040a0">uint32</font>                  <font color="#2040a0">nQualifier</font>     <font color="4444FF">=</font> <font color="#FF0000">0</font><font color="4444FF">;</font>
    <font color="#2040a0">BOOL</font>                    <font color="#2040a0">done</font>           <font color="4444FF">=</font> <font color="#2040a0">FALSE</font><font color="4444FF">;</font>
    <font color="#2040a0">AVD_ERRORCODE</font>           <font color="#2040a0">Results</font>        <font color="4444FF">=</font> <font color="#2040a0">AVDERR_NOERROR</font><font color="4444FF">;</font>

    <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pOSApp</font> <font color="4444FF">)</font>
    <font color="4444FF"><strong>{</strong></font>
        <strong>if</strong> <font color="4444FF">(</font> <font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pCxMsgPort</font><font color="4444FF">)</font> <font color="4444FF">&amp;</font><font color="4444FF">&amp;</font> <font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pMsgPort</font><font color="4444FF">)</font> <font color="4444FF">)</font>
        <font color="4444FF"><strong>{</strong></font>
            <font color="#444444">/* Make sure we have a valid pointer to the List of Window (struct AVD_WindowHandle) nodes */</font>
            <font color="#2040a0">pWindowList</font> <font color="4444FF">=</font> <font color="4444FF">&amp;</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oWindowList</font><font color="4444FF">;</font>
            <strong>if</strong> <font color="4444FF">(</font> <font color="#FF0000">0</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">pWindowList</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">lh_TailPred</font> <font color="4444FF">)</font> <font color="#2040a0">IExec</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">NewList</font><font color="4444FF">(</font><font color="#2040a0">pWindowList</font><font color="4444FF">)</font><font color="4444FF">;</font>

            <font color="#444444">/* Get the CxBroker's signal mask */</font>
            <font color="#2040a0">sigcxmask</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#FF0000">1L</font> <font color="4444FF">&lt;</font><font color="4444FF">&lt;</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pCxMsgPort</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">mp_SigBit</font><font color="4444FF">)</font><font color="4444FF">;</font>

            <strong>while</strong><font color="4444FF">(</font> <font color="4444FF">!</font><font color="#2040a0">done</font> <font color="4444FF">)</font>
            <font color="4444FF"><strong>{</strong></font>
                <font color="#444444">/*
                 * Get ALL the signal masks for all Window Objects.
                 * This must be done each time through to pick up new windows being opened,
                 * or drop ones that have been closed.
                 */</font>
                <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">sigwinmask</font> <font color="4444FF">=</font> <font color="#2040a0">os_ReturnAllSigmasks</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font>,<font color="#2040a0">pWindowList</font><font color="4444FF">)</font><font color="4444FF">;</font>

                <font color="#2040a0">siggot</font> <font color="4444FF">=</font> <font color="#2040a0">IExec</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">Wait</font><font color="4444FF">(</font><font color="#2040a0">sigcxmask</font> <font color="4444FF">|</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">sigwinmask</font> <font color="4444FF">|</font> <font color="#2040a0">SIGBREAKF_CTRL_C</font><font color="4444FF">)</font><font color="4444FF">;</font>
                <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">siggot</font> <font color="4444FF">&amp;</font> <font color="#2040a0">SIGBREAKF_CTRL_C</font><font color="4444FF">)</font> <font color="#2040a0">done</font> <font color="4444FF">=</font> <font color="#2040a0">TRUE</font><font color="4444FF">;</font>

                <font color="#444444">/*
                 * Scan through all the AVD Window Handle nodes in the list,
                 * and process the events from each window object.
                 */</font>
                <font color="#444444">/* If we got a signal for the ReAction Window Object, then handle it's Input Msgs */</font>
                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">siggot</font> <font color="4444FF">&amp;</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">sigwinmask</font> <font color="4444FF">)</font>
                <font color="4444FF"><strong>{</strong></font>
                    <strong>if</strong> <font color="4444FF">(</font> <font color="4444FF">!</font><font color="#2040a0">IsListEmpty</font><font color="4444FF">(</font><font color="#2040a0">pWindowList</font><font color="4444FF">)</font> <font color="4444FF">)</font>
                    <font color="4444FF"><strong>{</strong></font>
                        <strong>for</strong><font color="4444FF">(</font> <font color="#2040a0">pNextNode</font> <font color="4444FF">=</font> <font color="#2040a0">pWindowList</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">lh_Head</font><font color="4444FF">;</font> <font color="#2040a0">pNextNode</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ln_Succ</font><font color="4444FF">;</font> <font color="#2040a0">pNextNode</font> <font color="4444FF">=</font> <font color="#2040a0">pNextNode</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ln_Succ</font> <font color="4444FF">)</font>
                        <font color="4444FF"><strong>{</strong></font>
                            <font color="#2040a0">pWindowHandle</font> <font color="4444FF">=</font> <font color="4444FF">(</font><strong>struct</strong> <font color="#2040a0">AVD_WindowHandle</font> <font color="4444FF">*</font><font color="4444FF">)</font><font color="#2040a0">pNextNode</font><font color="4444FF">;</font>
                            <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font> <font color="4444FF">)</font>
                            <font color="4444FF"><strong>{</strong></font>
                                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">NULL</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_Window</font> <font color="4444FF">)</font>
                                <font color="4444FF"><strong>{</strong></font>
                                    <font color="#444444">/* The window is not open yet, so just look for Open/Uniconify messages */</font>
                                    <strong>while</strong><font color="4444FF">(</font> <font color="4444FF">(</font><font color="#2040a0">result</font> <font color="4444FF">=</font> <font color="#2040a0">RA_HandleInput</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="4444FF">&amp;</font><font color="#2040a0">code</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">)</font>
                                    <font color="4444FF"><strong>{</strong></font>
                                        <strong>switch</strong><font color="4444FF">(</font> <font color="#2040a0">result</font> <font color="4444FF">&amp;</font> <font color="#2040a0">WMHI_CLASSMASK</font> <font color="4444FF">)</font>
                                        <font color="4444FF"><strong>{</strong></font>
                                            <strong>case</strong> <font color="#2040a0">WMHI_UNICONIFY</font><font color="4444FF">:</font>
                                                <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;You hit UNICONIFY!&quot;</font><font color="4444FF">)</font>
                                                <font color="#2040a0">os_DisplayGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                            <strong>break</strong><font color="4444FF">;</font>
                                        <font color="4444FF"><strong>}</strong></font>
                                    <font color="4444FF"><strong>}</strong></font><font color="4444FF">;</font> <font color="#444444">/* While RA_HandleInput */</font>
                                <font color="4444FF"><strong>}</strong></font>
                                <strong>else</strong>
                                <font color="4444FF"><strong>{</strong></font>
                                    <font color="#444444">/* Next Process the events sent to our Window's MsgPort */</font>
                                    <strong>while</strong><font color="4444FF">(</font> <font color="4444FF">(</font><font color="#2040a0">result</font> <font color="4444FF">=</font> <font color="#2040a0">RA_HandleInput</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="4444FF">&amp;</font><font color="#2040a0">code</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">)</font>
                                    <font color="4444FF"><strong>{</strong></font>
                                        <strong>switch</strong><font color="4444FF">(</font> <font color="#2040a0">result</font> <font color="4444FF">&amp;</font> <font color="#2040a0">WMHI_CLASSMASK</font> <font color="4444FF">)</font>
                                        <font color="4444FF"><strong>{</strong></font>
                                            <strong>case</strong> <font color="#2040a0">WMHI_CLOSEWINDOW</font><font color="4444FF">:</font>
                                                <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Close Gadget Hit: Hiding Window...&quot;</font><font color="4444FF">)</font>
                                                <font color="#2040a0">os_HideGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font>,<font color="#2040a0">HIDE_ALL_WINDOWS</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                            <strong>break</strong><font color="4444FF">;</font>

                                            <strong>case</strong> <font color="#2040a0">WMHI_MENUPICK</font><font color="4444FF">:</font>
                                                <strong>switch</strong><font color="4444FF">(</font> <font color="#2040a0">result</font> <font color="4444FF">&amp;</font> <font color="#2040a0">MENUID_MASK</font> <font color="4444FF">)</font>
                                                <font color="4444FF"><strong>{</strong></font>
                                                    <strong>case</strong> <font color="#2040a0">MENUID_HIDE</font><font color="4444FF">:</font>
                                                        <font color="#2040a0">os_HideGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font>,<font color="#2040a0">HIDE_ALL_WINDOWS</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                    <strong>break</strong><font color="4444FF">;</font>

                                                    <strong>case</strong> <font color="#2040a0">MENUID_ICONIFY</font><font color="4444FF">:</font>
                                                        <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;You hit ICONIFY!&quot;</font><font color="4444FF">)</font>
                                                        <font color="#2040a0">os_HideGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font>,<font color="#2040a0">ICONIFY_ALL_WINDOWS</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                    <strong>break</strong><font color="4444FF">;</font>

                                                    <strong>case</strong> <font color="#2040a0">MENUID_ABOUT</font><font color="4444FF">:</font>
                                                    <strong>break</strong><font color="4444FF">;</font>

                                                    <strong>case</strong> <font color="#2040a0">MENUID_QUIT</font><font color="4444FF">:</font>
                                                        <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Bye Bye now... :^)<font color="#77dd77">\n</font>&quot;</font><font color="4444FF">)</font>
                                                        <font color="#2040a0">done</font> <font color="4444FF">=</font> <font color="#2040a0">TRUE</font><font color="4444FF">;</font>
                                                    <strong>break</strong><font color="4444FF">;</font>

                                                    <strong>case</strong> <font color="#2040a0">MENUID_SNAPSHOT</font><font color="4444FF">:</font>
                                                    <strong>break</strong><font color="4444FF">;</font>

                                                    <strong>case</strong> <font color="#2040a0">MENUID_CENTER</font><font color="4444FF">:</font>
                                                        <font color="#444444">/* Turn on the Centering Flag, and refresh the window */</font>
                                                        <font color="#2040a0">os_HideGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font>,<font color="#2040a0">CENTER_MAIN_WINDOW</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                        <font color="#2040a0">os_DisplayGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                    <strong>break</strong><font color="4444FF">;</font>

                                                    <strong>case</strong> <font color="#2040a0">MENUID_ZOOMZIP</font><font color="4444FF">:</font>
                                                        <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ZipWindow</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_Window</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                    <strong>break</strong><font color="4444FF">;</font>

                                                    <strong>default</strong><font color="4444FF">:</font>
                                                    <strong>break</strong><font color="4444FF">;</font>
                                                <font color="4444FF"><strong>}</strong></font>
                                            <strong>break</strong><font color="4444FF">;</font>

                                            <strong>case</strong> <font color="#2040a0">WMHI_GADGETUP</font><font color="4444FF">:</font>
                                                <strong>switch</strong><font color="4444FF">(</font> <font color="#2040a0">result</font> <font color="4444FF">&amp;</font> <font color="#2040a0">WMHI_GADGETMASK</font> <font color="4444FF">)</font>
                                                <font color="4444FF"><strong>{</strong></font>
<font color="#444444">/*AVD_START_HERE
 *********** AVD RESERVED SECTION FOR AUTO-GENERATED SOURCE CODE ***********
 * This section of the file is automatically read and updated at build time,
 * do not make any changes or add anything between here and the 'AVD_END_HERE'
 * header, or the end of this file if no 'END'ing header is found.
 ************************* DO NOT EDIT THIS HEADER *************************
 */</font>
                                                    <strong>case</strong> <font color="#2040a0">OBJ3_BUTTON</font><font color="4444FF">:</font>
                                                        <font color="#2040a0">puts</font><font color="4444FF">(</font><font color="#008000">&quot;You Hit BUTTON Object[0x3]&quot;</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                    <strong>break</strong><font color="4444FF">;</font>
                                                    <strong>case</strong> <font color="#2040a0">OBJ5_BUTTON</font><font color="4444FF">:</font>
                                                        <font color="#2040a0">puts</font><font color="4444FF">(</font><font color="#008000">&quot;You Hit BUTTON Object[0x5]&quot;</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                    <strong>break</strong><font color="4444FF">;</font>
                                                    <strong>case</strong> <font color="#2040a0">OBJ6_BUTTON</font><font color="4444FF">:</font>
                                                        <font color="#2040a0">puts</font><font color="4444FF">(</font><font color="#008000">&quot;You Hit BUTTON Object[0x6]&quot;</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                        <font color="#2040a0">done</font> <font color="4444FF">=</font> <font color="#2040a0">TRUE</font><font color="4444FF">;</font>
                                                    <strong>break</strong><font color="4444FF">;</font>
<font color="#444444">/*
 *********** AVD RESERVED SECTION FOR AUTO-GENERATED SOURCE CODE ***********
 * This completes this reserved section of the file.
 * You are free to modify or add any custom code from this point.
 ************************* DO NOT EDIT THIS HEADER *************************
 AVD_END_HERE*/</font>
                                                    <strong>default</strong><font color="4444FF">:</font>
                                                    <strong>break</strong><font color="4444FF">;</font>
                                                <font color="4444FF"><strong>}</strong></font>
                                            <strong>break</strong><font color="4444FF">;</font>

                                            <strong>case</strong> <font color="#2040a0">WMHI_GADGETHELP</font><font color="4444FF">:</font>
                                                <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got a WMHI_GADGETHELP Message...&quot;</font><font color="4444FF">)</font>
                                            <strong>break</strong><font color="4444FF">;</font>

                                            <strong>case</strong> <font color="#2040a0">WMHI_MOUSEBUTTONS</font><font color="4444FF">:</font>
                                                <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got a WMHI_MOUSEBUTTONS Message...&quot;</font><font color="4444FF">)</font>
                                            <strong>break</strong><font color="4444FF">;</font>

                                            <strong>case</strong> <font color="#2040a0">WMHI_VANILLAKEY</font><font color="4444FF">:</font>
                                                <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got a WMHI_VANILLAKEY Message...&quot;</font><font color="4444FF">)</font>
                                            <strong>break</strong><font color="4444FF">;</font>

                                            <strong>case</strong> <font color="#2040a0">WMHI_ICONIFY</font><font color="4444FF">:</font>
                                                <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;You hit ICONIFY!&quot;</font><font color="4444FF">)</font>
                                                <font color="#2040a0">os_HideGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font>,<font color="#2040a0">ICONIFY_ALL_WINDOWS</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                            <strong>break</strong><font color="4444FF">;</font>

                                            <strong>case</strong> <font color="#2040a0">WMHI_UNICONIFY</font><font color="4444FF">:</font>
                                                <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;You hit UNICONIFY!&quot;</font><font color="4444FF">)</font>
                                                <font color="#2040a0">os_DisplayGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                            <strong>break</strong><font color="4444FF">;</font>

                                            <strong>case</strong> <font color="#2040a0">WMHI_RAWKEY</font><font color="4444FF">:</font>
                                                <font color="#444444">/* Check for Hide Key */</font>
                                                <strong>if</strong> <font color="4444FF">(</font> <font color="4444FF">(</font><font color="4444FF">(</font><font color="#2040a0">result</font> <font color="4444FF">&amp;</font> <font color="#2040a0">WMHI_KEYMASK</font><font color="4444FF">)</font> <font color="4444FF">&amp;</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oHideKey</font>.<font color="#2040a0">ix_CodeMask</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oHideKey</font>.<font color="#2040a0">ix_Code</font> <font color="4444FF">)</font>
                                                <font color="4444FF"><strong>{</strong></font>
                                                    <font color="#444444">/* Fetch the current WINDOW_Qualifier key */</font>
                                                    <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">GetAttr</font><font color="4444FF">(</font><font color="#2040a0">WINDOW_Qualifier</font>,<font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="4444FF">(</font><font color="#2040a0">ULONG</font> <font color="4444FF">*</font><font color="4444FF">)</font><font color="4444FF">&amp;</font><font color="#2040a0">nQualifier</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                    <font color="#2040a0">DEBUG_MSG</font><font color="4444FF">(</font><font color="#008000">&quot;WMHI_RAWKEY Message with IEQUALIFIER_0x%lx&quot;</font>,<font color="#2040a0">nQualifier</font><font color="4444FF">)</font>

                                                    <strong>if</strong> <font color="4444FF">(</font> <font color="4444FF">(</font><font color="#2040a0">nQualifier</font> <font color="4444FF">&amp;</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oHideKey</font>.<font color="#2040a0">ix_QualMask</font><font color="4444FF">)</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oHideKey</font>.<font color="#2040a0">ix_Qualifier</font> <font color="4444FF">)</font>
                                                    <font color="4444FF"><strong>{</strong></font>
                                                        <font color="#2040a0">DEBUG_MSG</font><font color="4444FF">(</font><font color="#008000">&quot;HideKey Hit(0x%x:0x%x): Hiding Window...&quot;</font>,<font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oHideKey</font>.<font color="#2040a0">ix_Code</font>,<font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oHideKey</font>.<font color="#2040a0">ix_Qualifier</font><font color="4444FF">)</font>
                                                        <font color="#2040a0">os_HideGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font>,<font color="#2040a0">HIDE_ALL_WINDOWS</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                                    <font color="4444FF"><strong>}</strong></font>
                                                <font color="4444FF"><strong>}</strong></font>
                                            <strong>break</strong><font color="4444FF">;</font>
                                    
                                            <strong>default</strong><font color="4444FF">:</font>
                                                //<font color="#2040a0">DEBUG_MSG</font><font color="4444FF">(</font><font color="#008000">&quot;Got unhandled Event:0x%x<font color="#77dd77">\n</font>&quot;</font>,<font color="4444FF">(</font><font color="#2040a0">result</font> <font color="4444FF">&amp;</font> <font color="#2040a0">WMHI_CLASSMASK</font><font color="4444FF">)</font><font color="4444FF">)</font>
                                            <strong>break</strong><font color="4444FF">;</font>
                                        <font color="4444FF"><strong>}</strong></font>
                                    <font color="4444FF"><strong>}</strong></font><font color="4444FF">;</font> <font color="#444444">/* While RA_HandleInput */</font>
                                <font color="4444FF"><strong>}</strong></font>
                            <font color="4444FF"><strong>}</strong></font> <font color="#444444">/* If sigwinmask */</font>
                        <font color="4444FF"><strong>}</strong></font>
                    <font color="4444FF"><strong>}</strong></font>
                <font color="4444FF"><strong>}</strong></font>

                <font color="#444444">/*
                 * If we got a signal for the CxBroker, then process the CxMsgs
                 */</font>
                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">siggot</font> <font color="4444FF">&amp;</font> <font color="#2040a0">sigcxmask</font> <font color="4444FF">)</font>
                <font color="4444FF"><strong>{</strong></font>
                    <font color="#444444">/* First process all CxMsgs from our Broker's MsgPort */</font>
                    <strong>while</strong><font color="4444FF">(</font> <font color="#2040a0">CXMsg</font> <font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">CxMsg</font> <font color="4444FF">*</font><font color="4444FF">)</font><font color="#2040a0">IExec</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">GetMsg</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pCxMsgPort</font><font color="4444FF">)</font> <font color="4444FF">)</font>
                    <font color="4444FF"><strong>{</strong></font>
                        <font color="#444444">/* Make a copy of everything we need from the Msg and reply as quickly as possible */</font>
                        <font color="#2040a0">nMsgID</font>   <font color="4444FF">=</font> <font color="#2040a0">ICommodities</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">CxMsgID</font><font color="4444FF">(</font><font color="#2040a0">CXMsg</font><font color="4444FF">)</font><font color="4444FF">;</font>
                        <font color="#2040a0">nMsgType</font> <font color="4444FF">=</font> <font color="#2040a0">ICommodities</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">CxMsgType</font><font color="4444FF">(</font><font color="#2040a0">CXMsg</font><font color="4444FF">)</font><font color="4444FF">;</font>
                        <font color="#2040a0">IExec</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ReplyMsg</font><font color="4444FF">(</font><font color="4444FF">(</font><strong>struct</strong> <font color="#2040a0">Message</font> <font color="4444FF">*</font><font color="4444FF">)</font><font color="#2040a0">CXMsg</font><font color="4444FF">)</font><font color="4444FF">;</font>

                        <strong>switch</strong><font color="4444FF">(</font> <font color="#2040a0">nMsgType</font> <font color="4444FF">)</font>
                        <font color="4444FF"><strong>{</strong></font>
                            <strong>case</strong> <font color="#2040a0">CXM_IEVENT</font><font color="4444FF">:</font>
                                <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got CXM_IEVENT...&quot;</font><font color="4444FF">)</font>
                                <strong>switch</strong><font color="4444FF">(</font> <font color="#2040a0">nMsgID</font> <font color="4444FF">)</font>
                                <font color="4444FF"><strong>{</strong></font>
                                    <strong>case</strong> <font color="#2040a0">EVT_HOTKEY</font><font color="4444FF">:</font>
                                        <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got EVT_HOTKEY&quot;</font><font color="4444FF">)</font>
                                        <font color="#2040a0">os_DisplayGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                    <strong>break</strong><font color="4444FF">;</font>
                                <font color="4444FF"><strong>}</strong></font>
                            <strong>break</strong><font color="4444FF">;</font>

                            <strong>case</strong> <font color="#2040a0">CXM_COMMAND</font><font color="4444FF">:</font>
                                <strong>switch</strong><font color="4444FF">(</font> <font color="#2040a0">nMsgID</font> <font color="4444FF">)</font>
                                <font color="4444FF"><strong>{</strong></font>
                                    <strong>case</strong> <font color="#2040a0">CXCMD_KILL</font><font color="4444FF">:</font>
                                        <font color="#2040a0">done</font> <font color="4444FF">=</font> <font color="#2040a0">TRUE</font><font color="4444FF">;</font>
                                    <strong>break</strong><font color="4444FF">;</font>

                                    <strong>case</strong> <font color="#2040a0">CXCMD_DISABLE</font><font color="4444FF">:</font>
                                        //<font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got CXCMD_DISABLE&quot;</font><font color="4444FF">)</font>
                                        //<font color="#2040a0">ICommodities</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ActivateCxObj</font><font color="4444FF">(</font><font color="#2040a0">pCxBroker</font>,<font color="#FF0000">0L</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                    <strong>break</strong><font color="4444FF">;</font>

                                    <strong>case</strong> <font color="#2040a0">CXCMD_ENABLE</font><font color="4444FF">:</font>
                                        //<font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got CXCMD_ENABLE&quot;</font><font color="4444FF">)</font>
                                        //<font color="#2040a0">ICommodities</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ActivateCxObj</font><font color="4444FF">(</font><font color="#2040a0">pCxBroker</font>,<font color="#FF0000">1L</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                    <strong>break</strong><font color="4444FF">;</font>

                                    <strong>case</strong> <font color="#2040a0">CXCMD_DISAPPEAR</font><font color="4444FF">:</font>
                                        <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got CXCMD_DISAPPEAR&quot;</font><font color="4444FF">)</font>
                                        <font color="#2040a0">os_HideGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font>,<font color="#2040a0">HIDE_ALL_WINDOWS</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                    <strong>break</strong><font color="4444FF">;</font>

                                    <strong>case</strong> <font color="#2040a0">CXCMD_UNIQUE</font><font color="4444FF">:</font>
                                        <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got CXCMD_UNIQUE, fallthrough to Appear...&quot;</font><font color="4444FF">)</font>
                                    <strong>case</strong> <font color="#2040a0">CXCMD_APPEAR</font><font color="4444FF">:</font>
                                        <font color="#2040a0">DEBUG_TEXT</font><font color="4444FF">(</font><font color="#008000">&quot;Got CXCMD_APPEAR&quot;</font><font color="4444FF">)</font>
                                        <font color="#2040a0">os_DisplayGUI</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                    <strong>break</strong><font color="4444FF">;</font>
                                <font color="4444FF"><strong>}</strong></font>
                            <strong>break</strong><font color="4444FF">;</font>
                        <font color="4444FF"><strong>}</strong></font>
                    <font color="4444FF"><strong>}</strong></font><font color="4444FF">;</font> <font color="#444444">/* While CXMsg */</font>
                <font color="4444FF"><strong>}</strong></font>
            <font color="4444FF"><strong>}</strong></font><font color="4444FF">;</font> <font color="#444444">/* While !done */</font>
        <font color="4444FF"><strong>}</strong></font>
    <font color="4444FF"><strong>}</strong></font>
    <strong>return</strong><font color="4444FF">(</font> <font color="4444FF">(</font><font color="#2040a0">AVD_ERRORCODE</font><font color="4444FF">)</font><font color="#2040a0">Results</font> <font color="4444FF">)</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>
</pre>
<hr>
syntax highlighted by <a href="http://www.palfrader.org/code2html">Code2HTML</a>, v. 0.9.1
</body>
</html>
