<html>
<head>
  <title>../../../amigaos4/source/os_init.c</title>
</head>
<body bgcolor="#ffffff" text="#000000">
<pre>
<font color="#444444">/*
 *---------------------------------------------------------------------
 * Original Author: Jamie Krueger
 * Creation Date  : 9/25/2003
 *---------------------------------------------------------------------
 * Copyright (c) 2003 BITbyBIT Software Group, All Rights Reserved.
 *
 * This software is the confidential and proprietary information of
 * BITbyBIT Software Group (Confidential Information).  You shall not
 * disclose such Confidential Information and shall use it only in
 * accordance with the terms of the license agreement you entered into
 * with BITbyBIT Software Group.
 *
 * BITbyBIT SOFTWARE GROUP MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE
 * SUITABILITY OF THE SOFTWARE, EITHER EXPRESS OR IMPLIED, INCLUDING
 * FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. 
 * BITbyBIT Software Group LLC SHALL NOT BE LIABLE FOR ANY DAMAGES SUFFERED BY
 * LICENSEE AS A RESULT OF USING, MODIFYING OR DISTRIBUTING THIS
 * SOFTWARE OR ITS DERIVATIVES.
 *---------------------------------------------------------------------
 *
 *  Template Application for writing AVD aware software
 *
 *  Function Name: os_Init()
 *
 *  Project: AVD_Template
 *
 *  Description: Sets up the OS Specific project (last stage)
 *
 *  Entry Values: pOSApp = Pointer to the OS Specific structure
 *
 *  Exit Values: AVD_ERRORCODE (if any)
 *
 * $VER: $
 * $History: os_init.c $
 * 
 * *****************  Version 1  *****************
 */</font>

<font color="0000ff"><strong>#include <font color="#008000">&quot;os_main.h&quot;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;common.h&gt;</font></strong></font>

<font color="#2040a0">AVD_ERRORCODE</font> <font color="#2040a0">os_Init</font><font color="4444FF">(</font> <font color="#2040a0">OSAPP</font> <font color="4444FF">*</font><font color="#2040a0">pOSApp</font> <font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
    <font color="#2040a0">AVD_ERRORCODE</font> <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_INITFAILED</font><font color="4444FF">;</font>
    <font color="#2040a0">CxMsg</font>         <font color="4444FF">*</font><font color="#2040a0">cxMsg</font>  <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>

    <font color="#444444">/* Attempt to open the Commodities Library and create our CxBroker */</font>
    <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pCxMsgPort</font> <font color="4444FF">=</font> <font color="#2040a0">IExec</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">CreateMsgPort</font><font color="4444FF">(</font><font color="4444FF">)</font> <font color="4444FF">)</font>
    <font color="4444FF"><strong>{</strong></font>
        <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oNewBroker</font>.<font color="#2040a0">nb_Port</font> <font color="4444FF">=</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pCxMsgPort</font><font color="4444FF">;</font>
        <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">broker</font> <font color="4444FF">=</font> <font color="#2040a0">ICommodities</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">CxBroker</font><font color="4444FF">(</font><font color="4444FF">&amp;</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oNewBroker</font>,<font color="4444FF">(</font><font color="#2040a0">LONG</font> <font color="4444FF">*</font><font color="4444FF">)</font><font color="#2040a0">NULL</font><font color="4444FF">)</font> <font color="4444FF">)</font>
        <font color="4444FF"><strong>{</strong></font>
            <font color="#444444">/* Setup the HotKey notification Filter */</font>
            <font color="#2040a0">DEBUG_MSG</font><font color="4444FF">(</font><font color="#008000">&quot;HOTKEY = %s<font color="#77dd77">\n</font>&quot;</font>,<font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pPopKey</font><font color="4444FF">)</font>
            <font color="#444444">/* Build the Window's title text adding the &quot;pop/hide&quot; keys */</font>
            <font color="#2040a0">snprintf</font><font color="4444FF">(</font><font color="4444FF">&amp;</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oWindowTitle</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font>,<strong>sizeof</strong><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oWindowTitle</font><font color="4444FF">)</font>,<font color="#008000">&quot;%s: PopKey = &lt;%s&gt; HideKey = &lt;%s&gt;<font color="#77dd77">\0</font>&quot;</font>,<font color="#2040a0">WINTITLE</font>,<font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pPopKey</font>,<font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pHideKey</font><font color="4444FF">)</font><font color="4444FF">;</font>
            <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">hotkey_filter</font> <font color="4444FF">=</font> <font color="#2040a0">HotKey</font><font color="4444FF">(</font><font color="4444FF">(</font><font color="#2040a0">CONST_STRPTR</font><font color="4444FF">)</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pPopKey</font>,<font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pCxMsgPort</font>,<font color="#2040a0">EVT_HOTKEY</font><font color="4444FF">)</font> <font color="4444FF">)</font>
            <font color="4444FF"><strong>{</strong></font>
                <font color="#444444">/* Successfully created the HotKey Triad, now attach it to our Broker */</font>
                <font color="#2040a0">ICommodities</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">AttachCxObj</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">broker</font>,<font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">hotkey_filter</font><font color="4444FF">)</font><font color="4444FF">;</font>
                <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">sWindowTitle</font> <font color="4444FF">=</font> <font color="4444FF">(</font><strong>char</strong> <font color="4444FF">*</font><font color="4444FF">)</font><font color="4444FF">&amp;</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oWindowTitle</font><font color="4444FF">[</font><font color="#FF0000">0</font><font color="4444FF">]</font><font color="4444FF">;</font>
            <font color="4444FF"><strong>}</strong></font>
            <font color="#444444">/* Successfully created the Commodity - Activate it and continue */</font>
            <font color="#2040a0">ICommodities</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ActivateCxObj</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">broker</font>,<font color="#FF0000">1L</font><font color="4444FF">)</font><font color="4444FF">;</font>

            <font color="#444444">/* Allocate a second MsgPort for the Main App Window */</font>
            <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">pMsgPort</font> <font color="4444FF">=</font> <font color="#2040a0">IExec</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">CreateMsgPort</font><font color="4444FF">(</font><font color="4444FF">)</font> <font color="4444FF">)</font>
            <font color="4444FF"><strong>{</strong></font>
                <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_NOERROR</font><font color="4444FF">;</font>
            <font color="4444FF"><strong>}</strong></font>
            <strong>else</strong>
            <font color="4444FF"><strong>{</strong></font>
                <font color="#444444">/* Failed to create the MsgPort for the Main App Window */</font>
                <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_RESOURCENOTFOUND</font><font color="4444FF">;</font>
            <font color="4444FF"><strong>}</strong></font>
        <font color="4444FF"><strong>}</strong></font>
        <strong>else</strong>
        <font color="4444FF"><strong>{</strong></font>
            <font color="#444444">/*
             * Failed to create the Commodity - There could be another copy already running, so quit out
             */</font>
            <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_ALREADYRUNNING</font><font color="4444FF">;</font>
        <font color="4444FF"><strong>}</strong></font>
    <font color="4444FF"><strong>}</strong></font>
    <strong>else</strong>
    <font color="4444FF"><strong>{</strong></font>
        <font color="#444444">/* Failed to create the MsgPort for the Commodity */</font>
        <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_RESOURCENOTFOUND</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>

    <strong>return</strong><font color="4444FF">(</font> <font color="4444FF">(</font><font color="#2040a0">AVD_ERRORCODE</font><font color="4444FF">)</font><font color="#2040a0">Results</font> <font color="4444FF">)</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>
</pre>
<hr>
syntax highlighted by <a href="http://www.palfrader.org/code2html">Code2HTML</a>, v. 0.9.1
</body>
</html>
