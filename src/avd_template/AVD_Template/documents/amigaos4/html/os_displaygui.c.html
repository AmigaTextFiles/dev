<html>
<head>
  <title>../../../amigaos4/source/functions/os_displaygui.c</title>
</head>
<body bgcolor="#ffffff" text="#000000">
<pre>
<font color="#444444">/*
 *---------------------------------------------------------------------
 * Original Author: Jamie Krueger
 * Creation Date  : 9/25/2003
 *---------------------------------------------------------------------
 * Copyright (c) 2003 BITbyBIT Software Group, All Rights Reserved.
 *
 * This software is the confidential and proprietary information of
 * BITbyBIT Software Group (Confidential Information).  You shall not
 * disclose such Confidential Information and shall use it only in
 * accordance with the terms of the license agreement you entered into
 * with BITbyBIT Software Group.
 *
 * BITbyBIT SOFTWARE GROUP MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE
 * SUITABILITY OF THE SOFTWARE, EITHER EXPRESS OR IMPLIED, INCLUDING
 * FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. 
 * BITbyBIT Software Group LLC SHALL NOT BE LIABLE FOR ANY DAMAGES SUFFERED BY
 * LICENSEE AS A RESULT OF USING, MODIFYING OR DISTRIBUTING THIS
 * SOFTWARE OR ITS DERIVATIVES.
 *---------------------------------------------------------------------
 *
 *  Template Application for writing AVD aware software
 *
 *  Function Name: os_DisplayGUI()
 *
 *  Project: AVD_Template
 *
 *  Description: Displays the GUI Interface for this Application
 *
 *  Entry Values: pOSApp = Pointer to the OS Specific structure
 *
 *  Exit Values: AVD_ERRORCODE (if any)
 *
 * $VER: $
 * $History: os_processevents.c $
 * 
 * *****************  Version 1  *****************
 */</font>

<font color="#444444">/* Include Operating Specific Functions header file */</font>
<font color="0000ff"><strong>#include <font color="#008000">&quot;os_functions.h&quot;</font></strong></font>

<font color="#2040a0">AVD_ERRORCODE</font> <font color="#2040a0">os_DisplayGUI</font><font color="4444FF">(</font><font color="#2040a0">OSAPP</font> <font color="4444FF">*</font><font color="#2040a0">pOSApp</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
    <strong>struct</strong> <font color="#2040a0">AVD_WindowHandle</font> <font color="4444FF">*</font><font color="#2040a0">pWindowHandle</font> <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
    <strong>struct</strong> <font color="#2040a0">List</font>             <font color="4444FF">*</font><font color="#2040a0">pList</font>         <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
    <strong>struct</strong> <font color="#2040a0">Node</font>             <font color="4444FF">*</font><font color="#2040a0">pNextNode</font>     <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
    <strong>struct</strong> <font color="#2040a0">Screen</font>           <font color="4444FF">*</font><font color="#2040a0">pPubScreen</font>    <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
    <font color="#2040a0">AVD_ERRORCODE</font>           <font color="#2040a0">Results</font>        <font color="4444FF">=</font> <font color="#2040a0">AVDERR_RESOURCENOTFOUND</font><font color="4444FF">;</font>

    <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pOSApp</font> <font color="4444FF">)</font>
    <font color="4444FF"><strong>{</strong></font>
        <font color="#444444">/* Show all the Windows in the list (if they have the open flag set) */</font>
        <font color="#2040a0">pList</font> <font color="4444FF">=</font> <font color="4444FF">&amp;</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">oWindowList</font><font color="4444FF">;</font>
        <strong>if</strong> <font color="4444FF">(</font> <font color="#FF0000">0</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">pList</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">lh_TailPred</font> <font color="4444FF">)</font>
        <font color="4444FF"><strong>{</strong></font>
            <strong>if</strong> <font color="4444FF">(</font> <font color="4444FF">!</font><font color="#2040a0">IsListEmpty</font><font color="4444FF">(</font><font color="#2040a0">pList</font><font color="4444FF">)</font> <font color="4444FF">)</font>
            <font color="4444FF"><strong>{</strong></font>
                <font color="#444444">/* If we have a lock on a screen already, use it */</font>
                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">screen</font> <font color="4444FF">)</font>
                <font color="4444FF"><strong>{</strong></font>
                    <font color="#2040a0">pPubScreen</font> <font color="4444FF">=</font> <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">screen</font><font color="4444FF">;</font>
                <font color="4444FF"><strong>}</strong></font>
                <strong>else</strong>
                <font color="4444FF"><strong>{</strong></font>
                    <font color="#444444">/* If we do not already have a screen lock, then try to get the specified one (by screen name) */</font>
                    <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">NULL</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">(</font><font color="#2040a0">pPubScreen</font> <font color="4444FF">=</font> <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">LockPubScreen</font><font color="4444FF">(</font><font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">sPubScreenName</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">)</font>
                    <font color="4444FF"><strong>{</strong></font>
                        <font color="#444444">/* If we can't get the intended Public Screen, then grab the default one */</font>
                        <font color="#2040a0">pPubScreen</font> <font color="4444FF">=</font> <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">LockPubScreen</font><font color="4444FF">(</font><font color="#2040a0">NULL</font><font color="4444FF">)</font><font color="4444FF">;</font>
                    <font color="4444FF"><strong>}</strong></font>
                    <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">screen</font> <font color="4444FF">=</font> <font color="#2040a0">pPubScreen</font><font color="4444FF">;</font> <font color="#444444">/* Update our screen pointer to keep in sync */</font>
                <font color="4444FF"><strong>}</strong></font>
                <font color="#444444">/*
                 * Scan through each AVD Window Handle node in the list,
                 * and open each window object we find.
                 */</font>
                <strong>for</strong><font color="4444FF">(</font> <font color="#2040a0">pNextNode</font> <font color="4444FF">=</font> <font color="#2040a0">pList</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">lh_Head</font><font color="4444FF">;</font> <font color="#2040a0">pNextNode</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ln_Succ</font><font color="4444FF">;</font> <font color="#2040a0">pNextNode</font> <font color="4444FF">=</font> <font color="#2040a0">pNextNode</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ln_Succ</font> <font color="4444FF">)</font>
                <font color="4444FF"><strong>{</strong></font>
                    <font color="#2040a0">pWindowHandle</font> <font color="4444FF">=</font> <font color="4444FF">(</font><strong>struct</strong> <font color="#2040a0">AVD_WindowHandle</font> <font color="4444FF">*</font><font color="4444FF">)</font><font color="#2040a0">pNextNode</font><font color="4444FF">;</font>
                    <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font> <font color="4444FF">)</font>
                    <font color="4444FF"><strong>{</strong></font>
                        <font color="#2040a0">DEBUG_MSG</font><font color="4444FF">(</font><font color="#008000">&quot;Considering opening Window Object[0x%lx]&quot;</font>,<font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font><font color="4444FF">)</font>
                        <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_Window</font> <font color="4444FF">)</font>
                        <font color="4444FF"><strong>{</strong></font>
                            <font color="#444444">/* If window already exists, just bring to front and return */</font>
                            <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">GetAttr</font><font color="4444FF">(</font><font color="#2040a0">WA_PubScreen</font>,<font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="4444FF">(</font><font color="#2040a0">ULONG</font> <font color="4444FF">*</font><font color="4444FF">)</font><font color="4444FF">&amp;</font><font color="#2040a0">pPubScreen</font><font color="4444FF">)</font><font color="4444FF">;</font>
                            <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pPubScreen</font> <font color="4444FF">)</font> <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ScreenToFront</font><font color="4444FF">(</font><font color="#2040a0">pPubScreen</font><font color="4444FF">)</font><font color="4444FF">;</font>
                            <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">SetAttrs</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="#2040a0">WINDOW_FrontBack</font>,<font color="#2040a0">WT_FRONT</font>,<font color="#2040a0">TAG_END</font><font color="4444FF">)</font><font color="4444FF">;</font>
                            <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">SetAttrs</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="#2040a0">WINDOW_Activate</font>,<font color="#2040a0">TRUE</font>,<font color="#2040a0">TAG_END</font><font color="4444FF">)</font><font color="4444FF">;</font>
                            <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_NOERROR</font><font color="4444FF">;</font>
                        <font color="4444FF"><strong>}</strong></font>
                        <strong>else</strong>
                        <font color="4444FF"><strong>{</strong></font>
                            <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">WHFLG_OPENONSTART</font> <font color="4444FF">&amp;</font> <font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_Flags</font> <font color="4444FF">)</font>
                            <font color="4444FF"><strong>{</strong></font>
                                <font color="#2040a0">DEBUG_MSG</font><font color="4444FF">(</font><font color="#008000">&quot;Attempting to Opening Window Object[0x%lx]&quot;</font>,<font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font><font color="4444FF">)</font>
                                <font color="#444444">/* Set the screen this window is to open on */</font>
                                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pPubScreen</font> <font color="4444FF">)</font>
                                <font color="4444FF"><strong>{</strong></font>
                                    <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">SetAttrs</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="#2040a0">WA_PubScreen</font>,<font color="#2040a0">pPubScreen</font>,<font color="#2040a0">TAG_END</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                    <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">ScreenToFront</font><font color="4444FF">(</font><font color="#2040a0">pPubScreen</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                <font color="4444FF"><strong>}</strong></font>
                                <font color="#444444">/* Restore the Window's last known Open position (WinSize) */</font>
                                <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">SetAttrs</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="#2040a0">WA_WindowBox</font>,<font color="4444FF">&amp;</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WindowSize</font>,<font color="#2040a0">TAG_END</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                <font color="#444444">/* Restore the Window's Zoom Size */</font>
                                <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">SetAttrs</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="#2040a0">WA_Zoom</font>,<font color="4444FF">&amp;</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_ZoomSize</font>,<font color="#2040a0">TAG_END</font><font color="4444FF">)</font><font color="4444FF">;</font>
                                <font color="#444444">/* Open the Window */</font>
                                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_Window</font> <font color="4444FF">=</font> <font color="#2040a0">RA_OpenWindow</font><font color="4444FF">(</font><font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font><font color="4444FF">)</font> <font color="4444FF">)</font>
                                <font color="4444FF"><strong>{</strong></font>
                                    <font color="#2040a0">DEBUG_MSG</font><font color="4444FF">(</font><font color="#008000">&quot;Window Object[0x%lx] Intuition Window[0x%lx] is now open!&quot;</font>,<font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_WinObj</font>,<font color="#2040a0">pWindowHandle</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">wh_Window</font><font color="4444FF">)</font>
                                    <font color="#2040a0">Results</font> <font color="4444FF">=</font> <font color="#2040a0">AVDERR_NOERROR</font><font color="4444FF">;</font> <font color="#444444">/* We return no error, if at least one window was opened */</font>
                                <font color="4444FF"><strong>}</strong></font>
                            <font color="4444FF"><strong>}</strong></font>
                        <font color="4444FF"><strong>}</strong></font>
                    <font color="4444FF"><strong>}</strong></font>
                <font color="4444FF"><strong>}</strong></font>
                <strong>if</strong> <font color="4444FF">(</font> <font color="#2040a0">pPubScreen</font> <font color="4444FF">)</font>
                <font color="4444FF"><strong>{</strong></font>
                    <font color="#444444">/* Unlock the Public Screen (Once our window is open we don't need to hang onto the Public Screen) */</font>
                    <font color="#2040a0">IIntuition</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">UnlockPubScreen</font><font color="4444FF">(</font><font color="#FF0000">0</font>,<font color="#2040a0">pPubScreen</font><font color="4444FF">)</font><font color="4444FF">;</font>
                    <font color="#444444">/* Clear the pointer to the screen as well, since we have released it */</font>
                    <font color="#2040a0">pOSApp</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">screen</font> <font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">;</font>
                <font color="4444FF"><strong>}</strong></font>
            <font color="4444FF"><strong>}</strong></font>
        <font color="4444FF"><strong>}</strong></font>
    <font color="4444FF"><strong>}</strong></font>
    <strong>return</strong><font color="4444FF">(</font> <font color="#2040a0">Results</font> <font color="4444FF">)</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>
</pre>
<hr>
syntax highlighted by <a href="http://www.palfrader.org/code2html">Code2HTML</a>, v. 0.9.1
</body>
</html>
