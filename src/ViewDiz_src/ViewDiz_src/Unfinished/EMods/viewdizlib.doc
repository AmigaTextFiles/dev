TABLE OF CONTENTS

viewdiz.library/--Author--
viewdiz.library/--Introduction--
viewdiz.library/--Usage--
viewdiz.library/vdStartup
viewdiz.library/vdFreeStartup
viewdiz.library/vdExamine
viewdiz.library/vdRunModule
viewdiz.library/vdEditFile
viewdiz.library/vdVersionInfo
viewdiz.library/vdLoadWizards
viewdiz.library/vdUnloadWizards
viewdiz.library/vdRunWizards

AUTHOR

   Mikael Lund
   Ægirsgade 66, 2. th.
   2200 Copenhagen N.
   Denmark

   lund@kiku.dk
   ki9656@unidhp.uni-c.dk

INTRODUCTION

   Viewdiz.library is a shared library that'll manipulate file descriptions
   in many different filetypes. This is mainly file_id.diz, but could
   be versioninfo or filetype-specific data.

   The core of the library is the so-called filetype-modules. These are
   separate files, that can handle specific filetypes. Modules can be
   AmigaDOS scripts or executables.
   Data about the modules are kept in the ENV:ViewDiz.config global
   variable.

USAGE

   First, the library must be installed correctly. That is, have it's
   own directory-assign and a global variable:

   1) Assign ViewDiz:
   2) Env:ViewDiz.config

   To use the library you should follow these steps:

   a) OpenLibrary('ViewDiz:Libs/viewdiz.library', .....)
   b)  vdStartUp()
   c)    vdAllocObject()
   d)      vdExamineFile(), vdRunModule(), vdEditFile(),,,
   e)      vdFreeObject()
   f)    vdFreeStartup()
   g)  CloseLibrary()

viewdiz.library/vdStartup

    NAME
  vdStartup -- Prepare viewdiz system

    SYNOPSIS
  vdConfig = vdStartup( templock )

    DESCRIPTION
  Constructs the vdConfig object which is the core of the viewdiz
  processing. Important information from Env:ViewDiz.config is examined,
  and should be the first call you make to the library. *MUST* be
  matched with a call to vdFreeStartup()

    INPUTS
  templock - A shared lock of the directory you wish to use for temporary
      files, including file descriptions.

    RESULT
  vdConfig - vdConfig object or zero if an error occured.

    NOTE
  Memory must be deallocated with a call to vdFreeStartup()

viewdiz.library/vdFreeStartup
    NAME
  vdFreeStartup -- Frees memory allocated by vdStartup() etc.

    SYNOPSIS
  void = vdFreeStartup( cfg )

    DESCRIPTION
  Frees memory allocated by vdStartup(). A possible filetype module
  cache will also be deallocated, so it's important you call this
  function before you closes the library.

    INPUTS
  cfg - vdConfig object returned by vdStartup()

viewdiz.library/vdExamine
    NAME
  vdExamine -- Examines a file

    SYNOPSIS
  bool = vdExamine( file, finf, cfg )

    DESCRIPTION
  Examines a file and tries to assign it to a filetype module. The
  result will be returned in a vdFileInfo object, which must be
  pre-allocated.

    INPUTS
  file - Filename of file to be examined.
  finf - vdFileInfo object allocated with vdAllocObject()
  cfg - vdConfig object returned by vdStartup()

    RESULT
  bool - Zero if an error occurs, -1 if ok.
  If the file is XPK-packed, a local variable 'xpkstatus' will be set
  to 1 - else zero. This is used by the external filetype-modules.

    NOTE
  Currently files are assigned to modules via patternmatching, but some
  filetypes are recognized regardless of their filename:

      lha,lzx,dms,xpk,thx,med,psid,ilbm,gif,jpg

viewdiz.library/vdRunModule
    NAME
  vdRunModule -- Runs an external filetype module.

    SYNOPSIS
  bool = vdRunModule( finf, command )

    DESCRIPTION
  Runs the module assigned to the parsed vdFileInfo object. The filetype
  modules accepts different commands, which does different things with the
  description/file.
  If possible the filetype-module will be kept in memory to speed up the
  following calls to vdRunModule(). Memory allocated for this cache will
  be freed when calling vdFreeStartup().

    INPUTS
  finf - vdFileInfo object allocated with vdAllocObject()
  command - Different commands are availble:

    VDCMD_READ    - Extracts description from file
    VDCMD_WRITE   - Write description to file
    VDCMD_DELETE  - Delete description from file
    VDCMD_EXECUTE - Perform an action on the file
    VDCMD_EDIT    - Start a special editor with the description
    VDCMD_INFO    - Retrieve info about the module

    RESULT
  bool - Zero of an error occurs, -1 if ok.

    NOTE
  Only executable filetype-modules will be kept in the module-cache.


viewdiz.library/vdEditFile
    NAME
  vdEditFile -- Edits a textfile

    SYNOPSIS
  bool = vdRunModule( filename, cfg )

    DESCRIPTION
  Open the texteditor specified in ENV:ViewDiz.config with the given
  file.

    INPUTS
  filename - Textfile to edit
  cfg - vdConfig object returned by vdStartup()

    RESULT
  bool - Zero of an error occurs, -1 if ok.

    NOTE
  Before editing file_id.diz, you should allways check if the module
  have got the 'E' flag set... If so it have got a special editor
  function which should be started with vdRunModule()

viewdiz.library/vdVersionInfo
    NAME
  vdVersionInfo -- Obtain version string ($VER:)

    SYNOPSIS
  bool = vdVersionInfo( finf )

    DESCRIPTION
  Uses C:Version to obtain versioninfo from file assigned to finf. The
  string will be put in the description-file specified in cfg.

    INPUTS
  finf - vdFileInfo object allocated with vdAllocObject()

    RESULT
  bool - Zero of an error occurs, -1 if ok.

    NOTE
  finf must contain the filename - usually done with vdExamine()

viewdiz.library/vdLoadWizards
    NAME
  vdLoadWizards -- Specify and prepare wizards

    SYNOPSIS
  number = vdLoadWizards( wizards, cfg )

    DESCRIPTION
  Specifies what wizards to run. If possible, the wizards will be pre-
  loaded. This function *MUST* be matched with a call to vdUnloadWizards().

    INPUTS
  wizards - string containing the wizards and their arguments. Each
    entry must be surrounded by double-quotes ("). If you need to use
    quotes inside an entry, use (*"). For example:

    '"Log" "Wrap WIDTH=45" "GuideList GUIDEFILE=*"My File*""'

  cfg - vdConfig object returned by vdStartup()

    RESULT
  number - Number of prepared wizards. Zero if error.

    NOTE
  Only executable Wizards will be preloaded.

viewdiz.library/vdUnloadWizards
    NAME
  vdUnloadWizards -- Free memory allocated with vdLoadWizards()

    SYNOPSIS
  void = vdUnloadWizards( cfg )

    DESCRIPTION
  Frees all memory allocated with vdLoadWizards - including a possible
  wizards cache.

    INPUTS
  cfg - vdConfig object returned by vdStartup()

    RESULT
  void

    NOTE
  Don't run vdRunWizards() after this function.

viewdiz.library/vdRunWizards
    NAME
  vdRunWizards -- Execute specified wizards.

    SYNOPSIS
  bool = vdUnloadWizards( finf )

    DESCRIPTION
  Executes specified wizards with the file assigned to vdFileInfo.
  The wizards are executed in the order they where given in the
  vdLoadWizards() function. Executable wizards (non scripts) are
  kept in a cache.

    INPUTS
  finf - vdFileInfo object allocated with vdAllocObject()

    RESULT
  bool - Zero of an error occurs, -1 if ok.
