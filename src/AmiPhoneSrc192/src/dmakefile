SCC = dcc -proto
ASM = phxass I=include:amiga SD SC

ASM_OBJS  = inthandler.o compress/ADPCM2_Crunch.o compress/ADPCM3_Crunch.o compress/ADPCM2_Decrunch.o compress/ADPCM3_Decrunch.o
DELF_OBJS = delfcode.o
C_OBJS	  = ciatimer.o AmiPhone.o phoneudp.o stringrequest.o microphone.o messages.o asl.o codec_c.o browse.o TCPQueue.o phonerexx.o phonerexx_rxif.o phonerexx_rxcl.o delfph.o

all:		AmiPhone AmiPhoned_debug

dall:		AmiPhone AmiPhoned

AmiPhone:  	$(ASM_OBJS) $(C_OBJS) $(DELF_OBJS)
		$(SCC) $(DELF_OBJS) $(ASM_OBJS) $(C_OBJS) -o AmiPhone
		copy AmiPhone amitcp:bin

AmiPhoned:	AmiPhoned.o compress/ADPCM2_Decrunch.o compress/ADPCM3_Decrunch.o codec_s.o stringrequest.o TCPQueue.o
		$(SCC) AmiPhoned.o compress/ADPCM2_Decrunch.o compress/ADPCM3_Decrunch.o codec_s.o stringrequest.o TCPQueue.o -o AmiPhoned
		copy AmiPhoned amitcp:serv/AmiPhoned

AmiPhoned_debug: AmiPhoned_debug.o compress/ADPCM2_Decrunch.o compress/ADPCM3_Decrunch.o codec_s.o stringrequest.o TCPQueue.o
		 $(SCC) AmiPhoned_debug.o compress/ADPCM2_Decrunch.o compress/ADPCM3_Decrunch.o codec_s.o stringrequest.o TCPQueue.o -o AmiPhoned_debug 
		 copy AmiPhoned_debug amitcp:serv/AmiPhoned

PhoneUtil:	PhoneUtil.o compress/ADPCM2_Decrunch.o compress/ADPCM3_Decrunch.o compress/ADPCM2_Crunch.o compress/ADPCM3_Crunch.o codec_v.o
		$(SCC) PhoneUtil.o compress/ADPCM2_Decrunch.o compress/ADPCM3_Decrunch.o compress/ADPCM2_Crunch.o compress/ADPCM3_Crunch.o codec_v.o

delfcode.o:	delfcode.a56
		dcc:bin/a56 delfcode.a56 object _delfcode nolist

delfph.o:	delfph.c
		$(SCC) -c delfph.c
		
PhoneUtil.o:	PhoneUtil.c
		$(SCC) -c PhoneUtil.c
				
codec_c.o:	codec.c AmiPhonePacket.h
		$(SCC) -c codec.c -DAMIPHONE -o codec_c.o

codec_v.o:	codec.c 
		$(SCC) -c codec.c -DCONV_UTIL -o codec_v.o

codec_s.o:	codec.c AmiPhonePacket.h
		$(SCC) -c codec.c -o codec_s.o

AmiPhoned.o:	AmiPhoned.c AmiPhonePacket.h
		$(SCC) -c AmiPhoned.c

AmiPhoned_debug.o:  AmiPhoned.c AmiPhonePacket.h
		$(SCC) -c AmiPhoned.c -o AmiPhoned_debug.o -DDEBUG_FLAG
					
phoneudp.o:	phoneudp.c AmiPhonePacket.h
		$(SCC) -c phoneudp.c

phonerexx.o:	phonerexx.c 
		$(SCC) -c phonerexx.c
		
phonerexx_rxif.o:	phonerexx_rxif.c
		$(SCC) -c phonerexx_rxif.c

phonerexx_rxcl.o:	phonerexx_rxcl.c
		$(SCC) -c phonerexx_rxcl.c

browse.o:	browse.c
		$(SCC) -c browse.c

TCPQueue.o:	TCPQueue.c
		$(SCC) -c TCPQueue.c

AmiPhone.o:	AmiPhone.c AmiPhonePacket.h
		$(SCC) -c AmiPhone.c

stringrequest.o:	stringrequest.c
			$(SCC) -c stringrequest.c
		
ciatimer.o:   	ciatimer.c
	 	$(SCC) -c ciatimer.c

messages.o:	messages.c
		$(SCC) -c messages.c

asl.o:		asl.c
		$(SCC) -c asl.c
				
microphone.c:	microphone.brush
		citas microphone.brush -c -m -h -o -s 

microphone.o:   microphone.c
	 	$(SCC) -c microphone.c

inthandler.o:   inthandler.a
	 	$(ASM) inthandler.a 

compress/ADPCM2_Crunch.o:   compress/ADPCM2_Crunch.a
	 	   $(ASM) compress/ADPCM2_Crunch.a 

compress/ADPCM3_Crunch.o:   compress/ADPCM3_Crunch.a
	 	   $(ASM) compress/ADPCM3_Crunch.a 

compress/ADPCM2_Decrunch.o:   compress/ADPCM2_Decrunch.a
	 	     $(ASM) compress/ADPCM2_Decrunch.a 

compress/ADPCM3_Decrunch.o:   compress/ADPCM3_Crunch.a
	 	     $(ASM) compress/ADPCM3_Decrunch.a 

clean:       
	 delete *.o
	 delete AmiPhone
	 delete AmiPhoned
	 
backup:
	 copy src:AmiPhone/#?.(a|c|h|guide|brush|info) work:sourcebackup/AmiPhone
	 copy src:AmiPhone/data/#? work:sourcebackup/amiphone/data
	 copy src:Amiphone/compress/#?.(a|h) work:sourcebackup/AmiPhone/compress
	 copy src:AmiPhone/dmakefile work:sourcebackup/AmiPhone
	 copy work:prog/ArexxBox/phonerexx.arb work:sourcebackup/AmiPhone
	 copy src:AmiPhone/Install#? work:sourcebackup/AmiPhone

backup2:
	 copy src:AmiPhone/#?.(a|c|h|guide|brush|info) zaphod:sourcebackup/AmiPhone
	 copy src:AmiPhone/data/#? zaphod:sourcebackup/amiphone/data
	 copy src:Amiphone/compress/#?.(a|h) zaphod:sourcebackup/AmiPhone/compress
	 copy src:AmiPhone/dmakefile zaphod:sourcebackup/AmiPhone
	 copy work:prog/ArexxBox/phonerexx.arb zaphod:sourcebackup/AmiPhone
	 copy src:AmiPhone/Install#? zaphod:sourcebackup/AmiPhone

archive:
	 delete ram:AmiPhoneSource.lha ram:src all
	 makedir ram:src
	 copy #?.(a|c|h|guide|brush|info|arb|readme) ram:src
	 makedir ram:src/compress
	 copy compress/#?.(a|c|h) ram:src/compress
	 copy Install_AmiPhone dmakefile toccata ram:src
	 makedir ram:src/include
	 makedir ram:src/include/toccata
	 copy toccata/#? all ram:src/include/toccata
	 makedir ram:src/include/a56
	 copy include:a56/#? ram:src/include/a56
	 makedir ram:src/include/libraries
	 copy include:amiga/libraries/delfina.h ram:src/include/libraries
	 makedir ram:src/include/pragmas
	 copy include:amiga/pragmas/delfina_pragmas.h ram:src/include/pragmas
	 makedir ram:src/bin
	 copy dcc:bin/a56 ram:src/bin
	 lz -r a ram:AmiPhoneSource.lha ram:src
     echo "archive made in ram:"
	 
dist:	distribution

distribution: AmiPhone AmiPhoned AmiPhoned_debug PhoneUtil
	delete ram:AmiPhone all
	delete ram:AmiPhone.info
	delete ram:AmiPhone.lha
	makedir ram:AmiPhone
	copy AmiPhone ram:AmiPhone
	copy AmiPhoneIcon.info ram:AmiPhone/AmiPhone.info
	copy AmiPhoned ram:AmiPhone
	copy AmiPhoned_debug ram:AmiPhone
	copy Install_AmiPhone ram:AmiPhone
	copy Install_AmiPhone.info ram:AmiPhone
	copy AmiPhone.guide ram:AmiPhone
	copy AmiPhone.guide.info ram:AmiPhone
	copy AmiPhoneDrawer.info ram:AmiPhone.info
	copy README ram:AmiPhone
	copy README ram:AmiPhone.readme
	copy README.icon.info ram:AmiPhone/README.info
	copy PhoneUtil ram:AmiPhone
	copy rexx:EditTextFile.rexx ram:AmiPhone
	lz -r a ram:AmiPhone.lha ram:AmiPhone ram:AmiPhone.info
	uu a ram:AmiPhone.lha.uu ram:AmiPhone.lha
