-------------- uucico116a.doc ----------------------------------------------

          ALPHA VERSION --- USE AT YOUR OWN RISK        uucico116a
        ==========================================

* This is uucico116a with some enhancements (known from uucico115c)
* Use this uucico116a only together with getty (V1.16)

CHANGES (short version):

- 2.0 version string
- security enhancements
- xferstat system
- Protocol Gg detection

BUG REPORTS:

email:  uucico116a@swb.de

-------------- uucico115c.doc ----------------------------------------------

This is uucico (DUUCP 1.15) with the following changes:

01-Nov-91 charly        uucico115c

files: uucico/sysdep.c          (bug)

- Bug in Byte timeout

  While inserting the Xferstat counter, i missed two brackets.
  In some situations, the byte timeout failed and could
  result in an hanging uucico - sorry for this bug.

- Named Ports for serial & timer IO to unnamed

  Because there is no reason - exception debugging - the
  Ports of TimerIO and SerialIO are now unnamed.
  If you need them, toggle the define in sysdep.c !

28-oct-91 charly        uucico115b

files: uucico/uucico.c          (changed)
       uucico/sysdep.c          (changed)
       uucico/modem.c           (changed)
       uucico/gio.c             (changed)
       lib/securityuser.c       (new)

- Enhanced security support for uucp file transfers

  Uucico optionally works with a "UUlib:Security.<hostname>" file.
  You can allow a good friend -OR- the public to access additional
  directories on your machine. The format is the same as the old
  security file. Sorry - we're working on a better security solution.
  This additional security file amends the default "UUlib:Security"
  file, so that if Security allows only read access to a directory
  but Security.foobar allows read & write to it, system foobar is
  able to write to it.

- XferStat logfile ( same name - other format ! )

  This function logs most of the information you need to calculate
  any statistical information of your links. It counts bytes, files,
  time and direction for any session. You see the used proto, windows
  and packetsize of each link.
  It calculates brutto/netto CPS for the link and percent overhead.
  Those results are written to UUSpool:XferStat.
  The Timelog function is untouched - but a bit redundant now. ;-)

- Hangup

  In some situations, after gturnoff(), there was a hangup problem.
  This is hopefully FIXED by calling hangup() generally inside the
  top_level() function directly after gturnoff().
  In modem.c you'll see an additional "\r" before the "+++" sequence
  in the reset_modem() function.

- Protocol detection 'g' and 'G'

  The "used protocol" msg now should response with 'g' or 'G'.
  Uucico offers "Gg" and detects the first in common.

- One uucico per device/unit

  UUcico locks by a public msgport for device and unit.

- version string support for 2.0 version command

  Under 2.0 you can use version to find uucico version string.
  Ident is untouched.

- MAKEUP: Logfile

  For some abort conditions, uucico writes better LOG information.
  This provides a high-level debugging for the possible errors
  between login to turnon() and the failed conditions from the
  top_level() handler.

        BAD LOGIN/PASSWORD      .. when the login/password fails
        WRONG MACHINE NAME      .. when getname() fails
        NO COMMON PROTOCOL      .. when getproto() fails
        STARTUP FAILED          .. when turnon() fails
        *** blabla ***          .. when top_level() fails internal.
        CONVERSATION FAILED     .. when top_level() fails internal.

  FYI:

  We used this kind of uucico for some month now - also we send in
  the sources for this before 1.15 was out in the hope "it's in there".

  XFERSTAT Format
  ---------------
  XferStat, by default, writes two lines for each session.
  The format fits on a normal full sized window and is human readable.

  The most frequently asked question: What is my CPS rate?

  Now some explanation of a log record ( 2 lines )

d hostname dd-mm-yy hh:mm:ss > dd-mm-yy hh:mm:ss hh:mm:ss BR_CPS NE_CPS ppp%
| p option bytes_i  bytes_o    fbytes_i fbytes_o fcnt_i fcnt_o

  where:
        d  direction of the call
           < outgoing
           > incoming

        hostname        who calls/ whom we call

        dd-mm-yy        date of start/stop session
        hh:mm:ss        time of start/stop session
                        or total time of sessions
        BR_CPS          brutto cps calculation
        NE_CPS          netto cps calculation
        ppp%            netto/brutto in percent
        bytes_i         total number of bytes (including protocol 
        bytes_o         overhead) in/out
        fbytes_i
        fbytes_o        total number of file bytes in/out
        fcnt_i
        fcnt_o          total number of files in/out

        p option        protocol key (mostly g|G)

        for g|G option format is n mmmm with

                n ... number of sliding windows
                m ... number of bytes/packets

  A "real world" example:
  -----------------------
  from uuspool:xferstat
             
< horga    23-10-91 07:38:06 > 23-10-91 07:51:04 (00:12:58)  1401   1169  83%
| g 3   64  1000935    89605 #   909846        0 #   26    0
  
   My system called host 'horga' on the 23. October at 7:38am.
   The used protocol was 'g' with 3 windows and 64 byte packets.
   The session terminated at 7:51am (logtime 00:12:58).
   I recieved 1000935 total bytes or 909846 data characters in
   26 files. I did send 89605 total bytes for protocol/ 0 bytes of data.
  
   The calculation returned 1401 bytes/sec OR 1169 bytes/sec
   of usable data. The protocol overhead amounted to 17% of the total
   cps rate.

  Both sides here used a TB2500 with PEP and spoofing enabled.

  !!! (AREXX) developers !!!
  -----------------------------------
  If you write anything based on xferstat's output,
  NEVER assume a fix number of lines/log !

  A log-record allways begins with a direction character and ends
  one byte before the next direction character or EOF.
  Valid direction characters are '<','>' or '=' as the first character
  on a line.
  
  After '<' or '>' the two lines above are the valid scan format.
  The '=' value is reserved.
  
  How to handle other characters in the first column of a line:

  - Interpret '|' as a continue line of the current running format.
    For '>' '<' this is the 'p option ... format'

  - Interpret '#' followed by a valid isspace() char as a comment line.

  - Treat '#anything' as a comment in general until you know what follows.

  - For any other leading characters ignore the whole line.

  Future Xferstat implementations log much more informations like modem
  extended result codes, packet i/o, retrans i/o and dump internal
  modem statistics (e.x. TBxxxx) on request.


  -> DONNOT IGNORE THIS NOTE, ELSE YOU NEED MANY UPDATES <-

  Real-world
  ----------
  Normally ( g-proto, 7 windows, 64 byte packets ) you'll see a
  protocol overhead of approx. 20%. While using larger packets (the -Pn
  option of uucico) the protocol overhead gets smaller and smaller. If
  you're transfering mostly large files (like news) a V32/V42.bis link
  with 7 windows and 512 byte packets (-P5) can achive as little as 4%
  overhead.

  PLEASE NOTE:
  Larger packets are only usable if both sides agree to this and often
  other uucico implementations are broken and will not work correctly if
  asked for a larger packet size. To use larger packets with two AmigaUUCP
  sites, the caller has to supply the -Pn parameter with his uucico command
  line and the receiver needs to have a "uucico -Pn" statement within it's
  UUlib:passwd file, where "n" should be at least as large as what the
  caller might request.

  Some results in normal mode:

  Modem         Mode             netto cps

  V32bis    unknown               ????
  TB2500    PEP && spoofing       1090
  USR DS    V32 V42bis             820
  2400      none MNP               200

The executable uucico115c is ready to use, just copy it to UUCP:c/uucico.

To recompile you need to modify the original distribution as described
in the .diff files. You need to copy the securityuser.c function to
the lib/ directory and add an entry in the Dmakefile for the new file.
In the uucico Dmakefile you also need to add xferstat.c

* WARNING for 1.13 *

If you DON'T use 1.15 in general and you just want the enhancements of the
new uucico, make sure you add a UULIB:config line "MUNGECASE N" or to use
the uuxqt from the 1.15 distribution.

have fun.

charly

--
  // <charly> ala Andrew Kopp SMAIL : Zu den Tannen 13,DW5810 Witten,Germany
\X/                           DOMAIN: charly@brewak.swb.de
SWB  -The Software Brewery-   USBANG: {uunet}!cbmvax!cbmger!brewas!charly

