head	0.76;
access;
symbols;
locks
	MORB:0.76; strict;
comment	@# @;


0.76
date	98.05.05.01.15.39;	author MORB;	state Exp;
branches;
next	0.75;

0.75
date	98.04.26.16.27.51;	author MORB;	state Exp;
branches;
next	0.74;

0.74
date	98.04.14.03.47.27;	author MORB;	state Exp;
branches;
next	0.73;

0.73
date	98.04.12.13.51.48;	author MORB;	state Exp;
branches;
next	0.72;

0.72
date	98.04.11.12.14.55;	author MORB;	state Exp;
branches;
next	0.71;

0.71
date	98.04.03.23.54.56;	author MORB;	state Exp;
branches;
next	0.70;

0.70
date	98.04.03.19.53.48;	author MORB;	state Exp;
branches;
next	0.69;

0.69
date	98.03.30.19.36.12;	author MORB;	state Exp;
branches;
next	0.68;

0.68
date	98.02.11.12.01.51;	author MORB;	state Exp;
branches;
next	0.67;

0.67
date	98.01.04.15.17.01;	author MORB;	state Exp;
branches;
next	0.66;

0.66
date	98.01.04.02.17.45;	author MORB;	state Exp;
branches;
next	0.65;

0.65
date	98.01.04.00.56.17;	author MORB;	state Exp;
branches;
next	0.64;

0.64
date	98.01.03.23.35.12;	author MORB;	state Exp;
branches;
next	0.63;

0.63
date	98.01.03.16.52.00;	author MORB;	state Exp;
branches;
next	0.62;

0.62
date	98.01.03.15.21.44;	author MORB;	state Exp;
branches;
next	0.61;

0.61
date	98.01.03.14.08.13;	author MORB;	state Exp;
branches;
next	0.60;

0.60
date	98.01.01.13.57.45;	author MORB;	state Exp;
branches;
next	0.59;

0.59
date	97.12.31.19.19.46;	author MORB;	state Exp;
branches;
next	0.58;

0.58
date	97.11.05.18.48.03;	author MORB;	state Exp;
branches;
next	0.57;

0.57
date	97.10.02.21.30.25;	author MORB;	state Exp;
branches;
next	0.56;

0.56
date	97.10.02.18.56.58;	author MORB;	state Exp;
branches;
next	0.55;

0.55
date	97.09.30.11.00.08;	author MORB;	state Exp;
branches;
next	0.54;

0.54
date	97.09.29.18.44.02;	author MORB;	state Exp;
branches;
next	0.53;

0.53
date	97.09.28.17.10.54;	author MORB;	state Exp;
branches;
next	0.52;

0.52
date	97.09.28.17.06.41;	author MORB;	state Exp;
branches;
next	0.51;

0.51
date	97.09.27.22.47.24;	author MORB;	state Exp;
branches;
next	0.50;

0.50
date	97.09.24.22.23.24;	author MORB;	state Exp;
branches;
next	0.49;

0.49
date	97.09.24.22.07.18;	author MORB;	state Exp;
branches;
next	0.48;

0.48
date	97.09.24.12.50.30;	author MORB;	state Exp;
branches;
next	0.47;

0.47
date	97.09.23.23.21.18;	author MORB;	state Exp;
branches;
next	0.46;

0.46
date	97.09.22.21.49.44;	author MORB;	state Exp;
branches;
next	0.45;

0.45
date	97.09.22.07.27.13;	author MORB;	state Exp;
branches;
next	0.44;

0.44
date	97.09.21.13.34.41;	author MORB;	state Exp;
branches;
next	0.43;

0.43
date	97.09.21.00.06.05;	author MORB;	state Exp;
branches;
next	0.42;

0.42
date	97.09.21.00.00.07;	author MORB;	state Exp;
branches;
next	0.41;

0.41
date	97.09.20.23.54.10;	author MORB;	state Exp;
branches;
next	0.40;

0.40
date	97.09.20.16.09.38;	author MORB;	state Exp;
branches;
next	0.39;

0.39
date	97.09.20.16.05.45;	author MORB;	state Exp;
branches;
next	0.38;

0.38
date	97.09.20.15.54.16;	author MORB;	state Exp;
branches;
next	0.37;

0.37
date	97.09.20.15.49.37;	author MORB;	state Exp;
branches;
next	0.36;

0.36
date	97.09.20.15.40.24;	author MORB;	state Exp;
branches;
next	0.35;

0.35
date	97.09.20.12.00.20;	author MORB;	state Exp;
branches;
next	0.34;

0.34
date	97.09.19.23.31.34;	author MORB;	state Exp;
branches;
next	0.33;

0.33
date	97.09.19.22.56.26;	author MORB;	state Exp;
branches;
next	0.32;

0.32
date	97.09.17.22.58.59;	author MORB;	state Exp;
branches;
next	0.31;

0.31
date	97.09.17.22.55.06;	author MORB;	state Exp;
branches;
next	0.30;

0.30
date	97.09.16.22.13.05;	author MORB;	state Exp;
branches;
next	0.29;

0.29
date	97.09.16.21.57.53;	author MORB;	state Exp;
branches;
next	0.28;

0.28
date	97.09.16.21.39.10;	author MORB;	state Exp;
branches;
next	0.27;

0.27
date	97.09.16.21.27.12;	author MORB;	state Exp;
branches;
next	0.26;

0.26
date	97.09.16.21.14.51;	author MORB;	state Exp;
branches;
next	0.25;

0.25
date	97.09.14.21.59.10;	author MORB;	state Exp;
branches;
next	0.24;

0.24
date	97.09.07.23.21.32;	author MORB;	state Exp;
branches;
next	0.23;

0.23
date	97.09.07.23.00.03;	author MORB;	state Exp;
branches;
next	0.22;

0.22
date	97.09.07.22.10.59;	author MORB;	state Exp;
branches;
next	0.21;

0.21
date	97.08.31.18.15.28;	author MORB;	state Exp;
branches;
next	0.20;

0.20
date	97.08.31.17.56.35;	author MORB;	state Exp;
branches;
next	0.19;

0.19
date	97.08.27.18.39.23;	author MORB;	state Exp;
branches;
next	0.18;

0.18
date	97.08.27.18.28.52;	author MORB;	state Exp;
branches;
next	0.17;

0.17
date	97.08.27.00.00.01;	author MORB;	state Exp;
branches;
next	0.16;

0.16
date	97.08.26.15.19.42;	author MORB;	state Exp;
branches;
next	0.15;

0.15
date	97.08.25.13.35.47;	author MORB;	state Exp;
branches;
next	0.14;

0.14
date	97.08.25.13.24.44;	author MORB;	state Exp;
branches;
next	0.13;

0.13
date	97.08.25.12.27.39;	author MORB;	state Exp;
branches;
next	0.12;

0.12
date	97.08.25.11.17.46;	author MORB;	state Exp;
branches;
next	0.11;

0.11
date	97.08.25.08.23.00;	author MORB;	state Exp;
branches;
next	0.10;

0.10
date	97.08.24.23.04.10;	author MORB;	state Exp;
branches;
next	0.9;

0.9
date	97.08.24.21.27.27;	author MORB;	state Exp;
branches;
next	0.8;

0.8
date	97.08.24.16.26.56;	author MORB;	state Exp;
branches;
next	0.7;

0.7
date	97.08.24.14.23.11;	author MORB;	state Exp;
branches;
next	0.6;

0.6
date	97.08.24.14.12.24;	author MORB;	state Exp;
branches;
next	0.5;

0.5
date	97.08.23.22.58.45;	author MORB;	state Exp;
branches;
next	0.4;

0.4
date	97.08.23.22.36.51;	author MORB;	state Exp;
branches;
next	0.3;

0.3
date	97.08.23.01.19.34;	author MORB;	state Exp;
branches;
next	0.2;

0.2
date	97.08.22.18.28.19;	author MORB;	state Exp;
branches;
next	0.1;

0.1
date	97.08.22.15.24.21;	author MORB;	state Exp;
branches;
next	0.0;

0.0
date	97.08.22.15.00.32;	author MORB;	state Exp;
branches;
next	;


desc
@Jeu à la beast avec des scrolls partout
RCS for GoldED · Initial login date: Aujourd'hui
@


0.76
log
@Implemented separation bars (thick and thin) in TextClass, in order to make better looking about requests
@
text
@*
* CdBSian Obviously Universal & Interactive Nonsense (COUIN)
* (Absurdité CdBSienne Manifestement Universelle et Interactive)
* ©1997-1998, CdBS Software (MORB)
* Gui routines
* $Id: Gui.s 0.75 1998/04/26 16:27:51 MORB Exp MORB $
*

;fs "_InitGui"
_GuiBpMem:
	 ds.l      1
_GuiSelMem:
	 ds.l      1
_GuiBitmap:
	 ds.l      1
_GuiSelBitmap:
	 ds.l      1
_InitGui:
	 lea       _GuiBpPtrs,a0
	 move.l    _GuiBitmap(pc),d0
	 move.w    #bplpt,d1
	 moveq     #NbGuiPlanes-1,d2
.Loop:
	 swap      d0
	 move.w    d1,(a0)+
	 move.w    d0,(a0)+
	 addq.w    #2,d1
	 move.w    d1,(a0)+
	 swap      d0
	 move.w    d0,(a0)+
	 addq.w    #2,d1
	 add.l     #GuiBufferWidth,d0
	 dbf       d2,.Loop

	 lea       _GuiSelBpPtrs,a0
	 move.l    _GuiSelBitmap(pc),d0
	 move.l    d0,$8f00000
	 move.w    #bplpt,d1
	 moveq     #NbPlanes-1,d2
.Loop2:
	 swap      d0
	 move.w    d1,(a0)+
	 move.w    d0,(a0)+
	 addq.w    #2,d1
	 move.w    d1,(a0)+
	 swap      d0
	 move.w    d0,(a0)+
	 addq.w    #2,d1
	 add.l     #GuiSelBufferWidth,d0
	 dbf       d2,.Loop2

	 lea       StdMousePointer(pc),a0
	 bra.s     _SetMousePointer
;fe
;fs "Gui copper table"
CopLayer4:
	 dc.l      0,0
GuiP:
	 dc.w      $29+240,CET_BREAK
	 dc.l      _GuiCList
	 dc.l      _GuiCopTable

_GuiCopTable:
	 dc.l      GuiNml
_GuiL1Ptr:
	 dc.l      CopEnd,-1

GuiLayer1:
	 dc.l      0,0
GuiSelP:
	 dc.w      $29+240,CET_BREAK
	 dc.l      _GuiSelCList
	 dc.l      _GuiSelCopTable

_GuiSelCopTable:
	 dc.l      GuiSelNml
	 dc.l      CopEnd,-1

CopEnd:
	 dc.l      0,0
	 dc.w      $29+256,CET_BREAK
	 dc.l      0,0
;fe

;fs "_Request"
_ReqHook:
	 ds.l      1
_ReqLastGui:
	 ds.l      1
ReqGuiObj:
	 ds.l      1

_Request:          ; a0=Title a1=body a2=buttons a3=Hook a4=datastream
	 movem.l   d2/a2-6,-(a7)
	 move.l    a3,_ReqHook

	 move.l    a0,ReqTitle
	 move.l    a1,ReqBody
	 move.l    a4,ReqFDat
	 move.l    a2,a6

	 lea       ReqGui(pc),a0
	 bsr       _CreateObjectTree

	 move.l    d0,ReqGuiObj
	 move.l    _ObjectCollector,a0
	 move.l    d0,a2
	 DOMTDI    MTD_AddMember,a0

	 lea       _GuiTemp,a3
	 lea       _ButtonClass(pc),a4
	 lea       _ReqButHook(pc),a5
	 moveq     #1,d2

.BLoop:
	 move.l    a4,a0
	 sub.l     a1,a1
	 bsr       _NewObject
	 tst.l     d0
	 beq.s     .BDone

	 move.l    d0,a2
	 SDATALI   a3,BDTA_Label,a2
	 move.l    ReqButGrp,a0
	 DOMTDI    MTD_AddMember,a0

.CLoop:
	 move.b    (a6)+,d0
	 beq.s     .CDone
	 cmp.b     #"|",d0
	 beq.s     .CDone
	 move.b    d0,(a3)+
	 bra.s     .CLoop

.CDone:
	 clr.b     (a3)+
	 LBLOCKEAI GuiRootClass_ID,a2,a0
	 move.l    a5,guir_DTA_Hook(a0)

	 tst.b     d0
	 beq.s     .BDone

	 move.l    d2,guir_DTA_HookData(a0)
	 addq.l    #1,d2
	 bra.s     .BLoop

.BDone:
	 move.l    a3,_CtGuiTemp

	 clr.l     guir_DTA_HookData(a0)


	 move.l    ReqGuiObj,a2
	 DOMTDI    GM_Open,a2
	 tst.l     d0
	 bne.s     .ReqFail
.Fail:
	 movem.l   (a7)+,d2/a2-6
	 rts

.ReqFail:
	 move.l    d0,a4
	 DOMTDI    GM_Close,a2

	 lea       RQTitle(pc),a0
	 lea       RQBody(pc),a1
	 lea       RQBut(pc),a2
	 sub.l     a3,a3
	 bsr.s     _Request

	 moveq     #0,d0
	 bra.s     .Fail

RQTitle:
	 dc.b      "Request() failure",0
RQBody:
	 dc.b      "%s error :",$a
	 dc.b      "%s",0
RQBut:
	 dc.b      "OK",0
	 even

_ReqButHook:
	 movem.l   d2/a2,-(a7)

	 move.l    d0,d2

	 move.l    ReqGuiObj(pc),a2
	 DOMTDI    GM_Close,a2
	 move.l    a2,a0
	 bsr       _DisposeObject

	 move.l    d2,d0
	 move.l    _ReqHook,d1
	 beq.s     .Done

	 movem.l   (a7)+,d2/a2
	 move.l    d1,-(a7)
	 rts

.Done:
	 movem.l   (a7)+,d2/a2
	 rts

ReqButGrp:
	 ds.l      1

ReqGui:
	 GUI

	 VGROUP

	 HGROUP
	 SMALLBTN  "X",_ReqButHook,0
	 SMALLBTN  "I",_Iconify,0
	 dc.l      OBJ_Begin,_DragBarClass
	 dc.l      BDTA_Label
ReqTitle:
	 dc.l      0
	 ENDOBJ
	 ENDOBJ

	 dc.l      OBJ_Begin,_TextClass
	 dc.l      TDTA_Text
ReqBody:
	 dc.l      0
	 dc.l      TDTA_FData
ReqFDat:
	 dc.l      0
	 ENDOBJ

	 dc.l      OBJ_Begin,_HGroupClass
	 STOOBJ    ReqButGrp

	 ENDOBJ

	 ENDOBJ
;fe

;fs "_SetMousePointer"
_SetMousePointer:  ; a0=mptr
	 movem.w   (a0)+,d0-1
	 movem.w   d0-1,_MouseHotPointX
	 move.l    (a0),a0
	 move.l    a0,_MouseGardenDwarf
	 move.l    (a0),_GDwarfTable
	 rts

StdMousePointer:
	 dc.w      1,1
	 dc.l      StdMouseGDwarf
StdMouseGDwarf:
	 dc.l      _StdMouseGardenDwarfDat,0
	 dc.w      0,0,14

EDMousePointer:
	 dc.w      6,7
	 dc.l      EDMouseGDwarf
EDMouseGDwarf:
	 dc.l      _EDMouseGardenDwarfDat,0
	 dc.w      0,0,13

HKMousePointer:
	 dc.w      10,5
	 dc.l      HKMouseGDwarf
HKMouseGDwarf:
	 dc.l      _HKMouseGardenDwarfDat,0
	 dc.w      0,0,11

VKMousePointer:
	 dc.w      10,5
	 dc.l      VKMouseGDwarf
VKMouseGDwarf:
	 dc.l      _VKMouseGardenDwarfDat,0
	 dc.w      0,0,11
;fe
;fs "_HandleMouse"
_MouseHook:
	 dc.l      0
_HandleMouse:
	 move.l    Low_Base,a6
	 moveq     #0,d0
	 CALL      ReadJoyPort

	 btst      #JPB_BUTTON_RED,d0
	 sne       _LMBState
	 btst      #JPB_BUTTON_BLUE,d0
	 sne       _RMBState
	 btst      #JPB_BUTTON_PLAY,d0
	 sne       _MMBState

	 move.l    _MouseX(pc),d6
	 move.l    _MouseY(pc),d7

	 move.l    d0,d1
	 and.l     #JP_MHORZ_MASK,d1

	 lea       LastHMCount(pc),a0
	 move.w    (a0),d2
	 move.w    d1,(a0)
	 sub.b     d2,d1

	 extb.l    d1
	 add.l     d1,d6

	 and.l     #JP_MVERT_MASK,d0
	 lsr.l     #8,d0

	 lea       LastVMCount(pc),a0
	 move.w    (a0),d2
	 move.w    d0,(a0)
	 sub.b     d2,d0

	 extb.l    d0
	 asr.l     #1,d0
	 add.l     d0,d7

	 movem.l   _MinMouseX(pc),d0-3

	 cmp.l     d0,d6
	 bge.s     .XPos
	 move.l    d0,d6
.XPos:

	 cmp.l     d2,d6
	 ble.s     .XOk
	 move.l    d2,d6
.XOk:
	 move.l    d6,_MouseX

	 cmp.l     d1,d7
	 bge.s     .YPos
	 move.l    d1,d7
.YPos:

	 cmp.l     d3,d7
	 ble.s     .YOk
	 move.l    d3,d7
.YOk:
	 move.l    d7,_MouseY

	 sub.w     _MouseHotPointX,d6
	 add.w     d6,d6
	 sub.w     _MouseHotPointY,d7
	 subq.w    #HotPointY,d7

	 move.l    _MouseGardenDwarf(pc),a0
	 movem.w   d6-7,gdw_X(a0)
	 bsr       _RefreshGardenDwarf

	 move.l    _MouseHook(pc),d0
	 beq.s     .Done
	 move.l    d0,a0
	 jmp       (a0)
.Done:

	 rts
_MinMouseX:
	 dc.l      0
_MinMouseY:
	 dc.l      0
_MaxMouseX:
	 dc.l      GuiScreenWidth
_MaxMouseY:
	 dc.l      256
_MouseHotPointX:
	 ds.w      1
_MouseHotPointY:
	 ds.w      1
_MouseGardenDwarf:
	 ds.l      1
_MouseX:
	 dc.l      GuiScreenWidth
_MouseY:
	 dc.l      256
LastHMCount:
	 ds.w      1
LastVMCount:
	 ds.w      1
_LMBState:
	 dc.b      0
_RMBState:
	 dc.b      0
_MMBState:
	 dc.b      0
	 even
;fe
;fs "_HandleGui"
_CurrentGuiObject:
	 ds.l      1

_PlayfieldClickHandler:
	 ds.l      1
_PreHandler:
	 ds.l      1
_ActiveThingHandler:
	 ds.l      1
_ActiveGuiEntry:
	 ds.l      1
_OldMButtonState:
	 ds.b      1
	 even

_HandleGui:
	 move.l    _ActiveGuiObject(pc),d0
	 beq.s     .Hem
	 move.l    d0,a0
	 movem.l   _MouseX(pc),d0-1
	 sub.l     _GuiPos,d1
	 move.l    _ActiveGuiObjData(pc),d2
	 DOMTDJI   GCM_Handle,a0

.Hem:
	 tst.l     _CurrentGui(pc)
	 bne.s     .OldGuiHandler
	 move.l    _CurrentGuiObject(pc),d0
	 beq.s     .OldGuiHandler
	 move.l    d0,a0
	 movem.l   _MouseX(pc),d0-1
	 sub.l     _GuiPos,d1
	 DOMTDJI   GCM_Handle,a0

.OldGuiHandler:
	 move.l    _PreHandler(pc),d0
	 beq.s     .Kzlonka

	 move.l    d0,a0
	 jsr       (a0)

.Kzlonka:
	 movem.l   _MouseX(pc),d0-1
	 sub.l     _GuiPos,d1

	 move.l    _ActiveThingHandler(pc),d2
	 beq.s     .AhBon
	 move.l    d2,a1
	 move.l    _ActiveGuiEntry(pc),a0
	 lea       ge_Domain(a0),a2
	 move.l    a2,_CurrentDomain
	 jmp       (a1)

.AhBon:
	 move.b    _OldMButtonState(pc),d2
	 btst      #0,$dff016
	 seq       _OldMButtonState
	 bne.s     .PasClickuMilieu

	 tst.b     d2
	 bne.s     .PasClickuMilieu

	 cmp.l     #CopEnd,_GuiLayerPtr
	 beq       .ShowGui

	 move.l    #CopEnd,_GuiLayerPtr
	 bra.s     .PasClickuMilieu

.ShowGui:
	 move.l    #CopLayer4,_GuiLayerPtr

.PasClickuMilieu:

	 move.l    _PlayfieldClickHandler(pc),d2
	 beq.s     .Décidement

	 cmp.l     #CopEnd,_GuiLayerPtr
	 beq       .GzlonK

	 tst.l     d1
	 bpl.s     .Décidement

.GzlonK:

	 movem.l   _MouseX(pc),d0-1
	 move.l    d2,a0
	 jmp       (a0)

.Décidement:
	 cmp.l     #CopEnd,_GuiLayerPtr
	 beq.s     .OhEtPuisMerdeTousVouf

	 tst.b     _LMBState
	 beq.s     .OhEtPuisMerdeTousVouf

	 move.l    _CurrentGui(pc),d2
	 beq.s     .OhEtPuisMerdeTousVouf
	 move.l    d2,a0

	 cmp2.l    ge_Domain+gd_Left(a0),d0
	 bcs.s     .OhEtPuisMerdeTousVouf

	 cmp2.l    ge_Domain+gd_Top(a0),d1
	 bcs.s     .OhEtPuisMerdeTousVouf

	 bsr.s     _DoClick

.OhEtPuisMerdeTousVouf:
	 rts
;fe

;fs "_OpenGui"
_OpenGui:          ; a0=Gui
	 move.l    a2,-(a7)

	 move.l    a0,a2
	 move.l    (a2),d0
	 bne.s     .Ok

	 lea       g_ObjectTree(a2),a0
	 bsr       _CreateObjectTree
	 tst.l     d0
	 beq.s     .Fail
	 move.l    d0,(a2)
	 move.l    d0,a2
	 move.l    _ObjectCollector,a0
	 DOMTDI    MTD_AddMember,a0
	 move.l    a2,d0

.Ok:
	 move.l    d0,a2
	 DOMTDI    GM_Open,a2
	 tst.l     d0
	 bne.s     .GuiFail

	 moveq     #-1,d0
.Fail:

	 move.l    (a7)+,a2
	 rts

.GuiFail:
	 movem.l   a2-4,-(a7)
	 move.l    d0,a4
	 DOMTDI    GM_Close,a2

	 lea       OGTitle(pc),a0
	 lea       OGBody(pc),a1
	 lea       OGBut(pc),a2
	 sub.l     a3,a3
	 bsr.s     _Request

	 moveq     #0,d0
	 movem.l   (a7)+,a2-4
	 bra.s     .Fail

OGTitle:
	 dc.b      "OpenGui() failure",0
OGBody:
	 dc.b      "%s error :",$a
	 dc.b      "%s",0
OGBut:
	 dc.b      "OK",0
	 even
;fe
;fs "_CloseGui"
_CloseGui:
	 move.l    _CurrentGuiObject(pc),a0
	 DOMTDJI   GM_Close,a0
;fe

;fs "Classes"
;fs "GuiRootClass"
_GuiRootClass:
	 dc.l      0
	 dc.l      _RootClass
	 dc.l      0,0,0,0,0
	 dc.l      guir_DataSize
	 dc.l      guir_Funcs
	 dc.l      guir_Data
	 dc.l      0

guir_Data:
	 ds.b      gd_Size
	 dc.l      20,20
	 dc.l      0,0
	 dc.l      1000
	 dc.l      0,0,0,0

guir_Funcs:
	 dc.l      GRCActivatePrev
	 dc.l      GRCActivateNext
	 dc.l      GRCActivateLast
	 dc.l      GRCActivateFirst
	 dc.l      GRCHandleAsciiKey
	 dc.l      GRCHandleRawKey
	 dc.l      GRCGoActive
	 dc.l      GRCHandle
	 dc.l      GRCClick
	 dc.l      GRCUnderMouse
	 dc.l      GRCClear
	 dc.l      GRCUpdate
	 dc.l      GRCRender
	 dc.l      GRCLayout
	 dc.l      GRCGetMinMax
	 dc.l      0

GRCClear:
	 movem.l   d3-7/a5,-(a7)
	 move.l    _CurrentDomain,a5
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain
	 moveq     #0,d3
	 moveq     #0,d4
	 moveq     #0,d5
	 move.l    gd_Width(a1),d6
	 move.l    gd_Height(a1),d7
	 bsr.s     _DrawRectangle
	 move.l    a5,_CurrentDomain
	 movem.l   (a7)+,d3-7/a5
	 rts

GRCUnderMouse:
	 move.l    a2,a0
	 bra.s     _SetMousePointer

GRCGetMinMax:
GRCLayout:
GRCRender:
GRCUpdate:
GRCClick:
GRCHandle:
GRCGoActive:
GRCHandleRawKey:
GRCHandleAsciiKey:
GRCActivateFirst:
GRCActivateLast:
GRCActivateNext:
GRCActivatePrev:
	 moveq     #0,d0
	 rts
;fe
;fs "GuiClass"
_GuiClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      gui_DataSize
	 dc.l      gui_Funcs
	 dc.l      gui_Data
	 dc.l      0
	 dc.l      gui_Init

gui_Data:
	 dc.l      -1,0,0,0,0

gui_Funcs:
	 dc.l      GUIActivate
	 dc.l      GUIToggle
	 dc.l      GUIHide
	 dc.l      GUIShow
	 dc.l      GUIMove
	 dc.l      GUIClose
	 dc.l      GUIOpen
	 dc.l      0

gui_Init:
	 move.l    #GCM_GetMinMax,d0
	 lea       GUIGetMinMax,a1
	 bsr       _SetMethod
	 move.l    #GCM_Layout,d0
	 lea       GUILayout,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       GUIRender,a1
	 bsr       _SetMethod
	 move.l    #GCM_Clear,d0
	 lea       GUIClear,a1
	 bsr       _SetMethod
	 move.l    #GCM_Handle,d0
	 lea       GUIHandle,a1
	 bsr       _SetMethod
	 rts

GUIOpen:
	 movem.l   d2/a2-3,-(a7)

	 bsr.s     _ClearGui

	 move.l    a0,a3
	 LBLOCKEAI GuiClass_ID,a3,a2

	 move.l    _CurrentGuiObject(pc),d2
	 move.l    d2,gui_GDTA_OldGui(a2)
	 move.l    _CurrentGui(pc),gui_GDTA_OldStyleGui(a2)
	 bne.s     .Ok

	 tst.l     d2
	 beq.s     .Ok
	 move.l    d2,a0
	 DOMTDI    GCM_Clear,a0
.Ok:

	 clr.l     _CurrentGui
	 move.l    a3,_CurrentGuiObject
	 DOMTDI    GCM_GetMinMax,a3
	 DOMTDI    GCM_Layout,a3
	 move.l    d0,gui_GDTA_Error(a2)
	 bne.s     .Fail

	 DOMTDI    GCM_Render,a3

	 tst.l     gui_GDTA_ShownFlag(a2)
	 bne.s     .Show
	 move.l    #CopEnd,_GuiLayerPtr
	 bra.s     .Done

.Show:
	 move.l    #CopLayer4,_GuiLayerPtr

.Done:
	 moveq     #0,d0
.Fail:
	 movem.l   (a7)+,d2/a2-3
	 rts

GUIClose:
	 movem.l   d2-3/a2,-(a7)

	 LBLOCKEAI GuiClass_ID,a0,a1
	 move.l    gui_GDTA_OldGui(a1),d2
	 move.l    d2,_CurrentGuiObject

	 move.l    gui_GDTA_OldStyleGui(a1),d1
	 move.l    d1,_CurrentGui

	 move.l    gui_GDTA_Error(a1),d3
	 bne.s     .DontClear

	 DOMTDI    GCM_Clear,a0

.DontClear:
	 tst.l     d1
	 bne.s     .OldStyle

	 tst.l     d2
	 beq.s     .Done
	 move.l    d2,_CurrentGuiObject
	 tst.l     d3
	 bne.s     .Done
	 move.l    d2,a2
	 DOMTDI    GCM_GetMinMax,a2
	 DOMTDI    GCM_Layout,a2
	 DOMTDI    GCM_Render,a2
	 bra.s     .Done

.OldStyle:
	 tst.l     d3
	 bne.s     .Done
	 move.l    d1,a0
	 bsr.s     _ChangeGui

.Done:
	 movem.l   (a7)+,d2-3/a2
	 rts

GUIGetMinMax:
	 movem.l   d2/a2,-(a7)

	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a2
	 DOMTDI    GCM_GetMinMax,a2

	 LBLOCKEAI GuiRootClass_ID,a2,a0
	 moveq     #0,d0
	 move.l    #255,d1

	 move.l    guir_DTA_MaxHeight(a0),d2
	 beq.s     .NoMax
	 move.l    d1,d0
	 sub.l     guir_DTA_MaxHeight(a0),d0
.NoMax:
	 move.l    d0,_MinGuiPos

	 sub.l     guir_DTA_MinHeight(a0),d1
	 move.l    d1,_MaxGuiPos

	 move.l    _GuiPos(pc),d2

	 cmp.l     d0,d2
	 bcc.s     .MinOk
	 move.l    d0,d2
.MinOk:

	 cmp.l     d2,d1
	 bcc.s     .MaxOk
	 move.l    d1,d2
.MaxOk:
	 move.l    d2,_GuiPos

	 movem.l   (a7)+,d2/a2
	 rts

GUILayout:
	 movem.l   a2-3,-(a7)
	 move.l    #CopEnd,_GuiL1Ptr

	 LBLOCKEAI GuiRootClass_ID,a0,a1

	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 LBLOCKEAI GuiRootClass_ID,a0,a2

	 cmp.l     #256,guir_DTA_MinHeight(a2)
	 bcc.s     .TooTall
	 cmp.l     #GuiScreenWidth-4+1,guir_DTA_MinWidth(a2)
	 bcc.s     .TooWide

	 move.l    _GuiPos(pc),d0
	 move.l    d0,d1

	 add.l     #$28,d0
	 move.w    d0,GuiP

	 move.l    #2,gd_Left(a2)
	 move.l    #0,gd_Top(a2)

	 move.l    #GuiScreenWidth-2,gd_Right(a2)
	 move.l    #GuiScreenWidth-4,gd_Width(a2)

	 move.l    #255,d0
	 sub.l     d1,d0
	 move.l    d0,gd_Height(a2)
	 move.l    d0,gd_Bottom(a2)

	 DOMTDI    GCM_Layout,a0
.Fail:
	 movem.l   (a7)+,a2-3
	 rts

.TooTall:
	 lea       GUITooTall,a0
	 move.l    a0,d0
	 bra.s     .Fail

.TooWide:
	 lea       GUITooWide,a0
	 move.l    a0,d0
	 bra.s     .Fail

GUITooTall:
	 dc.l      GUIName
	 dc.l      GUITT

GUITooWide:
	 dc.l      GUIName
	 dc.l      GUITW


GUIRender:
	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 DOMTDJI   GCM_Render,a0

GUIClear:
	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 DOMTDJI   GCM_Clear,a0

GUIHandle:
	 movem.l   a2-3,-(a7)

	 move.l    a0,a3
	 LBLOCKEAI GuiClass_ID,a3,a1
	 tst.l     gui_GDTA_ShownFlag(a1)
	 beq.s     .Grunt

	 movem.l   d0-1,-(a7)
	 move.l    gui_GDTA_ActiveObj(a1),d1

	 bsr.s     _GetRawKey
	 tst.l     d0
	 bmi.s     .NoRawKey
	 tst.l     d1
	 beq.s     .RKNoActObj

	 movem.l   a0-1,-(a7)
	 DOMTDI    GCM_HandleRawKey,d1
	 movem.l   (a7)+,a0-1

.RKNoActObj:
	 cmp.b     #$5f,d0
	 bne.s     .NoRawKey

	 bsr.s     GUIToggle
.NoRawKey:

	 bsr.s     _GetAsciiKey
	 tst.l     d0
	 bmi.s     .NoAsciiKey
	 tst.l     d1
	 beq.s     .NoAsciiKey

	 movem.l   a0-1,-(a7)
	 DOMTDI    GCM_HandleAsciiKey,d1
	 movem.l   (a7)+,a0-1

.NoAsciiKey:
	 movem.l   (a7)+,d0-1

	 LBLOCKEAI RootClass_ID,a3,a0
	 move.l    (a0),a0
	 LBLOCKEAI GuiRootClass_ID,a0,a1

	 cmp2.l    gd_Left(a1),d0
	 bcs.s     .Grunt

	 cmp2.l    gd_Top(a1),d1
	 bcs.s     .Grunt

	 tst.b     _LMBState
	 beq.s     .Grunt

	 DOMTDI    GCM_Click,a0
	 bra.s     .Done

.Grunt:
	 lea       StdMousePointer,a2
	 DOMTDI    GCM_UnderMouse,a0

	 move.b    _OldMButtonState(pc),d1
	 btst      #2,$dff016
	 beq.s     .gna
	 btst      #0,$dff016
.gna:
	 seq       _OldMButtonState
	 bne.s     .Done

	 tst.b     d1
	 bne.s     .Done
	 bsr.s     GUIToggle

.Done:
	 movem.l   (a7)+,a2-3
	 rts

GUIMove:
	 move.l    a2,-(a7)
	 move.l    a0,a2
	 DOMTDI    GCM_Clear,a0
	 DOMTDI    GCM_Layout,a2
	 DOMTDI    GCM_Render,a2
	 move.l    (a7)+,a2
	 rts

GUIShow:
	 SDATALI   #-1,GDTA_ShownFlag,a0
	 move.l    #CopLayer4,_GuiLayerPtr
	 rts

GUIHide:
	 SDATALI   #0,GDTA_ShownFlag,a0
	 move.l    #CopEnd,_GuiLayerPtr
	 rts

GUIToggle:
	 LBLOCKEAI GuiClass_ID,a3,a0
	 not.l     gui_GDTA_ShownFlag(a0)
	 bne.s     .Show
	 move.l    #CopEnd,_GuiLayerPtr
	 rts

.Show:
	 move.l    #CopLayer4,_GuiLayerPtr
	 rts

GUIActivate:       ; a2=object
	 SDATALI   a2,GDTA_ActiveObj,a0
	 rts

GUIName:
	 dc.b      "GuiClass",0
GUITT:
	 dc.b      "GUI is too tall",0
GUITW:
	 dc.b      "GUI is too wide",0
	 even
;fe
;fs "HGroupClass"
_HGroupClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      hgr_DataSize
	 dc.l      empty_Funcs
	 dc.l      hgroup_Data
	 dc.l      0
	 dc.l      hgroup_Init

hgroup_Data:
	 dc.l      GuiHorSpacing

hgroup_Init:
	 move.l    #GCM_GetMinMax,d0
	 lea       HGRGetMinMax,a1
	 bsr       _SetMethod
	 move.l    #GCM_Layout,d0
	 lea       HGRLayout,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       _GRPRender,a1
	 bsr       _SetMethod
	 move.l    #GCM_UnderMouse,d0
	 lea       _GRPUnderMouse,a1
	 bsr       _SetMethod
	 move.l    #GCM_Click,d0
	 lea       _GRPClick,a1
	 bsr       _SetMethod
	 rts

HGRGetMinMax:
	 movem.l   d2-7/a2-5,-(a7)
	 move.l    a0,a5

	 LBLOCKEAI RootClass_ID,a5,a2
	 move.l    (a2),a2

	 LDATALI   HGDT_Spacing,a5,a4

	 move.l    a0,a1
	 lea       ge_Size(a0),a0
	 move.l    a4,d2
	 neg.l     d2
	 move.l    d2,d4
	 moveq     #0,d3
	 moveq     #0,d5
	 not.l     d5
	 sf        d6

.Loop:
	 move.l    (a2),d0
	 beq.s     .Done
	 move.l    d0,a3

	 DOMTDI    GCM_GetMinMax,a2

	 LBLOCKEAI GuiRootClass_ID,a2,a0
	 add.l     guir_DTA_MinWidth(a0),d2
	 move.l    guir_DTA_MaxWidth(a0),d0
	 seq       d7
	 or.b      d7,d6
	 add.l     d0,d4

	 move.l    guir_DTA_MinHeight(a0),d0
	 cmp.l     d0,d3
	 bcc.s     .MiHOk
	 move.l    d0,d3
.MiHOk:

	 move.l    guir_DTA_MaxHeight(a0),d0
	 beq.s     .MaHOk
	 cmp.l     d5,d0
	 bcc.s     .MaHOk
	 move.l    d0,d5
.MaHOk:

	 add.l     a4,d2
	 add.l     a4,d4

	 move.l    a3,a2
	 bra.s     .Loop

.Done:
	 tst.b     d6
	 beq.s     .WMaxOk
	 moveq     #0,d4
.WMaxOk:

	 tst.l     d5
	 bpl.s     .HMaxOk
	 moveq     #0,d5
.HMaxOk:

	 LBLOCKEAI GuiRootClass_ID,a5,a0
	 movem.l   d2-5,guir_DTA_MinWidth(a0)

	 movem.l   (a7)+,d2-7/a2-5
	 rts

HGRLayout:
	 movem.l   d2-7/a2-3/a5-6,-(a7)

	 move.l    a0,a6
	 LBLOCKEAI RootClass_ID,a6,a5
	 move.l    (a5),a5
	 moveq     #0,d7

	 LDATALI   HGDT_Spacing,a6,a3

	 LBLOCKEAI GuiRootClass_ID,a6,a1
	 move.l    gd_Height(a1),d0
	 move.l    gd_Top(a1),d1
	 move.l    gd_Bottom(a1),d2
	 moveq     #0,d4
	 move.l    a5,a0

.InitLoop:
	 move.l    (a0),d3
	 beq.s     .ILOk

	 LBLOCKEAI GuiRootClass_ID,a0,a2
	 move.l    d1,gd_Top(a2)
	 move.l    d2,gd_Bottom(a2)
	 clr.l     gd_Width(a2)
	 move.l    d0,gd_Height(a2)

	 add.l     guir_DTA_Weight(a2),d7
	 add.l     a3,d4

	 move.l    d3,a0
	 bra.s     .InitLoop

.ILOk:
	 tst.l     d7
	 bne.s     .WeightOk
	 lea       HGRAWN(pc),a0
	 move.l    a0,d0
	 bra.s     .Fail
.WeightOk:

	 move.l    gd_Width(a1),d5

	 sub.l     a3,d4
	 sub.l     d4,d5

.BigLoop:
	 move.l    a5,a0

.Loop:
	 move.l    (a0),d6
	 beq.s     .Ok

	 LBLOCKEAI GuiRootClass_ID,a0,a0
	 tst.l     gd_Width(a0)
	 bne.s     .Fixed

	 move.l    guir_DTA_MinWidth(a0),d0
	 move.l    guir_DTA_Weight(a0),d3
	 beq.s     .FixMin

	 move.l    d3,d4
	 mulu      d5,d4
	 divu      d7,d4

	 moveq     #0,d2
	 swap      d4
	 lsl.w     #1,d4
	 swap      d4
	 addx.l    d2,d4
	 ext.l     d4

	 cmp.l     d0,d4
	 bcc.s     .MinOk
.FixMin:
	 move.l    d0,gd_Width(a0)
	 sub.l     d0,d5
	 sub.l     d3,d7
	 moveq     #0,d1
	 move.l    d1,gd_Left(a0)
	 bra.s     .BigLoop
.MinOk:

	 move.l    guir_DTA_MaxWidth(a0),d0
	 beq.s     .Next

	 cmp.l     d4,d0
	 bcc.s     .Next
	 move.l    d0,gd_Width(a0)
	 sub.l     d0,d5
	 sub.l     d3,d7
	 moveq     #1,d1
	 move.l    d1,gd_Left(a0)
	 bra.s     .BigLoop

.Fixed:
	 move.l    gd_Left(a0),d0
	 eor.l     d1,d0
	 beq.s     .Next

	 move.l    gd_Width(a0),d0
	 add.l     d5,d0
	 move.l    guir_DTA_Weight(a0),d2
	 mulu      d2,d0
	 add.l     d7,d2
	 divu      d2,d0

	 moveq     #0,d3
	 swap      d0
	 lsl.w     #1,d0
	 swap      d0
	 addx.l    d3,d0
	 ext.l     d0

	 move.l    guir_DTA_MinWidth(a0),d3
	 cmp.l     d3,d0
	 bcs.s     .Next

	 move.l    guir_DTA_MaxWidth(a0),d3
	 beq.s     .AhhRâaah
	 cmp.l     d0,d3
	 bcs.s     .Next

.AhhRâaah:
	 add.l     gd_Width(a0),d5
	 clr.l     gd_Width(a0)
	 move.l    d2,d7
	 bra.s     .BigLoop

.Next:
	 move.l    d6,a0
	 bra       .Loop

.Ok:
	 move.l    gd_Left(a1),d2

.PosLoop:
	 move.l    (a5),d6
	 beq.s     .AllDone

	 LBLOCKEAI GuiRootClass_ID,a5,a0

	 move.l    d2,gd_Left(a0)

	 move.l    gd_Width(a0),d3
	 bne.s     .PLWOk

	 move.l    guir_DTA_Weight(a0),d3
	 mulu      d5,d3
	 divu      d7,d3

	 moveq     #0,d0
	 swap      d3
	 lsl.w     #1,d3
	 swap      d3
	 addx.l    d0,d3
	 ext.l     d3

	 move.l    d3,gd_Width(a0)
.PLWOk:

	 add.l     d3,d2
	 move.l    d2,gd_Right(a0)
	 add.l     a3,d2

	 DOMTDI    GCM_Layout,a5
	 tst.l     d0
	 bne.s     .Fail

	 move.l    d6,a5
	 bra.s     .PosLoop

.AllDone:
	 moveq     #0,d0
.Fail:
	 movem.l   (a7)+,d2-7/a2-3/a5-6
	 rts

HGRAWN:
	 dc.l      HGRName
	 dc.l      GRPAllWNull
HGRName:
	 dc.b      "HGroupClass",0
	 even
;fe
;fs "VKnobClass"
_VKnobClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      vkb_DataSize
	 dc.l      empty_Funcs
	 dc.l      vhandle_data
	 dc.l      0
	 dc.l      vhandle_Init

vhandle_data:
	 dc.l      0,0,0,0

vhandle_Init:
	 LBLOCKEAI GuiRootClass_ID,a2,a3
	 add.l     a1,a3

	 moveq     #0,d0
	 move.l    d0,guir_DTA_MinHeight(a3)
	 moveq     #4,d0
	 move.l    d0,guir_DTA_MinWidth(a3)
	 move.l    d0,guir_DTA_MaxWidth(a3)

	 move.l    #GCM_Layout,d0
	 lea       VKBLayout,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       VKBRender,a1
	 bsr       _SetMethod
	 move.l    #GCM_UnderMouse,d0
	 lea       VKBUnderMouse,a1
	 bsr       _SetMethod
	 move.l    #GCM_Click,d0
	 lea       VKBClick,a1
	 bsr       _SetMethod
	 move.l    #GCM_Handle,d0
	 lea       VKBHandler,a1
	 bsr       _SetMethod
	 rts

VKBLayout:
	 move.l    d2,-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    gd_Left(a1),d2

	 move.l    4(a0),a1
	 tst.l     4(a1)
	 beq.s     .ErrAtBegin

	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 move.l    guir_DTA_Weight(a1),d1

	 move.l    gd_Width(a1),d0
	 sub.l     d0,d2

	 add.l     guir_DTA_MinWidth(a1),d2

	 move.l    (a0),a1
	 tst.l     (a1)
	 beq.s     .ErrAtEnd

	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 add.l     guir_DTA_Weight(a1),d1
	 beq.s     .Err2NullWeights

	 LBLOCKEAI VKnobClass_ID,a0,a1
	 movem.l   d0-2,vkb_VKDT_TotSize(a1)

	 moveq     #0,d0
.Fail:
	 move.l    (a7)+,d2
	 rts

.ErrAtBegin:
	 lea       VKBAB(pc),a0
	 move.l    a0,d0
	 bra.s     .Fail

.ErrAtEnd:
	 lea       VKBAE(pc),a0
	 move.l    a0,d0
	 bra.s     .Fail

.Err2NullWeights:
	 lea       VKB2NW(pc),a0
	 move.l    a0,d0
	 bra.s     .Fail

VKBRender:
	 movem.l   d2-4,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 move.l    (a0),a1
	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 move.l    gd_Width(a1),d1
	 move.l    d1,d2
	 sub.l     guir_DTA_MinWidth(a1),d1

	 LBLOCKEAI GuiRootClass_ID,a0,a1

	 add.l     gd_Left(a1),d1
	 LBLOCKEAI VKnobClass_ID,a0,a0
	 move.l    d1,vkb_VKDT_MaxPos(a0)
	 add.l     d2,vkb_VKDT_TotSize(a0)

	 moveq     #0,d0
	 move.l    a1,_CurrentDomain
	 moveq     #0,d1
	 move.l    gd_Height(a1),d3
	 moveq     #4,d2
	 sf        d4
	 bsr       _DrawBevelBox

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-4
	 rts

VKBUnderMouse:
	 lea       VKMousePointer,a0
	 bra       _SetMousePointer

VKBClick:
	 move.l    d2,-(a7)

	 add.l     _GuiPos(pc),d1
	 move.l    d1,_MinMouseY
	 move.l    d1,_MaxMouseY

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    gd_Left(a1),d2
	 sub.l     d0,d2
	 move.l    d0,VKBOffset

	 LBLOCKEAI VKnobClass_ID,a0,a1

	 movem.l   vkb_VKDT_MinPos(a1),d0-1
	 sub.l     d2,d0
	 move.l    d0,_MinMouseX
	 sub.l     d2,d1
	 move.l    d1,_MaxMouseX

	 sf        VKBFlag

	 move.l    a0,_ActiveGuiObject
	 move.l    (a7)+,d2
	 rts

VKBHandler:
	 movem.l   d3-7/a2,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 moveq     #-1,d3
	 moveq     #0,d5
	 moveq     #4,d6
	 move.l    gd_Height(a1),d7
	 move.l    VKBPos(pc),d4

	 tst.b     _LMBState
	 beq.s     .Release

	 sub.l     VKBOffset(pc),d0
	 move.l    d0,VKBPos
	 tst.b     VKBFlag
	 beq.s     .DontErase

	 cmp.l     d0,d4
	 beq.s     .Done

	 tst.b     VKBFlag
	 beq.s     .DontErase
	 bsr       _DrawRectangle
.DontErase:
	 move.l    d0,d4
	 bsr       _DrawRectangle
	 st        VKBFlag

.Done:
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d3-7/a2
	 rts

.Release:
	 tst.b     VKBFlag
	 beq.s     .DontErase2
	 bsr       _DrawRectangle
.DontErase2:

	 clr.l     _ActiveGuiObject

	 clr.l     _MinMouseX
	 clr.l     _MinMouseY

	 move.l    #GuiScreenWidth,_MaxMouseX
	 move.l    #256,_MaxMouseY

	 tst.l     d4
	 beq.s     .Done

	 LBLOCKEAI VKnobClass_ID,a0,a1
	 movem.l   vkb_VKDT_TotSize(a1),d0-1

	 move.l    4(a0),a1
	 LBLOCKEAI GuiRootClass_ID,a1,a1

	 move.l    gd_Width(a1),d3
	 add.l     d4,d3
	 mulu      d1,d3
	 divu      d0,d3

	 moveq     #0,d4
	 swap      d3
	 lsl.w     #1,d3
	 swap      d3
	 addx.l    d4,d3
	 ext.l     d3

	 move.l    d3,guir_DTA_Weight(a1)

	 move.l    (a0),a1
	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 sub.l     d3,d1
	 move.l    d1,guir_DTA_Weight(a1)

	 LDATALI   DTA_Parent,a0,a2
	 DOMTDI    GCM_Layout,a2
	 DOMTDI    GCM_Clear,a2
	 DOMTDI    GCM_Render,a2

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d3-7/a2
	 rts

VKBOffset:
	 ds.l      1
VKBPos:
	 ds.l      1
VKBFlag:
	 dc.l      0

VKBAB:
	 dc.l      VKBName
	 dc.l      KNBAtBeg
VKBAE:
	 dc.l      VKBName
	 dc.l      KNBAtEnd
VKB2NW:
	 dc.l      VKBName
	 dc.l      KNB2Null

VKBName:
	 dc.b      "VKnobClass",0
	 even
;fe
;fs "VGroupClass"
_VGroupClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      vgr_DataSize
	 dc.l      empty_Funcs
	 dc.l      vgroup_Data
	 dc.l      0
	 dc.l      vgroup_Init

vgroup_Data:
	 dc.l      GuiVerSpacing

vgroup_Init:
	 move.l    #GCM_GetMinMax,d0
	 lea       VGRGetMinMax,a1
	 bsr       _SetMethod
	 move.l    #GCM_Layout,d0
	 lea       VGRLayout,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       _GRPRender,a1
	 bsr       _SetMethod
	 move.l    #GCM_UnderMouse,d0
	 lea       _GRPUnderMouse,a1
	 bsr       _SetMethod
	 move.l    #GCM_Click,d0
	 lea       _GRPClick,a1
	 bsr       _SetMethod
	 rts

VGRGetMinMax:
	 movem.l   d2-7/a2-5,-(a7)
	 move.l    a0,a5

	 LBLOCKEAI RootClass_ID,a5,a2
	 move.l    (a2),a2

	 LDATALI   VGDT_Spacing,a5,a4

	 move.l    a0,a1
	 lea       ge_Size(a0),a0
	 move.l    a4,d3
	 neg.l     d3
	 move.l    d3,d5
	 moveq     #0,d2
	 moveq     #0,d4
	 not.l     d4
	 sf        d6

.Loop:
	 move.l    (a2),d0
	 beq.s     .Done
	 move.l    d0,a3

	 DOMTDI    GCM_GetMinMax,a2

	 LBLOCKEAI GuiRootClass_ID,a2,a0
	 add.l     guir_DTA_MinHeight(a0),d3
	 move.l    guir_DTA_MaxHeight(a0),d0
	 seq       d7
	 or.b      d7,d6
	 add.l     d0,d5

	 move.l    guir_DTA_MinWidth(a0),d0
	 cmp.l     d0,d2
	 bcc.s     .MiWOk
	 move.l    d0,d2
.MiWOk:

	 move.l    guir_DTA_MaxWidth(a0),d0
	 beq.s     .MaWOk
	 cmp.l     d4,d0
	 bcc.s     .MaWOk
	 move.l    d0,d4
.MaWOk:

	 add.l     a4,d3
	 add.l     a4,d5

	 move.l    a3,a2
	 bra.s     .Loop

.Done:
	 tst.b     d6
	 beq.s     .HMaxOk
	 moveq     #0,d5
.HMaxOk:

	 tst.l     d4
	 bpl.s     .WMaxOk
	 moveq     #0,d4
.WMaxOk:

	 LBLOCKEAI GuiRootClass_ID,a5,a0
	 movem.l   d2-5,guir_DTA_MinWidth(a0)

	 movem.l   (a7)+,d2-7/a2-5
	 rts

VGRLayout:
	 movem.l   d2-7/a2-3/a5-6,-(a7)

	 move.l    a0,a6
	 LBLOCKEAI RootClass_ID,a6,a5
	 move.l    (a5),a5
	 moveq     #0,d7

	 LDATALI   VGDT_Spacing,a6,a3

	 LBLOCKEAI GuiRootClass_ID,a6,a1
	 move.l    gd_Width(a1),d0
	 move.l    gd_Left(a1),d1
	 move.l    gd_Right(a1),d2
	 moveq     #0,d4
	 move.l    a5,a0

.InitLoop:
	 move.l    (a0),d3
	 beq.s     .ILOk

	 LBLOCKEAI GuiRootClass_ID,a0,a2
	 move.l    d1,gd_Left(a2)
	 move.l    d2,gd_Right(a2)
	 clr.l     gd_Height(a2)
	 move.l    d0,gd_Width(a2)

	 add.l     guir_DTA_Weight(a2),d7
	 add.l     a3,d4

	 move.l    d3,a0
	 bra.s     .InitLoop

.ILOk:
	 tst.l     d7
	 bne.s     .WeightOk
	 lea       VGRAWN(pc),a0
	 move.l    a0,d0
	 bra.s     .Fail
.WeightOk:

	 move.l    gd_Height(a1),d5

	 sub.l     a3,d4
	 sub.l     d4,d5

.BigLoop:
	 move.l    a5,a0

.Loop:
	 move.l    (a0),d6
	 beq.s     .Ok

	 LBLOCKEAI GuiRootClass_ID,a0,a0
	 tst.l     gd_Height(a0)
	 bne.s     .Fixed

	 move.l    guir_DTA_MinHeight(a0),d0
	 move.l    guir_DTA_Weight(a0),d3
	 beq.s     .FixMin

	 move.l    d3,d4
	 mulu      d5,d4
	 divu      d7,d4

	 moveq     #0,d2
	 swap      d4
	 lsl.w     #1,d4
	 swap      d4
	 addx.l    d2,d4
	 ext.l     d4

	 cmp.l     d0,d4
	 bcc.s     .MinOk
.FixMin:
	 move.l    d0,gd_Height(a0)
	 sub.l     d0,d5
	 sub.l     d3,d7
	 moveq     #0,d1
	 move.l    d1,gd_Top(a0)
	 bra.s     .BigLoop
.MinOk:

	 move.l    guir_DTA_MaxHeight(a0),d0
	 beq.s     .Next

	 cmp.l     d4,d0
	 bcc.s     .Next
	 move.l    d0,gd_Height(a0)
	 sub.l     d0,d5
	 sub.l     d3,d7
	 moveq     #1,d1
	 move.l    d1,gd_Top(a0)
	 bra.s     .BigLoop

.Fixed:
	 move.l    gd_Top(a0),d0
	 eor.l     d1,d0
	 beq.s     .Next

	 move.l    gd_Height(a0),d0
	 add.l     d5,d0
	 move.l    guir_DTA_Weight(a0),d2
	 mulu      d2,d0
	 add.l     d7,d2
	 divu      d2,d0

	 moveq     #0,d3
	 swap      d0
	 lsl.w     #1,d0
	 swap      d0
	 addx.l    d3,d0
	 ext.l     d0

	 move.l    guir_DTA_MinHeight(a0),d3
	 cmp.l     d3,d0
	 bcs.s     .Next

	 move.l    guir_DTA_MaxHeight(a0),d3
	 beq.s     .AhhRâaah
	 cmp.l     d0,d3
	 bcs.s     .Next

.AhhRâaah:
	 add.l     gd_Height(a0),d5
	 clr.l     gd_Height(a0)
	 move.l    d2,d7
	 bra.s     .BigLoop

.Next:
	 move.l    d6,a0
	 bra       .Loop

.Ok:
	 move.l    gd_Top(a1),d2

.PosLoop:
	 move.l    (a5),d6
	 beq.s     .AllDone

	 LBLOCKEAI GuiRootClass_ID,a5,a0

	 move.l    d2,gd_Top(a0)

	 move.l    gd_Height(a0),d3
	 bne.s     .PLHOk

	 move.l    guir_DTA_Weight(a0),d3
	 mulu      d5,d3
	 divu      d7,d3

	 moveq     #0,d0
	 swap      d3
	 lsl.w     #1,d3
	 swap      d3
	 addx.l    d0,d3
	 ext.l     d3

	 move.l    d3,gd_Height(a0)
.PLHOk:

	 add.l     d3,d2
	 move.l    d2,gd_Bottom(a0)
	 add.l     a3,d2

	 DOMTDI    GCM_Layout,a5
	 tst.l     d0
	 bne.s     .Fail

	 move.l    d6,a5
	 bra.s     .PosLoop

.AllDone:
	 moveq     #0,d0
.Fail:
	 movem.l   (a7)+,d2-7/a2-3/a5-6
	 rts

VGRAWN:
	 dc.l      VGRName
	 dc.l      GRPAllWNull
VGRName:
	 dc.b      "VGroupClass",0
	 even
;fe
;fs "HKnobClass"
_HKnobClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      hkb_DataSize
	 dc.l      empty_Funcs
	 dc.l      hhandle_data
	 dc.l      0
	 dc.l      hhandle_Init

hhandle_data:
	 dc.l      0,0,0,0

hhandle_Init:
	 LBLOCKEAI GuiRootClass_ID,a2,a3
	 add.l     a1,a3

	 moveq     #0,d0
	 move.l    d0,guir_DTA_MinWidth(a3)
	 moveq     #2,d0
	 move.l    d0,guir_DTA_MinHeight(a3)
	 move.l    d0,guir_DTA_MaxHeight(a3)

	 move.l    #GCM_Layout,d0
	 lea       HKBLayout,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       HKBRender,a1
	 bsr       _SetMethod
	 move.l    #GCM_UnderMouse,d0
	 lea       HKBUnderMouse,a1
	 bsr       _SetMethod
	 move.l    #GCM_Click,d0
	 lea       HKBClick,a1
	 bsr       _SetMethod
	 move.l    #GCM_Handle,d0
	 lea       HKBHandler,a1
	 bsr       _SetMethod
	 rts

HKBLayout:
	 move.l    d2,-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    gd_Top(a1),d2

	 move.l    4(a0),a1
	 tst.l     4(a1)
	 beq.s     .ErrAtBegin

	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 move.l    guir_DTA_Weight(a1),d1

	 move.l    gd_Height(a1),d0
	 sub.l     d0,d2

	 add.l     guir_DTA_MinHeight(a1),d2

	 move.l    (a0),a1
	 tst.l     (a1)
	 beq.s     .ErrAtEnd

	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 add.l     guir_DTA_Weight(a1),d1
	 beq.s     .Err2NullWeights

	 LBLOCKEAI HKnobClass_ID,a0,a1
	 movem.l   d0-2,hkb_HKDT_TotSize(a1)

	 moveq     #0,d0
.Fail:
	 move.l    (a7)+,d2
	 rts

.ErrAtBegin:
	 lea       HKBAB(pc),a0
	 move.l    a0,d0
	 bra.s     .Fail

.ErrAtEnd:
	 lea       HKBAE(pc),a0
	 move.l    a0,d0
	 bra.s     .Fail

.Err2NullWeights:
	 lea       HKB2NW(pc),a0
	 move.l    a0,d0
	 bra.s     .Fail

HKBRender:
	 movem.l   d2-4,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 move.l    (a0),a1
	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 move.l    gd_Height(a1),d1
	 move.l    d1,d2
	 sub.l     guir_DTA_MinHeight(a1),d1

	 LBLOCKEAI GuiRootClass_ID,a0,a1

	 add.l     gd_Top(a1),d1
	 LBLOCKEAI HKnobClass_ID,a0,a0
	 move.l    d1,hkb_HKDT_MaxPos(a0)
	 add.l     d2,hkb_HKDT_TotSize(a0)

	 moveq     #0,d0
	 move.l    a1,_CurrentDomain
	 moveq     #0,d1
	 move.l    gd_Width(a1),d2
	 moveq     #2,d3
	 sf        d4
	 bsr       _DrawBevelBox

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-4
	 rts

HKBUnderMouse:
	 lea       HKMousePointer,a0
	 bra       _SetMousePointer

HKBClick:
	 move.l    d2,-(a7)

	 move.l    d0,_MinMouseX
	 move.l    d0,_MaxMouseX

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    gd_Top(a1),d2
	 sub.l     d1,d2
	 move.l    d1,HKBOffset

	 LBLOCKEAI HKnobClass_ID,a0,a1

	 sub.l     _GuiPos(pc),d2
	 movem.l   hkb_HKDT_MinPos(a1),d0-1
	 sub.l     d2,d0
	 move.l    d0,_MinMouseY
	 sub.l     d2,d1
	 move.l    d1,_MaxMouseY

	 sf        HKBFlag

	 move.l    a0,_ActiveGuiObject
	 move.l    (a7)+,d2
	 rts

HKBHandler:
	 movem.l   d3-7/a2,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 moveq     #-1,d3
	 moveq     #0,d4
	 move.l    gd_Width(a1),d6
	 moveq     #2,d7
	 move.l    HKBPos(pc),d5

	 tst.b     _LMBState
	 beq.s     .Release

	 sub.l     HKBOffset(pc),d1
	 move.l    d1,HKBPos
	 tst.b     HKBFlag
	 beq.s     .DontErase

	 cmp.l     d1,d5
	 beq.s     .Done

	 tst.b     HKBFlag
	 beq.s     .DontErase
	 bsr       _DrawRectangle
.DontErase:
	 move.l    d1,d5
	 bsr       _DrawRectangle
	 st        HKBFlag

.Done:
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d3-7/a2
	 rts

.Release:
	 tst.b     HKBFlag
	 beq.s     .DontErase2
	 bsr       _DrawRectangle
.DontErase2:

	 clr.l     _ActiveGuiObject

	 clr.l     _MinMouseX
	 clr.l     _MinMouseY

	 move.l    #GuiScreenWidth,_MaxMouseX
	 move.l    #256,_MaxMouseY

	 tst.l     d5
	 beq.s     .Done

	 LBLOCKEAI HKnobClass_ID,a0,a1
	 movem.l   hkb_HKDT_TotSize(a1),d0-1

	 move.l    4(a0),a1
	 LBLOCKEAI GuiRootClass_ID,a1,a1

	 move.l    gd_Height(a1),d3
	 add.l     d5,d3
	 mulu      d1,d3
	 divu      d0,d3

	 moveq     #0,d4
	 swap      d3
	 lsl.w     #1,d3
	 swap      d3
	 addx.l    d4,d3
	 ext.l     d3

	 move.l    d3,guir_DTA_Weight(a1)

	 move.l    (a0),a1
	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 sub.l     d3,d1
	 move.l    d1,guir_DTA_Weight(a1)

	 LDATALI   DTA_Parent,a0,a2
	 DOMTDI    GCM_Layout,a2
	 DOMTDI    GCM_Clear,a2
	 DOMTDI    GCM_Render,a2

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d3-7/a2
	 rts

HKBOffset:
	 ds.l      1
HKBPos:
	 ds.l      1
HKBFlag:
	 dc.l      0

HKBAB:
	 dc.l      HKBName
	 dc.l      KNBAtBeg
HKBAE:
	 dc.l      HKBName
	 dc.l      KNBAtEnd
HKB2NW:
	 dc.l      HKBName
	 dc.l      KNB2Null

HKBName:
	 dc.b      "HKnobClass",0
	 even
;fe
;fs "Common group code"
;fs "_GRPRender"
_GRPRender:
	 movem.l   d2/a2,-(a7)

	 LBLOCKEAI RootClass_ID,a0,a2
	 move.l    (a2),a2

.Loop:
	 move.l    (a2),d2
	 beq.s     .Done
	 DOMTDI    GCM_Render,a2
	 move.l    d2,a2
	 bra.s     .Loop

.Done:
	 movem.l   (a7)+,d2/a2
	 rts
;fe
;fs "_GRPUnderMouse"
_GRPUnderMouse:
	 movem.l   d2/a3,-(a7)

	 LBLOCKEAI RootClass_ID,a0,a3
	 move.l    (a3),a3

.Loop:
	 move.l    (a3),d2
	 beq.s     .Done

	 LBLOCKEAI GuiRootClass_ID,a3,a0

	 cmp2.l    gd_Left(a0),d0
	 bcs.s     .NoClick

	 cmp2.l    gd_Top(a0),d1
	 bcc.s     .Bingo

.NoClick:
	 move.l    d2,a3
	 bra.s     .Loop

.Done:
	 move.l    a2,a0
	 bsr       _SetMousePointer
	 moveq     #0,d0
	 movem.l   (a7)+,d2/a3
	 rts

.Bingo:
	 DOMTDI    GCM_UnderMouse,a3
	 moveq     #1,d0
	 movem.l   (a7)+,d2/a3
	 rts
;fe
;fs "_GRPClick"
_GRPClick:
	 movem.l   d2/a2,-(a7)

	 LBLOCKEAI RootClass_ID,a0,a2
	 move.l    (a2),a2

.Loop:
	 move.l    (a2),d2
	 beq.s     .Done

	 LBLOCKEAI GuiRootClass_ID,a2,a0

	 cmp2.l    gd_Left(a0),d0
	 bcs.s     .NoClick

	 cmp2.l    gd_Top(a0),d1
	 bcc.s     .Bingo

.NoClick:
	 move.l    d2,a2
	 bra.s     .Loop

.Done:
	 moveq     #0,d0
	 movem.l   (a7)+,d2/a2
	 rts

.Bingo:
	 DOMTDI    GCM_Click,a2
	 moveq     #1,d0
	 movem.l   (a7)+,d2/a2
	 rts
;fe
GRPAllWNull:
	 dc.b      "All objects weights are zero",0
	 even
;fe
;fs "Common knob datas"
KNBAtBeg:
	 dc.b      "Knob is at the begin of a group",0
KNBAtEnd:
	 dc.b      "Knob is at the end of a group",0
KNB2Null:
	 dc.b      "Knob is between two objects with null weights",0
	 even
;fe
;fs "EmptyClass"
_EmptyClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      0
	 dc.l      empty_Funcs
	 dc.l      0
	 dc.l      0
	 dc.l      empty_Init

empty_Funcs:
	 dc.l      0

empty_Init:
	 LBLOCKEAI GuiRootClass_ID,a2,a3
	 add.l     a1,a3
	 clr.l     guir_DTA_MinWidth(a3)
	 clr.l     guir_DTA_MinHeight(a3)
	 rts
;fe
;fs "ButtonClass"
_ButtonClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      btn_DataSize
	 dc.l      button_Funcs
	 dc.l      button_data
	 dc.l      0
	 dc.l      button_Init

button_data:
	 dc.l      0,0,0,0

button_Funcs:
	 dc.l      0

button_Init:
	 LBLOCKEAI GuiRootClass_ID,a2,a3
	 add.l     a1,a3

	 moveq     #12,d0
	 move.l    d0,guir_DTA_MinHeight(a3)
	 move.l    d0,guir_DTA_MaxHeight(a3)
	 clr.l     guir_DTA_MaxWidth(a3)

	 move.l    #GCM_GetMinMax,d0
	 lea       BTNGetMinMax,a1
	 bsr       _SetMethod
	 move.l    #GCM_Layout,d0
	 lea       BTNLayout,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       BTNRender,a1
	 bsr       _SetMethod
	 move.l    #GCM_Click,d0
	 lea       BTNClick,a1
	 bsr       _SetMethod
	 move.l    #GCM_Handle,d0
	 lea       BTNHandler,a1
	 bsr       _SetMethod
	 rts

BTNGetMinMax:
	 movem.l   a2-3,-(a7)
	 LBLOCKEAI ButtonClass_ID,a0,a1
	 move.l    (a1),a2
	 move.l    a2,a3

.StrLen:
	 tst.b     (a3)+
	 bne.s     .StrLen
	 sub.l     a2,a3
	 move.l    a3,d0
	 lsl.l     #3,d0

	 LBLOCKEAI GuiRootClass_ID,a0,a2
	 move.l    d0,guir_DTA_MinWidth(a2)

	 subq.l    #8,d0
	 move.l    d0,btn_BDTA_TextWidth(a1)
	 movem.l   (a7)+,a2-3
	 rts

BTNLayout:
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    gd_Width(a1),d0
	 LBLOCKEAI ButtonClass_ID,a0,a1
	 sub.l     btn_BDTA_TextWidth(a1),d0
	 lsr.l     #1,d0
	 move.l    d0,btn_BDTA_TextX(a1)
	 moveq     #0,d0
	 rts

BTNRender:
	 movem.l   d2-7/a5,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 moveq     #0,d0
	 moveq     #0,d1
	 move.l    gd_Width(a1),d2
	 move.l    gd_Height(a1),d3
	 sf        d4
	 bsr       _DrawBevelBox

	 LBLOCKEAI ButtonClass_ID,a0,a1
	 move.l    btn_BDTA_TextX(a1),d6
	 moveq     #2,d7
	 move.l    (a1),a5
	 moveq     #1,d4
	 moveq     #0,d5
	 bsr       _DrawText

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7/a5
	 rts

BTNClick:
	 clr.l     BTNReptCount
	 move.l    a0,_ActiveGuiObject
	 sf        BTNPressed

BTNHandler:
	 movem.l   d2-7/a5,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 tst.b     _LMBState
	 beq.s     .Desactivate

	 move.b    BTNPressed(pc),d2

	 cmp2.l    gd_Left(a1),d0
	 scc       d0

	 cmp2.l    gd_Top(a1),d1
	 scc       d1

	 and.b     d1,d0
	 move.b    d0,BTNPressed

	 eor.b     d0,d2
	 beq.s     .DoRepeat

	 tst.b     d0
	 bne.s     .Press

	 bsr.s     .Release

.Done:
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7/a5
	 rts

.DoRepeat:
	 tst.b     d0
	 beq.s     .Done
	 move.l    BTNReptCount,d0
	 beq.s     .Done
	 subq.l    #1,d0
	 bne.s     .ReptOk
	 LBLOCKEAI ButtonClass_ID,a0,a1
	 move.l    btn_BDTA_Repeat(a1),BTNReptCount
	 bra.s     .CallHook

.ReptOk:
	 move.l    d0,BTNReptCount
	 bra.s     .Done

.Release:
	 moveq     #0,d3
	 moveq     #2,d4
	 moveq     #1,d5
	 movem.l   gd_Width(a1),d6-7
	 subq.l    #4,d6
	 subq.l    #2,d7
	 bsr       _DrawRectangle

	 bsr       BTNRender
	 rts

.Press:
	 move.l    a1,a2

	 moveq     #3,d3
	 moveq     #2,d4
	 moveq     #1,d5
	 movem.l   gd_Width(a2),d6-7
	 subq.l    #4,d6
	 subq.l    #2,d7
	 bsr       _DrawRectangle

	 moveq     #0,d0
	 moveq     #0,d1
	 movem.l   gd_Width(a2),d2-3
	 st        d4
	 bsr       _DrawBevelBox

	 LBLOCKEAI ButtonClass_ID,a0,a1

	 move.l    btn_BDTA_TextX(a1),d6
	 moveq     #2,d7
	 move.l    (a1),a5
	 moveq     #1,d4
	 moveq     #0,d5
	 bsr       _DrawText

	 move.l    btn_BDTA_Repeat(a1),BTNReptCount
	 bne.s     .CallHook

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7/a5
	 rts

.Desactivate:
	 clr.l     _ActiveGuiObject

	 tst.b     BTNPressed
	 beq.s     .Done

	 bsr.s     .Release

	 tst.l     BTNReptCount
	 bne.s     .Done

.CallHook:
	 LBLOCKEAI GuiRootClass_ID,a0,a5
	 move.l    guir_DTA_Hook(a5),d0
	 beq.s     .Done
	 move.l    d0,a1
	 move.l    guir_DTA_HookData(a5),d0
	 jsr       (a1)

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7/a5
	 rts

BTNReptCount:
	 dc.l      0
BTNPressed:
	 ds.b      1
	 even
;fe
;fs "DragBarClass"
_DragBarClass:
	 dc.l      0
	 dc.l      _ButtonClass
	 dc.l      0,0,0,0,0
	 dc.l      0
	 dc.l      empty_Funcs
	 dc.l      0
	 dc.l      0
	 dc.l      dragbar_Init

dragbar_Init:
	 move.l    #GCM_Click,d0
	 lea       DRBClick,a1
	 bsr       _SetMethod
	 move.l    #GCM_Handle,d0
	 lea       DRBHandler,a1
	 bsr       _SetMethod
	 rts

DRBClick:
	 move.l    d0,_MinMouseX
	 move.l    d0,_MaxMouseX

	 move.l    a0,_ActiveGuiObject

	 move.l    d1,DRBOffset
	 move.w    GuiSelP,d0
	 sub.w     GuiP,d0
	 move.w    d0,DRBSelOffset

	 move.l    d1,d0
	 add.l     _MinGuiPos(pc),d0
	 move.l    d0,_MinMouseY

	 add.l     _MaxGuiPos(pc),d1
	 move.l    d1,_MaxMouseY

	 lea       DRBMouseHook(pc),a0
	 move.l    a0,_MouseHook

	 ;move.l    #CopEnd,_GuiL1Ptr
	 rts

DRBHandler:
	 tst.b     _LMBState
	 bne.s     .Ok

	 clr.l     _MouseHook
	 clr.l     _ActiveGuiObject

	 clr.l     _MinMouseX
	 clr.l     _MinMouseY

	 move.l    #GuiScreenWidth,_MaxMouseX
	 move.l    #256,_MaxMouseY

	 move.l    _CurrentGuiObject,a0
	 DOMTDJI   GM_Move,a0

.Ok:
	 rts

DRBMouseHook:
	 move.l    _MouseY(pc),d0
	 sub.l     DRBOffset(pc),d0
	 move.l    d0,_GuiPos

	 add.l     #$28,d0
	 move.w    d0,GuiP

	 add.w     DRBSelOffset,d0
	 move.w    d0,GuiSelP
	 rts

DRBOffset:
	 ds.l      1
DRBSelOffset:
	 ds.w      1
;fe
;fs "SmallButtonClass"
_SmallButtonClass:
	 dc.l      0
	 dc.l      _ButtonClass
	 dc.l      0,0,0,0,0
	 dc.l      sbtn_DataSize
	 dc.l      empty_Funcs
	 dc.l      smallbutton_data
	 dc.l      0
	 dc.l      smallbutton_Init

smallbutton_data:
	 dc.l      " ",0,0

smallbutton_Init:
	 move.l    #GCM_GetMinMax,d0
	 lea       SBTGetMinMax,a1
	 bsr       _SetMethod
	 move.l    d0,SBTSGetMinMax
	 rts

SBTSGetMinMax:
	 ds.l      1

SBTGetMinMax:
	 move.l    a2,-(a7)

	 move.l    a0,a2

	 LDATAEAI  SBDT_Char,a0,a1

.Loop:
	 tst.b     (a1)+
	 beq.s     .Loop
	 subq.l    #1,a1

	 SDATALI   a1,BDTA_Label,a0

	 move.l    a2,a0
	 move.l    SBTSGetMinMax(pc),a1
	 jsr       (a1)

	 LBLOCKEAI GuiRootClass_ID,a2,a1
	 move.l    guir_DTA_MinWidth(a1),d0

	 LDATALI   SBDT_Width,a2,d1
	 beq.s     .Ok
	 move.l    d1,d0
	 move.l    d0,guir_DTA_MinWidth(a1)
.Ok:

	 move.l    d0,guir_DTA_MaxWidth(a1)

	 move.l    (a7)+,a2
	 rts
;fe
;fs "TextClass"
_TextClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      txt_DataSize
	 dc.l      empty_Funcs
	 dc.l      text_data
	 dc.l      0
	 dc.l      text_Init

text_data:
	 dc.l      0,0

text_Funcs:
	 dc.l      0

text_Init:
	 move.l    #GCM_GetMinMax,d0
	 lea       TXTGetMinMax,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       TXTRender,a1
	 bsr       _SetMethod
	 rts

TXTGetMinMax:
	 movem.l   d2-3/a2-4/a6,-(a7)

	 move.l    a0,a4
	 LBLOCKEAI TextClass_ID,a0,a0

	 move.l    txt_TDTA_Text(a0),a1
	 move.l    txt_TDTA_FData(a0),d0
	 beq.s     .TrucEtTout

	 move.l    a0,-(a7)
	 move.l    (AbsExecBase).w,a6
	 move.l    a1,a0
	 move.l    d0,a1
	 lea       TXTPutChar(pc),a2
	 lea       _StrBuf,a3
	 CALL      RawDoFmt
	 move.l    (a7)+,a0
	 lea       _StrBuf,a1
	 lea       CustomBase,a6

	 moveq     #0,d0

.TrucEtTout:
	 moveq     #0,d1

.LLoop:
	 addq.l    #1,d0

	 cmp.b     #$9b,(a2)
	 bne.s     .Gargl
	 move.b    1(a2),d2
	 beq.s     .Gargl
	 cmp.b     #$a,d2
	 beq.s     .Gargl
	 addq.l    #2,a1
.Gargl:
	 move.l    a1,a2

.CLoop:
	 move.b    (a2)+,d2
	 beq.s     .CLDone
	 cmp.b     #$a,d2
	 bne.s     .CLoop
.CLDone:

	 move.l    a2,d3
	 sub.l     a1,d3

	 cmp.l     d3,d1
	 bcc.s     .Baâââh
	 move.l    d3,d1
.Baâââh:

	 move.l    a2,a1
	 tst.b     d2
	 bne.s     .LLoop

	 lsl.l     #3,d0
	 LBLOCKEAI GuiRootClass_ID,a4,a0
	 move.l    d0,guir_DTA_MinHeight(a0)
	 move.l    d0,guir_DTA_MaxHeight(a0)

	 subq.l    #1,d1
	 lsl.l     #3,d1

	 move.l    d1,guir_DTA_MinWidth(a0)

	 movem.l   (a7)+,d2-3/a2-4/a6
	 rts

TXTRender:
	 movem.l   d2-7/a2-3/a5-6,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 move.l    gd_Width(a1),d1

	 LBLOCKEAI TextClass_ID,a0,a0
	 move.l    txt_TDTA_Text(a0),a5
	 moveq     #0,d7
	 move.l    txt_TDTA_FData(a0),d0
	 beq.s     .LLoop

	 movem.l   d1/a1,-(a7)
	 move.l    (AbsExecBase).w,a6
	 move.l    a5,a0
	 move.l    d0,a1
	 lea       TPutChar(pc),a2
	 lea       _StrBuf,a3
	 CALL      RawDoFmt
	 lea       _StrBuf,a5
	 lea       CustomBase,a6
	 movem.l   (a7)+,d1/a1

.LLoop:
	 move.l    a5,a1
	 moveq     #0,d3

	 cmp.b     #$9b,(a1)
	 bne.s     .CLoop
	 cmp.b     #"-",1(a1)
	 beq.s     .ThinBar
	 cmp.b     #"=",1(a1)
	 bne.s     .CLoop

	 movem.l   d1/d6/d7,-(a7)
	 move.l    d1,d2
	 subq.l    #4,d2
	 moveq     #2,d0
	 move.l    d7,d1
	 addq.l    #2,d1
	 moveq     #3,d3
	 st        d4
	 bsr       _DrawBevelBox

	 moveq     #3,d3
	 moveq     #4,d4
	 move.l    d1,d5
	 addq.l    #1,d5
	 move.l    d2,d6
	 subq.l    #4,d6
	 moveq     #1,d7
	 bsr       _DrawRectangle

	 movem.l   (a7)+,d1/d6/d7

	 bra.s     .BarOk

.ThinBar:
	 move.l    d1,-(a7)
	 move.l    d1,d2
	 subq.l    #4,d2
	 moveq     #2,d0
	 move.l    d7,d1
	 addq.l    #3,d1
	 moveq     #2,d3
	 st        d4
	 bsr       _DrawBevelBox
	 move.l    (a7)+,d1

.BarOk:
	 addq.l    #2,a1
	 addq.l    #2,a5
	 st        d3

.CLoop:
	 move.b    (a1)+,d2
	 beq.s     .CLDone
	 cmp.b     #$a,d2
	 bne.s     .CLoop
.CLDone:
	 move.l    a1,d5
	 sub.l     a5,d5
	 subq.l    #1,d5
	 beq.s     .Poisse

	 move.l    d5,d0
	 lsl.l     #3,d0
	 move.l    d1,d6
	 sub.l     d0,d6
	 lsr.l     #1,d6

	 tst.b     d3
	 beq.s     .NoBar
	 move.l    d5,d2
	 moveq     #0,d3
	 move.l    d6,d4
	 subq.l    #2,d4
	 move.l    d7,d5
	 addq.l    #2,d5
	 move.l    d0,d6
	 addq.l    #4,d6
	 move.l    d7,d0
	 moveq     #3,d7
	 bsr       _DrawRectangle
	 move.l    d0,d7
	 move.l    d4,d6
	 addq.l    #2,d6
	 move.l    d2,d5
.NoBar:

	 moveq     #1,d4
	 bsr       _DrawText

.Poisse:
	 move.l    a1,a5
	 addq.l    #8,d7

	 tst.b     d2
	 bne.s     .LLoop

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7/a2-3/a5-6
	 rts

TXTPutChar:
	 move.b    d0,(a3)+
	 rts
;fe
;fs "FixedTextClass"
_FixedTextClass:
	 dc.l      0
	 dc.l      _TextClass
	 dc.l      0,0,0,0,0
	 dc.l      0
	 dc.l      empty_Funcs
	 dc.l      0
	 dc.l      0
	 dc.l      ftext_Init

ftext_Init:
	 move.l    #GCM_GetMinMax,d0
	 lea       FTXGetMinMax,a1
	 bsr       _SetMethod
	 move.l    d0,FTXSGetMinMax
	 rts

FTXSGetMinMax:
	 ds.l      1

FTXGetMinMax:
	 move.l    a2,-(a7)

	 move.l    a0,a2

	 move.l    FTXSGetMinMax(pc),a1
	 jsr       (a1)

	 LBLOCKEAI GuiRootClass_ID,a2,a0
	 move.l    guir_DTA_MinWidth(a0),guir_DTA_MaxWidth(a0)

	 move.l    (a7)+,a2
	 rts
;fe
;fs "HPropClass"
_HPropClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      hpr_DataSize
	 dc.l      hprop_Funcs
	 dc.l      hprop_data
	 dc.l      0
	 dc.l      hprop_Init

hprop_data:
	 dc.l      1,10,1
	 dc.l      0,0,0,0

hprop_Funcs:
	 dc.l      HPRDecr
	 dc.l      HPRIncr
	 dc.l      0

hprop_Init:
	 LBLOCKEAI GuiRootClass_ID,a2,a3
	 add.l     a1,a3

	 moveq     #12,d0
	 move.l    d0,guir_DTA_MinHeight(a3)
	 move.l    d0,guir_DTA_MaxHeight(a3)
	 clr.l     guir_DTA_MaxWidth(a3)
	 move.l    #50,guir_DTA_MinWidth(a3)

	 move.l    #GCM_Layout,d0
	 lea       HPRLayout,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       HPRRender,a1
	 bsr       _SetMethod
	 move.l    #GCM_Update,d0
	 lea       HPRUpdate,a1
	 bsr       _SetMethod
	 move.l    #GCM_Click,d0
	 lea       HPRClick,a1
	 bsr       _SetMethod
	 move.l    #GCM_Handle,d0
	 lea       HPRHandler,a1
	 bsr       _SetMethod
	 rts

HPRLayout:
	 movem.l   d2-5,-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    gd_Width(a1),d0
	 subq.l    #8,d0
	 move.l    d0,d1

	 LBLOCKEAI HPropClass_ID,a0,a1
	 move.l    hpr_HPDT_Total(a1),d2

	 move.l    hpr_HPDT_Visible(a1),d3
	 cmp.l     d2,d3
	 bcc.s     .FullKnob

	 mulu      d3,d1
	 divu      d2,d1
	 ext.l     d1

	 cmp.l     #14,d1
	 bcc.s     .FullKnob
	 moveq     #14,d1

.FullKnob:
	 move.l    d1,hpr_HPDT_KnobSize(a1)

	 sub.l     d1,d0
	 move.l    d0,hpr_HPDT_MaxPos(a1)

	 bsr.s     HPRCalcKnobPos
	 cmp.l     d4,d5
	 sne       d0

	 tst.l     hpr_HPDT_LayoutNotify(a1)
	 beq.s     .Groumpf
	 tst.b     d0
	 beq.s     .Groumpf
	 move.l    hpr_HPDT_Position(a1),d1
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Groumpf
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 moveq     #-1,d2
	 jsr       (a1)
.Groumpf:

	 moveq     #0,d0
	 movem.l   (a7)+,d2-5
	 rts

HPRDecr:
	 LBLOCKEAI HPropClass_ID,a0,a1
	 sub.l     #1,hpr_HPDT_Position(a1)
	 DOMTDJI   GCM_Update,a0

HPRIncr:
	 LBLOCKEAI HPropClass_ID,a0,a1
	 add.l     #1,hpr_HPDT_Position(a1)
	 DOMTDJI   GCM_Update,a0

HPRUpdate:
	 movem.l   d2-7,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain
	 LBLOCKEAI HPropClass_ID,a0,a1

	 bsr.s     HPRCalcKnobPos
	 cmp.l     d4,d5
	 sne       d7

	 bsr.s     HPRClearKnob
	 bsr.s     HPRRenderKnob

	 tst.b     d7
	 beq.s     .Groumpf
	 move.l    hpr_HPDT_Position(a1),d1
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Groumpf
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 moveq     #0,d2
	 jsr       (a1)
.Groumpf:

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7
	 rts

HPRCalcKnobPos:
	 movem.l   hpr_HPDT_Total(a1),d1-2
	 move.l    hpr_HPDT_Position(a1),d4
	 move.l    d4,d5
	 bpl.s     .MinOk

	 moveq     #0,d5
.MinOk:

	 move.l    d1,d3
	 sub.l     d2,d3
	 bpl.s     .Ok
	 moveq     #0,d3
.Ok:

	 cmp.l     d5,d3
	 bcc.s     .MaxOk
	 move.l    d3,d5
.MaxOk:

	 move.l    d5,hpr_HPDT_Position(a1)
	 move.l    d5,d0

	 mulu      hpr_HPDT_MaxPos+2(a1),d0
	 sub.l     d2,d1
	 beq.s     .FullKnob

	 divu      d1,d0
	 ext.l     d0

	 move.l    hpr_HPDT_MaxPos(a1),d1
	 cmp.l     d0,d1
	 bcc.s     .MaxPosOk
	 move.l    d1,d0
.MaxPosOk:

	 addq.l    #4,d0
	 move.l    d0,hpr_HPDT_KnobPos(a1)
	 rts

.FullKnob:
	 moveq     #2,d0
	 move.l    d0,hpr_HPDT_KnobPos(a1)
	 rts

HPRRender:
	 movem.l   d2-4,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI HPropClass_ID,a0,a1

	 LBLOCKEAI GuiRootClass_ID,a0,a0
	 move.l    a0,_CurrentDomain
	 moveq     #0,d0
	 moveq     #0,d1
	 movem.l   gd_Width(a0),d2-3
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #2,d0
	 moveq     #1,d1
	 movem.l   gd_Width(a0),d2-3
	 subq.l    #4,d2
	 subq.l    #2,d3
	 st        d4
	 bsr.s     _DrawBevelBox

	 bsr.s     HPRRenderKnob

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-4
	 rts

HPRRenderKnob:
	 moveq     #2,d1
	 moveq     #8,d3
	 movem.l   hpr_HPDT_KnobPos(a1),d0/d2
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #4,d1
	 move.l    hpr_HPDT_KnobSize(a1),d0
	 subq.l    #6,d0
	 lsr.l     #1,d0
	 add.l     hpr_HPDT_KnobPos(a1),d0
	 bra.s     _DrawPropHole

HPRRenderKnobSelected:
	 moveq     #2,d1
	 moveq     #8,d3
	 movem.l   hpr_HPDT_KnobPos(a1),d0/d2
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #3,d5
	 moveq     #6,d7
	 movem.l   hpr_HPDT_KnobPos(a1),d4/d6
	 addq.l    #2,d4
	 subq.l    #4,d6
	 moveq     #3,d3
	 bsr.s     _DrawRectangle

	 moveq     #4,d1
	 move.l    hpr_HPDT_KnobSize(a1),d0
	 subq.l    #6,d0
	 lsr.l     #1,d0
	 add.l     hpr_HPDT_KnobPos(a1),d0
	 bra.s     _DrawPropHole

HPRClearKnob:
	 moveq     #2,d5
	 moveq     #8,d7
	 movem.l   hpr_HPDT_KnobPos(a1),d4/d6
	 moveq     #0,d3
	 bra.s     _DrawRectangle

HPRClick:
	 movem.l   d2-7,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 move.l    d0,d3
	 sub.l     gd_Left(a1),d0

	 LBLOCKEAI HPropClass_ID,a0,a1

	 move.l    hpr_HPDT_KnobPos(a1),d2
	 cmp.l     d2,d0
	 bcs.s     .BeforeKnob
	 add.l     hpr_HPDT_KnobSize(a1),d2
	 cmp.l     d2,d0
	 bcc.s     .AfterKnob

	 sub.l     hpr_HPDT_KnobPos(a1),d3
	 move.l    d3,HPROffset

	 add.l     _GuiPos(pc),d1
	 move.l    d1,_MinMouseY
	 move.l    d1,_MaxMouseY

	 addq.l    #4,d3
	 move.l    d3,d1

	 move.l    d3,_MinMouseX

	 add.l     hpr_HPDT_MaxPos(a1),d1
	 move.l    d1,_MaxMouseX

	 move.l    #-1,_ActiveGuiObjData
	 move.l    a0,_ActiveGuiObject
	 bsr.s     HPRRenderKnobSelected

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7
	 rts

.AfterKnob:
	 move.l    hpr_HPDT_Visible(a1),d1
	 subq.l    #1,d1
	 bne.s     .AKOkIncr
	 moveq     #1,d1
.AKOkIncr:
	 move.l    hpr_HPDT_Position(a1),d0
	 add.l     d1,d0
	 bra.s     .KnobOk

.BeforeKnob:
	 move.l    hpr_HPDT_Visible(a1),d1
	 subq.l    #1,d1
	 bne.s     .BKOkIncr
	 moveq     #1,d1
.BKOkIncr:
	 move.l    hpr_HPDT_Position(a1),d0
	 sub.l     d1,d0

.KnobOk:
	 move.l    d0,hpr_HPDT_Position(a1)

	 bsr       HPRClearKnob
	 bsr       HPRCalcKnobPos
	 move.l    d0,d7
	 bsr       HPRRenderKnob

	 clr.l     _ActiveGuiObjData
	 move.l    a0,_ActiveGuiObject

	 tst.b     d7
	 beq.s     .Done

	 move.l    hpr_HPDT_Position(a1),d1
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Done
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 moveq     #0,d2
	 jsr       (a1)

.Done:
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7
	 rts

HPRHandler:
	 tst.b     d2
	 bne.s     HPRTrueHandler

	 tst.b     _LMBState
	 bne.s     .Done
	 clr.l     _ActiveGuiObject
.Done:
	 rts

HPRTrueHandler:
	 movem.l   d2-3,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 LBLOCKEAI HPropClass_ID,a0,a1

	 tst.b     _LMBState
	 beq.s     .Release

	 sub.l     HPROffset(pc),d0
	 cmp.l     hpr_HPDT_KnobPos(a1),d0
	 beq.s     .Done

	 bsr.s     HPRClearKnob
	 move.l    d0,hpr_HPDT_KnobPos(a1)
	 bsr.s     HPRRenderKnobSelected

	 move.l    hpr_HPDT_KnobPos(a1),d1
	 subq.l    #4,d1
	 move.l    hpr_HPDT_Total(a1),d0
	 sub.l     hpr_HPDT_Visible(a1),d0
	 mulu      d0,d1
	 move.l    hpr_HPDT_MaxPos(a1),d0
	 divu      d0,d1
	 ext.l     d1
	 move.l    d1,hpr_HPDT_Position(a1)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Done
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 moveq     #0,d2
	 jsr       (a1)

.Done:
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-3
	 rts

.Release:
	 clr.l     _MinMouseX
	 clr.l     _MinMouseY

	 move.l    #GuiScreenWidth,_MaxMouseX
	 move.l    #256,_MaxMouseY

	 clr.l     _ActiveGuiObject
	 bsr.s     HPRClearKnob
	 bsr.s     HPRRenderKnob

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-3
	 rts


HPROffset:
	 ds.l      1
;fe
;fs "VPropClass"
_VPropClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      vpr_DataSize
	 dc.l      vprop_Funcs
	 dc.l      vprop_data
	 dc.l      0
	 dc.l      vprop_Init

vprop_data:
	 dc.l      1,10,1
	 dc.l      0,0,0,0,0,0

vprop_Funcs:
	 dc.l      VPRDecr
	 dc.l      VPRIncr
	 dc.l      0

vprop_Init:
	 LBLOCKEAI GuiRootClass_ID,a2,a3
	 add.l     a1,a3

	 moveq     #22,d0
	 move.l    d0,guir_DTA_MinWidth(a3)
	 move.l    d0,guir_DTA_MaxWidth(a3)
	 clr.l     guir_DTA_MaxHeight(a3)
	 move.l    #19,guir_DTA_MinHeight(a3)

	 move.l    #GCM_Layout,d0
	 lea       VPRLayout,a1
	 bsr       _SetMethod
	 move.l    #GCM_Render,d0
	 lea       VPRRender,a1
	 bsr       _SetMethod
	 move.l    #GCM_Update,d0
	 lea       VPRUpdate,a1
	 bsr       _SetMethod
	 move.l    #GCM_Click,d0
	 lea       VPRClick,a1
	 bsr       _SetMethod
	 move.l    #GCM_Handle,d0
	 lea       VPRHandler,a1
	 bsr       _SetMethod
	 rts

VPRLayout:
	 movem.l   d2-5,-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    gd_Height(a1),d0
	 subq.l    #4,d0
	 move.l    d0,d1

	 LBLOCKEAI VPropClass_ID,a0,a1
	 move.l    vpr_VPDT_Total(a1),d2

	 move.l    vpr_VPDT_Visible(a1),d3
	 cmp.l     d2,d3
	 bcc.s     .FullKnob

	 mulu      d3,d1
	 divu      d2,d1
	 ext.l     d1

	 cmp.l     #8,d1
	 bcc.s     .FullKnob
	 moveq     #8,d1

.FullKnob:
	 move.l    d1,vpr_VPDT_KnobSize(a1)

	 sub.l     d1,d0
	 move.l    d0,vpr_VPDT_MaxPos(a1)

	 bsr.s     VPRCalcKnobPos
	 cmp.l     d5,d1
	 sne       d0

	 tst.l     hpr_HPDT_LayoutNotify(a1)
	 beq.s     .Groumpf
	 tst.b     d0
	 ;beq.s     .Groumpf
	 move.l    hpr_HPDT_Position(a1),d1
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Groumpf
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 moveq     #-1,d2
	 jsr       (a1)
.Groumpf:

	 moveq     #0,d0
	 movem.l   (a7)+,d2-5
	 rts

VPRDecr:
	 LBLOCKEAI VPropClass_ID,a0,a1
	 subq.l    #1,vpr_VPDT_Position(a1)
	 DOMTDJI   GCM_Update,a0

VPRIncr:
	 LBLOCKEAI VPropClass_ID,a0,a1
	 addq.l    #1,vpr_VPDT_Position(a1)
	 DOMTDJI   GCM_Update,a0

VPRUpdate:
	 movem.l   d2-7,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain
	 LBLOCKEAI VPropClass_ID,a0,a1

	 bsr.s     VPRCalcKnobPos
	 cmp.l     d5,d1
	 sne       d7

	 bsr.s     VPRClearKnob
	 bsr.s     VPRRenderKnob

	 tst.b     d7
	 ;beq.s     .Groumpf
	 move.l    vpr_VPDT_Position(a1),d1
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Groumpf
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 moveq     #0,d2
	 jsr       (a1)
.Groumpf:

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7
	 rts

VPRCalcKnobPos:
	 movem.l   vpr_VPDT_Total(a1),d2-3
	 move.l    vpr_VPDT_Position(a1),d5
	 move.l    d5,d1
	 bpl.s     .MinOk

	 moveq     #0,d5
.MinOk:

	 move.l    d2,d4
	 sub.l     d3,d4
	 bpl.s     .Ok
	 moveq     #0,d4
.Ok:

	 cmp.l     d5,d4
	 bcc.s     .MaxOk
	 move.l    d4,d5
.MaxOk:

	 move.l    d5,vpr_VPDT_Position(a1)
	 move.l    d5,d0

	 mulu      vpr_VPDT_MaxPos+2(a1),d0
	 sub.l     d3,d2
	 beq.s     .FullKnob

	 divu      d2,d0
	 ext.l     d0

	 move.l    vpr_VPDT_MaxPos(a1),d2
	 cmp.l     d0,d2
	 bcc.s     .MaxPosOk
	 move.l    d2,d0
.MaxPosOk:

	 addq.l    #2,d0
	 move.l    d0,vpr_VPDT_KnobPos(a1)
	 rts

.FullKnob:
	 moveq     #2,d0
	 move.l    d0,vpr_VPDT_KnobPos(a1)
	 rts

VPRRender:
	 movem.l   d2-4,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI VPropClass_ID,a0,a1

	 LBLOCKEAI GuiRootClass_ID,a0,a0
	 move.l    a0,_CurrentDomain
	 moveq     #0,d0
	 moveq     #0,d1
	 movem.l   gd_Width(a0),d2-3
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #2,d0
	 moveq     #1,d1
	 movem.l   gd_Width(a0),d2-3
	 subq.l    #4,d2
	 subq.l    #2,d3
	 st        d4
	 bsr.s     _DrawBevelBox

	 bsr.s     VPRRenderKnob

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-4
	 rts

VPRRenderKnob:
	 moveq     #4,d0
	 moveq     #14,d2
	 movem.l   vpr_VPDT_KnobPos(a1),d1/d3
	 movem.l   d1/d3,vpr_VPDT_OldKnobPos(a1)

	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #8,d0
	 move.l    vpr_VPDT_KnobSize(a1),d1
	 subq.l    #4,d1
	 lsr.l     #1,d1
	 add.l     vpr_VPDT_KnobPos(a1),d1
	 bra.s     _DrawPropHole

VPRRenderKnobSelected:
	 moveq     #4,d0
	 moveq     #14,d2
	 movem.l   vpr_VPDT_KnobPos(a1),d1/d3
	 movem.l   d1/d3,vpr_VPDT_OldKnobPos(a1)

	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #6,d4
	 moveq     #10,d6
	 movem.l   vpr_VPDT_KnobPos(a1),d5/d7
	 addq.l    #1,d5
	 subq.l    #2,d7
	 moveq     #3,d3
	 bsr.s     _DrawRectangle

	 moveq     #8,d0
	 move.l    vpr_VPDT_KnobSize(a1),d1
	 subq.l    #4,d1
	 lsr.l     #1,d1
	 add.l     vpr_VPDT_KnobPos(a1),d1
	 bra.s     _DrawPropHole

VPRClearKnob:
	 move.l    d7,-(a7)

	 moveq     #4,d4
	 moveq     #14,d6
	 movem.l   vpr_VPDT_OldKnobPos(a1),d5/d7
	 tst.l     d7
	 beq.s     .Done
	 moveq     #0,d3
	 bsr       _DrawRectangle

	 clr.l     vpr_VPDT_OldKnobSize(a1)
.Done:
	 move.l    (a7)+,d7
	 rts

VPRClick:
	 movem.l   d2-7,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 move.l    d1,d3
	 sub.l     gd_Top(a1),d1

	 LBLOCKEAI HPropClass_ID,a0,a1

	 move.l    vpr_VPDT_KnobPos(a1),d2
	 cmp.l     d2,d1
	 bcs.s     .BeforeKnob
	 add.l     vpr_VPDT_KnobSize(a1),d2
	 cmp.l     d2,d1
	 bcc.s     .AfterKnob

	 sub.l     vpr_VPDT_KnobPos(a1),d3
	 move.l    d3,VPROffset

	 move.l    d0,_MinMouseX
	 move.l    d0,_MaxMouseX

	 add.l     _GuiPos(pc),d3
	 addq.l    #2,d3
	 move.l    d3,d1

	 move.l    d3,_MinMouseY

	 add.l     vpr_VPDT_MaxPos(a1),d1
	 move.l    d1,_MaxMouseY

	 move.l    #-1,_ActiveGuiObjData
	 move.l    a0,_ActiveGuiObject
	 bsr.s     VPRRenderKnobSelected

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7
	 rts

.AfterKnob:
	 move.l    vpr_VPDT_Visible(a1),d0
	 subq.l    #1,d0
	 bne.s     .AKOkIncr
	 moveq     #1,d0
.AKOkIncr:
	 move.l    vpr_VPDT_Position(a1),d1
	 add.l     d1,d0
	 bra.s     .KnobOk

.BeforeKnob:
	 move.l    vpr_VPDT_Visible(a1),d0
	 subq.l    #1,d0
	 bne.s     .BKOkIncr
	 moveq     #1,d0
.BKOkIncr:
	 move.l    vpr_VPDT_Position(a1),d1
	 sub.l     d0,d1
	 exg       d0,d1

.KnobOk:
	 move.l    d0,vpr_VPDT_Position(a1)

	 bsr       VPRCalcKnobPos
	 cmp.l     d5,d1
	 sne       d7

	 bsr       VPRClearKnob
	 bsr       VPRRenderKnob

	 clr.l     _ActiveGuiObjData
	 move.l    a0,_ActiveGuiObject

	 tst.b     d7
	 ;beq.s     .Done

	 move.l    vpr_VPDT_Position(a1),d1
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Done
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 moveq     #0,d2
	 jsr       (a1)

.Done:
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7
	 rts

VPRHandler:
	 tst.b     d2
	 bne.s     VPRTrueHandler

	 tst.b     _LMBState
	 bne.s     .Done
	 clr.l     _ActiveGuiObject
.Done:
	 rts

VPRTrueHandler:
	 movem.l   d2-3,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain

	 LBLOCKEAI HPropClass_ID,a0,a1

	 tst.b     _LMBState
	 beq.s     .Release

	 sub.l     VPROffset(pc),d1
	 cmp.l     vpr_VPDT_KnobPos(a1),d1
	 beq.s     .Done

	 bsr.s     VPRClearKnob
	 move.l    d1,vpr_VPDT_KnobPos(a1)
	 bsr.s     VPRRenderKnobSelected

	 move.l    vpr_VPDT_KnobPos(a1),d1
	 subq.l    #2,d1
	 move.l    vpr_VPDT_Total(a1),d0
	 sub.l     vpr_VPDT_Visible(a1),d0
	 mulu      d0,d1
	 move.l    vpr_VPDT_MaxPos(a1),d0
	 divu      d0,d1
	 ext.l     d1
	 move.l    d1,vpr_VPDT_Position(a1)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Done
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 moveq     #0,d2
	 jsr       (a1)

.Done:
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-3
	 rts

.Release:
	 clr.l     _MinMouseX
	 clr.l     _MinMouseY

	 move.l    #GuiScreenWidth,_MaxMouseX
	 move.l    #256,_MaxMouseY

	 clr.l     _ActiveGuiObject
	 bsr.s     VPRClearKnob
	 bsr.s     VPRRenderKnob

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-3
	 rts


VPROffset:
	 ds.l      1
;fe
;fs "_DrawPropHole"
_DrawPropHole:     ; d0/d1=X,Y

	 IFNE      DISABLEGUIGFX
	 rts

	 ELSE

	 movem.l   d0-3/a0,-(a7)

	 move.l    _CurrentDomain(pc),a0
	 add.l     gd_Left(a0),d0
	 add.l     gd_Top(a0),d1

	 move.l    _GuiBitmap(pc),a0
	 mulu      #GuiLineSize,d1
	 add.l     d1,a0
	 move.l    d0,d1
	 lsr.l     #3,d1
	 add.l     d1,a0

	 not.l     d0
	 and.l     #7,d0
	 addq.l    #3,d0

.RWait:
	 tst.l     _RectCount
	 bne.s     .RWait

	 moveq     #$1c,d1
	 lsl.w     d0,d1
	 or.w      d1,(a0)
	 lea       GuiBufferWidth(a0),a0
	 not.w     d1
	 and.w     d1,(a0)
	 lea       GuiBufferWidth(a0),a0

	 moveq     #$3f,d1
	 lsl.w     d0,d1
	 not.w     d1

	 move.w    (a0),d3
	 and.w     d1,d3
	 moveq     #$38,d2
	 lsl.w     d0,d2
	 or.w      d2,d3
	 move.w    d3,(a0)
	 lea       GuiBufferWidth(a0),a0
	 move.w    (a0),d3
	 and.w     d1,d3
	 moveq     #3,d2
	 lsl.w     d0,d2
	 or.w      d2,d3
	 move.w    d3,(a0)
	 lea       GuiBufferWidth(a0),a0

	 move.w    (a0),d3
	 and.w     d1,d3
	 moveq     #$30,d2
	 lsl.w     d0,d2
	 or.w      d2,d3
	 move.w    d3,(a0)
	 lea       GuiBufferWidth(a0),a0
	 move.w    (a0),d3
	 and.w     d1,d3
	 moveq     #7,d2
	 lsl.w     d0,d2
	 or.w      d2,d3
	 move.w    d3,(a0)
	 lea       GuiBufferWidth(a0),a0

	 moveq     #$e,d1
	 lsl.w     d0,d1
	 move.w    d1,d2
	 not.w     d2
	 and.w     d2,(a0)
	 lea       GuiBufferWidth(a0),a0
	 or.w      d1,(a0)

	 movem.l   (a7)+,d0-3/a0
	 rts

	 ENDIF
;fe
;fs "HScrollerClass"
_HScrollerClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      hsc_DataSize
	 dc.l      hscroller_Funcs
	 dc.l      hscroller_data
	 dc.l      0
	 dc.l      hscroller_Init

hscroller_data:
	 dc.l      1,10,1
	 dc.l      0,0

hscroller_Funcs:
	 dc.l      HSCRDecr
	 dc.l      HSCRIncr
	 dc.l      0

hscroller_Init:
	 move.l    #MTD_New,d0
	 lea       HSCRNew,a1
	 bsr       _SetMethod
	 move.l    d0,HSCRSNew

	 move.l    #GCM_GetMinMax,d0
	 lea       HSCRGetMinMax,a1
	 bsr       _SetMethod

	 move.l    #GCM_Layout,d0
	 lea       HSCRLayout,a1
	 bsr       _SetMethod
	 move.l    d0,HSCRSLayout

	 move.l    #GCM_Render,d0
	 lea       HSCRRender,a1
	 bsr       _SetMethod
	 move.l    d0,HSCRSRender

	 move.l    #GCM_Update,d0
	 lea       HSCRUpdate,a1
	 bsr       _SetMethod

	 move.l    #GCM_Click,d0
	 lea       HSCRClick,a1
	 bsr       _SetMethod
	 move.l    d0,HSCRSClick
	 rts

HSCRSNew:
	 ds.l      1
HSCRSLayout:
	 ds.l      1
HSCRSRender:
	 ds.l      1
HSCRSClick:
	 ds.l      1

HSCRNew:
	 movem.l   a2-3,-(a7)

	 move.l    a0,a3
	 move.l    HSCRSNew(pc),a1
	 jsr       (a1)

	 ;LBLOCKEAI HScrollerClass_ID,a3,a0
	 move.l    a3,HSCRHDat1
	 move.l    a3,HSCRHDat2
	 move.l    a3,HSCRHDat3

	 lea       HSCRTree,a0
	 bsr       _CreateObjectTree
	 tst.l     d0
	 beq.s     .Fail

	 move.l    d0,a2
	 DOMTDI    MTD_AddMember,a3

	 SDATALI   HSCRProp,HSDT_Prop,a3

	 moveq     #-1,d0
.Fail:
	 movem.l   (a7)+,a2-3
	 rts

HSCRProp:
	 ds.l      1

HSCRTree:
	 dc.l      OBJ_Begin,_HGroupClass
	 dc.l      HGDT_Spacing,0

	 dc.l      OBJ_Begin,_HPropClass
	 dc.l      HPDT_Position
HSCRPos:
	 dc.l      1
	 dc.l      HPDT_Total
HSCRTot:
	 dc.l      11
	 dc.l      HPDT_Visible
HSCRVis:
	 dc.l      1
	 dc.l      DTA_HookData
HSCRHDat1:
	 dc.l      0
	 dc.l      DTA_Hook,HSCRPropHook
	 STOOBJ    HSCRProp

	 dc.l      OBJ_Begin,_SmallButtonClass
	 dc.l      SBDT_Char,$8e
	 dc.l      SBDT_Width,18
	 dc.l      BDTA_Repeat,5
	 dc.l      DTA_Hook,HSCRDecrHook
	 dc.l      DTA_HookData
HSCRHDat2:
	 dc.l      0
	 ENDOBJ

	 dc.l      OBJ_Begin,_SmallButtonClass
	 dc.l      SBDT_Char,$8d
	 dc.l      SBDT_Width,18
	 dc.l      BDTA_Repeat,5
	 dc.l      DTA_Hook,HSCRIncrHook
	 dc.l      DTA_HookData
HSCRHDat3:
	 dc.l      0
	 ENDOBJ

	 ENDOBJ

HSCRPropHook:
	 move.l    d3,-(a7)

	 move.l    d0,a0
	 LBLOCKEAI HScrollerClass_ID,a0,a1
	 move.l    d1,hsc_HSDT_Position(a1)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Done
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 jsr       (a1)

.Done:
	 move.l    (a7)+,d3
	 rts

HSCRIncrHook:
	 move.l    d0,a0
	 LDATALI   HSDT_Prop,a0,a0
	 DOMTDJI   HPM_Incr,a0

HSCRDecrHook:
	 move.l    d0,a0
	 LDATALI   HSDT_Prop,a0,a0
	 DOMTDJI   HPM_Decr,a0

HSCRGetMinMax:
	 movem.l   d2-3/a2-3,-(a7)

	 move.l    a0,a3
	 LBLOCKEAI RootClass_ID,a0,a1
	 move.l    (a1),a2
	 DOMTDI    GCM_GetMinMax,a2

	 LBLOCKEAI GuiRootClass_ID,a2,a2
	 movem.l   guir_DTA_MinWidth(a2),d0-3
	 LBLOCKEAI GuiRootClass_ID,a3,a3
	 movem.l   d0-3,guir_DTA_MinWidth(a3)

	 movem.l   (a7)+,d2-3/a2-3
	 rts

HSCRLayout:
	 movem.l   d2-5/a2-4,-(a7)

	 LBLOCKEAI HScrollerClass_ID,a0,a4
	 move.l    hsc_HSDT_Prop(a4),a2
	 LBLOCKEAI HPropClass_ID,a2,a3
	 movem.l   (a4),d0-3
	 movem.l   d0-3,(a3)

	 LBLOCKEAI GuiRootClass_ID,a0,a2
	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 movem.l   (a2),d0-5
	 movem.l   d0-5,(a1)

	 DOMTDI    GCM_Layout,a0
	 move.l    vpr_VPDT_Position(a3),vsc_VSDT_Position(a4)

	 moveq     #0,d0
	 movem.l   (a7)+,d2-5/a2-4
	 rts

HSCRRender:
	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 DOMTDJI   GCM_Render,a0

HSCRUpdate:
	 LDATALI   HSDT_Prop,a0,a0
	 DOMTDJI   GCM_Update,a0

HSCRClick:
	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 DOMTDJI   GCM_Click,a0

HSCRIncr:
	 LDATALI   HSDT_Prop,a0,a0
	 DOMTDJI   HPM_Incr,a0

HSCRDecr:
	 LDATALI   HSDT_Prop,a0,a0
	 DOMTDJI   HPM_Decr,a0
;fe
;fs "VScrollerClass"
_VScrollerClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      vsc_DataSize
	 dc.l      vscroller_Funcs
	 dc.l      vscroller_data
	 dc.l      0
	 dc.l      vscroller_Init

vscroller_data:
	 dc.l      1,10,1
	 dc.l      0,0

vscroller_Funcs:
	 dc.l      VSCRDecr
	 dc.l      VSCRIncr
	 dc.l      0

vscroller_Init:
	 move.l    #MTD_New,d0
	 lea       VSCRNew,a1
	 bsr       _SetMethod
	 move.l    d0,VSCRSNew

	 move.l    #GCM_GetMinMax,d0
	 lea       VSCRGetMinMax,a1
	 bsr       _SetMethod

	 move.l    #GCM_Layout,d0
	 lea       VSCRLayout,a1
	 bsr       _SetMethod
	 move.l    d0,VSCRSLayout

	 move.l    #GCM_Render,d0
	 lea       VSCRRender,a1
	 bsr       _SetMethod
	 move.l    d0,VSCRSRender

	 move.l    #GCM_Update,d0
	 lea       VSCRUpdate,a1
	 bsr       _SetMethod

	 move.l    #GCM_Click,d0
	 lea       VSCRClick,a1
	 bsr       _SetMethod
	 move.l    d0,VSCRSClick
	 rts

VSCRSNew:
	 ds.l      1
VSCRSLayout:
	 ds.l      1
VSCRSRender:
	 ds.l      1
VSCRSClick:
	 ds.l      1

VSCRNew:
	 movem.l   a2-3,-(a7)

	 move.l    a0,a3
	 move.l    VSCRSNew(pc),a1
	 jsr       (a1)

	 ;LBLOCKEAI VScrollerClass_ID,a3,a0
	 move.l    a3,VSCRHDat1
	 move.l    a3,VSCRHDat2
	 move.l    a3,VSCRHDat3

	 lea       VSCRTree,a0
	 bsr       _CreateObjectTree
	 tst.l     d0
	 beq.s     .Fail

	 move.l    d0,a2
	 DOMTDI    MTD_AddMember,a3

	 SDATALI   VSCRProp,VSDT_Prop,a3

	 moveq     #-1,d0
.Fail:
	 movem.l   (a7)+,a2-3
	 rts

VSCRProp:
	 ds.l      1

VSCRTree:
	 dc.l      OBJ_Begin,_VGroupClass
	 dc.l      VGDT_Spacing,0

	 dc.l      OBJ_Begin,_VPropClass
	 dc.l      VPDT_Position
VSCRPos:
	 dc.l      1
	 dc.l      VPDT_Total
VSCRTot:
	 dc.l      11
	 dc.l      VPDT_Visible
VSCRVis:
	 dc.l      1
	 dc.l      DTA_HookData
VSCRHDat1:
	 dc.l      0
	 dc.l      DTA_Hook,VSCRPropHook
	 STOOBJ    VSCRProp

	 dc.l      OBJ_Begin,_SmallButtonClass
	 dc.l      SBDT_Char,$90
	 dc.l      SBDT_Width,22
	 dc.l      BDTA_Repeat,5
	 dc.l      DTA_Hook,VSCRDecrHook
	 dc.l      DTA_HookData
VSCRHDat2:
	 dc.l      0
	 ENDOBJ

	 dc.l      OBJ_Begin,_SmallButtonClass
	 dc.l      SBDT_Char,$8f
	 dc.l      SBDT_Width,22
	 dc.l      BDTA_Repeat,5
	 dc.l      DTA_Hook,VSCRIncrHook
	 dc.l      DTA_HookData
VSCRHDat3:
	 dc.l      0
	 ENDOBJ

	 ENDOBJ

VSCRPropHook:
	 move.l    d3,-(a7)

	 move.l    d0,a0
	 LBLOCKEAI VScrollerClass_ID,a0,a1
	 move.l    d1,vsc_VSDT_Position(a1)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    guir_DTA_Hook(a1),d3
	 beq.s     .Done
	 move.l    guir_DTA_HookData(a1),d0
	 move.l    d3,a1
	 jsr       (a1)

.Done:
	 move.l    (a7)+,d3
	 rts

VSCRIncrHook:
	 move.l    d0,a0
	 LDATALI   VSDT_Prop,a0,a0
	 DOMTDJI   VPM_Incr,a0

VSCRDecrHook:
	 move.l    d0,a0
	 LDATALI   VSDT_Prop,a0,a0
	 DOMTDJI   VPM_Decr,a0

VSCRGetMinMax:
	 movem.l   d2-3/a2-3,-(a7)

	 move.l    a0,a3
	 LBLOCKEAI RootClass_ID,a0,a1
	 move.l    (a1),a2
	 DOMTDI    GCM_GetMinMax,a2

	 LBLOCKEAI GuiRootClass_ID,a2,a2
	 movem.l   guir_DTA_MinWidth(a2),d0-3
	 LBLOCKEAI GuiRootClass_ID,a3,a3
	 movem.l   d0-3,guir_DTA_MinWidth(a3)

	 movem.l   (a7)+,d2-3/a2-3
	 rts

VSCRLayout:
	 movem.l   d2-5/a2-4,-(a7)

	 LBLOCKEAI VScrollerClass_ID,a0,a4
	 move.l    vsc_VSDT_Prop(a4),a2
	 LBLOCKEAI VPropClass_ID,a2,a3
	 movem.l   (a4),d0-3
	 movem.l   d0-3,(a3)

	 LBLOCKEAI GuiRootClass_ID,a0,a2
	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 movem.l   (a2),d0-5
	 movem.l   d0-5,(a1)

	 DOMTDI    GCM_Layout,a0
	 move.l    vpr_VPDT_Position(a3),vsc_VSDT_Position(a4)

	 moveq     #0,d0
	 movem.l   (a7)+,d2-5/a2-4
	 rts

VSCRRender:
	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 DOMTDJI   GCM_Render,a0

VSCRUpdate:
	 LDATALI   VSDT_Prop,a0,a0
	 DOMTDJI   GCM_Update,a0

VSCRClick:
	 LBLOCKEAI RootClass_ID,a0,a0
	 move.l    (a0),a0
	 DOMTDJI   GCM_Click,a0

VSCRIncr:
	 LDATALI   VSDT_Prop,a0,a0
	 DOMTDJI   VPM_Incr,a0

VSCRDecr:
	 LDATALI   VSDT_Prop,a0,a0
	 DOMTDJI   VPM_Decr,a0
;fe
;fs "ScrollAreaClass"
;fs "Structure"
_ScrollAreaClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      sac_DataSize
	 dc.l      scrollarea_Funcs
	 dc.l      scrollarea_data
	 dc.l      0
	 dc.l      scrollarea_Init

scrollarea_data:
	 ds.b      sac_DataSize

scrollarea_Funcs:
	 dc.l      SACNop
	 dc.l      SACNop
	 dc.l      SACNop
	 dc.l      SACNop
	 dc.l      SACNop
	 dc.l      SACNop
	 dc.l      SACNop
	 dc.l      SACVDecr
	 dc.l      SACVIncr
	 dc.l      SACHDecr
	 dc.l      SACHIncr
	 dc.l      0
;fe
;fs "Init"
scrollarea_Init:
	 move.l    #MTD_New,d0
	 lea       SACNew,a1
	 bsr       _SetMethod
	 move.l    d0,SACSNew

	 move.l    #GCM_GetMinMax,d0
	 lea       SACGetMinMax,a1
	 bsr       _SetMethod

	 move.l    #GCM_Layout,d0
	 lea       SACLayout,a1
	 bsr       _SetMethod

	 move.l    #GCM_Render,d0
	 lea       SACRender,a1
	 bsr       _SetMethod

	 move.l    #GCM_Update,d0
	 lea       SACUpdate,a1
	 bsr       _SetMethod

	 move.l    #GCM_UnderMouse,d0
	 lea       SACUnderMouse,a1
	 bsr       _SetMethod

	 move.l    #GCM_Click,d0
	 lea       SACClick,a1
	 bsr       _SetMethod
	 rts

SACSNew:
	 ds.l      1
;fe

;fs "Nop"
SACNop:
	 rts
;fe
;fs "New"
SACNew:
	 movem.l   a2-4,-(a7)

	 move.l    a0,a3
	 move.l    SACSNew(pc),a1
	 jsr       (a1)

	 LBLOCKEAI ScrollAreaClass_ID,a3,a4

	 lea       _HScrollerClass,a0
	 sub.l     a1,a1
	 bsr       _NewObject
	 move.l    d0,sac_SADT_HScroller(a4)
	 beq.s     .Fail

	 move.l    d0,a2
	 moveq     #-1,d0
	 SDATALI   d0,HSDT_LayoutNotify,a2

	 LBLOCKEAI GuiRootClass_ID,a2,a0
	 lea       SACHorHook(pc),a1
	 movem.l   a1/a3,guir_DTA_Hook(a0)

	 DOMTDI    MTD_AddMember,a3

	 lea       _VScrollerClass,a0
	 sub.l     a1,a1
	 bsr       _NewObject
	 move.l    d0,sac_SADT_VScroller(a4)
	 beq.s     .Fail

	 move.l    d0,a2
	 moveq     #-1,d0
	 SDATALI   d0,VSDT_LayoutNotify,a2

	 LBLOCKEAI GuiRootClass_ID,a2,a0
	 lea       SACVerHook(pc),a1
	 movem.l   a1/a3,guir_DTA_Hook(a0)

	 DOMTDI    MTD_AddMember,a3

	 moveq     #-1,d0
.Fail:
	 movem.l   (a7)+,a2-4
	 rts
;fe
;fs "GetMinMax"
SACGetMinMax:
	 movem.l   a2-5,-(a7)

	 LBLOCKEAI ScrollAreaClass_ID,a0,a2
	 LBLOCKEAI GuiRootClass_ID,a0,a3

	 move.l    sac_SADT_HScroller(a2),a4
	 DOMTDI    GCM_GetMinMax,a4

	 move.l    sac_SADT_VScroller(a2),a5
	 DOMTDI    GCM_GetMinMax,a5

	 LBLOCKEAI GuiRootClass_ID,a4,a0
	 LBLOCKEAI GuiRootClass_ID,a5,a1

	 move.l    guir_DTA_MinHeight(a1),guir_DTA_MinHeight(a3)
	 move.l    guir_DTA_MinWidth(a1),d0
	 add.l     guir_DTA_MinWidth(a0),d0
	 move.l    d0,guir_DTA_MinWidth(a3)

	 movem.l   (a7)+,a2-5
	 rts
;fe
;fs "Layout"
SACLayout:
	 movem.l   d2-3/d6-7/a2-6,-(a7)

	 move.l    a0,a6
	 LBLOCKEAI GuiRootClass_ID,a0,a2
	 LBLOCKEAI ScrollAreaClass_ID,a0,a3

	 move.l    gd_Width(a2),d0
	 subq.l    #4,d0
	 move.l    d0,sac_SADT_ContentsWidthNVS(a3)

	 move.l    sac_SADT_VScroller(a3),a1
	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 sub.l     guir_DTA_MinWidth(a1),d0
	 move.l    d0,sac_SADT_ContentsWidthVS(a3)

	 move.l    gd_Height(a2),d0
	 subq.l    #3,d0
	 move.l    d0,sac_SADT_ContentsHeightNHS(a3)

	 move.l    sac_SADT_HScroller(a3),a1
	 LBLOCKEAI GuiRootClass_ID,a1,a1
	 sub.l     guir_DTA_MinHeight(a1),d0
	 move.l    d0,sac_SADT_ContentsHeightHS(a3)

	 DOMTDI    SAM_ContentsGetSizes,a0

	 bsr.s     SACCheckScrollers

	 moveq     #0,d0
	 movem.l   (a7)+,d2-3/d6-7/a2-6
	 rts
;fe
;fs "Render"
SACRender:
	 movem.l   d2-4/a2-3,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 move.l    a0,a2

	 LBLOCKEAI GuiRootClass_ID,a2,a1
	 move.l    a1,_CurrentDomain

	 LBLOCKEAI ScrollAreaClass_ID,a2,a3

	 moveq     #0,d0
	 moveq     #0,d1
	 movem.l   sac_SADT_BoxWidth(a3),d2-3
	 st        d4
	 bsr       _DrawBevelBox

	 tst.l     sac_SADT_VSFlag(a3)
	 beq.s     .NoVScroller

	 move.l    sac_SADT_VScroller(a3),a0
	 DOMTDI    GCM_Render,a0
.NoVScroller:

	 tst.l     sac_SADT_HSFlag(a3)
	 beq.s     .NoHScroller

	 move.l    sac_SADT_HScroller(a3),a0
	 DOMTDI    GCM_Render,a0
.NoHScroller:

	 clr.l     sac_SADT_HSCRedraw(a3)
	 clr.l     sac_SADT_VSCRedraw(a3)
	 clr.l     sac_SADT_RedrawContents(a3)
	 DOMTDI    SAM_ContentsRender,a2

	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-4/a2-3
	 rts
;fe
;fs "Update"
SACUpdate:
	 movem.l   d2-7/a2-6,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 move.l    a0,a6

	 LBLOCKEAI GuiRootClass_ID,a6,a2
	 move.l    a2,_CurrentDomain

	 LBLOCKEAI ScrollAreaClass_ID,a6,a3
	 bsr.s     SACCheckScrollers

	 moveq     #0,d0
	 moveq     #0,d1
	 movem.l   sac_SADT_BoxWidth(a3),d2-3
	 st        d4
	 bsr       _DrawBevelBox

	 tst.l     sac_SADT_VSFlag(a3)
	 beq.s     .VScrollerDone
	 tst.l     sac_SADT_VSCRedraw(a3)
	 bne.s     .VSCRedraw

	 move.l    sac_SADT_VScroller(a3),a0
	 DOMTDI    GCM_Update,a0
	 bra.s     .VScrollerDone

.VSCRedraw:
	 clr.l     sac_SADT_VSCRedraw(a3)
	 move.l    sac_SADT_VScroller(a3),a2
	 DOMTDI    GCM_Clear,a2
	 DOMTDI    GCM_Render,a2

.VScrollerDone:

	 tst.l     sac_SADT_HSFlag(a3)
	 beq.s     .HScrollerDone
	 tst.l     sac_SADT_HSCRedraw(a3)
	 bne.s     .HSCRedraw

	 move.l    sac_SADT_HScroller(a3),a0
	 DOMTDI    GCM_Update,a0

.HSCRedraw:
	 clr.l     sac_SADT_HSCRedraw(a3)
	 move.l    sac_SADT_HScroller(a3),a2
	 DOMTDI    GCM_Clear,a2
	 DOMTDI    GCM_Render,a2

.HScrollerDone:

	 tst.l     sac_SADT_RedrawContents(a3)
	 bne.s     .Redraw
	 DOMTDI    SAM_ContentsUpdate,a6
	 bra.s     .Done

.Redraw:
	 clr.l     sac_SADT_RedrawContents(a3)
	 DOMTDI    SAM_ContentsRender,a6

.Done:
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7/a2-6
	 rts
;fe
;fs "UnderMouse"
SACUnderMouse:
	 LBLOCKEAI ScrollAreaClass_ID,a0,a1

	 cmp2.l    gd_Left(a1),d0
	 bcs.s     .NotInContents
	 cmp2.l    gd_Top(a1),d1
	 bcs.s     .NotInContents

	 DOMTDJI   SAM_ContentsUnderMouse,a0
.NotInContents:

	 move.l    a2,a0
	 bra       _SetMousePointer
;fe
;fs "Click"
SACClick:
	 LBLOCKEAI ScrollAreaClass_ID,a0,a1

	 cmp2.l    gd_Left(a1),d0
	 bcs.s     .NotInContents
	 cmp2.l    gd_Top(a1),d1
	 bcs.s     .NotInContents

	 DOMTDJI   SAM_ContentsClick,a0
.NotInContents:

	 move.l    a2,-(a7)

	 tst.l     sac_SADT_HSFlag(a1)
	 beq.s     .NotInHScroller

	 move.l    sac_SADT_HScroller(a1),a0
	 LBLOCKEAI GuiRootClass_ID,a0,a2
	 cmp2.l    gd_Left(a2),d0
	 bcs.s     .NotInHScroller
	 cmp2.l    gd_Top(a2),d1
	 bcs.s     .NotInHScroller

	 move.l    (a7)+,a2
	 DOMTDJI   GCM_Click,a0
.NotInHScroller:

	 move.l    (a7)+,a2
	 tst.l     sac_SADT_VSFlag(a1)
	 beq.s     .NotInVScroller

	 move.l    sac_SADT_VScroller(a1),a0
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 cmp2.l    gd_Left(a1),d0
	 bcs.s     .NotInVScroller
	 cmp2.l    gd_Top(a1),d1
	 bcs.s     .NotInVScroller

	 DOMTDJI   GCM_Click,a0
.NotInVScroller:

	 rts
;fe
;fs "HIncr"
SACHIncr:
	 LDATALI   SADT_HScroller,a0,a0
	 DOMTDJI   HSM_Incr,a0
;fe
;fs "HDecr"
SACHDecr:
	 LDATALI   SADT_HScroller,a0,a0
	 DOMTDJI   HSM_Decr,a0
;fe
;fs "VIncr"
SACVIncr:
	 LDATALI   SADT_VScroller,a0,a0
	 DOMTDJI   VSM_Incr,a0
;fe
;fs "VDecr"
SACVDecr:
	 LDATALI   SADT_VScroller,a0,a0
	 DOMTDJI   HSM_Decr,a0
;fe

;fs "CheckScrollers"
SACCheckScrollers:
	 moveq     #0,d6
	 moveq     #0,d7

.CheckScrollers:
	 tst.l     d6
	 bne.s     .HSCheckOk
	 move.l    sac_SADT_HTotalNVS(a3,d7.l),d2
	 beq.s     .HSCheckOk

	 cmp.l     sac_SADT_HVisibleNVS(a3,d7.l),d2
	 ble.s     .HSCheckOk
	 moveq     #4,d6
	 tst.l     sac_SADT_HSFlag(a3)
	 bne.s     .HSCheckOk
	 move.l    d6,sac_SADT_HSCRedraw(a3)
.HSCheckOk:

	 tst.l     d7
	 bne.s     .VSCheckOk
	 move.l    sac_SADT_VTotalNVS(a3),d2
	 beq.s     .VSCheckOk

	 cmp.l     sac_SADT_VVisibleNHS(a3,d6.l),d2
	 ble.s     .VSCheckOk
	 moveq     #12,d7
	 tst.l     sac_SADT_VSFlag(a3)
	 bne.s     .CheckScrollers
	 move.l    d7,sac_SADT_VSCRedraw(a3)
	 bra.s     .CheckScrollers
.VSCheckOk:

	 movem.l   d6-7,sac_SADT_HSFlag(a3)

	 move.l    gd_Width(a2),d2
	 move.l    gd_Height(a2),d3

	 tst.l     d7
	 beq.s     .NoVScroller

	 move.l    sac_SADT_VScroller(a3),a4
	 LBLOCKEAI VScrollerClass_ID,a4,a5
	 move.l    sac_SADT_VPos(a3),vsc_VSDT_Position(a5)
	 move.l    sac_SADT_VTotalVS(a3),vsc_VSDT_Total(a5)
	 move.l    sac_SADT_VVisibleNHS(a3,d6.l),vsc_VSDT_Visible(a5)

	 LBLOCKEAI GuiRootClass_ID,a4,a5
	 move.l    guir_DTA_MinWidth(a5),d0
	 sub.l     d0,d2
	 move.l    d0,gd_Width(a5)
	 move.l    gd_Right(a2),d1
	 move.l    d1,gd_Right(a5)
	 sub.l     d0,d1
	 move.l    d1,gd_Left(a5)
	 move.l    d3,gd_Height(a5)
	 move.l    gd_Top(a2),gd_Top(a5)
	 move.l    gd_Bottom(a2),gd_Bottom(a5)

	 DOMTDI    GCM_Layout,a4
	 bra.s     .OkVScroller

.NoVScroller:
	 moveq     #-1,d0
	 move.l    d0,sac_SADT_RedrawContents(a3)

	 tst.l     sac_SADT_VPos(a3)
	 beq.s     .OkVScroller
	 clr.l     sac_SADT_VPos(a3)
	 moveq     #0,d1
	 move.l    sac_SADT_HPos(a3),d0
	 DOMTDI    SAM_ContentsNewVPos,a6

.OkVScroller:

	 tst.l     d6
	 beq.s     .NoHScroller

	 move.l    sac_SADT_HScroller(a3),a4
	 LBLOCKEAI HScrollerClass_ID,a4,a5
	 move.l    sac_SADT_HPos(a3),hsc_HSDT_Position(a5)
	 move.l    sac_SADT_HTotalNVS(a3,d7.l),hsc_HSDT_Total(a5)
	 move.l    sac_SADT_HVisibleNVS(a3,d7.l),hsc_HSDT_Visible(a5)

	 LBLOCKEAI GuiRootClass_ID,a4,a5
	 move.l    guir_DTA_MinHeight(a5),d0
	 sub.l     d0,d3
	 move.l    d0,gd_Height(a5)
	 move.l    gd_Bottom(a2),d1
	 move.l    d1,gd_Bottom(a5)
	 sub.l     d0,d1
	 move.l    d1,gd_Top(a5)
	 move.l    gd_Left(a2),d0
	 move.l    d0,gd_Left(a5)
	 add.l     d2,d0
	 move.l    d0,gd_Right(a5)
	 move.l    d2,gd_Width(a5)

	 DOMTDI    GCM_Layout,a4
	 bra.s     .OkHScroller

.NoHScroller:
	 moveq     #-1,d0
	 move.l    d0,sac_SADT_RedrawContents(a3)

	 tst.l     sac_SADT_HPos(a3)
	 beq.s     .OkHScroller
	 clr.l     sac_SADT_HPos(a3)
	 moveq     #0,d0
	 move.l    sac_SADT_VPos(a3),d1
	 DOMTDI    SAM_ContentsNewHPos,a6

.OkHScroller:

	 movem.l   d2-3,sac_SADT_BoxWidth(a3)

	 move.l    gd_Left(a2),d0
	 addq.l    #2,d0
	 move.l    d0,gd_Left(a3)
	 move.l    gd_Top(a2),d1
	 addq.l    #1,d1
	 move.l    d1,gd_Top(a3)
	 sub.l     #4,d2
	 move.l    d2,gd_Width(a3)
	 sub.l     #2,d3
	 move.l    d3,gd_Height(a3)
	 add.l     d0,d2
	 move.l    d2,gd_Right(a3)
	 add.l     d1,d3
	 move.l    d3,gd_Bottom(a3)
	 rts
;fe
;fs "HorHook"
SACHorHook:        ; d0=user d1=pos d2=lo flag
	 move.l    a2,-(a7)

	 move.l    d0,a2
	 LBLOCKEAI ScrollAreaClass_ID,a2,a1
	 move.l    d1,sac_SADT_HPos(a1)
	 move.l    d1,d0
	 move.l    sac_SADT_VPos(a1),d1

	 DOMTDI    SAM_ContentsNewHPos,a2

	 tst.l     d2
	 bne.s     .Done
	 DOMTDI    SAM_ContentsUpdate,a2

.Done:
	 move.l    (a7)+,a2
	 rts
;fe
;fs "VerHook"
SACVerHook:        ; d0=user d1=pos d2=lo flag
	 move.l    a2,-(a7)

	 move.l    d0,a2
	 LBLOCKEAI ScrollAreaClass_ID,a2,a1
	 move.l    d1,sac_SADT_VPos(a1)
	 move.l    sac_SADT_HPos(a1),d0

	 DOMTDI    SAM_ContentsNewVPos,a2

	 tst.l     d2
	 bne.s     .Done
	 DOMTDI    SAM_ContentsUpdate,a2

.Done:
	 move.l    (a7)+,a2
	 rts
;fe
;fe
;fs "ListViewClass"
;fs "Structure"
_ListViewClass:
	 dc.l      0
	 dc.l      _GuiRootClass
	 dc.l      0,0,0,0,0
	 dc.l      lvi_DataSize
	 dc.l      empty_Funcs
	 dc.l      listview_data
	 dc.l      0
	 dc.l      listview_Init

listview_data:
	 ds.b      lvi_DataSize
;fe
;fs "Init"
listview_Init:
	 move.l    #MTD_New,d0
	 lea       LVINew,a1
	 bsr       _SetMethod
	 move.l    d0,LVISNew

	 move.l    #GCM_GetMinMax,d0
	 lea       LVIGetMinMax,a1
	 bsr       _SetMethod

	 move.l    #GCM_Layout,d0
	 lea       LVILayout,a1
	 bsr       _SetMethod

	 move.l    #GCM_Render,d0
	 lea       LVIRender,a1
	 bsr       _SetMethod

	 move.l    #GCM_Click,d0
	 lea       LVIClick,a1
	 bsr       _SetMethod

	 move.l    #GCM_Handle,d0
	 lea       LVIHandle,a1
	 bsr       _SetMethod
	 rts

LVISNew:
	 ds.l      1
;fe

;fs "New"
LVINew:
	 movem.l   a2-3,-(a7)

	 move.l    a0,a3
	 move.l    LVISNew(pc),a1
	 jsr       (a1)

	 lea       _VScrollerClass,a0
	 sub.l     a1,a1
	 bsr       _NewObject
	 tst.l     d0
	 beq.s     .Fail

	 move.l    d0,a2
	 DOMTDI    MTD_AddMember,a3

	 SDATALI   a2,LVDT_Scroller,a3

	 LBLOCKEAI GuiRootClass_ID,a2,a0
	 lea       LVIHook(pc),a1
	 movem.l   a1/a3,guir_DTA_Hook(a0)

	 moveq     #-1,d0
.Fail:
	 movem.l   (a7)+,a2-3
	 rts
;fe
;fs "GetMinMax"
LVIGetMinMax:
	 movem.l   a2-3,-(a7)

	 move.l    a0,a2

	 LDATALI   LVDT_Scroller,a2,a3
	 DOMTDI    GCM_GetMinMax,a3

	 LBLOCKEAI GuiRootClass_ID,a3,a0
	 LBLOCKEAI GuiRootClass_ID,a2,a1

	 move.l    guir_DTA_MinHeight(a0),guir_DTA_MinHeight(a1)
	 moveq     #40,d0
	 add.l     guir_DTA_MinWidth(a0),d0
	 move.l    d0,guir_DTA_MinWidth(a1)

	 movem.l   (a7)+,a2-3
	 rts
;fe
;fs "Layout"
LVILayout:
	 movem.l   d2-7/a2-6,-(a7)

	 LBLOCKEAI ListViewClass_ID,a0,a2
	 LBLOCKEAI GuiRootClass_ID,a0,a4

	 move.l    lvi_LVDT_List(a2),a1
	 moveq     #0,d2
	 move.l    (a1),a1
	 move.l    lvi_LVDT_FirstVis(a2),d0
	 bne.s     .NotEmpty
	 move.l    a1,d0
.NotEmpty:
	 move.l    d0,a3
	 moveq     #0,d0

.CountLoop:
	 move.l    (a1),d1
	 beq.s     .CountDone
	 cmp.l     a1,a3
	 bne.s     .CountNext
	 move.l    d0,d2
.CountNext:
	 addq.l    #1,d0
	 move.l    d1,a1
	 bra.s     .CountLoop
.CountDone:

	 move.l    d0,lvi_LVDT_Total(a2)
	 beq.s     .NoList

	 move.l    gd_Height(a4),d3
	 move.l    d3,d4
	 subq.l    #3,d3
	 lsr.l     #3,d3

	 moveq     #-1,d5
	 cmp.l     d0,d3
	 bcs.s     .ScrollerOk
	 moveq     #0,d5
	 move.l    d0,d3
.ScrollerOk:
	 move.l    d3,lvi_LVDT_NumVis(a2)

	 move.l    d3,d6
	 lsl.l     #3,d6
	 addq.l    #1,d6
	 move.l    d6,lvi_LVDT_ClrTop(a2)
	 neg.l     d6
	 add.l     d4,d6
	 subq.l    #1,d6
	 move.l    d6,lvi_LVDT_ClrHeight(a2)

	 move.l    gd_Width(a4),d6
	 move.l    gd_Right(a4),d7

	 move.l    lvi_LVDT_ShowScroller(a2),d1
	 move.l    d5,lvi_LVDT_ShowScroller(a2)
	 beq.s     .NoScroller

	 not.l     d1
	 move.l    d1,lvi_LVDT_ClearScroller(a2)

	 move.l    lvi_LVDT_Scroller(a2),a5

	 LBLOCKEAI VScrollerClass_ID,a5,a6
	 move.l    d2,vsc_VSDT_Position(a6)
	 move.l    d0,vsc_VSDT_Total(a6)
	 move.l    d3,vsc_VSDT_Visible(a6)
	 move.l    a6,d5

	 LBLOCKEAI GuiRootClass_ID,a5,a6
	 move.l    gd_Right(a4),d1
	 move.l    d1,gd_Right(a6)
	 move.l    guir_DTA_MinWidth(a6),d0
	 move.l    d0,gd_Width(a6)
	 sub.l     d0,d1
	 move.l    d1,gd_Left(a6)

	 sub.l     d0,d6
	 sub.l     d0,d7
	 movem.l   d6-7,lvi_LVDT_Width(a2)

	 movem.l   gd_Top(a4),d0-1
	 movem.l   d0-1,gd_Top(a6)
	 move.l    gd_Height(a4),gd_Height(a6)

	 DOMTDI    GCM_Layout,a5

	 move.l    d5,a5
	 move.l    vsc_VSDT_Position(a5),d4
	 move.l    d4,lvi_LVDT_FVNum(a2)
	 move.l    d4,d5
	 subq.l    #1,d3
	 add.l     d3,d5
	 move.l    d5,lvi_LVDT_LVNum(a2)

	 sub.l     d2,d4
	 bmi.s     .Backward
	 subq.l    #1,d4
	 bmi.s     .FVOk

.FwdLoop:
	 move.l    (a3),a3
	 dbf       d4,.FwdLoop
	 bra.s     .FVOk

.Backward:
	 neg.l     d4
	 subq.l    #1,d4
	 bmi.s     .FVOk

.BwdLoop:
	 move.l    4(a3),a3
	 dbf       d4,.BwdLoop
.FVOk:

	 move.l    a3,lvi_LVDT_FirstVis(a2)

	 subq.l    #1,d3
	 bmi.s     .LVOk
.LVLoop:
	 move.l    (a3),a3
	 dbf       d3,.LVLoop
.LVOk:
	 move.l    a3,lvi_LVDT_LastVis(a2)
	 bra.s     .AllDone

.NoList:
	 clr.l     lvi_LVDT_ShowScroller(a2)
	 clr.l     lvi_LVDT_Total(a2)
	 moveq     #1,d0
	 move.l    d0,lvi_LVDT_ClrTop(a2)
	 move.l    gd_Height(a4),d0
	 subq.l    #2,d0
	 move.l    d0,lvi_LVDT_ClrHeight(a2)

	 move.l    gd_Width(a4),d0
	 move.l    gd_Right(a4),d1
	 movem.l   d0-1,lvi_LVDT_Width(a2)
	 bra.s     .AllDone

.NoScroller:
	 movem.l   d6-7,lvi_LVDT_Width(a2)
	 clr.l     lvi_LVDT_FVNum(a2)
	 subq.l    #1,d3
	 move.l    d3,lvi_LVDT_LVNum(a2)

	 move.l    lvi_LVDT_List(a2),a1
	 move.l    (a1),lvi_LVDT_FirstVis(a2)
	 move.l    8(a1),lvi_LVDT_LastVis(a2)

.AllDone:
	 moveq     #0,d0
	 movem.l   (a7)+,d2-7/a2-6
	 rts
;fe
;fs "Render"
LVIRender:
	 movem.l   d2-7/a2-5,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain
	 LBLOCKEAI ListViewClass_ID,a0,a2

	 moveq     #0,d0
	 moveq     #0,d1
	 move.l    lvi_LVDT_Width(a2),d2
	 move.l    gd_Height(a1),d3
	 sf        d4
	 bsr       _DrawBevelBox

	 tst.l     lvi_LVDT_ShowScroller(a2)
	 beq.s     .NoScroller
	 move.l    lvi_LVDT_Scroller(a2),a3

	 tst.l     lvi_LVDT_ClearScroller(a2)
	 beq.s     .DontClrScroller
	 clr.l     lvi_LVDT_ClearScroller(a2)
	 DOMTDI    GCM_Clear,a3
.DontClrScroller:
	 DOMTDI    GCM_Render,a3
.NoScroller:

	 move.l    lvi_LVDT_Width(a2),d0
	 subq.l    #4,d0
	 move.l    d0,_TextLimit


	 move.l    lvi_LVDT_NumVis(a2),d0
	 beq.s     .NoList
	 subq.l    #1,d0

	 move.l    lvi_LVDT_FirstVis(a2),a3
	 move.l    lvi_LVDT_Selected(a2),a4
	 moveq     #1,d2

.Loop:
	 moveq     #0,d3

	 cmp.l     a3,a4
	 bne.s     .NotSel
	 moveq     #3,d3
.NotSel:

	 moveq     #2,d4
	 move.l    d2,d5
	 move.l    lvi_LVDT_Width(a2),d6
	 subq.l    #4,d6
	 moveq     #8,d7
	 bsr.s     _DrawRectangle

	 moveq     #0,d5
	 move.l    lve_Color(a3),d4
	 move.l    d2,d7
	 move.l    lve_String(a3),a5
	 moveq     #4,d6
	 bsr       _DrawText

	 move.l    (a3),a3
	 addq.l    #8,d2
	 dbf       d0,.Loop

.NoList:
	 movem.l   lvi_LVDT_ClrTop(a2),d5/d7
	 moveq     #2,d4
	 move.l    lvi_LVDT_Width(a2),d6
	 subq.l    #4,d6
	 moveq     #0,d3
	 bsr.s     _DrawRectangle

.Done:
	 clr.l     _TextLimit
	 move.l    (a7)+,_CurrentDomain
	 movem.l   (a7)+,d2-7/a2-5
	 rts
;fe
;fs "Hook"
LVIHook:
	 movem.l   a2-3,-(a7)

	 move.l    d0,a0
	 LBLOCKEAI ListViewClass_ID,a0,a1
	 move.l    lvi_LVDT_FVNum(a1),d0
	 move.l    d1,lvi_LVDT_FVNum(a1)
	 sub.l     d0,d1
	 movem.l   lvi_LVDT_FirstVis(a1),a2-3
	 add.l     d1,lvi_LVDT_LVNum(a1)

	 tst.l     d1
	 bmi.s     .Backward

	 subq.l    #1,d1
	 bmi.s     .Groumpf
.ForwardLoop:
	 move.l    (a2),a2
	 move.l    (a3),a3
	 dbf       d1,.ForwardLoop
	 bra.s     .Groumpf

.Backward:
	 neg.l     d1
	 subq.l    #1,d1
	 bmi.s     .Groumpf
.BackwardLoop:
	 move.l    4(a2),a2
	 move.l    4(a3),a3
	 dbf       d1,.BackwardLoop

.Groumpf:
	 movem.l   a2-3,lvi_LVDT_FirstVis(a1)
	 DOMTDI    GCM_Render,a0

	 movem.l   (a7)+,a2-3
	 rts
;fe
;fs "Click"
LVIClick:
	 LBLOCKEAI ListViewClass_ID,a0,a1
	 tst.l     lvi_LVDT_ShowScroller(a1)
	 beq.s     .NoScroller

	 cmp.l     lvi_LVDT_Right(a1),d0
	 bcs.s     .NoScroller

	 move.l    lvi_LVDT_Scroller(a1),a0
	 DOMTDJI   GCM_Click,a0

.NoScroller:
	 clr.l     LVICounter
	 move.l    a0,_ActiveGuiObject
	 rts
;fe
;fs "Handle"
LVIHandle:
	 tst.b     _LMBState
	 beq.s     .Release

	 movem.l   d2/a2-3,-(a7)

	 LBLOCKEAI ListViewClass_ID,a0,a2
	 tst.l     lvi_LVDT_Total(a2)
	 beq.s     .Done

	 move.l    lvi_LVDT_ShowScroller(a2),d2
	 move.l    lvi_LVDT_Selected(a2),d0

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 sub.l     gd_Top(a1),d1
	 subq.l    #1,d1
	 bmi.s     .Before

	 lsr.l     #3,d1
	 cmp.l     lvi_LVDT_NumVis(a2),d1
	 bge.s     .After

	 clr.l     LVICounter

	 move.l    lvi_LVDT_FirstVis(a2),a3
	 subq.l    #1,d1
	 bmi.s     .SelOk
.SelLoop:
	 move.l    (a3),a3
	 dbf       d1,.SelLoop
.SelOk:

	 cmp.l     d0,a3
	 beq.s     .Done
.Refresh:
	 move.l    a3,lvi_LVDT_Selected(a2)
	 DOMTDI    GCM_Render,a0
	 bra.s     .Done

.Before:
	 move.l    lvi_LVDT_FirstVis(a2),d1
	 cmp.l     d0,d1
	 beq.s     .BefOk
	 move.l    d1,a3
	 bra.s     .Refresh

.BefOk:
	 tst.l     d2
	 beq.s     .Done
	 sub.l     #1,LVICounter
	 bpl.s     .Done
	 move.l    #5,LVICounter

	 move.l    d0,a1
	 move.l    4(a1),a1
	 tst.l     (a1)
	 beq.s     .Done
	 move.l    a1,lvi_LVDT_Selected(a2)
	 move.l    lvi_LVDT_Scroller(a2),a0
	 DOMTDI    VSM_Decr,a0
	 bra.s     .Done

.After:
	 move.l    lvi_LVDT_LastVis(a2),d1
	 cmp.l     d0,d1
	 beq.s     .AftOk
	 move.l    d1,a3
	 bra.s     .Refresh

.AftOk:
	 tst.l     d2
	 beq.s     .Done
	 sub.l     #1,LVICounter
	 bpl.s     .Done
	 move.l    #5,LVICounter

	 move.l    d0,a1
	 move.l    (a1),a1
	 tst.l     (a1)
	 beq.s     .Done
	 move.l    a1,lvi_LVDT_Selected(a2)
	 move.l    lvi_LVDT_Scroller(a2),a0
	 DOMTDI    VSM_Incr,a0

.Done:
	 movem.l   (a7)+,d2/a2-3
	 rts

.Release:
	 clr.l     _ActiveGuiObject
	 rts

LVICounter:
	 ds.l      1
;fe
;fe
;fe

;fs "Obsolete"
;fs "_RefreshGuiEntry"
_RefreshGuiEntry:  ; a0=GuiEntry
	 movem.l   d3-7/a1,-(a7)

	 move.l    _CurrentDomain,-(a7)

	 lea       ge_Domain(a0),a1
	 move.l    a1,_CurrentDomain

	 bsr       _ClearDomain
	 bsr       _Layout
	 bsr       _Render

	 move.l    (a7)+,_CurrentDomain

	 movem.l   (a7)+,d3-7/a1
	 rts
;fe
;fs "_ChangeGui"
_CurrentGui:
	 ds.l      1
_ChangeGui:        ; a0=GuiTable
	 movem.l   d0-7/a0-6,-(a7)

	 bsr       _ClearGui

	 move.l    a0,d2
	 beq.s     .NewStyleGui

	 tst.l     _CurrentGui
	 bne.s     .Ok
	 move.l    _CurrentGuiObject(pc),d0
	 beq.s     .Ok
	 move.l    d0,a0
	 DOMTDI    GCM_Clear,a0
.Ok:

	 move.l    d2,a0
	 move.l    #_GuiTemp,_CtGuiTemp
	 move.l    #CopEnd,_GuiL1Ptr

	 move.l    a0,_CurrentGui

	 bsr       _GetMinMax

	 moveq     #0,d0
	 move.l    #255,d1

	 move.l    ge_MaxHeight(a0),d2
	 beq.s     .NoMax
	 move.l    d1,d0
	 sub.l     ge_MaxHeight(a0),d0
.NoMax:
	 move.l    d0,_MinGuiPos

	 sub.l     ge_MinHeight(a0),d1
	 move.l    d1,_MaxGuiPos

	 move.l    _GuiPos(pc),d2

	 cmp.l     d0,d2
	 bcc.s     .MinOk
	 move.l    d0,d2
.MinOk:

	 cmp.l     d2,d1
	 bcc.s     .MaxOk
	 move.l    d1,d2
.MaxOk:
	 move.l    d2,_GuiPos

	 bsr       _MoveGui
	 bsr       _Layout
	 bsr       _Render
	 movem.l   (a7)+,d0-7/a0-6
	 rts

.NewStyleGui:
	 clr.l     _CurrentGui
	 move.l    _CurrentGuiObject,a2
	 DOMTDI    GCM_GetMinMax,a2
	 DOMTDI    GCM_Layout,a2
	 DOMTDI    GCM_Render,a2
	 movem.l   (a7)+,d0-7/a0-6
	 rts
;fe
;fs "_MoveGui"
_GuiPos:
	 dc.l      256
_MinGuiPos:
	 dc.l      0
_MaxGuiPos:
	 dc.l      256
_MoveGui:
	 move.l    _GuiPos(pc),d0
	 move.l    d0,d1

	 add.l     #$28,d0
	 move.w    d0,GuiP

	 move.l    _CurrentGui(pc),a0

	 move.l    #2,ge_Domain+gd_Left(a0)
	 move.l    #0,ge_Domain+gd_Top(a0)

	 move.l    #GuiScreenWidth-2,ge_Domain+gd_Right(a0)
	 move.l    #GuiScreenWidth-4,ge_Domain+gd_Width(a0)

	 move.l    #255,d0
	 sub.l     d1,d0
	 move.l    d0,ge_Domain+gd_Height(a0)
	 move.l    d0,ge_Domain+gd_Bottom(a0)
	 rts
;fe
;fs "_ClearGui"
_ClearGui:
	 move.l    a0,-(a7)
	 move.l    _CurrentGui(pc),d0
	 beq.s     .Done
	 move.l    d0,a0

	 lea       ge_Domain(a0),a0
	 move.l    a0,_CurrentDomain
	 bsr       _ClearDomain

.Done:
	 move.l    (a7)+,a0
	 rts
;fe
;fs "_GetMinMax"
_GetMinMax:        ; a0=GuiEntry
	 movem.l   d0-7/a0-6,-(a7)
	 move.l    (a0),a1
	 move.l    (a1),a1
	 jsr       (a1)
	 movem.l   (a7)+,d0-7/a0-6
	 rts
;fe
;fs "_Layout"
_Layout: ; a0=GuiEntry
	 movem.l   d0-7/a0-6,-(a7)
	 move.l    (a0),a1
	 move.l    gc_Layout(a1),d0
	 beq.s     .Done
	 move.l    d0,a3

	 lea       _CurrentDomain(pc),a1
	 move.l    (a1),-(a7)
	 lea       ge_Domain(a0),a2
	 move.l    a2,(a1)

	 jsr       (a3)

	 lea       _CurrentDomain(pc),a1
	 move.l    (a7)+,(a1)

.Done:
	 movem.l   (a7)+,d0-7/a0-6
	 rts
;fe
;fs "_Render"
_Render: ; a0=GuiEntry
	 movem.l   d0-7/a0-6,-(a7)
	 move.l    (a0),a1
	 move.l    gc_Render(a1),d0
	 beq.s     .Done
	 move.l    d0,a3

	 lea       _CurrentDomain(pc),a1
	 move.l    (a1),-(a7)
	 lea       ge_Domain(a0),a2
	 move.l    a2,(a1)

	 jsr       (a3)

	 lea       _CurrentDomain(pc),a1
	 move.l    (a7)+,(a1)

.Done:
	 movem.l   (a7)+,d0-7/a0-6
	 rts
;fe
;fs "_DoClick"
_DoClick: ; a0=GuiEntry d0/d1=X,Y
	 movem.l   d0-1/d3-7/a0-6,-(a7)
	 move.l    (a0),a1
	 move.l    gc_Click(a1),d2
	 ble.s     .Done
	 move.l    d2,a3

	 lea       _CurrentDomain(pc),a1
	 move.l    (a1),-(a7)
	 lea       ge_Domain(a0),a2
	 move.l    a2,(a1)

	 jsr       (a3)

	 lea       _CurrentDomain(pc),a1
	 move.l    (a7)+,(a1)
	 moveq     #0,d2

.Done:
	 movem.l   (a7)+,d0-1/d3-7/a0-6
	 rts
;fe

;fs "Old style classes"
;fs "_HGroup"
_HGroup:
	 dc.l      HGGetMinMax
	 dc.l      HGLayout
	 dc.l      _GRender
	 dc.l      _GClick

HGGetMinMax:
	 move.l    a0,a1
	 lea       ge_Size(a0),a0
	 moveq     #0,d0
	 moveq     #0,d1
	 moveq     #0,d2
	 moveq     #0,d3
	 ;bset      #31,d3
	 not.l     d3
	 sf        d5

.Loop:
	 bsr.s     _GetMinMax

	 add.l     ge_MinWidth(a0),d0
	 move.l    ge_MaxWidth(a0),d4
	 seq       d6
	 or.b      d6,d5
	 add.l     d4,d2

	 move.l    ge_MinHeight(a0),d4
	 cmp.l     d4,d1
	 bcc.s     .MiHOk
	 move.l    d4,d1
.MiHOk:

	 move.l    ge_MaxHeight(a0),d4
	 beq.s     .MaHOk
	 cmp.l     d3,d4
	 bcc.s     .MaHOk
	 move.l    d4,d3
.MaHOk:

	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 beq.s     .Done

	 addq.l    #GuiHorSpacing,d0
	 addq.l    #GuiHorSpacing,d2

	 bra.s     .Loop

.Done:
	 tst.b     d5
	 beq.s     .WMaxOk
	 moveq     #0,d2
.WMaxOk:

	 tst.l     d3
	 bpl.s     .HMaxOk
	 moveq     #0,d3
.HMaxOk:

	 lea       ge_Size(a0),a0
	 move.l    a0,ge_Next(a1)
	 movem.l   d0-3,ge_MinWidth(a1)
	 rts

HGLayout:
	 move.l    a0,a6
	 lea       ge_Size(a0),a0
	 move.l    a0,a5
	 moveq     #0,d7

	 move.l    _CurrentDomain(pc),a1
	 move.l    gd_Height(a1),d0
	 move.l    gd_Top(a1),d1
	 move.l    gd_Bottom(a1),d2

.InitLoop:
	 tst.l     (a0)
	 beq.s     .ILOk
	 move.l    d1,ge_Domain+gd_Top(a0)
	 move.l    d2,ge_Domain+gd_Bottom(a0)
	 clr.l     ge_Domain+gd_Width(a0)
	 move.l    d0,ge_Domain+gd_Height(a0)
	 addq.l    #1,d7

	 move.l    ge_Next(a0),a0
	 bra.s     .InitLoop

.ILOk:
	 move.l    gd_Width(a1),d5

	 move.l    d7,d0
	 subq.l    #1,d0
	 add.l     d0,d0
	 sub.l     d0,d5

.BigLoop:
	 tst.l     d7
	 beq.s     .MoreOrLessBigLoop

	 move.l    d5,d4
	 divu      d7,d4
	 ext.l     d4

.MoreOrLessBigLoop:
	 move.l    a5,a0

.Loop:
	 tst.l     ge_Domain+gd_Width(a0)
	 bne.s     .Fixed

	 move.l    ge_MinWidth(a0),d0
	 cmp.l     d0,d4
	 bcc.s     .MinOk
	 move.l    d0,ge_Domain+gd_Width(a0)
	 sub.l     d0,d5
	 subq.l    #1,d7
	 moveq     #0,d1
	 move.l    d1,ge_Domain+gd_Left(a0)
	 bra.s     .BigLoop
.MinOk:

	 move.l    ge_MaxWidth(a0),d0
	 beq.s     .Next

	 cmp.l     d4,d0
	 bcc.s     .Next
	 move.l    d0,ge_Domain+gd_Width(a0)
	 sub.l     d0,d5
	 subq.l    #1,d7
	 moveq     #1,d1
	 move.l    d1,ge_Domain+gd_Left(a0)
	 bra.s     .BigLoop

.Fixed:
	 move.l    ge_Domain+gd_Left(a0),d0
	 eor.l     d1,d0
	 beq.s     .Next

	 move.l    ge_Domain+gd_Width(a0),d0
	 add.l     d5,d0
	 move.l    d7,d2
	 addq.l    #1,d2
	 divu      d2,d0
	 ext.l     d0

	 move.l    ge_MinWidth(a0),d2
	 cmp.l     d2,d0
	 bcs.s     .Next

	 move.l    ge_MaxWidth(a0),d2
	 beq.s     .AhhRâaah
	 cmp.l     d0,d2
	 bcs.s     .Next

.AhhRâaah:
	 add.l     ge_Domain+gd_Width(a0),d5
	 clr.l     ge_Domain+gd_Width(a0)
	 addq.l    #1,d7
	 move.l    d0,d4
	 bra.s     .MoreOrLessBigLoop

.Next:
	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 bne.s     .Loop

.Ok:

	 move.l    a5,a0
	 move.l    gd_Left(a1),d0

.PosLoop:
	 move.l    d0,ge_Domain+gd_Left(a0)

	 move.l    ge_Domain+gd_Width(a0),d1
	 bne.s     .PLWOk
	 move.l    d4,d1
	 move.l    d4,ge_Domain+gd_Width(a0)
.PLWOk:

	 add.l     d1,d0
	 move.l    d0,ge_Domain+gd_Right(a0)
	 addq.l    #GuiHorSpacing,d0

	 bsr       _Layout

	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 bne.s     .PosLoop

	 rts
;fe
;fs "_VGroup"
_VGroup:
	 dc.l      VGGetMinMax
	 dc.l      VGLayout
	 dc.l      _GRender
	 dc.l      _GClick

VGGetMinMax:
	 move.l    a0,a1
	 lea       ge_Size(a0),a0
	 moveq     #0,d0
	 moveq     #0,d1
	 moveq     #0,d2
	 ;bset      #31,d2
	 not.l     d2
	 moveq     #0,d3
	 sf        d5

.Loop:
	 bsr.s     _GetMinMax

	 add.l     ge_MinHeight(a0),d1
	 move.l    ge_MaxHeight(a0),d4
	 seq       d6
	 or.b      d6,d5
	 add.l     d4,d3

	 move.l    ge_MinWidth(a0),d4
	 cmp.l     d4,d0
	 bcc.s     .MiWOk
	 move.l    d4,d0
.MiWOk:

	 move.l    ge_MaxWidth(a0),d4
	 beq.s     .MaWOk
	 cmp.l     d2,d4
	 bcc.s     .MaWOk
	 move.l    d4,d2
.MaWOk:

	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 beq.s     .Done

	 addq.l    #GuiVerSpacing,d1
	 addq.l    #GuiVerSpacing,d3

	 bra.s     .Loop

.Done:
	 tst.b     d5
	 beq.s     .HMaxOk
	 moveq     #0,d3
.HMaxOk:

	 tst.l     d2
	 bpl.s     .WMaxOk
	 moveq     #0,d2
.WMaxOk:

	 lea       ge_Size(a0),a0
	 move.l    a0,ge_Next(a1)
	 movem.l   d0-3,ge_MinWidth(a1)
	 rts

VGLayout:
	 move.l    a0,a6
	 lea       ge_Size(a0),a0
	 move.l    a0,a5
	 moveq     #0,d7

	 move.l    _CurrentDomain(pc),a1
	 move.l    gd_Width(a1),d0
	 move.l    gd_Left(a1),d1
	 move.l    gd_Right(a1),d2

.InitLoop:
	 tst.l     (a0)
	 beq.s     .ILOk
	 move.l    d1,ge_Domain+gd_Left(a0)
	 move.l    d2,ge_Domain+gd_Right(a0)
	 move.l    d0,ge_Domain+gd_Width(a0)
	 clr.l     ge_Domain+gd_Height(a0)
	 addq.l    #1,d7

	 move.l    ge_Next(a0),a0
	 bra.s     .InitLoop

.ILOk:
	 move.l    gd_Height(a1),d5

	 move.l    d7,d0
	 subq.l    #1,d0
	 sub.l     d0,d5

.BigLoop:
	 tst.l     d7
	 beq.s     .MoreOrLessBigLoop

	 move.l    d5,d4
	 divu      d7,d4
	 ext.l     d4

.MoreOrLessBigLoop:
	 move.l    a5,a0

.Loop:
	 tst.l     ge_Domain+gd_Height(a0)
	 bne.s     .Fixed

	 move.l    ge_MinHeight(a0),d0
	 cmp.l     d0,d4
	 bcc.s     .MinOk
	 move.l    d0,ge_Domain+gd_Height(a0)
	 sub.l     d0,d5
	 subq.l    #1,d7
	 moveq     #0,d1
	 move.l    d1,ge_Domain+gd_Top(a0)
	 bra.s     .BigLoop
.MinOk:

	 move.l    ge_MaxHeight(a0),d0
	 beq.s     .Next

	 cmp.l     d4,d0
	 bcc.s     .Next
	 move.l    d0,ge_Domain+gd_Height(a0)
	 sub.l     d0,d5
	 subq.l    #1,d7
	 moveq     #1,d1
	 move.l    d1,ge_Domain+gd_Top(a0)
	 bra.s     .BigLoop

.Fixed:
	 move.l    ge_Domain+gd_Top(a0),d0
	 eor.l     d1,d0
	 beq.s     .Next

	 move.l    ge_Domain+gd_Height(a0),d0
	 add.l     d5,d0
	 move.l    d7,d2
	 addq.l    #1,d2
	 divu      d2,d0
	 ext.l     d0

	 move.l    ge_MinHeight(a0),d2
	 cmp.l     d2,d0
	 bcs.s     .Next

	 move.l    ge_MaxHeight(a0),d2
	 beq.s     .AhhRâaah
	 cmp.l     d0,d2
	 bcs.s     .Next

.AhhRâaah:
	 add.l     ge_Domain+gd_Height(a0),d5
	 clr.l     ge_Domain+gd_Height(a0)
	 addq.l    #1,d7
	 move.l    d0,d4
	 bra.s     .MoreOrLessBigLoop

.Next:
	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 bne.s     .Loop

.Ok:

	 move.l    a5,a0
	 move.l    gd_Top(a1),d0

.PosLoop:
	 move.l    d0,ge_Domain+gd_Top(a0)

	 move.l    ge_Domain+gd_Height(a0),d1
	 bne.s     .PLHOk
	 move.l    d4,d1
	 move.l    d4,ge_Domain+gd_Height(a0)
.PLHOk:

	 add.l     d1,d0
	 move.l    d0,ge_Domain+gd_Bottom(a0)
	 addq.l    #GuiVerSpacing,d0

	 bsr       _Layout

	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 bne.s     .PosLoop

	 rts
;fe
;fs "_GRender"
_GRender:
	 lea       ge_Size(a0),a0

.Loop:
	 bsr       _Render

	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 bne.s     .Loop

	 rts
;fe
;fs "_GClick"
_GClick:
	 lea       ge_Size(a0),a0

.Loop:
	 cmp2.l    ge_Domain+gd_Left(a0),d0
	 bcs.s     .NoClick

	 cmp2.l    ge_Domain+gd_Top(a0),d1
	 bcc.s     .Bingo

.NoClick:
	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 bne.s     .Loop
	 rts

.Bingo:
	 bsr.s     _DoClick
	 tst.l     d2
	 bmi.s     .NoClick
	 rts
;fe
;fs "_Button"
_Button:
	 dc.l      BGetMinMax
	 dc.l      0
	 dc.l      BRender
	 dc.l      BClick

BGetMinMax:
	 move.l    ge_Data(a0),a1
	 move.l    a1,a2
.StrLen:
	 tst.b     (a1)+
	 bne.s     .StrLen
	 sub.l     a2,a1
	 move.l    a1,d0

	 clr.l     ge_MaxWidth(a0)
	 lsl.l     #3,d0
	 move.l    d0,ge_MinWidth(a0)

	 subq.l    #8,d0
	 move.l    d0,ge_Temp(a0)

	 moveq     #12,d0
	 move.l    d0,ge_MinHeight(a0)
	 move.l    d0,ge_MaxHeight(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts

BRender:
	 move.l    _CurrentDomain(pc),a1
	 moveq     #0,d0
	 moveq     #0,d1
	 move.l    gd_Width(a1),d2
	 move.l    gd_Height(a1),d3
	 sf        d4
	 bsr       _DrawBevelBox

	 sub.l     ge_Temp(a0),d2
	 lsr.l     #1,d2
	 move.l    d2,d6
	 moveq     #2,d7
	 move.l    ge_Data(a0),a5
	 moveq     #1,d4
	 moveq     #0,d5
	 bsr       _DrawText
	 rts

BClick:
	 move.l    a0,_ActiveGuiEntry
	 lea       BHandler(pc),a1
	 move.l    a1,_ActiveThingHandler

	 sf        BPressed

BHandler:
	 tst.b     _LMBState
	 beq.s     .Desactivate

	 move.b    BPressed(pc),d2

	 cmp2.l    ge_Domain+gd_Left(a0),d0
	 scc       d0

	 cmp2.l    ge_Domain+gd_Top(a0),d1
	 scc       d1

	 and.b     d1,d0
	 move.b    d0,BPressed

	 eor.b     d0,d2
	 beq.s     .Done

	 tst.b     d0
	 bne.s     .Press

.Release:
	 move.l    _CurrentDomain(pc),a1
	 moveq     #0,d3
	 moveq     #2,d4
	 moveq     #1,d5
	 movem.l   gd_Width(a1),d6-7
	 subq.l    #4,d6
	 subq.l    #2,d7
	 bsr       _DrawRectangle

	 bra       BRender

.Press:
	 move.l    _CurrentDomain(pc),a1
	 moveq     #3,d3
	 moveq     #2,d4
	 moveq     #1,d5
	 movem.l   gd_Width(a1),d6-7
	 subq.l    #4,d6
	 subq.l    #2,d7
	 bsr       _DrawRectangle

	 move.l    _CurrentDomain(pc),a1
	 moveq     #0,d0
	 moveq     #0,d1
	 move.l    gd_Width(a1),d2
	 move.l    gd_Height(a1),d3
	 st        d4
	 bsr       _DrawBevelBox

	 sub.l     ge_Temp(a0),d2
	 lsr.l     #1,d2
	 move.l    d2,d6
	 moveq     #2,d7
	 move.l    ge_Data(a0),a5
	 moveq     #1,d4
	 moveq     #0,d5
	 bsr       _DrawText
	 rts

.Desactivate:
	 clr.l     _ActiveThingHandler

	 tst.b     BPressed
	 beq.s     .Done

	 bsr.s     .Release
	 move.l    ge_Hook(a0),d0
	 beq.s     .Done
	 move.l    d0,a1
	 jmp       (a1)

.Done:
	 rts

BPressed:
	 ds.b      1
	 even
;fe
;fs "_SmallButton"
_SmallButton:
	 dc.l      SBGetMinMax
	 dc.l      SBLayout
	 dc.l      SBRender
	 dc.l      SBClick

SBGetMinMax:
	 moveq     #16,d0
	 move.l    d0,ge_MinWidth(a0)

	 tst.l     ge_Data3(a0)
	 beq.s     .Ok
	 moveq     #0,d0
.Ok:

	 move.l    d0,ge_MaxWidth(a0)

	 moveq     #12,d0
	 move.l    d0,ge_MinHeight(a0)
	 move.l    d0,ge_MaxHeight(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts

SBLayout:
	 move.l    ge_Domain+gd_Width(a0),d0
	 subq.l    #8,d0
	 lsr.l     #1,d0
	 move.l    d0,ge_Temp(a0)
	 rts

SBRender:
	 move.l    _CurrentDomain(pc),a1
	 moveq     #0,d0
	 moveq     #0,d1
	 move.l    gd_Width(a1),d2
	 move.l    gd_Height(a1),d3
	 sf        d4
	 bsr       _DrawBevelBox

	 move.l    ge_Temp(a0),d6
	 moveq     #2,d7
	 move.l    ge_Data(a0),d5
	 moveq     #1,d4
	 bsr       _DrawChar
	 rts

SBClick:
	 move.l    a0,_ActiveGuiEntry
	 lea       SBHandler(pc),a1
	 move.l    a1,_ActiveThingHandler

	 sf        SBPressed

SBHandler:
	 tst.b     _LMBState
	 beq.s     .Desactivate

	 move.b    SBPressed(pc),d2
	 beq.s     .Glonk
	 move.l    ge_Data2(a0),d3
	 beq.s     .Glonk
	 move.l    d3,a1
	 movem.l   d0-2/a0,-(a7)
	 jsr       (a1)
	 movem.l   (a7)+,d0-2/a0
.Glonk:

	 cmp2.l    ge_Domain+gd_Left(a0),d0
	 scc       d0

	 cmp2.l    ge_Domain+gd_Top(a0),d1
	 scc       d1

	 and.b     d1,d0
	 move.b    d0,SBPressed

	 eor.b     d0,d2
	 beq.s     .Done

	 tst.b     d0
	 bne.s     .Press

.Release:
	 move.l    _CurrentDomain(pc),a1
	 moveq     #0,d3
	 moveq     #2,d4
	 moveq     #1,d5
	 movem.l   gd_Width(a1),d6-7
	 subq.l    #4,d6
	 subq.l    #2,d7
	 bsr       _DrawRectangle

	 bra       SBRender

.Press:
	 move.l    _CurrentDomain(pc),a1
	 moveq     #3,d3
	 moveq     #2,d4
	 moveq     #1,d5
	 movem.l   gd_Width(a1),d6-7
	 subq.l    #4,d6
	 subq.l    #2,d7
	 bsr       _DrawRectangle

	 move.l    _CurrentDomain(pc),a1
	 moveq     #0,d0
	 moveq     #0,d1
	 move.l    gd_Width(a1),d2
	 move.l    gd_Height(a1),d3
	 st        d4
	 bsr       _DrawBevelBox

	 move.l    ge_Temp(a0),d6
	 moveq     #2,d7
	 move.l    ge_Data(a0),d5
	 moveq     #1,d4
	 bsr       _DrawChar
	 rts

.Desactivate:
	 clr.l     _ActiveThingHandler

	 tst.b     SBPressed
	 beq.s     .Done

	 bsr.s     .Release
	 move.l    ge_Hook(a0),d0
	 beq.s     .Done
	 move.l    d0,a1
	 jmp       (a1)

.Done:
	 rts

SBPressed:
	 ds.b      1
	 even
;fe
;fs "_DragBar"
_DragBar:
	 dc.l      BGetMinMax
	 dc.l      0
	 dc.l      BRender
	 dc.l      DBClick

DBClick:
	 move.l    d0,_MinMouseX
	 move.l    d0,_MaxMouseX

	 move.l    a0,_ActiveGuiEntry
	 lea       DBHandler(pc),a1
	 move.l    a1,_ActiveThingHandler

	 move.l    d1,DBOffset
	 move.w    GuiSelP,d0
	 sub.w     GuiP,d0
	 move.w    d0,DBSelOffset

	 move.l    d1,d0
	 add.l     _MinGuiPos(pc),d0
	 move.l    d0,_MinMouseY

	 add.l     _MaxGuiPos(pc),d1
	 move.l    d1,_MaxMouseY

	 lea       DBMouseHook(pc),a0
	 move.l    a0,_MouseHook

	 ;move.l    #CopEnd,_GuiL1Ptr
	 rts

DBHandler:
	 tst.b     _LMBState
	 bne.s     .Ok

	 clr.l     _MouseHook
	 clr.l     _ActiveThingHandler

	 clr.l     _MinMouseX
	 clr.l     _MinMouseY

	 move.l    #GuiScreenWidth,_MaxMouseX
	 move.l    #256,_MaxMouseY

	 bsr       _ClearGui
	 bsr       _MoveGui
	 move.l    _CurrentGui(pc),a0
	 bsr       _Layout
	 bsr       _Render

.Ok:
	 rts

DBMouseHook:
	 move.l    _MouseY(pc),d0
	 sub.l     DBOffset(pc),d0
	 move.l    d0,_GuiPos

	 add.l     #$28,d0
	 move.w    d0,GuiP

	 add.w     DBSelOffset,d0
	 move.w    d0,GuiSelP
	 rts

DBOffset:
	 ds.l      1
DBSelOffset:
	 ds.w      1
;fe
;fs "_Text"
_Text:
	 dc.l      TGetMinMax
	 dc.l      0
	 dc.l      TRender
	 dc.l      0

TGetMinMax:
	 move.l    ge_Data(a0),a1
	 move.l    ge_Data2(a0),d0
	 beq.s     .TrucEtTout

	 move.l    a0,-(a7)
	 move.l    (AbsExecBase).w,a6
	 move.l    a1,a0
	 move.l    d0,a1
	 lea       TPutChar(pc),a2
	 lea       _StrBuf,a3
	 CALL      RawDoFmt
	 move.l    (a7)+,a0
	 lea       _StrBuf,a1
	 lea       CustomBase,a6

	 moveq     #0,d0

.TrucEtTout:
	 moveq     #0,d1

.LLoop:
	 addq.l    #1,d0
	 move.l    a1,a2

.CLoop:
	 move.b    (a2)+,d2
	 beq.s     .CLDone
	 cmp.b     #$a,d2
	 bne.s     .CLoop
.CLDone:

	 move.l    a2,d3
	 sub.l     a1,d3

	 cmp.l     d3,d1
	 bcc.s     .Baâââh
	 move.l    d3,d1
.Baâââh:

	 move.l    a2,a1
	 tst.b     d2
	 bne.s     .LLoop

	 lsl.l     #3,d0
	 move.l    d0,ge_MinHeight(a0)
	 move.l    d0,ge_MaxHeight(a0)

	 subq.l    #1,d1
	 lsl.l     #3,d1

	 clr.l     ge_MaxWidth(a0)
	 move.l    d1,ge_MinWidth(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts

TRender:
	 move.l    _CurrentDomain(pc),a1
	 move.l    gd_Width(a1),d1
	 move.l    ge_Data(a0),a5
	 moveq     #0,d7
	 move.l    ge_Data2(a0),d0
	 beq.s     .LLoop

	 movem.l   d1/a1,-(a7)
	 move.l    (AbsExecBase).w,a6
	 move.l    a5,a0
	 move.l    d0,a1
	 lea       TPutChar(pc),a2
	 lea       _StrBuf,a3
	 CALL      RawDoFmt
	 lea       _StrBuf,a5
	 lea       CustomBase,a6
	 movem.l   (a7)+,d1/a1

.LLoop:
	 move.l    a5,a1

.CLoop:
	 move.b    (a1)+,d2
	 beq.s     .CLDone
	 cmp.b     #$a,d2
	 bne.s     .CLoop
.CLDone:
	 move.l    a1,d5
	 sub.l     a5,d5
	 subq.l    #1,d5
	 beq.s     .Poisse

	 move.l    d5,d0
	 lsl.l     #3,d0
	 move.l    d1,d6
	 sub.l     d0,d6
	 lsr.l     #1,d6

	 moveq     #1,d4
	 bsr       _DrawText

.Poisse:
	 move.l    a1,a5
	 addq.l    #8,d7

	 tst.b     d2
	 bne.s     .LLoop

	 rts

TPutChar:
	 move.b    d0,(a3)+
	 rts
;fe
;fs "_FText"
_FText:
	 dc.l      FTGetMinMax
	 dc.l      0
	 dc.l      TRender
	 dc.l      0

FTGetMinMax:
	 bsr.s     TGetMinMax
	 move.l    ge_MinWidth(a0),ge_MaxWidth(a0)
	 rts
;fe
;fs "_HProp"
_HProp:
	 dc.l      HPGetMinMax
	 dc.l      HPLayout
	 dc.l      HPRender
	 dc.l      HPClick

HPGetMinMax:
	 moveq     #50,d0
	 move.l    d0,ge_MinWidth(a0)
	 moveq     #0,d0
	 move.l    d0,ge_MaxWidth(a0)

	 moveq     #12,d0
	 move.l    d0,ge_MinHeight(a0)
	 move.l    d0,ge_MaxHeight(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts

HPLayout:
	 move.l    ge_Domain+gd_Width(a0),d0
	 sub.l     #8,d0
	 move.l    d0,d1
	 move.l    ge_Data2(a0),d2

	 move.l    ge_Data3(a0),d3
	 cmp.l     d2,d3
	 bcc.s     .FullKnob

	 mulu      d3,d1
	 divu      d2,d1
	 ext.l     d1

	 cmp.l     #14,d1
	 bcc.s     .FullKnob
	 moveq     #14,d1

.FullKnob:
	 move.l    d1,ge_Temp3(a0)

	 sub.l     d1,d0
	 move.l    d0,ge_Temp(a0)

HPCalcKnobPos:
	 movem.l   ge_Data2(a0),d1-2
	 move.l    ge_Data(a0),d0
	 bpl.s     .MinOk
	 moveq     #0,d0
.MinOk:

	 move.l    d1,d3
	 sub.l     d2,d3
	 bpl.s     .Ok
	 moveq     #0,d3
.Ok:

	 cmp.l     d0,d3
	 bcc.s     .MaxOk
	 move.l    d3,d0
.MaxOk:

	 move.l    d0,ge_Data(a0)

	 mulu      ge_Temp+2(a0),d0
	 sub.l     d2,d1
	 beq.s     .FullKnob

	 divu      d1,d0
	 ext.l     d0

	 move.l    ge_Temp(a0),d1
	 cmp.l     d0,d1
	 bcc.s     .MaxPosOk
	 move.l    d1,d0
.MaxPosOk:

	 addq.l    #4,d0
	 move.l    d0,ge_Temp2(a0)
	 rts

.FullKnob:
	 moveq     #2,d0
	 move.l    d0,ge_Temp2(a0)
	 rts

HPRender:
	 moveq     #0,d0
	 moveq     #0,d1
	 movem.l   ge_Domain+gd_Width(a0),d2-3
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #2,d0
	 moveq     #1,d1
	 movem.l   ge_Domain+gd_Width(a0),d2-3
	 subq.l    #4,d2
	 subq.l    #2,d3
	 st        d4
	 bsr.s     _DrawBevelBox

HPRenderKnob:
	 moveq     #2,d1
	 moveq     #8,d3
	 movem.l   ge_Temp2(a0),d0/d2
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #4,d1
	 move.l    ge_Temp3(a0),d0
	 subq.l    #6,d0
	 lsr.l     #1,d0
	 add.l     ge_Temp2(a0),d0
	 bra.s     _DrawPropHole

HPRenderKnobSelected:
	 moveq     #2,d1
	 moveq     #8,d3
	 movem.l   ge_Temp2(a0),d0/d2
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #3,d5
	 moveq     #6,d7
	 movem.l   ge_Temp2(a0),d4/d6
	 addq.l    #2,d4
	 subq.l    #4,d6
	 moveq     #3,d3
	 bsr.s     _DrawRectangle

	 moveq     #4,d1
	 move.l    ge_Temp3(a0),d0
	 subq.l    #6,d0
	 lsr.l     #1,d0
	 add.l     ge_Temp2(a0),d0
	 bra.s     _DrawPropHole

HPClearKnob:
	 moveq     #2,d5
	 moveq     #8,d7
	 movem.l   ge_Temp2(a0),d4/d6
	 moveq     #0,d3
	 bra.s     _DrawRectangle

HPClick:
	 move.l    d0,d3
	 sub.l     ge_Domain+gd_Left(a0),d0

	 move.l    ge_Temp2(a0),d2
	 cmp.l     d2,d0
	 bcs.s     .BeforeKnob
	 add.l     ge_Temp3(a0),d2
	 cmp.l     d2,d0
	 bcc.s     .AfterKnob

	 sub.l     ge_Temp2(a0),d3
	 move.l    d3,HPOffset

	 add.l     _GuiPos(pc),d1
	 move.l    d1,_MinMouseY
	 move.l    d1,_MaxMouseY

	 addq.l    #4,d3
	 move.l    d3,d1

	 move.l    d3,_MinMouseX

	 add.l     ge_Temp(a0),d1
	 move.l    d1,_MaxMouseX

	 move.l    a0,_ActiveGuiEntry
	 lea       HPHandler(pc),a1
	 move.l    a1,_ActiveThingHandler
	 bra       HPRenderKnobSelected

.BeforeKnob:
	 move.l    ge_Data3(a0),d1
	 subq.l    #1,d1
	 bne.s     .BKOkIncr
	 moveq     #1,d1
.BKOkIncr:

	 move.l    ge_Data(a0),d0
	 sub.l     d1,d0

.KnobOk:
	 move.l    d0,ge_Data(a0)

	 bsr       HPClearKnob

	 bsr       HPCalcKnobPos

	 lea       HPWaitHandler(pc),a1
	 move.l    a1,_ActiveThingHandler

	 move.l    ge_Hook(a0),d0
	 beq       HPRenderKnob
	 move.l    d0,a1
	 move.l    ge_Data(a0),d0

	 move.l    a0,-(a7)
	 jsr       (a1)
	 move.l    (a7)+,a0

	 bra       HPRenderKnob

.AfterKnob:
	 move.l    ge_Data3(a0),d1
	 subq.l    #1,d1
	 bne.s     .AKOkIncr
	 moveq     #1,d1
.AKOkIncr:

	 move.l    ge_Data(a0),d0
	 add.l     d1,d0

	 bra.s     .KnobOk

HPWaitHandler:
	 tst.b     _LMBState
	 bne.s     .Done
	 clr.l     _ActiveThingHandler
.Done:
	 rts

HPHandler:
	 tst.b     _LMBState
	 beq.s     .Release

	 sub.l     HPOffset(pc),d0

	 cmp.l     ge_Temp2(a0),d0
	 beq.s     .Done

	 bsr.s     HPClearKnob
	 move.l    d0,ge_Temp2(a0)
	 bsr.s     HPRenderKnobSelected

	 move.l    ge_Temp2(a0),d0
	 subq.l    #4,d0
	 move.l    ge_Data2(a0),d1
	 sub.l     ge_Data3(a0),d1
	 mulu      d1,d0
	 move.l    ge_Temp(a0),d1
	 divu      d1,d0
	 ext.l     d0

	 move.l    d0,ge_Data(a0)

	 move.l    ge_Hook(a0),d1
	 beq.s     .Done
	 move.l    d1,a1
	 jmp       (a1)

.Done:
	 rts
.Release:
	 clr.l     _MinMouseX
	 clr.l     _MinMouseY

	 move.l    #GuiScreenWidth,_MaxMouseX
	 move.l    #256,_MaxMouseY

	 clr.l     _ActiveThingHandler
	 clr.l     _ActiveGuiEntry
	 bsr.s     HPClearKnob
	 bra.s     HPRenderKnob

HPOffset:
	 ds.l      1
;fe
;fs "_VProp"
_VProp:
	 dc.l      VPGetMinMax
	 dc.l      VPLayout
	 dc.l      VPRender
	 dc.l      VPClick

VPGetMinMax:
	 moveq     #19,d0
	 move.l    d0,ge_MinHeight(a0)
	 moveq     #0,d0
	 move.l    d0,ge_MaxHeight(a0)

	 moveq     #20,d0
	 move.l    d0,ge_MinWidth(a0)
	 move.l    d0,ge_MaxWidth(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts

VPLayout:
	 move.l    ge_Domain+gd_Height(a0),d0
	 sub.l     #4,d0
	 move.l    d0,d1
	 move.l    ge_Data2(a0),d2

	 move.l    ge_Data3(a0),d3
	 cmp.l     d2,d3
	 bcc.s     .FullKnob

	 mulu      d3,d1
	 divu      d2,d1
	 ext.l     d1

	 cmp.l     #8,d1
	 bcc.s     .FullKnob
	 moveq     #8,d1

.FullKnob:
	 move.l    d1,ge_Temp3(a0)

	 sub.l     d1,d0
	 move.l    d0,ge_Temp(a0)

VPCalcKnobPos:
	 movem.l   ge_Data2(a0),d1-2
	 move.l    ge_Data(a0),d0
	 bpl.s     .MinOk
	 moveq     #0,d0
.MinOk:

	 move.l    d1,d3
	 sub.l     d2,d3
	 bpl.s     .Ok
	 moveq     #0,d3
.Ok:

	 cmp.l     d0,d3
	 bcc.s     .MaxOk
	 move.l    d3,d0
.MaxOk:

	 move.l    d0,ge_Data(a0)

	 mulu      ge_Temp+2(a0),d0
	 sub.l     d2,d1
	 beq.s     .FullKnob

	 divu      d1,d0
	 ext.l     d0

	 move.l    ge_Temp(a0),d1
	 cmp.l     d0,d1
	 bcc.s     .MaxPosOk
	 move.l    d1,d0
.MaxPosOk:

	 addq.l    #2,d0
	 move.l    d0,ge_Temp2(a0)
	 rts

.FullKnob:
	 moveq     #2,d0
	 move.l    d0,ge_Temp2(a0)
	 rts

VPRender:
	 moveq     #0,d0
	 moveq     #0,d1
	 movem.l   ge_Domain+gd_Width(a0),d2-3
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #2,d0
	 moveq     #1,d1
	 movem.l   ge_Domain+gd_Width(a0),d2-3
	 subq.l    #4,d2
	 subq.l    #2,d3
	 st        d4
	 bsr.s     _DrawBevelBox

VPRenderKnob:
	 moveq     #4,d0
	 move.l    #12,d2
	 movem.l   ge_Temp2(a0),d1/d3
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #7,d0
	 move.l    ge_Temp3(a0),d1
	 subq.l    #4,d1
	 lsr.l     #1,d1
	 add.l     ge_Temp2(a0),d1
	 bra.s     _DrawPropHole

VPRenderKnobSelected:
	 moveq     #4,d0
	 moveq     #12,d2
	 movem.l   ge_Temp2(a0),d1/d3
	 sf        d4
	 bsr.s     _DrawBevelBox

	 moveq     #6,d4
	 moveq     #8,d6
	 movem.l   ge_Temp2(a0),d5/d7
	 addq.l    #1,d5
	 subq.l    #2,d7
	 moveq     #3,d3
	 bsr.s     _DrawRectangle

	 moveq     #7,d0
	 move.l    ge_Temp3(a0),d1
	 subq.l    #4,d1
	 lsr.l     #1,d1
	 add.l     ge_Temp2(a0),d1
	 bra.s     _DrawPropHole

VPClearKnob:
	 moveq     #4,d4
	 moveq     #12,d6
	 movem.l   ge_Temp2(a0),d5/d7
	 moveq     #0,d3
	 bra.s     _DrawRectangle

VPClick:
	 move.l    d1,d3
	 sub.l     ge_Domain+gd_Top(a0),d1

	 move.l    ge_Temp2(a0),d2
	 cmp.l     d2,d1
	 bcs.s     .BeforeKnob
	 add.l     ge_Temp3(a0),d2
	 cmp.l     d2,d1
	 bcc.s     .AfterKnob

	 sub.l     ge_Temp2(a0),d3
	 move.l    d3,VPOffset

	 move.l    d0,_MinMouseX
	 move.l    d0,_MaxMouseX

	 add.l     _GuiPos(pc),d3
	 addq.l    #2,d3
	 move.l    d3,d1
	 move.l    d3,_MinMouseY

	 add.l     ge_Temp(a0),d1
	 move.l    d1,_MaxMouseY

	 move.l    a0,_ActiveGuiEntry
	 lea       VPHandler(pc),a1
	 move.l    a1,_ActiveThingHandler
	 bra       VPRenderKnobSelected

.BeforeKnob:
	 move.l    ge_Data3(a0),d1
	 subq.l    #1,d1
	 bne.s     .BKOkIncr
	 moveq     #1,d1
.BKOkIncr:

	 move.l    ge_Data(a0),d0
	 sub.l     d1,d0

.KnobOk:
	 move.l    d0,ge_Data(a0)

	 bsr       VPClearKnob

	 bsr       VPCalcKnobPos

	 lea       VPWaitHandler(pc),a1
	 move.l    a1,_ActiveThingHandler

	 move.l    ge_Hook(a0),d0
	 beq       VPRenderKnob
	 move.l    d0,a1
	 move.l    ge_Data(a0),d0

	 move.l    a0,-(a7)
	 jsr       (a1)
	 move.l    (a7)+,a0

	 bra       VPRenderKnob

.AfterKnob:
	 move.l    ge_Data3(a0),d1
	 subq.l    #1,d1
	 bne.s     .AKOkIncr
	 moveq     #1,d1
.AKOkIncr:

	 move.l    ge_Data(a0),d0
	 add.l     d1,d0

	 bra.s     .KnobOk

VPWaitHandler:
	 tst.b     _LMBState
	 bne.s     .Done
	 clr.l     _ActiveThingHandler
.Done:
	 rts

VPHandler:
	 tst.b     _LMBState
	 beq.s     .Release

	 sub.l     VPOffset(pc),d1

	 cmp.l     ge_Temp2(a0),d1
	 beq.s     .Done

	 bsr.s     VPClearKnob
	 move.l    d1,ge_Temp2(a0)
	 bsr.s     VPRenderKnobSelected

	 move.l    ge_Temp2(a0),d1
	 subq.l    #2,d1
	 move.l    ge_Data2(a0),d0
	 sub.l     ge_Data3(a0),d0
	 mulu      d0,d1
	 move.l    ge_Temp(a0),d0
	 divu      d0,d1
	 ext.l     d1
	 move.l    d1,ge_Data(a0)

	 move.l    d1,d0
	 move.l    ge_Hook(a0),d1
	 beq.s     .Done
	 move.l    d1,a1
	 jmp       (a1)

.Done:
	 rts
.Release:
	 clr.l     _MinMouseX
	 clr.l     _MinMouseY

	 move.l    #GuiScreenWidth,_MaxMouseX
	 move.l    #256,_MaxMouseY

	 clr.l     _ActiveThingHandler
	 clr.l     _ActiveGuiEntry
	 bsr.s     VPClearKnob
	 bra.s     VPRenderKnob

VPOffset:
	 ds.l      1
;fe
;fs "_HScroller"
_HScroller:
	 dc.l      HSCGetMinMax
	 dc.l      HSCLayout
	 dc.l      HSCRender
	 dc.l      HSCClick

HSCGetMinMax:
	 moveq     #0,d0
	 move.l    _CtGuiTemp(pc),a1
	 move.l    a1,ge_Temp(a0)
	 lea       ge_Size*7(a1),a2
	 move.l    a2,_CtGuiTemp

	 move.l    #_HGroup,(a1)
	 lea       ge_Size(a1),a1

	 move.l    a1,ge_Temp2(a0)
	 move.l    #_HProp,(a1)
	 move.l    ge_Data(a0),ge_Data(a1)
	 move.l    ge_Data2(a0),ge_Data2(a1)
	 move.l    ge_Data3(a0),ge_Data3(a1)
	 move.l    a0,ge_ID(a1)
	 move.l    #HSCHook,ge_Hook(a1)

	 lea       ge_Size(a1),a1
	 move.l    #_HSpacingEater,(a1)

	 lea       ge_Size(a1),a1
	 move.l    #_SmallButton,(a1)
	 move.l    #$8e,ge_Data(a1)
	 move.l    a0,ge_ID(a1)
	 move.l    #HSCRelHook,ge_Hook(a1)
	 move.l    #HSCDecrHook,ge_Data2(a1)
	 move.l    d0,ge_Data3(a1)

	 lea       ge_Size(a1),a1
	 move.l    #_HSpacingEater,(a1)

	 lea       ge_Size(a1),a1
	 move.l    #_SmallButton,(a1)
	 move.l    #$8d,ge_Data(a1)
	 move.l    a0,ge_ID(a1)
	 move.l    #HSCRelHook,ge_Hook(a1)
	 move.l    #HSCIncrHook,ge_Data2(a1)
	 move.l    d0,ge_Data3(a1)

	 lea       ge_Size(a1),a1
	 clr.l     (a1)

	 move.l    a0,a1
	 move.l    ge_Temp(a1),a0
	 bsr       _GetMinMax

	 move.l    ge_MinWidth(a0),ge_MinWidth(a1)
	 move.l    ge_MaxWidth(a0),ge_MaxWidth(a1)
	 move.l    ge_MinHeight(a0),ge_MinHeight(a1)
	 move.l    ge_MaxHeight(a0),ge_MaxHeight(a1)

	 lea       ge_Size(a1),a0
	 move.l    a0,ge_Next(a1)
	 rts

HSCLayout:
	 move.l    a0,a2
	 move.l    ge_Temp2(a0),a3
	 movem.l   ge_Data(a0),d0-2
	 movem.l   d0-2,ge_Data(a3)

	 move.l    a0,a1
	 move.l    ge_Temp(a1),a0

	 movem.l   ge_Domain(a1),d0-5
	 movem.l   d0-5,ge_Domain(a0)

	 bsr       _Layout

	 move.l    ge_Data(a3),ge_Data(a2)
	 rts

HSCRender:
	 move.l    ge_Temp(a0),a0
	 bra       _Render

HSCClick:
	 move.l    ge_Temp(a0),a0
	 bra       _DoClick

HSCHook:
	 move.l    ge_ID(a0),a1
	 movem.l   ge_Data(a0),d0-2
	 movem.l   d0-2,ge_Data(a1)

HSCCallHook:
	 move.l    ge_Hook(a1),d1
	 beq.s     .Done
	 move.l    a1,a0
	 move.l    d1,a1
	 jmp       (a1)

.Done:
	 rts

HSCDecrHook:
	 sub.l     #1,HSCHookCount
	 bpl.s     .Done

	 move.l    #5,HSCHookCount
	 move.l    ge_ID(a0),a1
	 move.l    ge_Temp2(a1),a0
	 sub.l     #1,ge_Data(a0)
	 bsr       _RefreshGuiEntry

	 move.l    ge_Data(a0),d0
	 move.l    d0,ge_Data(a1)
	 bra.s     HSCCallHook

.Done:
	 rts

HSCIncrHook:
	 sub.l     #1,HSCHookCount
	 bpl.s     .Done

	 move.l    #5,HSCHookCount
	 move.l    ge_ID(a0),a1
	 move.l    ge_Temp2(a1),a0
	 add.l     #1,ge_Data(a0)
	 bsr       _RefreshGuiEntry

	 move.l    ge_Data(a0),d0
	 move.l    d0,ge_Data(a1)
	 bra.s     HSCCallHook

.Done:
	 rts

HSCRelHook:
	 clr.l     HSCHookCount
	 rts

HSCHookCount:
	 dc.l      0
;fe
;fs "_VScroller"
_VScroller:
	 dc.l      VSCGetMinMax
	 dc.l      VSCLayout
	 dc.l      VSCRender
	 dc.l      VSCClick

VSCGetMinMax:
	 moveq     #1,d0
	 move.l    _CtGuiTemp(pc),a1
	 move.l    a1,ge_Temp(a0)
	 lea       ge_Size*7(a1),a2
	 move.l    a2,_CtGuiTemp

	 move.l    #_VGroup,(a1)
	 lea       ge_Size(a1),a1

	 move.l    a1,ge_Temp2(a0)
	 move.l    #_VProp,(a1)
	 move.l    ge_Data(a0),ge_Data(a1)
	 move.l    ge_Data2(a0),ge_Data2(a1)
	 move.l    ge_Data3(a0),ge_Data3(a1)
	 move.l    a0,ge_ID(a1)
	 move.l    #VSCHook,ge_Hook(a1)
	 lea       ge_Size(a1),a1

	 move.l    #_VSpacingEater,(a1)
	 lea       ge_Size(a1),a1

	 move.l    #_SmallButton,(a1)
	 move.l    #$90,ge_Data(a1)
	 move.l    a0,ge_ID(a1)
	 move.l    #VSCRelHook,ge_Hook(a1)
	 move.l    #VSCDecrHook,ge_Data2(a1)
	 move.l    d0,ge_Data3(a1)
	 lea       ge_Size(a1),a1

	 move.l    #_VSpacingEater,(a1)
	 lea       ge_Size(a1),a1

	 move.l    #_SmallButton,(a1)
	 move.l    #$8f,ge_Data(a1)
	 move.l    a0,ge_ID(a1)
	 move.l    #VSCRelHook,ge_Hook(a1)
	 move.l    #VSCIncrHook,ge_Data2(a1)
	 move.l    d0,ge_Data3(a1)
	 lea       ge_Size(a1),a1

	 clr.l     (a1)

	 move.l    a0,a1
	 move.l    ge_Temp(a1),a0
	 bsr       _GetMinMax

	 move.l    ge_MinWidth(a0),ge_MinWidth(a1)
	 move.l    ge_MaxWidth(a0),ge_MaxWidth(a1)
	 move.l    ge_MinHeight(a0),ge_MinHeight(a1)
	 move.l    ge_MaxHeight(a0),ge_MaxHeight(a1)

	 lea       ge_Size(a1),a0
	 move.l    a0,ge_Next(a1)
	 rts

VSCLayout:
	 move.l    a0,a2
	 move.l    ge_Temp2(a0),a3
	 movem.l   ge_Data(a0),d0-2
	 movem.l   d0-2,ge_Data(a3)

	 move.l    a0,a1
	 move.l    ge_Temp(a1),a0

	 movem.l   ge_Domain(a1),d0-5
	 movem.l   d0-5,ge_Domain(a0)

	 bsr       _Layout

	 move.l    ge_Data(a3),ge_Data(a2)
	 rts

VSCRender:
	 move.l    ge_Temp(a0),a0
	 bra       _Render

VSCClick:
	 move.l    ge_Temp(a0),a0
	 bra       _DoClick

VSCHook:
	 move.l    ge_ID(a0),a1
	 movem.l   ge_Data(a0),d0-2
	 movem.l   d0-2,ge_Data(a1)

VSCCallHook:
	 move.l    ge_Hook(a1),d1
	 beq.s     .Done
	 move.l    a1,a0
	 move.l    d1,a1
	 jmp       (a1)

.Done:
	 rts

VSCDecrHook:
	 sub.l     #1,VSCHookCount
	 bpl.s     .Done

	 move.l    #5,VSCHookCount
	 move.l    ge_ID(a0),a1
	 move.l    ge_Temp2(a1),a0
	 sub.l     #1,ge_Data(a0)
	 bsr       _RefreshGuiEntry

	 move.l    ge_Data(a0),d0
	 move.l    d0,ge_Data(a1)
	 bra.s     VSCCallHook

.Done:
	 rts

VSCIncrHook:
	 sub.l     #1,VSCHookCount
	 bpl.s     .Done

	 move.l    #5,VSCHookCount
	 move.l    ge_ID(a0),a1
	 move.l    ge_Temp2(a1),a0
	 add.l     #1,ge_Data(a0)
	 bsr       _RefreshGuiEntry

	 move.l    ge_Data(a0),d0
	 move.l    d0,ge_Data(a1)
	 bra.s     VSCCallHook

.Done:
	 rts

VSCRelHook:
	 clr.l     VSCHookCount
	 rts

VSCHookCount:
	 dc.l      0
;fe
;fs "_ListView"
_ListView:
	 dc.l      LVGetMinMax
	 dc.l      LVLayout
	 dc.l      LVRender
	 dc.l      LVClick

LVGetMinMax:
	 moveq     #1,d0
	 move.l    _CtGuiTemp(pc),a1
	 move.l    a1,ge_Temp(a0)
	 lea       ge_Size*5(a1),a2
	 move.l    a2,_CtGuiTemp

	 move.l    #_HGroup,(a1)
	 lea       ge_Size(a1),a1

	 move.l    a1,ge_Temp2(a0)
	 move.l    #IntListView,(a1)
	 move.l    ge_Data3(a0),ge_Temp3(a1)
	 move.l    a0,ge_ID(a1)
	 move.l    ge_Hook(a0),ge_Hook(a1)
	 lea       ge_Size(a1),a1

	 move.l    #_HSpacingEater,(a1)
	 lea       ge_Size(a1),a1

	 move.l    a1,ge_Temp3(a0)
	 move.l    #_VScroller,(a1)
	 move.l    ge_Data2(a0),ge_Data(a1)
	 move.l    a0,ge_ID(a1)
	 move.l    #LVHook,ge_Hook(a1)
	 lea       ge_Size(a1),a1

	 clr.l     (a1)

	 move.l    a0,a1
	 move.l    ge_Temp(a1),a0
	 bsr       _GetMinMax

	 move.l    ge_MinWidth(a0),ge_MinWidth(a1)
	 move.l    ge_MaxWidth(a0),ge_MaxWidth(a1)
	 move.l    ge_MinHeight(a0),ge_MinHeight(a1)
	 move.l    ge_MaxHeight(a0),ge_MaxHeight(a1)

	 lea       ge_Size(a1),a0
	 move.l    a0,ge_Next(a1)
	 rts

LVLayout:
	 move.l    ge_Data(a0),a1
	 moveq     #0,d6
	 move.l    (a1),a1

	 move.l    (a1),d7
	 beq.s     .EmptyList
	 move.l    d7,d0
	 move.l    a1,d7

.CountEntries:
	 addq.l    #1,d6

	 move.l    d0,a1
	 move.l    (a1),d0
	 bne.s     .CountEntries

.EmptyList:

	 move.l    a0,a3
	 move.l    ge_Temp(a0),a0

	 movem.l   ge_Domain(a3),d0-5
	 movem.l   d0-5,ge_Domain(a0)

	 subq.l    #3,d5
	 lsr.l     #3,d5
	 move.l    ge_Temp2(a3),a1
	 move.l    d5,ge_Temp(a1)
	 move.l    d7,ge_Temp2(a1)
	 lea       ge_Size*2(a1),a1
	 move.l    d6,ge_Data2(a1)
	 move.l    d5,ge_Data3(a1)

	 bsr       _Layout

	 move.l    a3,a0

LVFirstVisAddress:
	 move.l    ge_Temp3(a0),a2
	 sub.l     a1,a1

	 tst.l     ge_Data2(a2)
	 beq.s     .EmptyList

	 move.l    ge_Data(a2),d0
	 move.l    ge_Data(a0),a1

.Loop:
	 move.l    (a1),a1
	 dbf       d0,.Loop

.EmptyList:
	 move.l    ge_Temp2(a0),a2
	 move.l    a1,ge_Temp2(a2)
	 rts

LVRender:
	 move.l    a0,a1
	 move.l    ge_Temp3(a1),a0
	 bsr       _RefreshGuiEntry
	 move.l    ge_Temp2(a1),a0
	 bra       _Render

LVClick:
	 move.l    ge_Temp(a0),a0
	 bra       _DoClick

LVHook:
	 move.l    _CurrentDomain,-(a7)
	 move.l    a0,a1
	 move.l    ge_ID(a1),a0
	 move.l    ge_Data(a1),ge_Data2(a0)
	 bsr.s     LVFirstVisAddress
	 move.l    ge_Temp2(a0),a0
	 lea       ge_Domain(a0),a1
	 move.l    a1,_CurrentDomain
	 bsr       ILVClear
	 bsr       ILVRenderEntries
	 move.l    (a7)+,_CurrentDomain
	 rts

IntListView:
	 dc.l      ILVGetMinMax
	 dc.l      0
	 dc.l      ILVRender
	 dc.l      ILVClick

ILVGetMinMax:
	 move.l    #40,ge_MinWidth(a0)
	 move.l    #12,ge_MinHeight(a0)

	 clr.l     ge_MaxWidth(a0)
	 clr.l     ge_MaxHeight(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts

ILVRender:
	 moveq     #0,d0
	 moveq     #0,d1
	 move.l    ge_Domain+gd_Width(a0),d2
	 move.l    ge_Domain+gd_Height(a0),d3
	 sf        d4
	 bsr       _DrawBevelBox

ILVRenderEntries:
	 moveq     #-1,d0
	 move.l    d0,ge_Data2(a0)

	 move.l    ge_Domain+gd_Width(a0),d0
	 subq.l    #6,d0
	 move.l    d0,_TextLimit

	 move.l    ge_Temp2(a0),d0
	 beq.s     .EmptyList
	 move.l    d0,a1
	 move.l    (a1),d0

	 move.l    ge_Temp(a0),d1
	 subq.l    #1,d1
	 move.l    ge_Temp3(a0),a2

	 moveq     #1,d2

.Loop:
	 moveq     #0,d3
	 cmp.l     a1,a2
	 bne.s     .NoSel
	 moveq     #3,d3
.NoSel:

	 moveq     #2,d4
	 move.l    d2,d5
	 move.l    ge_Domain+gd_Width(a0),d6
	 subq.l    #4,d6
	 moveq     #8,d7
	 move.l    d5,ge_Data2(a0)
	 bsr       _DrawRectangle

;.NoSel:

	 move.l    lve_Color(a1),d4
	 moveq     #0,d5
	 move.l    lve_String(a1),a5
	 moveq     #2,d6
	 move.l    d2,d7
	 bsr.s     _DrawText

	 addq.l    #8,d2
	 move.l    d0,a1
	 move.l    (a1),d0
	 dbeq      d1,.Loop

.EmptyList:

	 clr.l     _TextLimit
	 rts

ILVClear:
	 rts
	 moveq     #0,d3
	 movem.l   ge_Domain+gd_Width(a0),d6-7
	 moveq     #2,d4
	 moveq     #1,d5
	 subq.l    #4,d6
	 subq.l    #2,d7
	 bsr       _DrawRectangle
	 rts

ILVClick:
	 move.l    d1,d2
	 subq.l    #1,d2
	 bpl.s     .Clicku
	 rts

.Clicku:
	 move.l    a0,_ActiveGuiEntry
	 move.l    #ILVHandler,_ActiveThingHandler

ILVHandler:
	 btst      #6,$bfe001
	 bne.s     .Release

	 sub.l     ge_Domain+gd_Top(a0),d1

	 subq.l    #1,d1
	 bmi.s     .Before

	 lsr.l     #3,d1
	 move.l    ge_Temp(a0),d0
	 subq.l    #1,d0

	 cmp.l     d1,d0
	 bcs.s     .After

	 move.l    ge_Temp2(a0),d0
	 beq       .Done

	 clr.l     ILVHookCount

	 move.l    d1,d2
	 move.l    d0,a1

	 subq.l    #1,d1
	 bmi.s     .Vivi

	 move.l    (a1),d0

.Loop:
	 move.l    d0,a1
	 move.l    (a1),d0

	 dbeq      d1,.Loop
	 bne.s     .Vivi

	 move.l    lve_Prev(a1),a1

.Vivi:
	 cmp.l     ge_Temp3(a0),a1
	 beq.s     .Done

	 move.l    a1,ge_Temp3(a0)

	 moveq     #0,d3
	 moveq     #2,d4
	 move.l    ge_Data2(a0),d5
	 bmi       ILVRenderEntries

	 moveq     #8,d7
	 move.l    ge_Domain+gd_Width(a0),d6
	 subq.l    #4,d6
	 bsr       _DrawRectangle
	 bra       ILVRenderEntries

.Before:
	 sub.l     #1,ILVHookCount
	 bpl.s     .Done

	 move.l    #5,ILVHookCount
	 move.l    a0,a3
	 move.l    ge_ID(a3),a1

	 move.l    ge_Temp3(a1),a0
	 move.l    ge_Data(a0),d7
	 move.l    d7,d0
	 subq.l    #1,d0
	 move.l    d0,ge_Data(a0)
	 bsr       _RefreshGuiEntry

	 cmp.l     ge_Data(a0),d7
	 beq.s     .Done

	 move.l    a1,a0
	 bsr       LVFirstVisAddress

	 move.l    a3,a0
	 move.l    ge_Temp2(a0),ge_Temp3(a0)
	 bsr       ILVClear

	 bra       ILVRenderEntries

.After:
	 sub.l     #1,ILVHookCount
	 bpl.s     .Done

	 move.l    #5,ILVHookCount
	 move.l    a0,a3
	 move.l    ge_ID(a3),a1

	 move.l    ge_Temp3(a1),a0
	 move.l    ge_Data(a0),d7
	 move.l    d7,d0
	 addq.l    #1,d0
	 move.l    d0,ge_Data(a0)
	 bsr       _RefreshGuiEntry

	 cmp.l     ge_Data(a0),d7
	 beq.s     .Done

	 move.l    a1,a0
	 bsr       LVFirstVisAddress

	 move.l    a3,a0
	 move.l    ge_Temp3(a0),a1
	 move.l    (a1),a1
	 tst.l     (a1)
	 beq.s     .MaisEuh

	 move.l    a1,ge_Temp3(a0)

.MaisEuh:
	 bsr       ILVClear

	 bra       ILVRenderEntries

.Release:
	 clr.l     _ActiveThingHandler
	 clr.l     _ActiveGuiEntry
	 clr.l     ILVHookCount

	 move.l    ge_ID(a0),a1
	 move.l    ge_Temp3(a0),d0
	 move.l    d0,ge_Data3(a1)

	 move.l    ge_Temp3(a1),a2
	 move.l    ge_Data(a2),ge_Data2(a1)

	 move.l    d0,a0
	 move.l    ge_Hook(a1),d0
	 beq.s     .Done
	 move.l    d0,a1
	 jmp       (a1)

.Done:
	 rts

ILVHookCount:
	 dc.l      0
;fe
;fs "_HSpacingEater"
_HSpacingEater:
	 dc.l      HSEGetMinMax
	 dc.l      0
	 dc.l      0
	 dc.l      -1

HSEGetMinMax:
	 moveq     #-GuiHorSpacing*2,d0
	 move.l    d0,ge_MinWidth(a0)
	 move.l    d0,ge_MaxWidth(a0)

	 clr.l     ge_MinHeight(a0)
	 clr.l     ge_MaxHeight(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts
;fe
;fs "_VSpacingEater"
_VSpacingEater:
	 dc.l      VSEGetMinMax
	 dc.l      0
	 dc.l      0
	 dc.l      -1

VSEGetMinMax:
	 clr.l     ge_MinWidth(a0)
	 clr.l     ge_MaxWidth(a0)

	 moveq     #-GuiVerSpacing*2,d0
	 move.l    d0,ge_MinHeight(a0)
	 move.l    d0,ge_MaxHeight(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts
;fe
;fs "_Empty"
_Empty:
	 dc.l      EGetMinMax
	 dc.l      0
	 dc.l      0
	 dc.l      0

EGetMinMax:
	 clr.l     ge_MinWidth(a0)
	 clr.l     ge_MaxWidth(a0)
	 clr.l     ge_MinHeight(a0)
	 clr.l     ge_MaxHeight(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts
;fe

;fs "_Selector"
_Selector:
	 dc.l      SGetMinMax
	 dc.l      SLayout
	 dc.l      SRender
	 dc.l      SClick

SGetMinMax:
	 move.l    #GuiScreenWidth,d2
	 move.l    d2,ge_MinWidth(a0)
	 move.l    d2,ge_MaxWidth(a0)

	 moveq     #31,d0
	 move.l    d0,ge_MinHeight(a0)

	 move.l    a0,a1
	 lea       ge_Size(a0),a0
	 moveq     #0,d0
	 moveq     #0,d1
	 lsr.l     #1,d2

.Loop:
	 addq.l    #1,d1

	 bsr.s     _GetMinMax

	 add.l     ge_MinWidth(a0),d0
	 cmp.l     d0,d2
	 bcs.s     .Skronk

	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 beq.s     .Done

	 addq.l    #1,d0

	 bra.s     .Loop

.Skronk:
	 sub.l     ge_MinWidth(a0),d0
	 subq.l    #1,d0
	 subq.l    #1,d1
.Done:
	 sub.l     d0,d2

	 subq.l    #1,d1
	 move.l    d1,ge_Temp(a1)
	 beq.s     .SearchLast

	 divu      d1,d2
	 ext.l     d2
	 addq.l    #1,d2
	 move.l    d2,ge_Data(a1)

.SearchLast:
	 tst.l     (a0)
	 beq.s     .AllDone
	 lea       ge_Size(a0),a0
	 bra.s     .SearchLast
.AllDone:

	 lea       ge_Size(a0),a0
	 move.l    a0,ge_Next(a1)
	 rts

SLayout:
	 move.l    _CurrentDomain(pc),a1

	 move.l    a0,a1
	 move.l    ge_Data(a1),d2

	 lea       ge_Size(a0),a0
	 moveq     #0,d0

	 move.l    ge_Temp(a1),d3
	 bne.s     .PosLoop

	 move.l    #GuiScreenWidth/2,d0
	 sub.l     ge_MinWidth(a0),d0
	 lsr.l     #1,d0

.PosLoop:
	 move.l    d0,ge_Domain+gd_Left(a0)

	 move.l    ge_MinWidth(a0),d1
	 move.l    d1,ge_Domain+gd_Width(a0)

	 add.l     d1,d0
	 move.l    d0,ge_Domain+gd_Right(a0)

	 move.l    ge_MinHeight(a0),d1
	 move.l    d1,ge_Domain+gd_Height(a0)
	 move.l    d1,ge_Domain+gd_Bottom(a0)

	 clr.l     ge_Domain+gd_Top(a0)

	 add.l     d2,d0

	 bsr       _Layout

	 move.l    ge_Next(a0),a0
	 dbf       d3,.PosLoop

	 rts

SRender:
	 move.l    _CurrentDomain(pc),a1
	 move.l    gd_Top(a1),d0
	 add.w     GuiP(pc),d0
	 move.w    d0,GuiSelP

	 move.l    #GuiLayer1,_GuiL1Ptr
	 bra       _GRender

SClick:
	 move.l    _CurrentDomain(pc),a1
	 sub.l     gd_Top(a1),d1

	 lea       ge_Size(a0),a0
	 lsr.l     #1,d0

.Loop:
	 cmp2.l    ge_Domain+gd_Left(a0),d0
	 bcs.s     .AGrunt

	 cmp2.l    ge_Domain+gd_Top(a0),d1
	 bcc.s     .Bingo

.AGrunt:
	 move.l    ge_Next(a0),a0
	 tst.l     (a0)
	 bne.s     .Loop
	 rts

.Bingo:
	 bsr.s     _DoClick
	 rts
;fe
;fs "_Sprite"
_Sprite:
	 dc.l      SprGetMinMax
	 dc.l      0
	 dc.l      SprRender
	 dc.l      SprClick

SprGetMinMax:
	 move.l    ge_Data(a0),a1

	 move.l    spd_Width(a1),d0
	 move.l    d0,ge_MinWidth(a0)
	 move.l    d0,ge_MaxWidth(a0)

	 move.l    spd_Height(a1),d0
	 move.l    d0,ge_MinHeight(a0)
	 move.l    d0,ge_MaxHeight(a0)

	 lea       ge_Size(a0),a1
	 move.l    a1,ge_Next(a0)
	 rts

SprRender:         ; d6/d7=X,Y a3=SpriteData
	 move.l    ge_Data(a0),a3

	 move.l    _CurrentDomain(pc),a0
	 move.l    gd_Left(a0),d6
	 move.l    gd_Top(a0),d7

	 move.l    d6,d5
	 and.l     #$f,d5
	 ror.w     #4,d5
	 move.w    d5,d0
	 swap      d5
	 move.w    d0,d5
	 or.l      #$0fca0000,d5

	 lea       SprBlit(pc),a0
	 moveq     #0,d0
	 bsr       _GetBlitNode
	 move.l    a1,a0

	 move.l    d5,(a0)+

	 move.w    spd_WWidth+2(a3),d5
	 addq.w    #1,d5

	 move.w    #GuiSelBufferWidth,d1
	 sub.w     d5,d1
	 sub.w     d5,d1

	 moveq     #-2,d2
	 move.w    d2,(a0)+
	 move.w    d1,(a0)+

	 mulu      #GuiSelLineSize,d7
	 lsr.l     #4,d6
	 add.l     d6,d7
	 add.l     d6,d7

	 add.l     _GuiSelBitmap(pc),d7

	 movem.l   spd_Bitmap(a3),d3-4

	 move.l    d4,(a0)+
	 move.l    d3,(a0)+
	 move.l    d7,(a0)+

	 move.w    spd_Height+2(a3),d2
	 mulu      #NbPlanes,d2
	 move.w    d2,(a0)+
	 move.w    d5,(a0)

	 bsr       _AddBlitNode
	 rts

SprBlit:
	 move.l    (a0)+,bltcon0(a6)
	 moveq     #-1,d0
	 clr.w     d0
	 move.l    d0,bltafwm(a6)
	 move.w    (a0)+,d0
	 move.w    d0,bltamod(a6)
	 move.w    d0,bltbmod(a6)
	 move.w    (a0)+,d0
	 move.w    d0,bltcmod(a6)
	 move.w    d0,bltdmod(a6)
	 move.l    (a0)+,bltapt(a6)
	 move.l    (a0)+,bltbpt(a6)
	 move.l    (a0)+,d0
	 move.l    d0,bltcpt(a6)
	 move.l    d0,bltdpt(a6)
	 move.w    (a0)+,bltsizv(a6)
	 move.w    (a0),bltsizh(a6)
	 rts

SprClick:
	 move.l    a0,_ActiveGuiEntry
	 lea       SprHandler(pc),a1
	 move.l    a1,_ActiveThingHandler
	 rts

SprHandler:
	 tst.b     _LMBState
	 bne.s     .Done

	 clr.l     _ActiveThingHandler
	 move.l    ge_Hook(a0),d0
	 beq.s     .Done
	 move.l    d0,a0
	 jmp       (a0)

.Done:
	 rts
;fe
;fe

_CtGuiTemp:
	 ds.l      1
;fe

_ActiveGuiObject:
	 ds.l      1
_ActiveGuiObjData:
	 ds.l      1
_CurrentDomain:
	 ds.l      1

;fs "_ClearDomain"
_ClearDomain:
	 moveq     #0,d3
	 moveq     #0,d4
	 moveq     #0,d5
	 move.l    _CurrentDomain(pc),a1
	 move.l    gd_Width(a1),d6
	 move.l    gd_Height(a1),d7
	 bsr.s     _DrawRectangle
	 rts
;fe
;fs "_DrawBevelBox"
_DrawBevelBox:     ; d0/d1/d2/d3=X,Y,W,H d4=RecessedFlag
	 movem.l   d3-d7/a0,-(a7)

	 move.l    d3,a0
	 moveq     #2,d3
	 tst.b     d4
	 beq.s     .Raised
	 moveq     #1,d3
.Raised:

	 move.l    d0,d4
	 move.l    d1,d5
	 moveq     #2,d6
	 move.l    a0,d7
	 bsr.s     _DrawRectangle

	 eor.b     #3,d3
	 add.l     d2,d4
	 subq.l    #2,d4
	 bsr.s     _DrawRectangle

	 move.l    d0,d4
	 addq.l    #1,d4
	 add.l     a0,d5
	 subq.l    #1,d5
	 move.l    d2,d6
	 subq.l    #1,d6
	 moveq     #1,d7
	 bsr.s     _DrawRectangle

	 eor.b     #3,d3
	 move.l    d0,d4
	 move.l    d1,d5
	 bsr.s     _DrawRectangle

	 movem.l   (a7)+,d3-7/a0
	 rts
;fe
;fs "_DrawRectangle"
_DrawRectangle:    ; d4/d5/d6/d7=X,Y,W,H d3=Col

	 IFNE      DISABLEGUIGFX
	 rts

	 ELSE

	 movem.l   d0-7/a0-6,-(a7)

	 move.l    _CurrentDomain(pc),a0
	 add.l     gd_Left(a0),d4
	 add.l     gd_Top(a0),d5

	 add.l     #2,_RectCount

	 lea       _RectBlit,a0
	 moveq     #0,d0
	 bsr       _GetBlitNode
	 move.l    a1,a2

	 lea       _RectBlit,a0
	 moveq     #0,d0
	 bsr       _GetBlitNode
	 move.l    a1,a0
	 move.l    a2,a3

	 move.l    #$050c0000,d0
	 move.l    #$05fc0000,d2

	 tst.l     d3
	 bpl.s     .NoInvVid
	 move.l    #$053c0000,d0
	 move.l    d0,d2
.NoInvVid:

	 move.l    d0,d1

	 btst      #0,d3
	 beq.s     .Bp1Ok
	 move.l    d2,d0
.Bp1Ok:
	 move.l    d0,(a0)+
	 btst      #1,d3
	 beq.s     .Bp2Ok
	 move.l    d2,d1
.Bp2Ok:
	 move.l    d1,(a3)+

	 move.l    d4,d0
	 lsr.l     #4,d4

	 and.b     #$f,d0
	 extb.l    d0
	 add.l     d0,d6
	 moveq     #-1,d1
	 lsr.w     d0,d1
	 move.w    d1,(a0)+
	 move.w    d1,(a3)+

	 move.l    d6,d0
	 lsr.l     #4,d6

	 moveq     #-1,d1

	 and.b     #$f,d0
	 beq.s     .Gaaa
	 addq.l    #1,d6
	 lsr.w     d0,d1
	 not.w     d1
.Gaaa:

	 move.w    d1,(a0)+
	 move.w    d1,(a3)+

	 move.l    _GuiBitmap(pc),d0
	 add.l     d4,d0
	 add.l     d4,d0

	 move.l    d5,d1
	 move.l    #GuiLineSize,d2
	 mulu      d2,d1
	 add.l     d1,d0

	 move.l    d0,(a0)+

	 add.l     #GuiBufferWidth,d0
	 move.l    d0,(a3)+

	 sub.l     d6,d2
	 sub.l     d6,d2

	 move.w    d2,(a0)+
	 move.w    d2,(a3)+

	 move.w    d7,(a0)+
	 move.w    d7,(a3)+
	 move.w    d6,(a0)
	 move.w    d6,(a3)

	 bsr       _PreAddBlitNode
	 move.l    a2,a1
	 bsr       _AddBlitNode

	 movem.l   (a7)+,d0-7/a0-6
	 rts
_RectBlit:
	 lea       _RectHook(pc),a5
	 move.l    a5,_BlitHook

	 move.l    (a0)+,bltcon0(a6)
	 move.l    (a0)+,bltafwm(a6)
	 move.l    (a0)+,d0
	 move.l    d0,bltbpt(a6)
	 move.l    d0,bltdpt(a6)
	 move.w    (a0)+,d0
	 move.w    d0,bltbmod(a6)
	 move.w    d0,bltdmod(a6)
	 move.w    #-1,bltadat(a6)
	 move.w    (a0)+,bltsizv(a6)
	 move.w    (a0),bltsizh(a6)
	 rts
_RectHook:
	 sub.l     #1,_RectCount
	 rts
_RectCount:
	 dc.l      0

	 ENDIF
;fe
;fs "_DrawText"
_TextLimit:
	 dc.l      0
_DrawText:         ; d6/d7=X,Y d5=Length d4=Col a5=String
	 movem.l   d3/d5-6/a0/a5,-(a7)

	 tst.l     d5
	 bne.s     .LengthOk

	 move.l    a5,a0
.StrLen:
	 tst.b     (a0)+
	 bne.s     .StrLen
	 sub.l     a5,a0
	 move.l    a0,d5
	 subq.l    #1,d5
	 beq.s     .Done

.LengthOk:

	 move.l    _TextLimit(pc),d3
	 beq.s     .NoClip
	 sub.l     d6,d3
	 lsr.l     #3,d3
	 cmp.l     d5,d3
	 bcc.s     .NoClip
	 move.l    d3,d5
.NoClip:

	 subq.l    #1,d5
	 move.l    d5,d3
.Loop:
	 move.b    (a5)+,d5
	 bsr.s     _DrawChar
	 addq.l    #8,d6
	 dbf       d3,.Loop

.Done:
	 movem.l   (a7)+,d3/d5-6/a0/a5
	 rts
;fe
;fs "_DrawChar"
_DrawChar:         ; d6/d7=X,Y d5=Char d4=Col

	 IFNE      DISABLEGUIGFX
	 rts

	 ELSE

	 movem.l   d0-3/d6-7/a0-2,-(a7)

	 move.l    _CurrentDomain(pc),a0
	 add.l     gd_Left(a0),d6
	 add.l     gd_Top(a0),d7

	 cmp.b     #$a0,d5
	 beq.s     .Done
	 bcs.s     .Ok

	 cmp.b     #$ad,d5
	 bcs.s     .Pfouh
	 beq.s     .Crévindiou
	 subq.b    #1,d5
	 bra.s     .Pfouh
.Crévindiou:
	 move.b    #"-",d5
	 bra.s     .Ok
.Pfouh:
	 subq.b    #1,d5
.Ok:

	 move.l    _GuiBitmap(pc),a1
	 mulu      #GuiLineSize,d7
	 add.l     d7,a1

	 moveq     #0,d7
	 not.b     d7
	 ror.l     #8,d7

	 btst      #0,d5
	 beq.s     .EvenChar
	 subq.l    #2,a1
	 addq.l    #8,d6
	 lsr.l     #8,d7
.EvenChar:

	 lea       _GuiFont(pc),a0
	 and.b     #$fe,d5
	 add.l     d5,a0

	 move.l    d6,d0
	 lsr.l     #3,d0
	 and.b     #$fe,d0
	 add.l     d0,a1

	 and.l     #$f,d6
	 move.l    #254,d0
	 move.l    #GuiBufferWidth,d1
	 moveq     #7,d3

.RWait:
	 tst.l     _RectCount
	 bne.s     .RWait

	 lea       CharTable(pc),a2
	 jsr       (a2,d4.w*2)

.Done:
	 movem.l   (a7)+,d0-3/d6-7/a0-2
	 rts

CharTable:
	 bra.s     CharLoop0
	 bra.s     CharLoop1
	 bra.s     CharLoop2
	 bra.s     CharLoop3

CharLoop0:
	 move.l    (a0),d2
	 and.l     d7,d2
	 lsr.l     d6,d2
	 not.l     d2
	 and.l     d2,(a1)
	 add.l     d1,a1
	 and.l     d2,(a1)
	 add.l     d1,a1
	 add.l     d0,a0
	 dbf       d3,CharLoop0
	 rts
CharLoop1:
	 move.l    (a0),d2
	 and.l     d7,d2
	 lsr.l     d6,d2
	 or.l      d2,(a1)
	 not.l     d2
	 add.l     d1,a1
	 and.l     d2,(a1)
	 add.l     d1,a1
	 add.l     d0,a0
	 dbf       d3,CharLoop1
	 rts
CharLoop2:
	 move.l    (a0),d2
	 and.l     d7,d2
	 lsr.l     d6,d2
	 not.l     d2
	 and.l     d2,(a1)
	 not.l     d2
	 add.l     d1,a1
	 or.l      d2,(a1)
	 add.l     d1,a1
	 add.l     d0,a0
	 dbf       d3,CharLoop2
	 rts
CharLoop3:
	 move.l    (a0),d2
	 and.l     d7,d2
	 lsr.l     d6,d2
	 or.l      d2,(a1)
	 add.l     d1,a1
	 or.l      d2,(a1)
	 add.l     d1,a1
	 add.l     d0,a0
	 dbf       d3,CharLoop3
	 rts

	 ENDIF
;fe
;fs "Font"
_GuiFont:
	 incbin    "GuiFont.bin"
;fe
@


0.75
log
@Fixed some nasty bugs in prop gadgets.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.74 1998/04/14 03:47:27 MORB Exp MORB $
d2606 9
d2650 1
a2650 1
	 movem.l   d2/d4-7/a2-3/a5-6,-(a7)
d2677 48
d2743 19
d2773 1
a2773 1
	 movem.l   (a7)+,d2/d4-7/a2-3/a5-6
d3314 1
a3314 1
	 beq.s     .Groumpf
d3355 1
a3355 1
	 beq.s     .Groumpf
a3563 1
	 bsr       VPRClearKnob
d3568 1
d3575 1
a3575 1
	 beq.s     .Done
@


0.74
log
@Fixed a bug in ScrollAreaClass.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.73 1998/04/12 13:51:48 MORB Exp MORB $
d2816 2
d2856 2
a2857 1
	 move.l    d0,d7
a2915 3

	 cmp.l     d4,d5
	 seq       d0
a2920 3

	 cmp.l     d4,d5
	 seq       d0
d3232 2
d3272 1
a3272 1
	 cmp.l     d5,d0
d3297 1
d4319 1
d4378 2
d4381 1
d4383 5
d4535 3
d4574 3
@


0.73
log
@Added the ability to objzexct
@
text
@d6 1
a6 1
* $Id: Gui.s 0.72 1998/04/11 12:14:55 MORB Exp MORB $
a2852 1
	 bsr.s     HPRClearKnob
d2856 1
d3273 1
a3273 1
	 cmp.l     d5,d1
d4253 1
a4253 1
	 movem.l   d2-3/d7/a2-5,-(a7)
d4255 1
d4269 1
a4269 1
	 subq.l    #2,d0
d4282 1
a4282 1
	 movem.l   (a7)+,d2-3/d7/a2-5
d4526 6
a4531 2
;         tst.l     sac_SADT_VPos(a3)
;         beq.s     .OkVScroller
d4562 6
@


0.72
log
@Modified Props' updating scheme and removed slights bugs in ScrollAreaClass.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.71 1998/04/03 23:54:56 MORB Exp MORB $
d51 3
a53 1
	 rts
d240 37
d342 1
a342 1
	 subq.w    #HotPointX,d6
d344 1
d347 1
a347 1
	 lea       MouseGDwarf(pc),a0
d366 6
a386 3
MouseGDwarf:
	 dc.l      _MouseGardenDwarfDat,0
	 dc.w      0,0,14
d588 1
d611 4
d859 4
a862 1
	 LBLOCKEAI GuiClass_ID,a0,a1
d899 1
a899 4
	 tst.b     _LMBState
	 beq.s     .Grunt

	 LBLOCKEAI RootClass_ID,a0,a0
d909 5
a913 1
	 DOMTDJI   GCM_Click,a0
d916 3
d928 3
a930 1
	 beq.s     GUIToggle
d932 1
d955 1
a955 1
	 LBLOCKEAI GuiClass_ID,a0,a0
d1001 3
d1293 3
d1382 4
d1545 3
d1837 3
d1926 4
d2084 36
d4133 1
d4163 4
d4381 15
@


0.71
log
@Completed ScrollAreaClass. Arf
@
text
@d6 1
a6 1
* $Id: Gui.s 0.70 1998/04/03 19:53:48 MORB Exp MORB $
d865 2
d868 1
d3057 1
a3057 1
	 dc.l      0,0,0,0
a3157 1
	 bsr.s     VPRClearKnob
d3162 1
a3174 1

d3257 2
d3273 2
d3294 2
d3298 3
a3300 1
	 movem.l   vpr_VPDT_KnobPos(a1),d5/d7
d3302 6
a3307 1
	 bra.s     _DrawRectangle
d4019 4
d4134 1
a4134 1
	 movem.l   d2-3/d5-7/a2-5,-(a7)
d4162 1
a4162 1
	 movem.l   (a7)+,d2-3/d5-7/a2-5
d4207 1
a4207 1
	 movem.l   d2-7/a2-5,-(a7)
d4210 1
a4210 1
	 move.l    a0,a4
d4212 1
a4212 1
	 LBLOCKEAI GuiRootClass_ID,a4,a2
d4215 1
a4215 1
	 LBLOCKEAI ScrollAreaClass_ID,a2,a3
d4257 1
a4257 1
	 DOMTDI    SAM_ContentsUpdate,a2
d4260 1
a4260 1
	 movem.l   (a7)+,d2-7/a2-5
d4307 20
d4388 2
d4391 4
d4420 2
d4424 2
d4428 2
a4429 1
	 moveq     #2,d0
d4431 2
a4432 1
	 moveq     #1,d1
d4471 1
a4471 1
	 move.l    sac_SADT_VPos(a1),d0
@


0.70
log
@Added GCM_Update method to Props and scrollers, and partially written ScrollAreaClass.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.69 1998/03/30 19:36:12 MORB Exp MORB $
d4002 2
d4025 7
a4031 7
	 ;move.l    #GCM_Update,d0
	 ;lea       SACUpdate,a1
	 ;bsr       _SetMethod

	 ;move.l    #GCM_Click,d0
	 ;lea       SACClick,a1
	 ;bsr       _SetMethod
d4037 1
d4059 7
d4075 7
d4178 2
d4186 102
d4303 3
a4314 1

d4316 3
d4391 39
@


0.69
log
@Changed the way mouse buttons are tested. Should now works on 060.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.68 1998/02/11 12:01:51 MORB Exp MORB $
d2658 3
a2718 5
	 movem.l   d2-7,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)

	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain
d2721 1
a2721 1
	 bra.s     HPRUpdate
d2724 5
a2734 1
	 add.l     #1,hpr_HPDT_Position(a1)
a2735 1
HPRUpdate:
d3077 3
d3138 3
a3140 2
	 movem.l   d2-7,-(a7)
	 move.l    _CurrentDomain(pc),-(a7)
d3142 1
a3142 2
	 LBLOCKEAI GuiRootClass_ID,a0,a1
	 move.l    a1,_CurrentDomain
d3144 2
d3147 1
a3147 7
	 move.l    vpr_VPDT_Position(a1),d1
	 move.l    d1,d0
	 subq.l    #1,d0
	 move.l    d0,vpr_VPDT_Position(a1)
	 bra.s     VPRUpdate

VPRIncr:
a3154 6
	 move.l    vpr_VPDT_Position(a1),d1
	 move.l    d1,d0
	 addq.l    #1,d0
	 move.l    d0,vpr_VPDT_Position(a1)

VPRUpdate:
d3582 4
d3745 4
d3802 4
d3965 4
d3982 286
d4269 1
d4282 2
a4283 1

d4313 1
d4315 1
d4342 2
a4343 1

d4362 2
a4363 1

d4520 2
a4521 1

d4601 2
a4602 1

d4640 2
a4641 1

d4657 2
a4658 1

d4753 1
@


0.68
log
@Assemblage conditionnel pour les routines graphiques bas niveau (util pour debug)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.67 1998/01/04 15:17:01 MORB Exp MORB $
d246 7
d334 7
d438 2
a439 2
	 btst      #6,$bfe001
	 bne.s     .OhEtPuisMerdeTousVouf
d533 1
a533 1
	 dc.l      0,0
d536 7
d573 7
d595 1
a595 1
	 dc.l      -1,0,0
d598 1
d815 35
a849 2
	 btst      #6,$bfe001
	 bne.s     .Grunt
d904 4
d1354 2
a1355 2
	 btst      #6,$bfe001
	 bne.s     .Release
d1888 2
a1889 2
	 btst      #6,$bfe001
	 bne.s     .Release
d2183 2
a2184 2
	 btst      #6,$bfe001
	 bne.s     .Desactivate
d2344 2
a2345 2
	 btst      #6,$bfe001
	 beq.s     .Ok
d2972 2
a2973 2
	 btst      #6,$bfe001
	 beq.s     .Done
d2987 2
a2988 2
	 btst      #6,$bfe001
	 bne.s     .Release
d3396 2
a3397 2
	 btst      #6,$bfe001
	 beq.s     .Done
d3411 2
a3412 2
	 btst      #6,$bfe001
	 bne.s     .Release
d4354 2
a4355 2
	 btst      #6,$bfe001
	 bne.s     .Release
d5137 2
a5138 2
	 btst      #6,$bfe001
	 bne.s     .Desactivate
d5273 2
a5274 2
	 btst      #6,$bfe001
	 bne.s     .Desactivate
d5391 2
a5392 2
	 btst      #6,$bfe001
	 beq.s     .Ok
d5781 2
a5782 2
	 btst      #6,$bfe001
	 beq.s     .Done
d5788 2
a5789 2
	 btst      #6,$bfe001
	 bne.s     .Release
d6052 2
a6053 2
	 btst      #6,$bfe001
	 beq.s     .Done
d6059 2
a6060 2
	 btst      #6,$bfe001
	 bne.s     .Release
d7059 2
a7060 2
	 btst      #6,$bfe001
	 beq.s     .Done
@


0.67
log
@Changement de VHandle et HHAndle en VKnob et HKnob sur conseil du ToXn
@
text
@d6 1
a6 1
* $Id: Gui.s 0.66 1998/01/04 02:17:45 MORB Exp MORB $
d525 1
d549 1
d2569 1
d2631 14
d2679 1
a2679 1
	 move.l    guir_DTA_Hook(a1),d2
d2682 2
a2683 1
	 move.l    d2,a1
d2890 1
a2890 1
	 move.l    guir_DTA_Hook(a1),d2
d2893 2
a2894 1
	 move.l    d2,a1
d2913 1
d2943 1
a2943 1
	 move.l    guir_DTA_Hook(a1),d2
d2946 2
a2947 1
	 move.l    d2,a1
d2952 1
d2967 1
d2987 1
d3049 14
d3106 1
a3106 1
	 move.l    guir_DTA_Hook(a1),d2
d3109 2
a3110 1
	 move.l    d2,a1
d3314 1
a3314 1
	 move.l    guir_DTA_Hook(a1),d2
d3317 2
a3318 1
	 move.l    d2,a1
d3337 1
a3337 1
	 move.l    d2,-(a7)
d3367 1
a3367 1
	 move.l    guir_DTA_Hook(a1),d2
d3370 2
a3371 1
	 move.l    d2,a1
d3376 1
a3376 1
	 move.l    (a7)+,d2
d3391 1
a3391 1
	 move.l    (a7)+,d2
d3400 6
a3405 1
	 ;rts
d3479 2
d3495 1
a3495 1
	 dc.l      0
d3610 1
a3610 1
	 move.l    d2,-(a7)
d3617 1
a3617 1
	 move.l    guir_DTA_Hook(a1),d2
d3620 1
a3620 1
	 move.l    d2,a1
d3624 1
a3624 1
	 move.l    (a7)+,d2
d3657 1
a3657 1
	 move.l    hsc_HSDT_Prop(a4),a3
d3659 2
a3660 2
	 movem.l   (a4),d0-2
	 movem.l   d0-2,(a3)
d3707 1
a3707 1
	 dc.l      0
d3822 1
a3822 1
	 move.l    d2,-(a7)
d3829 1
a3829 1
	 move.l    guir_DTA_Hook(a1),d2
d3832 1
a3832 1
	 move.l    d2,a1
d3836 1
a3836 1
	 move.l    (a7)+,d2
d3871 2
a3872 2
	 movem.l   (a4),d0-2
	 movem.l   d0-2,(a3)
d7070 6
a7075 1
	 ;rts
d7195 2
d7241 6
a7246 1
	 ;rts
d7363 2
@


0.66
log
@Ajout d'arrondis sur les divisions dans les groupes et les handles
@
text
@d6 1
a6 1
* $Id: Gui.s 0.65 1998/01/04 00:56:17 MORB Exp MORB $
d1131 2
a1132 2
;fs "VHandleClass"
_VHandleClass:
d1136 1
a1136 1
	 dc.l      vhd_DataSize
d1156 1
a1156 1
	 lea       VHDLayout,a1
d1159 1
a1159 1
	 lea       VHDRender,a1
d1162 1
a1162 1
	 lea       VHDClick,a1
d1165 1
a1165 1
	 lea       VHDHandler,a1
d1169 1
a1169 1
VHDLayout:
d1195 2
a1196 2
	 LBLOCKEAI VHandleClass_ID,a0,a1
	 movem.l   d0-2,vhd_VHDT_TotSize(a1)
d1204 1
a1204 1
	 lea       VHDAB(pc),a0
d1209 1
a1209 1
	 lea       VHDAE(pc),a0
d1214 1
a1214 1
	 lea       VHD2NW(pc),a0
d1218 1
a1218 1
VHDRender:
d1231 3
a1233 3
	 LBLOCKEAI VHandleClass_ID,a0,a0
	 move.l    d1,vhd_VHDT_MaxPos(a0)
	 add.l     d2,vhd_VHDT_TotSize(a0)
d1247 1
a1247 1
VHDClick:
d1257 1
a1257 1
	 move.l    d0,VHDOffset
d1259 1
a1259 1
	 LBLOCKEAI VHandleClass_ID,a0,a1
d1261 1
a1261 1
	 movem.l   vhd_VHDT_MinPos(a1),d0-1
d1267 1
a1267 1
	 sf        VHDFlag
d1273 1
a1273 1
VHDHandler:
d1284 1
a1284 1
	 move.l    VHDPos(pc),d4
d1289 3
a1291 3
	 sub.l     VHDOffset(pc),d0
	 move.l    d0,VHDPos
	 tst.b     VHDFlag
d1297 1
a1297 1
	 tst.b     VHDFlag
d1303 1
a1303 1
	 st        VHDFlag
d1311 1
a1311 1
	 tst.b     VHDFlag
d1327 2
a1328 2
	 LBLOCKEAI VHandleClass_ID,a0,a1
	 movem.l   vhd_VHDT_TotSize(a1),d0-1
d1361 1
a1361 1
VHDOffset:
d1363 1
a1363 1
VHDPos:
d1365 1
a1365 1
VHDFlag:
d1368 9
a1376 9
VHDAB:
	 dc.l      VHDName
	 dc.l      HDLAtBeg
VHDAE:
	 dc.l      VHDName
	 dc.l      HDLAtEnd
VHD2NW:
	 dc.l      VHDName
	 dc.l      HDL2Null
d1378 2
a1379 2
VHDName:
	 dc.b      "VHandleClass",0
d1665 2
a1666 2
;fs "HHandleClass"
_HHandleClass:
d1670 1
a1670 1
	 dc.l      hhd_DataSize
d1690 1
a1690 1
	 lea       HHDLayout,a1
d1693 1
a1693 1
	 lea       HHDRender,a1
d1696 1
a1696 1
	 lea       HHDClick,a1
d1699 1
a1699 1
	 lea       HHDHandler,a1
d1703 1
a1703 1
HHDLayout:
d1729 2
a1730 2
	 LBLOCKEAI HHandleClass_ID,a0,a1
	 movem.l   d0-2,hhd_HHDT_TotSize(a1)
d1738 1
a1738 1
	 lea       HHDAB(pc),a0
d1743 1
a1743 1
	 lea       HHDAE(pc),a0
d1748 1
a1748 1
	 lea       HHD2NW(pc),a0
d1752 1
a1752 1
HHDRender:
d1765 3
a1767 3
	 LBLOCKEAI HHandleClass_ID,a0,a0
	 move.l    d1,hhd_HHDT_MaxPos(a0)
	 add.l     d2,hhd_HHDT_TotSize(a0)
d1781 1
a1781 1
HHDClick:
d1790 1
a1790 1
	 move.l    d1,HHDOffset
d1792 1
a1792 1
	 LBLOCKEAI HHandleClass_ID,a0,a1
d1795 1
a1795 1
	 movem.l   hhd_HHDT_MinPos(a1),d0-1
d1801 1
a1801 1
	 sf        HHDFlag
d1807 1
a1807 1
HHDHandler:
d1818 1
a1818 1
	 move.l    HHDPos(pc),d5
d1823 3
a1825 3
	 sub.l     HHDOffset(pc),d1
	 move.l    d1,HHDPos
	 tst.b     HHDFlag
d1831 1
a1831 1
	 tst.b     HHDFlag
d1837 1
a1837 1
	 st        HHDFlag
d1845 1
a1845 1
	 tst.b     HHDFlag
d1861 2
a1862 2
	 LBLOCKEAI HHandleClass_ID,a0,a1
	 movem.l   hhd_HHDT_TotSize(a1),d0-1
d1895 1
a1895 1
HHDOffset:
d1897 1
a1897 1
HHDPos:
d1899 1
a1899 1
HHDFlag:
d1902 9
a1910 9
HHDAB:
	 dc.l      HHDName
	 dc.l      HDLAtBeg
HHDAE:
	 dc.l      HHDName
	 dc.l      HDLAtEnd
HHD2NW:
	 dc.l      HHDName
	 dc.l      HDL2Null
d1912 2
a1913 2
HHDName:
	 dc.b      "HHandleClass",0
d1973 7
a1979 7
;fs "Common handle datas"
HDLAtBeg:
	 dc.b      "Handle is at the begin of a group",0
HDLAtEnd:
	 dc.b      "Handle is at the end of a group",0
HDL2Null:
	 dc.b      "Handle is between two objects with null weights",0
@


0.65
log
@Implémentation des poids et des handles dans les groupes verticaux
@
text
@d6 1
a6 1
* $Id: Gui.s 0.64 1998/01/03 23:35:12 MORB Exp MORB $
d1010 6
d1052 6
d1096 6
d1103 1
a1337 1
	 move.w    d3,d0
d1339 4
a1343 2
	 lsl.w     #1,d0
	 addx.l    d4,d3
d1544 6
d1586 6
d1630 6
d1637 1
a1871 1
	 move.w    d3,d0
d1873 4
a1877 2
	 lsl.w     #1,d0
	 addx.l    d4,d3
@


0.64
log
@Implémentation des VHandle (trucs pour faire comme les balancing groups d'mui, mais mieux)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.63 1998/01/03 16:52:00 MORB Exp MORB $
d1350 1
a1350 1
	 dc.l      VHDAtBeg
d1353 1
a1353 1
	 dc.l      VHDAtEnd
d1356 1
a1356 1
	 dc.l      VHD2Null
a1359 6
VHDAtBeg:
	 dc.b      "Handle is at the begin of a group",0
VHDAtEnd:
	 dc.b      "Handle is at the end of a group",0
VHD2Null:
	 dc.b      "Handle is between two objects with null weights",0
a1406 1
	 ;bset      #31,d5
d1474 1
d1486 3
a1488 1
	 addq.l    #1,d7
d1494 7
d1503 2
a1504 5
	 move.l    d7,d0
	 subq.l    #1,d0
	 move.l    a3,d1
	 muls      d1,d0
	 sub.l     d0,d5
a1506 8
	 tst.l     d7
	 beq.s     .MoreOrLessBigLoop

	 move.l    d5,d4
	 divu      d7,d4
	 ext.l     d4

.MoreOrLessBigLoop:
d1518 8
d1528 1
d1531 1
a1531 1
	 subq.l    #1,d7
d1544 1
a1544 1
	 subq.l    #1,d7
d1556 3
a1558 2
	 move.l    d7,d2
	 addq.l    #1,d2
d1562 2
a1563 2
	 move.l    guir_DTA_MinHeight(a0),d2
	 cmp.l     d2,d0
d1566 1
a1566 1
	 move.l    guir_DTA_MaxHeight(a0),d2
d1568 1
a1568 1
	 cmp.l     d0,d2
d1574 2
a1575 3
	 addq.l    #1,d7
	 move.l    d0,d4
	 bra.s     .MoreOrLessBigLoop
d1579 1
a1579 1
	 bra.s     .Loop
d1594 6
a1599 2
	 move.l    d4,d3
	 move.l    d4,gd_Height(a0)
d1618 257
d1931 9
@


0.63
log
@Modification des groupes horizontaux pour faire du layout pondéré
@
text
@d6 1
a6 1
* $Id: Gui.s 0.62 1998/01/03 15:21:44 MORB Exp MORB $
d518 1
a519 1
	 dc.l      1000
d980 7
d1004 1
a1004 1
	 move.l    guir_DTA_Weight(a0),d1
d1007 1
a1007 1
	 move.l    d1,d4
d1017 1
a1017 1
	 sub.l     d1,d7
d1030 1
a1030 1
	 sub.l     d1,d7
d1043 1
d1104 263
d1614 1
d1667 4
d6732 8
a6740 1
	 move.l    #$05fc0000,d2
@


0.62
log
@Ajout de messages d'erreur lorsque'on essaye d'ouvrir une gui planteuse
@
text
@d6 1
a6 1
* $Id: Gui.s 0.61 1998/01/03 14:08:13 MORB Exp MORB $
d518 2
a519 1
	 dc.l      0
a892 1
	 ;bset      #31,d5
d960 1
d972 3
a974 1
	 addq.l    #1,d7
d982 2
a983 5
	 move.l    d7,d0
	 subq.l    #1,d0
	 move.l    a3,d1
	 muls      d1,d0
	 sub.l     d0,d5
a985 8
	 tst.l     d7
	 beq.s     .MoreOrLessBigLoop

	 move.l    d5,d4
	 divu      d7,d4
	 ext.l     d4

.MoreOrLessBigLoop:
d997 8
d1007 1
d1010 1
a1010 1
	 subq.l    #1,d7
d1023 1
a1023 1
	 subq.l    #1,d7
d1035 2
a1036 2
	 move.l    d7,d2
	 addq.l    #1,d2
d1040 2
a1041 2
	 move.l    guir_DTA_MinWidth(a0),d2
	 cmp.l     d2,d0
d1044 1
a1044 1
	 move.l    guir_DTA_MaxWidth(a0),d2
d1046 1
a1046 1
	 cmp.l     d0,d2
d1052 2
a1053 3
	 addq.l    #1,d7
	 move.l    d0,d4
	 bra.s     .MoreOrLessBigLoop
d1057 1
a1057 1
	 bra.s     .Loop
d1072 6
a1077 2
	 move.l    d4,d3
	 move.l    d4,gd_Width(a0)
@


0.61
log
@Réimplémentation des ListViews... argh (maintenant elles sont vachement mieux)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.60 1998/01/01 13:57:45 MORB Exp MORB $
d151 5
a155 2
	 move.l    ReqGuiObj,a0
	 DOMTDI    GM_Open,a0
d159 22
d462 5
a466 2
	 move.l    d0,a0
	 DOMTDI    GM_Open,a0
d472 24
d549 1
d616 3
d630 2
d636 1
a636 1
	 movem.l   d2/a2,-(a7)
d645 3
d650 1
d657 2
d666 2
d672 1
a672 1
	 movem.l   (a7)+,d2/a2
d713 1
a713 1
	 move.l    a2,-(a7)
d722 5
d745 2
a746 1
	 move.l    (a7)+,a2
d749 19
d838 8
d1081 2
d1088 2
d1327 2
d1334 2
d1483 1
d2037 1
d2434 1
d3033 1
d3245 1
d3510 1
@


0.60
log
@Nadaptu Request nouvelles routines gui gnargh
@
text
@d6 1
a6 1
* $Id: Gui.s 0.59 1997/12/31 19:19:46 MORB Exp MORB $
d1405 1
d1444 2
d2335 5
a2339 1
	 sub.l     #1,vpr_VPDT_Position(a1)
d2349 5
a2353 1
	 add.l     #1,vpr_VPDT_Position(a1)
d2358 2
a2359 1
	 move.l    d0,d7
d2380 2
a2381 3
	 movem.l   vpr_VPDT_Total(a1),d1-2
	 move.l    vpr_VPDT_Position(a1),d4
	 move.l    d4,d5
d2387 2
a2388 2
	 move.l    d1,d3
	 sub.l     d2,d3
d2390 1
a2390 1
	 moveq     #0,d3
d2393 1
a2393 1
	 cmp.l     d5,d3
d2395 1
a2395 1
	 move.l    d3,d5
d2402 1
a2402 1
	 sub.l     d2,d1
d2405 1
a2405 1
	 divu      d1,d0
d2408 2
a2409 2
	 move.l    vpr_VPDT_MaxPos(a1),d1
	 cmp.l     d0,d1
d2411 1
a2411 1
	 move.l    d1,d0
a2415 3

	 cmp.l     d4,d5
	 seq       d0
a2420 3

	 cmp.l     d4,d5
	 seq       d0
d2537 2
a2538 2
	 move.l    vpr_VPDT_Visible(a1),d1
	 subq.l    #1,d1
d2540 1
a2540 1
	 moveq     #1,d1
d2542 1
a2542 1
	 move.l    vpr_VPDT_Position(a1),d0
d2547 2
a2548 2
	 move.l    vpr_VPDT_Visible(a1),d1
	 subq.l    #1,d1
d2550 1
a2550 1
	 moveq     #1,d1
d2552 3
a2554 2
	 move.l    vpr_VPDT_Position(a1),d0
	 sub.l     d1,d0
d2561 3
a2563 1
	 move.l    d0,d7
d2596 1
d2634 1
d2649 1
d2656 77
d2905 7
a2911 1
	 movem.l   d2-5/a2,-(a7)
d2921 1
d2923 1
a2923 1
	 movem.l   (a7)+,d2-5/a2
d3116 7
a3122 1
	 movem.l   d2-5/a2,-(a7)
d3132 1
d3134 1
a3134 1
	 movem.l   (a7)+,d2-5/a2
d3155 475
a5284 76
;fe
;fs "_DrawPropHole"
_DrawPropHole:     ; d0/d1=X,Y
	 movem.l   d0-3/a0,-(a7)

	 move.l    _CurrentDomain(pc),a0
	 add.l     gd_Left(a0),d0
	 add.l     gd_Top(a0),d1

	 move.l    _GuiBitmap(pc),a0
	 mulu      #GuiLineSize,d1
	 add.l     d1,a0
	 move.l    d0,d1
	 lsr.l     #3,d1
	 add.l     d1,a0

	 not.l     d0
	 and.l     #7,d0
	 addq.l    #3,d0

.RWait:
	 tst.l     _RectCount
	 bne.s     .RWait

	 moveq     #$1c,d1
	 lsl.w     d0,d1
	 or.w      d1,(a0)
	 lea       GuiBufferWidth(a0),a0
	 not.w     d1
	 and.w     d1,(a0)
	 lea       GuiBufferWidth(a0),a0

	 moveq     #$3f,d1
	 lsl.w     d0,d1
	 not.w     d1

	 move.w    (a0),d3
	 and.w     d1,d3
	 moveq     #$38,d2
	 lsl.w     d0,d2
	 or.w      d2,d3
	 move.w    d3,(a0)
	 lea       GuiBufferWidth(a0),a0
	 move.w    (a0),d3
	 and.w     d1,d3
	 moveq     #3,d2
	 lsl.w     d0,d2
	 or.w      d2,d3
	 move.w    d3,(a0)
	 lea       GuiBufferWidth(a0),a0

	 move.w    (a0),d3
	 and.w     d1,d3
	 moveq     #$30,d2
	 lsl.w     d0,d2
	 or.w      d2,d3
	 move.w    d3,(a0)
	 lea       GuiBufferWidth(a0),a0
	 move.w    (a0),d3
	 and.w     d1,d3
	 moveq     #7,d2
	 lsl.w     d0,d2
	 or.w      d2,d3
	 move.w    d3,(a0)
	 lea       GuiBufferWidth(a0),a0

	 moveq     #$e,d1
	 lsl.w     d0,d1
	 move.w    d1,d2
	 not.w     d2
	 and.w     d2,(a0)
	 lea       GuiBufferWidth(a0),a0
	 or.w      d1,(a0)

	 movem.l   (a7)+,d0-3/a0
	 rts
@


0.59
log
@Adaptations d'une grande partie de la gui au nouveau système d'OO (passage transparent de l'ancien vers le nouveau système)
@
text
@d4 1
a4 1
* ©1997, CdBS Software (MORB)
d6 1
a6 1
* $Id: Gui.s 0.58 1997/11/05 18:48:03 MORB Exp MORB $
d88 2
d92 1
a93 1
	 move.l    _CurrentGui,_ReqLastGui
d95 7
a101 3
	 move.l    a0,ReqTitle+ge_Data
	 move.l    a1,ReqBody+ge_Data
	 move.l    a4,ReqBody+ge_Data2
d103 9
a111 4
	 lea       _GuiTemp,a0
	 lea       ReqButtons(pc),a1
	 moveq     #1,d1
	 lea       _Button(pc),a3
d114 10
a123 2
	 move.l    a3,(a1)
	 move.l    a0,ge_Data(a1)
d126 1
a126 1
	 move.b    (a2)+,d0
d130 1
a130 1
	 move.b    d0,(a0)+
d134 3
a136 2
	 clr.b     (a0)+
	 move.l    d1,ge_ID(a1)
d141 2
a142 2
	 addq.l    #1,d1
	 lea       ge_Size(a1),a1
d146 1
a146 1
	 move.l    a0,_CtGuiTemp
d148 1
a148 3
	 clr.l     ge_ID(a1)
	 clr.l     ge_Size(a1)
	 clr.l     ge_Size*2(a1)
d150 5
a154 2
	 lea       ReqGui(pc),a0
	 bra.s     _ChangeGui
d157 1
a157 1
	 move.l    ge_ID(a0),d0
d159 6
a164 2
	 move.l    _ReqLastGui,a0
	 bsr.s     _ChangeGui
d166 1
d169 2
d172 2
d175 1
d178 3
d182 1
a182 1
	 GENTRY    _VGroup,0,0
d184 1
a184 3
	 GENTRY    _HGroup,0,0
	 GENTRY    _SmallButton,"X",_ReqButHook
	 GENTRY    _SmallButton,"I",_Iconify
d186 5
d192 3
a194 2
	 GENTRY    _DragBar,0,0
	 GEND
d196 2
d199 5
a203 1
	 GENTRY    _Text,0,0
d205 2
a206 1
	 GENTRY    _HGroup,0,0
d208 1
a208 4
ReqButtons:
	 rept      20
	 GENTRY    0,0,_ReqButHook
	 endr
d210 1
a210 1
	 GEND
d511 1
a511 1
	 dc.l      0,0,0,0,0,0
d565 9
d648 2
d688 4
d708 8
d728 2
d733 2
d738 8
a762 3
	 LBLOCKEAI GuiRootClass_ID,a2,a3
	 add.l     a1,a3

a1004 3
	 LBLOCKEAI GuiRootClass_ID,a2,a3
	 add.l     a1,a3

d1817 35
d2010 1
a2010 1
	 sne       d0
d2018 1
a2018 1
	 sne       d0
d2407 1
a2407 1
	 sne       d0
d2415 1
a2415 1
	 sne       d0
@


0.58
log
@Support de formatage dans les textes de requesters (= ajout d'un move quelque part ;-)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.57 1997/10/02 21:30:25 MORB Exp MORB $
d11 1
a11 1
         ds.l      1
d13 1
a13 1
         ds.l      1
d15 1
a15 1
         ds.l      1
d17 1
a17 1
         ds.l      1
d19 4
a22 4
         lea       _GuiBpPtrs,a0
         move.l    _GuiBitmap(pc),d0
         move.w    #bplpt,d1
         moveq     #NbGuiPlanes-1,d2
d24 16
a39 16
         swap      d0
         move.w    d1,(a0)+
         move.w    d0,(a0)+
         addq.w    #2,d1
         move.w    d1,(a0)+
         swap      d0
         move.w    d0,(a0)+
         addq.w    #2,d1
         add.l     #GuiBufferWidth,d0
         dbf       d2,.Loop

         lea       _GuiSelBpPtrs,a0
         move.l    _GuiSelBitmap(pc),d0
         move.l    d0,$8f00000
         move.w    #bplpt,d1
         moveq     #NbPlanes-1,d2
d41 11
a51 11
         swap      d0
         move.w    d1,(a0)+
         move.w    d0,(a0)+
         addq.w    #2,d1
         move.w    d1,(a0)+
         swap      d0
         move.w    d0,(a0)+
         addq.w    #2,d1
         add.l     #GuiSelBufferWidth,d0
         dbf       d2,.Loop2
         rts
d55 1
a55 1
         dc.l      0,0
d57 3
a59 3
         dc.w      $29+240,CET_BREAK
         dc.l      _GuiCList
         dc.l      _GuiCopTable
d62 1
a62 1
         dc.l      GuiNml
d64 1
a64 1
         dc.l      CopEnd,-1
d67 1
a67 1
         dc.l      0,0
d69 3
a71 3
         dc.w      $29+240,CET_BREAK
         dc.l      _GuiSelCList
         dc.l      _GuiSelCopTable
d74 2
a75 2
         dc.l      GuiSelNml
         dc.l      CopEnd,-1
d78 3
a80 3
         dc.l      0,0
         dc.w      $29+256,CET_BREAK
         dc.l      0,0
d85 1
a85 1
         ds.l      1
d87 1
a87 1
         ds.l      1
d90 2
a91 2
         move.l    a3,_ReqHook
         move.l    _CurrentGui,_ReqLastGui
d93 8
a100 8
         move.l    a0,ReqTitle+ge_Data
         move.l    a1,ReqBody+ge_Data
         move.l    a4,ReqBody+ge_Data2

         lea       _GuiTemp,a0
         lea       ReqButtons(pc),a1
         moveq     #1,d1
         lea       _Button(pc),a3
d103 2
a104 2
         move.l    a3,(a1)
         move.l    a0,ge_Data(a1)
d107 6
a112 6
         move.b    (a2)+,d0
         beq.s     .CDone
         cmp.b     #"|",d0
         beq.s     .CDone
         move.b    d0,(a0)+
         bra.s     .CLoop
d115 2
a116 2
         clr.b     (a0)+
         move.l    d1,ge_ID(a1)
d118 2
a119 2
         tst.b     d0
         beq.s     .BDone
d121 3
a123 3
         addq.l    #1,d1
         lea       ge_Size(a1),a1
         bra.s     .BLoop
d126 1
a126 1
         move.l    a0,_CtGuiTemp
d128 3
a130 3
         clr.l     ge_ID(a1)
         clr.l     ge_Size(a1)
         clr.l     ge_Size*2(a1)
d132 2
a133 2
         lea       ReqGui(pc),a0
         bra.s     _ChangeGui
d136 1
a136 1
         move.l    ge_ID(a0),d0
d138 2
a139 2
         move.l    _ReqLastGui,a0
         bsr.s     _ChangeGui
d141 3
a143 3
         move.l    _ReqHook,d1
         beq.s     .Done
         move.l    d1,-(a7)
d145 1
a145 1
         rts
d148 1
a148 1
         GENTRY    _VGroup,0,0
d150 3
a152 3
         GENTRY    _HGroup,0,0
         GENTRY    _SmallButton,"X",_ReqButHook
         GENTRY    _SmallButton,"I",_Iconify
d155 2
a156 2
         GENTRY    _DragBar,0,0
         GEND
d159 1
a159 1
         GENTRY    _Text,0,0
d161 1
a161 1
         GENTRY    _HGroup,0,0
d164 3
a166 3
         rept      20
         GENTRY    0,0,_ReqButHook
         endr
d168 1
a168 1
         GEND
d173 1
a173 1
         dc.l      0
d175 3
a177 3
         move.l    Low_Base,a6
         moveq     #0,d0
         CALL      ReadJoyPort
d179 2
a180 2
         move.l    _MouseX(pc),d6
         move.l    _MouseY(pc),d7
d182 2
a183 2
         move.l    d0,d1
         and.l     #JP_MHORZ_MASK,d1
d185 4
a188 4
         lea       LastHMCount(pc),a0
         move.w    (a0),d2
         move.w    d1,(a0)
         sub.b     d2,d1
d190 2
a191 2
         extb.l    d1
         add.l     d1,d6
d193 2
a194 2
         and.l     #JP_MVERT_MASK,d0
         lsr.l     #8,d0
d196 4
a199 4
         lea       LastVMCount(pc),a0
         move.w    (a0),d2
         move.w    d0,(a0)
         sub.b     d2,d0
d201 3
a203 3
         extb.l    d0
         asr.l     #1,d0
         add.l     d0,d7
d205 1
a205 1
         movem.l   _MinMouseX(pc),d0-3
d207 3
a209 3
         cmp.l     d0,d6
         bge.s     .XPos
         move.l    d0,d6
d212 3
a214 3
         cmp.l     d2,d6
         ble.s     .XOk
         move.l    d2,d6
d216 1
a216 1
         move.l    d6,_MouseX
d218 3
a220 3
         cmp.l     d1,d7
         bge.s     .YPos
         move.l    d1,d7
d223 3
a225 3
         cmp.l     d3,d7
         ble.s     .YOk
         move.l    d3,d7
d227 1
a227 1
         move.l    d7,_MouseY
d229 12
a240 12
         subq.w    #HotPointX,d6
         lsl.w     #1,d6
         subq.w    #HotPointY,d7

         lea       MouseGDwarf(pc),a0
         movem.w   d6-7,gdw_X(a0)
         bsr       _RefreshGardenDwarf

         move.l    _MouseHook(pc),d0
         beq.s     .Done
         move.l    d0,a0
         jmp       (a0)
d243 1
a243 1
         rts
d245 1
a245 1
         dc.l      0
d247 1
a247 1
         dc.l      0
d249 1
a249 1
         dc.l      GuiScreenWidth
d251 1
a251 1
         dc.l      256
d253 1
a253 1
         dc.l      GuiScreenWidth
d255 1
a255 1
         dc.l      256
d257 1
a257 1
         ds.w      1
d259 1
a259 1
         ds.w      1
d261 2
a262 2
         dc.l      _MouseGardenDwarfDat,0
         dc.w      0,0,14
d265 3
d269 1
a269 1
         ds.l      1
d271 1
a271 1
         ds.l      1
d273 1
a273 1
         ds.l      1
d275 1
a275 1
         ds.l      1
d277 2
a278 2
         ds.b      1
         even
d281 21
a301 2
         move.l    _PreHandler(pc),d0
         beq.s     .Kzlonka
d303 2
a304 2
         move.l    d0,a0
         jsr       (a0)
d307 2
a308 2
         movem.l   _MouseX(pc),d0-1
         sub.l     _GuiPos,d1
d310 7
a316 7
         move.l    _ActiveThingHandler(pc),d2
         beq.s     .AhBon
         move.l    d2,a1
         move.l    _ActiveGuiEntry(pc),a0
         lea       ge_Domain(a0),a2
         move.l    a2,_CurrentDomain
         jmp       (a1)
d319 4
a322 4
         move.b    _OldMButtonState(pc),d2
         btst      #0,$dff016
         seq       _OldMButtonState
         bne.s     .PasClickuMilieu
d324 2
a325 2
         tst.b     d2
         bne.s     .PasClickuMilieu
d327 2
a328 2
         cmp.l     #CopEnd,_GuiLayerPtr
         beq       .ShowGui
d330 2
a331 2
         move.l    #CopEnd,_GuiLayerPtr
         bra.s     .PasClickuMilieu
d334 1
a334 1
         move.l    #CopLayer4,_GuiLayerPtr
d338 2
a339 2
         move.l    _PlayfieldClickHandler(pc),d2
         beq.s     .Décidement
d341 2
a342 2
         cmp.l     #CopEnd,_GuiLayerPtr
         beq       .GzlonK
d344 2
a345 2
         tst.l     d1
         bpl.s     .Décidement
d349 3
a351 3
         movem.l   _MouseX(pc),d0-1
         move.l    d2,a0
         jmp       (a0)
d354 2
a355 2
         cmp.l     #CopEnd,_GuiLayerPtr
         beq.s     .OhEtPuisMerdeTousVouf
d357 2
a358 2
         btst      #6,$bfe001
         bne.s     .OhEtPuisMerdeTousVouf
d360 3
a362 3
         move.l    _CurrentGui(pc),d2
         beq.s     .OhEtPuisMerdeTousVouf
         move.l    d2,a0
d364 2
a365 2
         cmp2.l    ge_Domain+gd_Left(a0),d0
         bcs.s     .OhEtPuisMerdeTousVouf
d367 2
a368 2
         cmp2.l    ge_Domain+gd_Top(a0),d1
         bcs.s     .OhEtPuisMerdeTousVouf
d370 1
a370 1
         bsr.s     _DoClick
d373 542
a914 1
         rts
d916 444
d1361 1589
d2952 1
a2952 1
         movem.l   d3-7/a1,-(a7)
d2954 1
a2954 1
         move.l    _CurrentDomain,-(a7)
d2956 2
a2957 2
         lea       ge_Domain(a0),a1
         move.l    a1,_CurrentDomain
d2959 3
a2961 3
         bsr       _ClearDomain
         bsr       _Layout
         bsr       _Render
d2963 1
a2963 1
         move.l    (a7)+,_CurrentDomain
d2965 2
a2966 2
         movem.l   (a7)+,d3-7/a1
         rts
d2970 1
a2970 1
         ds.l      1
d2972 14
a2985 2
         movem.l   d0-7/a0-6,-(a7)
         bsr.s     _ClearGui
d2987 3
a2989 2
         move.l    #_GuiTemp,_CtGuiTemp
         move.l    #CopEnd,_GuiL1Ptr
d2991 1
a2991 1
         move.l    a0,_CurrentGui
d2993 1
a2993 1
         bsr.s     _GetMinMax
d2995 2
a2996 2
         moveq     #0,d0
         move.l    #255,d1
d2998 4
a3001 4
         move.l    ge_MaxHeight(a0),d2
         beq.s     .NoMax
         move.l    d1,d0
         sub.l     ge_MaxHeight(a0),d0
d3003 1
a3003 1
         move.l    d0,_MinGuiPos
d3005 2
a3006 2
         sub.l     ge_MinHeight(a0),d1
         move.l    d1,_MaxGuiPos
d3008 1
a3008 1
         move.l    _GuiPos(pc),d2
d3010 3
a3012 3
         cmp.l     d0,d2
         bcc.s     .MinOk
         move.l    d0,d2
d3015 3
a3017 3
         cmp.l     d2,d1
         bcc.s     .MaxOk
         move.l    d1,d2
d3019 1
a3019 1
         move.l    d2,_GuiPos
d3021 14
a3034 5
         bsr.s     _MoveGui
         bsr.s     _Layout
         bsr.s     _Render
         movem.l   (a7)+,d0-7/a0-6
         rts
d3038 1
a3038 1
         dc.l      256
d3040 1
a3040 1
         dc.l      0
d3042 1
a3042 1
         dc.l      256
d3044 2
a3045 2
         move.l    _GuiPos(pc),d0
         move.l    d0,d1
d3047 2
a3048 2
         add.l     #$28,d0
         move.w    d0,GuiP
d3050 1
a3050 1
         move.l    _CurrentGui(pc),a0
d3052 2
a3053 2
         move.l    #2,ge_Domain+gd_Left(a0)
         move.l    #0,ge_Domain+gd_Top(a0)
d3055 2
a3056 2
         move.l    #GuiScreenWidth-2,ge_Domain+gd_Right(a0)
         move.l    #GuiScreenWidth-4,ge_Domain+gd_Width(a0)
d3058 5
a3062 5
         move.l    #255,d0
         sub.l     d1,d0
         move.l    d0,ge_Domain+gd_Height(a0)
         move.l    d0,ge_Domain+gd_Bottom(a0)
         rts
d3066 8
a3073 8
         move.l    a0,-(a7)
         move.l    _CurrentGui(pc),d0
         beq.s     .Done
         move.l    d0,a0

         lea       ge_Domain(a0),a0
         move.l    a0,_CurrentDomain
         bsr       _ClearDomain
d3076 2
a3077 2
         move.l    (a7)+,a0
         rts
d3081 6
a3086 6
         movem.l   d0-7/a0-6,-(a7)
         move.l    (a0),a1
         move.l    (a1),a1
         jsr       (a1)
         movem.l   (a7)+,d0-7/a0-6
         rts
d3090 10
a3099 10
         movem.l   d0-7/a0-6,-(a7)
         move.l    (a0),a1
         move.l    gc_Layout(a1),d0
         beq.s     .Done
         move.l    d0,a3

         lea       _CurrentDomain(pc),a1
         move.l    (a1),-(a7)
         lea       ge_Domain(a0),a2
         move.l    a2,(a1)
d3101 1
a3101 1
         jsr       (a3)
d3103 2
a3104 2
         lea       _CurrentDomain(pc),a1
         move.l    (a7)+,(a1)
d3107 2
a3108 2
         movem.l   (a7)+,d0-7/a0-6
         rts
d3112 10
a3121 10
         movem.l   d0-7/a0-6,-(a7)
         move.l    (a0),a1
         move.l    gc_Render(a1),d0
         beq.s     .Done
         move.l    d0,a3

         lea       _CurrentDomain(pc),a1
         move.l    (a1),-(a7)
         lea       ge_Domain(a0),a2
         move.l    a2,(a1)
d3123 1
a3123 1
         jsr       (a3)
d3125 2
a3126 2
         lea       _CurrentDomain(pc),a1
         move.l    (a7)+,(a1)
d3129 2
a3130 2
         movem.l   (a7)+,d0-7/a0-6
         rts
d3134 16
a3149 16
         movem.l   d0-1/d3-7/a0-6,-(a7)
         move.l    (a0),a1
         move.l    gc_Click(a1),d2
         ble.s     .Done
         move.l    d2,a3

         lea       _CurrentDomain(pc),a1
         move.l    (a1),-(a7)
         lea       ge_Domain(a0),a2
         move.l    a2,(a1)

         jsr       (a3)

         lea       _CurrentDomain(pc),a1
         move.l    (a7)+,(a1)
         moveq     #0,d2
d3152 2
a3153 2
         movem.l   (a7)+,d0-1/d3-7/a0-6
         rts
d3156 1
a3156 1
;fs "Classes"
d3159 4
a3162 4
         dc.l      HGGetMinMax
         dc.l      HGLayout
         dc.l      _GRender
         dc.l      _GClick
d3165 9
a3173 9
         move.l    a0,a1
         lea       ge_Size(a0),a0
         moveq     #0,d0
         moveq     #0,d1
         moveq     #0,d2
         moveq     #0,d3
         ;bset      #31,d3
         not.l     d3
         sf        d5
d3176 1
a3176 1
         bsr.s     _GetMinMax
d3178 10
a3187 10
         add.l     ge_MinWidth(a0),d0
         move.l    ge_MaxWidth(a0),d4
         seq       d6
         or.b      d6,d5
         add.l     d4,d2

         move.l    ge_MinHeight(a0),d4
         cmp.l     d4,d1
         bcc.s     .MiHOk
         move.l    d4,d1
d3190 5
a3194 5
         move.l    ge_MaxHeight(a0),d4
         beq.s     .MaHOk
         cmp.l     d3,d4
         bcc.s     .MaHOk
         move.l    d4,d3
d3197 3
a3199 3
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         beq.s     .Done
d3201 2
a3202 2
         addq.l    #GuiHorSpacing,d0
         addq.l    #GuiHorSpacing,d2
d3204 1
a3204 1
         bra.s     .Loop
d3207 3
a3209 3
         tst.b     d5
         beq.s     .WMaxOk
         moveq     #0,d2
d3212 3
a3214 3
         tst.l     d3
         bpl.s     .HMaxOk
         moveq     #0,d3
d3217 4
a3220 4
         lea       ge_Size(a0),a0
         move.l    a0,ge_Next(a1)
         movem.l   d0-3,ge_MinWidth(a1)
         rts
d3223 9
a3231 9
         move.l    a0,a6
         lea       ge_Size(a0),a0
         move.l    a0,a5
         moveq     #0,d7

         move.l    _CurrentDomain(pc),a1
         move.l    gd_Height(a1),d0
         move.l    gd_Top(a1),d1
         move.l    gd_Bottom(a1),d2
d3234 7
a3240 7
         tst.l     (a0)
         beq.s     .ILOk
         move.l    d1,ge_Domain+gd_Top(a0)
         move.l    d2,ge_Domain+gd_Bottom(a0)
         clr.l     ge_Domain+gd_Width(a0)
         move.l    d0,ge_Domain+gd_Height(a0)
         addq.l    #1,d7
d3242 2
a3243 2
         move.l    ge_Next(a0),a0
         bra.s     .InitLoop
d3246 1
a3246 1
         move.l    gd_Width(a1),d5
d3248 4
a3251 4
         move.l    d7,d0
         subq.l    #1,d0
         add.l     d0,d0
         sub.l     d0,d5
d3254 2
a3255 2
         tst.l     d7
         beq.s     .MoreOrLessBigLoop
d3257 3
a3259 3
         move.l    d5,d4
         divu      d7,d4
         ext.l     d4
d3262 1
a3262 1
         move.l    a5,a0
d3265 2
a3266 2
         tst.l     ge_Domain+gd_Width(a0)
         bne.s     .Fixed
d3268 9
a3276 9
         move.l    ge_MinWidth(a0),d0
         cmp.l     d0,d4
         bcc.s     .MinOk
         move.l    d0,ge_Domain+gd_Width(a0)
         sub.l     d0,d5
         subq.l    #1,d7
         moveq     #0,d1
         move.l    d1,ge_Domain+gd_Left(a0)
         bra.s     .BigLoop
d3279 2
a3280 2
         move.l    ge_MaxWidth(a0),d0
         beq.s     .Next
d3282 8
a3289 8
         cmp.l     d4,d0
         bcc.s     .Next
         move.l    d0,ge_Domain+gd_Width(a0)
         sub.l     d0,d5
         subq.l    #1,d7
         moveq     #1,d1
         move.l    d1,ge_Domain+gd_Left(a0)
         bra.s     .BigLoop
d3292 19
a3310 19
         move.l    ge_Domain+gd_Left(a0),d0
         eor.l     d1,d0
         beq.s     .Next

         move.l    ge_Domain+gd_Width(a0),d0
         add.l     d5,d0
         move.l    d7,d2
         addq.l    #1,d2
         divu      d2,d0
         ext.l     d0

         move.l    ge_MinWidth(a0),d2
         cmp.l     d2,d0
         bcs.s     .Next

         move.l    ge_MaxWidth(a0),d2
         beq.s     .AhhRâaah
         cmp.l     d0,d2
         bcs.s     .Next
d3313 5
a3317 5
         add.l     ge_Domain+gd_Width(a0),d5
         clr.l     ge_Domain+gd_Width(a0)
         addq.l    #1,d7
         move.l    d0,d4
         bra.s     .MoreOrLessBigLoop
d3320 3
a3322 3
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         bne.s     .Loop
d3326 2
a3327 2
         move.l    a5,a0
         move.l    gd_Left(a1),d0
d3330 1
a3330 1
         move.l    d0,ge_Domain+gd_Left(a0)
d3332 4
a3335 4
         move.l    ge_Domain+gd_Width(a0),d1
         bne.s     .PLWOk
         move.l    d4,d1
         move.l    d4,ge_Domain+gd_Width(a0)
d3338 3
a3340 3
         add.l     d1,d0
         move.l    d0,ge_Domain+gd_Right(a0)
         addq.l    #GuiHorSpacing,d0
d3342 1
a3342 1
         bsr       _Layout
d3344 3
a3346 3
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         bne.s     .PosLoop
d3348 1
a3348 1
         rts
d3352 4
a3355 4
         dc.l      VGGetMinMax
         dc.l      VGLayout
         dc.l      _GRender
         dc.l      _GClick
d3358 9
a3366 9
         move.l    a0,a1
         lea       ge_Size(a0),a0
         moveq     #0,d0
         moveq     #0,d1
         moveq     #0,d2
         ;bset      #31,d2
         not.l     d2
         moveq     #0,d3
         sf        d5
d3369 1
a3369 1
         bsr.s     _GetMinMax
d3371 10
a3380 10
         add.l     ge_MinHeight(a0),d1
         move.l    ge_MaxHeight(a0),d4
         seq       d6
         or.b      d6,d5
         add.l     d4,d3

         move.l    ge_MinWidth(a0),d4
         cmp.l     d4,d0
         bcc.s     .MiWOk
         move.l    d4,d0
d3383 5
a3387 5
         move.l    ge_MaxWidth(a0),d4
         beq.s     .MaWOk
         cmp.l     d2,d4
         bcc.s     .MaWOk
         move.l    d4,d2
d3390 3
a3392 3
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         beq.s     .Done
d3394 2
a3395 2
         addq.l    #GuiVerSpacing,d1
         addq.l    #GuiVerSpacing,d3
d3397 1
a3397 1
         bra.s     .Loop
d3400 3
a3402 3
         tst.b     d5
         beq.s     .HMaxOk
         moveq     #0,d3
d3405 3
a3407 3
         tst.l     d2
         bpl.s     .WMaxOk
         moveq     #0,d2
d3410 4
a3413 4
         lea       ge_Size(a0),a0
         move.l    a0,ge_Next(a1)
         movem.l   d0-3,ge_MinWidth(a1)
         rts
d3416 9
a3424 9
         move.l    a0,a6
         lea       ge_Size(a0),a0
         move.l    a0,a5
         moveq     #0,d7

         move.l    _CurrentDomain(pc),a1
         move.l    gd_Width(a1),d0
         move.l    gd_Left(a1),d1
         move.l    gd_Right(a1),d2
d3427 7
a3433 7
         tst.l     (a0)
         beq.s     .ILOk
         move.l    d1,ge_Domain+gd_Left(a0)
         move.l    d2,ge_Domain+gd_Right(a0)
         move.l    d0,ge_Domain+gd_Width(a0)
         clr.l     ge_Domain+gd_Height(a0)
         addq.l    #1,d7
d3435 2
a3436 2
         move.l    ge_Next(a0),a0
         bra.s     .InitLoop
d3439 1
a3439 1
         move.l    gd_Height(a1),d5
d3441 3
a3443 3
         move.l    d7,d0
         subq.l    #1,d0
         sub.l     d0,d5
d3446 2
a3447 2
         tst.l     d7
         beq.s     .MoreOrLessBigLoop
d3449 3
a3451 3
         move.l    d5,d4
         divu      d7,d4
         ext.l     d4
d3454 1
a3454 1
         move.l    a5,a0
d3457 2
a3458 2
         tst.l     ge_Domain+gd_Height(a0)
         bne.s     .Fixed
d3460 9
a3468 9
         move.l    ge_MinHeight(a0),d0
         cmp.l     d0,d4
         bcc.s     .MinOk
         move.l    d0,ge_Domain+gd_Height(a0)
         sub.l     d0,d5
         subq.l    #1,d7
         moveq     #0,d1
         move.l    d1,ge_Domain+gd_Top(a0)
         bra.s     .BigLoop
d3471 2
a3472 2
         move.l    ge_MaxHeight(a0),d0
         beq.s     .Next
d3474 8
a3481 8
         cmp.l     d4,d0
         bcc.s     .Next
         move.l    d0,ge_Domain+gd_Height(a0)
         sub.l     d0,d5
         subq.l    #1,d7
         moveq     #1,d1
         move.l    d1,ge_Domain+gd_Top(a0)
         bra.s     .BigLoop
d3484 19
a3502 19
         move.l    ge_Domain+gd_Top(a0),d0
         eor.l     d1,d0
         beq.s     .Next

         move.l    ge_Domain+gd_Height(a0),d0
         add.l     d5,d0
         move.l    d7,d2
         addq.l    #1,d2
         divu      d2,d0
         ext.l     d0

         move.l    ge_MinHeight(a0),d2
         cmp.l     d2,d0
         bcs.s     .Next

         move.l    ge_MaxHeight(a0),d2
         beq.s     .AhhRâaah
         cmp.l     d0,d2
         bcs.s     .Next
d3505 5
a3509 5
         add.l     ge_Domain+gd_Height(a0),d5
         clr.l     ge_Domain+gd_Height(a0)
         addq.l    #1,d7
         move.l    d0,d4
         bra.s     .MoreOrLessBigLoop
d3512 3
a3514 3
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         bne.s     .Loop
d3518 2
a3519 2
         move.l    a5,a0
         move.l    gd_Top(a1),d0
d3522 1
a3522 1
         move.l    d0,ge_Domain+gd_Top(a0)
d3524 4
a3527 4
         move.l    ge_Domain+gd_Height(a0),d1
         bne.s     .PLHOk
         move.l    d4,d1
         move.l    d4,ge_Domain+gd_Height(a0)
d3530 3
a3532 3
         add.l     d1,d0
         move.l    d0,ge_Domain+gd_Bottom(a0)
         addq.l    #GuiVerSpacing,d0
d3534 1
a3534 1
         bsr       _Layout
d3536 3
a3538 3
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         bne.s     .PosLoop
d3540 1
a3540 1
         rts
d3544 1
a3544 1
         lea       ge_Size(a0),a0
d3547 1
a3547 1
         bsr       _Render
d3549 3
a3551 3
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         bne.s     .Loop
d3553 1
a3553 1
         rts
d3557 1
a3557 1
         lea       ge_Size(a0),a0
d3560 2
a3561 2
         cmp2.l    ge_Domain+gd_Left(a0),d0
         bcs.s     .NoClick
d3563 2
a3564 2
         cmp2.l    ge_Domain+gd_Top(a0),d1
         bcc.s     .Bingo
d3567 4
a3570 4
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         bne.s     .Loop
         rts
d3573 4
a3576 4
         bsr.s     _DoClick
         tst.l     d2
         bmi.s     .NoClick
         rts
d3580 4
a3583 4
         dc.l      BGetMinMax
         dc.l      0
         dc.l      BRender
         dc.l      BClick
d3586 2
a3587 2
         move.l    ge_Data(a0),a1
         move.l    a1,a2
d3589 19
a3607 19
         tst.b     (a1)+
         bne.s     .StrLen
         sub.l     a2,a1
         move.l    a1,d0

         clr.l     ge_MaxWidth(a0)
         lsl.l     #3,d0
         move.l    d0,ge_MinWidth(a0)

         subq.l    #8,d0
         move.l    d0,ge_Temp(a0)

         moveq     #12,d0
         move.l    d0,ge_MinHeight(a0)
         move.l    d0,ge_MaxHeight(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d3610 17
a3626 17
         move.l    _CurrentDomain(pc),a1
         moveq     #0,d0
         moveq     #0,d1
         move.l    gd_Width(a1),d2
         move.l    gd_Height(a1),d3
         sf        d4
         bsr       _DrawBevelBox

         sub.l     ge_Temp(a0),d2
         lsr.l     #1,d2
         move.l    d2,d6
         moveq     #2,d7
         move.l    ge_Data(a0),a5
         moveq     #1,d4
         moveq     #0,d5
         bsr       _DrawText
         rts
d3629 3
a3631 3
         move.l    a0,_ActiveGuiEntry
         lea       BHandler(pc),a1
         move.l    a1,_ActiveThingHandler
d3633 1
a3633 1
         sf        BPressed
d3636 2
a3637 2
         btst      #6,$bfe001
         bne.s     .Desactivate
d3639 1
a3639 1
         move.b    BPressed(pc),d2
d3641 2
a3642 2
         cmp2.l    ge_Domain+gd_Left(a0),d0
         scc       d0
d3644 2
a3645 2
         cmp2.l    ge_Domain+gd_Top(a0),d1
         scc       d1
d3647 2
a3648 2
         and.b     d1,d0
         move.b    d0,BPressed
d3650 2
a3651 2
         eor.b     d0,d2
         beq.s     .Done
d3653 2
a3654 2
         tst.b     d0
         bne.s     .Press
d3657 8
a3664 8
         move.l    _CurrentDomain(pc),a1
         moveq     #0,d3
         moveq     #2,d4
         moveq     #1,d5
         movem.l   gd_Width(a1),d6-7
         subq.l    #4,d6
         subq.l    #2,d7
         bsr       _DrawRectangle
d3666 1
a3666 1
         bra       BRender
d3669 26
a3694 26
         move.l    _CurrentDomain(pc),a1
         moveq     #3,d3
         moveq     #2,d4
         moveq     #1,d5
         movem.l   gd_Width(a1),d6-7
         subq.l    #4,d6
         subq.l    #2,d7
         bsr       _DrawRectangle

         move.l    _CurrentDomain(pc),a1
         moveq     #0,d0
         moveq     #0,d1
         move.l    gd_Width(a1),d2
         move.l    gd_Height(a1),d3
         st        d4
         bsr       _DrawBevelBox

         sub.l     ge_Temp(a0),d2
         lsr.l     #1,d2
         move.l    d2,d6
         moveq     #2,d7
         move.l    ge_Data(a0),a5
         moveq     #1,d4
         moveq     #0,d5
         bsr       _DrawText
         rts
d3697 1
a3697 1
         clr.l     _ActiveThingHandler
d3699 2
a3700 2
         tst.b     BPressed
         beq.s     .Done
d3702 5
a3706 5
         bsr.s     .Release
         move.l    ge_Hook(a0),d0
         beq.s     .Done
         move.l    d0,a1
         jmp       (a1)
d3709 1
a3709 1
         rts
d3712 2
a3713 2
         ds.b      1
         even
d3717 4
a3720 4
         dc.l      SBGetMinMax
         dc.l      SBLayout
         dc.l      SBRender
         dc.l      SBClick
d3723 2
a3724 2
         moveq     #16,d0
         move.l    d0,ge_MinWidth(a0)
d3726 3
a3728 3
         tst.l     ge_Data3(a0)
         beq.s     .Ok
         moveq     #0,d0
d3731 1
a3731 1
         move.l    d0,ge_MaxWidth(a0)
d3733 7
a3739 7
         moveq     #12,d0
         move.l    d0,ge_MinHeight(a0)
         move.l    d0,ge_MaxHeight(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d3742 5
a3746 5
         move.l    ge_Domain+gd_Width(a0),d0
         subq.l    #8,d0
         lsr.l     #1,d0
         move.l    d0,ge_Temp(a0)
         rts
d3749 14
a3762 14
         move.l    _CurrentDomain(pc),a1
         moveq     #0,d0
         moveq     #0,d1
         move.l    gd_Width(a1),d2
         move.l    gd_Height(a1),d3
         sf        d4
         bsr       _DrawBevelBox

         move.l    ge_Temp(a0),d6
         moveq     #2,d7
         move.l    ge_Data(a0),d5
         moveq     #1,d4
         bsr       _DrawChar
         rts
d3765 3
a3767 3
         move.l    a0,_ActiveGuiEntry
         lea       SBHandler(pc),a1
         move.l    a1,_ActiveThingHandler
d3769 1
a3769 1
         sf        SBPressed
d3772 2
a3773 2
         btst      #6,$bfe001
         bne.s     .Desactivate
d3775 8
a3782 8
         move.b    SBPressed(pc),d2
         beq.s     .Glonk
         move.l    ge_Data2(a0),d3
         beq.s     .Glonk
         move.l    d3,a1
         movem.l   d0-2/a0,-(a7)
         jsr       (a1)
         movem.l   (a7)+,d0-2/a0
d3785 2
a3786 2
         cmp2.l    ge_Domain+gd_Left(a0),d0
         scc       d0
d3788 2
a3789 2
         cmp2.l    ge_Domain+gd_Top(a0),d1
         scc       d1
d3791 2
a3792 2
         and.b     d1,d0
         move.b    d0,SBPressed
d3794 2
a3795 2
         eor.b     d0,d2
         beq.s     .Done
d3797 2
a3798 2
         tst.b     d0
         bne.s     .Press
d3801 8
a3808 8
         move.l    _CurrentDomain(pc),a1
         moveq     #0,d3
         moveq     #2,d4
         moveq     #1,d5
         movem.l   gd_Width(a1),d6-7
         subq.l    #4,d6
         subq.l    #2,d7
         bsr       _DrawRectangle
d3810 1
a3810 1
         bra       SBRender
d3813 23
a3835 23
         move.l    _CurrentDomain(pc),a1
         moveq     #3,d3
         moveq     #2,d4
         moveq     #1,d5
         movem.l   gd_Width(a1),d6-7
         subq.l    #4,d6
         subq.l    #2,d7
         bsr       _DrawRectangle

         move.l    _CurrentDomain(pc),a1
         moveq     #0,d0
         moveq     #0,d1
         move.l    gd_Width(a1),d2
         move.l    gd_Height(a1),d3
         st        d4
         bsr       _DrawBevelBox

         move.l    ge_Temp(a0),d6
         moveq     #2,d7
         move.l    ge_Data(a0),d5
         moveq     #1,d4
         bsr       _DrawChar
         rts
d3838 1
a3838 1
         clr.l     _ActiveThingHandler
d3840 2
a3841 2
         tst.b     SBPressed
         beq.s     .Done
d3843 5
a3847 5
         bsr.s     .Release
         move.l    ge_Hook(a0),d0
         beq.s     .Done
         move.l    d0,a1
         jmp       (a1)
d3850 1
a3850 1
         rts
d3853 2
a3854 2
         ds.b      1
         even
d3858 4
a3861 4
         dc.l      BGetMinMax
         dc.l      0
         dc.l      BRender
         dc.l      DBClick
d3864 2
a3865 2
         move.l    d0,_MinMouseX
         move.l    d0,_MaxMouseX
d3867 12
a3878 12
         move.l    a0,_ActiveGuiEntry
         lea       DBHandler(pc),a1
         move.l    a1,_ActiveThingHandler

         move.l    d1,DBOffset
         move.w    GuiSelP,d0
         sub.w     GuiP,d0
         move.w    d0,DBSelOffset

         move.l    d1,d0
         add.l     _MinGuiPos(pc),d0
         move.l    d0,_MinMouseY
d3880 2
a3881 2
         add.l     _MaxGuiPos(pc),d1
         move.l    d1,_MaxMouseY
d3883 2
a3884 2
         lea       DBMouseHook(pc),a0
         move.l    a0,_MouseHook
d3886 2
a3887 2
         ;move.l    #CopEnd,_GuiL1Ptr
         rts
d3890 2
a3891 2
         btst      #6,$bfe001
         beq.s     .Ok
d3893 2
a3894 2
         clr.l     _MouseHook
         clr.l     _ActiveThingHandler
d3896 2
a3897 2
         clr.l     _MinMouseX
         clr.l     _MinMouseY
d3899 8
a3906 8
         move.l    #GuiScreenWidth,_MaxMouseX
         move.l    #256,_MaxMouseY

         bsr       _ClearGui
         bsr       _MoveGui
         move.l    _CurrentGui(pc),a0
         bsr       _Layout
         bsr       _Render
d3909 1
a3909 1
         rts
d3912 10
a3921 10
         move.l    _MouseY(pc),d0
         sub.l     DBOffset(pc),d0
         move.l    d0,_GuiPos

         add.l     #$28,d0
         move.w    d0,GuiP

         add.w     DBSelOffset,d0
         move.w    d0,GuiSelP
         rts
d3924 1
a3924 1
         ds.l      1
d3926 1
a3926 1
         ds.w      1
d3930 4
a3933 4
         dc.l      TGetMinMax
         dc.l      0
         dc.l      TRender
         dc.l      0
d3936 14
a3949 14
         move.l    ge_Data(a0),a1
         move.l    ge_Data2(a0),d0
         beq.s     .TrucEtTout

         move.l    a0,-(a7)
         move.l    (AbsExecBase).w,a6
         move.l    a1,a0
         move.l    d0,a1
         lea       TPutChar(pc),a2
         lea       _StrBuf,a3
         CALL      RawDoFmt
         move.l    (a7)+,a0
         lea       _StrBuf,a1
         lea       CustomBase,a6
d3951 1
a3951 1
         moveq     #0,d0
d3954 1
a3954 1
         moveq     #0,d1
d3957 2
a3958 2
         addq.l    #1,d0
         move.l    a1,a2
d3961 4
a3964 4
         move.b    (a2)+,d2
         beq.s     .CLDone
         cmp.b     #$a,d2
         bne.s     .CLoop
d3967 2
a3968 2
         move.l    a2,d3
         sub.l     a1,d3
d3970 3
a3972 3
         cmp.l     d3,d1
         bcc.s     .Baâââh
         move.l    d3,d1
d3975 17
a3991 17
         move.l    a2,a1
         tst.b     d2
         bne.s     .LLoop

         lsl.l     #3,d0
         move.l    d0,ge_MinHeight(a0)
         move.l    d0,ge_MaxHeight(a0)

         subq.l    #1,d1
         lsl.l     #3,d1

         clr.l     ge_MaxWidth(a0)
         move.l    d1,ge_MinWidth(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d3994 17
a4010 17
         move.l    _CurrentDomain(pc),a1
         move.l    gd_Width(a1),d1
         move.l    ge_Data(a0),a5
         moveq     #0,d7
         move.l    ge_Data2(a0),d0
         beq.s     .LLoop

         movem.l   d1/a1,-(a7)
         move.l    (AbsExecBase).w,a6
         move.l    a5,a0
         move.l    d0,a1
         lea       TPutChar(pc),a2
         lea       _StrBuf,a3
         CALL      RawDoFmt
         lea       _StrBuf,a5
         lea       CustomBase,a6
         movem.l   (a7)+,d1/a1
d4013 1
a4013 1
         move.l    a5,a1
d4016 4
a4019 4
         move.b    (a1)+,d2
         beq.s     .CLDone
         cmp.b     #$a,d2
         bne.s     .CLoop
d4021 10
a4030 10
         move.l    a1,d5
         sub.l     a5,d5
         subq.l    #1,d5
         beq.s     .Poisse

         move.l    d5,d0
         lsl.l     #3,d0
         move.l    d1,d6
         sub.l     d0,d6
         lsr.l     #1,d6
d4032 2
a4033 2
         moveq     #1,d4
         bsr       _DrawText
d4036 2
a4037 2
         move.l    a1,a5
         addq.l    #8,d7
d4039 2
a4040 2
         tst.b     d2
         bne.s     .LLoop
d4042 1
a4042 1
         rts
d4045 2
a4046 2
         move.b    d0,(a3)+
         rts
d4050 4
a4053 4
         dc.l      FTGetMinMax
         dc.l      0
         dc.l      TRender
         dc.l      0
d4056 3
a4058 3
         bsr.s     TGetMinMax
         move.l    ge_MinWidth(a0),ge_MaxWidth(a0)
         rts
d4062 4
a4065 4
         dc.l      HPGetMinMax
         dc.l      HPLayout
         dc.l      HPRender
         dc.l      HPClick
d4068 12
a4079 12
         moveq     #50,d0
         move.l    d0,ge_MinWidth(a0)
         moveq     #0,d0
         move.l    d0,ge_MaxWidth(a0)

         moveq     #12,d0
         move.l    d0,ge_MinHeight(a0)
         move.l    d0,ge_MaxHeight(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d4082 16
a4097 16
         move.l    ge_Domain+gd_Width(a0),d0
         sub.l     #8,d0
         move.l    d0,d1
         move.l    ge_Data2(a0),d2

         move.l    ge_Data3(a0),d3
         cmp.l     d2,d3
         bcc.s     .FullKnob

         mulu      d3,d1
         divu      d2,d1
         ext.l     d1

         cmp.l     #14,d1
         bcc.s     .FullKnob
         moveq     #14,d1
d4100 1
a4100 1
         move.l    d1,ge_Temp3(a0)
d4102 2
a4103 2
         sub.l     d1,d0
         move.l    d0,ge_Temp(a0)
d4106 4
a4109 4
         movem.l   ge_Data2(a0),d1-2
         move.l    ge_Data(a0),d0
         bpl.s     .MinOk
         moveq     #0,d0
d4112 4
a4115 4
         move.l    d1,d3
         sub.l     d2,d3
         bpl.s     .Ok
         moveq     #0,d3
d4118 3
a4120 3
         cmp.l     d0,d3
         bcc.s     .MaxOk
         move.l    d3,d0
d4123 1
a4123 1
         move.l    d0,ge_Data(a0)
d4125 11
a4135 11
         mulu      ge_Temp+2(a0),d0
         sub.l     d2,d1
         beq.s     .FullKnob

         divu      d1,d0
         ext.l     d0

         move.l    ge_Temp(a0),d1
         cmp.l     d0,d1
         bcc.s     .MaxPosOk
         move.l    d1,d0
d4138 3
a4140 3
         addq.l    #4,d0
         move.l    d0,ge_Temp2(a0)
         rts
d4143 3
a4145 3
         moveq     #2,d0
         move.l    d0,ge_Temp2(a0)
         rts
d4148 13
a4160 13
         moveq     #0,d0
         moveq     #0,d1
         movem.l   ge_Domain+gd_Width(a0),d2-3
         sf        d4
         bsr.s     _DrawBevelBox

         moveq     #2,d0
         moveq     #1,d1
         movem.l   ge_Domain+gd_Width(a0),d2-3
         subq.l    #4,d2
         subq.l    #2,d3
         st        d4
         bsr.s     _DrawBevelBox
d4163 12
a4174 12
         moveq     #2,d1
         moveq     #8,d3
         movem.l   ge_Temp2(a0),d0/d2
         sf        d4
         bsr.s     _DrawBevelBox

         moveq     #4,d1
         move.l    ge_Temp3(a0),d0
         subq.l    #6,d0
         lsr.l     #1,d0
         add.l     ge_Temp2(a0),d0
         bra.s     _DrawPropHole
d4177 20
a4196 20
         moveq     #2,d1
         moveq     #8,d3
         movem.l   ge_Temp2(a0),d0/d2
         sf        d4
         bsr.s     _DrawBevelBox

         moveq     #3,d5
         moveq     #6,d7
         movem.l   ge_Temp2(a0),d4/d6
         addq.l    #2,d4
         subq.l    #4,d6
         moveq     #3,d3
         bsr.s     _DrawRectangle

         moveq     #4,d1
         move.l    ge_Temp3(a0),d0
         subq.l    #6,d0
         lsr.l     #1,d0
         add.l     ge_Temp2(a0),d0
         bra.s     _DrawPropHole
d4199 5
a4203 5
         moveq     #2,d5
         moveq     #8,d7
         movem.l   ge_Temp2(a0),d4/d6
         moveq     #0,d3
         bra.s     _DrawRectangle
d4206 2
a4207 2
         move.l    d0,d3
         sub.l     ge_Domain+gd_Left(a0),d0
d4209 26
a4234 26
         move.l    ge_Temp2(a0),d2
         cmp.l     d2,d0
         bcs.s     .BeforeKnob
         add.l     ge_Temp3(a0),d2
         cmp.l     d2,d0
         bcc.s     .AfterKnob

         sub.l     ge_Temp2(a0),d3
         move.l    d3,HPOffset

         add.l     _GuiPos(pc),d1
         move.l    d1,_MinMouseY
         move.l    d1,_MaxMouseY

         addq.l    #4,d3
         move.l    d3,d1

         move.l    d3,_MinMouseX

         add.l     ge_Temp(a0),d1
         move.l    d1,_MaxMouseX

         move.l    a0,_ActiveGuiEntry
         lea       HPHandler(pc),a1
         move.l    a1,_ActiveThingHandler
         bra       HPRenderKnobSelected
d4237 4
a4240 4
         move.l    ge_Data3(a0),d1
         subq.l    #1,d1
         bne.s     .BKOkIncr
         moveq     #1,d1
d4243 2
a4244 2
         move.l    ge_Data(a0),d0
         sub.l     d1,d0
d4247 1
a4247 1
         move.l    d0,ge_Data(a0)
d4249 1
a4249 1
         bsr       HPClearKnob
d4251 1
a4251 1
         bsr       HPCalcKnobPos
d4253 2
a4254 2
         lea       HPWaitHandler(pc),a1
         move.l    a1,_ActiveThingHandler
d4256 4
a4259 4
         move.l    ge_Hook(a0),d0
         beq       HPRenderKnob
         move.l    d0,a1
         move.l    ge_Data(a0),d0
d4261 3
a4263 3
         move.l    a0,-(a7)
         jsr       (a1)
         move.l    (a7)+,a0
d4265 1
a4265 1
         bra       HPRenderKnob
d4268 4
a4271 4
         move.l    ge_Data3(a0),d1
         subq.l    #1,d1
         bne.s     .AKOkIncr
         moveq     #1,d1
d4274 2
a4275 2
         move.l    ge_Data(a0),d0
         add.l     d1,d0
d4277 1
a4277 1
         bra.s     .KnobOk
d4280 3
a4282 3
         btst      #6,$bfe001
         beq.s     .Done
         clr.l     _ActiveThingHandler
d4284 1
a4284 1
         rts
d4287 2
a4288 7
         btst      #6,$bfe001
         bne.s     .Release

         sub.l     HPOffset(pc),d0

         cmp.l     ge_Temp2(a0),d0
         beq.s     .Done
d4290 1
a4290 3
         bsr.s     HPClearKnob
         move.l    d0,ge_Temp2(a0)
         bsr.s     HPRenderKnobSelected
d4292 2
a4293 8
         move.l    ge_Temp2(a0),d0
         subq.l    #4,d0
         move.l    ge_Data2(a0),d1
         sub.l     ge_Data3(a0),d1
         mulu      d1,d0
         move.l    ge_Temp(a0),d1
         divu      d1,d0
         ext.l     d0
d4295 19
a4313 6
         move.l    d0,ge_Data(a0)

         move.l    ge_Hook(a0),d1
         beq.s     .Done
         move.l    d1,a1
         jmp       (a1)
d4316 1
a4316 1
         rts
d4318 2
a4319 2
         clr.l     _MinMouseX
         clr.l     _MinMouseY
d4321 2
a4322 2
         move.l    #GuiScreenWidth,_MaxMouseX
         move.l    #256,_MaxMouseY
d4324 4
a4327 4
         clr.l     _ActiveThingHandler
         clr.l     _ActiveGuiEntry
         bsr.s     HPClearKnob
         bra.s     HPRenderKnob
d4330 1
a4330 1
         ds.l      1
d4334 4
a4337 4
         dc.l      VPGetMinMax
         dc.l      VPLayout
         dc.l      VPRender
         dc.l      VPClick
d4340 12
a4351 12
         moveq     #19,d0
         move.l    d0,ge_MinHeight(a0)
         moveq     #0,d0
         move.l    d0,ge_MaxHeight(a0)

         moveq     #20,d0
         move.l    d0,ge_MinWidth(a0)
         move.l    d0,ge_MaxWidth(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d4354 16
a4369 16
         move.l    ge_Domain+gd_Height(a0),d0
         sub.l     #4,d0
         move.l    d0,d1
         move.l    ge_Data2(a0),d2

         move.l    ge_Data3(a0),d3
         cmp.l     d2,d3
         bcc.s     .FullKnob

         mulu      d3,d1
         divu      d2,d1
         ext.l     d1

         cmp.l     #8,d1
         bcc.s     .FullKnob
         moveq     #8,d1
d4372 1
a4372 1
         move.l    d1,ge_Temp3(a0)
d4374 2
a4375 2
         sub.l     d1,d0
         move.l    d0,ge_Temp(a0)
d4378 4
a4381 4
         movem.l   ge_Data2(a0),d1-2
         move.l    ge_Data(a0),d0
         bpl.s     .MinOk
         moveq     #0,d0
d4384 4
a4387 4
         move.l    d1,d3
         sub.l     d2,d3
         bpl.s     .Ok
         moveq     #0,d3
d4390 3
a4392 3
         cmp.l     d0,d3
         bcc.s     .MaxOk
         move.l    d3,d0
d4395 1
a4395 1
         move.l    d0,ge_Data(a0)
d4397 11
a4407 11
         mulu      ge_Temp+2(a0),d0
         sub.l     d2,d1
         beq.s     .FullKnob

         divu      d1,d0
         ext.l     d0

         move.l    ge_Temp(a0),d1
         cmp.l     d0,d1
         bcc.s     .MaxPosOk
         move.l    d1,d0
d4410 3
a4412 3
         addq.l    #2,d0
         move.l    d0,ge_Temp2(a0)
         rts
d4415 3
a4417 3
         moveq     #2,d0
         move.l    d0,ge_Temp2(a0)
         rts
d4420 13
a4432 13
         moveq     #0,d0
         moveq     #0,d1
         movem.l   ge_Domain+gd_Width(a0),d2-3
         sf        d4
         bsr.s     _DrawBevelBox

         moveq     #2,d0
         moveq     #1,d1
         movem.l   ge_Domain+gd_Width(a0),d2-3
         subq.l    #4,d2
         subq.l    #2,d3
         st        d4
         bsr.s     _DrawBevelBox
d4435 12
a4446 12
         moveq     #4,d0
         move.l    #12,d2
         movem.l   ge_Temp2(a0),d1/d3
         sf        d4
         bsr.s     _DrawBevelBox

         moveq     #7,d0
         move.l    ge_Temp3(a0),d1
         subq.l    #4,d1
         lsr.l     #1,d1
         add.l     ge_Temp2(a0),d1
         bra.s     _DrawPropHole
d4449 20
a4468 20
         moveq     #4,d0
         moveq     #12,d2
         movem.l   ge_Temp2(a0),d1/d3
         sf        d4
         bsr.s     _DrawBevelBox

         moveq     #6,d4
         moveq     #8,d6
         movem.l   ge_Temp2(a0),d5/d7
         addq.l    #1,d5
         subq.l    #2,d7
         moveq     #3,d3
         bsr.s     _DrawRectangle

         moveq     #7,d0
         move.l    ge_Temp3(a0),d1
         subq.l    #4,d1
         lsr.l     #1,d1
         add.l     ge_Temp2(a0),d1
         bra.s     _DrawPropHole
d4471 5
a4475 5
         moveq     #4,d4
         moveq     #12,d6
         movem.l   ge_Temp2(a0),d5/d7
         moveq     #0,d3
         bra.s     _DrawRectangle
d4478 2
a4479 2
         move.l    d1,d3
         sub.l     ge_Domain+gd_Top(a0),d1
d4481 25
a4505 25
         move.l    ge_Temp2(a0),d2
         cmp.l     d2,d1
         bcs.s     .BeforeKnob
         add.l     ge_Temp3(a0),d2
         cmp.l     d2,d1
         bcc.s     .AfterKnob

         sub.l     ge_Temp2(a0),d3
         move.l    d3,VPOffset

         move.l    d0,_MinMouseX
         move.l    d0,_MaxMouseX

         add.l     _GuiPos(pc),d3
         addq.l    #2,d3
         move.l    d3,d1
         move.l    d3,_MinMouseY

         add.l     ge_Temp(a0),d1
         move.l    d1,_MaxMouseY

         move.l    a0,_ActiveGuiEntry
         lea       VPHandler(pc),a1
         move.l    a1,_ActiveThingHandler
         bra       VPRenderKnobSelected
d4508 4
a4511 4
         move.l    ge_Data3(a0),d1
         subq.l    #1,d1
         bne.s     .BKOkIncr
         moveq     #1,d1
d4514 2
a4515 2
         move.l    ge_Data(a0),d0
         sub.l     d1,d0
d4518 1
a4518 1
         move.l    d0,ge_Data(a0)
d4520 1
a4520 1
         bsr       VPClearKnob
d4522 1
a4522 1
         bsr       VPCalcKnobPos
d4524 2
a4525 2
         lea       VPWaitHandler(pc),a1
         move.l    a1,_ActiveThingHandler
d4527 4
a4530 4
         move.l    ge_Hook(a0),d0
         beq       VPRenderKnob
         move.l    d0,a1
         move.l    ge_Data(a0),d0
d4532 3
a4534 3
         move.l    a0,-(a7)
         jsr       (a1)
         move.l    (a7)+,a0
d4536 1
a4536 1
         bra       VPRenderKnob
d4539 4
a4542 4
         move.l    ge_Data3(a0),d1
         subq.l    #1,d1
         bne.s     .AKOkIncr
         moveq     #1,d1
d4545 2
a4546 2
         move.l    ge_Data(a0),d0
         add.l     d1,d0
d4548 1
a4548 1
         bra.s     .KnobOk
d4551 3
a4553 3
         btst      #6,$bfe001
         beq.s     .Done
         clr.l     _ActiveThingHandler
d4555 1
a4555 1
         rts
d4558 2
a4559 2
         btst      #6,$bfe001
         bne.s     .Release
d4561 1
a4561 1
         sub.l     VPOffset(pc),d1
d4563 2
a4564 2
         cmp.l     ge_Temp2(a0),d1
         beq.s     .Done
d4566 19
a4584 19
         bsr.s     VPClearKnob
         move.l    d1,ge_Temp2(a0)
         bsr.s     VPRenderKnobSelected

         move.l    ge_Temp2(a0),d1
         subq.l    #2,d1
         move.l    ge_Data2(a0),d0
         sub.l     ge_Data3(a0),d0
         mulu      d0,d1
         move.l    ge_Temp(a0),d0
         divu      d0,d1
         ext.l     d1
         move.l    d1,ge_Data(a0)

         move.l    d1,d0
         move.l    ge_Hook(a0),d1
         beq.s     .Done
         move.l    d1,a1
         jmp       (a1)
d4587 1
a4587 1
         rts
d4589 2
a4590 2
         clr.l     _MinMouseX
         clr.l     _MinMouseY
d4592 2
a4593 2
         move.l    #GuiScreenWidth,_MaxMouseX
         move.l    #256,_MaxMouseY
d4595 4
a4598 4
         clr.l     _ActiveThingHandler
         clr.l     _ActiveGuiEntry
         bsr.s     VPClearKnob
         bra.s     VPRenderKnob
d4601 1
a4601 1
         ds.l      1
d4605 1
a4605 1
         movem.l   d0-3/a0,-(a7)
d4607 14
a4620 14
         move.l    _CurrentDomain(pc),a0
         add.l     gd_Left(a0),d0
         add.l     gd_Top(a0),d1

         move.l    _GuiBitmap(pc),a0
         mulu      #GuiLineSize,d1
         add.l     d1,a0
         move.l    d0,d1
         lsr.l     #3,d1
         add.l     d1,a0

         not.l     d0
         and.l     #7,d0
         addq.l    #3,d0
d4623 2
a4624 2
         tst.l     _RectCount
         bne.s     .RWait
d4626 49
a4674 49
         moveq     #$1c,d1
         lsl.w     d0,d1
         or.w      d1,(a0)
         lea       GuiBufferWidth(a0),a0
         not.w     d1
         and.w     d1,(a0)
         lea       GuiBufferWidth(a0),a0

         moveq     #$3f,d1
         lsl.w     d0,d1
         not.w     d1

         move.w    (a0),d3
         and.w     d1,d3
         moveq     #$38,d2
         lsl.w     d0,d2
         or.w      d2,d3
         move.w    d3,(a0)
         lea       GuiBufferWidth(a0),a0
         move.w    (a0),d3
         and.w     d1,d3
         moveq     #3,d2
         lsl.w     d0,d2
         or.w      d2,d3
         move.w    d3,(a0)
         lea       GuiBufferWidth(a0),a0

         move.w    (a0),d3
         and.w     d1,d3
         moveq     #$30,d2
         lsl.w     d0,d2
         or.w      d2,d3
         move.w    d3,(a0)
         lea       GuiBufferWidth(a0),a0
         move.w    (a0),d3
         and.w     d1,d3
         moveq     #7,d2
         lsl.w     d0,d2
         or.w      d2,d3
         move.w    d3,(a0)
         lea       GuiBufferWidth(a0),a0

         moveq     #$e,d1
         lsl.w     d0,d1
         move.w    d1,d2
         not.w     d2
         and.w     d2,(a0)
         lea       GuiBufferWidth(a0),a0
         or.w      d1,(a0)
d4676 2
a4677 2
         movem.l   (a7)+,d0-3/a0
         rts
d4681 4
a4684 4
         dc.l      HSCGetMinMax
         dc.l      HSCLayout
         dc.l      HSCRender
         dc.l      HSCClick
d4687 54
a4740 54
         moveq     #0,d0
         move.l    _CtGuiTemp(pc),a1
         move.l    a1,ge_Temp(a0)
         lea       ge_Size*7(a1),a2
         move.l    a2,_CtGuiTemp

         move.l    #_HGroup,(a1)
         lea       ge_Size(a1),a1

         move.l    a1,ge_Temp2(a0)
         move.l    #_HProp,(a1)
         move.l    ge_Data(a0),ge_Data(a1)
         move.l    ge_Data2(a0),ge_Data2(a1)
         move.l    ge_Data3(a0),ge_Data3(a1)
         move.l    a0,ge_ID(a1)
         move.l    #HSCHook,ge_Hook(a1)

         lea       ge_Size(a1),a1
         move.l    #_HSpacingEater,(a1)

         lea       ge_Size(a1),a1
         move.l    #_SmallButton,(a1)
         move.l    #$8e,ge_Data(a1)
         move.l    a0,ge_ID(a1)
         move.l    #HSCRelHook,ge_Hook(a1)
         move.l    #HSCDecrHook,ge_Data2(a1)
         move.l    d0,ge_Data3(a1)

         lea       ge_Size(a1),a1
         move.l    #_HSpacingEater,(a1)

         lea       ge_Size(a1),a1
         move.l    #_SmallButton,(a1)
         move.l    #$8d,ge_Data(a1)
         move.l    a0,ge_ID(a1)
         move.l    #HSCRelHook,ge_Hook(a1)
         move.l    #HSCIncrHook,ge_Data2(a1)
         move.l    d0,ge_Data3(a1)

         lea       ge_Size(a1),a1
         clr.l     (a1)

         move.l    a0,a1
         move.l    ge_Temp(a1),a0
         bsr       _GetMinMax

         move.l    ge_MinWidth(a0),ge_MinWidth(a1)
         move.l    ge_MaxWidth(a0),ge_MaxWidth(a1)
         move.l    ge_MinHeight(a0),ge_MinHeight(a1)
         move.l    ge_MaxHeight(a0),ge_MaxHeight(a1)

         lea       ge_Size(a1),a0
         move.l    a0,ge_Next(a1)
         rts
d4743 4
a4746 4
         move.l    a0,a2
         move.l    ge_Temp2(a0),a3
         movem.l   ge_Data(a0),d0-2
         movem.l   d0-2,ge_Data(a3)
d4748 2
a4749 2
         move.l    a0,a1
         move.l    ge_Temp(a1),a0
d4751 2
a4752 2
         movem.l   ge_Domain(a1),d0-5
         movem.l   d0-5,ge_Domain(a0)
d4754 1
a4754 1
         bsr       _Layout
d4756 2
a4757 2
         move.l    ge_Data(a3),ge_Data(a2)
         rts
d4760 2
a4761 2
         move.l    ge_Temp(a0),a0
         bra       _Render
d4764 2
a4765 2
         move.l    ge_Temp(a0),a0
         bra       _DoClick
d4768 3
a4770 3
         move.l    ge_ID(a0),a1
         movem.l   ge_Data(a0),d0-2
         movem.l   d0-2,ge_Data(a1)
d4773 5
a4777 5
         move.l    ge_Hook(a1),d1
         beq.s     .Done
         move.l    a1,a0
         move.l    d1,a1
         jmp       (a1)
d4780 1
a4780 1
         rts
d4783 2
a4784 8
         sub.l     #1,HSCHookCount
         bpl.s     .Done

         move.l    #5,HSCHookCount
         move.l    ge_ID(a0),a1
         move.l    ge_Temp2(a1),a0
         sub.l     #1,ge_Data(a0)
         bsr       _RefreshGuiEntry
d4786 9
a4794 3
         move.l    ge_Data(a0),d0
         move.l    d0,ge_Data(a1)
         bra.s     HSCCallHook
d4797 1
a4797 1
         rts
d4800 2
a4801 8
         sub.l     #1,HSCHookCount
         bpl.s     .Done

         move.l    #5,HSCHookCount
         move.l    ge_ID(a0),a1
         move.l    ge_Temp2(a1),a0
         add.l     #1,ge_Data(a0)
         bsr       _RefreshGuiEntry
d4803 9
a4811 3
         move.l    ge_Data(a0),d0
         move.l    d0,ge_Data(a1)
         bra.s     HSCCallHook
d4814 1
a4814 1
         rts
d4817 2
a4818 2
         clr.l     HSCHookCount
         rts
d4821 1
a4821 1
         dc.l      0
d4825 4
a4828 4
         dc.l      VSCGetMinMax
         dc.l      VSCLayout
         dc.l      VSCRender
         dc.l      VSCClick
d4831 54
a4884 54
         moveq     #1,d0
         move.l    _CtGuiTemp(pc),a1
         move.l    a1,ge_Temp(a0)
         lea       ge_Size*7(a1),a2
         move.l    a2,_CtGuiTemp

         move.l    #_VGroup,(a1)
         lea       ge_Size(a1),a1

         move.l    a1,ge_Temp2(a0)
         move.l    #_VProp,(a1)
         move.l    ge_Data(a0),ge_Data(a1)
         move.l    ge_Data2(a0),ge_Data2(a1)
         move.l    ge_Data3(a0),ge_Data3(a1)
         move.l    a0,ge_ID(a1)
         move.l    #VSCHook,ge_Hook(a1)
         lea       ge_Size(a1),a1

         move.l    #_VSpacingEater,(a1)
         lea       ge_Size(a1),a1

         move.l    #_SmallButton,(a1)
         move.l    #$90,ge_Data(a1)
         move.l    a0,ge_ID(a1)
         move.l    #VSCRelHook,ge_Hook(a1)
         move.l    #VSCDecrHook,ge_Data2(a1)
         move.l    d0,ge_Data3(a1)
         lea       ge_Size(a1),a1

         move.l    #_VSpacingEater,(a1)
         lea       ge_Size(a1),a1

         move.l    #_SmallButton,(a1)
         move.l    #$8f,ge_Data(a1)
         move.l    a0,ge_ID(a1)
         move.l    #VSCRelHook,ge_Hook(a1)
         move.l    #VSCIncrHook,ge_Data2(a1)
         move.l    d0,ge_Data3(a1)
         lea       ge_Size(a1),a1

         clr.l     (a1)

         move.l    a0,a1
         move.l    ge_Temp(a1),a0
         bsr       _GetMinMax

         move.l    ge_MinWidth(a0),ge_MinWidth(a1)
         move.l    ge_MaxWidth(a0),ge_MaxWidth(a1)
         move.l    ge_MinHeight(a0),ge_MinHeight(a1)
         move.l    ge_MaxHeight(a0),ge_MaxHeight(a1)

         lea       ge_Size(a1),a0
         move.l    a0,ge_Next(a1)
         rts
d4887 4
a4890 4
         move.l    a0,a2
         move.l    ge_Temp2(a0),a3
         movem.l   ge_Data(a0),d0-2
         movem.l   d0-2,ge_Data(a3)
d4892 2
a4893 2
         move.l    a0,a1
         move.l    ge_Temp(a1),a0
d4895 2
a4896 2
         movem.l   ge_Domain(a1),d0-5
         movem.l   d0-5,ge_Domain(a0)
d4898 1
a4898 1
         bsr       _Layout
d4900 2
a4901 2
         move.l    ge_Data(a3),ge_Data(a2)
         rts
d4904 2
a4905 2
         move.l    ge_Temp(a0),a0
         bra       _Render
d4908 2
a4909 2
         move.l    ge_Temp(a0),a0
         bra       _DoClick
d4912 3
a4914 3
         move.l    ge_ID(a0),a1
         movem.l   ge_Data(a0),d0-2
         movem.l   d0-2,ge_Data(a1)
d4917 5
a4921 5
         move.l    ge_Hook(a1),d1
         beq.s     .Done
         move.l    a1,a0
         move.l    d1,a1
         jmp       (a1)
d4924 1
a4924 1
         rts
d4927 2
a4928 2
         sub.l     #1,VSCHookCount
         bpl.s     .Done
d4930 9
a4938 9
         move.l    #5,VSCHookCount
         move.l    ge_ID(a0),a1
         move.l    ge_Temp2(a1),a0
         sub.l     #1,ge_Data(a0)
         bsr       _RefreshGuiEntry

         move.l    ge_Data(a0),d0
         move.l    d0,ge_Data(a1)
         bra.s     VSCCallHook
d4941 1
a4941 1
         rts
d4944 2
a4945 8
         sub.l     #1,VSCHookCount
         bpl.s     .Done

         move.l    #5,VSCHookCount
         move.l    ge_ID(a0),a1
         move.l    ge_Temp2(a1),a0
         add.l     #1,ge_Data(a0)
         bsr       _RefreshGuiEntry
d4947 9
a4955 3
         move.l    ge_Data(a0),d0
         move.l    d0,ge_Data(a1)
         bra.s     VSCCallHook
d4958 1
a4958 1
         rts
d4961 2
a4962 2
         clr.l     VSCHookCount
         rts
d4965 1
a4965 1
         dc.l      0
d4969 4
a4972 4
         dc.l      LVGetMinMax
         dc.l      LVLayout
         dc.l      LVRender
         dc.l      LVClick
d4975 40
a5014 40
         moveq     #1,d0
         move.l    _CtGuiTemp(pc),a1
         move.l    a1,ge_Temp(a0)
         lea       ge_Size*5(a1),a2
         move.l    a2,_CtGuiTemp

         move.l    #_HGroup,(a1)
         lea       ge_Size(a1),a1

         move.l    a1,ge_Temp2(a0)
         move.l    #IntListView,(a1)
         move.l    ge_Data3(a0),ge_Temp3(a1)
         move.l    a0,ge_ID(a1)
         move.l    ge_Hook(a0),ge_Hook(a1)
         lea       ge_Size(a1),a1

         move.l    #_HSpacingEater,(a1)
         lea       ge_Size(a1),a1

         move.l    a1,ge_Temp3(a0)
         move.l    #_VScroller,(a1)
         move.l    ge_Data2(a0),ge_Data(a1)
         move.l    a0,ge_ID(a1)
         move.l    #LVHook,ge_Hook(a1)
         lea       ge_Size(a1),a1

         clr.l     (a1)

         move.l    a0,a1
         move.l    ge_Temp(a1),a0
         bsr       _GetMinMax

         move.l    ge_MinWidth(a0),ge_MinWidth(a1)
         move.l    ge_MaxWidth(a0),ge_MaxWidth(a1)
         move.l    ge_MinHeight(a0),ge_MinHeight(a1)
         move.l    ge_MaxHeight(a0),ge_MaxHeight(a1)

         lea       ge_Size(a1),a0
         move.l    a0,ge_Next(a1)
         rts
d5017 8
a5024 8
         move.l    ge_Data(a0),a1
         moveq     #0,d6
         move.l    (a1),a1

         move.l    (a1),d7
         beq.s     .EmptyList
         move.l    d7,d0
         move.l    a1,d7
d5027 1
a5027 1
         addq.l    #1,d6
d5029 3
a5031 3
         move.l    d0,a1
         move.l    (a1),d0
         bne.s     .CountEntries
d5035 2
a5036 2
         move.l    a0,a3
         move.l    ge_Temp(a0),a0
d5038 2
a5039 2
         movem.l   ge_Domain(a3),d0-5
         movem.l   d0-5,ge_Domain(a0)
d5041 8
a5048 8
         subq.l    #3,d5
         lsr.l     #3,d5
         move.l    ge_Temp2(a3),a1
         move.l    d5,ge_Temp(a1)
         move.l    d7,ge_Temp2(a1)
         lea       ge_Size*2(a1),a1
         move.l    d6,ge_Data2(a1)
         move.l    d5,ge_Data3(a1)
d5050 1
a5050 1
         bsr       _Layout
d5052 1
a5052 1
         move.l    a3,a0
d5055 2
a5056 2
         move.l    ge_Temp3(a0),a2
         sub.l     a1,a1
d5058 2
a5059 2
         tst.l     ge_Data2(a2)
         beq.s     .EmptyList
d5061 2
a5062 2
         move.l    ge_Data(a2),d0
         move.l    ge_Data(a0),a1
d5065 2
a5066 2
         move.l    (a1),a1
         dbf       d0,.Loop
d5069 3
a5071 3
         move.l    ge_Temp2(a0),a2
         move.l    a1,ge_Temp2(a2)
         rts
d5074 5
a5078 5
         move.l    a0,a1
         move.l    ge_Temp3(a1),a0
         bsr       _RefreshGuiEntry
         move.l    ge_Temp2(a1),a0
         bra       _Render
d5081 2
a5082 2
         move.l    ge_Temp(a0),a0
         bra       _DoClick
d5085 12
a5096 12
         move.l    _CurrentDomain,-(a7)
         move.l    a0,a1
         move.l    ge_ID(a1),a0
         move.l    ge_Data(a1),ge_Data2(a0)
         bsr.s     LVFirstVisAddress
         move.l    ge_Temp2(a0),a0
         lea       ge_Domain(a0),a1
         move.l    a1,_CurrentDomain
         bsr       ILVClear
         bsr       ILVRenderEntries
         move.l    (a7)+,_CurrentDomain
         rts
d5099 4
a5102 4
         dc.l      ILVGetMinMax
         dc.l      0
         dc.l      ILVRender
         dc.l      ILVClick
d5105 2
a5106 2
         move.l    #40,ge_MinWidth(a0)
         move.l    #12,ge_MinHeight(a0)
d5108 2
a5109 2
         clr.l     ge_MaxWidth(a0)
         clr.l     ge_MaxHeight(a0)
d5111 3
a5113 3
         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d5116 6
a5121 6
         moveq     #0,d0
         moveq     #0,d1
         move.l    ge_Domain+gd_Width(a0),d2
         move.l    ge_Domain+gd_Height(a0),d3
         sf        d4
         bsr       _DrawBevelBox
d5124 2
a5125 2
         moveq     #-1,d0
         move.l    d0,ge_Data2(a0)
d5127 12
a5138 12
         move.l    ge_Domain+gd_Width(a0),d0
         subq.l    #6,d0
         move.l    d0,_TextLimit

         move.l    ge_Temp2(a0),d0
         beq.s     .EmptyList
         move.l    d0,a1
         move.l    (a1),d0

         move.l    ge_Temp(a0),d1
         subq.l    #1,d1
         move.l    ge_Temp3(a0),a2
d5140 1
a5140 1
         moveq     #1,d2
d5143 4
a5146 4
         moveq     #0,d3
         cmp.l     a1,a2
         bne.s     .NoSel
         moveq     #3,d3
d5149 7
a5155 7
         moveq     #2,d4
         move.l    d2,d5
         move.l    ge_Domain+gd_Width(a0),d6
         subq.l    #4,d6
         moveq     #8,d7
         move.l    d5,ge_Data2(a0)
         bsr       _DrawRectangle
d5159 11
a5169 11
         move.l    lve_Color(a1),d4
         moveq     #0,d5
         move.l    lve_String(a1),a5
         moveq     #2,d6
         move.l    d2,d7
         bsr.s     _DrawText

         addq.l    #8,d2
         move.l    d0,a1
         move.l    (a1),d0
         dbeq      d1,.Loop
d5173 2
a5174 2
         clr.l     _TextLimit
         rts
d5177 9
a5185 9
         rts
         moveq     #0,d3
         movem.l   ge_Domain+gd_Width(a0),d6-7
         moveq     #2,d4
         moveq     #1,d5
         subq.l    #4,d6
         subq.l    #2,d7
         bsr       _DrawRectangle
         rts
d5188 4
a5191 4
         move.l    d1,d2
         subq.l    #1,d2
         bpl.s     .Clicku
         rts
d5194 2
a5195 2
         move.l    a0,_ActiveGuiEntry
         move.l    #ILVHandler,_ActiveThingHandler
d5198 2
a5199 2
         btst      #6,$bfe001
         bne.s     .Release
d5201 1
a5201 1
         sub.l     ge_Domain+gd_Top(a0),d1
d5203 2
a5204 2
         subq.l    #1,d1
         bmi.s     .Before
d5206 3
a5208 3
         lsr.l     #3,d1
         move.l    ge_Temp(a0),d0
         subq.l    #1,d0
d5210 2
a5211 2
         cmp.l     d1,d0
         bcs.s     .After
d5213 2
a5214 2
         move.l    ge_Temp2(a0),d0
         beq       .Done
d5216 1
a5216 1
         clr.l     ILVHookCount
d5218 2
a5219 2
         move.l    d1,d2
         move.l    d0,a1
d5221 2
a5222 2
         subq.l    #1,d1
         bmi.s     .Vivi
d5224 1
a5224 1
         move.l    (a1),d0
d5227 2
a5228 2
         move.l    d0,a1
         move.l    (a1),d0
d5230 2
a5231 2
         dbeq      d1,.Loop
         bne.s     .Vivi
d5233 1
a5233 1
         move.l    lve_Prev(a1),a1
d5236 2
a5237 2
         cmp.l     ge_Temp3(a0),a1
         beq.s     .Done
d5239 1
a5239 1
         move.l    a1,ge_Temp3(a0)
d5241 10
a5250 10
         moveq     #0,d3
         moveq     #2,d4
         move.l    ge_Data2(a0),d5
         bmi       ILVRenderEntries

         moveq     #8,d7
         move.l    ge_Domain+gd_Width(a0),d6
         subq.l    #4,d6
         bsr       _DrawRectangle
         bra       ILVRenderEntries
d5253 2
a5254 2
         sub.l     #1,ILVHookCount
         bpl.s     .Done
d5256 20
a5275 20
         move.l    #5,ILVHookCount
         move.l    a0,a3
         move.l    ge_ID(a3),a1

         move.l    ge_Temp3(a1),a0
         move.l    ge_Data(a0),d7
         move.l    d7,d0
         subq.l    #1,d0
         move.l    d0,ge_Data(a0)
         bsr       _RefreshGuiEntry

         cmp.l     ge_Data(a0),d7
         beq.s     .Done

         move.l    a1,a0
         bsr       LVFirstVisAddress

         move.l    a3,a0
         move.l    ge_Temp2(a0),ge_Temp3(a0)
         bsr       ILVClear
d5277 1
a5277 1
         bra       ILVRenderEntries
d5280 2
a5281 2
         sub.l     #1,ILVHookCount
         bpl.s     .Done
d5283 22
a5304 22
         move.l    #5,ILVHookCount
         move.l    a0,a3
         move.l    ge_ID(a3),a1

         move.l    ge_Temp3(a1),a0
         move.l    ge_Data(a0),d7
         move.l    d7,d0
         addq.l    #1,d0
         move.l    d0,ge_Data(a0)
         bsr       _RefreshGuiEntry

         cmp.l     ge_Data(a0),d7
         beq.s     .Done

         move.l    a1,a0
         bsr       LVFirstVisAddress

         move.l    a3,a0
         move.l    ge_Temp3(a0),a1
         move.l    (a1),a1
         tst.l     (a1)
         beq.s     .MaisEuh
d5306 1
a5306 1
         move.l    a1,ge_Temp3(a0)
d5309 1
a5309 1
         bsr       ILVClear
d5311 1
a5311 1
         bra       ILVRenderEntries
d5314 16
a5329 16
         clr.l     _ActiveThingHandler
         clr.l     _ActiveGuiEntry
         clr.l     ILVHookCount

         move.l    ge_ID(a0),a1
         move.l    ge_Temp3(a0),d0
         move.l    d0,ge_Data3(a1)

         move.l    ge_Temp3(a1),a2
         move.l    ge_Data(a2),ge_Data2(a1)

         move.l    d0,a0
         move.l    ge_Hook(a1),d0
         beq.s     .Done
         move.l    d0,a1
         jmp       (a1)
d5332 1
a5332 1
         rts
d5335 1
a5335 1
         dc.l      0
d5339 4
a5342 4
         dc.l      HSEGetMinMax
         dc.l      0
         dc.l      0
         dc.l      -1
d5345 10
a5354 10
         moveq     #-GuiHorSpacing*2,d0
         move.l    d0,ge_MinWidth(a0)
         move.l    d0,ge_MaxWidth(a0)

         clr.l     ge_MinHeight(a0)
         clr.l     ge_MaxHeight(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d5358 4
a5361 4
         dc.l      VSEGetMinMax
         dc.l      0
         dc.l      0
         dc.l      -1
d5364 2
a5365 2
         clr.l     ge_MinWidth(a0)
         clr.l     ge_MaxWidth(a0)
d5367 7
a5373 7
         moveq     #-GuiVerSpacing*2,d0
         move.l    d0,ge_MinHeight(a0)
         move.l    d0,ge_MaxHeight(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d5377 4
a5380 4
         dc.l      EGetMinMax
         dc.l      0
         dc.l      0
         dc.l      0
d5383 8
a5390 8
         clr.l     ge_MinWidth(a0)
         clr.l     ge_MaxWidth(a0)
         clr.l     ge_MinHeight(a0)
         clr.l     ge_MaxHeight(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d5395 4
a5398 4
         dc.l      SGetMinMax
         dc.l      SLayout
         dc.l      SRender
         dc.l      SClick
d5401 12
a5412 12
         move.l    #GuiScreenWidth,d2
         move.l    d2,ge_MinWidth(a0)
         move.l    d2,ge_MaxWidth(a0)

         moveq     #31,d0
         move.l    d0,ge_MinHeight(a0)

         move.l    a0,a1
         lea       ge_Size(a0),a0
         moveq     #0,d0
         moveq     #0,d1
         lsr.l     #1,d2
d5415 1
a5415 1
         addq.l    #1,d1
d5417 1
a5417 1
         bsr.s     _GetMinMax
d5419 3
a5421 3
         add.l     ge_MinWidth(a0),d0
         cmp.l     d0,d2
         bcs.s     .Skronk
d5423 3
a5425 3
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         beq.s     .Done
d5427 1
a5427 1
         addq.l    #1,d0
d5429 1
a5429 1
         bra.s     .Loop
d5432 14
a5445 14
         sub.l     ge_MinWidth(a0),d0
         subq.l    #1,d0
         subq.l    #1,d1
.Done:
         sub.l     d0,d2

         subq.l    #1,d1
         move.l    d1,ge_Temp(a1)
         beq.s     .SearchLast

         divu      d1,d2
         ext.l     d2
         addq.l    #1,d2
         move.l    d2,ge_Data(a1)
d5448 4
a5451 4
         tst.l     (a0)
         beq.s     .AllDone
         lea       ge_Size(a0),a0
         bra.s     .SearchLast
d5454 3
a5456 3
         lea       ge_Size(a0),a0
         move.l    a0,ge_Next(a1)
         rts
d5459 1
a5459 1
         move.l    _CurrentDomain(pc),a1
d5461 2
a5462 2
         move.l    a0,a1
         move.l    ge_Data(a1),d2
d5464 2
a5465 2
         lea       ge_Size(a0),a0
         moveq     #0,d0
d5467 2
a5468 2
         move.l    ge_Temp(a1),d3
         bne.s     .PosLoop
d5470 3
a5472 3
         move.l    #GuiScreenWidth/2,d0
         sub.l     ge_MinWidth(a0),d0
         lsr.l     #1,d0
d5475 1
a5475 1
         move.l    d0,ge_Domain+gd_Left(a0)
d5477 2
a5478 2
         move.l    ge_MinWidth(a0),d1
         move.l    d1,ge_Domain+gd_Width(a0)
d5480 2
a5481 2
         add.l     d1,d0
         move.l    d0,ge_Domain+gd_Right(a0)
d5483 3
a5485 3
         move.l    ge_MinHeight(a0),d1
         move.l    d1,ge_Domain+gd_Height(a0)
         move.l    d1,ge_Domain+gd_Bottom(a0)
d5487 1
a5487 1
         clr.l     ge_Domain+gd_Top(a0)
d5489 1
a5489 1
         add.l     d2,d0
d5491 1
a5491 1
         bsr       _Layout
d5493 2
a5494 2
         move.l    ge_Next(a0),a0
         dbf       d3,.PosLoop
d5496 1
a5496 1
         rts
d5499 4
a5502 4
         move.l    _CurrentDomain(pc),a1
         move.l    gd_Top(a1),d0
         add.w     GuiP(pc),d0
         move.w    d0,GuiSelP
d5504 2
a5505 2
         move.l    #GuiLayer1,_GuiL1Ptr
         bra       _GRender
d5508 2
a5509 2
         move.l    _CurrentDomain(pc),a1
         sub.l     gd_Top(a1),d1
d5511 2
a5512 2
         lea       ge_Size(a0),a0
         lsr.l     #1,d0
d5515 2
a5516 2
         cmp2.l    ge_Domain+gd_Left(a0),d0
         bcs.s     .AGrunt
d5518 2
a5519 2
         cmp2.l    ge_Domain+gd_Top(a0),d1
         bcc.s     .Bingo
d5522 4
a5525 4
         move.l    ge_Next(a0),a0
         tst.l     (a0)
         bne.s     .Loop
         rts
d5528 2
a5529 2
         bsr.s     _DoClick
         rts
d5533 4
a5536 4
         dc.l      SprGetMinMax
         dc.l      0
         dc.l      SprRender
         dc.l      SprClick
d5539 1
a5539 1
         move.l    ge_Data(a0),a1
d5541 11
a5551 11
         move.l    spd_Width(a1),d0
         move.l    d0,ge_MinWidth(a0)
         move.l    d0,ge_MaxWidth(a0)

         move.l    spd_Height(a1),d0
         move.l    d0,ge_MinHeight(a0)
         move.l    d0,ge_MaxHeight(a0)

         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
         rts
d5554 1
a5554 1
         move.l    ge_Data(a0),a3
d5556 47
a5602 47
         move.l    _CurrentDomain(pc),a0
         move.l    gd_Left(a0),d6
         move.l    gd_Top(a0),d7

         move.l    d6,d5
         and.l     #$f,d5
         ror.w     #4,d5
         move.w    d5,d0
         swap      d5
         move.w    d0,d5
         or.l      #$0fca0000,d5

         lea       SprBlit(pc),a0
         moveq     #0,d0
         bsr       _GetBlitNode
         move.l    a1,a0

         move.l    d5,(a0)+

         move.w    spd_WWidth+2(a3),d5
         addq.w    #1,d5

         move.w    #GuiSelBufferWidth,d1
         sub.w     d5,d1
         sub.w     d5,d1

         moveq     #-2,d2
         move.w    d2,(a0)+
         move.w    d1,(a0)+

         mulu      #GuiSelLineSize,d7
         lsr.l     #4,d6
         add.l     d6,d7
         add.l     d6,d7

         add.l     _GuiSelBitmap(pc),d7

         movem.l   spd_Bitmap(a3),d3-4

         move.l    d4,(a0)+
         move.l    d3,(a0)+
         move.l    d7,(a0)+

         move.w    spd_Height+2(a3),d2
         mulu      #NbPlanes,d2
         move.w    d2,(a0)+
         move.w    d5,(a0)
d5604 2
a5605 2
         bsr       _AddBlitNode
         rts
d5608 18
a5625 18
         move.l    (a0)+,bltcon0(a6)
         moveq     #-1,d0
         clr.w     d0
         move.l    d0,bltafwm(a6)
         move.w    (a0)+,d0
         move.w    d0,bltamod(a6)
         move.w    d0,bltbmod(a6)
         move.w    (a0)+,d0
         move.w    d0,bltcmod(a6)
         move.w    d0,bltdmod(a6)
         move.l    (a0)+,bltapt(a6)
         move.l    (a0)+,bltbpt(a6)
         move.l    (a0)+,d0
         move.l    d0,bltcpt(a6)
         move.l    d0,bltdpt(a6)
         move.w    (a0)+,bltsizv(a6)
         move.w    (a0),bltsizh(a6)
         rts
d5628 4
a5631 4
         move.l    a0,_ActiveGuiEntry
         lea       SprHandler(pc),a1
         move.l    a1,_ActiveThingHandler
         rts
d5634 2
a5635 2
         btst      #6,$bfe001
         beq.s     .Done
d5637 5
a5641 5
         clr.l     _ActiveThingHandler
         move.l    ge_Hook(a0),d0
         beq.s     .Done
         move.l    d0,a0
         jmp       (a0)
d5644 1
a5644 1
         rts
d5648 8
d5657 1
a5657 3
         ds.l      1
_CtGuiTemp:
         ds.l      1
d5661 8
a5668 8
         moveq     #0,d3
         moveq     #0,d4
         moveq     #0,d5
         move.l    _CurrentDomain(pc),a1
         move.l    gd_Width(a1),d6
         move.l    gd_Height(a1),d7
         bsr.s     _DrawRectangle
         rts
d5672 1
a5672 1
         movem.l   d3-d7/a0,-(a7)
d5674 5
a5678 5
         move.l    d3,a0
         moveq     #2,d3
         tst.b     d4
         beq.s     .Raised
         moveq     #1,d3
d5681 24
a5704 24
         move.l    d0,d4
         move.l    d1,d5
         moveq     #2,d6
         move.l    a0,d7
         bsr.s     _DrawRectangle

         eor.b     #3,d3
         add.l     d2,d4
         subq.l    #2,d4
         bsr.s     _DrawRectangle

         move.l    d0,d4
         addq.l    #1,d4
         add.l     a0,d5
         subq.l    #1,d5
         move.l    d2,d6
         subq.l    #1,d6
         moveq     #1,d7
         bsr.s     _DrawRectangle

         eor.b     #3,d3
         move.l    d0,d4
         move.l    d1,d5
         bsr.s     _DrawRectangle
d5706 2
a5707 2
         movem.l   (a7)+,d3-7/a0
         rts
d5711 2
a5712 2
         ;rts
         movem.l   d0-7/a0-6,-(a7)
d5714 24
a5737 24
         move.l    _CurrentDomain(pc),a0
         add.l     gd_Left(a0),d4
         add.l     gd_Top(a0),d5

         add.l     #2,_RectCount

         lea       _RectBlit,a0
         moveq     #0,d0
         bsr       _GetBlitNode
         move.l    a1,a2

         lea       _RectBlit,a0
         moveq     #0,d0
         bsr       _GetBlitNode
         move.l    a1,a0
         move.l    a2,a3

         move.l    #$050c0000,d0
         move.l    d0,d1
         move.l    #$05fc0000,d2

         btst      #0,d3
         beq.s     .Bp1Ok
         move.l    d2,d0
d5739 4
a5742 4
         move.l    d0,(a0)+
         btst      #1,d3
         beq.s     .Bp2Ok
         move.l    d2,d1
d5744 1
a5744 1
         move.l    d1,(a3)+
d5746 2
a5747 2
         move.l    d4,d0
         lsr.l     #4,d4
d5749 18
a5766 18
         and.b     #$f,d0
         extb.l    d0
         add.l     d0,d6
         moveq     #-1,d1
         lsr.w     d0,d1
         move.w    d1,(a0)+
         move.w    d1,(a3)+

         move.l    d6,d0
         lsr.l     #4,d6

         moveq     #-1,d1

         and.b     #$f,d0
         beq.s     .Gaaa
         addq.l    #1,d6
         lsr.w     d0,d1
         not.w     d1
d5769 2
a5770 2
         move.w    d1,(a0)+
         move.w    d1,(a3)+
d5772 3
a5774 3
         move.l    _GuiBitmap(pc),d0
         add.l     d4,d0
         add.l     d4,d0
d5776 4
a5779 4
         move.l    d5,d1
         move.l    #GuiLineSize,d2
         mulu      d2,d1
         add.l     d1,d0
d5781 1
a5781 1
         move.l    d0,(a0)+
d5783 2
a5784 2
         add.l     #GuiBufferWidth,d0
         move.l    d0,(a3)+
d5786 2
a5787 2
         sub.l     d6,d2
         sub.l     d6,d2
d5789 2
a5790 2
         move.w    d2,(a0)+
         move.w    d2,(a3)+
d5792 4
a5795 4
         move.w    d7,(a0)+
         move.w    d7,(a3)+
         move.w    d6,(a0)
         move.w    d6,(a3)
d5797 3
a5799 3
         bsr       _PreAddBlitNode
         move.l    a2,a1
         bsr       _AddBlitNode
d5801 2
a5802 2
         movem.l   (a7)+,d0-7/a0-6
         rts
d5804 2
a5805 2
         lea       _RectHook(pc),a5
         move.l    a5,_BlitHook
d5807 12
a5818 12
         move.l    (a0)+,bltcon0(a6)
         move.l    (a0)+,bltafwm(a6)
         move.l    (a0)+,d0
         move.l    d0,bltbpt(a6)
         move.l    d0,bltdpt(a6)
         move.w    (a0)+,d0
         move.w    d0,bltbmod(a6)
         move.w    d0,bltdmod(a6)
         move.w    #-1,bltadat(a6)
         move.w    (a0)+,bltsizv(a6)
         move.w    (a0),bltsizh(a6)
         rts
d5820 2
a5821 2
         sub.l     #1,_RectCount
         rts
d5823 1
a5823 1
         dc.l      0
d5827 1
a5827 1
         dc.l      0
d5829 1
a5829 1
         movem.l   d3/d5-6/a0/a5,-(a7)
d5831 2
a5832 2
         tst.l     d5
         bne.s     .LengthOk
d5834 1
a5834 1
         move.l    a5,a0
d5836 6
a5841 5
         tst.b     (a0)+
         bne.s     .StrLen
         sub.l     a5,a0
         move.l    a0,d5
         subq.l    #1,d5
d5845 7
a5851 7
         move.l    _TextLimit(pc),d3
         beq.s     .NoClip
         sub.l     d6,d3
         lsr.l     #3,d3
         cmp.l     d5,d3
         bcc.s     .NoClip
         move.l    d3,d5
d5854 2
a5855 2
         subq.l    #1,d5
         move.l    d5,d3
d5857 8
a5864 6
         move.b    (a5)+,d5
         bsr.s     _DrawChar
         addq.l    #8,d6
         dbf       d3,.Loop
         movem.l   (a7)+,d3/d5-6/a0/a5
         rts
d5868 2
a5869 2
         ;rts
         movem.l   d0-3/d6-7/a0-2,-(a7)
d5871 13
a5883 13
         move.l    _CurrentDomain(pc),a0
         add.l     gd_Left(a0),d6
         add.l     gd_Top(a0),d7

         cmp.b     #$a0,d5
         beq.s     .Done
         bcs.s     .Ok

         cmp.b     #$ad,d5
         bcs.s     .Pfouh
         beq.s     .Crévindiou
         subq.b    #1,d5
         bra.s     .Pfouh
d5885 2
a5886 2
         move.b    #"-",d5
         bra.s     .Ok
d5888 1
a5888 1
         subq.b    #1,d5
d5891 13
a5903 13
         move.l    _GuiBitmap(pc),a1
         mulu      #GuiLineSize,d7
         add.l     d7,a1

         moveq     #0,d7
         not.b     d7
         ror.l     #8,d7

         btst      #0,d5
         beq.s     .EvenChar
         subq.l    #2,a1
         addq.l    #8,d6
         lsr.l     #8,d7
d5906 13
a5918 13
         lea       _GuiFont(pc),a0
         and.b     #$fe,d5
         add.l     d5,a0

         move.l    d6,d0
         lsr.l     #3,d0
         and.b     #$fe,d0
         add.l     d0,a1

         and.l     #$f,d6
         move.l    #254,d0
         move.l    #GuiBufferWidth,d1
         moveq     #7,d3
d5921 2
a5922 2
         tst.l     _RectCount
         bne.s     .RWait
d5924 2
a5925 2
         lea       CharTable(pc),a2
         jsr       (a2,d4.w*2)
d5928 2
a5929 2
         movem.l   (a7)+,d0-3/d6-7/a0-2
         rts
d5932 4
a5935 4
         bra.s     CharLoop0
         bra.s     CharLoop1
         bra.s     CharLoop2
         bra.s     CharLoop3
d5938 11
a5948 11
         move.l    (a0),d2
         and.l     d7,d2
         lsr.l     d6,d2
         not.l     d2
         and.l     d2,(a1)
         add.l     d1,a1
         and.l     d2,(a1)
         add.l     d1,a1
         add.l     d0,a0
         dbf       d3,CharLoop0
         rts
d5950 11
a5960 11
         move.l    (a0),d2
         and.l     d7,d2
         lsr.l     d6,d2
         or.l      d2,(a1)
         not.l     d2
         add.l     d1,a1
         and.l     d2,(a1)
         add.l     d1,a1
         add.l     d0,a0
         dbf       d3,CharLoop1
         rts
d5962 12
a5973 12
         move.l    (a0),d2
         and.l     d7,d2
         lsr.l     d6,d2
         not.l     d2
         and.l     d2,(a1)
         not.l     d2
         add.l     d1,a1
         or.l      d2,(a1)
         add.l     d1,a1
         add.l     d0,a0
         dbf       d3,CharLoop2
         rts
d5975 10
a5984 10
         move.l    (a0),d2
         and.l     d7,d2
         lsr.l     d6,d2
         or.l      d2,(a1)
         add.l     d1,a1
         or.l      d2,(a1)
         add.l     d1,a1
         add.l     d0,a0
         dbf       d3,CharLoop3
         rts
d5988 1
a5988 1
         incbin    "GuiFont.bin"
@


0.57
log
@Amélioration listviews clignoter moins redessiner bidule.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.56 1997/10/02 18:56:58 MORB Exp MORB $
d89 1
a89 1
_Request:          ; a0=Title a1=body a2=buttons a3=Hook
d95 1
d267 1
a267 1
_AsyncHandler:
d278 1
a278 1
         move.l    _AsyncHandler(pc),d0
a363 1
         ;bsr       _GetMinMax
a3262 1

@


0.56
log
@Modif pour pas RefreshGuiEntry() écraser registres continuer à. (C'était du NCA, Notation CdBSienne Anarchique, ne pas confondre avec RPN)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.55 1997/09/30 11:00:08 MORB Exp MORB $
d2456 4
a2459 1
         move.l    ge_Temp(a0),a0
d2525 1
d2528 2
a2530 1
         moveq     #3,d3
d2539 1
a2539 1
.NoSel:
d2559 1
@


0.55
log
@Correctu un autre bug de listview.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.54 1997/09/29 18:44:02 MORB Exp MORB $
d266 2
d277 7
d355 1
a355 1
         movem.l   d7/a1,-(a7)
d369 1
a369 1
         movem.l   (a7)+,d7/a1
@


0.54
log
@Les listviews plantaient avec des listes vides. Maintenant, plus.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.53 1997/09/28 17:10:54 MORB Exp MORB $
d2430 2
a2431 1
         move.l    ge_Data(a2),d0
d2434 1
@


0.53
log
@Nettoyage de deux trois trucs dans le source
@
text
@d6 1
a6 1
* $Id: Gui.s 0.52 1997/09/28 17:06:41 MORB Exp MORB $
a2427 1
         move.l    ge_Data(a0),a1
d2429 1
d2431 3
d2439 1
@


0.52
log
@Raâââaah... Fini _ListView. Garglonk.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.51 1997/09/27 22:47:24 MORB Exp MORB $
d2082 1
a2082 1
         move.l    #"",ge_Data(a1)
d2093 1
a2093 1
         move.l    #"",ge_Data(a1)
d2226 1
a2226 1
         move.l    #"",ge_Data(a1)
d2237 1
a2237 1
         move.l    #"",ge_Data(a1)
a2448 1
         ;rts
@


0.51
log
@Les listview sont presque (voir dico) finies (voir dico aussi). Aussi ajout de la gestion de l'oreille du milieu (?!?) du hamster...
@
text
@d6 1
a6 1
* $Id: Gui.s 0.50 1997/09/24 22:23:24 MORB Exp MORB $
d346 1
a346 1
         move.l    a1,-(a7)
d354 1
a354 1
         bsr       _GetMinMax
d360 1
a360 1
         move.l    (a7)+,a1
d1713 1
a1713 1
         moveq     #24,d0
a2358 3
         move.l    ge_Data(a0),ge_Data(a1)
         move.l    ge_Data2(a0),ge_Data2(a1)
         move.l    ge_Data3(a0),ge_Data3(a1)
d2369 1
a2369 1
         move.l    #0,ge_Data(a1)
a2371 2
         move.l    #10,ge_Data2(a1)
         move.l    #1,ge_Data3(a1)
d2414 1
a2414 1
         subq.l    #4,d5
d2450 4
a2453 1
         move.l    ge_ID(a0),a0
d2456 5
a2460 12
         bra       _RefreshGuiEntry
         movem.l   ge_Data(a0),d0-2
         movem.l   d0-2,ge_Data(a1)

LVCallHook:
         move.l    ge_Hook(a1),d1
         beq.s     .Done
         move.l    a1,a0
         move.l    d1,a1
         jmp       (a1)

.Done:
d2493 1
a2493 1
         subq.l    #8,d0
d2505 1
a2505 1
         moveq     #2,d2
d2514 1
a2514 1
         movem.l   ge_Domain+gd_Width(a0),d6
d2522 1
a2522 1
         moveq     #1,d4
d2524 2
a2525 1
         moveq     #4,d6
a2526 1
         move.l    lve_String(a1),a5
d2550 129
a2678 2
         subq.l    #2,d1
         bmi.s     .PasClicku
d2680 3
d2684 2
d2687 7
a2693 1
.PasClicku:
d2695 3
@


0.50
log
@Correction d'un petit bug de _ListView
@
text
@d6 1
a6 1
* $Id: Gui.s 0.49 1997/09/24 22:07:18 MORB Exp MORB $
d270 3
d287 19
d309 3
d315 2
d322 3
d2362 1
d2476 1
a2476 1
         dc.l      0
d2498 3
d2512 18
d2532 1
d2534 1
a2534 3
         moveq     #2,d7

.Loop:
d2538 1
a2538 1
         addq.l    #8,d7
d2546 19
@


0.49
log
@Ajout de quelques trucs dans _ListView (On n'a jamais été aussi près de la fin...) et correction d'un collection de bugs dans HProp et VProp
@
text
@d6 1
a6 1
* $Id: Gui.s 0.48 1997/09/24 12:50:30 MORB Exp MORB $
d2382 2
a2383 1
         move.l    ge_Temp(a0),a3
d2385 2
a2386 2
         movem.l   ge_Domain(a0),d0-5
         movem.l   d0-5,ge_Domain(a3)
d2390 1
a2390 1
         move.l    ge_Temp2(a0),a1
d2397 1
a2397 1
         bsr.s     LVFirstVisAddress
d2400 13
a2412 1
         bra       _Layout
a2438 13
         rts

LVFirstVisAddress:
         move.l    ge_Data(a0),a1
         move.l    ge_Temp3(a0),a2
         move.l    ge_Data(a2),d0

.Loop:
         move.l    (a1),a1
         dbf       d0,.Loop

         move.l    ge_Temp2(a0),a2
         move.l    a1,ge_Temp2(a2)
@


0.48
log
@Le pointeur possède maintenant une résolution horizontale mieux. (70ns)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.47 1997/09/23 23:21:18 MORB Exp MORB $
a1455 1
         ;addq.l    #1,d3
d1457 3
a1565 3
         addq.l    #1,d3
         bclr      #0,d3

d1642 2
a1645 1
         ;addq.l    #1,d1
a1646 1
         ;lsl.l     #8,d0
a1650 4
         ;moveq     #0,d1
         ;lsr.l     #8,d0
         ;addx.l    d1,d0

a1727 1
         addq.l    #1,d3
d1729 3
d1913 2
d2339 1
d2382 1
a2382 2
         move.l    a0,a1
         move.l    ge_Temp(a1),a0
d2384 2
a2385 2
         movem.l   ge_Domain(a1),d0-5
         movem.l   d0-5,ge_Domain(a0)
d2389 1
a2389 1
         move.l    ge_Temp2(a1),a1
d2396 3
d2410 5
a2414 2
         rts
         move.l    ge_ID(a0),a1
d2426 13
@


0.47
log
@Ajout de trucs dans les listview (pas encore opérationelles), plein de pb avec les props...
@
text
@d6 1
a6 1
* $Id: Gui.s 0.46 1997/09/22 21:49:44 MORB Exp MORB $
d201 1
d229 1
a229 1
         lsl.w     #2,d6
d248 1
a248 1
         dc.l      GuiScreenWidth/2
d252 1
a252 1
         dc.l      GuiScreenWidth/2
a272 1
         add.l     d0,d0
a1206 2

         lsr.l     #1,d0
d1242 1
a1242 1
         move.l    #GuiScreenWidth/2,_MaxMouseX
a1569 1
         lsr.l     #1,d3
a1572 1
         lsr.l     #1,d1
d1669 1
a1669 1
         move.l    #GuiScreenWidth/2,_MaxMouseX
a1836 1
         lsr.l     #1,d0
d1936 1
a1936 1
         move.l    #GuiScreenWidth/2,_MaxMouseX
@


0.46
log
@Suppression d'un bug mineur dans les Scrollers
@
text
@d6 1
a6 1
* $Id: Gui.s 0.45 1997/09/22 07:27:13 MORB Exp MORB $
d1458 1
a1458 1
         addq.l    #1,d3
d1649 1
d1651 1
d1655 5
d2342 2
a2343 2
         ;move.l    #_Empty,(a1)
         ;lea       ge_Size(a1),a1
d2373 1
a2373 1
         move.l    (a1),d0
d2375 2
d2393 1
a2393 1
         subq.l    #2,d5
d2397 2
a2398 2
         move.l    d6,ge_Temp2(a1)
         lea       ge_Size(a1),a1
d2451 32
a2482 1
         bra       _DrawBevelBox
d2970 1
a2970 1
         movem.l   d3/d5/a0/a5,-(a7)
d2987 1
d3001 1
a3001 1
         movem.l   (a7)+,d3/d5/a0/a5
@


0.45
log
@Implémentation partielle de _ListView
@
text
@d6 1
a6 1
* $Id: Gui.s 0.44 1997/09/21 13:34:41 MORB Exp MORB $
d2085 2
a2086 1
         move.l    ge_Temp2(a0),a1
d2088 1
a2088 1
         movem.l   d0-2,ge_Data(a1)
d2096 4
a2099 1
         bra       _Layout
d2229 2
a2230 1
         move.l    ge_Temp2(a0),a1
d2232 1
a2232 1
         movem.l   d0-2,ge_Data(a1)
d2240 4
a2243 1
         bra       _Layout
d2339 1
a2339 1
         move.l    #1,ge_Data(a1)
d2341 1
a2341 1
         move.l    #VSCHook,ge_Hook(a1)
d2362 16
d2388 1
d2390 1
@


0.44
log
@Ajout du clippage dedans DrawText()
@
text
@d6 1
a6 1
* $Id: Gui.s 0.43 1997/09/21 00:06:05 MORB Exp MORB $
d514 1
a514 1
         bset      #31,d3
d551 1
a551 1
         beq.s     .MaxOk
d553 6
a558 1
.MaxOk:
d706 1
a706 1
         bset      #31,d2
d744 1
a744 1
         beq.s     .MaxOk
d746 6
a751 1
.MaxOk:
d904 1
a904 1
         bcs.s     .AGrunt
d909 1
a909 1
.AGrunt:
d918 1
a918 1
         bmi.s     .AGrunt
d1470 2
d1485 5
d1742 2
d1757 5
d2085 4
a2177 1

d2225 4
d2300 117
@


0.43
log
@Suppression du léger délai vaseux et aléatoire, de plus très malcommode quand on appuie dessus les flèches des scrollers.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.42 1997/09/21 00:00:07 MORB Exp MORB $
d2753 2
d2770 8
@


0.42
log
@Réduction de la largeur des _VProp de 4 pixels. Maintenant, _VScroller rend pas trop mal.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.41 1997/09/20 23:54:10 MORB Exp MORB $
d2029 1
d2040 1
d2094 1
a2094 1
         bne.s     .Done
d2111 1
a2111 1
         bne.s     .Done
d2126 4
d2131 1
a2131 1
         dc.l      5
d2166 1
d2177 1
d2231 1
a2231 1
         bne.s     .Done
d2248 1
a2248 1
         bne.s     .Done
d2263 4
d2268 1
a2268 1
         dc.l      5
@


0.41
log
@Correction d'un chni problème de layout dedans les groupes. Je le savais depuis longtemps, mais ça me dérangeais depuis pas longtemps...
@
text
@d6 1
a6 1
* $Id: Gui.s 0.40 1997/09/20 16:09:38 MORB Exp MORB $
d1673 1
a1673 1
         moveq     #24,d0
d1755 1
a1755 1
         move.l    #16,d2
d1760 1
a1760 1
         moveq     #9,d0
d1769 1
a1769 1
         moveq     #16,d2
d1775 1
a1775 1
         moveq     #12,d6
d1782 1
a1782 1
         moveq     #9,d0
d1791 1
a1791 1
         moveq     #16,d6
@


0.40
log
@Un petit bug en moins dans _SmallButton
@
text
@d6 1
a6 1
* $Id: Gui.s 0.39 1997/09/20 16:05:45 MORB Exp MORB $
d593 1
a593 1
         beq.s     .Ok
d598 2
d612 2
d618 1
a618 1
         beq.s     .Fixed
d621 1
a621 1
         bcc.s     .Fixed
d625 2
d630 28
d780 1
a780 1
         beq.s     .Ok
d785 2
d799 2
d805 1
a805 1
         beq.s     .Fixed
d808 1
a808 1
         bcc.s     .Fixed
d812 2
d817 28
d2144 1
d2152 1
d2154 1
a2155 1
         move.l    #_VSpacingEater,(a1)
a2156 1
         lea       ge_Size(a1),a1
d2162 1
d2164 1
a2165 1
         move.l    #_VSpacingEater,(a1)
a2166 1
         lea       ge_Size(a1),a1
d2172 1
a2173 1
         lea       ge_Size(a1),a1
d2269 1
@


0.39
log
@Ajout d'encore une petite fonctionnalité naze dans _SmallButton
@
text
@d6 1
a6 1
* $Id: Gui.s 0.38 1997/09/20 15:54:16 MORB Exp MORB $
d991 1
a991 1
         tst.l     ge_Data2(a0)
d1095 1
a1095 1
         moveq     #4,d6
d1937 1
d1962 1
d1972 1
d2067 1
d2092 1
d2102 1
@


0.38
log
@Implémentation de _VScroller
@
text
@d6 1
a6 1
* $Id: Gui.s 0.37 1997/09/20 15:49:37 MORB Exp MORB $
d990 6
d1638 14
a1651 1
         move.l    ge_Temp(a0),d0
d1653 4
a1656 3
         mulu      ge_Data+2(a0),d0
         move.l    ge_Data2(a0),d1
         sub.l     ge_Data3(a0),d1
a1762 1

a1763 1

a1767 3
         bpl.s     .KnobOk

         moveq     #0,d0
a1793 1

a1794 1

a1799 7
         move.l    ge_Data2(a0),d2
         addq.l    #1,d2
         sub.l     d1,d2

         cmp.l     d0,d2
         bcc.s     .KnobOk
         move.l    d2,d0
@


0.37
log
@Petite modif dans _SmallButton
@
text
@d6 1
a6 1
* $Id: Gui.s 0.36 1997/09/20 15:40:24 MORB Exp MORB $
d2048 127
@


0.36
log
@Implémentation de _HScroller, et de _VSpacingEater et _HSpacingEater. Et puis, euh, rien.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.35 1997/09/20 12:00:20 MORB Exp MORB $
d983 1
a983 1
         dc.l      0
d1000 7
d1016 1
a1016 1
         moveq     #4,d6
@


0.35
log
@Ajout de gestion truc bidule gadgetdown dedans SmallButton
@
text
@d6 1
a6 1
* $Id: Gui.s 0.34 1997/09/19 23:31:34 MORB Exp MORB $
d340 1
d477 1
a477 1
         movem.l   d0-7/a0-6,-(a7)
d480 1
a480 1
         beq.s     .Done
d492 1
d495 1
a495 1
         movem.l   (a7)+,d0-7/a0-6
d839 2
d859 1
d1029 1
a1029 1
         move.l    ge_Data2(a0),d1
d1031 2
a1032 1
         move.l    d1,a1
d1034 1
d1360 16
a1375 1
         move.l    ge_Temp(a0),d0
d1377 2
a1378 3
         mulu      ge_Data+2(a0),d0
         move.l    ge_Data2(a0),d1
         sub.l     ge_Data3(a0),d1
a1489 1

a1490 1

a1494 3
         bpl.s     .KnobOk

         moveq     #0,d0
a1520 1

a1521 1

a1526 7
         move.l    ge_Data2(a0),d2
         addq.l    #1,d2
         sub.l     d1,d2

         cmp.l     d0,d2
         bcc.s     .KnobOk
         move.l    d2,d0
d1916 164
d2088 5
@


0.34
log
@Débuggage de VProp.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.33 1997/09/19 22:56:26 MORB Exp MORB $
d1023 6
@


0.33
log
@Implémentation de _VProp()
@
text
@d6 1
a6 1
* $Id: Gui.s 0.32 1997/09/17 22:58:59 MORB Exp MORB $
d1444 1
d1446 1
a1446 1
         addq.l    #4,d3
a1450 1
         addq.l    #4,d1
d1579 1
a1579 1
         moveq     #25,d0
d1601 1
a1601 1
         cmp.l     #7,d1
d1603 1
a1603 1
         moveq     #7,d1
d1652 1
a1652 1
         moveq     #8,d0
d1674 1
a1674 1
         moveq     #8,d0
d1689 2
a1690 2
         move.l    d0,d3
         sub.l     ge_Domain+gd_Top(a0),d0
d1693 1
a1693 1
         cmp.l     d2,d0
d1696 1
a1696 1
         cmp.l     d2,d0
d1700 1
a1700 1
         move.l    d3,HPOffset
d1702 3
a1704 6
         add.l     _GuiPos(pc),d1
         move.l    d1,_MinMouseX
         move.l    d1,_MaxMouseX

         addq.l    #1,d3
         bclr      #0,d3
d1706 2
a1708 2
         addq.l    #4,d3
         lsr.l     #1,d3
a1711 2
         addq.l    #4,d1
         lsr.l     #1,d1
d1787 1
a1787 1
         sub.l     HPOffset(pc),d0
d1789 1
a1789 1
         cmp.l     ge_Temp2(a0),d0
d1793 1
a1793 1
         move.l    d0,ge_Temp2(a0)
d1796 7
a1802 7
         move.l    ge_Data2(a0),d1
         sub.l     ge_Data3(a0),d1
         mulu      d1,d0
         move.l    ge_Temp(a0),d1
         divu      d1,d0
         ext.l     d0
         move.l    d0,ge_Data(a0)
d1804 1
@


0.32
log
@Deux trois modifs pas intéressantes.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.31 1997/09/17 22:55:06 MORB Exp MORB $
d1564 265
@


0.31
log
@Ajout du trou dans les curseurs de propgadgets
@
text
@d6 1
a6 1
* $Id: Gui.s 0.30 1997/09/16 22:13:05 MORB Exp MORB $
d1392 1
a1392 3
         bsr.s     _DrawPropHole

         rts
d1414 1
a1414 3
         bsr.s     _DrawPropHole

         rts
d1421 1
a1421 2
         bsr.s     _DrawRectangle
         rts
@


0.30
log
@Quelsues changements cosmétiques dans _HProp
@
text
@d6 1
a6 1
* $Id: Gui.s 0.29 1997/09/16 21:57:53 MORB Exp MORB $
d1335 3
a1337 1
         bne.s     .FullKnob
d1347 1
a1347 2
         move.l    ge_Domain+gd_Width(a0),d0
         sub.l     #8,d0
d1350 3
a1352 1
         divu      ge_Data2+2(a0),d0
d1386 8
d1410 8
d1446 3
d1541 4
a1544 3
         mulu      ge_Data2+2(a0),d0
         move.l    ge_Domain+gd_Width(a0),d1
         subq.l    #8,d1
d1570 76
@


0.29
log
@Correction d'un bug dans _HProp()
@
text
@d6 1
a6 1
* $Id: Gui.s 0.28 1997/09/16 21:39:10 MORB Exp MORB $
d1369 8
d1378 5
a1382 5
         moveq     #2,d5
         moveq     #8,d7
         movem.l   ge_Temp2(a0),d4/d6
         moveq     #1,d3
         bsr.s     _DrawRectangle
d1386 8
a1393 2
         moveq     #2,d5
         moveq     #8,d7
d1395 2
d1542 1
@


0.28
log
@Correctage de quelques bugs
@
text
@d6 1
a6 1
* $Id: Gui.s 0.27 1997/09/16 21:27:12 MORB Exp MORB $
d1289 12
d1394 1
d1404 2
a1405 3
         sub.l     ge_Temp2(a0),d0
         addq.l    #2,d0
         move.l    d0,HPOffset
d1411 4
a1414 4
         move.l    d0,d1
         addq.l    #4,d0
         lsr.l     #1,d0
         move.l    d0,_MinMouseX
@


0.27
log
@Implémentation de RefreshGuiEntry()
@
text
@d6 1
a6 1
* $Id: Gui.s 0.26 1997/09/16 21:14:51 MORB Exp MORB $
d318 2
d328 2
d1354 1
d1443 2
d1446 1
@


0.26
log
@Ai fait _HProp. L'ai débuggé, aussi.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.25 1997/09/14 21:59:10 MORB Exp MORB $
d314 15
@


0.25
log
@Deux trois modifs dans _DragBar pour que le sélécteur ne disparaisse pas.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.24 1997/09/07 23:21:32 MORB Exp MORB $
d1269 226
@


0.24
log
@Corriju un bug dans Request().
@
text
@d6 1
a6 1
* $Id: Gui.s 0.23 1997/09/07 23:00:03 MORB Exp MORB $
d57 1
a57 1
         dc.w      $29+1,CET_BREAK
d125 2
d151 1
a151 1
         GENTRY    _SmallButton,"I",0
a209 1

d228 1
d231 3
a233 3
         lea       MouseSpr(pc),a0
         movem.w   d6-7,csp_X(a0)
         bsr       _RefreshSprite
d251 1
a251 1
         dc.l      50
d253 1
a253 1
         dc.l      240
d258 2
a259 2
MouseSpr:
         dc.l      _MouseSpriteDat,0
d1094 3
d1108 1
a1108 1
         move.l    #CopEnd,_GuiL1Ptr
d1140 3
d1147 2
d1159 14
d1174 2
d1220 13
d1265 4
d1310 2
a1311 2
         cmp.l     d2,d0
         bcc.s     .Skronk
d1539 2
@


0.23
log
@Inmpémentage de Request().
@
text
@d6 1
a6 1
* $Id: Gui.s 0.22 1997/09/07 22:10:59 MORB Exp MORB $
d127 1
@


0.22
log
@Nimplémentu classes _Text.
@
text
@d6 1
a6 1
* $Id: Gui.s 0.21 1997/08/31 18:15:28 MORB Exp MORB $
d83 84
d315 1
d353 1
@


0.21
log
@Adaptation de _Sprite aux nouvelles routines blitter
@
text
@d6 1
a6 1
* $Id: Gui.s 0.20 1997/08/31 17:56:35 MORB Exp MORB $
d389 1
d1053 87
d1405 1
@


0.20
log
@Adapation de DrawRectangle() aux nouvelles routines blitter
@
text
@d6 1
a6 1
* $Id: Gui.s 0.19 1997/08/27 18:39:23 MORB Exp MORB $
d1240 1
a1240 1
         sub.l     a0,a0
a1245 3
         moveq     #-1,d0
         not.w     d0
         move.l    d0,(a0)+
d1255 2
a1256 5
         lea       24(a0),a2
         move.w    d1,(a2)+
         move.w    d2,(a2)+
         move.w    d2,(a2)+
         move.w    d1,(a2)
d1267 2
a1269 3
         move.l    d3,(a0)+
         move.l    d4,(a0)+
         move.l    d7,(a0)
a1272 1
         addq.l    #8,a0
d1277 20
@


0.19
log
@Correction d'un bug débile dans les lignes de code nazes pré-citées
@
text
@d6 1
a6 1
* $Id: Gui.s 0.18 1997/08/27 18:28:52 MORB Exp MORB $
d1371 1
a1371 1
         lea       _RectHook,a0
d1376 1
a1376 1
         lea       _RectHook,a0
a1422 2
         addq.l    #4,a0
         addq.l    #4,a3
d1432 1
a1432 3
         move.l    d0,(a0)
         addq.l    #8,a0
         move.l    d0,(a0)
d1435 1
a1435 3
         move.l    d0,(a3)
         addq.l    #8,a3
         move.l    d0,(a3)
a1438 2
         addq.l    #8,a0
         addq.l    #8,a3
d1440 2
a1441 12
         lea       6(a0),a5
         lea       6(a3),a4
         move.w    d2,(a5)
         move.w    d2,(a4)
         addq.l    #4,a5
         addq.l    #4,a4
         move.w    d2,(a5)
         move.w    d2,(a4)

         moveq     #-1,d0
         move.w    d0,14(a5)
         move.w    d0,14(a4)
d1446 1
a1448 1
         move.w    d6,(a3)
d1453 16
@


0.18
log
@Implémentation du support de gestion des clicks dans la zone d'édition (cette description pompeuse désigne 5 lignes de codes toutes nazes :)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.17 1997/08/27 00:00:01 MORB Exp MORB $
d199 5
a204 1
         movem.l   _MouseX(pc),d0-1
@


0.17
log
@Correction d'un bug de layout dans _Selector
@
text
@d6 1
a6 1
* $Id: Gui.s 0.16 1997/08/26 15:19:42 MORB Exp MORB $
d176 2
d182 1
d184 1
a184 1
         move.l    _MouseX(pc),d0
a185 1
         move.l    _MouseY(pc),d1
d197 7
d205 1
a205 1
         bne.s     .BenNon
d208 1
a208 1
         beq.s     .BenNon
d212 1
a212 1
         bcs.s     .BenNon
d215 1
a215 1
         bcs.s     .BenNon
d219 1
a219 1
.BenNon:
@


0.16
log
@Implémentation partielle de _Selector et de _Sprite, et correction d'un bug mineur dans ChangeGui()
@
text
@d6 1
a6 1
* $Id: Gui.s 0.15 1997/08/25 13:35:47 MORB Exp MORB $
a90 2
         moveq     #127,d3
         moveq     #-127,d4
a684 2
         bsr.s     _ClearDomain

d844 1
a844 1
         jsr       (a1)
d964 1
a964 1
         jsr       (a1)
d1055 1
a1055 1
         dc.l      0
d1057 1
a1057 1
         dc.l      0
d1060 3
a1062 3
         move.l    #320,d0
         move.l    d0,ge_MinWidth(a0)
         move.l    d0,ge_MaxWidth(a0)
d1064 1
a1064 1
         moveq     #16,d0
d1067 88
a1154 2
         lea       ge_Size(a0),a1
         move.l    a1,ge_Next(a0)
d1164 24
d1191 28
a1218 1
_Sprite:       ; d6/d7=X,Y a3=SpriteData
d1272 19
@


0.15
log
@Evacuation des routines de tests dans un fichier à part (Test.s)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.14 1997/08/25 13:24:44 MORB Exp MORB $
d12 2
d16 2
d35 16
d56 1
a56 1
GuiP1:
a57 1
         ;dc.l      0,0
d61 5
d68 11
d222 2
d228 2
a229 4
         move.l    #255,d0
         move.l    d0,d1

         clr.l     _MinGuiPos
d233 1
d235 1
a236 1
.NoMax:
d271 1
a271 1
         move.w    d0,GuiP1
a283 1
         ;addq.l    #1,d0
d985 1
d1006 1
a1012 1
.Desactivate:
a1035 3
         move.l    _GuiPos(pc),d0
         move.l    d0,d1

d1037 1
a1037 1
         move.w    d0,GuiP1
d1053 86
@


0.14
log
@Suppression d'un bug débile dans ChangeGUI()
@
text
@d6 1
a6 1
* $Id: Gui.s 0.13 1997/08/25 12:27:39 MORB Exp MORB $
a8 97
;fs "_GuiTest"
_GuiTest:
         lea       .TGui(pc),a0
         bsr       _ChangeGui
         rts
.TGui:
         GENTRY    _VGroup,0,0

         GENTRY    _HGroup,0,0
         GENTRY    _SmallButton,"X",_Quit
         GENTRY    _SmallButton,"I",0
         GENTRY    _DragBar,tg1,0
         GEND

         GENTRY    _HGroup,0,0
         GENTRY    _Button,testgui,_GlouGui
         GENTRY    _Button,testspr,0   ;_GuiTestSpr
         GENTRY    _Button,clrspr,0    ;_GuiClrSpr
         GEND

         GENTRY    _Button,guiquit,_Quit

         GEND

tg1:
         dc.b      "COUIN - Debug menu",0
testgui:
         dc.b      "Test gui",0
testspr:
         dc.b      "Test sprite",0
clrspr:
         dc.b      "RefreshBuffer()",0
guiquit:
         dc.b      "Quitter",0
         even

_GlouGui:
         lea       .Test(pc),a0
         bsr       _ChangeGui
         rts

.Test:
         GENTRY    _VGroup,0,0

         GENTRY    _HGroup,0,0
         GENTRY    _SmallButton,"X",_GuiTest
         GENTRY    _SmallButton,"I",0
         GENTRY    _DragBar,tb1,0
         GEND

         GENTRY    _Empty,0,0

         GENTRY    _HGroup,0,0
         GENTRY    _Button,tb2,0
         GENTRY    _Button,tb3,0
         GENTRY    _Button,tb4,0
         GENTRY    _Button,tb5,0
         GENTRY    _Button,tb6,0
         GENTRY    _Button,tb7,0
         GEND

         GENTRY    _Empty,0,0

         GENTRY    _Button,tb8,0

;         GEND

         GENTRY    _Empty,0,0

         GENTRY    _HGroup,0,0
         GENTRY    _Button,tb2,0
         GENTRY    _Button,tb3,0
         GENTRY    _Button,tb5,0
         GENTRY    _Button,tb6,0
         GENTRY    _Button,tb7,0
         GEND

         GEND

tb1:
         dc.b      "COUIN - Gui de néssai. Klang.",0
tb2:
         dc.b      "Couin",0
tb3:
         dc.b      "Glonk glou glou glou",0
tb4:
         dc.b      "Paf",0
tb5:
         dc.b      "Schglubulu",0
tb6:
         dc.b      "Ga",0
tb7:
         dc.b      "Poupouf sguuuuuuuûûûû",0
tb8:
         dc.b      "Beuark.",0
         even
;fe
@


0.13
log
@Correction de problèmes de copperlistes
@
text
@d6 1
a6 1
* $Id: Gui.s 0.12 1997/08/25 11:17:46 MORB Exp MORB $
d11 35
d54 1
a54 1
         GENTRY    _SmallButton,"X",_Quit
d89 1
a89 1
         dc.b      "Schglubulululululululu gronk paf yek",0
d230 1
a230 1
         dc.l      155
d351 1
d361 1
@


0.12
log
@Implémentation de la DragBar, de quelques routines utiles, et correction de deux trois bugs dans les groupes
@
text
@d6 1
a6 1
* $Id: Gui.s 0.11 1997/08/25 08:23:00 MORB Exp MORB $
d99 1
a99 1
         dc.w      $29+150,CET_BREAK
a104 6
         dc.l      guibrk,0
GuiP2:
         dc.w      $29+151,CET_SHORT
         dc.l      bgcdat

guibrk:
d227 3
a229 1
         move.l    _CurrentGui(pc),a0
d253 1
a253 1
         move.l    #253,d0
d296 1
a296 1
         add.l     #$29,d0
a297 2
         addq.l    #1,d0
         move.w    d0,GuiP2
d302 1
a302 1
         move.l    #1,ge_Domain+gd_Top(a0)
d307 1
a307 1
         move.l    #253,d0
d310 1
a310 1
         addq.l    #1,d0
d1063 1
a1063 1
         add.l     #$29,d0
a1064 2
         addq.l    #1,d0
         move.w    d0,GuiP2
@


0.11
log
@La gestion des boutons est complète :))
@
text
@d6 1
a6 1
* $Id: Gui.s 0.10 1997/08/24 23:04:10 MORB Exp MORB $
d12 1
a12 10
         move.l    a0,_CurrentGui
         move.l    #2,ge_Domain+gd_Left(a0)
         move.l    #1,ge_Domain+gd_Top(a0)
         move.l    #GuiScreenWidth-2,ge_Domain+gd_Right(a0)
         move.l    #101,ge_Domain+gd_Bottom(a0)
         move.l    #GuiScreenWidth-4,ge_Domain+gd_Width(a0)
         move.l    #100,ge_Domain+gd_Height(a0)
         bsr       _GetMinMax
         bsr       _Layout
         bsr       _Render
d19 1
a19 1
         GENTRY    _SmallButton,"X",0
d21 1
a21 1
         GENTRY    _Button,tb1,0
d24 2
d35 2
d38 13
d95 20
d117 2
d151 5
a155 3
         tst.l     d6
         bpl.s     .XPos
         moveq     #0,d6
d158 4
a161 3
         cmp.l     #GuiScreenWidth/2,d6
         bcs.s     .XOk
         move.l    #GuiScreenWidth/2,d6
d165 3
a167 3
         tst.l     d7
         bpl.s     .YPos
         moveq     #0,d7
d170 3
a172 3
         cmp.l     #256,d7
         bcs.s     .YOk
         move.l    #256,d7
d183 6
d190 8
d211 4
d219 1
a219 1
         sub.l     #151,d1
d247 86
d425 1
d431 4
a434 1
         add.l     ge_MaxWidth(a0),d2
d459 5
d576 2
d579 1
a579 2
         bset      #31,d3
         not.l     d3
d585 4
a588 1
         add.l     ge_MaxHeight(a0),d3
d607 2
a608 2
         addq.l    #GuiVerSpacing,d0
         addq.l    #GuiVerSpacing,d2
d613 5
d1008 70
a1090 6
_ActiveThingHandler:
         ds.l      1
_ActiveGuiEntry:
         ds.l      1
_CurrentGui:
         ds.l      1
d1124 1
a1124 1
         subq.l    #1,d4
d1132 1
@


0.10
log
@Implémentation partielle de la gestion de l'interface
@
text
@d6 1
a6 1
* $Id: Gui.s 0.9 1997/08/24 21:27:27 MORB Exp MORB $
d152 1
a152 1
         dc.l      0
d154 1
a154 1
         dc.l      0
d165 14
a183 5
         move.l    _MouseX(pc),d0
         add.l     d0,d0
         move.l    _MouseY(pc),d1
         sub.l     #151,d1

d647 80
a726 3
         move.w    $dff006,$dff180
         btst      #2,$dff016
         bne.s     BClick
d728 4
d738 1
a738 1
         dc.l      0
d768 84
d866 4
d926 1
d1071 1
@


0.9
log
@Gestion du mouvement du hamster
@
text
@d6 1
a6 1
* $Id: Gui.s 0.8 1997/08/24 16:26:56 MORB Exp MORB $
d12 1
d17 1
a17 1
         move.l    #GuiScreenWidth-5,ge_Domain+gd_Width(a0)
d23 1
d25 1
a25 1
         dc.l      _VGroup,0,0,0,0,0,0,0,0,0,0,0,0,0
d27 14
a40 16
         dc.l      _HGroup,0,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _SmallButton,"X",0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _SmallButton,"I",0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,tb1,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      0,0,0,0,0,0,0,0,0,0,0,0,0,0

         ;dc.l      _Empty,0,0,0,0,0,0,0,0,0,0,0,0,0

         dc.l      _HGroup,0,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,tb2,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,tb3,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,tb4,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,tb5,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,tb6,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,tb7,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      0,0,0,0,0,0,0,0,0,0,0,0,0,0
d42 2
a43 1
         ;dc.l      _Empty,0,0,0,0,0,0,0,0,0,0,0,0,0
a44 2
         dc.l      _Button,tb8,0,0,0,0,0,0,0,0,0,0,0
         dc.l      0,0,0,0,0,0,0,0,0,0,0,0,0,0
a61 2


d163 23
d240 22
d268 1
d413 1
d567 21
d593 1
d636 6
d648 1
d684 1
d692 2
@


0.8
log
@Implémenation de SmallButton et correction vague de quelques bugs de layout
@
text
@d6 1
a6 1
* $Id: Gui.s 0.7 1997/08/24 14:23:11 MORB Exp MORB $
d89 76
@


0.7
log
@Implémentation des groupes verticaux
@
text
@d6 1
a6 1
* $Id: Gui.s 0.6 1997/08/24 14:12:24 MORB Exp MORB $
d23 1
a23 2
         dc.l      _VGroup,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,0,0,0,0,0,0,0,0,0,0,0,0
d25 38
a62 11
         dc.l      _HGroup,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      _Button,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      0,0,0,0,0,0,0,0,0,0,0,0,0


         dc.l      _Button,0,0,0,0,0,0,0,0,0,0,0,0
         dc.l      0,0,0,0,0,0,0,0,0,0,0,0,0
d174 1
d227 3
a229 1
         sf        d6
d245 1
a245 2
         st        d6
         bra.s     .Fixed
d256 1
a256 1
         st        d6
a262 5
         tst.b     d6
         beq.s     .Ok
         tst.l     d7
         bne.s     .BigLoop

d318 1
d370 3
a372 1
         sf        d6
d388 1
a388 2
         st        d6
         bra.s     .Fixed
d399 1
a399 1
         st        d6
a405 5
         tst.b     d6
         beq.s     .Ok
         tst.l     d7
         bne.s     .BigLoop

d454 9
a462 1
         moveq     #14,d0
d464 5
d470 1
d477 1
a477 1
         move.l    _CurrentDomain(pc),a0
d480 2
a481 2
         move.l    gd_Width(a0),d2
         move.l    gd_Height(a0),d3
d484 9
d495 3
a497 3
;fs "_Test"
_Test:
         dc.l      TGetMinMax
d499 1
a499 1
         dc.l      TRender
d501 2
a502 2
TGetMinMax:
         moveq     #20,d0
d504 3
a507 1
         move.l    d0,ge_MaxWidth(a0)
d514 2
a515 2
TRender:
         move.l    _CurrentDomain(pc),a0
d518 3
a520 3
         move.l    gd_Width(a0),d2
         move.l    gd_Height(a0),d3
         st        d4
d522 17
@


0.6
log
@Débuggage de HGroup. Le layout fonctionne :^)
@
text
@d6 1
a6 1
* $Id: Gui.s 0.5 1997/08/23 22:58:45 MORB Exp MORB $
d23 3
a27 1
         dc.l      _Test,0,0,0,0,0,0,0,0,0,0,0,0
d30 6
d123 1
a123 1
         dc.l      HGRender
d265 60
d326 88
a413 1
HGRender:
d434 1
a434 1
         moveq     #32,d0
d459 1
a459 1
         moveq     #32,d0
@


0.5
log
@Mise en place des routines de rendu pour HGroup et Button, et modification de DrawRectangle() et DrawChar() pour tenir compte du domaine
@
text
@d6 1
a6 1
* $Id: Gui.s 0.4 1997/08/23 22:36:51 MORB Exp MORB $
d11 18
a28 12
         ;move.l    #16,d5
         ;move.l    #20,d6
         ;move.l    #75,d4
         ;moveq     #70,d0
.Loop:
         ;moveq     #3,d3
         ;move.l    #1,d7
         ;bsr       _DrawRectangle
         ;addq.l    #1,d4
         ;addq.l    #1,d5
         ;addq.l    #1,d6
         ;dbf       d0,.Loop
a30 33
         move.l    #75,d0
         move.l    #16,d1
         move.l    #197,d2
         move.l    #59,d3
         sf        d4
         bsr       _DrawBevelBox


         moveq     #0,d6
         moveq     #10,d7
         moveq     #3,d4
         move.l    #0,d5
         lea       t,a5
         bsr       _DrawText

         ;moveq     #0,d6
         ;moveq     #1,d7
         ;moveq     #"A",d5
         ;moveq     #3,d4
         ;bsr       _DrawChar
         ;moveq     #16,d6
         ;bsr       _DrawChar

         moveq     #3,d3
         move.l    #75,d4
         move.l    #16,d5
         move.l    #197,d6
         move.l    #59,d7
         ;bsr       _DrawRectangle
         rts
t:
         dc.b      "Néssai de naffichage de texte."
ft:
d119 1
d157 1
d213 2
a220 1
         bra.s     .Fixed
d227 1
a227 1
         tst.l     d6
d235 1
a235 1
         moveq     #0,d0
d283 24
a306 1
         move.l    #200,d0
d314 1
a314 1
BRender:
d320 1
a320 1
         sf        d4
d326 1
a326 1
         rs.l      1
d333 3
a335 3
         move.l    _CurrentDomain(pc),a0
         move.l    gd_Width(a0),d6
         move.l    gd_Height(a0),d7
@


0.4
log
@Début d'implémentation des gadgets et du layout
@
text
@d6 1
a6 1
* $Id: Gui.s 0.3 1997/08/23 01:19:34 MORB Exp MORB $
d283 11
d316 7
d329 11
d382 4
d525 4
@


0.3
log
@Correction de DrawRectangle()
@
text
@d5 2
a6 2
* Gui for developpement version
* $Id: Gui.s 0.2 1997/08/22 18:28:19 MORB Exp MORB $
d33 1
a33 1
         moveq     #10,d6
d84 227
d326 1
a326 1
         bsr       _DrawRectangle
d331 1
a331 1
         bsr       _DrawRectangle
d339 1
a339 1
         bsr       _DrawRectangle
d344 1
a344 1
         bsr       _DrawRectangle
@


0.2
log
@Changement RCS ($Id)
@
text
@d6 1
a6 1
* $Id$
d29 1
a29 1
         st        d4
d136 2
a137 2
         move.l    a1,a3
         move.l    a2,a0
a153 1
         ;add.l     d4,d6
a199 1
         ;sub.l     d4,d6
d222 1
a222 1
         bsr       _AddBlitNode
a229 7
         move.w    $dff006,$dff180
         btst      #2,$dff016
         bne.s     _RectHook
.gu:
         btst      #2,$dff016
         beq.s     .gu

@


0.1
log
@Couin
@
text
@d6 1
a6 2
* $Revision$
* $Date$
@


0.0
log
@*** empty log message ***
@
text
@d2 1
a2 1
* CdBSian Obviously Universal & Interactive Nonsense (COUIN) v0.0
d6 2
@
