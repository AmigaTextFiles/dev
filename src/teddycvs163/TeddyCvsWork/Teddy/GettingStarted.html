<?xml version="1.0" encoding="UTF-8"?>
<!doctype html public "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Getting Started with glElite and Teddy
</title>
<style type="text/css">
	h2, h3 { font-family: Arial, Helvetica, sans-serif; }
	h2 { color: #eeee00; /*font-size: 18pt*/ }
	h3 { color: #00ee00; /*font-size: 16pt*/ }
	body {
		background: #000011
		color: #eeeeee; 
		margin-left: 4%; 
		margin_right: 2%;
	}
	a.toc, a.toc:visited {
/*		font-size: 12;*/
		font-weight: bold;
		color: #88eeee;
	}
	a:link    { font-family: Arial, Helvetica, sans-serif;  color: #66ee66 }
	a:visited { font-family: Arial, Helvetica, sans-serif;  color: #66eeaa }
	a:hover   { font-family: Arial, Helvetica, sans-serif;  color: #cceecc }
	a:active  { font-family: Arial, Helvetica, sans-serif;  color: #eeeeee }
/*	li li a { font-size: 12pt; } */
	p li em body, ul li, ul li li, body p {
		font-family: Georgia, "Times New Roman", Times, serif;
/*		font-size: 14pt; */
		text-align: justify;
	}
	em { color: #eeeeaa; }

</style>
</head>

<body text="#eeeeee" bgcolor="#000011

<center>
<table border="2" bordercolor="#eeee00"><tr><td>
<table border="0"><tr>
<td width="10%" border="0"></td>
<td width="80%" border="0">

<div style="color: #eecc88">
<p>
<i>
This document is last updated to state of Teddy version 1.63.
Please send me email to
<a href="mailto:tksuoran@cc.helsinki.fi">tksuoran@cc.helsinki.fi</a>
and tell me what things you have had trouble with, so I can improve
this text. Thank you.
</i>
</p>
</div>

<a id="toc" name="toc">
<h2>Getting Started with glElite and Teddy</h2>

<center>
<table border="1" bordercolor="#777700"><tr><td>
<h3>Table of Contents:</h3>
<ul>
<li><a href="#environment">Environment</a>
<li><a href="#registering">Registering<a/>
<li><a href="#files"      >Files</a>
<li><a href="#source_tree">Source tree</a>
<li><a href="#threads"    >Threads</a>
<li><a href="#status"     >Current status</a>
<li><a href="#faq"        >Frequently asked questions</a>
<ul>
<li><a href="#cvs"        >What is CVS, must I use it, and how do I do that?</a>
<li><a href="#configure"  >Problems with configure</a>
<li><a href="#compiling"  >Compiling problems</a>
<li><a href="#linking"    >Linking problems</a>
<li><a href="#running"    >Running problems</a>
<li><a href="#conventions">Coding conventions</a>
<li><a href="#copyright"  >Copyright issues</a>
<li><a href="#who"        >Who is making glElite / Teddy</a>
</ul>
</ul>
</td></tr></table>
</center>

<p>
This document describes briefly how to get started
working on this project. I will refer to this project
as 'Teddy' from now on; it will also cover anything
for glElite as well though. I will separate Teddy and
glElite documentation in near future.
</p>


<a id="environment" name="environment">
<a href="#toc" class="toc">ToC</a>
<h2>Notes about environment, library and tool requirements</h2>


<p>
Teddy is intendent to work on multiple platforms,
although only Win32 and linux environments have been
tested so far. FreeBSD and Amiga versions have been
known to be built at least once.
</p>

<p>
Teddy is written in C++, and uses STL, so you will
need a compiler which supports these; LCC for example
will not work. I have used Visual Studio 6 in Win32
environment and g++ in linux. Project and workspace
files are provided for Visual Studio 6, and configure
script is provided for linux. I have been trying to
make Teddy build with Cygwin / MingW as well, but so
far I have not succeeded.
</p>

<p>
Teddy depends on several libraries, which you need
before you can build Teddy. The SDL library is the
only absolutely required library. Others are optional,
but highly recommended.
</p>

<p>
The most important library is
<a href="http://www.libsdl.org/index.html">
the Simple Directmedia Library</a> - SDL.  On linux environment
SDL is easy to setup for development using standard
<em>configure && make && make install</em> procedure.
In Win32 it is best to use the libraries included in my
source release archive, or rebuild the library yourself.
You need to be familiar with building and installing libraries
and their headers. I recommend following settings for all
libraries: debug: 4 byte structure alignment, debug
multithreaded dll runtime libraries, release: 4 byte structure
alignment, multithreaded dll runtime libraries. That will make
sure the structures are compatible with SDL, and that the
runtime libraries are compatible with Teddy. Postfix debugging
versions of the libraries with 'D'.
</p>

<ul>
<li><a href="http://www.libsdl.org">SDL</a>
<li><a href="http://www.libsdl.org/projects/SDL_image/index.html">SDL_image</a>
<ul>
<li><a href="http://www.ijg.org/">libjpeg</a>
<li><a href="http://www.cdrom.com/pub/png/">libpng</a>
<li><a href="http://www.cdrom.com/pub/infozip/zlib/">libz</a>
</ul>
<li><a href="http://www.libsdl.org/projects/SDL_mixer/index.html">SDL_mixer</a>
</ul>

<p>
Windows users should notice that libjpeg, libpng and libz are
packed together with SDL_image. So if you are Windows developer,
you will only need SDL and optionally SDL_image and SDL_mixer.
</p>

<p>
Documentation for Teddy is generated using
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">Doxygen</a>.
Doxygen is not required to build and test Teddy, but reading
it's documentation of Doxygen might be a good idea, so that
you know how to place documentation into sourcecode. Doxygen is
only required to regenerate and update documentation from the
sourcecode.
</p>


<a id="registering" name="registering">
<a href="#toc" class="toc">ToC</a>
<h2>Registering at sourceforge and getting sources</h2>


<p>
First you should
<a href="http://sourceforge.net/account/register.php">
register yourself at sourceforge</a>
and let me know about you so I can add you to the team.
At the moment our team is small, and anyone who is willing
to contribute is welcome.
</p>

<p>
You should also join the
<a href="http://lists.sourceforge.net/mailman/listinfo/glelite-deve">
glElite developers mailinglist</a>.
There has been hardly any traffic at all there yet, so don't be
afraid of getting flooded. I would very much like to use the
mailing list for all glElite and Teddy related discussion as
primary forum and media.
</p>

<p>
To get started, you need sources. You can grab almost latest
source .zip or .tar.gz directly from
<a href="http://glelite.sf.net">the glElite web page</a>
for quick look (also remember to get the separate data file).
For any real work though you really should use the concurrent
version control system, CVS. If you are not familiar with CVS,
go to
<a href="http://cvsbook.red-bean.com/">The CVS Book</a>.
When you are more familiar with CVS (basics), you can access
<a href="https://sourceforge.net/cvs/?group_id=10281">Teddy CVS here</a>.
</p>


<a id="files" name="files">
<a href="#toc" class="toc">ToC</a>
<h2>Files in the source package</h2>


<p>
Files in Teddy are arranged as follows:
</p>


<ul>

<li><em>C++ source files</em> in Teddy/src should need no more explanation.

<li><em>Documentation files</em> in Teddy/src are mostly embedded into
sourcecode. Text files are in the root directory Teddy/ are sort of GNU
standard files, but I have not much experience about these.

<li><em>Project, workspace and build files</em> come in two
versions; for Win32 and for linux environment. You should not edit
Visual studio project or workspace files manually.

<li><em>Runtime data files</em> are required to actually run Teddy when
you have managed to build it. You must have these data files
in the current directory when you run Teddy, so you should copy the
executable to whereever you have the data files, and execute Teddy in
that directory. In Windows environment, the data files are in directory
named TeddyRelease, and Visual Studio project automatically places the
executable to that directory. In linux you will need to copy the executable
manually.
Notice that in some releases some data files may be copyrighted and not
distributed with the source.

<li><em>CVS files</em> must be left untouched; they contain important
version control information.

<li><em>Other files</em> contains at least the fix.sh
script file in the root directory. It can be used to convert
windows line endings to unix line endings. You should try to run this
if you have modified sources in Win32 environment. Theoretically CVS
should fix line endings properly, but I still need to use fix.sh.

</ul>


<a id="source_tree" name="source_tree">
<a href="#toc" class="toc">ToC</a>
<h2>Source tree</h2>


<p>
Once you have got your working copy of sources, browse
them. I have arranged sources into sub-directories, each
of which make up static library, which are linked together
with sources in the root source directory to make up the
executable.
</p>

<ul>

<li><em>Graphics</em> contains the lower part of graphics
rendering architecture of Teddy. Other parts are in several
other modules. You should at least know that PhysicalComponents
module has Projection class, which is responsible for applying
materials and rendering any 3D graphics. Note that while
some parts of OpenGL have been encapsulated into View class in
Graphics, there are still a lot of direct OpenGL calls all over
Teddy.

<li><em>Imports</em> contains object loaders, at the moment
from LightWave and experimental Frontier: First Encounters
ship model extractor. The FFE ship model extractor needs
data files which are not distributed with source. Some
lightwave ships are also not distributed with the source.

<li><em>Materials</em> contains lower part of material
architecture of Teddy. It also contains the initial
texture mapping routines. The upper part of material
architecture is implemented in Projection class of
PhysicalComponents module, and View class of Graphics
module.

<li><em>Maths</em> contains low level mathematical routines.
One of the oldest parts of Teddy. Some classes are written
in hurry and used for few things only.

<li><em>Models</em> contains the Model and ModelInstance
presentation and operations. The Model architecture in
Teddy is hierarchial. ModelInstance is a single instance
of some Mesh. Mesh represents the shape of some object
type. Mesh is (usually) made of Elements. For example,
LightWave objects are made of Face Elements. LineMesh is
made of Line Elements, etc. Mesh can also contain a submesh.
Each mesh has material information.

<li><em>PhysicalComponents</em> contains user interface
architecture for Teddy. This architecture contains an
optional full-featured (planned) windowing system and
some basic components. Most of it is work in progress. You
should know about the Projection class. The Area class is
baseclass for all user interface components, looking at it
wont hurt.

<li><em>Scenes</em> contains scene and camera related
stuff of Teddy.

<li><em>SysSupport</em> contains directory scanning
routines, precise (hopefully) timer code and type
definitions.

<li><em>Teddy</em> in the root source directory is the
main application. The UI class contains all highlevel
testing environment setup and runtime operations.

<li><em>TinyGL</em> is a small OpenGL subset software
renderer. The the platform has no native OpenGL support,
TinyGL will be used instead. It lacks some features like
alpha blending, but is still much better than no support
at all. Notice that MESA software rendering is external
to Teddy, and thus considered 'native'. MESA has alpha
blending, but TinyGL might be faster.

<li><em>UniverseDevelopmentKit</em> is Sean O'Neils
creation, which contains basic mathematics classes
and spherical ROAM algorithm. These sources are
maintained by Sean O'Neil, and I try to make as few
changes as possible to these sources.

</ul>


<a id="threads" name="threads">
<a href="#toc" class="toc">ToC</a>
<h2>Threads</h2>


<p>
Teddy uses two threads: the main thread, and simulation timer.
The main thread sits in a loop updating graphics display and
polling events, running as fast as possible (we might want to
add limit here on really superfast machine, no need to render
more frames that refresh frequence of monitor..).
</p>

<p>
The simulation thread maintains system time. It also processes
currently active events (keys pressed down etc) as updated by
the main thread. Events are forwarded to Input::FocusManager,
which eventually forwards events to individual physical user
interface components. Components then invoke user interface
logical actions, which are part of UI class in the testing
environment. Finally, the simulation thread updates physics
simulation.
</p>

<p>
At the moment there is very little concurrency management.
ModelInstances are can be locked. This is done by the
simulation update thread and some other routines which
access attitude etc. information.
</p>


<a id="status" name="status">
<a href="#toc" class="toc">ToC</a>
<h2>Current status</h2>


<p>
At the moment there is a lot of work that needs to be done. The list below
contains some things in unsorted order. Feel free to attack any of these
problems, and or list new ones! I am sure we can make this list a long one..
</p>

<ul>
<li>There is no game what so ever. Simple physics
    simulation with collision detection and laser beams
	might be fun to try; I think current version of Teddy
	has required features so that simple game protos could
	be placed on top of it.
	<br>
	<em>Update:</em>
	Open Dynamics Engine is now included with Teddy, but
	it is not used yet. Currently it does not support other
	forms than cube and sphere, so it would have only
	little use anyway.

<li>Physics simulation code is almost non-existent; there is
	simple collision checking working in progress, but no ships,
	no weapons.. One possibility
	to get some game would be to integrate <em>Christian Pinders
	Elite - The New Kind</em> into glElite. Elite - The New Kind
	has reverse-engineered C source for the original 8-bit Elite.
	The copyright issues of straight Elite conversions should
	be resolved though; it is unlikely that we could release
	glElite under any GNU license.

<lI>Rendering architecture should be improved so that it
    knows and uses vertex arrays (including compiled
	vertex arrays and NVidia stuffs) - At the moment Teddy
	uses very unoptimized rendering, no vertex arrays, not
	even displaylists. There is code for displaylists, which
	has been used before reworking materials.
	<br>
	<em>Update:</em>
	The ROAM code contains and uses vertex arrays, which
	also uses NVidia range and fence extensions, but only
	in Win32 when compiled with MSVC.

<li>The ROAM code has now been updated, now for a second time. It
	still needs some tuning, but it certainly is better now.

<li>Rendering architecture should be improved so that it
    knows how to get best performance when handling materials.
	Applying different material means OpenGL state change, which
	is usually slow; At the moment I try to group ModelInstances
	by material, but it simply does not work, because objects
	are hierarchial, and each submesh has it's own material.

<li>Rendering architecture should be improved so that it
	knows how to do multiple depth buffer passes, or something,
	to get rid of limited depth buffer precision.

<li>I would like to have alpha blending effects like explosions
	and engine glows added to the rendering architecture. Some of
	these need that vertices are manually projected to screen
	coordinates.
	
	<em>Update:</em>
	There is simple sprite support now in PostElement,
	but it does not work properly with the z-buffer
	for example.

<li>Texture support needs testing and improving.
	Multitexturing is not yet used.

<li><em>Update:</em>Smoothing meshes now uses
	improved routine which takes max smoothing angle
	into account for Lightwave objects.

<li>Linux configure etc. scripts should be reviewed and
	improved. I am not a linux expert, so the scripts
	are far from standard.

<li>A proper installer for both Win32 and linux would be nice;
	there is none for either at the moment.

<li>The physical user interface component class hierarchy is very
    experimental. It would be nice to get something robust out of it
	eventually. It might be a good idea to get some basic components
	working 'soon', as they potentially could help development.

<li>The existing code does not pay much attention to memory leaks
	(which are guaranteed to exist). Destructors should be properly
	implemented at some point.

<li>The whole source would benefit from refactoring.

<li>Documentation can always be improved.

</ul>


<a id="faq" name="faq">
<a href="#toc" class="toc">ToC</a>
<h2>Frequently asked questions about glElite / Teddy development</h2>


<a id="cvs" name="cvs">
<a href="#toc" class="toc">ToC</a>
<h3>What is CVS, must I use it, and how do I do that?</h2>


<p>
CVS is concurrent version control system. It maintains file
consistency when multiple users are working on the project
at same time. It even enables to users to modify same files
at the same time. <em>It is essential that everyone uses CVS when
working with Teddy</em>.
</p>

<p>
When you use CVS, everyone has his or her own <em>working copy</em>
of all files. Additionally there is a single <em>repository</em>,
which maintains official version of files. The repository is maintained
and located in Sourceforge. There are few important basic operations that
you need.
</p>

<p>
Two most important operations are <em>update</em> and <em>commit</em>.
Commit command compares your files to the reposity and sends the
changes you have made to the repository. Update commands gets the
latest versions of files from the reposity to your working copy.
The changes that others have committed are now in your working
copy.
</p>

<p>
You may wonder: If I make some changes and use update, will I
lose my changes? No. Good. Wait. What if someone else has also
changed the file, and committed changes before I have? Still
no problems; when you make commit, CVS may tries to merge your
changes. Sometimes it is not sure how this should be done, and
you may have to manually decide what to do; CVS commit will abort
and ask you to solve the conflict. Just open the file and edit it
so that it will build again. You will notice that CVS has included
both versions of parts that you both have changed.
</p>

<p>
You will have to manually <em>add</em> each new files to the CVS.
Same applies to <em>remove</em>. Note that CVS interpretes files
as text by default, and expects that it can make some changes to
the file. This means that binary files are effectively corrupted
by CVS unless you explicitly tell CVS that it should leavy this
file exactly as it is given. To do this, add files using -kb
options.
</p>

<p>
It would be a good convention to <em>always update before commit</em>,
and never do commit until you are sure that it builds without
any errors - at least on your favorite platform.
</p>


<a id="configure" name="configure">
<a href="#toc" class="toc">ToC</a>
<h3>Problems with configure</h3>


<p>
Windows and linux file systems are slightly incompatible. Some
times it may happen that files execution permission flags get
lost. You may have to chmod a+rx ./configure in order to be able
to execute ./configure
</p>

<p>
Additional trouble can be caused by different line endings. You
may have to run fix.sh in the root directory of Teddy to fix line
endings in all text files. Different line endings can cause many
different problems, so try this first if you get really weird and
unexpected error messages.
</p>

<p>
The configure script may have trouble locating SDL. This usually
means that you have not SDL installed, or you SDL is not in your
path (SDL contains configuration script which gets to path when
you install it), or your SDL is too old. It is also possible
(even likely if you have specific linux distribution and install
newer SDL manually) that you have several versions of SDL in your
system, and they mess up each other. At the moment I require SDL
1.2.2 or newer.
</p>

<p>
If you are trying to build Teddy on multiuser system where you
are not superuser, there might be SDL installed on the system,
but it might not be in the default path. Ask if SDL is present
and where it would be. You have also option to install your own
version of SDL using prefix option of SDL configure script. You
may get it work even on top of older version of SDL if you set
paths correctly.
</p>

<p>
It may happen that ./configure is totally missing too, or does not
work properly somehow (this is indicated by building problems). In
this case you may have to run <em>aclocal</em> and <em>autoconf</em>
which (re)generate the ./configure script.
</p>


<a id="compiling" name="compiling">
<a href="#toc" class="toc">ToC</a>
<h3>Compiling problems</h3>


<p>
Compiling may fail for several reasons. If you get errors about
SDL or other library includes in Win32 MSVC environment, you must
add SDL includes (also libs) to Tools/Options/Directories in Visual
Studio. In linux the ./configure -script usually makes sure SDL
and other libraries will work.
</p>

<p>
Compiling may also fail if for some reason platform dependent
code is tried to be built on alien platform. This will happen
when someone who has written the code has not been careful.
You will have to isolate the offending code and disable it for
your platform, or write implementation. I mean, you could, if
you wanted to. Usually you should just let me know.
</p>

<p>
Compiling may also fail just because there is error in the code.
This can happen when someone fixes the code when resolving CVS
</p>

<p>
Visual studio project and workspace files may be corrupted in
some weird way. This may happen when development takes place in
linux side and things change. You may need to add and or remove
files or even add new projects.
</p>

<p>
If you use the same directory on multiple machines, from network
filesystem, or simply pack and copy to other machine, or upgrade
you machine, you should remember to clean the old working files.
This problem is severe in linux environment; configure cache may
be incorrect for the new system; Makefile generated by configure may
be outdated, etc. In linux environment source dependencies are
generated by Makefile by scanning source directories for sources.
Thus if new files are added or got from CVS update, you will have
to make clean, maybe rerun configure and make sure Makefile is updated.
</p>


<a id="linking" name="linking">
<a href="#toc" class="toc">ToC</a>
<h3>Linking problems</h3>


<p>
In linux environment you may get errors about missing symbols even
though source code is fine and compiles without errors. It turns out
that gcc processes files <em>in the order which they are given</em> on
the command line. When gcc is linking libraries, it only picks those
symbols that have been referenced so far. This is why Maths library
currently is last in the list for gcc. It is possible that when sources
are edited, a new dependency is created, and the order of libraries
in the Makefile.in must be changed.
</p>

<p>
If you have not set up SDL and other libraries correctly you will
have problems with linking, too.
</p>

<p>
You will need SDL library. Other libraries, SDL_image and SDL_mixer,
are optional. SDL_image further requires libpng, libz, and libpng.
</p>


<a id="running" name="running">
<a href="#toc" class="toc">ToC</a>
<h3>Running problems</h3>


<p>
Teddy happily crashes if it can not find some crucial data files.
Teddy looks for all datafiles in current directory. The normal
./configure && make procedure in linux will copy Teddy executable
to the TeddyRelease directory, which is outside the CVS, but part
of the source archive. You must run Teddy there.
</p>

<p>
Notice that some release of Teddy / glElite do not all data files in
TeddyRelease directory within the LGPL source archive. Some
copyrighted Elite and or Frontier: First Encounters derived data files
are distributed separately. You can get the datafiles from the internet
address
</p>

<ul>
<li><a href="http://www.cs.helsinki.fi/u/tksuoran/data.tgz">
http://www.cs.helsinki.fi/u/tksuoran/data.tgz</a>
</ul>

<p>		
You can also use getdata.sh to download and unpack this file.
Contents of data.tgz are required to run Teddy if you want to
see Elite or Frontier: First Encounters ship models.
</p>

<p>
<em>Currently no such data is being used though.</em>
</p>


<a id="conventions" name="conventions">
<a href="#toc" class="toc">ToC</a>
<h3>Are there any coding conventions?</h3>


<p>
I would very much like that you would use real tabs for
indentation. And never use tabs for anything else.
It does not matter what value for tabs you use.
Linux kernel coding conventions have not yet figured
it out, but it is possible to write sourcecode which
looks perfectly good with variable tab settings. The way
to do it is to:
</p>

<ul>
<li>use tabs for indentation
<li>use tabs <em>only</em> for indentation
<li>don't use tabs to align something that needs spaces to align
</ul>

<p>
For other things (naming, layout..), you have two options.
Use consistently your own conventions; this is fine - or
look at my source code. It is not good example at some places,
but looking around here and there you should get the idea.
One thing is that I hate is prefixing class names with C,
but I can live with that if you really have to do it.
</p>

<p>
I would like to have one class per .h / .cpp file.
Large classes can be divided into several .cpp files.
</p>


<a id="copyright" name="copyright">
<a href="#toc" class="toc">ToC</a>
<h3>Copyright issues</h3>


<p>
Elite is copyrighted, and GNU licences do not allow to include
copyrighted material. Thus Teddy is under LGPL, but glElite is,
urm, well, under no license at all. There may be some lightwave
files in Teddywhich remotely look like Archimedes Elite ships,
but erm, we'll fix that. We should make separate distribution
on glElite and something..
</p>


<a id="who" name="who">
<a href="#toc" class="toc">ToC</a>
<h2>Who is making glElite / Teddy</h2>


<p>
The core of Teddy is written by Time Suoranta.
Sean O'Neil wrote the ROAM code and some data structures.
Russell L. Smith wrote Open Dynamics Engine.
Fabrice Bellard wrote TinyGL.
</p>


<td width="10%" border="0"></td>
</td></tr></table>
</td></tr></table>


</body>
</html>

