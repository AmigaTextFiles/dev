
CC = @gcc
LD = @g++
CFLAGS = -c -Wall -Wextra -Wwrite-strings
IFLAGS = -ISDK:Local/newlib/include/allegro
LFLAGS = -use-dynld -lallegro -lauto

ifdef DEBUG
	OBJ = Debug
	CFLAGS += -ggdb -D_DEBUG -DDEBUGMODE=1
	LFLAGS += -LDebug
else
	OBJ = Release
	CFLAGS += -O2
	LFLAGS += -LRelease
endif

EXECUTABLE = $(OBJ)/exhello

OBJECTS = $(OBJ)/exhello.o

All: $(OBJ) $(EXECUTABLE)

$(OBJ):
	@MakeDir $(OBJ)

$(EXECUTABLE): $(OBJECTS)
	@echo Linking $@...
	$(LD) $(OBJECTS) $(LFLAGS) -o $@.debug
	@strip -S --strip-unneeded $@.debug -o $@

$(OBJ)/%.o: %.c
	@echo Compiling $<...
	$(CC) $(CFLAGS) $(IFLAGS) -o $(OBJ)/$*.o $<

clean:
	@rm -fr $(OBJ)
