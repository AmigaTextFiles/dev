#GTLV_SHOWSELECTED=$80080035 : #GTLV_SELECTED=$80080036 : #GTLV_TOP=$80080005 : #GTSL_MAX=$80080000+39
#GTSL_MAXLEVELLEN=$80080000+41 : #GTSL_LEVELFORMAT=$80080000+42 : #GTSL_LEVELPLACE=$80080000+43 : #GTSL_LEVEL=$80080028
#MOUSEMOVE=$10 : #INTUITICKS=$400000

x$="$VER: AntyDresiarz Issue 1 v2.0 by Taski (30.03.97)"
x$=""
Dim A_DYSK$(2),DYSK(500)
A_DYSK$(1)="AntyDresiarz1-1:"
A_DYSK$(2)="AntyDresiarz1-2:"
If Exists("DON'T_KASOWAC")<>0 Then A_DYSK$(1)="" : A_DYSK$(2)=""

WBStartup
WbToScreen 0
WBenchToFront_
NoCli
Use Screen 0

Dim Czcionka$(10),CzcionkaY(10)
MakeDir "RAM:AD_TMP"
Gosub WCZYTAJ_PREFS
Gosub INICJALIZACJA
Gosub OTWORZ_PANEL
Gosub INICJALIZUJ_MENU
Gosub MENU
Gosub WYSWIETL_TEKST

POCZATEK:
Repeat : ev = WaitEvent
  Gosub MENU
Until ev=$200 AND EventWindow = 1

Gosub WYJSCIE

.INICJALIZACJA
AddIDCMP #MOUSEMOVE+#INTUITICKS
LoadPalette 1,A_DYSK$(1)+"RYSUNKI/DATA/PALETA.CMA"
If CheckAGA=True : Bitplany=7 : AGA=1 : Else : Bitplany=4 : EndIf
Execute_ "C:SetPatch >NIL:",0,0
If OTWIERAC_NA_WB=0
   #_Quiet= $80000038
   #_Wid=   $80000023 ; width
   #_Hei=   $80000024 ; height
   #_Mod=   $80000032 ; mode
   #_DP=    $80000026 ;detailpen
   #_Dep=   $80000025 ; depth
   #_BP=    $80000027 ; blockpen
   #_Typ=   $8000002d ; type
   #_LWB=   $80000047 ; like WorkBench
   #Pens=   $8000003A ; pens

NEWTYPE .pens : a.w : b.w : c.w : d.w : e.w : f.w : g.w : h.w : i.w : j.w : k.w : l.w : m.w : n.w : End NEWTYPE

pp.pens\c=1 ; Text on background
pp.pens\d=2 ; Bright edge on 3d objects
pp.pens\e=1 ; Dark edge on 3d objects
pp.pens\f=3 ; activew window/select gadgetfill
pp.pens\g=1 ; text over FILLPEN (filltextpen)
pp.pens\h=0 ; Backgroundpen
pp.pens\i=2 ; Special colour text
pp.pens\j=1 ; Text/deail in screen-bar/menus
pp.pens\k=2 ; Screenbar/menusfill
pp.pens\l=1 ; Trim under screenbar
pp.pens\m=12 ; Number of pens
pp.pens\n=1 ; Do I need it?

ScreenTags 1,"Antydresiarz by Taski.",#_Wid,640,#_Hei,256,#_Mod,ScrMode.l,#_Dep,Bitplany,#Pens,&pp
;  Screen 1,0,0,640,256,Bitplany,$8000,"Antydresiarz by Taski.",0,0 : Use Screen 1
  Wysokosc_Ekranu=256
Else
  Use Screen 0
  Wysokosc_Ekranu=WBHeight
  t$="Twoj WorkBench jest odpalony w malej liczbie kolorow !"+Chr$(10)
  t$=t$+"Jezeli chcesz ogladac AntyDresiarza w pelni jego uroku,"+Chr$(10)
  t$=t$+"to musisz odpalic WorkBencha w minimum 128 kolorach."+Chr$(10)
  t$=t$+"Jezeli tego nie zrobisz, to zobaczysz ...?... ."+Chr$(10)
  If WBDepth<6 Then malokol=Request ("AntyDresiarz informuje...",t$,"Zaladuj ScreenMode Preferences|Lubie szkaradna grafike")
  If malokol=1
    Execute_ "SYS:PREFS/SCREENMODE",0,0
    End
  EndIf
  t$=""
  Dim R(128),G(128),B(128)
  If AGA=0 AND WBDepth=>7 Then AGA=1
  For x=0 To 127 : R(x)=Red(x):G(x)=Green(x):B(x)=Blue(x) : Next x
  OTWARTE_NA_WB=1
EndIf

NEWTYPE.lv : a.w : b.s : End NEWTYPE
Dim Pozycja_strony.l(500)
Dim Kolor_strony(500)       ; kolor na poczatku strony
Dim Czcionka_strony(500)
Dim Styl_czcionki(500)
Dim Nazwa_modulu$(5),Pliki$(500),List Lista_Menu.lv(500),List Krotki_opis.lv(500)
Gosub OKNO_INITU
Gosub DEMO
Use Palette 1

y=Wysokosc_Ekranu-(offt+offt+2+(Wysokosc_panelu/2)+1)
WSize 640,y ;640,189

Return

.INICJALIZUJ_MENU
  x=OpenFile(1,A_DYSK$(1)+"TEKSTY/DATA/MENU.TXT")
  FileInput 1
  Belka_ekranu$=Edit$(256)
  Belka_okna$=Edit$(256)

  Repeat
    x=x+1 : Menu$=Edit$(256)
    If Menu$<>"" Then AddItem Lista_Menu() : Lista_Menu()\b=Menu$ : Ilosc_pozycji_w_menu=Ilosc_pozycji_w_menu+1
    Pliki$(x)=Edit$(256)
    DYSK(x)=Val(Right$(Pliki$(x),1))
    Pliki$(x)=Left$(Pliki$(x),Len(Pliki$(x))-2)
  Until Loc(1)=Lof(1)
  CloseFile 1

  Use IntuiFont 2
  ywin=Wysokosc_Ekranu-(offt+offt+2+(Wysokosc_panelu/2))-(offt-2)-20-11

  GTTags #GTLV_SHOWSELECTED,0
  GTListView 1,10,15,20,450,ywin,"Wybierz artykul",32,Lista_Menu()
  GTListView 1,11,465,20,150,ywin,"Krotki opis",32,Krotki_opis() ; y=170


  x=OpenFile(1,A_DYSK$(1)+"TEKSTY/DATA/MODULY.TXT")
  FileInput 1

  Repeat
    x=x+1 : Menu$=Edit$(256)
    If Menu$<>"" Then Nazwa_modulu$(x)=Menu$
  Until Loc(1)=Lof(1)
  CloseFile 1

Return

.OKNO_INITU
Window 4,50,50,450,100,0,"AntyDresiarz",0,0
LoadFont 0,"topazpl.font",8 : WindowFont 0
NPrint "Sprawdzam mozliwosci twojej maszynki..."
NPrint ""

NPrint "Procesor:    680",Processor,0
If CheckAGA=True : x$="AGA" : Else : x$="ECS" : EndIf
If CheckAGA=False AND WBDepth>4 Then x$="Karta graficzna"
NPrint "Kosci:       ",x$
NPrint "Chip:        ",ChipFree
NPrint "Fast:        ",FastFree
NPrint ""
If Processor<3 Then NPrint "Procesorek to masz slaby jak na dzisiejsze czasy."
If Processor=3 Then NPrint "Procesor jest ok, ale przydalby sie lepszy..."
If Processor=>4 Then NPrint "Nareszcie jakas dopalona Amiga..."
  offt=WTopOff
  offl=WLeftOff
  offd=WindowHeight-(InnerHeight+offt)
  offr=WindowWidth-(InnerWidth+offl)
  VWait 100

  CloseWindow 4
Return

.MENU
  ; - - - - - - - -- - - - - ---------------- WORKING - WYPIERDOLIC !
;  PalRGB 1,63,Red(7),Green(7),Blue(7)
;  PalRGB 1,62,Red(6),Green(6),Blue(6)
;  PalRGB 1,61,Red(5),Green(5),Blue(5)
;  PalRGB 1,60,Red(4),Green(4),Blue(4)
;  Use Palette 1
  ; ----

  Use Window 0 : Use IntuiFont 2
  WTitle Belka_okna$+" - Menu",Belka_ekranu$

  BitOkno=0 : Numer_tla=2 : Gosub PATTERN
  il_lini=(ywin-4)/CzcionkaY(2) : illi$=Str$(il_lini) : i=Instr(illi$,".") : il_lini=Val(Left$(illi$,i))

  WBox offl+15,offt+20,offl+614,offt+23+(il_lini*CzcionkaY(2)),0
  GTTags #GTLV_SHOWSELECTED,0
  AttachGTList 1,0

  GTBevelBox 1,offl,offt,InnerWidth,InnerHeight,0
  Gosub CZYSC_ZMIENNE : Tytul_artykulu$="Menu" : Aktualna_strona=1

  Repeat : ev = WaitEvent : Gosub CZAS
  If ev=$40
    Select GadgetHit
      Case 1 : WTitle "Do wyboru artkow sluzy listview !!!",Belka_ekranu$
      Case 2 : WTitle "Wybierz artek i kliknij na nim !!!",Belka_ekranu$
      Case 4 : WTitle "Bardziej w lewo sie nie da !!!",Belka_ekranu$
      Case 5 : WTitle "Kliknij sobie w pysk !!!",Belka_ekranu$
      Case 3 : WTitle "Przecierz jestes w indexie !!!",Belka_ekranu$
      Case 6 : Gosub MUZYKA_PREFS
      Case 7 : Gosub PREFS
      Case 10
        Wskazany_podstawa$=Pliki$(EventCode)
        Wskazany_tekst$=A_DYSK$(DYSK(EventCode))+"TEKSTY/"+Pliki$(EventCode)+".TXT"
        Gosub KROTKI_OPIS_ART
        If WSKAZANY=EventCode AND NOT Left$(Wskazany_podstawa$,2)="--"
         If Exists(Wskazany_tekst$) Then DetachGTList 1 : Gosub WYSWIETL_TEKST : Goto POCZATEK
        EndIf
        WSKAZANY=EventCode
    End Select
  EndIf
  Until ev=$200 AND EventWindow = 1
  Gosub WYJSCIE

Return

.KROTKI_OPIS_ART
  ClearList Krotki_opis()
  If Exists(A_DYSK$(DYSK(EventCode))+"TEKSTY/"+Wskazany_podstawa$+".SHR")<>0
    x=OpenFile(1,A_DYSK$(DYSK(EventCode))+"TEKSTY/"+Wskazany_podstawa$+".SHR")
    If NOT x=0
    FileInput 1
    Repeat
      AddItem Krotki_opis() : Krotki_opis()\b=Edit$(256)
    Until Loc(1)=Lof(1)
    CloseFile 1
    GTChangeList 1,11,Krotki_opis()
    EndIf
  EndIf
Return

.WYSWIETL_TEKST
  ROZPAKOWANE$="RAM:AD_TMP/ANTYDRESIARZ-ARTEK"
  If Exists(ROZPAKOWANE$) Then x=DeleteFile_(ROZPAKOWANE$) : If x=0 Then CloseFile 1 : x=DeleteFile_(ROZPAKOWANE$)
  DO_ROZPAKOWANIA$=Wskazany_tekst$ : Gosub ROZPAKUJ : Wskazany_tekst$=ROZPAKOWANE$
  If Wskazany_tekst$=DO_ROZPAKOWANIA$
    x=CopyFile (DO_ROZPAKOWANIA$,"RAM:AD_TMP/ANTYDRESIARZ-ARTEK")
    Wskazany_tekst$="RAM:AD_TMP/ANTYDRESIARZ-ARTEK"
  EndIf

  If OBRAZKI_RAM=1
    For x=1 To 255
      x$=Left$("000",3-Len(Str$(x)))+Str$(x)
      If Exists("RAM:AD_TMP/"+x$) Then DeleteFile_("RAM:AD_TMP/"+x$)
      Rx$=A_DYSK$(DYSK(WSKAZANY))+"RYSUNKI/"+Wskazany_podstawa$+"/"+x$
      If Exists(Rx$) Then CopyFile Rx$,"RAM:AD_TMP/"+x$
    Next x
  EndIf

  x=OpenFile (1,Wskazany_tekst$)
  If x=0 Then Request "Blad","Nie moge odczytac artykulu !","Ok" : Return

  FileInput 1
  Tytul_artykulu$=Edit$(256)
  Numer_tla=1 : Znak_zmiany$=Edit$(256) : Gosub ZNAK_ZMIANY
  WindowFont 1 : NR_Czcionki=1 : STYL_Czcionki=0
  BitOkno=0 : Gosub PATTERN

  Pozycja_strony.l(Aktualna_strona)=Loc(1)
  Kolor_strony(Aktualna_strona)=Kolor_napisu
  Czcionka_strony(Aktualna_strona)=NR_Czcionki
  Styl_czcionki(Aktualna_strona)=STYL_Czcionki

POCZATEK_NOWEJ_STRONY:
  WTitle Belka_okna$+" - "+Tytul_artykulu$+", Strona: "+Str$(Aktualna_strona),Belka_ekranu$
  WLocate 0,0 : WJam 0
For i=0 To 1000
  FileInput 1 : Txt$=Edit$(256) : Use Window 0

  A=0 : B=0 : POZ=0 : POZ_PETLA=0
  POCZATEK_WYSWIETLANIA:
  Repeat
    POZ=B
    A=Instr(Txt$,Chr$($1B),B)
    B=Instr(Txt$,Chr$($1B),A+1)

    If A=>1 AND B>1 ; Checked !!!
      If POZ_PETLA=0 Then Print Left$(Txt$,A-1) : POZ_PETLA=1
      Znak_zmiany$=Mid$(Txt$,A,5) : Gosub ZNAK_ZMIANY : Print Mid$(Txt$,A+5,B-(A+5)) : Txt$=Mid$(Txt$,B) : B=1
      Goto POCZATEK_WYSWIETLANIA
    EndIf

    If A=>1 AND B=0 AND A+4<>Len(Txt$) ; Checked !!!
      If POZ_PETLA=0 Then Print Left$(Txt$,A-1) : POZ_PETLA=1
      Znak_zmiany$=Mid$(Txt$,A,5) : Gosub ZNAK_ZMIANY
        If WCursY+CzcionkaY(NR_Czcionki)<InnerHeight
          Print Mid$(Txt$,A+5,Len(Txt$)-A)
        Else
          FileSeek 1,Loc(1)-Len(Mid$(Txt$,A+5,Len(Txt$)-A))-1
        EndIf
      Goto KONIEC_WYSWIETLANIA
    EndIf

    If A=>1 AND B=0 AND A+4=Len(Txt$) ; Checked !!!
      Print Left$(Txt$,Len(Txt$)-5) : Znak_zmiany$=Mid$(Txt$,A,5) : Gosub ZNAK_ZMIANY : Goto KONIEC_WYSWIETLANIA
    EndIf

    If A=0 AND B=0
       Print Mid$(Txt$,POZ,Len(Txt$)-POZ) : Goto KONIEC_WYSWIETLANIA
    EndIf

  Until B=0
  KONIEC_WYSWIETLANIA:
  NPrint ""
  If WCursY+CzcionkaY(NR_Czcionki)>InnerHeight Then Gosub PETLA_WYSWIETLANIA
Next i
  Gosub PETLA_WYSWIETLANIA
CloseFile 1
Return

.PETLA_WYSWIETLANIA
  Aktualna_strona=Aktualna_strona+1
  Pozycja_strony.l(Aktualna_strona)=Loc(1)
  Kolor_strony(Aktualna_strona)=Kolor_napisu
  Czcionka_strony(Aktualna_strona)=NR_Czcionki
  Styl_czcionki(Aktualna_strona)=STYL_Czcionki

  Repeat : ev = WaitEvent : Gosub CZAS
  If ev = 1024
    Select EventCode
      Case 78 ; prawo       ; blad
        If Eof(1)=0
          BitOkno=0 : Gosub PATTERN
          Goto POCZATEK_NOWEJ_STRONY
        EndIf
      Case 79 ; lewo
        If Aktualna_strona>2
          BitOkno=0 : Gosub PATTERN
          Aktualna_strona=Aktualna_strona-2
          FileSeek 1,Pozycja_strony.l(Aktualna_strona)
          WColour Kolor_strony(Aktualna_strona)
          WindowFont Czcionka_strony(Aktualna_strona),Styl_czcionki(Aktualna_strona)
          Goto POCZATEK_NOWEJ_STRONY
        EndIf
      Case 76 ; gora
        WSKAZANY=WSKAZANY-1 : If WSKAZANY=-1 Then WSKAZANY=Ilosc_pozycji_w_menu
        Wskazany_podstawa$=Pliki$(WSKAZANY)

        If NOT Left$(Wskazany_podstawa$,2)="--"
          Wskazany_tekst$=A_DYSK$(DYSK(WSKAZANY))+"TEKSTY/"+Pliki$(WSKAZANY)+".TXT" : Aktualna_strona=1 : Gosub WYSWIETL_TEKST
        Else
          WSKAZANY=WSKAZANY-1 : If WSKAZANY=-1 Then WSKAZANY=Ilosc_pozycji_w_menu-1
          Wskazany_tekst$=A_DYSK$(DYSK(WSKAZANY))+"TEKSTY/"+Pliki$(WSKAZANY)+".TXT" : Wskazany_podstawa$=Pliki$(WSKAZANY)
          Aktualna_strona=1 : Gosub WYSWIETL_TEKST
        EndIf
      Case 77 ; dol
        WSKAZANY=WSKAZANY+1 : If WSKAZANY=Ilosc_pozycji_w_menu Then WSKAZANY=0
        Wskazany_podstawa$=Pliki$(WSKAZANY)

        If NOT Left$(Wskazany_podstawa$,2)="--"
          Wskazany_tekst$=A_DYSK$(DYSK(WSKAZANY))+"TEKSTY/"+Pliki$(WSKAZANY)+".TXT" : Aktualna_strona=1 : Gosub WYSWIETL_TEKST
        Else
          WSKAZANY=WSKAZANY+1
          Wskazany_tekst$=A_DYSK$(DYSK(WSKAZANY))+"TEKSTY/"+Pliki$(WSKAZANY)+".TXT" : Wskazany_podstawa$=Pliki$(WSKAZANY)
          Aktualna_strona=1 : Gosub WYSWIETL_TEKST
        EndIf
    End Select
  EndIf

  If ev=$40
    Select GadgetHit
      Case 1 ; dol
        WSKAZANY=WSKAZANY+1 : If WSKAZANY=Ilosc_pozycji_w_menu Then WSKAZANY=0
        Wskazany_podstawa$=Pliki$(WSKAZANY)

        If NOT Left$(Wskazany_podstawa$,2)="--"
          Wskazany_tekst$=A_DYSK$(DYSK(WSKAZANY))+"TEKSTY/"+Pliki$(WSKAZANY)+".TXT" : Aktualna_strona=1 : Gosub WYSWIETL_TEKST
        Else
          WSKAZANY=WSKAZANY+1
          Wskazany_tekst$=A_DYSK$(DYSK(WSKAZANY))+"TEKSTY/"+Pliki$(WSKAZANY)+".TXT" : Wskazany_podstawa$=Pliki$(WSKAZANY)
          Aktualna_strona=1 : Gosub WYSWIETL_TEKST
        EndIf
      Case 2 ; gora
        WSKAZANY=WSKAZANY-1 : If WSKAZANY=-1 Then WSKAZANY=Ilosc_pozycji_w_menu
        Wskazany_podstawa$=Pliki$(WSKAZANY)

        If NOT Left$(Wskazany_podstawa$,2)="--"
          Wskazany_tekst$=A_DYSK$(DYSK(WSKAZANY))+"TEKSTY/"+Pliki$(WSKAZANY)+".TXT" : Aktualna_strona=1 : Gosub WYSWIETL_TEKST
        Else
          WSKAZANY=WSKAZANY-1 : If WSKAZANY=-1 Then WSKAZANY=Ilosc_pozycji_w_menu-1
          Wskazany_tekst$=A_DYSK$(DYSK(WSKAZANY))+"TEKSTY/"+Pliki$(WSKAZANY)+".TXT" : Wskazany_podstawa$=Pliki$(WSKAZANY)
          Aktualna_strona=1 : Gosub WYSWIETL_TEKST
        EndIf
      Case 4
      If Aktualna_strona>2
        BitOkno=0 : Gosub PATTERN
        Aktualna_strona=Aktualna_strona-2
        FileSeek 1,Pozycja_strony.l(Aktualna_strona)
        WColour Kolor_strony(Aktualna_strona)
        WindowFont Czcionka_strony(Aktualna_strona),Styl_czcionki(Aktualna_strona)
        Goto POCZATEK_NOWEJ_STRONY
      EndIf
      Case 5
      If Eof(1)=0                 ; GURU 1111 z Lof(1)
        BitOkno=0 : Gosub PATTERN
        Goto POCZATEK_NOWEJ_STRONY
      EndIf
      Case 3
        CloseFile 1 : Goto POCZATEK
      Case 6
        Gosub MUZYKA_PREFS
      Case 7
        Gosub PREFS
    End Select
  EndIf
  Until ev=$200 AND EventWindow = 1
  Gosub WYJSCIE
Return

.ZNAK_ZMIANY
  Kod=Val(Mid$(Znak_zmiany$,3,2))
  Kod$=Mid$(Znak_zmiany$,3,2)
  Litera$=Mid$(Znak_zmiany$,5,1)

  If Litera$="m"
    If Kod=>30 AND Kod<50
      Kolor_napisu=Kod-30
      WColour Kod-30
    EndIf

    If Kod=>20 AND Kod<30
      WindowFont (Kod-20)+1 : NR_Czcionki=(Kod-20)+1
    EndIf

    ;1-podkresl,2-Bold,3-podkbold,4-kursywa,5-podkkurs,6-Boldkurs,7-podboldkur
    If Kod=0 Then WindowFont NR_Czcionki,0 : STYL_Czcionki=0
    If Kod=1 Then WindowFont NR_Czcionki,1 : STYL_Czcionki=1
    If Kod=2 Then WindowFont NR_Czcionki,2 : STYL_Czcionki=2
    If Kod=3 Then WindowFont NR_Czcionki,4 : STYL_Czcionki=4
    If Kod=4 Then WindowFont NR_Czcionki,3 : STYL_Czcionki=3
    If Kod=5 Then WindowFont NR_Czcionki,5 : STYL_Czcionki=5
    If Kod=6 Then WindowFont NR_Czcionki,6 : STYL_Czcionki=6
    If Kod=7 Then WindowFont NR_Czcionki,7 : STYL_Czcionki=7
    If WCursY+CzcionkaY(NR_Czcionki)>InnerHeight Then FileSeek 1,Loc(1)-Len(Txt$)-1 : Gosub PETLA_WYSWIETLANIA
EndIf

  If Litera$="p" OR Litera$="r" OR Litera$="s" OR Litera$="t"
    Rysunek=Val("$"+Kod$)
    Rysunek$=Left$("000",3-Len(Str$(Rysunek)))+Str$(Rysunek)
    If OBRAZKI_RAM=0
      Rysunek$=A_DYSK$(DYSK(WSKAZANY))+"RYSUNKI/"+Wskazany_podstawa$+"/"+Rysunek$
    Else
      Rysunek$="RAM:AD_TMP/"+Rysunek$
    EndIf

;    ROZPAKOWANE$="RAM:"+Str$(Rysunek)
;    If Exists(ROZPAKOWANE$)<=0
;      DO_ROZPAKOWANIA$=Rysunek$ : Gosub ROZPAKUJ : Rysunek$=ROZPAKOWANE$
;      If Rysunek$=DO_ROZPAKOWANIA$
;        x=CopyFile (DO_ROZPAKOWANIA$,"RAM:"+Str$(Rysunek))
;        Rysunek$="RAM:"+Str$(Rysunek)
;      EndIf
;    Else
;      Rysunek$="RAM:"+Str$(Rysunek)
;    EndIf

    If ILBMInfo (Rysunek$)
      Szerokosc=ILBMWidth
      Wysokosc=ILBMHeight
      If WCursY+Wysokosc>InnerHeight Then FileSeek 1,Loc(1)-Len(Txt$)-1 : Gosub PETLA_WYSWIETLANIA
      Bitplany=ILBMDepth
      If Bitplany<=5 Then Bitplany=6

      InitBank 1,FileSize(Rysunek$),65536
      x=BLoad (Rysunek$,Bank(1))
      LoadPalette 2,Rysunek$
      BitMap 1,Szerokosc,Wysokosc,Bitplany
      DecodeILBM 1,Bank(1) : ;DecodePalette 2,Bank(1)
      Erase 1

      Use Palette 1

    If INTERLACE_FONTS=1
      For i=0 To (Wysokosc*2)-2 Step 2
        BitMaptoWindow 1,0,0,i/2,WCursX+offl,WCursY+offt+i,Szerokosc,1
        BitMaptoWindow 1,0,0,i/2,WCursX+offl,WCursY+offt+i+1,Szerokosc,1
      Next i
    Else
      BitMaptoWindow 1,0,0,0,WCursX+offl,WCursY+offt,Szerokosc,Wysokosc
      BitMap 1,1,1,1
    EndIf

      If AGA=1 AND Bitplany>5
        For x=0 To 95 : PalRGB 2,x,Red(x),Green(x),Blue(x) : Next x
        DuplicatePalette 2,1 : Use Palette 1
      EndIf

      If Litera$="p" Then WLocate WCursX+Szerokosc,WCursY

      If INTERLACE_FONTS=1
        If Litera$="r" Then WLocate WCursX+Szerokosc,WCursY+Wysokosc*2
        If Litera$="s" Then WLocate WCursX,WCursY+Wysokosc*2
      Else
        If Litera$="r" Then WLocate WCursX+Szerokosc,WCursY+Wysokosc
        If Litera$="s" Then WLocate WCursX,WCursY+Wysokosc
      EndIf

    EndIf
  EndIf

  If Litera$="x"
    WLocate Val("$"+Kod$),WCursY
  EndIf

  If Litera$="y"
    If Kod$="NP"
      WLocate WCursX,InnerHeight+CzcionkaY(NR_Czcionki)
    Else
      WLocate WCursX,Val("$"+Kod$)
    EndIf
  EndIf

  If Litera$="X"
    WLocate Val("$"+Kod$)*5,WCursY
  EndIf

  If Litera$="Y"
    WLocate WCursX,Val("$"+Kod$)*5
  EndIf

  If Litera$="z"
    Ladowany_modul$=Str$(Kod) : Gosub LADUJ_MODUL
  EndIf

  If Litera$="b"
    Numer_tla=Val("$"+Kod$)
  EndIf

  If Litera$="l"
    If Kod$="HR"
      WBox offl+5,WCursY+offt+4,640-offl-offl-5,WCursY+offt+4,1
      WBox offl+5,WCursY+offt+5,640-offl-offl-5,WCursY+offt+5,2
      WLocate WCursX,WCursY+6
    EndIf
  EndIf

  If Litera$="N" AND Kod$="CE"
    TxtDlug$=Right$(Txt$,Len(Txt$)-5)
    WLocate (InnerWidth-TextLength_(RastPort(0),&TxtDlug$,Len(TxtDlug$)))/2,WCursY : TxtDlug$=""
  EndIf

Return

.PATTERN
  If AGA=1 : CHIPS$="AGA" : Else : CHIPS$="ECS" : EndIf
  Background$="RAM:AD_TMP/TLO"+Str$(Numer_tla)+".IFF"

;  If Exists(Background$)=0
;    Request "Blad","Nie moge wczytac tla"+Chr$(10)+"Wychodze z maga !","OK"
;    StopPTModule : CloseWindow 0 : CloseWindow 1
;    If OTWARTE_NA_WB=0 : CloseScreen 1 : Else : For x=0 To 127 : PalRGB 1,x,R(x),G(x),B(x) : Next x : Use Palette 1 : EndIf
;    CloseFile 1
;    Gosub KASUJ_TMP
;    End
;  EndIf

  If Exists(Background$)=0
    Use Window BitOkno
    BitMap 1,50,50,7
  Else
  Use Window BitOkno
  InitBank 1,FileSize(Background$),0
  x=BLoad (Background$,Bank(1))
  LoadPalette 2,Background$

  x=ILBMInfo (Background$)
  Bitplany_tla=ILBMDepth
  Szerokosc_tla=ILBMWidth
  Wysokosc_tla=ILBMHeight
  If Bitplany_tla<=7 Then Bitplany_tla=7
  BitMap 1,Szerokosc_tla,Wysokosc_tla,Bitplany_tla
  DecodeILBM 1,Bank(1)

  If AGA=1
    For x=0 To 23 : PalRGB 2,x,Red(x),Green(x),Blue(x) : Next x
    For x=32 To 95 : PalRGB 2,x,Red(x),Green(x),Blue(x) : Next x
    DuplicatePalette 2,1 : Use Palette 1
  EndIf

  EndIf

  Ilosc_tel_x=InnerWidth/Szerokosc_tla
  x=Instr(Str$(Ilosc_tel_x),".") : If x>0 Then Ilosc_tel_x=Val(Left$(Str$(Ilosc_tel_x),x))
  Ilosc_tel_y=InnerHeight/Wysokosc_tla
  x=Instr(Str$(Ilosc_tel_y),".") : If x>0 Then Ilosc_tel_y=Val(Left$(Str$(Ilosc_tel_y),x))
 For y=1 To Ilosc_tel_y
    For x=1 To Ilosc_tel_x
      BitMaptoWindow 1,BitOkno,0,0,offl+((x-1)*Szerokosc_tla),offt+((y-1)*Wysokosc_tla),Szerokosc_tla,Wysokosc_tla
    Next x
    Pozostalosc_x=InnerWidth-(Szerokosc_tla*Ilosc_tel_x)
    BitMaptoWindow 1,BitOkno,0,0,offl+Ilosc_tel_x*Szerokosc_tla,offt+((y-1)*Wysokosc_tla),Pozostalosc_x,Wysokosc_tla
 Next y
    Pozostalosc_y=InnerHeight-(Wysokosc_tla*Ilosc_tel_y)
    For x=1 To Ilosc_tel_x
      BitMaptoWindow 1,BitOkno,0,0,offl+((x-1)*Szerokosc_tla),offt+Ilosc_tel_y*Wysokosc_tla,Szerokosc_tla,Pozostalosc_y
    Next x
    BitMaptoWindow 1,BitOkno,0,0,offl+Ilosc_tel_x*Szerokosc_tla,offt+Ilosc_tel_y*Wysokosc_tla,Pozostalosc_x,Pozostalosc_y
    BitMap 1,1,1,1
Return

.CZYSC_ZMIENNE
  Wskazany_tekst$=""
  Aktualna_strona=1
  Tytul_artykulu$=""
Return

.POKAZ_PANEL
  If AGA=1 : CHIPS$="AGA" : Else : CHIPS$="ECS" : EndIf
  Panel$=A_DYSK$(1)+"RYSUNKI/DATA/"+CHIPS$+"/PANEL.IFF"
  InitBank 1,FileSize(Panel$),0 : x=BLoad (Panel$,Bank(1)) : LoadPalette 4,Panel$
  x=ILBMInfo (Panel$)
  Bitplany_panelu=ILBMDepth
  Szerokosc_panelu=ILBMWidth
  Wysokosc_panelu=ILBMHeight
  BitMap 5,Szerokosc_panelu,Wysokosc_panelu,Bitplany_panelu : DecodeILBM 5,Bank(1)
  Szerokosc_ikony=Szerokosc_panelu/5 : Wysokosc_ikony=Wysokosc_panelu/2

  GetaShape 1,43,5,39,17
  GetaShape 2,130,5,33,14
  GetaShape 3,236,6,15,16
  GetaShape 4,294,6,50,14
  GetaShape 5,379,5,41,15
  GetaShape 6,464,3,51,20
  GetaShape 7,561,5,28,18

  GetaShape 8,43,32,39,17
  GetaShape 9,130,32,33,14
  GetaShape 10,236,33,15,16
  GetaShape 11,294,33,50,14
  GetaShape 12,379,32,41,15
  GetaShape 13,464,30,51,20
  GetaShape 14,561,32,28,18

  ShapeGadget 0,offl+43,offt+5,0,1,1,8
  ShapeGadget 0,offl+130,offt+5,0,2,2,9
  ShapeGadget 0,offl+236,offt+6,0,3,3,10
  ShapeGadget 0,offl+294,offt+6,0,4,4,11
  ShapeGadget 0,offl+379,offt+5,0,5,5,12
  ShapeGadget 0,offl+464,offt+3,0,6,6,13
  ShapeGadget 0,offl+561,offt+5,0,7,7,14
Return

.OTWORZ_PANEL
  If AGA=1
    For x=0 To 31 : PalRGB 2,x,Red(x),Green(x),Blue(x) : Next x
    Use Palette 4
    For x=32 To 95 : PalRGB 1,x,Red(x),Green(x),Blue(x) : Next x : Use Palette 1
  EndIf

  x=(640-Szerokosc_panelu-offl-offr)/2
  y=Wysokosc_Ekranu-(offt+2+(Wysokosc_panelu/2))

  Window 1,x,y,Szerokosc_panelu+offl+offr,Wysokosc_ikony+offt+offd,$4+$2+$8,"Panel",0,0,0
  BitMaptoWindow 5,1,0,0,offl,offt,Szerokosc_panelu,Wysokosc_ikony
  BitMap 5,1,1,1
  AttachGTList 0,1
  Belka_panelu$="Panel kontrolny" : Ilosc_spacji=((WindowWidth-50)-Len(Belka_panelu$)*8)/8-9
  Activate 1
Return

.WCZYTAJ_CZCIONKI
For x=1 To 10
    If INTERLACE_FONTS=1 AND x=4 Then LoadFont x,Czcionka$(x),CzcionkaY(x)*2 : CzcionkaY(x)=CzcionkaY(x)*2 : Goto CZ_INT
    If INTERLACE_FONTS=1 AND x=6 Then LoadFont x,Czcionka$(x),CzcionkaY(x)*2 : CzcionkaY(x)=CzcionkaY(x)*2 : Goto CZ_INT
    If Czcionka$(x)<>"" Then LoadFont x,Czcionka$(x),CzcionkaY(x)
CZ_INT:
Next x
Return
.
.PREFS
Use IntuiFont 1
If INTERLACE_FONTS=1 Then CzcionkaY(6)=CzcionkaY(6)/2
If INTERLACE_FONTS=1 Then CzcionkaY(4)=CzcionkaY(4)/2

GTString    2,0,32,11,247,13,"1",0,256,Czcionka$(1)
GTString    2,1,32,26,247,13,"2",0,256,Czcionka$(2)
GTString    2,2,32,41,247,13,"3",0,256,Czcionka$(3)
GTString    2,3,32,56,247,13,"4",0,256,Czcionka$(4)
GTString    2,4,32,71,247,13,"5",0,256,Czcionka$(5)
GTString    2,5,32,86,247,13,"6",0,256,Czcionka$(6)
GTString    2,6,32,101,247,13,"7",0,256,Czcionka$(7)
GTString    2,7,32,116,247,13,"8",0,256,Czcionka$(8)
GTString    2,8,32,131,247,13,"9",0,256,Czcionka$(9)
GTString    2,9,32,146,247,13,"10",0,256,Czcionka$(10)
GTInteger   2,10,282,11,35,13,"",0,CzcionkaY(1)
GTInteger   2,11,282,26,35,13,"",0,CzcionkaY(2)
GTInteger   2,12,282,41,35,13,"",0,CzcionkaY(3)
GTInteger   2,13,282,56,35,13,"",0,CzcionkaY(4)
GTInteger   2,14,282,71,35,13,"",0,CzcionkaY(5)
GTInteger   2,15,282,86,35,13,"",0,CzcionkaY(6)
GTInteger   2,16,282,101,35,13,"",0,CzcionkaY(7)
GTInteger   2,17,282,116,35,13,"",0,CzcionkaY(8)
GTInteger   2,18,282,131,35,13,"",0,CzcionkaY(9)
GTInteger   2,19,282,146,35,13,"",0,CzcionkaY(10)
GTCheckBox  2,20,32,161,35,13,"Kopiowac obrazki do ram ?",34
GTCheckBox  2,21,32,174,35,13,"Otwierac na Workbenchu ?",34
GTCheckBox  2,22,32,187,35,13,"Czcionka nr 4,6, obrazki dla Interlace ?",34
GTButton    2,23,32,200,265,13,"Wybierz tryb wyswietlania ekranu",0
GTButton    2,24,32,215,265,13,"Zmien kolory napisow",0

If OBRAZKI_RAM=1 Then GTToggle 2,20,On
If OTWIERAC_NA_WB=1 Then GTToggle 2,21,On
If INTERLACE_FONTS=1 Then GTToggle 2,22,On

Window 2,115,00,336,234 + offt,14,"Prefs",0,1
Use Window 2 : Activate 2 : WindowFont 1
BitOkno=2 : Gosub PATTERN
AttachGTList 2,2
GTBevelBox 2,offl,offt,328,232,0
WJam 0 : WColour 2,0 : WLocate 131,2 : Print "Czcionki"

  Repeat : ev = WaitEvent AND EventWindow=2 : Gosub CZAS

  If ev=$40
    Select GadgetHit
    If GadgetHit<10
      Czcionka$(GadgetHit+1)=GTGetString(2,GadgetHit)
    EndIf
    If GadgetHit=>10 AND GadgetHit<=19
      CzcionkaY(GadgetHit-9)=GTGetInteger(2,GadgetHit)
    EndIf
    If GadgetHit=20 Then OBRAZKI_RAM=EventCode
    If GadgetHit=21 Then OTWIERAC_NA_WB=EventCode
    If GadgetHit=22 Then INTERLACE_FONTS=EventCode
    If GadgetHit=23
      DEFTYPE.l ScrReq.l
      ScrReq.l= RTEZScreenModeRequest("Wybierz tryb ekranu",$80000051)
      If ScrReq.l<>0 Then ScrMode.l= Peek.l (ScrReq.l)
    EndIf
    If GadgetHit=24 Then Gosub PREFS_KOLORY
    End Select
  EndIf

  If ev=$200 AND EventWindow=1 Then CloseWindow2 : Gosub WYJSCIE
  Until ev=$200 AND EventWindow=2
  CloseWindow 2

  If Exists(A_DYSK$(1)+"PREFS.PRE") Then DeleteFile_ A_DYSK$(1)+"PREFS.PRE"
  x=OpenFile(2,A_DYSK$(1)+"PREFS.PRE")
  FileOutput 2
  For x=1 To 10
    NPrint Czcionka$(x) : NPrint CzcionkaY(x)
  Next x
  NPrint OBRAZKI_RAM
  NPrint OTWIERAC_NA_WB
  NPrint INTERLACE_FONTS
  NPrint "$",Hex$(ScrMode.l)
  NPrint Dysk_podstawa$
 CloseFile 2
 WColour Kolor_napisu
 If INTERLACE_FONTS=1 Then CzcionkaY(6)=CzcionkaY(6)/2
 If INTERLACE_FONTS=1 Then CzcionkaY(4)=CzcionkaY(4)/2
Return

.PREFS_KOLORY
AddIDCMP #MOUSEMOVE+#INTUITICKS

f$="%2ld" : GTTags #GTSL_LEVELFORMAT,&f$,#GTSL_MAXLEVELLEN,3,#GTSL_LEVELPLACE,2
GTSlider    4,0,91,24,216,10,"Czerwony ",0,0,15,Red(8)
f$="%2ld" : GTTags #GTSL_LEVELFORMAT,&f$,#GTSL_MAXLEVELLEN,3,#GTSL_LEVELPLACE,2
GTSlider    4,1,91,36,216,11,"Zielony  ",0,0,15,Green(8)
f$="%2ld" : GTTags #GTSL_LEVELFORMAT,&f$,#GTSL_MAXLEVELLEN,3,#GTSL_LEVELPLACE,2
GTSlider    4,2,91,49,216,11,"Niebieski",0,0,15,Blue(8)
x$="" : For x=1 To 16 : x$=x$+"Kolor "+Str$(x)+"|" : Next x : x$=Left$(x$,Len(x$)-1)
GTCycle     4,3,11,5,317,16,"",0,x$

Window 4,143,11,351,79 + offt,14,"Ustawianie kolorow tekstu",0,1
BitOkno=4 : Gosub PATTERN
WindowFont 0
AttachGTList 4,4

GTBevelBox 4,offl,offt,343,77,0

WJam 0
WColour 8,0
WLocate 6,64 : Print "Przyklad napisu w kolorze kolorowym"
RGB_KOLOR=8 : R=Red(RGB_KOLOR) : B=Blue(RGB_KOLOR) : G=Green(RGB_KOLOR)

  Repeat
    ev=WaitEvent
    If ev=$40
    Select GadgetHit
    Case 0
      R=EventCode : PalRGB 1,RGB_KOLOR,R,G,B : Use Palette 1
    Case 1
      G=EventCode : PalRGB 1,RGB_KOLOR,R,G,B : Use Palette 1
    Case 2
      B=EventCode : PalRGB 1,RGB_KOLOR,R,G,B : Use Palette 1
    Case 3
    RGB_KOLOR=EventCode+8 : WColour RGB_KOLOR,0 : WLocate 6,64 : Print "Przyklad napisu w kolorze kolorowym"
    GTSetAttrs 4,0,#GTSL_LEVEL,Red(RGB_KOLOR) : R=Red(RGB_KOLOR)
    GTSetAttrs 4,1,#GTSL_LEVEL,Green(RGB_KOLOR) : G=Green(RGB_KOLOR)
    GTSetAttrs 4,2,#GTSL_LEVEL,Blue(RGB_KOLOR) : B=Blue(RGB_KOLOR)
    End Select
    EndIf
  Until ev=$200 AND EventWindow=4
  ev=0

CloseWindow 4
SavePalette 1,A_DYSK$(1)+"RYSUNKI/DATA/PALETA.CMA"
Return

.WCZYTAJ_PREFS
  DEFTYPE.l ScrMode

  x=OpenFile(2,A_DYSK$(1)+"PREFS.PRE")
  FileInput 2
  For x=1 To 10
    Czcionka$(x)=Edit$(256)
    CzcionkaY(x)=Val(Edit$(256))
  Next x
  OBRAZKI_RAM=Val(Edit$(256))
  OTWIERAC_NA_WB=Val(Edit$(256))
  INTERLACE_FONTS=Val(Edit$(256))
  ScrMode.l=Val(Edit$(256))
  Dysk_podstawa$=Edit$(256)
 CloseFile 2
Return

.MUZYKA_PREFS
Use IntuiFont 1
  GadTxt$=""
  For x=0 To 5
    If Nazwa_modulu$(x)<>""
    If GadTxt$<>"" Then GadTxt$=GadTxt$+"|"
    GadTxt$=GadTxt$+Nazwa_modulu$(x)
    EndIf
  Next x

GTMX        3,0,16,20,17,9,"",2,GadTxt$,Val(Ladowany_modul$)-1
f$="%2ld" : GTTags #GTSL_LEVELFORMAT,&f$,#GTSL_MAXLEVELLEN,3,#GTSL_LEVELPLACE,2
GTSlider    3,1,97,74,190,12,"Glosnosc:",33,0,64,64
GTCheckBox  3,2,73,92,26,11,"Filter",33
GTCheckBox  3,3,284,92,26,11,"Wylaczona",33

Window 3,46,34,334,108 + offt,14,"Preferencje muzyki",0,1
WindowFont 1 : BitOkno=3 : Gosub PATTERN
AttachGTList 3,3

GTBevelBox 3,offl,89+offt,326,17,0
GTBevelBox 3,offl,00+offt,326,14,0
GTBevelBox 3,offl,71+offt,326,18,0
GTBevelBox 3,offl,14+offt,326,57,0

WJam 0 : WColour 2,0 : WLocate 141,3 : Print"Muzyka"

Repeat : ev = WaitEvent AND EventWindow=3 : Gosub CZAS
  If ev=$20
    Ladowany_modul$=Str$(EventCode+1) : Gosub LADUJ_MODUL
  EndIf
  If ev=$40
    Select GadgetHit
      Case 1
        SetPTVolume EventCode
      Case 2
        If EventCode=1 : Filter Off : Else : Filter On : EndIf
      Case 3
        If EventCode=1
          StopPTModule : Modul=0
        Else
          If Zaladowany_modul>0 Then PlayPTModule 1 : Modul=1
        EndIf
    End Select
  EndIf
Until ev=$200 AND EventWindow=3
CloseWindow 3
WColour Kolor_napisu
Return

.LADUJ_MODUL

If NOT Zaladowany_modul=Val(Ladowany_modul$)
 Modulik$=A_DYSK$(1)+"MUZYKA/"+Ladowany_modul$+".MOD"
 If Exists(Modulik$)<>0
   ROZPAKOWANE$="RAM:AD_TMP/AntyDresiarz-Mod"
   DO_ROZPAKOWANIA$=Modulik$ : Gosub ROZPAKUJ


   If NOT Modulik$=ROZPAKOWANE$ Then KASUJ_ROZPAK=1
   Modulik$=ROZPAKOWANE$
   StopPTModule ;: FreeTrackerModule 1

   If ChipFree>FileSize (Modulik$)+10000
     x=LoadPTModule(1,Modulik$)
     If KASUJ_ROZPAK=1 Then Gosub KASUJ_ROZP
    If Modul=1 AND x<>0 Then PlayPTModule 1 : SetPTSongLoop On : Zaladowany_modul=Val(Ladowany_modul$)
   Else
      X$="Brak CHIP'u na zaladowanie modulu."+Chr$(10)+"Rozszerz pamiec lub pozamykaj programy."
     Request "Blad w ladowaniu modulu",X$,"oK" : Zaladowany_modul=-1 : X$=""
   EndIf
 Else
   Request "Blad w ladowaniu modulu","Brak modulu na dysku !","ok"
 EndIf
EndIf
Return

.CZAS
x=Hours
 Sek=Secs
  If Sekunda<>Sek
  Sekundy$=Str$(Secs) : If Len(Sekundy$)=1 Then Sekundy$="0"+Sekundy$
  Minuty$=Str$(Mins) : If Len(Minuty$)=1 Then Minuty$="0"+Minuty$
  Godziny$=Str$(Hours) : If Len(Godziny$)=1 Then Godziny$="0"+Godziny$
  Use Window 1
  WTitle Belka_panelu$+SPACE$(Ilosc_spacji)+Godziny$+":"+Minuty$+":"+Sekundy$,Belka_ekranu$
  Sekunda=Sek
  EndIf
Return

.WYJSCIE
StopPTModule
CloseWindow 0
CloseWindow 1

  If OTWARTE_NA_WB=0
    CloseScreen 1
  Else
    For x=0 To 127 : PalRGB 1,x,R(x),G(x),B(x) : Next x
    Use Palette 1
  EndIf
  CloseFile 1
  Gosub KASUJ_TMP
End
Return

.KASUJ_TMP
If Exists("RAM:AD_TMP")

NEWTYPE.FileInfoBlock : _DiskKey.l : _DirEntryType.l : _FileName.b[108] : _Protection.l : _EntryType.l : _Size.l
 _NumBlocks.l : ds_Days.l : ds_Minute.l : ds_Tick.l : _Comment.b[80] : _Reserved.b[36] : End NEWTYPE
DEFTYPE .FileInfoBlock myfib        ;myfib - blok informacyjny

  p$="RAM:AD_TMP"                  ;Sciezka katalogu$
  t$=Chr$(9)                          ;tab$
  lock.l=Lock_(&p$,-2)                ;lock is dos system to access files

If Examine_(lock,myfib)<>0          ;if we get lock on p$
  While ExNext_(lock,myfib)<>0      ;skip through files
    USEPATH myfib

    If \_DirEntryType<0             ;jezeli nie katalog to...
      Nazwa_pliku$=LSet$(Peek$(&\_FileName),30)
      Nazwa_pliku$=Left$(Nazwa_pliku$,Instr(Nazwa_pliku$,"  ")-1)

         DeleteFile_("RAM:AD_TMP/"+Nazwa_pliku$)
    EndIf

  Wend
EndIf

UnLock_ lock

DeleteFile_ ("RAM:AD_TMP")

EndIf
Return

.DEMO
  If AGA=1 : CHIPS$="AGA" : Else : CHIPS$="ECS" : EndIf
  Use Palette 1
  Window 0,0,offt,640,Wysokosc_Ekranu-offt,6,"Antydresiarz",0,1 : Activate 0
  InnerCls 1

  Rysunek$=A_DYSK$(1)+"RYSUNKI/DATA/AGA/TITLE1.IFF" : ROZPAKOWANE$="RAM:AD_TMP/AntyDresiarz-TITLE"
  DO_ROZPAKOWANIA$=Rysunek$ : Gosub ROZPAKUJ
  If NOT Rysunek$=ROZPAKOWANE$ Then KASUJ_ROZPAK=1
  Rysunek$=ROZPAKOWANE$

  If ILBMInfo (Rysunek$)
    Szerokosc=ILBMWidth
    Wysokosc=ILBMHeight
    Bitplany=ILBMDepth

    InitBank 1,FileSize(Rysunek$),65536
    x=BLoad (Rysunek$,Bank(1))
    LoadPalette 3,Rysunek$
    If KASUJ_ROZPAK Then Gosub KASUJ_ROZP
    BitMap 1,Szerokosc,Wysokosc,Bitplany
    DecodeILBM 1,Bank(1)
  Else
    DisplayBeep_0
  EndIf

  Use Palette 3

  Gosub WYSWIETL_LINIAMI

  OKRES=Timer

  Gosub WCZYTAJ_CZCIONKI
  Ladowany_modul$="1" : Modul=1 : Gosub LADUJ_MODUL

  Rysunek$=A_DYSK$(1)+"RYSUNKI/DATA/AGA/PRESENTS.IFF" : ROZPAKOWANE$="RAM:AD_TMP/AntyDresiarz-PRESENTS"
  DO_ROZPAKOWANIA$=Rysunek$ : Gosub ROZPAKUJ
  If NOT Rysunek$=ROZPAKOWANE$ Then KASUJ_ROZPAK=1
  Rysunek$=ROZPAKOWANE$

  Repeat : VWait 1 : Until Timer>OKRES+300 OR MButtons=1

  Gosub ZAMALUJ_LINIAMI

  If ILBMInfo (Rysunek$)
    Szerokosc=ILBMWidth
    Wysokosc=ILBMHeight
    Bitplany=ILBMDepth

    InitBank 1,FileSize(Rysunek$),65536
    x=BLoad (Rysunek$,Bank(1))
    LoadPalette 3,Rysunek$
    If KASUJ_ROZPAK Then Gosub KASUJ_ROZP
    BitMap 1,Szerokosc,Wysokosc,Bitplany
    DecodeILBM 1,Bank(1)
  Else
    DisplayBeep_0
  EndIf

  Use Palette 3

  Gosub WYSWIETL_LINIAMI

  OKRES=Timer

  Rysunek$=A_DYSK$(1)+"RYSUNKI/DATA/AGA/TITLE2.IFF" : ROZPAKOWANE$="RAM:AD_TMP/AntyDresiarz-TITLE2"
  DO_ROZPAKOWANIA$=Rysunek$ : Gosub ROZPAKUJ
  If NOT Rysunek$=ROZPAKOWANE$ Then KASUJ_ROZPAK=1
  Rysunek$=ROZPAKOWANE$

  Repeat : VWait 1 : Until Timer>OKRES+300 OR MButtons=1

  Gosub ZAMALUJ_LINIAMI


;  PalRGB 3,6,15,15,15 : Use Palette 3
; WindowFont 3
;  WLocate 200,(InnerHeight-CzcionkaY(3))/2 : WColour 6,1 : NPrint "PRESENTS"


;  OKRES=Timer
;  Repeat : VWait 1 : Until Timer>OKRES+200 OR MButtons=1
;
;  For i=0 To 15 Step 1
;    PalRGB 3,6,15-i,15-i,15-i : Use Palette 3
;    VWait 2
;  Next i
;  InnerCls 1


  If ILBMInfo (Rysunek$)
    Szerokosc=ILBMWidth
    Wysokosc=ILBMHeight
    Bitplany=ILBMDepth

    InitBank 1,FileSize(Rysunek$),65536
    x=BLoad (Rysunek$,Bank(1))
    LoadPalette 3,Rysunek$
    If KASUJ_ROZPAK=1 Then Gosub KASUJ_ROZP
    BitMap 1,Szerokosc,Wysokosc,Bitplany
    DecodeILBM 1,Bank(1)
  Else
    DisplayBeep_0
  EndIf
  Use Palette 3

  Gosub WYSWIETL_LINIAMI

  OKRES=Timer
  Rysunek$=A_DYSK$(1)+"RYSUNKI/DATA/AGA/TITLE3.IFF" : ROZPAKOWANE$="RAM:AD_TMP/AntyDresiarz-TITLE3"
  DO_ROZPAKOWANIA$=Rysunek$ : Gosub ROZPAKUJ
  If NOT Rysunek$=ROZPAKOWANE$ Then KASUJ_ROZPAK=1
  Rysunek$=ROZPAKOWANE$

  ; --- TELKA
  For i=1 To 9
    If Exists(A_DYSK$(1)+"RYSUNKI/DATA/"+CHIPS$+"/TLO"+Str$(i)+".IFF")
      x=CopyFile (A_DYSK$(1)+"RYSUNKI/DATA/"+CHIPS$+"/TLO"+Str$(i)+".IFF","RAM:AD_TMP/TLO"+Str$(i)+".IFF")
    EndIf
  Next i
  ; --- TELKA END

  Repeat : VWait 1 : Until Timer>OKRES+300 OR MButtons=1

  Gosub ZAMALUJ_LINIAMI

  If ILBMInfo (Rysunek$)
    Szerokosc=ILBMWidth
    Wysokosc=ILBMHeight
    Bitplany=ILBMDepth

    InitBank 1,FileSize(Rysunek$),65536
    x=BLoad (Rysunek$,Bank(1))
    LoadPalette 3,Rysunek$
    If KASUJ_ROZPAK=1 Then Gosub KASUJ_ROZP
    BitMap 1,Szerokosc,Wysokosc,Bitplany
    DecodeILBM 1,Bank(1)
  Else
    DisplayBeep_0
  EndIf
  Use Palette 3

  Gosub WYSWIETL_LINIAMI

  OKRES=Timer
  Gosub POKAZ_PANEL

  Repeat : VWait 1 : Until Timer>OKRES+300 OR MButtons=1

  Gosub ZAMALUJ_LINIAMI
Return

.WYSWIETL_LINIAMI
  If InnerHeight=Wysokosc
    For y=0 To InnerHeight-1 Step 2
      BitMaptoWindow 1,0,0,y,offl,offt+y,Szerokosc,1
      BitMaptoWindow 1,0,0,Wysokosc-y-1,offl,(InnerHeight+offt)-y-1,Szerokosc,1
      VWait 1
    Next y
  ZAMALUJ=1
  EndIf

  If InnerHeight=Wysokosc*2
    For y=0 To InnerHeight-1 Step 4
      BitMaptoWindow 1,0,0,y,offl,offt+y,Szerokosc,1
      BitMaptoWindow 1,0,0,Wysokosc-y-1,offl,(InnerHeight+offt)-y-1,Szerokosc,1
      VWait 1
    Next y
  ZAMALUJ=0
  EndIf

  If InnerHeight>Wysokosc*2
    odstep=(InnerHeight-Wysokosc*2)
    For y=1 To InnerHeight-odstep Step 4
      BitMaptoWindow 1,0,0,y/2,offl,offt+y,Szerokosc,1
      BitMaptoWindow 1,0,0,y/2,offl,offt+y+1,Szerokosc,1

      BitMaptoWindow 1,0,0,Wysokosc-(y/2),offl,(InnerHeight+offt)-y-odstep,Szerokosc,1
      BitMaptoWindow 1,0,0,Wysokosc-(y/2),offl,(InnerHeight+offt)-y-odstep+1,Szerokosc,1
      VWait 1
    Next y
  ZAMALUJ=0
  EndIf

Return

.ZAMALUJ_LINIAMI
  If ZAMALUJ=1
    For i=0 To InnerHeight-2 Step 2
    WBox offl,offt+i,InnerWidth+3,offt+i,1
    WBox offl,(InnerHeight+offt-1)-i,InnerWidth+3,(InnerHeight+offt-1)-i,1
    VWait 1
    Next i
  Else
    For i=0 To InnerHeight-2 Step 4
      WBox offl,offt+i,InnerWidth+3,offt+i+1,1
      WBox offl,(InnerHeight+offt-2)-i-2,InnerWidth+3,(InnerHeight+offt-2)-i-1,1
    VWait 1
    Next i
  EndIf

  InnerCls 1
Return

.ROZPAKUJ
 ; DO_ROZPAKOWANIA$
  dlugosc_spak.l=FileSize(DO_ROZPAKOWANIA$)

  InitBank 9,4,65536
  x=BLoad (DO_ROZPAKOWANIA$,Bank(9),4)
  FileFormat$=Peeks$(Bank(9),4)
  Erase 9

  If FileFormat$="ANTY"
    InitBank 9,6,65536
    x=BLoad (DO_ROZPAKOWANIA$,Bank(9)+1,5,dlugosc_spak.l-4)

    A=Peek.b (Bank(9)+1) : B=Peek.b (Bank(9)+2) : C=Peek.b (Bank(9)+3) : D=Peek.b (Bank(9)+4)
    Poke.b Bank(9)+4,A : Poke.b Bank(9)+3,B : Poke.b Bank(9)+2,C : Poke.b Bank(9)+1,D

    dlugosc.l=Peek.l (Bank(9))
    Erase 9

    InitBank 9,dlugosc_spak.l,65536
    x=BLoad (DO_ROZPAKOWANIA$,Bank(9))

    DEFTYPE.l X
    X.l=Bank(9)+dlugosc_spak.l-4
    Poke.b X.l,D : Poke.b X.l+1,C : Poke.b X.l+2,B : Poke.b X.l+3,A

    InitBank 10,dlugosc.l,65536
    PPDecrunch Bank(9),Bank(9)+dlugosc_spak.l,Bank(10)
    Erase 9
    x=BSave (ROZPAKOWANE$,Bank(10),dlugosc.l)
    Erase 10
  Else
   ROZPAKOWANE$=DO_ROZPAKOWANIA$
  EndIf
Return

.KASUJ_ROZP
  x=DeleteFile_ (ROZPAKOWANE$)
  KASUJ_ROZPAK=0
Return

; funkcje sizeowania Hires-HiresLace
; Wysokosc_Ekranu
