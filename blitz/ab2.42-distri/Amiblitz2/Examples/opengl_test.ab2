;Amiblitz port of this windows VC6 example from Bernd Roesch
;************************** Keys ************************
;cursor left right        move left rigt
;cursor up down           move z + - (zoom)
;r                        rotate x and y
;//--[---------------------------------------------]
;//--[ File    : GFXOPENGL.H                       ]
;//--[ AUTHOR  : WILLIE TANG (willietang@hehe.com) ]
;//--[ STARTED : 11.26.2002                        ]
;//--[ UPDATED : 02.11.2003                        ]
;//--[---------------------------------------------]
!tklibs_include
#developobject=1
Dim texture.l (2)
WBStartup
optimize 7:DEFTYPE .l
INCLUDE "blitzlibs:gl.bb2"

Statement setupbench {}
SHARED tr.f
glLoadIdentity_;                           // Reset Matrix
glTranslatef_ 0.0, 1.0, -5.0;            // Go 5 Units Inward
glScalef_ 0.0001, 0.0001, 0.0001;
glRotatef_ 20, 0.0, 1.0, 1.0;         // Rotate Around Y-Axis
ResetTimer
loop2
tr=tr+1
        glBegin_ #GL_TRIANGLES;                               // I Want To Draw A Quadrilateral!...:)
            glTexCoord2f_ 1.0, 0.0;                 // Lower Right Of Texture
            glVertex3f_ 1.0, -1.0, 0.0;

            glTexCoord2f_ 1.0, 1.0 ;                 // Upper Right Of Texture
            glVertex3f_ 1.0, 1.0, 0.0;

            glTexCoord2f_ 0.0, 1.0  ;               // Upper Left Of Texture
            glVertex3f_ -1.0, 1.0, 0.0
       glEnd_
If Timer < 50 Goto loop2
End Statement

Statement gl_blit {xval.f,yval,zval.f}
SHARED angle.f,texture()
     glClear_ #GL_COLOR_BUFFER_BIT |#GL_DEPTH_BUFFER_BIT;// Clear Depth Buffer

     glLoadIdentity_;                           // Reset Matrix

     glTranslatef_ xval, 1.0, zval;            // Go 5 Units Inward
     glScalef_ 0.65, 0.65, 0.65;
     glRotatef_ angle, 0.0, 1.0, 1.0;         // Rotate Around Y-Axis
          ;/********************************************
          ;As stated in the accompanying tutorial
          ;  (AND To refresh your mind...;)), the
          ;  texture coordinates are set up like so:

          ;  (0,1)           (1,1)
          ;    +---------------+
          ;     |               |
          ;     |               |
          ;     | My Texture... |
          ;     |               |
          ;     |               |
          ;     |               |
          ;     +---------------+
          ;(0,0)           (1,0)


          ;These coordinates are what you Use inside
          ;  glTexCoord2f().


        glBegin_ #GL_QUADS;                               // I Want To Draw A Quadrilateral!...:)
            glTexCoord2f_ 1.0, 0.0;                 // Lower Right Of Texture
            glVertex3f_ 1.0, -1.0, 0.0;

            glTexCoord2f_ 1.0, 1.0 ;                 // Upper Right Of Texture
            glVertex3f_ 1.0, 1.0, 0.0;

            glTexCoord2f_ 0.0, 1.0  ;               // Upper Left Of Texture
            glVertex3f_ -1.0, 1.0, 0.0

            glTexCoord2f_ 0.0, 0.0  ;                // Lower Left Of Texture
            glVertex3f_ -1.0, -1.0, 0.0
       glEnd_

          glLoadIdentity_;                           // Reset Matrix

          glTranslatef_ xval, -1.0,zval;
          glScalef_     0.6, 0.65, 0.65;
          glRotatef_ angle, 0.0, 1.0, 1.0;

          glBindTexture_ #GL_TEXTURE_2D,@@        ;        // Bind/Select A 2D Texture
                         texture(0); // Bind/Select Second Texture

          glBegin_ #GL_QUADS;                               // I Want To Draw A Quadrilateral!...:)
            glTexCoord2f_ 1.0, 0.0;                 // Lower Right Of Texture
            glVertex3f_ 1.0, -1.0, 0.0

            glTexCoord2f_ 1.0, 1.0;                 // Upper Right Of Texture
            glVertex3f_ 1.0, 1.0, 0.0

            glTexCoord2f_ 0.0, 1.0;                 // Upper Left Of Texture
            glVertex3f_ -1.0, 1.0, 0.0

            glTexCoord2f_ 0.0, 0.0;                 // Lower Left Of Texture
            glVertex3f_ -1.0, -1.0, 0.0
          glEnd_ ;

          glTranslatef_ xval, 0.0, 5.0;             // Go Back 5 Units Outward
End Statement
.begin
!screen_ 0,"test","ram:test.prefs",0
width=!screen_width:height=!screen_height:If !screen_id=0 Then End
Window 0,0,0,width,height,$100f,"test",0,1 ;gimmezerozero $400 for win borders
*mesa=AmigaMesaCreateContext_(Tags(#AMA_WINDOW,Peek.l(Addr Window(Used Window)),@@
                                 #AMA_FULLSCREEN,1,@@
                                 #AMA_DOUBLEBUF,1,@@
                                 #AMA_ALPHAFLAG,1,@@
                                 #AMA_DIRECTRENDER,1))
AmigaMesaMakeCurrent_ *mesa,Peek.l(*mesa+8)
glViewport_ 0, 0, width, height ;     // Size Of Window
glMatrixMode_ #GL_PROJECTION;         // Choose Projection Matrix
glLoadIdentity_;                      // Reset Projection Matrix
gluPerspective_ 45.0,@@;              // Viewing Angle
                width/height,@@; // Aspect Ratio
                0.1,@@ ;         // Can See From This Near
                100.0;           // Can See To This Far
glMatrixMode_ #GL_MODELVIEW;          // Choose Modelview Matrix
glLoadIdentity_;
glShadeModel_ #GL_SMOOTH;            // Smooth-Shaded Polygons
glClearColor_ 0.0, 0.0, 0.0, 0.0;   // Set Clear Color
glClearDepth_ 1.0;                  // Clear Depth Buffer
glEnable_ #GL_DEPTH_TEST;           // Enable Depth Testing

glDepthFunc_ #GL_LEQUAL;            // Type of Depth Testing
glEnable_ #GL_LIGHTING
redlight.gl\r=0.9,0.3,0.3
glLightfv_ #GL_LIGHT0,#GL_AMBIENT,redlight
glEnable_ #GL_LIGHT0

;************************** make txture
glGenTextures_ 1,@@:                                  // # Of Texture Names To Create
                &texture(0);       // Generate Texture ID

ret=gl_loadtexture {texture(0),"blitz2:thilo_includes/gfx/pattern"}
.startvals
zval.f=-10:xval.f=0:yval.f=0

glEnable_ #GL_CULL_FACE

glTexParameteri_ #GL_TEXTURE_2D,@@         ;     // Set 2D Texture Parameter
                #GL_TEXTURE_MIN_FILTER,@@;      // Select Minification Filter Type
                #GL_NEAREST;            ;      // Set To GL_NEAREST (Blocky & Fastest)
glTexParameteri_ #GL_TEXTURE_2D,@@         ;     // Set 2D Texture Parameter
                #GL_TEXTURE_MAG_FILTER,@@ ;     // Select Magnification Filter Type
                #GL_NEAREST;                    // Set To GL_LINEAR (Smoothest & Slowest)


setupbench{}
loop
ResetTimer
ev=Event
Select ev
 Case #IDCMP_RAWKEY
     Select EventCode
     Case $4e
     xval+0.3
     Case $4f
     xval-0.3
     Case $4c
     zval-0.3
     Case $4d
     zval+0.3
     Case $13
     angle+6
     Case $45
     End
     End Select
 Case #IDCMP_CLOSEWINDOW:End
End Select
FlushEvents
gl_blit{xval,yval,zval}
AmigaMesaSwapBuffers_ *mesa;
ret=Timer
If ret >0 Then ret=50/ret
WLocate 10,10
NPrint  "fps: "+Str$(ret)+" Thousands Triangles "+Str$(tr/1000)
Goto loop
glDeleteTextures_ 1,@@:                                  // # Of Texture Names To Create
                &texture(0);       // Generate Texture ID
AmigaMesaDestroyContext_ *mesa
End
