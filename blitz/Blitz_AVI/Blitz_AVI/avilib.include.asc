
; avilib.include.bb2 generated by FD2inc.

DEFTYPE .Library *_AvilibBase

Macro avilib_AVI_can_read_audio ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -30(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_open_output_file ; {ret,filename}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -36(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_set_video ; {AVI,width,height,fps,compressor}
   GetReg a0,`1 : GetReg a1,`2 : GetReg a2,`3 : GetReg a3,`4 : GetReg d0,`5
   GetReg a6,*_AvilibBase : JSR -42(a6)
End Macro

Macro avilib_AVI_set_audio ; {AVI,channels,rate,bits,format,mp3rate}
   GetReg a0,`1 : GetReg a1,`2 : GetReg a2,`3 : GetReg a3,`4 : GetReg d0,`5
   GetReg d1,`6
   GetReg a6,*_AvilibBase : JSR -48(a6)
End Macro

Macro avilib_avi_update_header ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -54(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_write_frame ; {ret,AVI,data,bytes,keyframe}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4 : GetReg a3,`5
   GetReg a6,*_AvilibBase : JSR -60(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_dup_frame ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -66(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_write_audio ; {ret,AVI,data,bytes}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4
   GetReg a6,*_AvilibBase : JSR -72(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_append_audio ; {ret,AVI,data,bytes}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4
   GetReg a6,*_AvilibBase : JSR -78(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_bytes_remain ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -84(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_bytes_written ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -90(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_set_audio_track ; {ret,AVI,track}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -96(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_get_audio_track ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -102(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_set_audio_vbr ; {AVI,is_vbr}
   GetReg a0,`1 : GetReg a1,`2
   GetReg a6,*_AvilibBase : JSR -108(a6)
End Macro

Macro avilib_AVI_get_audio_vbr ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -114(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_set_comment_fd ; {AVI,fd}
   GetReg a0,`1 : GetReg a1,`2
   GetReg a6,*_AvilibBase : JSR -120(a6)
End Macro

Macro avilib_AVI_get_comment_fd ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -126(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_close ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -132(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_open_input_indexfile ; {ret,filename,getIndex,indexfile}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4
   GetReg a6,*_AvilibBase : JSR -138(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_open_indexfd ; {ret,fd,getIndex,indexfile}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4
   GetReg a6,*_AvilibBase : JSR -144(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_open_input_file ; {ret,filename,getIndex}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -150(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_open_fd ; {ret,fd,getIndex}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -156(a6) : PutReg d0,`1
End Macro

Macro avilib_avi_parse_index_from_file ; {ret,AVI,filename}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -162(a6) : PutReg d0,`1
End Macro

Macro avilib_avi_parse_input_file ; {ret,AVI,getIndex}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -168(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_video_frames ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -174(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_video_width ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -180(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_video_height ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -186(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_frame_rate ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -192(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_video_compressor ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -198(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_max_video_chunk ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -204(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_tracks ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -210(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_channels ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -216(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_mp3rate ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -222(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_bits ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -228(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_format ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -234(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_rate ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -240(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_bytes ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -246(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_chunks ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -252(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_codech_offset ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -258(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_codecf_offset ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -264(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_video_codech_offset ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -270(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_video_codecf_offset ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -276(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_frame_size ; {ret,AVI,frame}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -282(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_audio_size ; {ret,AVI,frame}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -288(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_get_video_position ; {ret,AVI,frame}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -294(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_seek_start ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -300(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_set_video_position ; {ret,AVI,frame}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -306(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_set_audio_bitrate ; {ret,AVI,bitrate}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -312(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_read_frame ; {ret,AVI,vidbuf,keyframe}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4
   GetReg a6,*_AvilibBase : JSR -318(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_get_audio_position_index ; {ret,AVI}
   GetReg a0,`2
   GetReg a6,*_AvilibBase : JSR -324(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_set_audio_position_index ; {ret,AVI,indexpos}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -330(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_set_audio_position ; {ret,AVI,byte}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -336(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_read_audio ; {ret,AVI,audbuf,bytes}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4
   GetReg a6,*_AvilibBase : JSR -342(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_read_audio_chunk ; {ret,AVI,audbuf}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -348(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_read_data ; {ret,AVI,vidbuf,max_vidbuf,audbuf,max_audbuf,len}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4 : GetReg a3,`5 : GetReg d0,`6
   GetReg d1,`7
   GetReg a6,*_AvilibBase : JSR -354(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_print_error ; {str}
   GetReg a0,`1
   GetReg a6,*_AvilibBase : JSR -360(a6)
End Macro

Macro avilib_AVI_strerror ; {ret}
   GetReg a6,*_AvilibBase : JSR -366(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_max_size ; {ret}
   GetReg a6,*_AvilibBase : JSR -372(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_read_wave_header ; {ret,fd,wave}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -378(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_write_wave_header ; {ret,fd,wave}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_AvilibBase : JSR -384(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_read_wave_pcm_data ; {ret,fd,buffer,buflen}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4
   GetReg a6,*_AvilibBase : JSR -390(a6) : PutReg d0,`1
End Macro

Macro avilib_AVI_write_wave_pcm_data ; {ret,fd,data,datalen}
   GetReg a0,`2 : GetReg a1,`3 : GetReg a2,`4
   GetReg a6,*_AvilibBase : JSR -396(a6) : PutReg d0,`1
End Macro


Function.l avilib_InitLib {minVersion.l}
   SHARED *_AvilibBase
   If *_AvilibBase Then Function Return *_AvilibBase
   If minVersion<0 Then minVersion = 0
   *_AvilibBase = OpenLibrary_ ("avilib.library",minVersion)
   Function Return *_AvilibBase
End Function


Statement avilib_FreeLib {}
   SHARED *_AvilibBase
   If *_AvilibBase Then CloseLibrary_ *_AvilibBase : *_AvilibBase = 0
End Statement


;-----------------------------------------------------------------------


; C to Blitz conversion done by c2b.

; NB: "avilib.h" was tweaked slightly by hand before being run through c2b.
;     Ofcoarse some small post modifications were made also. ;)

;
; **      $VER: avilib.h 1.0 (12.12.2003)
; **
; **      main include file for avilib.library
;


NEWTYPE .AvilibBase
   LibNode.Library                       ; STRUCT
End NEWTYPE


#AVI_MAX_TRACKS                = 8

NEWTYPE .video_index_entry
   key.l
   pos.l
   llen.l
End NEWTYPE


NEWTYPE .audio_index_entry
   pos.l
   llen.l
   tot.l
End NEWTYPE


; Index types


#AVI_INDEX_OF_INDEXES          = $00 ; when each entry in aIndex
; array points to an index chunk
#AVI_INDEX_OF_CHUNKS           = $01 ; when each entry in aIndex
; array points to a chunk in the file
#AVI_INDEX_IS_DATA             = $80 ; when each entry is aIndex is
; really the data
; bIndexSubtype codes for INDEX_OF_CHUNKS
;
#AVI_INDEX_2FIELD              = $01 ; when fields within frames
; are also indexed


NEWTYPE .avisuperindex_entry
   long.l                                ; ULONG   ; absolute file offset
   dwSize.l                              ; ULONG   ; size of index chunk at this offset
   dwDuration.l                          ; ULONG   ; time span in stream ticks
End NEWTYPE


NEWTYPE .avistdindex_entry
   dwOffset.l                            ; ULONG   ; qwBaseOffset + this is absolute file offset
   dwSize.l                              ; ULONG   ; bit 31 is set if this is NOT a keyframe
End NEWTYPE


; Base Index Form 'indx'
NEWTYPE .avisuperindex_chunk
   *fcc.b[4]                             ; CHAR
   dwSize.l                              ; ULONG   ; size of this chunk
   wLongsPerEntry.w                      ; USHORT  ; size of each entry in aIndex array (must be 8 for us)
   *bIndexSubType.b                      ; UCHAR   ; future use. must be 0
   *bIndexType.b                         ; UCHAR   ; one of AVI_INDEX_* codes
   nEntriesInUse.l                       ; ULONG   ; index of first unused member in aIndex array
   *dwChunkId.b[4]                       ; CHAR    ; fcc of what is indexed
   dwReserved.l[3]                       ; ULONG   ; meaning differs for each index type/subtype.
   ; 0 if unused
   *aIndex.avisuperindex_entry
End NEWTYPE


; Standard index
NEWTYPE .avistdindex_chunk
   *fcc.b[4]                             ; CHAR    ; ix##
   dwSize.l                              ; ULONG   ; size of this chunk
   wLongsPerEntry.w                      ; USHORT  ; must be sizeof(aIndex[0])/sizeof(DWORD)
   *bIndexSubType.b                      ; UCHAR   ; must be 0
   *bIndexType.b                         ; UCHAR   ; must be AVI_INDEX_OF_CHUNKS
   nEntriesInUse.l                       ; ULONG   ;
   *dwChunkId.b[4]                       ; CHAR    ; '##dc' or '##db' or '##wb' etc..
   long.l                                ; ULONG   ; all dwOffsets in aIndex array are relative to this
   dwReserved3.l                         ; ULONG   ; must be 0
   *aIndex.avistdindex_entry
End NEWTYPE


NEWTYPE .track_t
   a_fmt.l                               ; LONG    ; Audio format, see #defines below
   a_chans.l                             ; LONG    ; Audio channels, 0 for no audio
   a_rate.l                              ; LONG    ; Rate in Hz
   a_bits.l                              ; LONG    ; bits per audio sample
   mp3rate.l                             ; LONG    ; mp3 bitrate kbs
   a_vbr.l                               ; LONG    ; 0 == no Variable BitRate

   audio_strn.l                          ; LONG    ; Audio stream number
   audio_bytes.l                                   ; Total number of bytes of audio data
   audio_chunks.l                        ; LONG    ; Chunks of audio data in the file

   *audio_tag.b[4]                       ; CHAR    ; Tag of audio data
   audio_posc.l                          ; LONG    ; Audio position: chunk
   audio_posb.l                          ; LONG    ; Audio position: byte within chunk

   a_codech_off.l                                  ; absolut offset of audio codec information
   a_codecf_off.l                                  ; absolut offset of audio codec information

   *audio_index.audio_index_entry
   *audio_superindex.avisuperindex_chunk
End NEWTYPE


NEWTYPE .avi_t
   fdes.l                                ; LONG    ; File descriptor of AVI file
   mode.l                                ; LONG    ; 0 for reading, 1 for writing

   width.l                               ; LONG    ; Width  of a video frame
   height.l                              ; LONG    ; Height of a video frame
   fps.d                                 ; DOUBLE  ; Frames per second
   *compressor.b[8]                      ; CHAR    ; Type of compressor, 4 bytes + padding for 0 byte
   *compressor2.b[8]                     ; CHAR    ; Type of compressor, 4 bytes + padding for 0 byte
   video_strn.l                          ; LONG    ; Video stream number
   video_frames.l                        ; LONG    ; Number of video frames
   *video_tag.b[4]                       ; CHAR    ; Tag of video data
   video_pos.l                           ; LONG    ; Number of next frame to be read
   ; (if index present)

   max_len.l                             ; ULONG   ; maximum video chunk present

   track.track_t[#AVI_MAX_TRACKS]                  ; up to AVI_MAX_TRACKS audio tracks supported

   pos.l                                           ; position in file
   n_idx.l                               ; LONG    ; number of index entries actually filled
   max_idx.l                             ; LONG    ; number of index entries actually allocated

   v_codech_off.l                                  ; absolut offset of video codec (strh) info
   v_codecf_off.l                                  ; absolut offset of video codec (strf) info

   *idx.b[16]                            ; UCHAR   ; index entries (AVI idx1 tag)

   *video_index.video_index_entry
   *video_superindex.avisuperindex_chunk           ; index of indices
   is_opendml.l                          ; INT     ; set to 1 if this is an odml file with multiple index chunks

   last_pos.l                                      ; Position of last frame written
   last_len.l                            ; ULONG   ; Length of last frame written
   must_use_index.l                      ; INT     ; Flag if frames are duplicated
   movi_start.l

   anum.l                                ; INT     ; total number of audio tracks
   aptr.l                                ; INT     ; current audio working track
   comment_fd.l                          ; INT     ; Read avi header comments from this fd
   *index_file.b                         ; CHAR    ; read the avi index from this file
End NEWTYPE


#AVI_MODE_WRITE                = 0
#AVI_MODE_READ                 = 1

; The error codes delivered by avi_open_input_file

#AVI_ERR_SIZELIM               = 1 ; The write of the data would exceed
; the maximum size of the AVI file.
; This is more a warning than an error
; since the file may be closed safely

#AVI_ERR_OPEN                  = 2 ; Error opening the AVI file - wrong path
; name or file nor readable/writable

#AVI_ERR_READ                  = 3 ; Error reading from AVI File

#AVI_ERR_WRITE                 = 4 ; Error writing to AVI File,
; disk full ???

#AVI_ERR_WRITE_INDEX           = 5 ; Could not write index to AVI file
; during close, file may still be
; usable

#AVI_ERR_CLOSE                 = 6 ; Could not write header to AVI file
; or not truncate the file during close,
; file is most probably corrupted

#AVI_ERR_NOT_PERM              = 7 ; Operation not permitted:
; trying to read from a file open
; for writing or vice versa

#AVI_ERR_NO_MEM                = 8 ; malloc failed

#AVI_ERR_NO_AVI                = 9 ; Not an AVI file

#AVI_ERR_NO_HDRL               = 10 ; AVI file has no has no header list,
; corrupted ???

#AVI_ERR_NO_MOVI               = 11 ; AVI file has no has no MOVI list,
; corrupted ???

#AVI_ERR_NO_VIDS               = 12 ; AVI file contains no video data

#AVI_ERR_NO_IDX                = 13 ; The file has been opened with
; getIndex==0, but an operation has been
; performed that needs an index

; Possible Audio formats

#WAVE_FORMAT_UNKNOWN           = ($0000)
#WAVE_FORMAT_PCM               = ($0001)
#WAVE_FORMAT_ADPCM             = ($0002)
#WAVE_FORMAT_IBM_CVSD          = ($0005)
#WAVE_FORMAT_ALAW              = ($0006)
#WAVE_FORMAT_MULAW             = ($0007)
#WAVE_FORMAT_OKI_ADPCM         = ($0010)
#WAVE_FORMAT_DVI_ADPCM         = ($0011)
#WAVE_FORMAT_DIGISTD           = ($0015)
#WAVE_FORMAT_DIGIFIX           = ($0016)
#WAVE_FORMAT_YAMAHA_ADPCM      = ($0020)
#WAVE_FORMAT_DSP_TRUESPEECH    = ($0022)
#WAVE_FORMAT_GSM610            = ($0031)
#IBM_FORMAT_MULAW              = ($0101)
#IBM_FORMAT_ALAW               = ($0102)
#IBM_FORMAT_ADPCM              = ($0103)


NEWTYPE .riff_struct
   *id.b[4]                              ; UCHAR   ; RIFF
   llen.l                                ; ULONG
   *wave_id.b[4]                         ; UCHAR   ; WAVE
End NEWTYPE


NEWTYPE .chunk_struct
   *id.b[4]                              ; UCHAR
   llen.l                                ; ULONG
End NEWTYPE


NEWTYPE .common_struct
   wFormatTag.w                          ; USHORT
   wChannels.w                           ; USHORT
   dwSamplesPerSec.l                     ; ULONG
   dwAvgBytesPerSec.l                    ; ULONG
   wBlockAlign.w                         ; USHORT
   wBitsPerSample.w                      ; USHORT  ; Only for PCM
End NEWTYPE


NEWTYPE .wave_header
   riff.riff_struct                      ; STRUCT
   form.chunk_struct                     ; STRUCT
   common.common_struct                  ; STRUCT
   ddata.chunk_struct                    ; STRUCT
End NEWTYPE


NEWTYPE .AVIStreamHeader
   fccType.l                             ; LONG
   fccHandler.l                          ; LONG
   dwFlags.l                             ; LONG
   dwPriority.l                          ; LONG
   dwInitialFrames.l                     ; LONG
   dwScale.l                             ; LONG
   dwRate.l                              ; LONG
   dwStart.l                             ; LONG
   dwLength.l                            ; LONG
   dwSuggestedBufferSize.l               ; LONG
   dwQuality.l                           ; LONG
   dwSampleSize.l                        ; LONG
End NEWTYPE


