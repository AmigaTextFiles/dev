;sshapec is the shape to save
;(the original subroutine had a loop for saving more than one shape)

shapesave:

InitBank 10,100000,0                  ;might need a bigger buffer
b10ad.l=Bank(10)

 ad=Addr Shape(sshapec)               ;start of the shape structure

 bpdata.l=Peek.l(ad+14)               ;get Shape\_data.l (pointer to graphic
                                      ;                   data)
 onebpmem.w=Peek.w(ad+22)             ;and Shape\_onebpmem.w (memory taken by one
                                      ;                       plane of the shape)

 x=CopyMem_(ad,b10ad,32)   :b10ad+32  ;copy the header data into the bank
 z=CopyMem_(bpdata,b10ad,onebpmem*7)  ;copy all the bitplanes (7 in this case)
                                      ;into the bank

 b10ad+(onebpmem*7)                   ;update the counter so we know where the
                                      ;data finishes

 If BSave(sshapefile$,Bank(10),b10ad-Bank(10)) : Else : Stop : EndIf ;save the
                                                                     ;bank
Free Bank 10                          ;free the temporary bank
Return
