;
; Conversion of the BFBPlayer library includes for blitz
; By Robert Hutchinson and David McMinn (17/04/1999)
;
; Include file V1.00
;

Dim tags.TagItem(2)
result.l=0

NEWTYPE .bfbsamplebase
  Flags.w
  Text.s
End NEWTYPE
Dim List BFBSamples.bfbsamplebase(255)


; ----> Commands, In no specific order ;)

Function.b BFBLoadModule{Path$}
  SHARED NPath$,tags(),*modinfo.ModInfo
  NPath$=Path$
  tags(0)\ti_Tag = #BFBTAG_SongName,&NPath$
  tags(1)\ti_Tag = #BFBTAG_ModInfo,0
  tags(2)\ti_Tag = #TAG_DONE
  result=BFBLoadModule_(&tags(0))
  If result=0
    *modinfo.ModInfo = tags(1)\ti_Data
  EndIf
  Function Return result
End Statement

Function.s BFBParseError{ErrCode}
  SHARED NPath$
  ErrAddr.l=BFBGetError_(ErrCode)
  Error$=PeekTo$(ErrAddr,0)
  Function Return Error$
End Statement

Function.b BFBNextPattern{} ;Returns 0 for success, -1 for a failure! (-1, module doesn`t support pattern jumping)
  SHARED *modinfo.ModInfo
  result=BFBNextPage_(*modinfo)
  Function Return result
End Function

Function.b BFBPrevPattern{} ;Returns 0 for success, -1 for a failure! (-1, module doesn`t support pattern jumping)
  SHARED *modinfo.ModInfo
  result=BFBPreviousPage_(*modinfo)
  Function Return result
End Function

Function.b BFBPlayModule{}
  SHARED *modinfo.ModInfo
  result=BFBPlayModule_(*modinfo)
  Function Return result
End Function

Statement BFBStopModule{}
  SHARED *modinfo.ModInfo
  BFBStopModule_ *modinfo
End Statement

Statement BFBFreeModule{}
  SHARED *modinfo.ModInfo
  BFBUnLoadModule_ *modinfo
  *modinfo.ModInfo       = 0
  *modinfo\mi_moduletype = 0
  *modinfo\mi_playflag   = 0
End Statement

Function.b BFBContModule{} ;Returns 0 for success, -1 for a failure!
  SHARED *modinfo.ModInfo
  result=BFBContModule_(*modinfo)
  If result=-1
    Function Return False
  Else
    Function Return True
  EndIf
End Function


Function.b BFBMaxSongs{}
  SHARED *modinfo.ModInfo
  If *modinfo\mi_moduletype<>-1
    SNGS=*modinfo\mi_songs+1
    Function Return SNGS
  Else
    Function Return -1
  EndIf
End Function

Function.w BFBCurrentSong{}
  SHARED *modinfo.ModInfo
  Function Return *modinfo\mi_currentsong
End Function

Function.b BFBChangeSong{SongNum.b}
  SHARED *modinfo.ModInfo
  result=BFBChangeModule_(*modinfo)
  Function Return result
End Function

Function.s BFBModuleType{}
  SHARED *modinfo.ModInfo
  ModType$=PeekTo$(*modinfo\mi_moduletypename,0)
  Function Return ModType$
End Function

Function.s BFBModuleName{}
  SHARED *modinfo.ModInfo,NPath$
  ModName$=PeekTo$(*modinfo\mi_modulename,0)
  If ModName$="" OR ModName$=" "
    For TCP=Len(NPath$) To 0 Step -1
      If MDone=0
        Strip$=Mid$(NPath$,TCP,1)
        If Strip$="/" OR Strip$=":"
          ModName$=Right$(NPath$,Len(NPath$)-TCP)
          MDone=1
        EndIf
      EndIf
    Next
    If MDone=0
      ModName$=NPath$
    Else
      MDone=0
    EndIf
  EndIf
  Function Return ModName$
End Function

Function.w BFBMaxPositions{}
  SHARED *modinfo.ModInfo
  Function Return *modinfo\mi_positions
End Function

Function.w BFBCurrentPosition{}
  SHARED *modinfo.ModInfo
  Function Return *modinfo\mi_currentposition
End Function

Function.b BFBModPlaying{}
  SHARED *modinfo.ModInfo
  If *modinfo\mi_playflag=1
    Function Return True
  Else
    Function Return False
  EndIf
End Function

Function.b BFBModLoaded{}
  SHARED *modinfo.ModInfo
  If *modinfo\mi_moduletype=-1 OR *modinfo\mi_moduletype=0
    Function Return False
  Else
    Function Return True
  EndIf
End Function

Function.w BFBPlayPercentage{}
  SHARED *modinfo.ModInfo
  PCur=*modinfo\mi_currentposition
  PMax=*modinfo\mi_positions
  Function Return Int(PCur*100/PMax)
End Function

Statement BFBInitSamples{}
  SHARED *samplenames.SampleNames,*modinfo.ModInfo
  *samplenames.SampleNames = BFBGetSamplenames_(*modinfo)
End Statement

Function.l BFBMaxSamples{}
  SHARED *samplenames.SampleNames,*modinfo.ModInfo
  Function Return *samplenames\sn_NumberOfStrings
End Statement

Function.s BFBGetSampleName{SampleNum}
  SHARED *samplenames.SampleNames,*modinfo.ModInfo
  SamName$=PeekTo$(*samplenames\sn_SampleNames[SampleNum],0)
  Function Return SamName$
End Function

Function.l BFBModuleLength{}
  SHARED *modinfo.ModInfo
  Function Return *modinfo\mi_bufferlen
End Function


