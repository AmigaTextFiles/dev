
; CrM.include.bb2 generated by FD2inc.


DEFTYPE .Library *_CrMBase

Macro CrM_cmLoadSeg ; {ret}
   GetReg a6,*_CrMBase : JSR -30(a6) : PutReg d0,`1
End Macro

Macro CrM_cmPrivate1 ; {ret}
   GetReg a6,*_CrMBase : JSR -36(a6) : PutReg d0,`1
End Macro

Macro CrM_cmCheckCrunched ; {ret,DataHeader}
   GetReg A0,`2
   GetReg a6,*_CrMBase : JSR -42(a6) : PutReg d0,`1
End Macro

Macro CrM_cmDecrunch ; {ret,Source,Destination,DataHeader}
   GetReg A0,`2 : GetReg A1,`3 : GetReg A2,`4
   GetReg a6,*_CrMBase : JSR -48(a6) : PutReg d0,`1
End Macro

Macro CrM_cmProcessPW ; {ret,Password,Action}
   GetReg A0,`2 : GetReg D0,`3
   GetReg a6,*_CrMBase : JSR -54(a6) : PutReg d0,`1
End Macro

Macro CrM_cmCryptData ; {ret,DataHeader,Data,Password,Action}
   GetReg A0,`2 : GetReg A1,`3 : GetReg A2,`4 : GetReg D0,`5
   GetReg a6,*_CrMBase : JSR -60(a6) : PutReg d0,`1
End Macro

Macro CrM_cmProcessCrunchStructA ; {ret,CrunchStruct,Action,Tags}
   GetReg A1,`2 : GetReg D0,`3 : GetReg A0,`4
   GetReg a6,*_CrMBase : JSR -66(a6) : PutReg d0,`1
End Macro

Macro CrM_cmCrunchData ; {ret,CrunchStruct}
   GetReg A0,`2
   GetReg a6,*_CrMBase : JSR -72(a6) : PutReg d0,`1
End Macro

Macro CrM_cmAllocCrunchStructA ; {ret,Tags}
   GetReg A0,`2
   GetReg a6,*_CrMBase : JSR -78(a6) : PutReg d0,`1
End Macro

Macro CrM_cmFreeCrunchStruct ; {CrunchStruct}
   GetReg A0,`1
   GetReg a6,*_CrMBase : JSR -84(a6)
End Macro


Function.l CrM_InitLib {minVersion.l}
   SHARED *_CrMBase
   If *_CrMBase Then Function Return *_CrMBase
   If minVersion<0 Then minVersion = 0
   *_CrMBase = OpenLibrary_ ("CrM.library",minVersion)
   Function Return *_CrMBase
End Function


Statement CrM_FreeLib {}
   SHARED *_CrMBase
   If *_CrMBase Then CloseLibrary_ *_CrMBase : *_CrMBase = 0
End Statement


;-----------------------------------------------------------------------------------------


; C to Blitz conversion done by c2b.

; ** $Filename: libraries/crm.h $
; ** $Release: 4.0 $
; **      $Date: 26-Sep-93 $
; **
; ** CrM.library include and definition file
; **
; ** (c) 1992-3 Thomas Schwarz
; ** All Rights Reserved


CRMNAME$                       = "CrM.library"

#CRMVERSION                    = 4

; *************
; * Data Header
; *************

NEWTYPE .DataHeader
   dh_ID.l                               ; ULONG
   dh_MinSecDist.w                       ; WORD
   dh_OriginalLen.l                      ; ULONG
   dh_CrunchedLen.l                      ; ULONG
End NEWTYPE

; **************
; * CurrentStats
; **************

NEWTYPE .cmCurrentStats
   cmcu_ToGo.l                           ; ULONG
   cmcu_Len.l                            ; ULONG
End NEWTYPE

; *******************
; ** CrunchStruct(ure)
; *******************

NEWTYPE .cmCrunchStruct
   *cmcr_Src.l                           ; APTR    ; Source Start
   cmcr_SrcLen.l                         ; ULONG   ; Source Len
   *cmcr_Dest.l                          ; APTR    ; Destination Start
   cmcr_DestLen.l                        ; ULONG   ; Destination Len (maximum)
   *cmcr_DataHdr.DataHeader              ; STRUCT  ; DataHeader
   *cmcr_DisplayHook.Hook                ; STRUCT  ; Hook to display ToGo/Gain Counters
   ;** Registers hold these values when the Hook is called:
   ;** a0:struct Hook*  a2:struct cmCrunchStruct*  a1:struct cmCurrentStats*
   ;** you have to return TRUE/FALSE in d0 to continue/abort crunching!
   cmcr_DisplayStep.w                    ; UWORD   ; time between 2 calls to the Hook
   ;******* readonly: *******
   cmcr_Offset.w                         ; UWORD   ; desired Offset
   cmcr_HuffSize.w                       ; UWORD   ; HuffLen in KBytes
   cmcr_Algo.w                           ; UWORD   ; desired Packalgorithm
   cmcr_MaxOffset.l                      ; ULONG   ; biggest possible Offset (Buffer allocated)
   cmcr_RealOffset.l                     ; ULONG   ; currently used Offset
   cmcr_MinSecDist.l                     ; ULONG   ; MinSecDist for packed Data
   cmcr_CrunchedLen.l                    ; ULONG   ; Length of crunched Data at cmcr_Dest
   ;******* private: *******
   cmcr_HuffTabs.l                       ; ULONG
   cmcr_HuffBuf.l                        ; ULONG
   cmcr_HuffLen.l                        ; ULONG
   cmcr_SpeedLen.l                       ; ULONG
   cmcr_SpeedTab.l                       ; ULONG
   cmcr_MegaSpeedTab.l                   ; ULONG
   cmcr_QuitFlag.b                       ; UBYTE   ; readonly: reason for failure
   cmcr_OverlayFlag.b                    ; UBYTE
   cmcr_LEDFlashFlag.b                   ; UBYTE
   cmcr_Pad.b                            ; UBYTE
   ; CrunchStruct continues here, but LEAVE YOUR HANDS OFF!!!
End NEWTYPE

; ************************************
; ** Result Codes of cmCheckCrunched()
; ** and Symbols for the CMCS_Algo Tag
; ************************************
#cm_Normal                     = 1
#cm_LZH                        = 2
#cmB_Sample                    = 4
#cmF_Sample                    = (1 LSL #cmB_Sample)
#cmB_PW                        = 5
#cmF_PW                        = (1 LSL #cmB_PW)
#cmB_Overlay                   = 8 ; only for the
#cmF_Overlay                   = (1 LSL #cmB_Overlay) ; CMCS_Algo Tag!
#cmB_LEDFlash                  = 9 ; only for the
#cmF_LEDFlash                  = (1 LSL #cmB_LEDFlash) ; CMCS_Algo Tag!

;* Use this mask to get the crunch algorithm without any other flags:
#cm_AlgoMask                   = $F

; *********************************
; ** Action Codes for cmProcessPW()
; *********************************
#cm_AddPW                      = 1
#cm_RemovePW                   = 2
#cm_RemoveAll                  = 3

; *********************************
; ** Action Codes for cmCryptData()
; *********************************
#cm_EnCrypt                    = 4
#cm_DeCrypt                    = 5

; *******************************************
; ** Action Codes for cmProcessCrunchStruct()
; *******************************************
#cm_AllocStruct                = 6
#cm_FreeStruct                 = 7

; ***********************************
; ** Tags for cmProcessCrunchStruct()
; ***********************************
#CM_TagBase                    = #TAG_USER
#CMCS_Algo                     = (#CM_TagBase+1) ; default: cm_LZH
#CMCS_Offset                   = (#CM_TagBase+2) ; default: $7ffe
#CMCS_HuffSize                 = (#CM_TagBase+3) ; default: 16

; *******************************************
; ** for older Code, _DON'T_ use in new code:
; *******************************************
; #dh_OrginalLen                 = #dh_OriginalLen  ????????????????????????????????
#cm_Sample                     = 16
#cm_NormSamp                   = (#cm_Normal|#cm_Sample)
#cm_LZHSamp                    = (#cm_LZH|#cm_Sample)


