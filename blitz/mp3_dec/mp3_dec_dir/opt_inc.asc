
; "opt_inc.bb2"

; AB2/3 optimizer wrapper by Lorence Lombardo

; 12-January-2013 to 15-January-2013

; Needs ROM2.0 or higher just like AB2/3. ;)

; Needs "all.res" or "AmigaLibs.res" for constants
; & structures. Alternatively put the constants and
; structures in directly yourself. ;)


Macro opt_val : #OPT=`1


CNIF (#OPT AND 1) OR (#OPT AND 2)

Statement err_req{msg$}
   DEFTYPE .EasyStruct es : but$="ok" : tit$=" Error...!!!"
   es\es_StructSize = SizeOf .EasyStruct
   es\es_Flags = 0
   es\es_Title = &tit$
   es\es_TextFormat = &msg$
   es\es_GadgetFormat = &but$
   EasyRequestArgs_ 0, &es, 0, 0 : Exit_(0) ; <- Used Exit coz End some times
End Statement                               ;    crashes here.

attn.l=Peek.w(Peek.l(4)+296)

CEND


CNIF (#OPT AND 1)
   cpu.b=0 : If (attn AND #AFF_68020) Then cpu=1
   If cpu=0 Then err_req{"Need a 68020 or higher CPU."}
CEND

CNIF (#OPT AND 2)
   fpu.b=0 : If (attn AND 16) OR (attn AND 32) Then fpu=1
   If fpu=0 Then err_req{"Need some FPU to run."}
CEND

optimize `1 : End Macro




