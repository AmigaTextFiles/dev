
; timer.include.bb2 generated by FD2inc.


DEFTYPE .Library *_TimerBase

Macro timer_AddTime ; {dest,src}
   GetReg a0,`1 : GetReg a1,`2
   GetReg a6,*_TimerBase : JSR -42(a6)
End Macro

Macro timer_SubTime ; {dest,src}
   GetReg a0,`1 : GetReg a1,`2
   GetReg a6,*_TimerBase : JSR -48(a6)
End Macro

Macro timer_CmpTime ; {ret,dest,src}
   GetReg a0,`2 : GetReg a1,`3
   GetReg a6,*_TimerBase : JSR -54(a6) : PutReg d0,`1
End Macro

Macro timer_ReadEClock ; {ret,dest}
   GetReg a0,`2
   GetReg a6,*_TimerBase : JSR -60(a6) : PutReg d0,`1
End Macro

Macro timer_GetSysTime ; {dest}
   GetReg a0,`1
   GetReg a6,*_TimerBase : JSR -66(a6)
End Macro


Function.l timer_Init {tunit.l}
   SHARED *_TimerBase, *tr.timerequest
   If *_TimerBase Then Function Return *_TimerBase
   *tr=AllocVec_ (SizeOf .timerequest, #MEMF_PUBLIC)
   If *tr
      err.l = OpenDevice_ ("timer.device",tunit,*tr,0)
      If err
         FreeVec_ *tr : *tr = 0 : *_TimerBase=0
      Else
         *_TimerBase = *tr\tr_node\io_Device
      EndIf
   Else
      *_TimerBase=0
   EndIf
   Function Return *_TimerBase
End Function


Statement timer_Free {}
   SHARED *_TimerBase, *tr
   If *_TimerBase Then CloseDevice_ *tr : *_TimerBase = 0
   If *tr Then FreeVec_ *tr : *tr = 0
End Statement



