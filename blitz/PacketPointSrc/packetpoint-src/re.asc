;
; Routine fuer das Hauptprogarmm (Main-Menu)
;

  ResetList Liste()
  Auswahl=0
  CloseWin = False

  Repeat
    If Event = 0
      Wait
    EndIf
    arexxmsg.l=RexxEvent(arexxport)
    If arexxmsg<>0 Then Gosub arexx
    If AppEvent = $80000 Then Gosub appevents
    EventType.l = Event

    Use Window 0
    windowxpos=WindowX
    windowypos=WindowY

    Select EventType
      Case #IDCMP_REFRESHWINDOW
        GT_BeginRefresh_ Peek.l (Addr Window(0))
        GT_EndRefresh_ Peek.l (Addr Window(0)),True
      Case $00000200
        CloseWin = True
      Case $00000100
        Select MenuHit
          Case 0
            Select ItemHit
              Case 0: Gosub netcall
              Case 1: Gosub load_puffer
              Case 2: Gosub save_puffer
              Case 3: Gosub kill_puffer
              Case 5: Gosub help
              Case 7: Gosub about
              Case 8: CloseWin=True
            End Select
          Case 1
            Select ItemHit
              Case  0:subjekt$="RE:"+Mail(Auswahl)\subject:empfaenger$=Mail(Auswahl)\absender
                      reply$=Mail(Auswahl)\absender:Gosub versand
              Case  1:subjekt$="RE:"+Mail(Auswahl)\subject:reply$=Mail(Auswahl)\absender
                      empfaenger$=Mail(Auswahl)\empfaenger:Gosub versand
              Case  2: weiterleiten=1:empfaenger$=Mail(Auswahl)\empfaenger:subjekt$=Mail(Auswahl)\subject
                       absender$=Mail(Auswahl)\absender:Gosub versand
              Case  3: Gosub drucken
              Case  4: Gosub editieren
              Case  6: Gosub save_absender
              Case  7: Gosub user_filtern
              Case  9: subjekt$="":empfaenger$="":absender$="":new_mail=1:reply$="":Gosub versand
              Case 11: Gosub entpacken
              Case 13: Gosub nachrichten_info
              Case 14: Gosub pathkarte
              Case 15: Gosub search
            End Select
          Case 2
            Gosub befehle
          Case 3
            Select ItemHit
              Case 0:
                cmd$=pgp_path$+" -ka "+puffer_laden$+Chr$(10)+"WAIT 5"+Chr$(10)+"ENDCLI"
                cli$="con:0/0/"+Str$(WBWidth)+"/"+Str$(WBHeight)+""
                If WriteFile(0,cli$)
                  WBenchToFront_
                  Execute_ &cmd$,Peek.l(Addr File(0)),0
                  WBenchToBack_
                  CloseFile 0
                EndIf
              Case 1:
                x=0
                If WriteFile(0,"ram:mail.pgp")
                  FileOutput 0
                  While x<y
                    x=x+1
                    NPrint text$(x)
                  Wend
                  CloseFile 0
                  DefaultOutput
                EndIf
                cmd$=pgp_path$+" ram:mail.pgp"+Chr$(10)+"WAIT 5"+Chr$(10)+"ENDCLI"
                cli$="con:0/0/"+Str$(WBWidth)+"/"+Str$(WBHeight)+""
                If WriteFile(0,cli$)
                  WBenchToFront_
                  Execute_ &cmd$,Peek.l(Addr File(0)),0
                  WBenchToBack_
                  CloseFile 0
                EndIf
                DeleteFile_("ram:mail.pgp")
                editor$=Replace$(editor_prefs$,"%s","ram:mail")
                Execute_ editor$,0,0
                DeleteFile_("ram:mail")
              Case 2:
                x=0
                If WriteFile(0,"ram:mail.pgp")
                  FileOutput 0
                  While x<y
                    x=x+1
                    NPrint text$(x)
                  Wend
                  CloseFile 0
                  DefaultOutput
                EndIf
                If passwort_erfragen=1 AND Exists("env:PGPPASS")=0

                  Window        14,3,192,637,64,$0000000F,locale$(245),1,2
                  GTString      14,0,135,15,460,15,locale$(246),$0001,256,""
                  AttachGTList  14,14

                  CloseWin = False
                  Repeat
                    EventType.l = WaitEvent
                    Select EventType
                      Case #IDCMP_REFRESHWINDOW
                        GT_BeginRefresh_ Peek.l (Addr Window(14))
                        GT_EndRefresh_ Peek.l (Addr Window(14)),True
                      Case $00000200
                        CloseWin = True
                      Case $00000040
                        Select GadgetHit
                          Case 0
                            CloseWin = True
                            Execute_"setenv PGPPASS "+GTGetString(14,0),0,0
                        End Select
                        CloseWin=True
                    End Select
                  Until CloseWin
                  CloseWin = False
                  CloseWindow 14
                  DetachGTList 14
                  Free GTList 14
                EndIf
                cmd$=pgp_path$+" ram:mail.pgp"+Chr$(10)+"WAIT 5"+Chr$(10)+"ENDCLI"
                cli$="con:0/0/"+Str$(WBWidth)+"/"+Str$(WBHeight)+""
                If WriteFile(0,cli$)
                  WBenchToFront_
                  Execute_ &cmd$,Peek.l(Addr File(0)),0
                  WBenchToBack_
                  CloseFile 0
                EndIf
                DeleteFile_("ram:mail.pgp")
                editor$=Replace$(editor_prefs$,"%s","ram:mail")
                Execute_ editor$,0,0
                DeleteFile_("ram:mail")
              Case 3:
                cmd$=pgp_path$+" -kxa "+user_id$+" pgpkey.pp"+Chr$(10)+"wait 5"+Chr$(10)+"ENDCLI"
                cli$="con:0/0/"+Str$(WBWidth)+"/"+Str$(WBHeight)+""
                If WriteFile(0,cli$)
                  WBenchToFront_
                  Execute_ &cmd$,Peek.l(Addr File(0)),0
                  WBenchToBack_
                  CloseFile 0
                EndIf
                NameFile "pgpkey.pp.asc","pgpkey.pp"
                DeleteFile_("pgpkey.pp.asc")
            End Select
          Case 4
            Select ItemHit
              Case  0: Gosub load_prefs
              Case  1: Gosub save_prefs
              Case  3: ClearList User():ResetList User()
                If OpenFile(0,"absender.pp")
                  FileInput 0
                  While NOT Eof(0)
                    If AddItem(User())
                      User()\Text=Edit$(999)
                    EndIf
                  Wend
                  DefaultInput
                  CloseFile 0
                EndIf

                GTListView    4,0,0,0,309,116,"",$0000,User()
                GTString      4,1,1,116,308,14,"",$0040,256,""
                GTButton      4,2,16,130,69,12,locale$(226),$0010
                GTButton      4,3,85,130,69,12,locale$(227),$0040
                GTButton      4,4,154,130,69,12,locale$(228),$0010
                GTButton      4,5,223,130,69,12,locale$(229),$0010
                Window        4,115,11,332,155,$0000000F,"",1,2
                AttachGTList  4,4

                CloseWin = False
                Repeat
                  EventType.l = WaitEvent
                  Select EventType
                    Case $00000200
                      CloseWin = True

                    Case $00000040
                      Select GadgetHit
                        Case 0:
                          Auswahl.w=EventCode

                          ResetList User()
                          For a=0 To Auswahl
                            If NextItem (User()) Then ok=0
                          Next

                          GTEnable  4,1
                          GTSetString 4,1,User()\Text
                          ActivateString 4,1
                          GTEnable 4,3
                          Redraw 4,3
                        Case 1
                          GTChangeList 4,0
                          User(Auswahl)\Text=GTGetString (4,1)
                          GTChangeList 4,0,User()
                          GTSetString 4,1,""
                          GTDisable 4,1
                          Redraw 4,1
                          GTDisable 4,3
                          Redraw 4,3
                        Case 2
                          GTChangeList 4,0
                          If AddLast (User())
                            GTEnable 4,1
                            GTSetString 4,1,""
                            ActivateString 4,1
                            User()\Text=GTGetString(4,1)
                            GTDisable 4,3
                            Redraw 4,3
                            Auswahl=Anzahl.w
                            Anzahl+1
                          EndIf
                          GTChangeList 4,0,User()
                        Case 3
                          GTChangeList 4,0
                          Pos=0
                          ResetList User()
                          Repeat
                            NextItem User()
                            Pos+1
                          Until Pos>Auswahl
                          KillItem User()
                          Anzahl-1

                          GTSetString 4,1,""
                          GTDisable 4,1
                          Redraw 4,1
                          GTDisable 4,3
                          Redraw 4,3

                          GTChangeList 4,0,User()
                        Case 4
                          GTChangeList 4,0
                          ClearList User()
                          ResetList User()
                          If OpenFile(0,"absender.pp")
                            FileInput 0
                            While NOT Eof(0)
                              If AddItem(User())
                                User()\Text=Edit$(999)
                              EndIf
                            Wend
                            DefaultInput
                            CloseFile 0
                          EndIf
                          GTChangeList 4,0,User()
                          Redraw 4,0
                        Case 5
                          DeleteFile_("absender.pp")
                          If OpenFile(0,"absender.pp")
                            FileOutput 0
                            ResetList User()
                            While NextItem(User())
                              NPrint User()\Text
                            Wend
                            DefaultInput
                            CloseFile 0
                          EndIf
                      End Select
                  End Select
                Until CloseWin
                CloseWindow 4
                Free GTList 4
                CloseWin=False
              Case  4:
                ClearList Brett()
                ResetList Brett()

                If OpenFile(0,"bretter.pp")
                  FileInput 0
                  While NOT Eof(0)
                    If AddItem(Brett())
                      Brett()\Text=Edit$(999)
                    EndIf
                  Wend
                  DefaultInput
                  CloseFile 0
                EndIf

                GTListView    4,0,0,0,309,116,"",$0000,Brett()
                GTString      4,1,1,116,308,14,"",$0040,256,""
                GTButton      4,2,16,130,69,12,locale$(222),$0010
                GTButton      4,3,85,130,69,12,locale$(223),$0040
                GTButton      4,4,154,130,69,12,locale$(224),$0010
                GTButton      4,5,223,130,69,12,locale$(225),$0010
                Window        4,115,11,332,155,$0000000F,"",1,2
                AttachGTList  4,4

                Anzahl.w=0
                Auswahl.w=0

                CloseWin = False
                Repeat
                  EventType.l = WaitEvent
                  Select EventType
                    Case $00000200
                      CloseWin = True
                    Case $00000040
                      Select GadgetHit
                        Case 0:
                          Auswahl=EventCode

                          ResetList Brett()
                          For a=0 To Auswahl
                            If NextItem (Brett()) Then ok=0
                          Next

                          GTEnable  4,1
                          GTSetString 4,1,Brett()\Text
                          ActivateString 4,1
                          GTEnable 4,3
                          Redraw 4,3
                        Case 1
                          GTChangeList 4,0
                          Brett(Auswahl)\Text=GTGetString (4,1)
                          GTChangeList 4,0,User()
                          GTSetString 4,1,""
                          GTDisable 4,1
                          Redraw 4,1
                          GTDisable 4,3
                          Redraw 4,3
                        Case 2
                          GTChangeList 4,0
                          If AddLast (Brett())
                            GTEnable 4,1
                            GTSetString 4,1,""
                            ActivateString 4,1
                            Brett()\Text=GTGetString(4,1)
                            GTDisable 4,3
                            Redraw 4,3
                            Auswahl=Anzahl
                            Anzahl+1
                          EndIf
                          GTChangeList 4,0,Brett()
                        Case 3
                          GTChangeList 4,0
                          Pos=0
                          ResetList Brett()
                          Repeat
                            NextItem Brett()
                              Pos+1
                          Until Pos>Auswahl
                          KillItem Brett()
                          Anzahl-1

                          GTSetString 4,1,""
                          GTDisable 4,1
                          Redraw 4,1
                          GTDisable 4,3
                          Redraw 4,3

                          GTChangeList 4,0,Brett()
                        Case 4
                          GTChangeList 4,0
                          ClearList Brett()
                          ResetList Brett()
                          If OpenFile(0,"bretter.pp")
                            FileInput 0
                            While NOT Eof(0)
                              If AddItem(Brett())
                                Brett()\Text=Edit$(999)
                              EndIf
                            Wend
                            DefaultInput
                            CloseFile 0
                          EndIf
                          GTChangeList 4,0,Brett()
                          Redraw 4,0
                        Case 5
                          DeleteFile_("bretter.pp")
                          If OpenFile(0,"bretter.pp")
                            FileOutput 0
                            ResetList Brett()
                            While NextItem(Brett())
                              NPrint Brett()\Text
                            Wend
                            DefaultInput
                            CloseFile 0
                          EndIf
                     End Select
                  End Select
                Until CloseWin
                CloseWindow 4
                Free GTList 4
                CloseWin=False

              Case  7: Gosub user_prefs
              Case  8: Gosub mbx_prefs
              Case  9: Gosub serial_prefs
              Case  6: Gosub allgemeine_prefs
              Case 11:
                Window        14,3,192,637,64,$0000000F,locale$(230),1,2
                GTString      14,0,135,15,460,15,locale$(231),$0001,256,""
                AttachGTList  14,14

                CloseWin = False
                Repeat
                  EventType.l = WaitEvent
                  Select EventType
                    Case #IDCMP_REFRESHWINDOW
                      GT_BeginRefresh_ Peek.l (Addr Window(14))
                      GT_EndRefresh_ Peek.l (Addr Window(14)),True

                    Case $00000200
                      CloseWin = True

                    Case $00000040
                      Select GadgetHit
                        Case 0
                           passwort$=GTGetString(14,0)
                           CloseWin=True
                      End Select
                      CloseWin=True
                  End Select
                Until CloseWin
                CloseWindow 14
                Free GTList 14
                CloseWin=False
              Case 12:
              passwort_an+1
              If passwort_an=2 Then passwort_an=0

            End Select
          Case 5
            Select ItemHit
              Case  0:Gosub arexx_prefs
              Case  2:marko=False:Gosub arexxmarko
              Case  4:marko=True:rexxmarko$=marko$(1):Gosub arexxmarko
              Case  5:marko=True:rexxmarko$=marko$(2):Gosub arexxmarko
              Case  6:marko=True:rexxmarko$=marko$(3):Gosub arexxmarko
              Case  7:marko=True:rexxmarko$=marko$(4):Gosub arexxmarko
              Case  8:marko=True:rexxmarko$=marko$(5):Gosub arexxmarko
              Case  9:marko=True:rexxmarko$=marko$(6):Gosub arexxmarko
              Case 10:marko=True:rexxmarko$=marko$(7):Gosub arexxmarko
              Case 11:marko=True:rexxmarko$=marko$(8):Gosub arexxmarko
              Case 12:marko=True:rexxmarko$=marko$(9):Gosub arexxmarko
              Case 13:marko=True:rexxmarko$=marko$(10):Gosub arexxmarko
            End Select
        End Select
      Case $00000040
        Select GadgetHit
          Case 0: old=Auswahl
                  Auswahl=EventCode
                  If Liste(Auswahl)\Text <> " "+locale$(232)

                    ResetList Liste()
                    For a=0 To Auswahl
                      If NextItem (Liste()) Then ok=0
                    Next

                    a=0
                    Repeat
                      a+1
                    Until Liste()\Text=Mail(a)\empfaenger+" >"+Mail(a)\subject
                    Auswahl=a
                  EndIf
                  If Auswahl=old
                    If Liste(Auswahl)\Text=" "+locale$(232): editor$=Replace$(editor_prefs$,"%s",puffer_speichern$)
                      Execute_ editor$,0,0
                    Else
                      Gosub brettnews
                    EndIf
                  EndIf
          Case 1: absender$="":empfaenger$="":subjekt$="":new_mail=1:reply$="":Gosub versand
          Case 2: subjekt$="RE:"+Mail(Auswahl)\subject:empfaenger$=Mail(Auswahl)\absender
                  reply$=Mail(Auswahl)\absender:Gosub versand
          Case 3: subjekt$="RE:"+Mail(Auswahl)\subject:reply$=Mail(Auswahl)\absender
                  empfaenger$=Mail(Auswahl)\empfaenger:Gosub versand
          Case 4: weiterleiten=1:empfaenger$=Mail(Auswahl)\empfaenger:subjekt$=Mail(Auswahl)\subject
                  absender$=Mail(Auswahl)\absender:Gosub versand
          Case 5: Gosub arexxmarko
          Case 6: Gosub about
          Case 7: Gosub help
          Case 8: CloseWin=True
        End Select
    End Select
  Until CloseWin

  ende:
  CloseWindow   3
  Free GTList   3
  beenden=Request(locale$(233),locale$(234),locale$(235))
  If beenden=0 Then Goto re

  !Nervfenster

  LogFileOutput{locale$(259)}
  End

.befehle
Select ItemHit
  Case 0
    If OpenFile(0,puffer_speichern$)
      FileSeek 0,Lof(0)
      FileOutput 0
      NPrint "MyBBS ",homebbs$
      DefaultOutput
      CloseFile 0
    EndIf
  Case 1
    If OpenFile(0,puffer_speichern$)
      FileSeek 0,Lof(0)
      FileOutput 0
      NPrint "check"
      DefaultOutput
      CloseFile 0
    EndIf
  Case 2

  Window        14,3,192,637,64,$0000000F,locale$(236),1,2
  GTString      14,0,135,15,460,15,locale$(237),$0001,256,""
  AttachGTList  14,14

  CloseWin = False
  Repeat
    EventType.l = WaitEvent
    Select EventType
      Case #IDCMP_REFRESHWINDOW
        GT_BeginRefresh_ Peek.l (Addr Window(14))
        GT_EndRefresh_ Peek.l (Addr Window(14)),True
      Case $00000200
        CloseWin = True

      Case $00000040
        Select GadgetHit
          Case 0
           bereich_dir$=GTGetString(14,0)
           If OpenFile(0,puffer_speichern$)
                      FileSeek 0,Lof(0)
                      FileOutput 0
                      NPrint "Dir ",bereich_dir$
                      DefaultOutput
                      CloseFile 0
           EndIf
        End Select
    End Select
  Until CloseWin
  CloseWindow 14
  Free GTList 14
  CloseWin=False

  Case 3
  Window        14,3,192,637,64,$0000000F,locale$(236),1,2
  GTString      14,0,135,15,460,15,locale$(237),$0001,256,""
  AttachGTList  14,14

  CloseWin = False
  Repeat
    EventType.l = WaitEvent
    Select EventType
      Case $00000200
        CloseWin = True

      Case $00000040
        Select GadgetHit
          Case 0
           bereich_read$=GTGetString(14,0)
           If OpenFile(0,puffer_speichern$)
                      FileSeek 0,Lof(0)
                      FileOutput 0
                      NPrint "Read ",bereich_read$
                      DefaultOutput
                      CloseFile 0
           EndIf
        End Select
    End Select
  Until CloseWin
  CloseWindow 14
  Free GTList 14
  CloseWin=False

  Case 4
    If OpenFile(0,puffer_speichern$)
      FileSeek 0,Lof(0)
      FileOutput 0
      NPrint "Help"
      DefaultOutput
      CloseFile 0
    EndIf

  Case 5
  Window        14,3,192,637,64,$0000000F,locale$(238),1,2
  GTString      14,0,135,15,460,15,locale$(239),$0001,256,""
  AttachGTList  14,14

  CloseWin = False
  Repeat
    EventType.l = WaitEvent
    Select EventType
      Case #IDCMP_REFRESHWINDOW
        GT_BeginRefresh_ Peek.l (Addr Window(14))
        GT_EndRefresh_ Peek.l (Addr Window(14)),True

      Case $00000200
        CloseWin = True

      Case $00000040
        Select GadgetHit
          Case 0
           readlock$=GTGetString(14,0)
           If OpenFile(0,puffer_speichern$)
                      FileSeek 0,Lof(0)
                      FileOutput 0
                      NPrint "Alter Readlock ",readlock$
                      DefaultOutput
                      CloseFile 0
           EndIf
        End Select
    End Select
  Until CloseWin
  CloseWindow 14
  Free GTList 14
  CloseWin=False

  Case 6
  Window        14,3,192,637,64,$0000000F,locale$(240),1,2
  GTString      14,0,135,15,460,15,locale$(241),$0001,256,""
  AttachGTList  14,14

  CloseWin = False
  Repeat
    EventType.l = WaitEvent
    Select EventType
      Case $00000200
        CloseWin = True

      Case $00000040
        Select GadgetHit
          Case 0
           helplevel$=GTGetString(14,0)
           If OpenFile(0,puffer_speichern$)
                      FileSeek 0,Lof(0)
                      FileOutput 0
                      NPrint "Alter Helplevel ",helplevel$
                      DefaultOutput
                      CloseFile 0
           EndIf
        End Select
    End Select
  Until CloseWin
  CloseWindow 14
  Free GTList 14
  CloseWin=False

  Case 7
  Window        14,3,192,637,64,$0000000F,locale$(236),1,2
  GTString      14,0,135,15,460,15,locale$(237),$0001,256,""
  AttachGTList  14,14

  CloseWin = False
  Repeat
    EventType.l = WaitEvent
    Select EventType
      Case #IDCMP_REFRESHWINDOW
        GT_BeginRefresh_ Peek.l (Addr Window(14))
        GT_EndRefresh_ Peek.l (Addr Window(14)),True

      Case $00000200
        CloseWin = True

      Case $00000040
        Select GadgetHit
          Case 0
           bereich_erase$=GTGetString(14,0)
           If OpenFile(0,puffer_speichern$)
                      FileSeek 0,Lof(0)
                      FileOutput 0
                      NPrint "Erase ",bereich_erase$
                      DefaultOutput
                      CloseFile 0
           EndIf
        End Select
    End Select
  Until CloseWin
  CloseWindow 14
  Free GTList 14
  CloseWin=False

  Case 8
    If OpenFile(0,puffer_speichern$)
      FileSeek 0,Lof(0)
      FileOutput 0
      NPrint "Quit"
      DefaultOutput
      CloseFile 0
    EndIf

  Case 10
  Window        14,3,192,637,64,$0000000F,locale$(242),1,2
  GTString      14,0,135,15,460,15,locale$(243),$0001,256,""
  AttachGTList  14,14

  CloseWin = False
  Repeat
    EventType.l = WaitEvent
    Select EventType
      Case #IDCMP_REFRESHWINDOW
        GT_BeginRefresh_ Peek.l (Addr Window(14))
        GT_EndRefresh_ Peek.l (Addr Window(14)),True

      Case $00000200
        CloseWin = True

      Case $00000040
        Select GadgetHit
          Case 0
           sonstiger_befehl$=GTGetString(14,0)
           If OpenFile(0,puffer_speichern$)
                      FileSeek 0,Lof(0)
                      FileOutput 0
                      NPrint sonstiger_befehl$
                      DefaultOutput
                      CloseFile 0
           EndIf
        End Select
    End Select
  Until CloseWin
  CloseWindow 14
  Free GTList 14
  CloseWin=False
End Select

Return
