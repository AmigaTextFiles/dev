
; regex.include.bb2 generated by pragma2inc.


DEFTYPE .Library *_regexBase

Macro regex_regcomp ; {ret,regex_t,char,int}
   GetReg a0,`2 : GetReg a1,`3 : GetReg d0,`4
   GetReg a6,*_regexBase : JSR -36(a6) : PutReg d0,`1
End Macro

Macro regex_regerror ; {ret,int,regex_t,char,size_t}
   GetReg a1,`2 : GetReg d2,`3 : GetReg d0,`4 : GetReg d1,`5
   GetReg a6,*_regexBase : JSR -42(a6) : PutReg d0,`1
End Macro

Macro regex_regexec ; {ret,regex_t,char,size_t,regmatch_t,int}
   GetReg a1,`2 : GetReg d0,`3 : GetReg d1,`4 : GetReg d2,`5 : GetReg d3,`6
   GetReg a6,*_regexBase : JSR -48(a6) : PutReg d0,`1
End Macro

Macro regex_regfree ; {regex_t}
   GetReg a0,`1
   GetReg a6,*_regexBase : JSR -54(a6)
End Macro


Function.l regex_InitLib {minVersion.l}
   SHARED *_regexBase
   If *_regexBase Then Function Return *_regexBase
   If minVersion<0 Then minVersion = 0
   *_regexBase = OpenLibrary_ ("regex.library",minVersion)
   Function Return *_regexBase
End Function


Statement regex_FreeLib {}
   SHARED *_regexBase
   If *_regexBase Then CloseLibrary_ *_regexBase : *_regexBase = 0
End Statement


;-----------------------------------------------------------------------------------------


; C to Blitz conversion done by c2b.


DEFTYPE .l regoff_t ; OFF_T

NEWTYPE .regex_t
   re_magic.l                            ; INT
   re_nsub.l                             ; number of parenthesized subexpressions
   *re_endp.b                            ; end pointer for REG_PEND
   *re_g.l; re_guts                      ; STRUCT  ; none of your business :-)
End NEWTYPE

NEWTYPE .regmatch_t
   rm_so.l                               ; start of match
   rm_eo.l                               ; end of match
End NEWTYPE


; === regcomp flags ===
#REG_BASIC                     = 0000
#REG_EXTENDED                  = 0001
#REG_ICASE                     = 0002
#REG_NOSUB                     = 0004
#REG_NEWLINE                   = 0010
#REG_NOSPEC                    = 0020
#REG_PEND                      = 0040
#REG_DUMP                      = 0200

; === regerror code ===
#REG_NOMATCH                   = 1
#REG_BADPAT                    = 2
#REG_ECOLLATE                  = 3
#REG_ECTYPE                    = 4
#REG_EESCAPE                   = 5
#REG_ESUBREG                   = 6
#REG_EBRACK                    = 7
#REG_EPAREN                    = 8
#REG_EBRACE                    = 9
#REG_BADBR                     = 10
#REG_ERANGE                    = 11
#REG_ESPACE                    = 12
#REG_BADRPT                    = 13
#REG_EMPTY                     = 14
#REG_ASSERT                    = 15
#REG_INVARG                    = 16
#REG_ATOI                      = 255 ; convert name to number (!)
#REG_ITOA                      = 0400 ; convert number to name (!)

; === regexec code ===
#REG_NOTBOL                    = 00001
#REG_NOTEOL                    = 00002
#REG_STARTEND                  = 00004
#REG_TRACE                     = 00400 ; tracing of execution
#REG_LARGE                     = 01000 ; force large representation
#REG_BACKR                     = 02000 ; force use of backref code

