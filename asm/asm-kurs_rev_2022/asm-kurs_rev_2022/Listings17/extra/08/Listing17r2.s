
; Listing17r2.s = circles3ok.s 	; A1200 config

; CIRCLES by SHADOW !

******************************************************************** init

	section	caz,code

init:
	lea	$dff000,a6

	move.w	$1c(a6),d0		;intena read
	or.w	#$8000,d0
	move.w	d0,oldintena
	move.w	#$7fff,d0
	move.w	d0,$9a(a6)		;intena write
	move.w	d0,$9c(a6)		;intreq write

	bsr.w	init_multab40

	move.l 	#cop,$80(a6)
	move.w	d0,$dff088
	move.w	#0,$dff1fc
********************************************************************* main

wait:
	MOVE.L	#$1ff00,d1	; bit per la selezione tramite AND
	MOVE.L	#$00100,d2	; linea da aspettare = $130, ossia 304
Waity1:
	MOVE.L	4(A6),D0	; VPOSR e VHPOSR - $dff004/$dff006
	ANDI.L	D1,D0		; Seleziona solo i bit della pos. verticale
	CMPI.L	D2,D0		; aspetta la linea $130 (304)
	BNE.S	Waity1

;	move.w 	#$000,$180(a6)
	bsr.w	clr_screen
	bsr.w	draw_circle
	bsr.w	change_adr
;	move.w 	#$002,$180(a6)

	btst	#06,$bfe001
	bne.s	wait

ende:
	move.w 	oldintena(pc),$9a(a6)
	move.l 	4.w,a6
	lea	gfxname(pc),a1
	jsr	-408(a6)
	move.l 	d0,a1
	move.l 	38(a1),$dff080
	jsr	-414(a6)
	rts	

oldintena:	dc.w	0
gfxname:	dc.b	"graphics.library",0,0

*************************************************************** init_multab40

init_multab40:
	lea	multab40(pc),a0
	moveq	#00,d1

	move.w 	#256-1,d0
Li_m40_loop:
	move.w 	d1,(a0)+
	add.w	#40,d1
	dbf	d0,Li_m40_loop
	rts

multab40:
	dcb.w	256,0

************************************************************* change_adresses

change_adr:
	lea	actual_adr(pc),a0
	move.l	a0,a2
	moveq	#3,d0
	move.l	(a0),d1
.loop
	move.l	4(a0),(a0)+
	dbf	d0,.loop
	move.l	d1,(a0)

	lea	bpls+2,a1
	moveq	#05-1,d0

.loop2	move.l	(a2)+,d1
	move.w	d1,4(a1)
	swap	d1
	move.w	d1,(a1)
	addq.w	#8,a1
	dbf	d0,.loop2
	rts

actual_adr:
	dc.l	Fplan1
	dc.l	Fplan2
	dc.l	Fplan3
	dc.l	Fplan4
	dc.l	Fplan5

**************************************************************** clr_screen

clr_screen:
	btst	#6,$2(A6)
	btst	#6,$2(A6)
	bne.s	*-6

	move.w	#0,$66(a6)
	move.l 	actual_adr(pc),$54(a6)	; bltdpt
	move.l 	#$01000000,$40(a6)	; bltcon0
	move.w 	#[128*64]+20,$58(a6)	; bltsize: meta'

	lea	clr_buf(pc),a6
	movem.l (a6)+,d0-a5

	move.l 	actual_adr(pc),a6
	add.l	#256*40,a6

	rept	92
	movem.l d0-a5,-(a6)	; altra meta'
	endr

	lea	$dff000,a6
	rts

clr_buf:
	dcb.l	16,0

*************************************************************** draw_circle

draw_circle:
	lea	multab40(pc),a2
	lea	bomb1(pc),a3

	moveq 	#7-1,d4		; numero fuochi alla volta
circle_anz:
	lea	point_buf(pc),a0
	moveq 	#60-1,d0
circle_loop:
	move.l 	actual_adr(pc),a1	
	move.w 	(a3),d3		;z
	cmp.w	#$ff,d3
	bge.s	end_circle	; randoma

	move.w 	(a0),d1		;x
	ext.l	d1
	muls.w	d3,d1
	asr.w	#08,d1
	add.w	#128+32,d1
	add.w	2(a3),d1		;x-vers

	tst.w	d1
	blt.s	next_point
	cmp.w	#319,d1
	bgt.s	next_point

	move.w	d1,d2
	lsr.w	#03,d1
	add.w	d1,a1
	not.w	d2

	move.w 	60(a0),d1		;y
	ext.l	d1
	muls.w	d3,d1
	asr.w	#08,d1
	add.w	#128,d1
	add.w	4(a3),d1		; y-vers
	move.l 	6(a3),a4
	add.w	(a4),d1
	move.l 	a4,6(a3)

	tst.w	d1
	blt.s	next_point
	cmp.w	#255,d1
	bgt.s	next_point

	add.w	d1,d1
	add.w	(a2,d1.w),a1	; multab40

	bset	d2,(a1)		; setta!

next_point:
	addq.w	#2,a0
	dbf	d0,circle_loop

	move.w 	14(a3),d1
	add.w	d1,(a3)
	move.l 	10(a3),d1
	add.l	d1,6(a3)

next_circle:
	lea	16(a3),a3
	dbf	d4,circle_anz
	rts	

end_circle:
	clr.w 	(a3)
	move.w 	$bfe800,d0	; randomizza
	muls	$06(a6),d0
	eor.w	#$7553,d0
	and.w	#$ff,d0
	sub.w	#$7f,d0
	move.w 	d0,2(a3)

	move.w 	$bfd800,d0
	move.w	$06(a6),d1
	beq.s	merdaccia
	divs	d1,d0
merdaccia:
;	eor.w	#$f733,d0
	and.w	#$ff,d0
	sub.w	#$7f,d0
	move.w 	d0,4(a3)
	move.l 	#y_sin,6(a3)

	bra.s	next_circle

******************************************************************** vars

;	x,y
point_buf:	

	DC.W	$FF81,$FFCF,$FFB7,$006D,$FFBB,$0024,$FFA1,$0023
	DC.W	$FFC9,$0035,$0031,$0029,$FFDD,$001F,$001C,$0015
	DC.W	$FFD6,$FFE9,$FFD3,$000B,$FF9D,$006B,$0025,$0039
	DC.W	$003D,$FFC3,$0017,$FFA7,$0052,$001D,$FFE2,$0055
	DC.W	$005D,$FFF7,$FFF5,$FFB1,$FF96,$002D,$FFD2,$0075
	DC.W	$0053,$FFE7,$FF93,$005E,$FFDA,$004D,$002F,$0041
	DC.W	$FFDC,$003B,$005B,$0008,$FFC7,$0003,$007B,$FFA5
	DC.W	$FFF3,$002B,$0058,$0057,$0019,$0001,$002E,$0021
	DC.W	$003F,$FF9F,$FF90,$FFFD,$001B,$FFF9,$0063,$0071
	DC.W	$FF8D,$FFF1,$0030,$FFAD,$FFBA,$002C,$004B,$FF99
	DC.W	$0005,$FF94,$006E,$FFCB,$FFB3,$007F,$0051,$FFCD
	DC.W	$000F,$000D,$FF8F,$0010,$FFA8,$FFF2,$FFD5,$0080
	DC.W	$FFA0,$0004,$007D,$FFB9,$FFA9,$FFC1,$0000,$0042
	DC.W	$0073,$0061,$0013,$FF97,$004F,$0033,$FFEB,$0032
	DC.W	$0077,$FFED,$0059,$FF82,$FFE5,$FFFF,$FFFF,$FFFF

y_sin:  
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      0,0,0,0,0,0,0,0
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,1,1,1
        dc.w      1,1,1,1,1,2,2,2
        dc.w      2,2,2,2,2,2,2,2
        dc.w      2,2,2,2,2,2,2,2
        dc.w      2,2,2,2,2,2,2,2
        dc.w      2,2,2,2,2,2,2,2
        dc.w      2,2,2,2,2,2,2,2
        dc.w      2,2,2,2,2,2,2,2
        dc.w      2,2,2,2,2,2,2,2
        dc.w      2,2,2,2,2,2,3,3
        dc.w      3,3,3,3,3,3,3,3
        dc.w      3,3,3,3,3,3,3,3
        dc.w      3,3,3,3,3,3,3,3
        dc.w      3,3,3,3,3,3,3,3
        dc.w      3,3,3,3,3,3,3,3
        dc.w      3,3,3,3,3,3,3,3
        dc.w      3,3,4,4,4,4,4,4
        dc.w      4,4,4,4,4,4,4,4
        dc.w      4,4,4,4,4,4,4,4
        dc.w      4,4,4,4,4,4,4,4
        dc.w      4,4,4,4,4,4,4,4
        dc.w      4,4,4,4,4,4,4,4
        dc.w      5,5,5,5,5,5,5,5
        dc.w      5,5,5,5,5,5,5,5
        dc.w      5,5,5,5,5,5,5,5
        dc.w      5,5,5,5,5,5,5,5
        dc.w      5,5,5,5,5,5,5,5
        dc.w      5,6,6,6,6,6,6,6
        dc.w      6,6,6,6,6,6,6,6
        dc.w      6,6,6,6,6,6,6,6
        dc.w      6,6,6,6,6,6,6,6
        dc.w      6,6,6,6,6,6,7,7
        dc.w      7,7,7,7,7,7,7,7
        dc.w      7,7,7,7,7,7,7,7
        dc.w      7,7,7,7,7,7,7,7
        dc.w      7,7,7,7,7,7,7,7
        dc.w      7,8,8,8,8,8,8,8
        dc.w      8,8,8,8,8,8,8,8
        dc.w      8,8,8,8,8,8,8,8
        dc.w      8,8,8,8,8,8,8,8
        dc.w      8,9,9,9,9,9,9,9
        dc.w      9,9,9,9,9,9,9,9
        dc.w      9,9,9,9,9,9,9,9
        dc.w      9,9,9,9,9,9,9,9
        dc.w      10,10,10,10,10,10,10,10
        dc.w      10,10,10,10,10,10,10,10
        dc.w      10,10,10,10,10,10,10,10
        dc.w      10,10,10,10,10,11,11,11
        dc.w      11,11,11,11,11,11,11,11
        dc.w      11,11,11,11,11,11,11,11
        dc.w      11,11,11,11,11,11,11,11
        dc.w      11,12,12,12,12,12,12,12
        dc.w      12,12,12,12,12,12,12,12
        dc.w      12,12,12,12,12,12,12,12
        dc.w      12,12,12,12,13,13,13,13
        dc.w      13,13,13,13,13,13,13,13
        dc.w      13,13,13,13,13,13,13,13
        dc.w      13,13,13,13,13,13,14,14
        dc.w      14,14,14,14,14,14,14,14
        dc.w      14,14,14,14,14,14,14,14
        dc.w      14,14,14,14,14,14,14,15
        dc.w      15,15,15,15,15,15,15,15
        dc.w      15,15,15,15,15,15,15,15
        dc.w      15,15,15,15,15,15,15,16
        dc.w      16,16,16,16,16,16,16,16
        dc.w      16,16,16,16,16,16,16,16
        dc.w      16,16,16,16,16,16,17,17
        dc.w      17,17,17,17,17,17,17,17
        dc.w      17,17,17,17,17,17,17,17
        dc.w      17,17,17,17,17,18,18,18
        dc.w      18,18,18,18,18,18,18,18
        dc.w      18,18,18,18,18,18,18,18
        dc.w      18,18,18,19,19,19,19,19
        dc.w      19,19,19,19,19,19,19,19
        dc.w      19,19,19,19,19,19,19,19
        dc.w      19,20,20,20,20,20,20,20
        dc.w      20,20,20,20,20,20,20,20
        dc.w      20,20,20,20,20,20,21,21
        dc.w      21,21,21,21,21,21,21,21
        dc.w      21,21,21,21,21,21,21,21
        dc.w      21,21,21,22,22,22,22,22
        dc.w      22,22,22,22,22,22,22,22
        dc.w      22,22,22,22,22,22,22,22
        dc.w      23,23,23,23,23,23,23,23
        dc.w      23,23,23,23,23,23,23,23
        dc.w      23,23,23,24,24,24,24,24
        dc.w      24,24,24,24,24,24,24,24
        dc.w      24,24,24,24,24,24,24,25
        dc.w      25,25,25,25,25,25,25,25
        dc.w      25,25,25,25,25,25,25,25
        dc.w      25,25,26,26,26,26,26,26
        dc.w      26,26,26,26,26,26,26,26
        dc.w      26,26,26,26,26,27,27,27
        dc.w      27,27,27,27,27,27,27,27
        dc.w      27,27,27,27,27,27,27,27
        dc.w      28,28,28,28,28,28,28,28
        dc.w      28,28,28,28,28,28,28,28
        dc.w      28,28,29,29,29,29,29,29
        dc.w      29,29,29,29,29,29,29,29
        dc.w      29,29,29,29,30,30,30,30
        dc.w      30,30,30,30,30,30,30,30
        dc.w      30,30,30,30,30,30,31,31
        dc.w      31,31,31,31,31,31,31,31
        dc.w      31,31,31,31,31,31,31,31
        dc.w      32,32,32,32,32,32,32,32
        dc.w      32,32,32,32,32,32,32,32
        dc.w      32,33,33,33,33,33,33,33
        dc.w      33,33,33,33,33,33,33,33
        dc.w      33,33,34,34,34,34,34,34
        dc.w      34,34,34,34,34,34,34,34
        dc.w      34,34,34,35,35,35,35,35
        dc.w      35,35,35,35,35,35,35,35
        dc.w      35,35,35,35,36,36,36,36
        dc.w      36,36,36,36,36,36,36,36
        dc.w      36,36,36,36,36,37,37,37
        dc.w      37,37,37,37,37,37,37,37
        dc.w      37,37,37,37,37,38,38,38
        dc.w      38,38,38,38,38,38,38,38
        dc.w      38,38,38,38,38,39,39,39
        dc.w      39,39,39,39,39,39,39,39
        dc.w      39,39,39,39,39,40,40,40
        dc.w      40,40,40,40,40,40,40,40
        dc.w      40,40,40,40,40,41,41,41
        dc.w      41,41,41,41,41,41,41,41
        dc.w      41,41,41,41,41,42,42,42
        dc.w      42,42,42,42,42,42,42,42
        dc.w      42,42,42,42,42,43,43,43
        dc.w      43,43,43,43,43,43,43,43
        dc.w      43,43,43,43,44,44,44,44
        dc.w      44,44,44,44,44,44,44,44
        dc.w      44,44,44,45,45,45,45,45
        dc.w      45,45,45,45,45,45,45,45
        dc.w      45,45,45,46,46,46,46,46
        dc.w      46,46,46,46,46,46,46,46
        dc.w      46,46,47,47,47,47,47,47
        dc.w      47,47,47,47,47,47,47,47
        dc.w      47,48,48,48,48,48,48,48
        dc.w      48,48,48,48,48,48,48,48
        dc.w      49,49,49,49,49,49,49,49
        dc.w      49,49,49,49,49,49,49,50
        dc.w      50,50,50,50,50,50,50,50
        dc.w      50,50,50,50,50,51,51,51
        dc.w      51,51,51,51,51,51,51,51
        dc.w      51,51,51,51,52,52,52,52
        dc.w      52,52,52,52,52,52,52,52
        dc.w      52,52,53,53,53,53,53,53
        dc.w      53,53,53,53,53,53,53,53
        dc.w      53,54,54,54,54,54,54,54
        dc.w      54,54,54,54,54,54,54,55
        dc.w      55,55,55,55,55,55,55,55
        dc.w      55,55,55,55,55,56,56,56
        dc.w      56,56,56,56,56,56,56,56
        dc.w      56,56,56,56,57,57,57,57
        dc.w      57,57,57,57,57,57,57,57
        dc.w      57,57,58,58,58,58,58,58
        dc.w      58,58,58,58,58,58,58,58
        dc.w      59,59,59,59,59,59,59,59
        dc.w      59,59,59,59,59,59,60,60
        dc.w      60,60,60,60,60,60,60,60
        dc.w      60,60,60,60,61,61,61,61
        dc.w      61,61,61,61,61,61,61,61
        dc.w      61,62,62,62,62,62,62,62
        dc.w      62,62,62,62,62,62,62,63
        dc.w      63,63,63,63,63,63,63,63
        dc.w      63,63,63,63,63,64,64,64
        dc.w      64,64,64,64,64,64,64,64
        dc.w      64,64,65,65,65,65,65,65
        dc.w      65,65,65,65,65,65,65,65
        dc.w      66,66,66,66,66,66,66,66
        dc.w      66,66,66,66,66,66,67,67
        dc.w      67,67,67,67,67,67,67,67
        dc.w      67,67,67,68,68,68,68,68
        dc.w      68,68,68,68,68,68,68,68
        dc.w      68,69,69,69,69,69,69,69
        dc.w      69,69,69,69,69,69,70,70
        dc.w      70,70,70,70,70,70,70,70
        dc.w      70,70,70,71,71,71,71,71
        dc.w      71,71,71,71,71,71,71,71
        dc.w      71,72,72,72,72,72,72,72
        dc.w      72,72,72,72,72,72,73,73
        dc.w      73,73,73,73,73,73,73,73
        dc.w      73,73,73,74,74,74,74,74
        dc.w      74,74,74,74,74,74,74,74
        dc.w      75,75,75,75,75,75,75,75
        dc.w      75,75,75,75,75,76,76,76
        dc.w      76,76,76,76,76,76,76,76
        dc.w      76,76,77,77,77,77,77,77
        dc.w      77,77,77,77,77,77,77,77
        dc.w      78,78,78,78,78,78,78,78
        dc.w      78,78,78,78,78,79,79,79
        dc.w      79,79,79,79,79,79,79,79
        dc.w      79,79,80,80,80,80,80,80
        dc.w      80,80,80,80,80,80,80,81
        dc.w      81,81,81,81,81,81,81,81
        dc.w      81,81,81,81,82,82,82,82
        dc.w      82,82,82,82,82,82,82,82
        dc.w      82,83,83,83,83,83,83,83
        dc.w      83,83,83,83,83,84,84,84
        dc.w      84,84,84,84,84,84,84,84
        dc.w      84,84,85,85,85,85,85,85
        dc.w      85,85,85,85,85,85,85,86
        dc.w      86,86,86,86,86,86,86,86
        dc.w      86,86,86,86,87,87,87,87
        dc.w      87,87,87,87,87,87,87,87
        dc.w      87,88,88,88,88,88,88,88
        dc.w      88,88,88,88,88,88,89,89
        dc.w      89,89,89,89,89,89,89,89
        dc.w      89,89,89,90,90,90,90,90
        dc.w      90,90,90,90,90,90,90,91
        dc.w      91,91,91,91,91,91,91,91
        dc.w      91,91,91,91,92,92,92,92
        dc.w      92,92,92,92,92,92,92,92
        dc.w      92,93,93,93,93,93,93,93
        dc.w      93,93,93,93,93,93,94,94
        dc.w      94,94,94,94,94,94,94,94
        dc.w      94,94,95,95,95,95,95,95
        dc.w      95,95,95,95,95,95,95,96
        dc.w      96,96,96,96,96,96,96,96
        dc.w      96,96,96,96,97,97,97,97
        dc.w      97,97,97,97,97,97,97,97
        dc.w      97,98,98,98,98,98,98,98
        dc.w      98,98,98,98,98,99,99,99
        dc.w      99,99,99,99,99,99,99,99
        dc.w      99,99,100,100,100,100,100,100
        dc.w      100

;----------------------------------------------------------------- bomb-datas

bomb1:
	dc.w	0		;speed-counter
	dc.w	-40		;x-vers
	dc.w	40		;y-vers
	dc.l	y_sin		;ysin
	dc.l	20		;speed
	dc.w	3		;speed2

bomb2:
	dc.w	80		;speed-counter
	dc.w	0		;x-vers
	dc.w	0		;y-vers
	dc.l	y_sin		;ysin
	dc.l	60		;speed
	dc.w	5		;speed2

bomb3:
	dc.w	160		;speed-counter
	dc.w	80		;x-vers
	dc.w	110		;y-vers
	dc.l	y_sin		;ysin
	dc.l	40		;speed
	dc.w	4		;speed2

;;;

bomb4:
	dc.w	100		;speed-counter
	dc.w	5		;x-vers
	dc.w	40		;y-vers
	dc.l	y_sin		;ysin
	dc.l	30		;speed
	dc.w	3		;speed2

bomb5:
	dc.w	5		;speed-counter
	dc.w	80		;x-vers
	dc.w	30		;y-vers
	dc.l	y_sin		;ysin
	dc.l	25		;speed
	dc.w	2		;speed2

bomb6:
	dc.w	100		;speed-counter
	dc.w	5		;x-vers
	dc.w	40		;y-vers
	dc.l	y_sin		;ysin
	dc.l	30		;speed
	dc.w	3		;speed2

bomb7:
	dc.w	5		;speed-counter
	dc.w	80		;x-vers
	dc.w	30		;y-vers
	dc.l	y_sin		;ysin
	dc.l	25		;speed
	dc.w	2		;speed2


****************************************************************** coplist


	section	copperFuochi,data_C

cop:	
	dc.l	$008e2c81
	dc.l	$00902cc1
	dc.l	$00920038
	dc.l	$009400d0
	dc.l	$00960020

	dc.l	$01800000,$01820b3f,$01840407,$0186080b
	dc.l	$01880609,$018a080b,$018c080b,$018e080b
	dc.l	$0190080b,$0192080b,$0194080b,$0196080b
	dc.l	$0198080b,$019a080b,$019c080b,$019e080b
	dc.l	$01a00a0d,$01a2080b,$01a4080b,$01a6080b
	dc.l	$01a8080b,$01aa080b,$01ac080b,$01ae080b
	dc.l	$01b0080b,$01b2080b,$01b4080b,$01b6080b
	dc.l	$01b8080b,$01ba080b,$01bc080b,$01be080b

	dc.w	$0108,0
	dc.w	$010a,0

bpls:
	dc.l	$00e00000
	dc.l	$00e20000
	dc.l	$00e40000
	dc.l	$00e60000
	dc.l	$00e80000
	dc.l	$00ea0000
	dc.l	$00ec0000
	dc.l	$00ee0000
	dc.l	$00f00000
	dc.l	$00f20000

	dc.l	$01005200	; 5 planes

	dc.l	-2
	
****************************************************************** planes

	section	addressi,bss_c

Fplan1:
	ds.b	40*256
Fplan2:
	ds.b	40*256
Fplan3:
	ds.b	40*256
Fplan4:
	ds.b	40*256
Fplan5:
	ds.b	40*256

	end

