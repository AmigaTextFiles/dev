
; Listing18e3.s = lineflaggs.s
; work done by shadow of ABYSS !

****************************************************************** trap

		move.l 	#init,$80
		trap	#0
		rts
		
***************************************************************** init

init:		lea	$dff000,a6	

		lea	$50000,a0
clrbpl:		clr.l	(a0)+
		cmp.l	#$52800,a0
		blt.s	clrbpl

		move.w	$1c(a6),d0			;intena read
		or.w	#$8000,d0
		move.w	d0,oldintena
		move.w	#$7fff,d0
		move.w	d0,$9a(a6)			;intena write
		move.w	d0,$9c(a6)			;intreq write
	
		bsr.w	initpoints

		move.l 	#cop,$80(a6)
		move.w	d0,$88(A6)
		move.w	#0,$1fc(a6)
		move.l	#0,$108(a6)
		
************************************************************** mainloop

wait:		cmp.b	#$ff,$06(a6)
		bne.s	wait
		
		btst	#06,$bfe001
		beq.s	ende		

;		move.w 	#$00f,$180(a6)
		bsr.w	clrscreen
		bsr.w	drawpoints
		move.w 	#$000,$180(a6)

endwait:	bra.s	wait			

****************************************************************** ende

ende:		move.w	oldintena(pc),$9a(a6)
		move.l 	4,a6
		lea	gfxname(pc),a1
		jsr	-408(a6)
		move.l 	d0,a1
		move.l 	38(a1),$dff080
		jsr	-414(a6)
		rte

oldintena:	dc.w	0


************************************************************* drawpoints

drawpoints:	btst	#14,$02(a6)
		bne.s	drawpoints

		lea	pointbuf(pc),a0
		lea	$50000,a1
		move.l 	a1,a2

		move.l 	xsinpot(pc),a3
		addq.l	#04,a3
		cmp.l	#xsine,a3
		blt.s	noxsinrest
		lea	-[xsine-xsin](a3),a3
noxsinrest:	move.l 	a3,xsinpot
		move.l 	a3,a5

		move.l 	ysinpot(pc),a4
		addq.l	#02,a4
		cmp.l	#ysine,a4
		blt.s	noysinrest
		lea	-[ysine-ysin](a4),a4
noysinrest:	move.l 	a4,ysinpot
		move.l 	a4,a6

;--------------------------------------------------------

		moveq 	#20-1,d3		;breite
		move.w 	#[20*20]-1,d0	;anzahl
drawloop:	move.l 	a2,a1
		add.w 	(a0)+,a1		;ycoord
		add.w	(a4),a1			;ysin
		add.l	#16,a4			;y1add
	
		move.w 	(a0)+,d1		;xcoord
		add.w 	(a3),d1			;xsin
		add.l	#12,a3			;x1add

		move.w 	d1,d2
		lsr.w	#03,d2
		and.w	#$0f,d1
		not.w	d1
		bset	d1,(a1,d2.w)	;set point
		
		dbf	d3,noyadd	
		moveq 	#20-1,d3		;breite
		add.l	#4,a6			;y2add
		move.l 	a6,a4
		add.l	#8,a5			;x2add
		move.l 	a5,a3

noyadd:		dbf	d0,drawloop
		
		lea	$dff000,a6
		rts		

************************************************************* initpoints

initpoints:	lea	pointbuf(pc),a0
		moveq 	#70,d2			;xstart
		moveq 	#0,d3			;ystart

		moveq 	#20-1,d0		;y anzahl
yanzloop:	
		moveq 	#20-1,d1		;x anzahl
xanzloop:	move.w 	d3,(a0)+	;y
		move.w 	d2,(a0)+		;x	
		add.w	#4,d2
		dbf	d1,xanzloop

		sub.w	#20*4,d2
		add.w	#8*40,d3
		dbf	d0,yanzloop		

		rts

************************************************************** clrscreen

clrscreen:	lea	$50000-120,a0
		
		clr.w	$64(a6)
		move.l 	a0,$54(a6)
		move.l 	#$01000000,$40(a6)
		move.w 	#[256*64]+20,$58(a6)

		rts


****************************************************************** vars

gfxname:	dc.b	"graphics.library",0,0

xsinpot:	dc.l	xsin
ysinpot:	dc.l	ysin

pointbuf:	blk.w	20*20*2,0		;x,y

******************************************************************* sine

xsin:
        dc.w      0,0,0,0,0,1,1,1
        dc.w      2,2,2,3,4,4,5,5
        dc.w      6,7,8,9,10,10,11,12
        dc.w      14,15,16,17,18,19,21,22
        dc.w      23,25,26,27,29,30,32,33
        dc.w      35,36,38,39,41,42,44,45
        dc.w      47,48,50,52,53,55,56,58
        dc.w      59,61,62,64,65,67,68,70
        dc.w      71,73,74,75,77,78,79,81
        dc.w      82,83,84,85,86,88,89,90
        dc.w      90,91,92,93,94,95,95,96
        dc.w      96,97,98,98,98,99,99,99
        dc.w      100,100,100,100,100,100,100,100
        dc.w      100,99,99,99,98,98,98,97
        dc.w      96,96,95,95,94,93,92,91
        dc.w      90,90,89,88,86,85,84,83
        dc.w      82,81,79,78,77,75,74,73
        dc.w      71,70,68,67,65,64,62,61
        dc.w      59,58,56,55,53,52,50,48
        dc.w      47,45,44,42,41,39,38,36
        dc.w      35,33,32,30,29,27,26,25
        dc.w      23,22,21,19,18,17,16,15
        dc.w      14,12,11,10,10,9,8,7
        dc.w      6,5,5,4,4,3,2,2
        dc.w      2,1,1,1,0,0,0,0
xsine:
        dc.w      0,0,0,0,0,1,1,1
        dc.w      2,2,2,3,4,4,5,5
        dc.w      6,7,8,9,10,10,11,12
        dc.w      14,15,16,17,18,19,21,22
        dc.w      23,25,26,27,29,30,32,33
        dc.w      35,36,38,39,41,42,44,45
        dc.w      47,48,50,52,53,55,56,58
        dc.w      59,61,62,64,65,67,68,70
        dc.w      71,73,74,75,77,78,79,81
        dc.w      82,83,84,85,86,88,89,90
        dc.w      90,91,92,93,94,95,95,96
        dc.w      96,97,98,98,98,99,99,99
        dc.w      100,100,100,100,100,100,100,100
        dc.w      100,99,99,99,98,98,98,97
        dc.w      96,96,95,95,94,93,92,91
        dc.w      90,90,89,88,86,85,84,83
        dc.w      82,81,79,78,77,75,74,73
        dc.w      71,70,68,67,65,64,62,61
        dc.w      59,58,56,55,53,52,50,48
        dc.w      47,45,44,42,41,39,38,36
        dc.w      35,33,32,30,29,27,26,25
        dc.w      23,22,21,19,18,17,16,15
        dc.w      14,12,11,10,10,9,8,7
        dc.w      6,5,5,4,4,3,2,2
        dc.w      2,1,1,1,0,0,0,0

        dc.w      0,0,0,0,0,1,1,1
        dc.w      2,2,2,3,4,4,5,5
        dc.w      6,7,8,9,10,10,11,12
        dc.w      14,15,16,17,18,19,21,22
        dc.w      23,25,26,27,29,30,32,33
        dc.w      35,36,38,39,41,42,44,45
        dc.w      47,48,50,52,53,55,56,58
        dc.w      59,61,62,64,65,67,68,70
        dc.w      71,73,74,75,77,78,79,81
        dc.w      82,83,84,85,86,88,89,90
        dc.w      90,91,92,93,94,95,95,96
        dc.w      96,97,98,98,98,99,99,99
        dc.w      100,100,100,100,100,100,100,100
        dc.w      100,99,99,99,98,98,98,97
        dc.w      96,96,95,95,94,93,92,91
        dc.w      90,90,89,88,86,85,84,83
        dc.w      82,81,79,78,77,75,74,73
        dc.w      71,70,68,67,65,64,62,61
        dc.w      59,58,56,55,53,52,50,48
        dc.w      47,45,44,42,41,39,38,36
        dc.w      35,33,32,30,29,27,26,25
        dc.w      23,22,21,19,18,17,16,15
        dc.w      14,12,11,10,10,9,8,7
        dc.w      6,5,5,4,4,3,2,2
        dc.w      2,1,1,1,0,0,0,0

ysin:
        dc.w      0*40,0*40,0*40,0*40,0*40,1*40,1*40,1*40
        dc.w      2*40,2*40,2*40,3*40,4*40,4*40,5*40,5*40
        dc.w      6*40,7*40,8*40,9*40,10*40,10*40,11*40,12*40
        dc.w      14*40,15*40,16*40,17*40,18*40,19*40,21*40,22*40
        dc.w      23*40,25*40,26*40,27*40,29*40,30*40,32*40,33*40
        dc.w      35*40,36*40,38*40,39*40,41*40,42*40,44*40,45*40
        dc.w      47*40,48*40,50*40,52*40,53*40,55*40,56*40,58*40
        dc.w      59*40,61*40,62*40,64*40,65*40,67*40,68*40,70*40
        dc.w      71*40,73*40,74*40,75*40,77*40,78*40,79*40,81*40
        dc.w      82*40,83*40,84*40,85*40,86*40,88*40,89*40,90*40
        dc.w      90*40,91*40,92*40,93*40,94*40,95*40,95*40,96*40
        dc.w      96*40,97*40,98*40,98*40,98*40,99*40,99*40,99*40
        dc.w      100*40,100*40,100*40,100*40,100*40,100*40,100*40,100*40
        dc.w      100*40,99*40,99*40,99*40,98*40,98*40,98*40,97*40
        dc.w      96*40,96*40,95*40,95*40,94*40,93*40,92*40,91*40
        dc.w      90*40,90*40,89*40,88*40,86*40,85*40,84*40,83*40
        dc.w      82*40,81*40,79*40,78*40,77*40,75*40,74*40,73*40
        dc.w      71*40,70*40,68*40,67*40,65*40,64*40,62*40,61*40
        dc.w      59*40,58*40,56*40,55*40,53*40,52*40,50*40,48*40
        dc.w      47*40,45*40,44*40,42*40,41*40,39*40,38*40,36*40
        dc.w      35*40,33*40,32*40,30*40,29*40,27*40,26*40,25*40
        dc.w      23*40,22*40,21*40,19*40,18*40,17*40,16*40,15*40
        dc.w      14*40,12*40,11*40,10*40,10*40,9*40,8*40,7*40
        dc.w      6*40,5*40,5*40,4*40,4*40,3*40,2*40,2*40
        dc.w      2*40,1*40,1*40,1*40,0*40,0*40,0*40,0*40
ysine:
        dc.w      0*40,0*40,0*40,0*40,0*40,1*40,1*40,1*40
        dc.w      2*40,2*40,2*40,3*40,4*40,4*40,5*40,5*40
        dc.w      6*40,7*40,8*40,9*40,10*40,10*40,11*40,12*40
        dc.w      14*40,15*40,16*40,17*40,18*40,19*40,21*40,22*40
        dc.w      23*40,25*40,26*40,27*40,29*40,30*40,32*40,33*40
        dc.w      35*40,36*40,38*40,39*40,41*40,42*40,44*40,45*40
        dc.w      47*40,48*40,50*40,52*40,53*40,55*40,56*40,58*40
        dc.w      59*40,61*40,62*40,64*40,65*40,67*40,68*40,70*40
        dc.w      71*40,73*40,74*40,75*40,77*40,78*40,79*40,81*40
        dc.w      82*40,83*40,84*40,85*40,86*40,88*40,89*40,90*40
        dc.w      90*40,91*40,92*40,93*40,94*40,95*40,95*40,96*40
        dc.w      96*40,97*40,98*40,98*40,98*40,99*40,99*40,99*40
        dc.w      100*40,100*40,100*40,100*40,100*40,100*40,100*40,100*40
        dc.w      100*40,99*40,99*40,99*40,98*40,98*40,98*40,97*40
        dc.w      96*40,96*40,95*40,95*40,94*40,93*40,92*40,91*40
        dc.w      90*40,90*40,89*40,88*40,86*40,85*40,84*40,83*40
        dc.w      82*40,81*40,79*40,78*40,77*40,75*40,74*40,73*40
        dc.w      71*40,70*40,68*40,67*40,65*40,64*40,62*40,61*40
        dc.w      59*40,58*40,56*40,55*40,53*40,52*40,50*40,48*40
        dc.w      47*40,45*40,44*40,42*40,41*40,39*40,38*40,36*40
        dc.w      35*40,33*40,32*40,30*40,29*40,27*40,26*40,25*40
        dc.w      23*40,22*40,21*40,19*40,18*40,17*40,16*40,15*40
        dc.w      14*40,12*40,11*40,10*40,10*40,9*40,8*40,7*40
        dc.w      6*40,5*40,5*40,4*40,4*40,3*40,2*40,2*40
        dc.w      2*40,1*40,1*40,1*40,0*40,0*40,0*40,0*40

        dc.w      0*40,0*40,0*40,0*40,0*40,1*40,1*40,1*40
        dc.w      2*40,2*40,2*40,3*40,4*40,4*40,5*40,5*40
        dc.w      6*40,7*40,8*40,9*40,10*40,10*40,11*40,12*40
        dc.w      14*40,15*40,16*40,17*40,18*40,19*40,21*40,22*40
        dc.w      23*40,25*40,26*40,27*40,29*40,30*40,32*40,33*40
        dc.w      35*40,36*40,38*40,39*40,41*40,42*40,44*40,45*40
        dc.w      47*40,48*40,50*40,52*40,53*40,55*40,56*40,58*40
        dc.w      59*40,61*40,62*40,64*40,65*40,67*40,68*40,70*40
        dc.w      71*40,73*40,74*40,75*40,77*40,78*40,79*40,81*40
        dc.w      82*40,83*40,84*40,85*40,86*40,88*40,89*40,90*40
        dc.w      90*40,91*40,92*40,93*40,94*40,95*40,95*40,96*40
        dc.w      96*40,97*40,98*40,98*40,98*40,99*40,99*40,99*40
        dc.w      100*40,100*40,100*40,100*40,100*40,100*40,100*40,100*40
        dc.w      100*40,99*40,99*40,99*40,98*40,98*40,98*40,97*40
        dc.w      96*40,96*40,95*40,95*40,94*40,93*40,92*40,91*40
        dc.w      90*40,90*40,89*40,88*40,86*40,85*40,84*40,83*40
        dc.w      82*40,81*40,79*40,78*40,77*40,75*40,74*40,73*40
        dc.w      71*40,70*40,68*40,67*40,65*40,64*40,62*40,61*40
        dc.w      59*40,58*40,56*40,55*40,53*40,52*40,50*40,48*40
        dc.w      47*40,45*40,44*40,42*40,41*40,39*40,38*40,36*40
        dc.w      35*40,33*40,32*40,30*40,29*40,27*40,26*40,25*40
        dc.w      23*40,22*40,21*40,19*40,18*40,17*40,16*40,15*40
        dc.w      14*40,12*40,11*40,10*40,10*40,9*40,8*40,7*40
        dc.w      6*40,5*40,5*40,4*40,4*40,3*40,2*40,2*40
        dc.w      2*40,1*40,1*40,1*40,0*40,0*40,0*40,0*40

	section	cop,data_c

*************************************************************** coplist
		
cop:		dc.l	$008e2981
		dc.l	$009029c1
		dc.l	$00920038
		dc.l	$009400d0
		dc.l	$00960020
		
		dc.l	$01020010

;		dc.l	$01800000
		dc.l	$01820f0f
		dc.l	$0184080a
		dc.l	$0186080a

		dc.l	$01002200
		dc.l	$00e00005
		dc.l	$00e20000
		dc.l	$00e40004
		dc.w	$00e6,0000-40

		dc.l	$fffffffe
