@database CadOS system
@node main "CadOS.system functions"
TABLE OF CONTENTS

@{" CadOS.system/Disable " link Disable}
@{" CadOS.system/Enable " link Enable}
@{" CadOS.system/SetAutovec " link SetAutovec}
@{" CadOS.system/SetTrap " link SetTrap}
@{" CadOS.system/RemAutovec " link RemAutovec}
@{" CadOS.system/ResetTrap " link ResetTrap}
@{" CadOS.system/FlushCache " link FlushCache}
@{" CadOS.system/SystemRequest " link SystemRequest}
@{" CadOS.system/CauseDelay " link CauseDelay}

@endnode

@node Disable
CadOS.system/Disable                                   CadOS.system/Disable

  NAME
    Disable()

  SYNOPSIS
    void Disable()

  DESCRIPTION
    Relinquishes ALL Amiga OS's control of the Amiga. CadOS takes over all
    possible routes, including DMA, interrupts, traps and exceptions. The
    blitter is procured here, also. All this is done in the safest and most
    compatible method possible. Disable is automatically called when your
    demo begins. If you have been using the CadOS filing system then
    Disable will wait for disk access to finish. Multiple calls to Disable
    do not nest. The CadOS vblank interrupt will also be installed here if
    you have not set the flag NO_VBLSERVER, and the timecounter will be
    reset to 0.

  INPUTS
    none

  RESULT
    nothing - CadOS takes over Amiga

  SEE ALSO
    @{" Enable " link Enable}

@endnode

@node Enable
CadOS.system/Enable                                     CadOS.system/Enable

  NAME
    Enable()

  SYNOPSIS
    void Enable()

  DESCRIPTION
    Fully restores Amiga OS's control of the Amiga, except for the screen,
    which will continue to display what the current copperlist is
    describing. All custom autovectors and trap handlers will be stopped.
    It is now possible to use the CadOS filing system. Enable is
    automatically called when your demo ends or quits. Multiple calls to
    Enable do not nest.

  INPUTS
    none

  RESULT
    nothing - AmigaOS is restored

  NOTE
    The CadOS file system will automatically Enable the system if you
    forget to Enable before using it, and it will Disable after the call,
    but this has a big time penalty if you load a succession of files like
    this.

  SEE ALSO
    @{" Disable " link Disable}, @{" SetAutovec " link SetAutovec}, @{" SetTrap " link SetTrap}, @{" CadOS.display/RestoreScreen " link CadOS_display.guide/RestoreScreen},
    @{" CadOS.file " link CadOS_file.guide/main}

@endnode

@node SetAutovec
CadOS.system/SetAutovec                             CadOS.system/SetAutovec

  NAME 
    SetAutovec()

  SYNOPSIS
    void SetAutovec(level,*routine)
                     D0      A0

  DESCRIPTION
    Sets the Autovector at the level specified to run your routine. CadOS
    automatically creates a level 3 server for timing and synchronization.
    Any level 3 server you install will be tagged on to the bottom of this.
    You can remove any of your Autovectors with the RemAutovec routine.

  INPUTS
    level      - the autovector level to set, between 1 and 7 inclusive
    routine    - a pointer to an interrupt routine. It must end with the
                 two assembler commands NOP and RTE.

  RESULT
    nothing - autovector is set

  NOTE
    If the demo fails, ensure the interrupt routine actually WORKS. Also
    make sure you've got the right level number. Read my discussion of
    interrupts on Aminet (dev/asm/Exceptions.lha) if you don't know all
    there is to know about interrupts.

  SEE ALSO
    @{" RemAutovec " link Disable}, @{" Disable " link Disable}, @{" SetTrap " link SetTrap}

@endnode

@node SetTrap
CadOS.system/SetTrap                                   CadOS.system/SetTrap

  NAME 
    SetTrap()

  SYNOPSIS
    void SetTrap(trapnum,*routine)
                   D0       A0

  DESCRIPTION
    Sets the trap vector specified to run your routine. You can call this
    routine with the TRAP #n assembler command, when n is the trap you
    have set. The routine itself must act exactly the same way an exception
    or interrupt does. You can remove it with the ResetTrap routine.

  INPUTS
    trapnum    - the trap vector to set, between 0 and 15 inclusive.
    routine    - a pointer to the trap routine. It must end with the two
                 two assembler commands NOP and RTE.

  RESULT
    nothing - trap is set

  NOTE
    If the demo fails, ensure the trap routine actually WORKS. Also make
    sure you've got the right trap number, both on setting AND calling.
    If you use the TRAP command before you setup that particular trap, the
    demo will abort with the message "Untrapped TRAP".

  SEE ALSO
    @{" ResetTrap " link ResetTrap}, @{" Disable " link Disable}, @{" SetAutovec " link SetAutovec}

@endnode

@node RemAutovec
CadOS.system/RemAutovec                             CadOS.system/RemAutovec

  NAME 
    RemAutovec()

  SYNOPSIS
    void RemAutovec(level)
                     D0

  DESCRIPTION
    Removes the Autovector at the level specified, and replaces it with a
    null routine.

  INPUTS
    level      - the autovector level to set, between 1 and 7 inclusive

  RESULT
    nothing - autovector is set to the null interrupt

  SEE ALSO
    @{" SetAutovec " link SetAutovec}

@endnode

@node RemTrap
CadOS.system/RemTrap                                   CadOS.system/RemTrap

  NAME 
    ResetTrap()

  SYNOPSIS
    void ResetTrap(trapnum)
                   D0

  DESCRIPTION
    Resets the trap vector specified to the null TRAP.

  INPUTS
    trapnum    - the trap vector to reset, between 0 and 15 inclusive.

  RESULT
    nothing - trap is reset

  NOTE
    If you TRAP #trapnum this trap then it will fail your demo!

  SEE ALSO
    @{" SetTrap " link SetTrap}

@endnode

@node FlushCache
CadOS.system/FlushCache                             CadOS.system/FlushCache

  NAME 
    FlushCache()

  SYNOPSIS
    void FlushCache()

  DESCRIPTION
    Flushes the caches of the CPU in an entirely compatible way with all
    possible processors. How does it do this? Easy - it calls exec's
    CacheClearU!

  INPUTS
    nothing

  RESULT
    nothing - caches are flushed

  BUGS
    If you don't remember to flush the caches at the right times, you will
    cause bugs. Cache flushing is very important, many CadOS functions that
    change memory that the processor might have cached do a flush of the
    cache.
@endnode

@node SystemRequest
CadOS.system/SystemRequest                       CadOS.system/SystemRequest

  NAME 
    SystemRequest()

  SYNOPSIS
    result = SystemRequest(*bodytext, *responses, *arglist)
      D0                      A0           A1        A2 

  DESCRIPTION
    This is a simplified gateway to the "EasyRequest" function. It will
    NOT run if the system is disabled, it will return the default 0.
    If the system is not disabled, it will call EasyRequestArgs, which
    if you haven't defined NO_REQUESTERS, will cause the Workbench screen
    to appear if it isn't there already. I _URGE_ you to read the docs of
    EasyRequestArgs (intuition) and the RawDoFmt doc in exec.doc as they
    are incredibly important.

  INPUTS
    *bodytext  - A pointer to the text to be printed in the main body of
                 the requester. It can contain formatting instructions,
                 such as "%s" to insert a string here, "%d" for a word-size
                 number, and "%lx" for a longword hexidecimal number. Each
                 instruction (except "%%" for a '%' character) must be
                 matched by a word (%d, %x) or longword (%ld, %lx, %s) in
                 the arglist. Remember to put newlines where appropriate
                 (the text isn't wordwrapped) and end with a 0 byte.
    *responses - A pointer to a string with a list of response gadgets the
                 user may click, each one is seperated by "|"s, ie
                 "Yes|No|Not Sure" and can contain formatting instructions.
                 End with a 0 byte.
    *arglist   - A list of arguments to feed the formatting in the text or
                 the bodytext, see RawDoFmt()....

  RESULT
    result     - 0 if the rightmost gadget was pressed, if you have >1
                 gadget then take away the rightmost one, and from left
                 to right the gadget pressed corresponds to 1, 2, 3...
                 eg 1 gadget "0", 2 gadgets "1|0", 3 gadgets "1|2|0", 4
                 gadgets "1|2|3|0" ....

  SEE ALSO
    intuition.library/EasyRequestArgs, exec.library/RawDoFmt
@endnode

@node CauseDelay
CadOS.system/CauseDelay                             CadOS.system/CauseDelay

  NAME 
    CauseDelay()

  SYNOPSIS
    void CauseDelay(ticks)
                     D0.w

  DESCRIPTION
    This is an overly simple routine that will wait precisely for a small
    period of time, using the CIAA timer A.

  INPUTS
    ticks      - How much times 1.4096837ms to wait. If you wanted to wait
                 for 300ms then you would wait (300/1.4096837)+1 ticks.

  RESULT
    none - delay takes place

  BUGS
    Probably lots, it splats a lot of innocent bits at the same time.
@endnode


