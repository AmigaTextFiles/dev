@database CadOS errors
@node main "CadOS errors (or: bugs, in MY code?)"

 This is the doc to read when things go wrong, just pick the appropriate 
 headings and guide your way through the errors.

 1. @{" CadOS aborts my demo and gives me an error message " link _1}

 2. @{" CadOS _doesn't_ abort my demo, it's all gone wrong! " link _2}
@endnode

@node _1 " CadOS aborts my demo and gives me an error message"

Take note of the AT address given, if you have a monitor already loaded
then you can have a look there. Don't load one in later, though, as the
memory in which the error occurred will probably already have deallocated
and reused.

What message did it give?

 @{" Error #0 : Bus error " link _10}
 @{" Error #1 : Address error " link _11}
 @{" Error #2 : Illegal instruction " link _12}
 @{" Error #3 : Divide by zero " link _13}
 @{" Error #4 : CHK: Out of bounds " link _14}
 @{" Error #5 : Untrapped TRAPV " link _15}
 @{" Error #6 : Privillege violation " link _16}
 @{" Error #7 : Untrapped TRACE " link _17}
 @{" Error #8 : Untrapped $Axxx " link _18}
 @{" Error #9 : Untrapped $Fxxx " link _19}
 @{" Error #10 : Format error " link _1a}
 @{" Error #11 : Uninitialized vector " link _1b}
 @{" Error #12 : Unknown error !!! " link _1c}
 @{" Error #13 : Untrapped TRAP " link _1d}
 @{" Error #14 : Illegal exit of program " link _1e}
 @{" Error #15 : 'Undefined Error' error " link _1f}
@endnode

@node _10 "Error #0 : Bus error"
Oh dear, that's quite a problem, but most of the time it won't
be _your_ fault, apparantly some high-end Amigas cause these
because their Zorro boards are badly setup. Sorry I can't be
more specific.
@endnode

@node _11 "Error #1 : Address error"
This one comes up from time to time, it happens when the 020+ tries
to execute code from an odd address, which is caused by loading the
PC register with an odd address, RTSing with a misaligned or invalid
stack, or such. Usually a sign of @{" code corruption " link corr}.
@endnode

@node _12 "Error #2 : Illegal instruction"
This one comes up whenever you try to execute garbage code, or
execute the ILLEGAL instruction, which is a valid instruction designed
to force this error, has been misused in the past by demo coders to go
into Supervisor mode, which CadOS puts you in automatically. The address
that goes with it will be exactly the place to look if it was the
ILLEGAL instruction, but is probably miles away if it is @{" code corruption " link corr}.

Did you know that if you clear all memory to 0s, you can put a bit of code
near the end of memory, jump to near the start of memory, and it will work,
as the word $0000 is the opcode "ORI.B #0,D0", which ORs D0 with nothing!
@endnode

@node _13 "Error #3 : Divide by zero"
Another easy error. Look at the address CadOS gives you, there should be
a DIVS or DIVU instruction there. This one usually happens in 3(_1t3
c0d3rz' vector routines, because they don't actually check their Z
coordinates before dividing by them. When an object gets too close to the
screen, it all goes wrong.

To fix this, just ensure the number zero never gets near the source
operand.
@endnode

@node _14 "Error #4 : CHK: Out of bounds"
Don't use the CHK or CHK2 command, you're not meant to on Amiga.
If you're not using it, it's definately @{" code corruption " link corr}.
@endnode

@node _15 "Error #5 : Untrapped TRAPV"
Don't use the TRAPV instruction, you're not meant to on Amiga.
If you're not using it, it's definately @{" code corruption " link corr}.
@endnode

@node _16 "Error #6 : Privillege violation"
How did that happen? Due to CadOS, your demo is running in supervisor mode,
and there are very few instructions that cause a violation, I think maybe
the 020's MOVE.L <ea>,ISP command fails if not in an interrupt.

If the address is sporadic, it's @{" code corruption " link corr}.
@endnode

@node _17 "Error #7 : Untrapped TRACE"
Bit 15 of the status register (SR) has been set. Don't do that! ;-)
@endnode

@node _18 "Error #8 : Untrapped $Axxx"
You've executed non-standard code, probably @{" code corruption " link corr}.
@endnode

@node _19 "Error #9 : Untrapped $Fxxx"
See also @{" untrapped $Axxx " line _18}, but this error may also be due to writing FPU
instructions when the processor has no FPU, or an external FPU. These
instructions are handled OK in AmigaOS, because of 68040.library or others
setting a trap for $Fxxx instructions.
@endnode

@node _1a "Error #10 : Format error"
I think this is due to an error in a bitfield instruction.
@endnode

@node _1b "Error #11 : Uninitialized vector"
Should never get this, unless you forcibly wrote 0 to a vector (CadOS's
SetAutovec and SetTrap won't allow this) or changed the VBR to a cleared
area of memory (don't do this, CadOS does it for you) and an autovector
was needed before it was set up.

If you aren't doing this, it's a very flukey @{" code corruption " link corr}.
@endnode

@node _1c "Error #12 : Unknown error !!!"
I don't know what causes this, and the processor doesn't either!!!!!

If anyone gets one of these, _please_ send me a core dump of your Amiga,
and a note of the address CadOS gives you. Also, a screengrab would be
really cool.

I don't think even code corruption could cause this!
@endnode

@node _1d "Error #13 : Untrapped TRAP"
You use a TRAP #n command for a trap, before you SetTrap()'ed it.
See @{" CadOS.system/SetTrap " link CadOS_system.guide/SetTrap} for more details.
@endnode

@node _1e "Error #14 : Illegal exit of program"
You did an RTE in your main code, thus exiting CadOS's supervisor entry
to your demo. CadOS catches this as soon as possible and exits the correct
way, despite how you may try.
@endnode

@node _1f "Error #15 : 'Undefined Error' error"
You somehow managed to make CadOS think there was an error, when there
wasn't actually one. (Not hard, try MOVE.W #1,_fail)

It could also be that the _errnum data CadOS holds was corrupted, and
became a number not in the region of 0-14
@endnode

@node _2 "CadOS _doesn't_ abort my demo, it's all gone wrong!"

What happens?

 @{" The screen goes all out of sync.. I think my monitor's on fire! " link _20}
 @{" The graphics are all corrupted... whoops, it just crashed! " link _21}
 @{" It's all OK, suddenly it crashes! " link _22}
 @{" I have no idea... the screen is completely blank " link _24}
 @{" The screen jerks every now and again " link _23}
@endnode

@node _20 "The screen goes all out of sync.. I think my monitor's on fire!"
This is a common one, it's usual reason is writing to the higher custom
registers concerned with monitor rates and settings, such as vtotal, hsstop
or beamcon0. Why might that happen? The most common reason is writing to
a series of colour registers in a row, and going past the end of them, which
is something I did during CadOS development. "MakeScreen works OK for 1
plane, 2 planes, 3, 4, 5 (32 colours), 6... oh 6 it corrupts!" But I found
no errors in MakeScreen, the trouble was in my test source, which had

	lea	colours(pc),a0
	lea	$dff180,a1
	moveq	#(1<<planes)-1,d0
loop	move.w	(a0)+,(a1)+
	dbra	d0,loop

for 6 planes it was trashing the next 32 registers after the colour
registers.

Also, you may be trying Dr Skull/VD's 'trick' to get extra copper
instructions in a line, by changing HSTOTAL to a higher value. DON'T DO
THIS!! It breaks on TVs, and most non-multisync monitors. And it could
permanently damage and/or blow up* your monitor. Be warned.

It's also possible, if you have the CDANG bit of copper set (which it is,
by default, in CadOS) that running a copperlist that has instructions to
write these registers. If you change into an unviewable screenmode on
workbench, and disassemble the copperlist, you will find those sort of
instructions in it.

* A little overexaggeration, in tribute to Mr Kevin Morrison's quip,
  "You might suffer a bad case of being killed".
@endnode

@node _21 "The graphics are all corrupted... whoops, it just crashed!"
The first place to look is at anywhere you use the _blitter_.
Second place to look is where you are doing long writes to screen
memory.
@endnode

@node _22 "It's all OK, suddenly it crashes!"
Erm....
@endnode

@node _23 "I have no idea... the screen is completely blank"
 - Check that your interrupts clear their cause (ie TUBES int writes back
   INTF_TUBES to INTREQ) otherwise they'll repeat ad-infintum, only
   stoppable by a higher interrupt.

 - If you're using a chunky copper, ensure that the RDRAM bit in BPLCON2
   isn't set. If it's a non-AGA copper, ensure that the LOCT bit in BPLCON3
   isn't set.

 - Ensure you're passing valid positioning to MakeScreen or DisplayIFF.

 - Are you writing into the bitmap, not the copperlist?

 - You haven't touched the high-registers above the colour registers,
   right?

 - Does your code ever get to the bit where it writes the screen?

 - Have you done a MOVE.L to the hardware when you meant MOVE.W?
@endnode

@node _24 "The screen jerks every now and again"
 - Usually a level [4|5|6] interrupt pre-empting the level 3 (VERTB and
   BLIT interrupts) Avoid long periods of time in these interrupts, and
   at the end of your higher interrupts always JMP or BRA directly to the
   current lev3, in case a VBL has occured during the lev[4|5|6] (actually,
   if you have a lev 3, 4, 5 and 6, 6 should jump to 5, 5 should jump to
   4, and 4 should jump to 3. Ideally, put them all in the same code).
@endnode

