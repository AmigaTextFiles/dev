;QUICK DISK ROUTINES CHECK:
;IF A LOAD FAILS, SCREEN=RED IF OK = GREEN
;
;PK 6/92
	OPT C-,O+
;	OUTPUT :DISKTEST
	SECTION STARTUP,CODE_C
HELP ;DISK ROUTINE FLICKS COLOR00 AS BLOCK880 READ IN `FINDDISK` ROUTINE
	INCLUDE Source:INCLUDE/HARDWARE.I
	INCLUDE Source:P.Kent/INCLUDES/MYMACROS.I
	INCLUDE	Source:P.Kent/INCLUDES/COMBISTART.S
	INCLUDE	Source:P.Kent/INCLUDES/HWSTART.S
;Memory alloc routines...
	INCLUDE	Source:P.Kent/INCLUDES/MEMORYMNGR.S
	INCLUDE Source:P.Kent/INCLUDES/DISKMACROS2.I
	INCLUDE	Source:P.Kent/INCLUDES/DISK.S
	INCLUDE	Source:P.Kent/INCLUDES/LHDECODE.S
;AMOUNT OF K TO SIMULATE...
;
SLOWK = 256	; Just set up 2 .25MB buffers...
FASTK = 1	; Force use of slow+chip entries if more than 1k reqd
CHIPK = 256


_BOOT
	LEA VARIABLES,A5
	LEA CUSTOM,A6
	MOVE.W #$0200,BPLCON0(A6)
	MOVE.W #0,COLOR00(A6)
	MOVE.W #SETIT!DMAEN!DSKEN!BPLEN,DMACON(A6)

	LEA	MEMINFO,A1				; Set up my ram allocation system :-)
	BSR	Minitialise

	BSR InitDisks

	MOVEQ #-1,D0
TLP	MOVE.W 6(A6),COLOR00(A6)
	DBRA D0,TLP

	LEA NAME(PC),A0					; FNAME+PATH
	MOVEQ #LFTYPE_CHIP,D1			; Address if reqd else load sig...
	BSR	LOADFILE
	BSR.S DERR

	LEA NAME2(PC),A0
	MOVEQ.L #LFTYPE_PUBLIC,D1
	BSR	LOADFILE
	BSR.S DERR

	LEA NAME3(PC),A0
	MOVEQ.L #LFTYPE_PUBLIC,D1
	BSR	LOADFILE
	BSR.S DERR

	MOVEQ #-1,D0
TLP2	MOVE.W 6(A6),COLOR00(A6)
	DBRA D0,TLP2

	RTS								; Return and restore resources


DERR	TST.L D1
	BEQ.S TF1
	MOVE.W #$0F0,COLOR00(A6)
	BRA.S TF11
TF1 MOVE.W #$F00,COLOR00(A6)
TF11
	RTS

NAME DC.B 'source:p.kent/source/disktest.s',0
	EVEN
NAME2 DC.B 'Source:P.Kent/GFX/SPINBLOCKS.IRAWC',0
	EVEN
NAME3 DC.B 'Source:P.Kent/:GFX/PIC1.IRAWC.LH',0
	EVEN

MEMINFO DC.L 'RAMC',CHIPLIST,$400*CHIPK	;Chip ram : must be 1st in list!
		DC.L 'RAMS',SLOWLIST,$400*SLOWK	;Slow fast ram
		DC.L 'RAMF',FASTLIST,$400*FASTK	;True fast ram...
		DC.L 0

	SECTION MYVARS,BSS
	RSRESET
	DISKVARS
VARLENGTH	RS.W	1
VARIABLES	DS.B VARLENGTH

;Simulate CHIP ram...
	SECTION MEM,BSS_C
CHIPLIST	DS.B $400*ChipK
;Simulate 'slow' FAST ram $c00000+ (trapdoor)
	SECTION MOREMEM,BSS
SLOWLIST	DS.B $400*SlowK
;Simulate $200000+ ram (autoconfig etc)
	SECTION	AUTOMEM,BSS
FASTLIST	DS.B $400*FastK

