*******************************************************************************
*WRITE LOADER TO DISK ROUTINE
*******************************************************************************
SDLOADER:
	MOVE.L	#MODE_NEW,D2		*CODE TO CREATE NEW FILE
	BSR	OPENFILE		*OPEN UP A NEW FILE CALLED S/LOADER
	BEQ	ERROR			*ANY ERRORS THE EXIT
	BSR	WRITEFILE		*WRITE DATA TO THE FILE
	BSR	CLOSEFILE		*CLOSE THE FILE
	RTS				*RETURN TO MAIN ROUTINE
WRITEFILE:
	MOVE.L	DOSBASE,A6		*DOS.LIBRARY BASE ADRESS
	MOVE.L	LHANDLE,D1		*POINTER TO FILE HANDLE = (S/LOADER)
	MOVE.L  #FILEINFO,D2		*START MARKER OF DATA TO WRITE
	MOVE.L	#FILEND-FILEINFO,D3	*END MARKER OF DATA 
	JSR	WRITEF(A6)		*DOS CALL TO WRITE FILE 
	RTS
OPENFILE:
	MOVE.L	DOSBASE,A6		*DOS.LIBRARY BASE ADRESS
	MOVE.L	#DLOADER,D1		*NAME NEW FILE = (S/LOADER)
	JSR	OPEN(A6)		*DOS CALL TO OPEN FILE
	MOVE.L	D0,LHANDLE		*SAVE THE FILE HANDLE FOR LATTER USE
	RTS				
CLOSEFILE:
	MOVE.L	DOSBASE,A6		*DOS.LIBRARY BASE ADRESS
	MOVE.L	LHANDLE,D1		*FILE HANDLE FILE NAME = (SLOADER)
	JSR	CLOSEF(A6)		*DOS CALL TO CLOSE THE FILE
ERROR:	RTS
*******************************************************************************
*STRUCTURES AND VARIBLES
*******************************************************************************
MODE_NEW  EQU	1006			*OPEN A NEW FILE CODE
MODE_OLD  EQU	1005			*OPEN A EXSISTING FILE
DLOADER:	  
	DC.B	"S/LOADER",0		*NAME OF THE FILE TO WRITE
	  EVEN
LHANDLE:  
	DC.L	0			*ADRESS SPACE FOR FILE HANDLE
FILEINFO: 
	INCBIN  source:trog/MENUboot/LOADER.BIN *DATA FOR THE FILE
FILEND:
*******************************************************************************
