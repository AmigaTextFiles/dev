
                                                           1 Alice Way,
                                                           Unstone Green,
                                                           Sheffield,
                                                           S18-5DN.
                                                           2/2/91
                                                           (0246) 419125
       
Mark,

   I have corrected  your console  program, and included it on
 this disk. You were  probably nearer than  you thought ( if you haven't
 already found out or received  corrections from  other people). In fact
 there were just three errors.
 
 1) Used wrong register in the ConPut routine (should be a1)
 
 2) Used long word addressing for IO_COMMAND   (should be short word 
  addressing).
  
 3) Strange one this, and usually fatal. You used the line
  
	lea  window.ptr,a1
	CALLINT   CloseWindow
  
	which should of course be
  
	move.l  window.ptr,a0
	CALLINT   CloseWindow
  
 Silly  mistake but you can convince  yourself that you  wouldn't make a
 mistake  here and spend  hours  looking elsewhere for the error. I know
 I've done it myself.

  The console program  on disk  adds a few extra  functions like ConRead
 etc. I have added a few editing features, see what you think.
 
  Other  sources on this disk are in reply  to questions sent to me this
 month. I have replied to the people involved personally, but thought it
 a good idea to send in the source so that other people may benefit from
 them. The questions in order were :
 
 1)	I am having problems using the trackdisk device to write data to
	the bootblock.
  
 2)	When I add a gadget to a windows border it will be displayed O.K.
  	but I cannot  get any messages from  it. If I remove  the Window
  	drag  gadget it works fine. How do I add a gadget and still keep
  	the window drag gadget ?
  
 3)	When I use Intuitions  SizeWindow function the text and graphics
	written to the window  immediately after is not always displayed.
	The results are not consistent, sometimes all text is displayed,
	sometimes  a little  portion of it  is displayed, and  sometimes
	none of it is displayed. Why ? and how do I code around it.
  
 Taking these in order here are my answers.
 
 1)	The trackdisk is quite a simple device to use. The main thing to
	remember is that the  buffers for data reads  and writes must be
	in chip ram. There is a  short demo  program on this disk called
	Trackdisk (source Trackdisk.s) which  simply writes a utility to
	the  bootblock of the disk in DF0:. This is a  useful  bootblock
	utility which I simply  ripped from a disk using the routines in
	the trackdisk program. The  trackdisk  program is  more a set of
	subroutines than a useful program, the first part is just a demo
	of how to use the subroutines. These subroutines were written to
	be  simple to use, and  to  follow the  conventions for  library
	routines. The subroutines included will
  
  Open the trackdisk
  Close the trackdisk
  Check Write protect tab on disk
  Read Sectors
  Write Sectors
  Switch off disk motor (required after a read or write)
  
  	There are also simple CreatePort and DeletePort routines included
  	which will create ports which are added to the system lists. Note
  	that the arp lib  createport creates private ports, however it is
  	a  simple matter  to add these  to the  system if  required. This
  	makes these routines preferable if you happen to have the arp lib
  	open. I may  improve on these routines later, and add  extra ones
  	like formatting tracks etc. I also hope to do an in depth look at
  	all the devices and  resources over the  next few months as these
  	seem to cause programmers the most problems.
  
 2)	There  are quite  a few ways to  solve this this  problem. I find
	that the simplest way is this.
   
   	Create the  gadget  structure  making sure  to set the TOPBORDER
   	flag in the activation field of the gadget. This makes sure that
   	the border is adjusted to accommodate the gadget.
   
   	Link the gadget into the NewWindows gadget list.
   
   	Open the  Window. Note that the  border flags  ONLY work  when a
   	window is opened. Adding gadgets after the window is opened will
   	not adjust the border.
   
   	Remove the gadget using RemoveGadget()
   
   	Add the gadget back to the top of the gadget list using AddGadget
   	with a zero in d0.
   
   	Although not always necessary you can Refresh the gadget.
   
   	Doing this places the  border gadget  before the  drag gadget in
   	the windows  gadget list and  so is tested  first. Note that the
   	drag gadget is 10 lines in height (usually) and runs all the way
   	across the window, under the close and depth gadgets.
   	There is an example program called BorderGadgets which is also
   	used to demonstrate the next solution.
   
 3)	This ones quite simple really. Just set the windows NEWSIZE IDCMP
  	flag. Then after you call  SizeWindow, wait for intuition to send
  	you a  NEWSIZE  message. The  reason that you  need to do this is
  	that  SizeWindow  simply tells  intuition to resize a window then
  	returns. If you write text of graphics to the  window immediately
  	after  calling  SizeWindow  you  may be rendering  into a smaller
  	window, causing some of the text to be clipped.
  	The demo program BorderGadgets shows how to do this. This program
  	adds a gadget to  the top border. Clicking  on this  gadget  will
  	produce a sort of iconify option, similar to SID's shrink gadget.
  	Note that SizeWindow is one of Intuitions most dangerous routines.
 	Passing wrong  parameters to this  routine can cause a Guru as it
 	does no error  checking. A window can  be resized larger than the
 	screen which it  appears on. The  result is - well interesting to
	say the least.

	Well that's about  all for this  month, I hope  to get a bit more
	done for next month.
 
 Steve Marshall
