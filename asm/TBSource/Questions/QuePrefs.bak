*************************************************
*						*
*		 (C)opyright 1991		*
*						*
*		by  Tomi Blinnikka		*
*						*
*	Don´t try to understand the code	*
*						*
* Version: See info from main source code	*
*						*
*************************************************

	INCLUDE	"JMPLibs.i"
	INCLUDE	"exec/types.i"
	INCLUDE	"libraries/reqbase.i"

	INCLUDE	"XREF:intuition.xref"
	INCLUDE	"XREF:2.0.xref"
	INCLUDE	"XREF:dos.xref"
	INCLUDE	"XREF:exec.xref"
	INCLUDE	"XREF:gfx.xref"

	XDEF	Prefs20
	XDEF	SToW5
	XDEF	PrefsWin1
	XDEF	NoPrefsWin1
	XDEF	glist2
	XDEF	mlist2
	XDEF	GadMagic2
	XDEF	MenuMagic2
	XDEF	DefPrefs
	XDEF	Talk
	XDEF	TalkSys
	XDEF	TalkDes
	XDEF	TalkQue
	XDEF	TalkAns
	XDEF	TalkScore
	XDEF	IHandler
	XDEF	FileRequest2
	XDEF	SpeakName
	XDEF	SpeakName2
	XDEF	PrefsFile
	XDEF	SpeakFile
	XDEF	SpeakFile2
	XDEF	FRPathName2
	XDEF	Colors
	XDEF	ColorsBuf
	XDEF	P1CheckFile
	XDEF	PrefsBuf
	XDEF	CurrentPrefs
	XDEF	PrefsSize

	XREF	SysPrefsBuf
	XREF	LoadCommKey
	XREF	SaveCommKey
	XREF	SaveAsCommKey
	XREF	QuitCommKey
	XREF	QuitMenu1I2Text
	XREF	PrefsM2Text
	XREF	PrefsM3Text
	XREF	PrefsM4Text
	XREF	Speaker
	XREF	vi
	XREF	Window1
	XREF	Screen1
	XREF	ViewPort1
	XREF	SS_Font1
	XREF	SS_Load3
	XREF	SS_Save2
	XREF	SS_SaveAs2
	XREF	SS_Prefs
	XREF	SS_Colors
	XREF	SS_On
	XREF	SS_Done
	XREF	SS_Quit
	XREF	SS_Use
	XREF	SS_Default
	XREF	SS_ERR_Win1
	XREF	SS_ERR_File1
	XREF	SS_ERR_File2
	XREF	SS_ERR_File3
	XREF	SS_ERR_Font1
	XREF	AskReplace
	XREF	ClockPointer1
	XREF	SimpleRequest
	XREF	TwoGadRequest
	XREF	FileError
	XREF	SetActivation
	XREF	OthActivation
	XREF	OthActivation1
	XREF	MenusOff
	XREF	MenusOn
	XREF	SleepPointer
	XREF	NormalPointer
	XREF	MenuNull
	XREF	CheckIDCMP
	XREF	ClearMSGs
	XREF	OKTxt
	XREF	_GadToolsBase
	XREF	_IntuitionBase
	XREF	_DosBase
	XREF	_GfxBase
	XREF	_ReqBase
	XREF	_stdout
	XREF	Window1IDCMP
	XREF	ShutDown
	XREF	QName
	XREF	Topaz
	XREF	TopazName
	XREF	PrefTop
	XREF	MainMGad1
	XREF	MainMenu
	XREF	Mode
	XREF	NumQ

PrefWinYSize:	EQU	150
;PrefsSize:	at the end...


TRUE:		EQU	$1

DGadTools:	set	1
DReq:		set	1

	INCLUDE	"FH1:Language/Include2.0/Utility/tagitem.i"
	INCLUDE	"FH1:Language/Include2.0/Libraries/gadtools.i"

		ds.l	0

NoPrefsWin1:	print	<"Couldn't open Preferences-Window1!",13,10>,_stdout
		move.l	Screen1,a0
		lib	Intuition,DisplayBeep
		lea.l	SS_ERR_Win1,a0
		jsr	Speaker
		jmp	ShutDown

Prefs20:	jsr	SleepPointer

		cmp.w	#$00,Mode
		bne	Prefs20Cont1
		move.l	Window1,a0
		lea.l	MainMGad1,a1
		move.l	#-1,d0
		lib	Intuition,RemoveGList
		jmp	Prefs20Cont2

Prefs20Cont1:	cmp.w	#$02,Mode
		bne	Prefs20Cont2

		move.w	NumQ,d6
		clr.w	NumQ
		jsr	SetActivation
		jsr	OthActivation
		move.w	d6,NumQ

Prefs20Cont2:	jsr	MenusOff
		lea.l	SS_Prefs,a0
		jsr	Speaker

		tst.b	GadMagic2
		bne	Prefs20.1
		lea.l	glist2,a0
		lib	GadTools,CreateContext
		move.l	d0,ContextGad2
		beq	Prefs20.1

		move.l	glist2,a0
		lea.l	NGTalkGad0,a1
		move.l	#TEXT_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		move.l	#$00,a2
;		lea.l	TalkGadTagList1,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGTalkGad1,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		move.l	#$00,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,TalkGad1
		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGTalkGad2,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,TalkGad2
		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGTalkGad3,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,TalkGad3
		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGTalkGad4,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,TalkGad4
		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGTalkGad5,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,TalkGad5
		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGTalkGad6,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,TalkGad6
		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGTalkGad7,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,TalkGad7
		move.l	d0,a0

		add.w	#GADGDISABLED!GRELBOTTOM,$c(a0)

		lea.l	NGTalkGad8,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,TalkGad8
		move.l	d0,a0

		add.w	#GADGDISABLED+GRELBOTTOM,$c(a0)

		lea.l	NGStringGad0,a1
		move.l	#TEXT_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		move.l	#$00,a2
;		lea.l	TalkGadTagList1,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,a0
		add.w	#GRELRIGHT!GRELBOTTOM,$c(a0)

		lea.l	NGSpeakGad1,a1
		move.l	#STRING_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	SpeakGadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,SpeakGad1
		move.l	d0,a0
		move.l	$22(a0),a1
		move.l	(a1),SpeakGadBuf
		add.w	#GRELRIGHT!GRELBOTTOM,$c(a0)

		lea.l	NGSpeakGad2,a1
		move.l	#STRING_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	SpeakGadTagList2,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,SpeakGad2
		move.l	d0,a0
		move.l	$22(a0),a1
		move.l	(a1),SpeakGadBuf2
		add.w	#GRELRIGHT!GRELBOTTOM!GADGDISABLED,$c(a0)

		lea.l	NGMiscGad0,a1
		move.l	#TEXT_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		move.l	#$00,a2
;		lea.l	TalkGadTagList1,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGIHandlerGad1,a1
		move.l	#CHECKBOX_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA

		move.l	d0,IHandlerGad1
		move.l	d0,a0
		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGColorGad,a1
		move.l	#BUTTON_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA
		move.l	d0,a0

		add.w	#GRELBOTTOM+GRELRIGHT,$c(a0)

		lea.l	NGDefaultsGad,a1
		move.l	#BUTTON_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA
		move.l	d0,a0

		add.w	#GRELBOTTOM+GRELRIGHT,$c(a0)

		lea.l	NGSaveGad,a1
		move.l	#BUTTON_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA
		move.l	d0,a0

		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGUseGad,a1
		move.l	#BUTTON_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA
		move.l	d0,a0

		add.w	#GRELBOTTOM,$c(a0)

		lea.l	NGQuitGad,a1
		move.l	#BUTTON_KIND,d0
		move.l	vi,gng_VisualInfo(a1)
		lea.l	GadTagList,a2
		lib	GadTools,CreateGadgetA
		move.l	d0,a0

		add.w	#GRELBOTTOM+GRELRIGHT,$c(a0)

		move.b	#1,GadMagic2

Prefs20.1:	tst.b	MenuMagic2
		bne	Prefs20.2
		lea.l	MNP1PrefsMenu1,a0
		lea.l	P1MenuTagList,a1
		lib	GadTools,CreateMenusA
		move.l	d0,mlist2

		move.l	mlist2,a0
		move.l	vi,a1
		lea.l	P1MenuTagList,a2
		lib	GadTools,LayoutMenusA
		move.b	#1,MenuMagic2

Prefs20.2:	lea.l	NewPrefsWin1,a0
		lea.l	PrefsWinTagList,a1
		lib	Intuition,OpenWindowTagList
		move.l	d0,PrefsWin1
		beq	NoPrefsWin1

		move.l	PrefsWin1,a0
		move.l	mlist2,a1
		lib	Intuition,SetMenuStrip

		move.l	PrefsWin1,a0
		move.l	glist2,a1
		move.l	#-1,d0
		move.l	#-1,d1
		move.l	#$00,a2
		lib	Intuition,AddGList

		move.l	glist2,a0
		move.l	PrefsWin1,a1
		move.l	#$00,a2
		move.l	#-1,d0
		lib	Intuition,RefreshGList

		move.l	PrefsWin1,a0
		move.l	#$00,a1
		lib	GadTools,GT_RefreshWindow

		move.l	#$01,d2
		jsr	SetPrefs

P120IDCMP:	move.l	PrefsWin1,a0
		jsr	CheckIDCMP
		cmp.l	#CLOSEWINDOW,d2
		beq	Prefs20Quit
		cmp.l	#REFRESHWINDOW,d2
		beq	P1Refresh20
		cmp.l	#VANILLAKEY,d2
		beq	P1VKeys20
		cmp.l	#GADGETUP,d2
		beq	P1GSelect20
		cmp.l	#MENUPICK,d2
		beq	P1Menus20
		cmp.l	#RAWKEY,d2
		beq	P1RKeys20
		jmp	P120IDCMP

P1Refresh20:	move.l	PrefsWin1,a0
		lib	GadTools,GT_BeginRefresh
		move.l	PrefsWin1,a0
		move.l	#TRUE,d0
		lib	GadTools,GT_EndRefresh
		jmp	P120IDCMP

P1Menus20:	jsr	MenuNull
		cmp.l	#$00,d6
		beq	P1Menus20.1
		cmp.l	#$01,d6
		beq	P1Menus20.2
		jmp	P120IDCMP
P1Menus20.1:	cmp.l	#$00,d5
		beq	P1Load
		cmp.l	#$01,d5
		beq	P1Save
		cmp.l	#$02,d5
		beq	P1SaveAs
		cmp.l	#$04,d5
		beq	P1Default
		cmp.l	#$06,d5
		beq	Prefs20Use
		cmp.l	#$07,d5
		beq	Prefs20Quit
P1Menus20.2:	cmp.l	#$00,d5
		beq	P1Colors
		jmp	P120IDCMP

P1VKeys20:	cmp.w	#$1b,d3
		beq	Prefs20Quit
		jmp	P120IDCMP
P1RKeys20:	;cmp.w	#$00,d3
;		beq	Prefs20Quit
		jmp	P120IDCMP

P1GSelect20:	cmp.w	#60,$26(a5)
		beq	P1Colors
		cmp.w	#70,$26(a5)
		beq	P1Default
		cmp.w	#80,$26(a5)
		beq	P1Save
		cmp.w	#98,$26(a5)
		beq	Prefs20Use
		cmp.w	#99,$26(a5)
		beq	Prefs20Quit
		jmp	P120IDCMP

P1Load:		jsr	P1MenusOff
		jsr	P1SleepPointer

		lea.l	SS_Load3,a0
		jsr	Speaker

		lea.l	P1LoadName,a5
		move.l	#FRQABSOLUTEXYM+FRQLOADINGM,d5
		jsr	FileRequester
		tst.l	d0
		beq	P1Load_OUT1

		lea.l	FRPathName2,a1
		move.l	a1,d1
		cmp.b	#$00,(a1)
		beq	P1Load_OUT1
		move.l	#MODE_OLDFILE,d2
		lib	Dos,Open
		move.l	d0,PrefsFile
		bne	Load1
		jsr	FileError
		jmp	P1Load_OUT1

Load1:		jsr	P1CheckFile
		tst.l	d0
		beq	P1Load_OUT2

Load2:		move.l	PrefsFile,d1
		lea.l	ColorsBuf,a0
		move.l	a0,d2
		move.l	#PrefsSize-4,d3
		lib	Dos,Read
		tst.l	d0
		bne	Load3
		jsr	FileError
		lea.l	SS_ERR_File1,a0
		jsr	Speaker
		jmp	Load4

Load3:		lea.l	PrefsBuf,a0
		lea.l	CurrentPrefs,a1
		move.l	#PrefsSize,d0
		lib	Exec,CopyMem

		jsr	MoveSpeakName2
		jsr	MoveSpeakName

		move.l	#$01,d2
		jsr	SetPrefs

		jsr	P1ChangeSpeak

Load4:		move.l	PrefsFile,d1
		lib	Dos,Close
		move.l	#$00,PrefsFile

P1Load_OUT:	lea.l	SS_Done,a0
		jsr	Speaker
		jsr	P1MenusOn
		jsr	P1NormalPointer
		jmp	Prefs20Quit

P1Load_OUT1:	jsr	P1MenusOn
		jsr	P1NormalPointer
		jmp	P120IDCMP

P1Load_OUT2:	lea.l	SS_ERR_File2,a0
		jsr	Speaker

		move.l	PrefsFile,d1
		lib	Dos,Close
		move.l	#$00,PrefsFile
		jsr	P1MenusOn
		jsr	P1NormalPointer
		jmp	Prefs20Quit

P1SaveAs:	jsr	P1MenusOff
		jsr	P1SleepPointer

		lea.l	SS_SaveAs2,a0
		jsr	Speaker

		lea.l	P1SaveName,a5
		move.l	#FRQABSOLUTEXYM+FRQSAVINGM,d5
		jsr	FileRequester
		tst.l	d0
		beq	P1Save_OUT1

		lea.l	FRPathName2,a1
		move.l	a1,d1
		tst.b	(a1)
		beq	P1Save_OUT
		move.l	#MODE_OLDFILE,d2
		lib	Dos,Open
		move.l	d0,PrefsFile
		beq	P1Save1		;file doesn't exist...

;The file already exists so we'll ask if the user wants to replace old file 

		lea.l	SS_ERR_File3,a0
		jsr	Speaker

		lea.l	AskReplace,a0
		move.l	#$00,a1
		jsr	TwoGadRequest
		tst.l	d0
		beq	P1Save_OUT

		move.l	PrefsFile,d1
		lib	Dos,Close
		move.l	#$00,PrefsFile

P1SaveAsOut:	jsr	P1MenusOn
		jsr	P1NormalPointer

P1Save:		jsr	P1MenusOff
		jsr	P1SleepPointer

		lea.l	SS_Save2,a0
		jsr	Speaker

P1Save1:	tst.l	PrefsFile
		bne	P1Save2
		lea.l	FRPathName2,a1
		move.l	a1,d1
		move.l	#MODE_NEWFILE,d2
		lib	Dos,Open
		move.l	d0,PrefsFile
		bne	P1Save2
		jsr	FileError
		jmp	P1Save_OUT

P1Save2:	move.l	#"QUEP",CurrentPrefs
		jsr	MoveColors

		jsr	MoveSpeakName

		clr.l	d2
		jsr	SetPrefs

		jsr	P1ChangeSpeak

		move.l	PrefsFile,d1
		lea.l	CurrentPrefs,a0
		move.l	a0,d2
		move.l	#PrefsSize,d3
		lib	Dos,Write
		cmp.l	#-1,d0
		beq	P1SaveError

P1Save3:	move.l	PrefsFile,d1
		lib	Dos,Close
		move.l	#$00,PrefsFile

P1Save_OUT:	lea.l	SS_Done,a0
		jsr	Speaker

		jsr	P1MenusOn
		jsr	P1NormalPointer
		jmp	Prefs20Quit

P1Save_OUT1:	jsr	P1MenusOn
		jsr	P1NormalPointer
		jmp	P120IDCMP

P1SaveError:	jsr	FileError
		lea.l	SS_ERR_File1,a0
		jsr	Speaker

		move.l	PrefsFile,d1
		lib	Dos,Close
		move.l	#$00,PrefsFile

		jmp	P1Save_OUT1

P1Colors:	jsr	P1MenusOff
		jsr	P1SleepPointer

		lea.l	SS_Colors,a0
		jsr	Speaker

		move.l	#$00,d0
		lib	Req,ColorRequester

;Get the ColorMap correctly

		move.l	ViewPort1,a0
		move.l	$4(a0),a3

		move.l	a3,a0
		move.l	#$00,d0
		lib	Gfx,GetRGB4
		move.w	d0,ColorsBuf

		move.l	a3,a0
		move.l	#$01,d0
		lib	Gfx,GetRGB4
		move.w	d0,ColorsBuf+2

		move.l	a3,a0
		move.l	#$02,d0
		lib	Gfx,GetRGB4
		move.w	d0,ColorsBuf+4

		move.l	a3,a0
		move.l	#$03,d0
		lib	Gfx,GetRGB4
		move.w	d0,ColorsBuf+6

		jsr	P1MenusOn
		jsr	P1NormalPointer
		jmp	P120IDCMP

P1Default:	lea.l	SS_Default,a0
		jsr	Speaker

		lea.l	DefPrefs,a0
		lea.l	CurrentPrefs,a1
		move.l	#PrefsSize,d0
		lib	Exec,CopyMem

		move.l	SpeakFile,d1
		beq	P1Default1
		lib	Dos,Close
		move.l	#$00,SpeakFile

P1Default1:	lea.l	SpeakName,a0
		move.l	a0,d1
		move.l	#MODE_NEWFILE,d2
		lib	Dos,Open
		move.l	d0,SpeakFile
		bne	P1Default2

		lea.l	NoSPEAKText3,a0
		move.l	#$00,a1
		jsr	SimpleRequest
		move.w	#$00,Talk		;Disable talking

P1Default2:	lea.l	SysPrefsBuf,a0
		move.l	#118,d0
		lib	Intuition,GetPrefs

		lea.l	SysPrefsBuf,a0
		move.l	$6e(a0),Colors
		move.l	$6e+4(a0),Colors+4

		jsr	MoveColors2

		jsr	MoveSpeakName3

		move.l	#1,d2
		jsr	SetPrefs

		jmp	Prefs20Quit

Prefs20Use:	lea.l	SS_Use,a0
		jsr	Speaker

		lea.l	PrefsBuf,a0
		lea.l	CurrentPrefs,a1
		move.l	#PrefsSize,d0
		lib	Exec,CopyMem

		clr.l	d2
		jsr	SetPrefs

		jsr	MoveSpeakName
		jsr	P1ChangeSpeak

		lea.l	SS_On,a0
		jsr	Speaker

		jmp	Prefs20Quit

P1ChangeSpeak:	move.l	SpeakFile,d1
		beq	P1ChangeSpeak1
		lib	Dos,Close
		move.l	#$00,SpeakFile

P1ChangeSpeak1:	lea.l	SpeakName,a0
		move.l	a0,d1
		move.l	#MODE_NEWFILE,d2
		lib	Dos,Open
		move.l	d0,SpeakFile
		beq	P1CSNotOpen
		rts

P1CSNotOpen:	lea.l	NoSPEAKText2,a0
		move.l	#$00,a1
		jsr	SimpleRequest
		move.w	#$00,Talk		;Disable talking
		rts

Prefs20Quit:	lea.l	SS_Quit,a0
		jsr	Speaker

		move.l	PrefsWin1,a0
		lib	Intuition,ClearMenuStrip
		move.l	PrefsWin1,a0
		jsr	ClearMSGs
		move.l	#$00,PrefsWin1

		jsr	MenusOn
		jsr	NormalPointer
		cmp.w	#$00,Mode
		bne	Prefs20Quit1
		jsr	MainMenu
		jmp	Window1IDCMP

Prefs20Quit1:	cmp.w	#$02,Mode
		bne	Window1IDCMP
		jsr	SetActivation
		jsr	OthActivation1
		jmp	Window1IDCMP

MoveColors:	move.l	ColorsBuf,Colors
		move.l	ColorsBuf+4,Colors+4
		rts

MoveColors2:	move.l	Colors,ColorsBuf
		move.l	Colors+4,ColorsBuf+4
		rts

MoveSpeakName:	move.l	SpeakGadBuf,a0
		lea.l	SpeakName,a1
MSName1.1:	move.b	(a0)+,(a1)+
		tst.b	-1(a0)
		bne	MSName1.1
		rts

MoveSpeakName2:	lea.l	SpeakNameBuf,a0
		lea.l	SpeakName,a1
MSName2.1:	move.b	(a0)+,(a1)+
		tst.b	-1(a0)
		bne	MSName2.1
		rts

MoveSpeakName3:	lea.l	SpeakName,a0
		move.l	SpeakGadBuf,a1
MSName3.1:	move.b	(a0)+,(a1)+
		tst.b	-1(a0)
		bne	MSName3.1
		rts

SetPrefs:	move.l	ViewPort1,a0
		lea.l	Colors,a1
		move.l	#$04,d0
		lib	Gfx,LoadRGB4

		move.l	PrefsWin1,a0
		move.l	glist2,a1
		move.l	#-1,d0
		lib	Intuition,RemoveGList

		tst.l	d2
		beq	Set2Prefs

		move.l	TalkGad1,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	TalkGad2,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	TalkGad3,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	TalkGad4,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	TalkGad5,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	TalkGad6,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	TalkGad7,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	TalkGad8,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	IHandlerGad1,a0
		and.w	#~SELECTED,gg_Flags(a0)

		move.l	TalkGad1,a0
		tst.w	Talk
		beq	SetPrefs1
		or.w	#SELECTED,gg_Flags(a0)

SetPrefs1:	move.l	TalkGad2,a0
		tst.w	TalkSys
		beq	SetPrefs2
		or.w	#SELECTED,gg_Flags(a0)

SetPrefs2:	move.l	TalkGad3,a0
		tst.w	TalkDes
		beq	SetPrefs3
		or.w	#SELECTED,gg_Flags(a0)

SetPrefs3:	move.l	TalkGad4,a0
		tst.w	TalkQue
		beq	SetPrefs4
		or.w	#SELECTED,gg_Flags(a0)

SetPrefs4:	move.l	TalkGad5,a0
		tst.w	TalkAns
		beq	SetPrefs5
		or.w	#SELECTED,gg_Flags(a0)

SetPrefs5:	move.l	TalkGad6,a0
		tst.w	TalkScore
		beq	SetPrefs6
		or.w	#SELECTED,gg_Flags(a0)

SetPrefs6:	;move.l	TalkGad7,a0
		;tst.w	TalkTimer
		;beq	SetPrefs7
		;or.w	#SELECTED,gg_Flags(a0)

SetPrefs7:	;move.l	TalkGad8,a0
		;tst.w	TalkHelp
		;beq	SetPrefs8
		;or.w	#SELECTED,gg_Flags(a0)

SetPrefs8:	move.l	IHandlerGad1,a0
		tst.w	IHandler
		beq	SetPrefs9
		or.w	#SELECTED,gg_Flags(a0)

SetPrefs9:	move.l	PrefsWin1,a0
		move.l	glist2,a1
		move.l	#00,a2
		move.l	#-1,d0
		move.l	#-1,d1
		lib	Intuition,AddGList

		move.l	glist2,a0
		move.l	PrefsWin1,a1
		move.l	#$00,a2
		move.l	#-1,d0
		lib	Intuition,RefreshGList

SetPrefs10:	rts

Set2Prefs:
		move.l	TalkGad1,a0
		move.w	gg_Flags(a0),d0
		move.w	#$00,Talk
		and.w	#SELECTED,d0
		cmp.w	#SELECTED,d0
		bne	Set2Prefs1
		move.w	#$01,Talk

Set2Prefs1:	move.l	TalkGad2,a0
		move.w	gg_Flags(a0),d0
		move.w	#$00,TalkSys
		and.w	#SELECTED,d0
		cmp.w	#SELECTED,d0
		bne	Set2Prefs2
		move.w	#$01,TalkSys

Set2Prefs2:	move.l	TalkGad3,a0
		move.w	gg_Flags(a0),d0
		move.w	#$00,TalkDes
		and.w	#SELECTED,d0
		cmp.w	#SELECTED,d0
		bne	Set2Prefs3
		move.w	#$01,TalkDes

Set2Prefs3:	move.l	TalkGad4,a0
		move.w	gg_Flags(a0),d0
		move.w	#$00,TalkQue
		and.w	#SELECTED,d0
		cmp.w	#SELECTED,d0
		bne	Set2Prefs4
		move.w	#$01,TalkQue

Set2Prefs4:	move.l	TalkGad5,a0
		move.w	gg_Flags(a0),d0
		move.w	#$00,TalkAns
		and.w	#SELECTED,d0
		cmp.w	#SELECTED,d0
		bne	Set2Prefs5
		move.w	#$01,TalkAns

Set2Prefs5:	move.l	TalkGad6,a0
		move.w	gg_Flags(a0),d0
		move.w	#$00,TalkScore
		and.w	#SELECTED,d0
		cmp.w	#SELECTED,d0
		bne	Set2Prefs6
		move.w	#$01,TalkScore

Set2Prefs6:	;move.l	TalkGad7,a0
		;move.w	gg_Flags(a0),d0
		;move.w	#$00,TalkTimer
		;and.w	#SELECTED,d0
		;cmp.w	#SELECTED,d0
		;bne	Set2Prefs7
		;move.w	#$01,TalkTimer

Set2Prefs7:	;move.l	TalkGad8,a0
		;move.w	gg_Flags(a0),d0
		;move.w	#$00,TalkHelp
		;and.w	#SELECTED,d0
		;cmp.w	#SELECTED,d0
		;bne	Set2Prefs8
		;move.w	#$01,TalkHelp

Set2Prefs8:	move.l	IHandlerGad1,a0
		move.w	gg_Flags(a0),d0
		move.w	#$00,IHandler
		and.w	#SELECTED,d0
		cmp.w	#SELECTED,d0
		bne	Set2Prefs9
		move.w	#$01,IHandler

Set2Prefs9:	jmp	SetPrefs9		;Refresh etc..

P1CheckFile:	move.l	PrefsFile,d1
		move.l	#0,d2
		move.l	#-1,d3
		lib	Dos,Seek
		move.l	PrefsFile,d1
		lea.l	PrefsBuf,a0
		move.l	a0,d2
		move.l	#$04,d3
		flib	Dos,Read
		tst.l	d0
		bne	P1CheckFile1
		jsr	FileError
		move.l	#0,d0
		rts
P1CheckFile1:	move.l	PrefsBuf,d0
		cmp.l	#"QUEP",d0
		bne	P1CheckFile2
		move.l	#-1,d0
		rts
P1CheckFile2:	move.l	PrefsWin1,a0
		lea.l	WrongTxt1,a1
		move.l	#$00,a2		;positive text
		lea.l	OKTxt,a3	;a bit the wrong way around but...
		move.l	#$00,d0
		move.l	#$00,d1
		move.l	#$90,d2
		move.l	#$40,d3
		lib	Intuition,AutoRequest
		rts
P1CheckFile3:	;jsr	NoQues
		rts

P1MenusOff:	move.l	PrefsWin1,a0
		lib	Intuition,ClearMenuStrip
		rts

P1MenusOn:	move.l	PrefsWin1,a0
		move.l	mlist2,a1
		lib	Intuition,SetMenuStrip
		rts

P1SleepPointer:	move.l	PrefsWin1,a0
		lea.l	ClockPointer1,a1
		move.l	#16,d0
		move.l	#16,d1
		move.l	#-6,d2
		move.l	#0,d3
		lib	Intuition,SetPointer
		rts

P1NormalPointer	move.l	PrefsWin1,a0
		lib	Intuition,ClearPointer
		rts

FileRequester:	move.l	a5,FRTitle
		or.l	d5,FRFlags
		lea.l	FileRequest2,a0
		lib	Req,FileRequester
		rts

;Pointers etc.

;GadTools stuff

mlist2:		dc.l	0
GadMagic2:	dc.b	0		;using new gadgets? (0=No, 1=Yes)
MenuMagic2:	dc.b	0		;using new menus? (0=No, 1=Yes)
ContextGad2:	dc.l	0

TalkGad1:	dc.l	0
TalkGad2:	dc.l	0
TalkGad3:	dc.l	0
TalkGad4:	dc.l	0
TalkGad5:	dc.l	0
TalkGad6:	dc.l	0
TalkGad7:	dc.l	0
TalkGad8:	dc.l	0
SpeakGad1:	dc.l	0
SpeakGadBuf:	dc.l	0		;Only a pointer!
SpeakGad2:	dc.l	0
SpeakGadBuf2:	dc.l	0		;Only a pointer!
IHandlerGad1:	dc.l	0

;Display stuff

PrefsWin1	dc.l	0		;Main preferences window

;File Stuff

PrefsFile:	dc.l	0
SpeakFile:	dc.l	0
SpeakFile2:	dc.l	0

;Texts part I

P1LoadName:	dc.b	"Load preferences",0
P1SaveName:	dc.b	"Save preferences as",0
NoSPEAKText2:	dc.b	"Couldn't open requested SPEAK: 'file'!",0
NoSPEAKText3:	dc.b	"The default SPEAK: 'file' will not open. No speaking available.",0
		ds.l	0

;Window TagLists

PrefsWinTagList: dc.l	WA_AutoAdjust,0
		dc.l	WA_InnerWidth,600
		dc.l	WA_InnerHeight,150
		dc.l	TAG_DONE,0

;New window structures

NewPrefsWin1	dc.w	20,50			;X,Y POS
		dc.w	600			;WIDTH
		dc.w	150			;HEIGHT
		dc.b	0,1			;PENS
		dc.l	GADGETUP+VANILLAKEY+RAWKEY+MENUPICK+ACTIVEWINDOW+CLOSEWINDOW
		dc.l	ACTIVATE+WINDOWCLOSE+WINDOWDRAG
		dc.l	0,0			;GADGETS, CHECKMARK
		dc.l	QName			;TITLE
SToW5		dc.l	0			;SCREEN ADDRESS
		dc.l	0			;BITMAP			
		dc.w	400,150,400,150		;MINIMUM SIZE
		dc.w	CUSTOMSCREEN		;TYPE

;Gadget TagLists

SpeakGadTagList	dc.l	GTST_String,SpeakName
		dc.l	GTST_MaxChars,126
		dc.l	TAG_DONE,0

SpeakGadTagList2 dc.l	GTST_String,SpeakName2
		dc.l	GTST_MaxChars,126
		dc.l	TAG_DONE,0

TalkGadTagList1	dc.l	GTTX_Text,TalkGadText0
		dc.l	TAG_DONE,0

GadTagList:	dc.l	GT_Underscore,'_'
		dc.l	TAG_DONE,0

;Gadget texts, part I

TalkGadText0:	dc.b	"Speech:",0
MiscGadText0:	dc.b	"Options:",0
StringGadText0:	dc.b	"Misc:",0
TalkGadText1:	dc.b	"On/Off",0
ColorGadText1:	dc.b	"Set _colors",0
DefsGadText1:	dc.b	"_Defaults",0
SaveGadText1:	dc.b	"_Save",0
UseGadText1:	dc.b	"_"
UseMenuText1:	dc.b	"Use",0
QuitGadText1:	dc.b	"_Quit",0

TalkGadText2:	dc.b	"System messages",0
TalkGadText3:	dc.b	"Descriptions",0
TalkGadText4:	dc.b	"Questions",0
TalkGadText5:	dc.b	"Answers",0
TalkGadText6:	dc.b	"Score",0
TalkGadText7:	dc.b	"Timer",0
TalkGadText8:	dc.b	"Help",0
SpeakGadText1:	dc.b	"Speech 'file' 1:",0
SpeakGadText2:	dc.b	"Speech 'file' 2:",0
IHandGadText1:	dc.b	"Input-Handler",0
		ds.l	0

;New gadget structures

NGTalkGad0:	dc.w	5		;gng_LeftEdge
		dc.w	PrefTop-13	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	9		;gng_Height
		dc.l	TalkGadText0	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGTalkGad1:	dc.w	13		;gng_LeftEdge
		dc.w	PrefTop		;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	TalkGadText1	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGTalkGad2:	dc.w	13		;gng_LeftEdge
		dc.w	PrefTop+13	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	TalkGadText2	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGTalkGad3:	dc.w	13		;gng_LeftEdge
		dc.w	PrefTop+26	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	TalkGadText3	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGTalkGad4:	dc.w	13		;gng_LeftEdge
		dc.w	PrefTop+39	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	TalkGadText4	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGTalkGad5:	dc.w	13		;gng_LeftEdge
		dc.w	PrefTop+52	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	TalkGadText5	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGTalkGad6:	dc.w	13		;gng_LeftEdge
		dc.w	PrefTop+65	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	TalkGadText6	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGTalkGad7:	dc.w	13		;gng_LeftEdge
		dc.w	PrefTop+78	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	TalkGadText7	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGTalkGad8:	dc.w	13		;gng_LeftEdge
		dc.w	PrefTop+91	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	TalkGadText8	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGStringGad0:	dc.w	-262		;gng_LeftEdge
		dc.w	PrefTop-13	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	9		;gng_Height
		dc.l	StringGadText0	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGSpeakGad1:	dc.w	-254		;gng_LeftEdge
		dc.w	PrefTop		;gng_TopEdge
		dc.w	128		;gng_Width
		dc.w	12		;gng_Height
		dc.l	SpeakGadText1	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_BELOW	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGSpeakGad2:	dc.w	-254		;gng_LeftEdge
		dc.w	PrefTop+26	;gng_TopEdge
		dc.w	128		;gng_Width
		dc.w	12		;gng_Height
		dc.l	SpeakGadText2	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_BELOW	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGMiscGad0:	dc.w	182		;gng_LeftEdge
		dc.w	PrefTop-13	;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	9		;gng_Height
		dc.l	MiscGadText0	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGIHandlerGad1:	dc.w	190		;gng_LeftEdge
		dc.w	PrefTop		;gng_TopEdge
		dc.w	0		;gng_Width
		dc.w	12		;gng_Height
		dc.l	IHandGadText1	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	0		;gng_GadgetID
		dc.l	PLACETEXT_RIGHT	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGColorGad:	dc.w	-113		;gng_LeftEdge
		dc.w	-51		;gng_TopEdge
		dc.w	100		;gng_Width
		dc.w	12		;gng_Height
		dc.l	ColorGadText1	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	60		;gng_GadgetID
		dc.l	PLACETEXT_IN	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGDefaultsGad:	dc.w	-113		;gng_LeftEdge
		dc.w	-35		;gng_TopEdge
		dc.w	100		;gng_Width
		dc.w	12		;gng_Height
		dc.l	DefsGadText1	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	70		;gng_GadgetID
		dc.l	PLACETEXT_IN	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGSaveGad:	dc.w	13		;gng_LeftEdge
		dc.w	-15		;gng_TopEdge
		dc.w	100		;gng_Width
		dc.w	12		;gng_Height
		dc.l	SaveGadText1	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	80		;gng_GadgetID
		dc.l	PLACETEXT_IN	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGUseGad:	dc.w	250		;gng_LeftEdge
		dc.w	-15		;gng_TopEdge
		dc.w	100		;gng_Width
		dc.w	12		;gng_Height
		dc.l	UseGadText1	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	98		;gng_GadgetID
		dc.l	PLACETEXT_IN	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

NGQuitGad:	dc.w	-113		;gng_LeftEdge
		dc.w	-15		;gng_TopEdge
		dc.w	100		;gng_Width
		dc.w	12		;gng_Height
		dc.l	QuitGadText1	;gng_GadgetText
		dc.l	Topaz		;gng_TextAttr
		dc.w	99		;gng_GadgetID
		dc.l	PLACETEXT_IN	;gng_Flags
		dc.l	0		;gng_VisualInfo
		dc.l	0		;gng_UserData

glist2:		dc.l	0		;Next Gadget
		dc.w	0		;"hit-box" left edge
		dc.w	0		;"hit-box" top  edge
		dc.w	0		;"hit-box" Width
		dc.w	0		;"hit-box" Height
		dc.w	0		;flags
		dc.w	0		;activation
		dc.w	0		;gadget type
		dc.l	0		;gadget rendering
		dc.l	0		;select rendering
		dc.l	0		;gadget text
		dc.l	0		;mutual exclude
		dc.l	0		;special info
		dc.w	0		;gadget ID (user definable)
		dc.l	0		;ptr to general purpose user data

;Menu TagLists

P1MenuTagList:	dc.l	GTMN_TextAttr,Topaz
		dc.l	GTMN_Menu,MNP1PrefsMenu1
		dc.l	TAG_DONE,0

;Menu texts and Command Keys

P1Menu1Name:	dc.b	"Preferences",0
P1Menu2Name:	dc.b	"Edit",0
P1ColorText:	dc.b	"Colors",0
ColorCommKey:	dc.b	"C",0
P1GetDefCommKey	dc.b	"D",0
UseCommKey:	dc.b	"U",0
PrefsSaveAsText	dc.b	"Save prefs as...",0
		ds.l	0

;New menu structures

MNP1PrefsMenu1:	dc.b	NM_TITLE		;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	P1Menu1Name		;gnm_Label
		dc.l	0			;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1Load1:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	PrefsM2Text		;gnm_Label
		dc.l	LoadCommKey		;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1Save1:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	PrefsM3Text		;gnm_Label
		dc.l	SaveCommKey		;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1SaveAs1:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	PrefsSaveAsText		;gnm_Label
		dc.l	SaveAsCommKey		;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1SepMenu1:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	NM_BARLABEL		;gnm_Label
		dc.l	0			;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1GetDef1:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	PrefsM4Text		;gnm_Label
		dc.l	P1GetDefCommKey		;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1SepMenu2:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	NM_BARLABEL		;gnm_Label
		dc.l	0			;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1Use1:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	UseMenuText1		;gnm_Label
		dc.l	UseCommKey		;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1Quit1:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	QuitMenu1I2Text		;gnm_Label
		dc.l	QuitCommKey		;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1PrefsMenu2:	dc.b	NM_TITLE		;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	P1Menu2Name		;gnm_Label
		dc.l	0			;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

MNP1Color1:	dc.b	NM_ITEM			;gnm_Type
		dc.b	0			;gnm_Pad
		dc.l	P1ColorText		;gnm_Label
		dc.l	ColorCommKey		;gnm_CommKey
		dc.w	0			;gnm_Flags
		dc.l	0			;gnm_MutualExclude
		dc.l	0			;gnm_UserData

		dc.w	0			;NM_END?

WrongTxt1:	dc.b	3,1			;PENS
		dc.w	4			;MODE
		dc.w	10,10			;LEFT+TOPEDGE
		dc.l	Topaz			;FONT
		dc.l	FWrongText1		;TEXT
		dc.l	0			;NEXTTEXT

FWrongText1:	dc.b	"Not a Questions prefs file!",0
		ds.l	0

		INCLUDE	"FH1:Language/WF/Questions/QueDefPref.i"

PrefsSize:	EQU	PREFS_END-PREFS_START

;Current preferences

CurrentPrefs:	dc.b	"QUEP"			;So we can save easily
Colors:		dc.w	$aaa			;Hope I don't need more colors
		dc.w	$000
		dc.w	$fff
		dc.w	$68b
Talk:		dc.w	0			;Talk? (0=No, 1=Yes)
TalkSys:	dc.w	1			;Say system messages
TalkDes:	dc.w	1			;Say descriptions
TalkQue:	dc.w	0			;Say question
TalkAns:	dc.w	0			;Say answers
TalkScore:	dc.w	0			;Say correct answer(s)
TalkTimer:	dc.w	0			;Say correct timer(s)
TalkHelp:	dc.w	0			;Say correct help(s)
IHandler:	dc.w	0			;Use Input-Handler (0=No, 1=Yes)
SpeakName:	dc.b	"SPEAK:"		;Speak-file name
		dcb.b	128-6,0
SpeakName2:	dc.b	"SPEAK2:"		;Speak-file name
		dcb.b	128-7,0
		dc.l	0,0

;Preferences in buffer

PrefsBuf:	dc.b	"QUEP"			;So we can save easily
ColorsBuf:	dc.w	$aaa			;Hope I don't need more colors
		dc.w	$000
		dc.w	$fff
		dc.w	$68b
TalkBuf:	dc.w	0			;Talk? (0=No, 1=Yes)
TalkSysBuf:	dc.w	1			;Say system messages
TalkDesBuf:	dc.w	1			;Say descriptions
TalkQueBuf:	dc.w	0			;Say questions
TalkAnsBuf:	dc.w	0			;Say answers
TalkScoreBuf:	dc.w	0			;Say correct answer(s)
TalkTimerBuf:	dc.w	0			;Say correct timer(s)
TalkHelpBuf:	dc.w	0			;Say correct help(s)
IHandlerBuf:	dc.w	0			;Use Input-Handler (0=No, 1=Yes)
SpeakNameBuf:	dc.b	"SPEAK:"		;Speak-file name
		dcb.b	128-6,0
SpeakNameBuf2:	dc.b	"SPEAK2:"		;Speak-file name
		dcb.b	128-7,0
		dc.l	0,0			;Just in case

		INCLUDE	"FH1:Language/WF/Questions/QuePrefsReq.i"

		END

