' *********************************************************************
'      CfgIO_Example2.bas by/de Dámaso D. Estévez {este, son, eu}
'          AmiSpaTra - http://www.xente.mundo-r.com/amispatra/
'                             ------------
'            All rights reserved over this derivative work:
'                 my Hisoft Basic developpers package.
'       Forbidden to remove ALL legal/copyrights remarks included
'            in this package: if you create a derivate work,
'                 you MUST to include all legal notes.
'
'             Reading the previous config file created with
'             CfgIO_Example1.bas and showing the info saved.
'                             ------------
'           Leyendo un fichero de configuración preexistente
'  creado con CfgIO_Example1.bas y mostrando la información guardada.
'
'      Todos los derechos reservados sobre este trabajo derivado:
'    mi paquete para desarrolladores que programen con Hisoft Basic.
'          Está prohibido eliminar cualquier comentario o nota
'     de autoría/legal de este paquete: si crea un trabajo derivado
'        HA DE INCLUIR OBLIGATORIAMENTE TODAS LAS NOTAS LEGALES.
' *********************************************************************

' ---------------------------------------------------------------------
'                Include files / Ficheros de inclusión
' ---------------------------------------------------------------------

'         OS / SO
' ------------------------
REM $include exec.bh
REM $include dos.bh

' ConfigIO
' --------
REM $include configio.bh

' ---------------------------------------------------------------------
'    From/De:  http://aminet.net/package/dev/basic/AST_HBRoutines
' ---------------------------------------------------------------------
REM $include BLib_AST/StrTo.bas

' ---------------------------------------------------------------------
'                 C= string version / Cadena de versión de C=
' ---------------------------------------------------------------------
v$ = "$VER: CfgIO_Example2.bas 1.11 (01.03.2013) by Dámaso 'AmiSpaTra' Domínguez "+CHR$(0)

' ---------------------------------------------------------------------
'                  Main program / Programa principal
' ---------------------------------------------------------------------

LIBRARY OPEN "dos.library"
LIBRARY OPEN "configio.library", ConfigIOVersion&

'         For the functions' results
'    Para los resultados de las funciones
' -------------------------------------------
res& = NULL&

'   Application's name
' Nombre de mi aplicación
' -----------------------
a$ = "CfgIOExample_MyFakeApp"

'      Config file name and their path
' Nombre y ruta del fichero de configuración
' ------------------------------------------
f$ = "ENV:"+a$+".cfg"

'    Exit code: Initial hypothesis
' Código de salida: Hipótesis inicial
' -----------------------------------
e& = RETURN_OK&

PRINT "Reading & printing config file / Leyendo e imprimiendo el fichero de configuración..."

cfg& = CfgIO_NewConfig&(SADD(Str2C$(a$)),SADD(Str2C$("$VER: "+a$+" 2.0 (01/03/2013) © AmiSpaTra")))

IF cfg& THEN

	res& = CfgIO_ReadConfig&(cfg&, SADD(Str2C$(f$)))

	IF res& THEN

		'    These items and sections would be exists: See the CfgIO_Example1.bas file
		' Estos ítems y secciones deberían existir: Consulte el fichero CfgIO_Example1.bas
		' --------------------------------------------------------------------------------
		PRINT "Section/Sección 'Work'"
		PRINT "> MaxTimes:";CfgIO_ReadSignedInteger&(			cfg&, SADD(Str2C$("Work")),		SADD(Str2C$("Delta")),		32%)
		PRINT "> TempFile: ";CHR$(34);PEEK$(CfgIO_ReadString&(	cfg&, SADD(Str2C$("Work")),		SADD(Str2C$("TempFile")),	SADD(Str2C$("TempFile.raw"))));CHR$(34)

		PRINT "Section/Sección 'Interface'"
		PRINT "> AslReq  :";CfgIO_ReadBool&(				cfg&, SADD(Str2C$("Interface")),	SADD(Str2C$("AslReq")),		TRUE&)
		PRINT "> ScrMode :";CfgIO_ReadUnsignedInteger&(			cfg&, SADD(Str2C$("Interface")),	SADD(Str2C$("ScreenMode")),	&H0000000A&)

		'     This item don't exists: The lib will return the default value ;)
		' Esta entrada NO existe: La biblioteca devolverá el valor por defecto ;)
		' -----------------------------------------------------------------------
		PRINT "> **Fake**: &H";HEX$(CfgIO_ReadUnsignedInteger&(	cfg&, SADD(Str2C$("Interface")),	SADD(Str2C$("Fake")),		&HFFFFAAAA&));"&"

		'      Reusing the res& var
		' Reutilizaci¢n de la variable res&
		' ---------------------------------
		res& = CfgIO_RemConfig&(cfg&)

		IF NOT res& THEN
			e& = RETURN_WARN&
		END IF

		PRINT "You can delete now the example config file / Puede borrar ya el fichero de configuración de ejemplo"
	ELSE

		e& = RETURN_FAIL&
		PRINT "I can't read the config file / No puedo leer el fichero de configuración"

	END IF

ELSE

	e& = RETURN_FAIL&

END IF

LIBRARY CLOSE

STOP e&

' ---------------------------------------------------------------------
