;Dbplayer Include - v1.2 - Scott Beardwood (c) 26/12/98
;For use with DBPlayer.Libaray V2

#DBPLAYER_VERSION = 2

#DBM_OK = 0
#DBM_ALREADY_PLAYING = 1
#DBM_NOT_ENOUGH_MEMORY = 2
#DBM_MODULE_TRUNCATED  = 3
#DBM_NOT_DBM_MODULE = 4
#DBM_AHI_ASL_ERROR = 5
#DBM_AHI_ERROR = 6

#DBB_AUTOBOOST = 0
#DBF_AUTOBOOST = (1 LSL #DBB_AUTOBOOST)

#DBM_TB  = #TAG_USER+$DB2000

#DBMATTR_InstNum  = #DBM_TB+$0100  ; number of instruments in module
#DBMATTR_PattNum  = #DBM_TB+$0200  ; number of Patterns in module
#DBMATTR_ChanNum  = #DBM_TB+$0300  ; number of channels in module
#DBMATTR_ModName  = #DBM_TB+$0400  ; Module Name
#DBMATTR_InstNames = #DBM_TB+$0500 ; Names of instruments
#DBMATTR_PlayTime = #DBM_TB+$0600  ; module duration



DEFTYPE.b *_Mod
DEFTYPE.l _ModSize

DEFTYPE.l InstrNum
DEFTYPE.l ChanNum
DEFTYPE.l PattNum
DEFTYPE.b *_ModName
DEFTYPE.l *_InstrNames


Statement DBMLoad{f$}
  SHARED Mem,FSiz
FSiz.l = FileSize(f$)
If FSiz > 0
   Mem.l = AllocMem(FSiz,65536)
   If Mem > 0
      md = ReadFile(0,f$)
      ReadMem 0,Mem,FSiz
      CloseFile 0
   Else
      NPrint "Not enough memory to load DBM"
      End
   EndIf
Else
   NPrint "Error Loading...."
   End
EndIf

End Statement

Statement ClearMem{}
  SHARED Mem,FSiz
  FreeMem Mem,FSiz
End Statement

Function .l  PlayDBM{AudioMode,AudioFrequence}
  SHARED Mem,FSiz
  x = DBM_StartModule_(Mem,FSiz,AudioMode,AudioFrequence,#DBF_AUTOBOOST)
  Function Return x
End Function

Statement StopDBM{}
  DBM_StopModule_
End Statement

Statement DBMVolume{vol}
  DBM_SetVolume_(vol)
End Statement

Statement  GTModuleAttr{}

Dim ModAttrTags.TagItem(6)

SHARED InstNum,ChanNum,PattNum,*_ModName,*_InstNames

ModAttrTags(0)\ti_Tag=#DBMATTR_InstNum,&InstrNum
ModAttrTags(1)\ti_Tag=#DBMATTR_ChanNum,&ChanNum
ModAttrTags(2)\ti_Tag=#DBMATTR_PattNum,&PattNum
ModAttrTags(3)\ti_Tag=#DBMATTR_ModName,&*_ModName
ModAttrTags(4)\ti_Tag=#DBMATTR_InstNames,&*_InstrNames
ModAttrTags(5)\ti_Tag=#TAG_END

DBM_GetModuleAttrA_(ModAttrTags(1))

End Statement

Function .l SetPosition{song,pat}
  s = DBM_SetPosition_(song,pat)
  Function Return s
End Function

Function .l WaitPosition{songpoz,patpoz}
  p = DBM_CheckPosition_(songpoz,patpoz)
  Function Return p
End Function

Function .l G7Command{}
  p = DBM_Get7Command_
  Function Return p
End Function


