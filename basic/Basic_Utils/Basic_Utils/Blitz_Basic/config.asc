WBStartup

Statement WriteConfig {Ini$,Section$,Item$,Def$}
  Ini2$="T:1"
  done.b=False
  found.b=False
  If ReadFile(1,Ini$)
    FileInput 1
    If WriteFile(2,Ini2$)
      FileOutput 2
      Repeat
        a$=Edit$(1024)
        If UCase$(a$)=UCase$("["+Section$+"]")
          found.b=True
        Else
          If ((found.b=True) AND (UCase$(Left$(a$,Len(Item$)+1))=UCase$(Item$+"=")))
            a$=Item$+"="+Def$
            done.b=True
          End If
          If ((found.b=True) AND (a$="") AND (done.b=False))
            NPrint Item$+"="+Def$
            done.b=True
          End If
          If ((found.b=True) AND (Left$(a$,1)="[")) Then found.b=False
        End If
        NPrint a$
      Until Eof(1)
      If (done.b=False)
        NPrint ""
        NPrint "["+Section$+"]"
        NPrint Item$+"="+Def$
      End If
      CloseFile 2
    End If
    CloseFile 1
    If Exists(Ini2$) Then CopyFile Ini2$, Ini$
    DefaultInput
    DefaultOutput
  Else
    If WriteFile(2,Ini$)
      FileOutput 2
      NPrint "["+Section$+"]"
      NPrint Item$+"="+Def$
      NPrint ""
      CloseFile 2
    End If
    DefaultOutput
  End If
End Statement

Function.s ReadConfig {Ini$,Section$,Item$,Def$}
  found.b=False
  ret$=Def$
  If ReadFile(1,Ini$)
    FileInput 1
    Repeat
      a$=Edit$(1024)
      If UCase$(a$)=UCase$("["+Section$+"]")
        found.b=True
      Else
        If ((found.b=True) AND (UCase$(Left$(a$,Len(Item$)+1))=UCase$(Item$+"=")))
          ret$=Mid$(a$,Len(Item$)+2)
        End If
        If ((found.b=True) AND (Left$(a$,1)="[")) Then found.b=False
      End If
    Until Eof(1)
    CloseFile 1
    DefaultInput
  End If
  Function Return ret$
End Function

Function.b ReadConfigBool {Ini$,Section$,Item$,Def$}
  If (UCase$(ReadConfig {Ini$,Section$,Item$,Def$})="TRUE")
    Function Return True
  Else
    Function Return False
  End If
End Function

Statement WriteConfigBool {Ini$,Section$,Item$,Def.b}
  If (Def.b=True)
    WriteConfig {Ini$,Section$,Item$,"TRUE"}
  Else
    WriteConfig {Ini$,Section$,Item$,"FALSE"}
  End If
End Statement

;******** Test ***************************************************************
;Use these functions and statements to create/read/modify .ini files like
;MS Windows.
;Use ***Bool to read/write boolean values (stored as TRUE or FALSE)
;Def$ is used for the new value in writing or as default in writing
;The first line creates a file containing the section [Load] with the item
;WB set to Yes.
;The second line reads the file, using No as default vaule. The result should
;be Yes.

WriteConfig{"ram:z","Load","WB","Yes"}
NPrint ReadConfig{"ram:z","Load","WB","No"}
a$=Edit$(1)

