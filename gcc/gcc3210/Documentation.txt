
gcc Version 3.2 - DSP3210 GCC C compiler

This is an implementation of the GCC C compiler for the DSP3210 as used on
the Amiga AA3000 and AA3000+.  

The host machine needs to be 32-bit x86 running linux (I use cygwin, so that 
definitely works but other linux-type OSes ought to work). Note that 32 bit 
is essential!

Copyright Wrangler 2021, 2022

Some code based on the work of Michael Collinson


Usage:
------

./xgcc -B./ -S foo.c -o foo.s

Notes:
- Do not try to use optimisation options (eg -O2) - it's not implemented yet
  and you will likely get a fatal internal compiler error - TO DO
- The compiler isn't integrated with the assembler, so you must use the -S
  option to create an assembly language file first
- Use asm3210/elf2exem68k on Aminet to assemble and link.  Version 2.2 of
  asm3210 or higher is required
- Limitation: xgcc is based on GCC3 so REQUIRES 32 bit OS (eg cygwin 32-bit on
  Windows XP in a VM is what I use).  Asm3210 is compiled for 64 bit.  One
  day, I hope to migrate xgcc to 64 bit too to avoid this faff.
- GCC will create code that will be automatically linked to specific absolute
  addresses in RAM on execution.  Do not try to relocate the code to the DSP
  internal RAM without great care! -fpic not supported.

Example
-------

The example files produce an executable to test the example C program
'code_DSP.c', which simply tests some maths functions running on the DSP, eg
division, which can't be done via a single instruction on the DSP.  In turn,
those maths functions call functions in 'libgcc1.c'.

In order to get values into and out of the DSP a wrapper program is needed,
written in DSP3210 assembly: 'wrapper_DSP.s'

On the M68k side, we have 'main_m68k.c', which just sets up some input values,
calls the DSP routines and prints out the results.

code_DSP.c and libgcc1.c compile with xgcc, and assemble with asm3210 (also
wrapper_DSP.s).
main_m68k.c compiles and assembles with vbcc
Everything is linked with vlink and then elf2exem68k to arrive at a single
executable.

How to create the executable
----------------------------

Compile code_DSP.c and libgcc1.c in a 32-bit linux:

./xgcc -B./ -S code_DSP.c -o code_DSP.s
./xgcc -B./ -S libgcc1.c  -o libgcc1.s

Copy code_DSP.s and libgcc1.s to your 64-bit location where the other files
are located and 'make' them to get 'testdsp.exe'.
Run that on your AA3000+ or AA3000 (!) to test.


Bug reports
-----------

For bug reports, message me on a1k.org

Version log:
------------

29/1/2022
Initial release

