# smakefile für ManualBrowser
# SAS C Version 6.51
# Dr. E. Küster, Krefeld
# letzte Änderung: 2.12.1994

# für gewünschte CPU anpassen, im Zweifel CPU=any wählen
# fit for built-in cpu, in doubt choose CPU=any
CPU = 68030

INCLUDE         = SASC:

DISTFILE        = ManualBrowser1_1.lha

EXEC            = ManualBrowser
CSOURCE         = main.c DynamicHost.c
SASSOURCE       = SAS_Startup.a SAS_Sprintf.a
#GCCSOURCE      = GCC_Startup.s GCC_Sprintf.s HookEntryA1.s
#OTHERSOURCE    = lmkfile Makefile Inlines.h Globals.h
DOCS            = ManualBrowser.guide ManualBrowser.readme COPYING
OTHER           = ManualBrowser.config

PGP_RELATED     = md5_DigestFile.asc md5_DigestFile t:md5_DigestFile stieber.asc

DISTFILES1      = $(CSOURCE) $(SASSOURCE) $(OTHERSOURCE)
DISTFILES2      = $(GCCSOURCE) $(DOCS) $(OTHER)

OBJS            = SAS_Startup.o SAS_Sprintf.o main.o DynamicHost.o

ASM = SC:c/asm
CC              = SC:c/sc
CFLAGS          = code=near cpu=$(CPU) define=V39 define=mc$(CPU) idir=$(INCLUDE) ign=100 \
                    mccons nostkchk optsize opt parms=register stringmerge
#CFLAGS         = -v -ms -cstfqm -r1r -dV39 -dmc$(CPU) -O
LINK = SC:c/SLink

.a.o:
  $(ASM) $*

.c.o:
  $(CC) $(CFLAGS) $*

all: $(EXEC)

ManualBrowser: $(OBJS)
  $(LINK) FROM $(OBJS) TO ManualBrowser LIB LIB:sc.lib LIB:amiga.lib SC SD

main.o:         main.c Globals.h
DynamicHost.o:  DynamicHost.c Globals.h
SAS_Startup.o:  SAS_Startup.a
SAS_Sprintf.o:  SAS_Sprintf.a

COPYING: man:GNU/COPYING
         copy man:GNU/COPYING ""

stieber.asc:
        pgp -kxa stieber stieber

md5_DigestFile.asc: $(EXEC) $(DISTFILES1) $(DISTFILES2) stieber.asc
        @echo >t:md5_DigestFile "^^^ Anything above this line has been hacked! ^^^"
        @md5sum >>t:md5_DigestFile -b $(EXEC)
        @md5sum >>t:md5_DigestFile $(DISTFILES1)
        @md5sum >>t:md5_DigestFile $(DISTFILES2)
        @join t:md5_DigestFile stieber.asc TO md5_DigestFile
        pgp <>CON:0/16/640/150/PGP -sat +clearsig=on md5_DigestFile
        @Delete t:md5_DigestFile md5_DigestFile

clean:
  @-Delete $(OBJS) $(EXEC) $(DISTFILE) $(PGP_RELATED) COPYING

dist: $(DISTFILE)

$(DISTFILE): md5_DigestFile.asc
        @-Delete $(DISTFILE)
        lha -aAFv0 a $(DISTFILE) <@<
          $(EXEC)
          $(DISTFILES1)
          $(DISTFILES2)
          md5_DigestFile.asc
        <
