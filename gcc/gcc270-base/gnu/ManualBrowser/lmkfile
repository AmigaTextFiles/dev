# Makefile, for SAS/C V5.10b

DISTFILE	= ManBrowser1_1.lha	# Aminet has filename restrictions

EXEC		= ManualBrowser
CSOURCE		= main.c DynamicHost.c
SASSOURCE	= SAS_Startup.a SAS_Sprintf.a
GCCSOURCE	= GCC_Startup.s GCC_Sprintf.s HookEntryA1.s
OTHERSOURCE	= lmkfile Makefile Inlines.h Globals.h smakefile
DOCS		= ManualBrowser.guide ManualBrowser.readme COPYING
OTHER		= ManualBrowser.config

PGP_RELATED	= md5_DigestFile.asc md5_DigestFile t:md5_DigestFile stieber.asc

DISTFILES1	= $(CSOURCE) $(SASSOURCE) $(OTHERSOURCE)
DISTFILES2	= $(GCCSOURCE) $(DOCS) $(OTHER)

OBJS		= SAS_Startup.o SAS_Sprintf.o main.o DynamicHost.o

CC		= lc
CFLAGS		= -v -ms -cstfqm -r1r -dV39 -dmc68000 -O

.a.o:
	asm $*

.c.o:
	$(CC) $(CFLAGS) $*

all: $(EXEC)

ManualBrowser: $(OBJS)
	blink FROM $(OBJS) TO ManualBrowser LIB LIB:lcr.lib LIB:amiga.lib SC SD

main.o:		main.c Globals.h
DynamicHost.o:	DynamicHost.c Globals.h
SAS_Startup.o:	SAS_Startup.a
SAS_Sprintf.o:	SAS_Sprintf.a

COPYING: man:GNU/COPYING
	copy man:GNU/COPYING ""

stieber.asc:
	pgp -kxa stieber stieber

md5_DigestFile.asc: $(EXEC) $(DISTFILES1) $(DISTFILES2) stieber.asc
	@echo >t:md5_DigestFile "^^^ Anything above this line has been hacked! ^^^"
	@md5sum >>t:md5_DigestFile -b $(EXEC)
	@md5sum >>t:md5_DigestFile $(DISTFILES1)
	@md5sum >>t:md5_DigestFile $(DISTFILES2)
	@join t:md5_DigestFile stieber.asc TO md5_DigestFile
	pgp <>KCON:0/16/640/150/PGP -sat +clearsig=on md5_DigestFile
	@Delete t:md5_DigestFile md5_DigestFile

clean:
	@-Delete $(OBJS) $(EXEC) $(DISTFILE) $(PGP_RELATED) COPYING

dist: $(DISTFILE)

$(DISTFILE): md5_DigestFile.asc
	@-Delete $(DISTFILE)
	lha -aAFv0 a $(DISTFILE) <@<
		$(EXEC)
		$(DISTFILES1)
		$(DISTFILES2)
		md5_DigestFile.asc
	<
