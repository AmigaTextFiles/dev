
      Oct 27 1997

      I have not done anything with PCQ for over two months, I just
      haven't got any time left for it. So I will release what I have
      done so far, there is some nice new stuff for PCQ.

      The compiler is still 1.2d.

      So what's missing in this archive?
      No phxass, phxlnk or dlink, if you don't have those pick them
      up on Aminet. A68k is replaced with A68kN. There is only a
      few demos in this release and if you need more examples you
      can get the old archives on Aminet.


      This will just be a short document over the major changes to
      PCQ.

      Changes to pcq.lib and includes:

      Got a mail from Thomas Richter, he informed me that there was
      some problems with the new pcq.lib. It contained double
      symbols from some external libraries. That was illegal and
      Slink reported that as failure.

      He also informed me that ModifyIDCMP in intuition.i was
      declared as a procedure, it should be a function returning
      a boolean (checked and he was right). ModifyIDCMP is now
      a boolean function.

      Screens.i, included intuition.i at the end of the file. This
      will cause a cyclic dependence of the include files
      InputEvent.i, Screens.i and Intuition.i which can't be
      resolved by the compiler properly. You have to include
      intuition.i by youtself. Fixed.

      Region.i does not define needed functions for region handling.
      Functions missing was:
      NewRegion
      OrRectRegion
      OrRegionRegion
      AndRectRegion
      AndRegionRegion
      ClearRectRegion
      ClearRegion
      DisposeRegion
      XorRectRegion
      XorRegionRegion, fixed.

      Thanks Thomas.

      I have made new glueroutines for all system libraries. I have also
      changed the startup code, it's now 2.0+.
      All programs will open exec, dos, intuition and utility at start.
      If not it will fail.

      There are also new memoryfunctions in the startupcode. When you
      start a program done with the new PCQ it will check which kick-
      start it is running on. If it's 39 it will use memorypools for
      allocation of memory, if not it will use the old AllocRemember.

      Removed some obselete functions from the lib.
      toupper, tolower, strieq, strnieq, strcmp and strnicmp.
      There are new versions of the above functions which use utility
      instead.
      The IFF stuff is also removed.

      Also removed the functions in the BuildMenu stuff.
      DisposeMenu
      InitializeMenu
      NewMenu
      NewItem
      NewSubItem
      DetachMenu
      AttachMenu

      By request is the header for BuildMenu back in Utils, but if you
      want to use BildMenu you have to link with BuildMenu.lib.
      BuildMenu.lib is in lib.

      Intuition/Intuition.i:
      Define for ScrollWindowRaster was missing, fixed.

      Graphics/Clip.i:
      Changed the function CopySBit to CopySBitMap.

      Graphics/Layers.i:
      Declaration for some functions was missing.
      MoveSizeLayer
      CreateUpfrontHookLayer
      CreateBehindHookLayer
      InstallLayerHook
      I also changed SortLayer to SortLayerCR, and as some of the new
      functions have BitMapPtr as param Layers.i will include
      Graphics/Gfx.i as well.

      Graphic/View.i:
      Changed CalclIVG to CalcIVG.

      Workbench/Workbench.i:
      Changed AddAppMenuItem to AddAppMenuItemA.

      Include:PCQUtils
      This directory has the defines for a lot of new functions I
      have made for PCQ. There are some documentation in this
      headers so check them out.


      Varargs functions:
      This is the one I like best in the new PCQ.
      Now you can use the systems varargs functions just like any
      c compiler.

      Like this:

      w := OpenWindowTags(NIL,
                 WA_Flags,     WFLG_DEPTHGADGET + WFLG_DRAGBAR +
                               WFLG_CLOSEGADGET + WFLG_SIZEGADGET + WFLG_ACTIVATE,
                 WA_IDCMP,     IDCMP_CLOSEWINDOW,
                 WA_Width,     MINWINDOWWIDTH,
                 WA_Height,    MINWINDOWHEIGHT,
                 WA_MinWidth,  MINWINDOWWIDTH,
                 WA_MinHeight, MINWINDOWHEIGHT,
                 WA_MaxWidth,  100,
                 WA_MaxWidth,  100,
                 TAG_END);

      Here is a list of the varargs functions in pcq.lib

      (*  standard os libs  *)

      (*  standard calls             varargs calls  *)

      (*  amigaguide  *)
      "OpenAmigaGuideA"           , "OpenAmigaGuide",
      "OpenAmigaGuideAsyncA"      , "OpenAmigaGuideAsync",
      "SetAmigaGuideContextA"     , "SetAmigaGuideContext",
      "SendAmigaGuideContextA"    , "SendAmigaGuideContext",
      "SendAmigaGuideCmdA"        , "SendAmigaGuideCmd",
      "SetAmigaGuideAttrsA"       , "SetAmigaGuideAttrs",
      "AddAmigaGuideHostA"        , "AddAmigaGuideHost",
      "RemoveAmigaGuideHostA"     , "RemoveAmigaGuideHost",

      (*  asl  *)
      "AllocAslRequest"       , "AllocAslRequestTags",
      "AslRequest"            , "AslRequestTags",

      (*  bullet  *)
      "ObtainInfoA"           , "ObtainInfo",
      "ReleaseInfoA"          , "ReleaseInfo",
      "SetInfoA"              , "SetInfo",

      (*  datatypes  *)
      "ObtainDataTypeA"       , "ObtainDataType",
      "NewDTObjectA"          , "NewDTObject",
      "SetDTAttrsA"           , "SetDTAttrs",
      "GetDTAttrsA"           , "GetDTAttrs",
      "RefreshDTObjectA"      , "RefreshDTObjects",
      "DoDTMethodA"           , "DoDTMethod",
      "PrintDTObjectA"        , "PrintDTObject",

      (*  dos  *)
      "AllocDosObjectTagList"     , "AllocDosObjectTags",
      "VFWritef"                  , "FWritef",
      "VFPrintf"                  , "FPrintf",
      "CreateNewProcTagList"      , "CreateNewProcTags",
      "SystemTagList"             , "SystemTags",
      "NewLoadSegTagList"         , "NewLoadSegTags",
      "VPrintf"                   , "Printf",

      (*  gadtools  *)
      "CreateGadgetA"         , "CreateGadget",
      "CreateMenusA"          , "CreateMenus",
      "DrawBevelBoxA"         , "DrawBevelBox",
      "GetVisualInfoA"        , "GetVisualInfo",
      "GT_GetGadgetAttrsA"    , "GT_GetGadgetAttrs",
      "GT_SetGadgetAttrsA"    , "GT_SetGadgetAttrs",
      "LayoutMenuItemsA"      , "LayoutMenuItems",
      "LayoutMenusA"          , "LayoutMenus",

      (*  graphics  *)
      "VideoControl"          , "VideoControlTags",
      "WeighTAMatch"          , "WeighTAMatchTags",
      "ExtendFont"            , "ExtendFontTags",
      "AllocSpriteDataA"      , "AllocSpriteData",
      "ChangeExtSpriteA"      , "ChangeExtSprite",
      "BestModeIDA"           , "BestModeID",
      "GetExtSpriteA"         , "GetExtSprite",
      "GetRPAttrsA"           , "GetRPAttrs",
      "ObtainBestPenA"        , "ObtainBestPen",
      "SetRPAttrsA"           , "SetRPAttrs",

      (*  intuition  *)
      "BuildEasyRequestArgs"  , "BuildEasyRequest",
      "EasyRequestArgs"       , "EasyRequest",
      "NewObjectA"            , "NewObject",
      "OpenScreenTagList"     , "OpenScreenTags",
      "OpenWindowTagList"     , "OpenWindowTags",
      "SetAttrsA"             , "SetAttrs",
      "SetGadgetAttrsA"       , "SetGadgetAttrs",
      "DoGadgetMethodA"       , "DoGadgetMethod",
      "SetWindowPointerA"     , "SetWindowPointer",

      (*  locale  *)
      "OpenCatalogA"          , "OpenCatalog",

      (*  lowlevel  *)
      "SystemControlA"        , "SystemControl",
      "SetJoyPortAttrsA"      , "SetJoyPortAttrs",

      (*  realtime  *)
      "CreatePlayerA"         , "CreatePlayer",
      "SetPlayerAttrsA"       , "SetPlayerAttrs",
      "GetPlayerAttrsA"       , "GetPlayerAttrs",

      (*  utility  *)
      "AllocNamedObjectA"     , "AllocNamedObject",

      (*  wb  *)
      "AddAppWindowA"         , "AddAppWindow",
      "AddAppIconA"           , "AddAppIcon",
      "AddAppMenuItemA"       , "AddAppMenuItem",


      (*  non-standard libs  *)

      (*  reqtools  *)
      "rtAllocRequestA"       , "rtAllocRequest",
      "rtChangeReqAttrA"      , "rtChangeReqAttr",
      "rtFileRequestA"        , "rtFileRequest",
      "rtEZRequestA"          , "rtEZRequest",
      "rtGetStringA"          , "rtGetString",
      "rtGetLongA"            , "rtGetLong",
      "rtFontRequestA"        , "rtFontRequest",
      "rtPaletteRequestA"     , "rtPaletteRequest",
      "rtReqHandlerA"         , "rtReqHandler",
      "rtScreenModeRequestA"  , "rtScreenModeRequest",

      Now you are wondering how you can make your own
      varargs functions.

      This is how, I will use OpenWindowTagList as an example.
      There are two ways to use varargs for a function, first
      you can use TAGS (it's defined in PCQUtils/Utils.i).

      w := OpenWindowTagList(NIL,TAGS(
                 WA_Flags,     WFLG_DEPTHGADGET + WFLG_DRAGBAR +
                               WFLG_CLOSEGADGET + WFLG_SIZEGADGET + WFLG_ACTIVATE,
                 WA_IDCMP,     IDCMP_CLOSEWINDOW,
                 WA_Width,     MINWINDOWWIDTH,
                 WA_Height,    MINWINDOWHEIGHT,
                 WA_MinWidth,  MINWINDOWWIDTH,
                 WA_MinHeight, MINWINDOWHEIGHT,
                 WA_MaxWidth,  100,
                 WA_MaxWidth,  100,
                 TAG_END));

      Using TAGS you can just use your old libraries as before
      without writing any new functions.

      Here is how OpenWindowTags is made.
      ----------------------------------
      EXTERNAL;

      {$I "Include:Intuition/Intuition.i"}

      {$C+}
      FUNCTION OpenWindowTags(ns : NewWindowPtr; ...): WindowPtr;
      VAR
         Arg : ADDRESS;
      BEGIN
         VA_Start(Arg);
         OpenWindowTags := OpenWindowTagList(ns, Arg);
      END;
      {$C-}
      -----------------------------------

      You can compile it as I have and put it in a linklib or
      use it as a header.

      Now you can use it like this:
      w := OpenWindowTags(NIL,
                 WA_Flags,     WFLG_DEPTHGADGET + WFLG_DRAGBAR +
                               WFLG_CLOSEGADGET + WFLG_SIZEGADGET + WFLG_ACTIVATE,
                 WA_IDCMP,     IDCMP_CLOSEWINDOW,
                 WA_Width,     MINWINDOWWIDTH,
                 WA_Height,    MINWINDOWHEIGHT,
                 WA_MinWidth,  MINWINDOWWIDTH,
                 WA_MinHeight, MINWINDOWHEIGHT,
                 WA_MaxWidth,  100,
                 WA_MaxWidth,  100,
                 TAG_END);

      Nice eh!.
      By the way TAGS is just for taglist so don't try
      to use it for something else.

      Other linklibs:
      If you make any linklibs put the header in
      Include:Other and not in Utils. Utils is just
      for Pat's headers and PCQUtils will I use for any
      new stuff.

      I have made some changes to WWG-CRT for you to study
      how you can make linklibs which will produce smaller program.
      It's in Crtlib.

      That's all folks, well I have made some more small fixes
      in the headers, there were some bugs lurking.

      The future:
      If I get some time over this is what I have planed.
      This will also depend on the feedback I get for this
      release. If there is no user of PCQ left then there
      is no point in writing new stuff.

      make a guide for pcq, with this guide
      you have all functions and all records
      in pcq and the system just a mouseclick
      away.
      write more demos.
      math.lib, some mathfunctions.
      matrix.lib
      config.lib use configfiles like Delphi.
      more highlevel stuff.
      update triton to version 2.0
      update wizard to version 2.0
      translate MUI to PCQ
      translate GTLayout to PCQ
      perhaps write functions to layout
      and handle gadtools gadgets.
      change the makeutil PCQ to handle
      phxass and phxlnk.
      write a gui for the same.

      Some of the above is almost done but it
      needs more work.


      Thanks to:
      Thomas Richter who have helped me a lot with ideas and
      improvements. He wrote the new memoryhandling in the
      startup code.
      He has also made Gfx4PCQ and ClickMake (a makeutility).
      If you don't have these check them out. Nice stuff.

      Andreas Neumann who helped me find a stupid bug in pcq.lib.
      He also checked that the new programs worked without any
      enforser hits.


      Have fun.

      Report any bugs or problems to me.

      nils.sjoholm@mailbox.swipnet.se   (Nils Sjoholm)





