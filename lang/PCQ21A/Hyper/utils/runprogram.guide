@database Contents
@master PCQ:Hyper/utils/runprogram.guide
@$VER: 1.0
@author "Nils Sjoholm"
@(c) "@ Nils Sjoholm"

@node "Main" "Utils/RunProgram"




                         Utils/RunProgram

                           @{" FinishProgram   " link "finishprogram" 0}
                           @{" ProgramFinished " link "programfinished" 0}
                           @{" RunProgram      " link "runprogram" 0}
                           @{" RunProgramNW    " link "runprogramnw" 0}
                           @{" RunSegment      " link "runsegment" 0}
                           @{" RunSegmentNW    " link "runsegmentnw" 0}













@endnode

@node "finishprogram" "Utils/RunProgram/FinishProgram"

    Utils/RunProgram/FinishProgram

    NAME
        FinishProgram - wait for the program to finish and clean up

    SYNOPSIS
        PROCEDURE FinishProgram(RP : RunProgPtr);

    DESCRIPTION
        FinishProgram waits for a child process launched by
        RunProgramNW or RunSegmentNW to finish, then frees any
        resources allocated by the run routines.  It will not
        free anything it didn't allocate - for example, it will
        not unload a segment that it didn't load.

    EXAMPLE

        PROGRAM RunChild;
        {$I "Include:Utils/RunProgram.i"}
        VAR
            Child : RunProgPtr;
        BEGIN
            Child := RunProgramNW("OtherProgram", 4000);
            IF Child <> NIL THEN
                FinishProgram(Child);
        END.

    INPUTS

        RP    : A pointer to a private information block, as
                returned by RunSegmentNW or RunProgramNW.

    RESULTS
        None

    BUGS

    SEE ALSO

        @{" RunSegment      " link "runsegment" 0} @{" RunSegmentNW    " link "runsegmentnw" 0} @{" RunProgram      " link "runprogram" 0}
        @{" RunProgramNW    " link "runprogramnw" 0} @{" ProgramFinished " link "programfinished" 0}

@endnode

@node "programfinished" "Utils/RunProgram/ProgramFinished"

    Utils/RunProgram/ProgramFinished

    NAME
        ProgramFinished - check child status

    SYNOPSIS
        FUNCTION ProgramFinished(RP : RunProgPtr) : Boolean;

    DESCRIPTION
        If a child created by RunSegmentNW or RunProgramNW has
        finished, this routine deallocates all the resources
        allocated by the run routines and returns TRUE.  If not,
        it returns FALSE.

        Note that this routine will only free resources it has
        allocated - it will not, for example, unload a segment
        that it did not load.

    EXAMPLE

        PROGRAM BusySystem;
        {$I "Include:Utils/RunProgram.i"}
        VAR
            Child : RunProgPtr;
        BEGIN
            Child := RunProgramNW("OtherFile",4000);
            IF Child <> NIL THEN BEGIN
                REPEAT
                    Writeln('Otherfile is still running');
                UNTIL ProgramFinished(Child);
            END ELSE
                Writeln('Could NOT load OtherFile');
        END.

    INPUTS

        RP    : A pointer to a private information block as
                returned by RunSegmentNW or RunProgramNW.

    RESULTS
        TRUE if the child process has finished execution, in
             which case the resources allocated for the process
             will have been freed.
        FALSE if the child is still running.

    BUGS

    SEE ALSO

        @{" RunProgramNW  " link "runprogramnw" 0} @{" RunProgram    " link "runprogram" 0} @{" RunSegmentNW  " link "runsegmentnw" 0}
        @{" RunSegment    " link "runsegment" 0} @{" FinishProgram " link "finishprogram" 0}

@endnode

@node "runprogram" "Utils/RunProgram/RunProgram"

    Utils/RunProgram/RunProgram

    NAME
        RunProgram - load and run a program

    SYNOPSIS
        FUNCTION RunProgram(FileName  : String;
                            StackSize : Integer) : Boolean;

    DESCRIPTION
        RunProgram loads a program, then runs it as a seperate
        process.  The child process acts as if it were run from
        the Workbench, so any programs that can't handle that
        should not be used with this routine.

        RunProgram returns TRUE if it was able to load the
        program and successfully create a new process, and
        FALSE otherwise.  This result doesn't tell you anything
        about the program's returncode, or any other measure of
        its success - you'll have to check that some other way.

        This routine provides no way of passing command line
        parameters to the new process.  Again, you'll have to
        handle that through configuration files or some other
        means.

    EXAMPLE

        PROGRAM RunOther;
        {$I "Include:Utils/RunProgram.i"}
        {$I "Include:Utils/StringLib.i"}
        {$I "Include:Utils/Parameters.i"}
        VAR
            ChildName : String;
        BEGIN
            ChildName := AllocString(256);
            GetParam(1,ChildName);
            IF RunProgram(ChildName,4000) THEN
                Writeln('Successfully ran ', ChildName)
            ELSE
                Writeln('Could NOT run ', ChildName);
        END.

    INPUTS

        FileName  : The filename of the program to load.  It can
                    include a full path if necessary, and it will
                    also serve as the process name.
        StackSize : The number of bytes to allocate for the stack

    RESULTS
        TRUE if the program was loaded and launched successfully
        FALSE if RunProgram was not able to load the program, or
              was not able to create the new process.

    BUGS

    SEE ALSO

        @{" RunProgramNW    " link "runprogramnw" 0} @{" RunSegment      " link "runsegment" 0} @{" RunSegmentNW    " link "runsegmentnw" 0}
        @{" FinishProgram   " link "finishprogram" 0} @{" ProgramFinished " link "programfinished" 0}

@endnode

@node "runprogramnw" "Utils/RunProgram.RunProgramNW"

    Utils/RunProgram/RunProgramNW

    NAME
        RunProgramNW - load and run a file, returning immediately

    SYNOPSIS
        FUNCTION RunProgramNW(FileName  : String;
                              StackSize : Integer) : RunProgPtr;

    DESCRIPTION
        RunProgramNW loads a program file from the disk, then
        launches it as a new process.  Unlike RunProgram, this
        routine returns immediately, while the child process is
        still running.

        Programs run with this routine behave as if they were
        run from the Workbench, so AmigaDOS commands like Dir
        and Copy are out of the question.  PCQ Pascal programs
        should not have any problems.  The calling program must
        wait until the child ends before ending itself.

        This routine does not provide a method for passing
        parameters to the new program.

        If the program is loaded and run successfully, this
        routine returns a pointer to a private block of memory
        that tracks system resources allocated for the new
        process.  RunProgramNW returns Nil if the program could
        not be loaded, or if the new process could not be created.

    EXAMPLE

        PROGRAM MakeChild;
        {$I "Include:Utils/RunProgram.i"}
        {$I "Include:Utils/Parameters.i"}
        {$I "Include:Utils/StringLib.i"}
        VAR
            ChildName : String;
            Child     : RunProgPtr;
        BEGIN
            ChildName := AllocString(256);
            GetParam(1,ChildName);
            Child := RunProgramNW(ChildName, 4000);
            IF Child <> NIL THEN BEGIN
                REPEAT
                    Writeln('It is still running');
                UNTIL ProgramFinished(Child);
            END ELSE
                Writeln('Could NOT run ', ChildName);
        END.

    INPUTS

        FileName  : The file name of the program to run, which can
                    include path information as necessary.  It will
                    also be used as the process name.
        StackSize : The size in bytes of the stack to allocate.

    RESULTS
        If everything goes OK, this routine returns a pointer to
        a private information block.  If anything went wrong, it
        returns Nil.

    BUGS

    SEE ALSO

        @{" RunProgram      " link "runprogram" 0} @{" RunSegmentNW    " link "runsegmentnw" 0} @{" RunSegment      " link "runsegment" 0}
        @{" FinishProgram   " link "finishprogram" 0} @{" ProgramFinished " link "programfinished" 0}

@endnode

@node "runsegment" "Utils/RunProgram/RunSegment"

    Utils/RunProgram/RunSegment

    NAME
        RunSegment - create a process from the segment and run it

    SYNOPSIS
        FUNCTION RunSegment(ProcName  : String;
                            Segment   : Address;
                            StackSize : Integer) : Boolean;

    DESCRIPTION
        RunSegment creates a new process from the supplied Segment,
        and waits for it to finish.  The segment is run as if it
        were launched from the Workbench, so programs that can't
        handle that (e.g. AmigaDOS commands like Dir) should not
        be used with this routine.  Programs compiled by PCQ Pascal
        should not have a problem.

        If you want the parent and child processes to run at the
        same time, try RunSegmentNW instead.

    EXAMPLE

        See
           @{" Exampes/TimeProg.p " link "PCQ:Examples/TimeProg.p/main" 0}

    INPUTS

        ProcName  : The new process name, which can be anything.
        Segment   : A BPTR to the first segment of the program, as
                    returned by LoadSeg.
        StackSize : The number of bytes to allocate for the program's
                    stack.

    RESULTS
        TRUE indicates that the program run, but does not tell you
             anything about returncodes or other problems.
        FALSE indicates that the process could not be launched.

    BUGS

    SEE ALSO

        @{" RunSegmentNW    " link "runsegmentnw" 0} @{" RunProgram      " link "runprogram" 0} @{" RunProgramNW    " link "runprogramnw" 0}
        @{" FinishProgram   " link "finishprogram" 0} @{" ProgramFinished " link "programfinished" 0}

@endnode

@node "runsegmentnw" "Utils/RunProgram/RunSegmentNW"

    Utils/RunProgram/RunSegmentNW

    NAME
        RunSegmentNW - create a process from a supplied segment

    SYNOPSIS
        FUNCTION RunSegmentNW(  ProcName  : String;
                                Segment   : Address;
                                StackSize : Integer) : RunProgPtr;

    DESCRIPTION
        RunSegmentNW is one of several related routines for easily
        creating seperate processes.  In this case, it creates a
        new process if you loaded it as a segment, or otherwise
        have the segment available to you.  "NW" stands for No Wait,
        which means that after launching the new process, this
        function returns immediately.

        If it could not launch the program, it returns Nil.  That
        indicates that the program was unable to create the new
        process or allocate associated memory - it does not tell
        you anything about the new processes return code, or
        anything else about its run.  If everything went OK, this
        function will return a pointer to a private area of memory
        used to track resources allocated to run this new process.

        As with the other RunProgram routines, the program thinks
        it was run from the Workbench, so it must be able to handle
        that.  PCQ Pascal programs should not have a problem, but
        normal AmigaDOS programs like Dir or List will not work.
        Also, these routines provide no method for setting up a
        CommandLine, or passing parameters in any way.

        The parent process cannot end before the child process is
        finished running.

    EXAMPLE

        PROGRAM Twofer;
        {$I "Include:Utils/RunProgram.i"}
        {$I "Include:Libraries/DOS.i"}
        {$I "Include:Libraries/DOSExtens.i"}
        VAR
            Child : RunProgPtr;
            MySeg : BPTR;
        BEGIN
            MySeg := LoadSegment("Proc2");
            Child := RunSegmentNW("The Second Proc", MySeg, 4000);
            IF Child <> NIL THEN BEGIN
                Writeln('Running two processes');
                FinishProgram(Child);
            END ELSE
                Writeln('Could NOT run the child');
        END.

    INPUTS

        ProcName  : The name to use for the new process
        Segment   : A BPTR to the start of the program's segments,
                    returned by LoadSeg, for example.
        StackSize : The size of the stack to allocate for the new
                    process

    RESULTS
        A pointer to a RunProgram information block, or Nil if the
        new process could not be created.

    BUGS

    SEE ALSO

        @{" RunProgramNW    " link "runprogramnw" 0} @{" FinishProgram   " link "finishprogram" 0} @{" RunProgram      " link "runprogram" 0}
        @{" RunSegment      " link "runsegment" 0} @{" ProgramFinished " link "programfinished" 0}

@endnode



