@database Contents
@master PCQ:Hyper/crt.guide
@$VER: 1.0
@author "Nils Sjoholm"
@(c) "@ Nils Sjoholm"

@node "Main" "Utils/CRT"


                          Utils/CRT

                          @{" AttachConsole  " link "attachconsole" 0}
                          @{" ClrEOL         " link "clreol" 0}
                          @{" ClrScr         " link "clrscr" 0}
                          @{" CursOff        " link "cursoff" 0}
                          @{" CursOn         " link "curson" 0}
                          @{" DelLine        " link "delline" 0}
                          @{" DetachConsole  " link "detachconsole" 0}
                          @{" GotoXY         " link "gotoxy" 0}
                          @{" InsLine        " link "onsline" 0}
                          @{" KeyPressed     " link "keypressed" 0}
                          @{" MaxX           " link "maxx" 0}
                          @{" MaxY           " link "maxy" 0}
                          @{" ReadKey        " link "readkey" 0}
                          @{" TextBackground " link "textbackground" 0}
                          @{" TextColor      " link "textcolor" 0}
                          @{" WhereX         " link "wherex" 0}
                          @{" WhereY         " link "wherey" 0}










@endnode

@node "attachconsole" "Utils/CRT/AttachConsole"

    Utils/CRT/AttachConsole

    NAME
        AttachConsole - initialize the CRT routines for a window

    SYNOPSIS
        FUNCTION AttachConsole(w : WindowPtr) : Address;

    DESCRIPTION
        AttachConsole is used to set up all the structures needed
        by the rest of the CRT routines.  It must be called before
        any of the other routines.

        The address it returns points to a record used to store all
        the vital information the rest of the routines will need.
        You will pass this address to all the other CRT routines.

    EXAMPLE
        see
           @{" Examples/Map.p         " alink "PCQ:Examples/Map.p/main" 0}
           @{" Examples/ConsoleTest.p " alink "PCQ:Examples/ConsoleTest.p/main" 0}

    INPUTS
        w : a pointer to a valid (open) Window.

    RESULTS
        The address of a bookkeeping record, or Nil if anything
        goes wrong.

    SEE ALSO

        @{" ClrEOL         " link "clreol" 0} @{" ClrScr         " link "clrscr" 0} @{" CursOff        " link "cursoff" 0}
        @{" CursOn         " link "curson" 0} @{" DetachConsole  " link "detachconsole" 0} @{" GotoXY         " link "gotoxy" 0}
        @{" InsLine        " link "insline" 0} @{" KeyPressed     " link "keypressed" 0} @{" MaxX           " link "maxx" 0}
        @{" MaxY           " link "maxy" 0} @{" ReadKey        " link "readkey" 0} @{" TextColor      " link "textcolor" 0}
        @{" TextBackground " link "textbackground" 0} @{" WhereX         " link "wherex" 0} @{" WhereY         " link "wherey" 0}
        @{" WriteString    " link "writestring" 0}

@endnode

@node "clreol" "Utils/CRT/ClrEOL"

    Utils/CRT/ClrEOL

    NAME
        ClrEOL - clear the screen from the cursor to the end of line

    SYNOPSIS
        PROCEDURE ClrEOL(CRT : Address);

    DESCRIPTION
        This routine clears the text area from the cursor to the
        end of the line.

    EXAMPLE

        PROCEDURE CopyOver(CRT : Address);
        BEGIN
            GotoXY(CRT, 1,WhereY);
            WriteString(CRT, "This line is far too long");
            GotoXY(CRT, 14,WhereY);
            ClrEOL(CRT);
            WriteString(CRT, "just right");
        END;

    INPUTS

        CRT : A pointer to a valid CRT information block, as
                returned by AttachConsole

    RESULTS
        None

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" ClrScr        " link "clrscr" 0} @{" GotoXY        " link "gotoxy" 0} @{" WriteString   " link "writestring" 0}

@endnode

@node "clrscr" "Utils/CRT/ClrScr"


    Utils/CRT/ClrScr

    NAME
        ClrScr - clear the text area and move to 1,1

    SYNOPSIS
        Procedure ClrScr(CRT : Address);

    DESCRIPTION
        ClrScr clears the text area of the window, and moves the
        cursor to the upper left hand corner.

    EXAMPLE

        Procedure ClearWindow(w : WindowPtr);
        var
            CRT : Address
        begin
            CRT := AttachConsole(w);
            ClrScr(CRT);
            DetachConsole(w);
        end;

    INPUTS

        CRT : A pointer to a valid CRT information block, as
              returned by AttachConsole.

    RESULTS
        None

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" ClrEOL        " link "clreol" 0} @{" GotoXY        " link "gotoxy" 0}

@endnode

@node "cursoff" "Utils/CRT/CursOff"


    Utils/CRT/CursOff

    NAME
        CursOff - turn the text cursor off

    SYNOPSIS
        PROCEDURE CursOff(CRT : Address);

    DESCRIPTION
        Normally a console window displays a full-block text
        cursor.  This routine turns it off.

    EXAMPLE
        See
           @{" Examples/Map.p " link "PCQ:Examples/Map.p/main" 0}

    INPUTS

        CRT   : A pointer to a valid CRT information block,
                as returned by AttachConsole.

    RESULTS
        None

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" CursOn        " link "curson" 0}

@endnode

@node "curson" "Utils/CRT/CursOn"

    Utils/CRT/CursOn

    NAME
        CursOn - turn the text cursor on

    SYNOPSIS
        PROCEDURE CursOn(CRT : Address);

    DESCRIPTION
        This routine turns the console.device's text cursor
        on.  It starts out on, so the only reason you'll need
        to call this routine is if you have previously called
        CursOff.

    EXAMPLE
        See
           @{" Examples/Map.p " link "PCQ:Examples/Map.p/main" 0}

    INPUTS

        CRT   : A pointer to a valid CRT information block, as
                returned by AttachConsole.

    RESULTS
        None

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" CursOff       " link "cursoff" 0}

@endnode

@node "delline" "Utils/CRT/DelLine"


    Utils/CRT/DelLine

    NAME
        DelLine - delete the current line

    SYNOPSIS
        Procedure DelLine(CRT : Address);

    DESCRIPTION
        DelLine deletes the line on which the cursor rests.  It
        moves all the lines below it up one, and clears the
        bottom line.

    EXAMPLE

        PROCEDURE BringTogether(CRT : Address);
        BEGIN
            ClrScr(CRT);
            WriteString(CRT, "The First Line");
            GotoXY(CRT,1,3);
            WriteString(CRT, "The Second Line");
            GotoXY(CRT,1,2);
            DelLine(CRT);
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block, as
                returned by AttachConsole

    RESULTS
        None

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" InsLine       " link "insline" 0} @{" GotoXY        " link "gotoxy" 0}

@endnode

@node "detachconsole" "Utils/CRT/DetachConsole"


    Utils/CRT/DetachConsole

    NAME
        DetachConsole - close the console.device and free memory

    SYNOPSIS
        PROCEDURE DetachConsole(CRT : Address);

    DESCRIPTION
        When you have finished using the CRT routines, you need
        to call DetachConsole to free up all the resources they
        are using.  This routine does not close the window,
        however.

    EXAMPLE
        See
           @{" Examples/Map.p         " alink "PCQ:Examples/Map.p" 0}
           @{" Examples/ConsoleTest.p " alink "PCQ:Examples/ConsoleTest.p/main" 0}

    INPUTS

        CRT   : A pointer to a valid CRT information block,
                as returned by AttachConsole

    RESULTS
        None

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0}

@endnode

@node "gotoxy" "Utils/CRT/GotoXY"

    Utils/CRT/GotoXY

    NAME
        GotoXY - move the cursor to column X and row Y

    SYNOPSIS
        PROCEDURE GotoXY(CRT : Address; X, Y : Short);

    DESCRIPTION
        This routine moves the window's text cursor (which
        is not the same as the graphics cursor) to the
        position X,Y.  This position is measured in characters,
        not pixels.

    EXAMPLE
        See
           @{" Examples/Map.p " alink "PCQ:Examples/Map.p/main" 0}

    INPUTS

        CRT   : A pointer to a valid CRT information block,
                as returned by AttachConsole

    RESULTS
        None

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" MaxX          " link   "maxx" 0} @{" MaxY          " link   "maxy" 0}

@endnode

@node "insline" "Utils/CRT/InsLine"

    Utils/CRT/InsLine

    NAME
        InsLine - insert a text line

    SYNOPSIS
        PROCEDURE InsLine(CRT : Address);

    DESCRIPTION
        InsLine inserts one text line at the current cursor
        position, moving all lines below it down.

    EXAMPLE

        PROCEDURE SplitApart(CRT : Address);
        BEGIN
            ClrScr(CRT);
            WriteString(CRT, "The First Line\n");
            WriteString(CRT, "The Third Line");
            GotoXY(CRT,1,2);
            InsLine(CRT);
            WriteString(CRT, "The Second Line");
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block,
                as returned by AttachConsole

    RESULTS
        None

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" DelLine       " link "delline" 0} @{" GotoXY        " link "gotoxy" 0}

@endnode

@node "keypressed" "Utils/CRT/KeyPressed"


    Utils/CRT/KeyPressed

    NAME
        KeyPressed - test whether a key has been pressed

    SYNOPSIS
        FUNCTION KeyPressed(CRT : Address) : Boolean;

    DESCRIPTION
        This routine tests whether a key is waiting to be
        read with ReadKey.

    EXAMPLE

        PROCEDURE ReallyBusyWait(CRT : Address);
        BEGIN
            WHILE NOT KeyPressed(CRT) DO
                WriteString(CRT, "Waiting!");
            ClrScr(CRT);
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block, as
                returned by the AttachConsole function.

    RESULTS
        TRUE if a key is waiting, FALSE otherwise.

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" ReadKey       " link "readkey" 0}

@endnode

@node "maxx" "Utils/CRT/MaxX"

    Utils/CRT/MaxX

    NAME
        MaxX - returns the maximum column of the window

    SYNOPSIS
        FUNCTION MaxX(CRT : Address) : Short;

    DESCRIPTION
        MaxX returns the rightmost column of the window, in
        character coordinates, not pixels.  If the window has
        a sizing gadget, this value might change.

    EXAMPLE

        PROCEDURE BorderBox(CRT : Address);
        VAR
            i : Short;
        BEGIN
            FOR i := 1 TO MaxX(CRT) DO BEGIN
                GotoXY(CRT, i, 1);
                WriteString(CRT, "=");
                GotoXY(CRT, i, MaxY(CRT));
                WriteString(CRT, "=");
            END;
            FOR i := 2 TO Pred(MaxY(CRT)) DO BEGIN
                GotoXY(CRT, 1, i);
                WriteString(CRT, "|");
                GotoXY(CRT, MaxX(CRT), i);
                WriteString(CRT, "|");
            END;
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block, as
                returned by AttachConsole

    RESULTS
        The rightmost column, in character coordinates, for the
        window at the moment.

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" MaxY          " link "maxy" 0} @{" GotoXY        " link "gotoxy" 0}
        @{" WhereX        " link "wherex" 0} @{" WhereY        " link "wherey" 0}

@endnode

@node "maxy" "Utils/CRT/MaxY"


    Utils/CRT/MaxY

    NAME
        MaxY - return the maximum row of the window

    SYNOPSIS
        FUNCTION MaxY(CRT : Address) : Short;

    DESCRIPTION
        This function returns the bottommost row for the window.
        If the window has a sizing gadget, this value could change
        throughout the program.

    EXAMPLE

        PROCEDURE BorderBox(CRT : Address);
        VAR
            i : Short;
        BEGIN
            FOR i := 1 TO MaxX(CRT) DO BEGIN
                GotoXY(CRT, i, 1);
                WriteString(CRT, "=");
                GotoXY(CRT, i, MaxY(CRT));
                WriteString(CRT, "=");
            END;
            FOR i := 2 TO Pred(MaxY(CRT)) DO BEGIN
                GotoXY(CRT, 1, i);
                WriteString(CRT, "|");
                GotoXY(CRT, MaxX(CRT), i);
                WriteString(CRT, "|");
            END;
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block, as
                returned by AttachConsole.

    RESULTS
        The bottommost row, in character coordinates, of the
        window at the moment.

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" MaxX          " link "maxx" 0} @{" GotoXY        " link "gotoxy" 0}
        @{" WhereX        " link "wherex" 0} @{" WhereY        " link "wherey" 0}

@endnode

@node "readkey" "Utils/CRT/ReadKey"

    Utils/CRT/ReadKey

    NAME
        ReadKey - wait for a keypress, then return the key

    SYNOPSIS
        FUNCTION ReadKey(CRT : Address) : Char;

    DESCRIPTION
        ReadKey waits until the user presses a key, then returns
        that key.

    EXAMPLE

        PROCEDURE Typer(CRT : Address);
        VAR
            Buf : ARRAY [0..1] OF Char;
        BEGIN
            Buf[1] := Chr(0);
            REPEAT
                Buf[0] := ReadKey(CRT);
                WriteString(CRT, String(@Buf));
            UNTIL Buf[0] = 'q';
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block as
                returned by AttachConsole

    RESULTS
        The character read

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" KeyPressed    " link "keypressed" 0}

@endnode

@node "textbackground" "Utils/CRT/TextBackground"

    Utils/CRT/TextBackground

    NAME
        TextBackground - set the current background color

    SYNOPSIS
        PROCEDURE TextBackGround(CRT : Address; Pen : Byte);

    DESCRIPTION
        This routine sets the background pen number for
        subsequent text writes.  The actual color depends
        on the screen's colormap, so you might want to use
        SetRGB4 to make sure you get the colors you're
        looking for.

    EXAMPLE

        PROCEDURE HighLight(CRT : Address; msg : String);
        BEGIN
            TextBackground(CRT, 3);
            WriteString(CRT, msg);
            TextBackground(CRT, 0);
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block as
                returned by AttachConsole.
        Pen   : The new background pen number

    RESULTS
        None

    BUGS

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" TextColor     " link "textcolor" 0} @{" WriteString   " link "writestring" 0}

@endnode

@node "textcolor" "Utils/CRT/TextColor"

    Utils/CRT/TextColor

    NAME
        TextColor - set the foreground color for text drawing

    SYNOPSIS
        PROCEDURE TextColor(CRT : Address; Pen : Byte);

    DESCRIPTION
        This routine sets the foreground pen color for the
        text.  The resulting color depends on the colormap
        in use, so to get specific results you should use
        the SetRGB4 function to define the pen colors
        exactly.

    EXAMPLE

        PROCEDURE ColorWrite(CRT : Address; Msg : String);
        VAR
            Buffer : ARRAY [0..1] OF Char;
            Pen    : Byte;
            Pos    : Short;
        BEGIN
            Buffer[1] := Chr(0);
            Pos := 0;
            WHILE Msg[Pos] <> 0 DO BEGIN
                Buffer[0] := Msg[Pos];
                WriteString(CRT, String(@Buffer));
                TextColor(CRT, Pos);
                Inc(Pos);
            END;
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block, as
                returned by the AttachConsole function.
        Pen   : The new pen number

    RESULTS
        None

    BUGS

    SEE ALSO

        @{" AttachConsole  " link "attachconsole" 0} @{" TextBackground " link "textbackground" 0} @{" WriteString    " link "writestring" 0}

@endnode

@node "wherex" "Utils/CRT/WhereX"

    Utils/CRT/WhereX

    NAME
        WhereX - returns the current cursor column

    SYNOPSIS
        FUNCTION WhereX(CRT : Address) : Short;

    DESCRIPTION
        This routine returns the cursor's current column position,
        expressed in character coordinates (not pixels).

    EXAMPLE

        PROCEDURE VerticalLine(CRT : Address);
        VAR
            y : Short;
        BEGIN
            FOR y := 1 TO MaxY(CRT) DO BEGIN
                GotoXY(WhereX(CRT),y);
                WriteString(CRT, "|");
            END;
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block as
                returned by AttachConsole

    RESULTS
        The current cursor column in character coordinates

    BUGS

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" GotoXY        " link "gotoxy" 0} @{" MaxX          " link "maxx" 0}
        @{" MaxY          " link "maxy" 0} @{" WhereY        " link "wherey" 0}

@endnode

@node "wherey" "Utils/CRT/WhereY"

    Utils/CRT/WhereY

    NAME
        WhereY - returns the current text row

    SYNOPSIS
        FUNCTION WhereY(CRT : Address) : Short;

    DESCRIPTION
        WhereY returns the cursor row in character coordinates,
        not pixels.

    EXAMPLE

        PROCEDURE Filling(CRT : Address);
        VAR
            Offset : Short;
        BEGIN
            Offset := 1;
            WHILE Offset <= (MaxX(CRT) DIV 2) DO BEGIN
                GotoXY(CRT, Offset, WhereY(CRT));
                WriteString(CRT, "-");
                GotoXY(CRT, MaxX(CRT) - Offset, WhereY(CRT));
                WriteString(CRT, "-");
                Inc(Offset);
            END;
        END;

    INPUTS

        CRT   : A pointer to a valid CRT information block as
                returned by the AttachConsole function.

    RESULTS
        The current cursor row in character coordinates

    BUGS

    SEE ALSO

        @{" AttachConsole " link "attachconsole" 0} @{" WhereX        " link "wherex" 0} @{" MaxX          " link "maxx" 0}
        @{" MaxY          " link "maxy" 0} @{" GotoXY        " link "gotoxy" 0}

@endnode



