@database Contents
@master PCQ:Hyper/utils/consoleio.guide
@$VER: 1.0
@author "Nils Sjoholm"
@(c) "@ Nils Sjoholm"

@node "Main" "Utils/ConsoleIO"
@next "congetchar"




                       Utils/ConsoleIO


                        @{" ConGetChar " link "congetchar" 0}
                        @{" ConPutChar " link "conputchar" 0}
                        @{" ConPutStr  " link "conputstr" 0}
                        @{" ConWrite   " link "conwrite" 0}
                        @{" QueueRead  " link "queueread" 0}










@endnode

@node "congetchar" "Utils/ConsoleIO/ConGetChar"
@next "conputchar"
@prev "Main"

    Utils/ConsoleIO/ConGetChar

    NAME
        ConGetChar - read a character from the console.device

    SYNOPSIS
        FUNCTION ConGetChar(ConsolePort : MsgPortPtr;
                            Request     : IOStdReqPtr;
                            WhereTo     : String) : Char;

    DESCRIPTION
        ConGetChar waits until a previous QueueRead is satified,
        then queues up another and returns the character.

        You need to call OpenDevice to initialize Request and
        attach the console.device to your window.

    EXAMPLE

        {$I "Include:Utils/IOUtils.i"}

        FUNCTION ReadOneCharacter(w : WindowPtr);
        VAR
            MyPort : MsgPortPtr;
            MyReq  : IOStdReqPtr;
            Buffer,
            Value  : Char;
            Error  : Integer;
            Dummy  : MessagePtr;
        BEGIN
            MyPort := CreatePort(NIL, 0);
            MyReq  := CreateStdIO(MyPort);
            MyReq^.io_Data := Address(w);
            MyReq^.io_Length := SizeOf(Window);
            Error := OpenDevice("console.device",0,
                                IORequestPtr(MyReq), 0);
            QueueRead(MyReq, @Buffer);
            Value := ConGetChar(MyPort, MyReq, @Buffer);
            IF CheckIO(IORequestPtr(MyReq)) THEN BEGIN
                Error := AbortIO(IORequestPtr(MyReq));
                Dummy := WaitPort(MyPort);
                Dummy := GetMsg(MyPort);
            END;
            CloseDevice(MyReq);
            DeleteStdIO(MyReq);
            DeletePort(MyPort);
            ReadOneCharacter := Value;
        END;

    INPUTS
        ConsolePort : A pointer to a valid MsgPort, the one used
                      by the IOStdReq used for QueueRead.
        Request     : A pointer to a valid IOStdReq, which will be
                      used to reset QueueRead.
        WhereTo     : A pointer to the buffer used by QueueRead,
                      which also will be used to reset QueueRead.

    RESULTS
        The character read.

    SEE ALSO

        @{" ConPutChar " link "conputchar" 0} @{" ConWrite   " link "conwrite" 0} @{" ConPutStr  " link "conputstr" 0} @{" QueueRead  " link "queueread" 0}

@endnode

@node "conputchar" "Utils/ConsoleIO/ConPutChar"

    Utils/ConsoleIO/ConPutChar

    NAME
        ConPutChar - write one character to the console device

    SYNOPSIS
        PROCEDURE ConPutChar(Req : IOStdReqPtr; Character : Char);

    DESCRIPTION
        This routine writes a single character through the console
        device to a window.  You should already have called
        OpenDevice to open the console.device and attach it to
        your window.

        Note that for many applications, the routines in Utils/CRT.i
        will be easier to use.

    EXAMPLE
        see
           @{" Examples/DeadKeysPlus.p " alink "PCQ:Examples/DeadKeysPlus.p/main" 0}

    INPUTS
        Req : A pointer to a valid IOStdReq, initialized by a
              call to OpenDevice.
        Character : The Char to write.

    RESULTS
        None

    SEE ALSO

        @{" ConWrite   " link "conwrite" 0} @{" ConPutStr  " link "conputstr" 0} @{" QueueRead  " link "queueread" 0} @{" ConGetChar " link "congetchar" 0}

@endnode

@node "conputstr" "Utils/ConsoleIO/ConPutStr"
@next "conwrite"
@prev "conputchar"

    Utils/ConsoleIO/ConPutStr

    NAME
        ConPutStr - write a null-terminated string

    SYNOPSIS
        PROCEDURE ConPutStr(Req : IOStdReqPtr; Str : String);

    DESCRIPTION
        ConPutStr writes a null-terminated string through the
        console.device to the screen.  You must use OpenDevice
        to attach the console.device to the window.

    EXAMPLE
        see
           @{" Examples/DeadKeysPlus.p " alink "PCQ:Examples/DeadKeysPlus.p/main" 0}

    INPUTS
        Req : a pointer to a valid IOStdReq, initialized
              by a call to OpenDevice.
        Str : The string to write, which must be null-terminated.

    RESULTS
        None

    SEE ALSO

        @{" ConPutChar " link "conputchar" 0} @{" ConWrite   " link "conwrite" 0} @{" QueueRead  " link "queueread" 0} @{" ConGetChar " link "congetchar" 0}

@endnode

@node "conwrite" "Utils/ConsoleIO/ConWrite"
@next "queueread"
@prev "conputstr"

    Utils/ConsoleIO/ConWrite

    NAME
        ConWrite - write any amount of data to the console.device

    SYNOPSIS
        PROCEDURE ConWrite(Req    : IOStdReqPtr;
                           Str    : String;
                           Length : Integer);

    DESCRIPTION
        ConWrite writes any amount of data to the console device.
        Although Str is defined as a string, it can in fact point
        to any arbitrary data and does not have to be null
        terminated.  If the data is already null-terminated and
        you don't know its length, you can call ConPutStr instead.

        Before you call this routine, you must use OpenDevice to
        attach the console.device to your window.

    EXAMPLE
        See
           @{" Examples/SmallCom.p     " alink "PCQ:Examples/SmallCom.p/main" 0}
           @{" Examples/DeadKeysPlus.p " alink "PCQ:Examples/DeadKeysPlus.p/main" 0}

    INPUTS
        Req : A pointer to a valid IOStdReq, initialized by a
              call to OpenDevice.
        Str : A pointer to any arbitrary data
        Length : The number of bytes to write.

    RESULTS
        None

    SEE ALSO

        @{" ConPutChar " link "conputchar" 0} @{" ConPutStr  " link "conputstr" 0} @{" QueueRead  " link "queueread" 0} @{" ConGetChar " link "congetchar" 0}

@endnode

@node "queueread" "Utils/ConsoleIO/QueueRead"
@next "Main"
@prev "conwrite"

    Utils/ConsoleIO/QueueRead

    NAME
        QueueRead - tell the console.device where to put character

    SYNOPSIS
        PROCEDURE QueueRead(Req : IOStdReqPtr; Where : String);

    DESCRIPTION
        The QueueRead routine lets the console.device know that
        you want to read a character.  If a character arrives,
        the console.device will put it in Where and return the
        Req.  Note that you must have already called OpenDevice
        to initialize the Req and attach it to a window.

        Remember that the QueueRead returns immediately - it does
        not wait until a character is available.  You must use
        CheckIO to see if a character has arrived.

        You might want to check the routines in Utils/CRT.i to see
        if they better suit your needs.

    EXAMPLE

        FUNCTION ReadConCharacter(IO : IOStdReqPtr) : Char;
        VAR
            CharBuffer  : Char;
            Dummy       : Integer;
        BEGIN
            QueueRead(IO, @CharBuffer);
            Dummy := WaitIO(IO);
            ReadConCharacter := CharBuffer;
        END;

    INPUTS
        Req : a pointer to a valid IOStdReq, intialized by
              OpenDevice.
        Where : A pointer to at least one byte of memory to
                receive the character.

    RESULTS
        None

    SEE ALSO

        @{" ConGetChar " link "congetchar" 0} @{" ConPutChar " link "conputchar" 0} @{" ConPutStr  " link "conputstr" 0} @{" ConWrite   " link "conwrite" 0}

@endnode

