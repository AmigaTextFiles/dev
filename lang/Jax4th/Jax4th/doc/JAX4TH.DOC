JAX4TH.DOC (C) Copyright 1991 1993, 1994, Jack J. Woehr, All Rights Reserved.
Jack J. Woehr, PO Box 51, Golden, CO 80402-0051
jax@well.sf.ca.us 72203.1320@compuserve.com SYSOP RCFB (303) 278-0364

This is free software and can be modified and redistributed under
certain conditions described in the file COPYING.TXT. The Disclaimer
of Warranty and License for this free software are also contained in
the file COPYING.TXT.

The Gnu Public License is Copyright (C) 1988, 1990, 1991, 1992, 1993
Free Software Foundation, Inc.

Unimplemented Features
----------------------
NOTE: Several features noted or partially described are not implemented yet
in JAX4TH, but are planned for future revisions. UNIMPLEMENTED FEATURES have
their descriptions surrounded by curly-braces { like this } in the text or

{
	like this
}
	or

{	like this	}.

Description
-----------
JAX4TH is an entirely unofficial implementation of ANS/ASC X3/X3J14 dpANS-6
for Forth Programming Systems. dpANS-6 was recently adopted by the X3 parent
body for forwarding the American National Standards Institute as the
recommended proposal for ANS Forth. For more information on ANS Forth,
contact the
		American National Standards Institute
		11 W. 42nd St.
		New York NY 10036

or email ansforth-request@minerva.com

JAX4TH is not a professional Amiga Forth development system. J4TH from
Delta Research is a professional Amiga Forth development system. Contact

	Delta Research
	PO BOX 151051
	San Rafael CA 94915-1051
	1-415-453-4320.

Note: I have no connection beyond friendship with the people of Delta Research.

Implementation Strategy
-----------------------
The author's strategy has been to create a kernel consisting of a minimal
implementation of the dpANS-6 CORE, CORE EXT, BLOCK, BLOCK EXT, DOUBLE,
DOUBLE EXT, ERROR, ERROR EXT, FACILITY, FACILITY EXT FILE, { FILE EXT, }
MEMORY, MEMORY EXT, SEARCH, SEARCH EXT, STRING, and STRING EXT wordsets in
order to give the user the flavor of what it will be like to program in pure
transportable ANS Forth should the current dpANS be adopted as ANS Forth.

The philosophical attitude taken has been that dpANS in effect defines what
the "primitives" are of the transportable Forth virtual machine, so wherever
practical I have coded words as primitives, in assembler, as the irreducible
atoms of this proto-ANS Forth.

Note that there is little error-checking in the current implementation.
For instance, passing the wrong arguments to OPEN-FILE is nearly
guaranteed to guru under AmigaDOS 1.3. As the author revises and improves
this system, many features will change, among them the level of error
correction. In particular, the use in the kernel of CATCH and THROW will
be greatly expanded. (See "Future Revisions" elsewhere in this document.)

There are two wordlists defined in the JAX4TH kernel. One is called
FORTH-WORDLIST , which executing the word FORTH makes the first searched
wordlist. FORTH is the minimum search order in and of itself and contains
all the dpANS-2 words in the system. Refer to X3J14 dpANS-2 for documentation
on behavior of all but two of the words in the FORTH-WORDLIST. Refer to
JAX4TH.WORDS for a list with stack diagrams of all words in the FORTH-WORDLIST.

The second wordlist is called IMPLEMENTOR-WORDLIST and can be invoked by the
word IMPLEMENTOR. The IMPLEMENTOR-WORDLIST contains words the implementor
found useful in creating and testing the JAX4TH system. Refer to the file
JAX4TH.WORDS for a list with stack diagrams and descriptions of all the words
in the IMPLEMENTOR-WORDLIST.

IMPLEMENTOR-WORDLIST and IMPLEMENTOR are the only words in the FORTH-WORDLIST
which are not found in dpANS-6.

IMPLEMENTOR-WORDLIST words may be quite dangerous to execute. Be sure
you understand what such a word does before entering it at the console
or in a file.

The IMPLEMENTOR-WORDLIST will constantly change. No application intended
to be run on a Standard System or even on future revisions of JAX4TH should
count on the behavior or existence of any word in the IMPLEMENTOR-WORDLIST.

A final caution: the clever user may discover that certain words in the
FORTH-WORDLIST were defined in terms of words in the IMPLEMENTOR-WORDLIST.
This truth does not assure that words in the IMPLEMENTOR-WORDLIST will
continue to exist. The author intends to shrink the IMPLEMENTOR-WORDLIST
to the smallest size possible.

Future Revisions
----------------
Future revisions of JAX4TH are not guaranteed to conform to the present
effort, but rather shall conform to the state of the dpANS or ANS Forth,
whichever is currently in effect.

No word in the IMPLEMENTOR wordlist is guaranteed to be present or to
exhibit behavior identical to that which it exhibits in the current
revision in future revisions of JAX4TH.

If interest justifies continued refinement of this system, the author
intends to clean it up mightily, add much more error checking and
recovery, and generally make it a genuine portable Forth development
tool, complete with floating point, assembler, debugger, editor and
metacompiler.

Documentation will continually be revised and improved, for as long
as interest in this system warrants.

Future revisions of JAX4TH may feature switchable case-insensitive
searching.

About Forth
-----------
	The author of Jax4th has written two books on Forth:

	 _Forth: The New Model_, Jack Woehr M&T Publishing, 1992,
ISBN 1-55851-277-2 (about dpANS-Forth);

	 _Seeing Forth_, Jack Woehr, Offete Enterprises, 1992 (about Forth
history and philosophy).

	Both of these books, as well as many others by many other fine Forth
authors, may be mail-ordered from:

		The Forth Interest Group
		P.O. Box 2154
		Oakland, CA 94621
		1-510-89-FORTH


OPTIONAL SHAREWARE REGISTRATION
-------------------------------
	Jax4th is GNU-style Freeware, but if you send a $25.00 donation to
the author:

	Jack Woehr
	PO Box 51
	Golden, CO 80402-0051

	accompanied by an internet email address, you will be kept posted on
major upgrades (including later additions to this documentation!!) via
UUENCODEd .ZIP files. Your registration will last for one (1) year from the
date it is received. PLEASE SEND U.S. CHECK OR MONEY ORDER ONLY ... NO CASH
NO CREDIT CARDS NO FOREIGN CHECKS.

	Your donation is entirely voluntary, since from time to time I will
post these same files to public download sites. Your donation simply expresses
respect for the author and adds to your convenience in keeping up with
upgradesto this model Forth system. Since your donation is voluntary, no
extension of Jax4th's complete NON-WARRANTY is effected by such donation:
JAX4TH IS NEVER SOLD.

	All tech support is currently provided via the RCFB BBS (303) 278-0364.
(J)oin JAXWARE when you are there. No tech support is promised for this free
software, but it's my BBS, so I'll be there maybe :-)

USAGE
-----
NOTE: Several features noted or partially described are not implemented yet
in JAX4TH, but are planned for future revisions. UNIMPLEMENTED FEATURES have
their descriptions surrounded by curly-braces { like this } in the text or

{
	like this
}
	or

{	like this	}.


From an Amiga Shell (NEWCON:) window, type:

	1> JAX4TH <imagefile.jx4>
 
	where <imagefile.jx4> is either the default DEFIMAGE.JX4 or
	a previously-saved image file. If <imagefile.jx4> is omitted
	from the command line, or if the specified image file cannot
	be found, the logical device JX4: is searched for DEFIMAGE.JX4
	(which may be either the system-supplied DEFIMAGE.JX4 or a
	previously-saved image named to the default name).

	If no image file at all can be found, JAX4TH exits with an error
	code of 20, Amiga "Object not found".

Input line acceptance is based on the command-line editing features of the
Amiga NEWCON: window. That is, words like ACCEPT in JAX4TH know nothing about
special characters like "backspace": Amiga NEWCON: handles all this for JAX4TH,
in addition to providing the convenience of command-line history. The other
side of this coin is that JAX4TH's KEY and KEY? know nothing of any key presses
until the Amiga <RETURN> key has been pressed.

I/O-INDEPENDENT BACKGROUND EXECUTION IS NOT SUPPORTED. DO NOT USE " RUN " or
" ARUN " OR SIMILAR COMMANDS WITH JAX4TH unless you provide I/O redirection.
You may use AmigaDOS I/O redirection with JAX4TH, which works quite nicely.

Leaving JAX4TH
--------------
BYE exits the current instance of JAX4TH. BYE returns all default resources
and decrements the counter referenced by the JAX4TH word INSTANCES . BYE
does not return memory allocated via words in the MEMORY and MEMORY Extensions
wordlists. BYE does not close files opened by the programmer. BYE does not
cleanup any resources allocated by the programmer via direct CALLs to the
Amiga operating system.

Making JAX4TH an AmigaDOS RESIDENT Program
------------------------------------------
The command line

	1> RESIDENT JAX4TH

will add JAX4TH to the AmigaDOS RESIDENT list under Enhancer 1.3.

Amiga WorkBench operation is currently not supported. In future revisions,
clicking on the JAX4TH icon or an image icon will invoke JAX4TH in a manner
analogous to the above.

Recompilation of Jax4th
-----------------------

	To compile Jax4th from the sources provided you will need:

	- An Amiga assembler: I use Innovatronics C.A.P.E. from several
years ago (thanx, Wes Howe!!), but probably any decent Amiga assembler will
work, this was done on an Amiga 1000 and no special tricks were used.

	- The include file "prelvo.i" is just precompiled Library Volume
Offsets ... you can compile the LVO's anyway you wish in substitution for
that.

	Amiga scripts doing the assembly and linking are provided with the
release.

Standard System
---------------
Description of System:

	Jax4th is a model system conforming to the current state of the
draft proposed Standard Forth (ANSI/IEEE X3.215-199x) to the best of the
author's understanding; exceptions as noted.

	This is an ANS Forth System with the following wordsets in addition
to the required Core wordset.

	- Core Extensions
	- Block
	- Block Extensions
	- Double Number
	- Double Number Extensions
	- Error-Handling
	- Error-Handling Extensions
	- Facility
	- Facility Extensions
	- File-Access
{	- File-Access Extensions	}
	- Memory
	- Memory Extensions
	- Search-Order
	- Search-Order Extensions
	- String
	- String Extensions

For a glossary of the words in the Core and the words in the optional wordsets
listed above, see dpANS. dpANS does not impose the documentation requirement
of a Word Set Glossary upon the implementor.

For a glossary of the words in JAX4TH, see JAX4TH.WORDS which contains
a list of dpANS words and a glossary of most IMPLEMENTOR words.

Implementation Options (dpANS-2:3.1)
-------------------------------------

address units: size, in integer bits of one address unit 	8

aligned address space						word-aligned

character: size, in integer address units, of one character	1

requirements for character-aligned addresses			byte alignment

cell: size in integer address units of one cell			4

character editing of ACCEPT					Amiga NEWCON:

character editing of EXPECT					Amiga NEWCON:

character set							ASCII 7-bit

counted string: maximum size, in characters			255

current output device						Amiga NEWCON:

default block space						2^30 BLOCKs

destination of displayed characters				Amiga NEWCON:

ENVIRONMENT? maximum string					t.b.d

ACCEPT and EXPECT display after return				newline

input return key						Enter/Return

maximum size of a counted string				articula supra

maximum size of a word name					31 chars

method of use of return stack during compilation	none other than
							that implied by normal
							Forth execution.

methods of memory space management	Kernel:	Amiga RESIDENT program.
					Local CODE Segment: loaded from file.
					Local DATA Segment: loaded from file.
					More CODE or DATA space can be acquired
					by enhancing image size while saving
					image to file for later reload.
					External allocations from Amiga Exec:
					System returns external allocation
					Data-Seg-relative address while
					recording allocation width internally.

methods of dictionary compilation	Fill local CODE and DATA images, save
					off image to file (along with possible
					extended image space) to file for later
					reload, at which time extended space
					becomes usable. All Standard dictionary
					entry creation words applicable.

minimum search order						FORTH

number type: result of arithmetic operation on a character or flag data type
					A flag is -1 (TRUE) or 0 (FALSE).
					A character is an unsigned byte.

representation and storage of loop parameters	$8000,0000-masked on return
						stack, a' la' F83.

selection of current input device		Amiga command-line redirection

size of scratch area returned by pad			256 characters

size of keyboard text input buffer			256 characters

size of pictured numeric output string buffer		128 characters

system prompt						ok<NEWLINE>

type of division					default is floored

control flow stack					data stack

ranges for				n	$-80000000	$7FFFFFFF
					+n	        1	$7FFFFFFF
					u	        0	$FFFFFFFF
					d	-(2^63)		2^63-1
					+d		0	2^63-1
					ud		0	2^64-1

error abort sequence					reset SP and QUIT

behavior of EMIT for non-displayable values		send to NEWCON: window

maintenance of display upon receipt of 'return'		Amiga NEWCON:

values returned after arithmetic overflow	wrap, or -1 -1 for div/0

Testing Requirements (dpANS-2:3.1.1)
Minima (dpANS-2:3.1.2)
Parameter Range Restrictions (dpANS-2:3.1.3)
---------------------------------------------

JAX4TH possess at a minimum the required features enumerated in dpANS-2:3.1.1
through dpANS-2:3.1.3 inclusive.

3.1.4 Environmental Queries
---------------------------

Where the enumerated queries are answered by the JAX4TH implementation
of ENVIRONMENT?, JAX4TH conforms to this article.

3.2 Word Names and Definitions
------------------------------

JAX4TH conforms to those requirements enumerated in this section such
as pertain to a Standard System.

3.9 Error Conditions
--------------------

JAX4TH colon definitions will abort if control constructs are unbalanced
or if the depth of the data stack is not the same at the execution of
semicolon ( ; ) as it was at colon ( : ). Such an aborted definition
will not be findable in a dictionary search. (dpANS-2:6.1.0450)

3.10.1 General Ambiguous Conditions
-----------------------------------

Insufficient parameter stack space or return stack space (stack overflow):
	Ignore and continue until operating system intervenes or crashes.

Reading from an empty parameter stack or return stack (stack underflow):
	If interpreting, interpreter loop will abort on stack underflow.
	Return stack underflow and parameter stack underflow during
	execution will ignore and continue in most cases until operating
	system intervenes or crashes.

Insufficient space for loop control parameters:
	Ignore and continue until operating system intervenes or crashes.

Insufficient space in dictionary:
	Ignore and continue until operating system intervenes or crashes.

Division by zero:
	Return -1 quotient (-1 modulus).

A result out of range:
	Ignore and continue.

Argument type inompatible with specified input parameter:
	Ignore and continue.

A word not found and not a valid number during text interpretation or
compilation:
	ABORT and display a message.

Interpretation of a word with the C (compile only) attribute):
	ABORT and display a message.

FORGETting within the system to a point that removes a word required
for correct execution:
	The resident kernel of JAX4TH is not subject to the action of
	FORGET.

Attempting to use a zero-length string as a name:
	ABORT and display a message.

Overflow of pictured numeric output stream:
	ABORT and display a message.

Parsed string overflow:
	PARSE cannot overflow.

A word name exceeded maximum length of a word name:
	Name is truncated to maximum name length (31 characters).

Contents of input stream or string literal are modified by program:
	Ignore and continue.

4.1 ANS Forth Programming System
--------------------------------
Additional Requirements:

	FILE:

	file errors:
		all error returns are those returned by a call to
		AmigaDOS IoErr().

	file identifier:
		AmigaDOS "file" (BCPL fh).

	file line terminator:
		Hex 0A, AmigaDOS NEWLINE.

	file name format:
		per AmigaDOS.

	file path name format:
		per AmigaDOS.

	file status information:
		per AmigaDOS.

	input stream file state after error:
		currently undefined.

	ior values and meaning:

	There are no result codes for BLOCK-FID; this must be a typo in
	dpANS-2 (and the previous BASes).

	ior for CLOSE-FILE is always zero for success.

	ior for CREATE-FILE (if non-zero) is the return from the AmigaDOS
	call IoErr().

	ior for DELETE-FILE (if non-zero) is the return from the AmigaDOS
	call IoErr().

	ior for FILE-POSITION (if non-zero) is the return from the AmigaDOS
	call IoErr().

	ior for FILE-SIZE (if non-zero) is the return from the AmigaDOS
	call IoErr().

	ior for OPEN-FILE (if non-zero) is the return from the AmigaDOS
	call IoErr().

	ior for READ-FILE (if non-zero) is the return from the AmigaDOS
	call IoErr().

	ior for READ-FILE (if non-zero) is the return from the AmigaDOS
	call IoErr().

	ior for REPOSITION-FILE is previous file position.

{
	ior for RESIZE-FILE (if non-zero) is the return from the AmigaDOS
	call IoErr().
}

	ior for WRITE-FILE is number of chars successfully written or -1
	for failure.

	ior for  WRITE-FILE is 1 for success or -1 for failure.

Implementation options:

	CORE:

	: ("colon") saves machine address instruction pointer on return stack
	at execution time of the word defined by : ("colon").

	; ("semicolon") compiles equivalent of EXIT to wit, UNNEST so that
	future decompilers can differentiate EXITs from UNNESTing.

	ABORT" after printing the specified string performs the equivalent of
	the following sequence of operations:
		- reset Return Pointer
		- QUIT

	DOES> at execution time of a word modified by DOES> performs the
	equivalent of the behaviour of a colon definition in order to
	preserve information about the caller of the DOES>-modified word.

	Maximum characters for an ENVIRONMENT? is 31.

	CORE EXT:

	Implementation-dependent information stored about caller of a :NONAME
	construct is stored in a like manner to that performed by : ("colon").

	BLOCK:

	None noted on perusal of dpANS-2.

	BLOCK EXT:

	None noted on perusal of dpANS-2.

	DOUBLE:

	None noted on perusal of dpANS-2.

	DOUBLE EXT:

	None noted on perusal of dpANS-2.

	ERROR:

	None noted on perusal of dpANS-2.

	ERROR EXT:

	None noted on perusal of dpANS-2.

	FACILITY:

	Empty word set.

	FACILITY EXT:

	AT-XY performs AmigaDOS console string emits.

	FILE:

	On error, open INCLUDE-FILE file status is currently undefined,
	probably left open. This will change in future revisions of
	JAX4TH and has been left hanging as a matter of expediency.

	If named file cannot be opened by INCLUDED, abort with message.
	Any INCLUDED files from which the current include nested may
	be left open: this will change in future revisions of JAX4TH.

	Size of string buffer used by S":
		256 chars.

	FILE EXT:

	Word set not implemented in this revision

	FLOAT:

	Word set not implemented in this revision.

	FLOAT EXT:

	Word set not implemented in this revision.

	LOCALS:

	Word set not implemented in this revision.

	LOCALS EXT:

	Word set not implemented in this revision.

	MEMORY:

	ior for ALLOCATE is -1 for failure of any kind.

	ior for FREE is always success (0); nonetheless, the handle
	passed to FREE had better be valid or the system will crash.

	ior for RESIZE is -1 for failure of any kind.

	There is a variable MEM-TYPE. If MEM-TYPE is zero, ALLOCATE
	and RESIZE will request MEMF_CLEAR of Amiga Exec. IF MEM-TYPE
	is non-zero, memory of the type indicated by the bitmask (conforming
	to Amiga Exec documentation) contained in MEM-TYPE will be
	requested.

	MEMORY EXT:

	Due to multitasking nature of Amiga operating system, the value
	returned by AVAILABLE may differ from the actual amount of memory
	available at the next ALLOCATE or RESIZE.

	There is a variable MEM-TYPE. If MEM-TYPE is zero, AVAILABLE
	will request MEMF_CLEAR of Amiga Exec. IF MEM-TYPE is non-zero,
	memory of the type indicated by the bitmask (conforming
	to Amiga Exec documentation) contained in MEM-TYPE will be
	requested.

	SEARCH:

	Max number of wordlists is search order:
		8.

	Structure of a wordlist:

		/thread0/thread1/thread2/thread3/voclink/

	where  threadx  is the backpointer to a link field itself
	containing a backpointer to a link field (or zero, if end of
	chain) of a link chain hashed on the first letter of the
	wordname && 03 and where  voclink  is a backpointer to a
	previously-defined wordlist (or zero, if no previously-defined
	wordlists).

	SEARCH EXT:

	ORDER prints a list of wids in the current base.

	STRING:

	None noted on perusal of dpANS-2.

	STRING EXT:

	None noted on perusal of dpANS-2.

	TOOKIT:

	Word set not implemented in this revision.

	TOOLKIT EXT:

	Word set not implemented in this revision.

Default signed division algorithm and mechanism for invoking alternate
algorithm:

	Default is floored.

	To invoke alternate, redefine such words as /MOD */MOD / MOD etc.
	in terms of SM/REM.

System dictionary space used in address units:

	Approximately 16K.

Application data space available in address units:

	Default is 8K. (JAX4TH is designed to allow saving a data image
	of an expanded size for reload and extended usage).

Stack space in cells:

	Default is 512 cells.

Return stack space in cells:

	Default is 488 cells.

Operator's terminal facilities available:

	Amiga NEWCON:

Duration of a system clock tick:

	1/50 second.

Repeatability to be expected from the execution of MS:

	MS is implemented in terms of the AmigaDOS Delay() function which
	executes in multiples of system clock ticks (1/50 second). The Amiga's
	multitasking operating system has a non-repeatable impact upon Delay()
	depending on such factors as disk access, user resizing of GUI windows,
	etc. If the system, disk drive and user are all relatively calm,
	Delay() should return within about +0 to +10 ticks of the value passed
	to it by MS.
	
System action taken upon each of the general or specified error or
ambiguous conditions as identified in the standard:

CORE:

Word not found by "tick" ( ' ) :
	ABORT and display a message.

Word found by "tick" (') has C attribute:
	Return execution token for appropriate compiler word bearing
	name of desired construct.

Division by zero at */ */MOD :
	Return -1 quotient (-1 modulus).

Quotient outside range of single-cell signed integer at */ or */MOD :
	Ignore and continue

Address of next available data cell not aligned for "comma" ( , ):
	Motorola word-align silently.

Divisor is zero at / or /MOD :
	Return -1 quotient (-1 modulus)

Overflow of ud2 in >NUMBER :
	Ignore and continue.

Count of >32,767 passed to ACCEPT :
	ACCEPT in JAX4TH can take a count of up to ((2^31)-1).

FM/MOD divides by zero:
	Return -1 -1.

FM/MOD quotient outside range of single-cell signed integer:
	Ignore and continue.

MOD divides by zero:
	Return -1

"name" not found at POSTPONE :
	Abort and display a message.

SM/REM divides by zero:
	Return -1 -1.

SM/REM quotient outside range of single-cell signed integer:
	Ignore and continue.

UM/MOD divides by zero:
	Return -1 -1.

UM/MOD quotient outside range of single-cell unsigned integer:
	Ignore and continue.

"name" not found by ['] :
	Abort and display message.

CORE EXT:

:NONAME executed while in compilation state:
	Ignore and continue: a valid execution token for  :NONAME  is compiled.

n1|u1 and n2|u2 not of same type at ?DO :
	Ignore and continue.

COMPILE, executed while intepreting:
	Ignore and continue.

Overflow of ud2 in CONVERT :
	Ignore and continue.

Less than u+2 entries on stack before ROLL is executed:
	Ignore and continue.

name not found at [COMPILE] :
	Abort with message.

BLOCK:

Correct BLOCK read not possible:
	ABORT and display a message.

Invalid BLOCK number:
	ABORT and display a message.

I/O Error in BLOCK transfer:
	ABORT and display a message.

DOUBLE:

d lies outside the range of signed single-cell number at D>S :
	Ignore and continue.

+n2 is zero at M*/ :
	Return double-precision -1.

M*/ quotient outside the range of a double-precision signed integer:
	Ignore and continue.

DOUBLE EXT:

Unaligned address passed to D@ or D! :
	System word-aligns all address passed to D@ and D! to prevent
	system crash.

FACILITY EXT:

AT-XY can't be performed on current output device with specified parameters:
	Whatever AmigaDOS does with the arguments passed in the console string.
	Reasonably harmless.

FILE:

READ-FILE initiated when the value returned by FILE-POSITION is greater
than the value returned by FILE-SIZE :
	Return -- 0 0 0 just as for the case when the value returned
	by FILE-POSITION is the same as the value returned by FILE-SIZE .

Attempt by READ-FILE to read portions of the file not written:
	If not covered by a past-end-of-file case, the result will be
	random data being read into the specified buffer.

READ-LINE initiated when the value returned by FILE-POSITION is greater
than the value returned by FILE-SIZE :
	Return -- 0 0 0 just as for the case when the value returned
	by FILE-POSITION is the same as the value returned by FILE-SIZE .

Attempt by READ-LINE to read portions of the file not written:
	If not covered by a past-end-of-file case, the result will be
	random data being read into the specified buffer.

Attempt to REPOSITION-FILE outside the file boundaries:
	There will be an error return in  ior  .

SEARCH:

Changing compilation worldlist during compilation:
	Integrity of dictionary will be compromised thereby.

Changing compilation wordlist between definition of a word and modification
of that word's behaviour via DOES> or IMMEDIATE :
	Integrity of dictionary may thereby be compromised.

SEARCH EXT:

Too many wordlists in search order for ALSO :
	The wordlist at the end of the search order disappears from
	the search order (otherwise harmless).

Search order empty before PREVIOUS :
	Search order remains empty.

Non-Compliance, Questionable Compliance
---------------------------------------
In the following areas, JAX4TH is non-compliant with dpANS or in questionable
compliance:

6.1.1345 ENVIRONMENT? current returns the ( -- false) "don't-know" answer
to all queries. While this is apparently legal in the CORE, it is of
dubious legal for extension word sets. Support of ENVIRONMENT? queries is
low on the author's priority list, right above making << 11.1.0080 ( >>
span multiple lines of a file.

11.1.2180 BLOCK currently doesn't remember which file a given BLOCK came
from and will write UPDATEd BLOCKs to the file represented by the contents
of BLOCK-FID even if that value has changed since the BLOCK was read into
a BUFFER ...  This will be fixed in future releases.

11.1.0080 ( "paren" is non-conforming in that it does not span multiple
lines of a text file. This will be fixed in future releases.

11.1.2147 RESIZE-FILE is non-conforming: it merely discards the arguments
and returns TRUE. This may be fixed in future releases. The author deems
this construct not terribly useful on the Amiga, and is open to comment.

The dpANS document describes a case-sensitive FORTH in which all standard
words are defined in UPPERCASE. This does not prevent a Standard Program
from defining lowercase words, nor does it prevent a Standard System from
providing a switch that offers case-insensitivity (though a Standard Program
would have to declare an environmental dependency if it counted on such
a switch being present).

Currently, the IMPLEMENTOR VARIABLE named CAPS is set ON at bootup (TRUE).
Thence all input is converted to UPPERCASE. Set CAPS OFF (FALSE) if you
wish case-sensitivity. Future revisions of JAX4TH will feature switchable
truly case-insensitive searches, with the default being case-sensitive.

Hardware and Operating System Requirements
------------------------------------------
An Amiga 500/1000/2000 and Commodore Amiga Enhancer 1.3.

(Tested under an early release 2.0 of the Amiga operating system on an
Amiga 1000 also, ran ok.)

STACK must be at least the AmigaDOS default 4000 bytes for JAX4TH to run.

Resources
---------
JAX4TH's resident kernel occupies about 25K of memory. The DEFIMAGE.JX4
provided with this distribution will occupy another 16K for each instance
of JAX4TH which is running. In addition, each instance of JAX4TH allocates
a buffer of a little more than 6K for file handling internals.

AmigaDOS stack depth should be at least 4000 before each invocation of
JAX4TH.

Partitioning of System
----------------------

JAX4TH when loaded and running actually is three separate segments:

	- the KERNEL segment, which is made resident by typing

		RESIDENT JX4:JAX4TH

	from the AmigaDOS prompt;

	- the CODE segment, which contains the instance-local dictionary;

	- the DATA segment, which contains variable bodies, CREATE objects,
	strings, arrays, etc.

Addresses in JAX4TH which are accessible to a standard program are all
DATA segment addresses. If passed to Amiga operating system calls, DATA
segment addresses must be converted to absolute addresses via the 
IMPLEMENTOR wordlist word  DATA>ABS  ( DSeg-addr -- Abs-addr).

(Note that the above arrangement as regards compiled character strings has
the side effect that strings compiled into the dictionary via ." S" and C"
are modifiable. This behaviour is not forbidden by dpANS, but a Standard
Program may not take advantage of modifiability of strings compiled into
the dictionary without declaring an environmental dependency on same.)

Generally no address from the KERNEL or CODE segment is passed into or
out of a JAX4TH program. Rather, KERNEL and CODE tokens, the implementation
of which may change in any revision, are manipulated symbolically via words
provided in the FORTH and IMPLEMENTOR wordlists.

Calling the Amiga Operating System from JAX4TH
----------------------------------------------
The word  CALL ( offset lib-var -- return)  in the IMPLEMENTOR wordlist allows
calls to the Amiga operating system, in conjunction with two other IMPLEMENTOR
words,  >DREG ( value dreg# --)  and  >AREG ( value areg# --)  .

Use  >DREG  and  >AREG  to set up registers, then place the library volume
offset on the stack topped with a variable containing an Amiga pointer
to an open library and execute  CALL  . This sequence may also be compiled
into a colon definition.

CALL  saves a number of Forth system registers and loads D0-D6/A0-A5 with
the contents of an object named  ARGARRAY .  ARGARRAY is loaded by  >DREG
and  >AREG  and any value thus loaded remains in  ARGARRAY until changed,
e.g., by a subsequent  >DREG  or  >AREG  operation.  CALL  then pops
JAX4TH-relative variable address on top of the stack and fetches the
library pointer into A6, then jumps to Amiga library entry specified by
0(A6,TOS.L). Upon return,  CALL  places the return passed in D0 by the Amiga
call on top of the stack.

Remember to convert DATA segment addresses to absolute Amiga addresses
when making system calls!

Here is an example of using  CALL  and its helpers:

	DECIMAL

	VARIABLE MY-FILE

	: AA ( --)
		S" RAM:FOO" NEWFILE CREATE-FILE
		ABORT" Couldn't create file."
		MY-FILE !
	;

	\ See AmigaDOS Library call: Write() d1/d2/d3
	: BB ( -- n)
		MY-FILE @
		1 >DREG		\ D1 := file pointer
		S" Hi Mom!"
		SWAP DATA>ABS	\ Convert string address to abs address
		2 >DREG		\ D2 := write buffer address
		3 >DREG		\ D3 := count of bytes to write
		-48		\ Write() is offset -48 in DOS Library
		DOS		\ JAX4TH system var, holds DOS lib ptr
		CALL		\ returns #bytes-written
	;

	MY-FILE @ CLOSE-FILE DROP

	\ End of example

See the JAX4TH.WORDS file within the current distribution for up-to-revision
information on these and other IMPLEMENTOR words.

Saving an Image for Reload
--------------------------
JAX4TH local images, both code and data portion, may be saved to an image
file for command-line reloading later. Remember that the program JAX4TH
itself is only the RESIDENT-able kernel of the system. A number of different
local images may be running at any time off of the same RESIDENT image if
you have made JAX4TH resident. (At any time you may use the word INSTANCES
to obtain the number of active images currently running off of the JAX4TH
kernel the current image is using. See JAX4TH.WORDS for an explanation of
INSTANCES).

Furthermore, a saved JAX4TH image may be programmed to automatically start
executing a word after loading. Saving an image is effected via the word
SAVE-IMAGE ( c-addr ct --) and auto-execution is enabled via the AUTOSTART
variable.

Here is an example session once JAX4TH is loaded with the default image.

	\ A word to execute at load.
	: TEST BEGIN ." FOO " KEY? UNTIL ;
	\ Now save the vector to AUTOSTART itself.
	' TEST AUTOSTART !
	\ Now save the image.
	S" JX4:MY-IMAGE.JX4" SAVE-IMAGE
	BYE

To reload this image, use the CLI command line:

	1> JAX4TH JX4:MY-IMAGE.JX4

and your image will load and begin executing TEST . After you stop TEST
by pressing return (since no KEY will be passed by the Amiga NEWCON:
device to JAX4TH until a <RET> is pressed), the JAX4TH logo will be
displayed and JAX4TH will return to the interpreter.

Currently, a saved image file can be no longer in either its code or
data segment than the supplied default file DEFIMAGE.JX4. A file named
DEFIMAGE.JX4 must be found in the JX4: logical device for SAVE-IMAGE to
function. See the entry for SAVE-IMAGE in JAX4TH.WORDS.

<< End of JAX4TH.DOC >>
