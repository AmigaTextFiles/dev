# SAS/C PPC makefile for powerUP (TM)
# written by Andreas R. Kleinert in 1998

CC = SCPPC

test :          forth.core forth

forth :         forth.o prims.o
                ppc-amigaos-ld -r lib:c_ppc.o forth.o prims.o LIB:scppc.a lib:end.o -o forth.elf

forth.o :       forth.c common.h forth.h prims.h
                $(CC) forth.c

prims.o :       prims.c forth.h prims.h
                $(CC) prims.c

all :           forth forth.core l2b b2l

nf :            nf.o lex.yy.o
                ppc-amigaos-ld -r lib:c_ppc.o nf.o lex.yy.o LIB:scppc.a lib:end.o -o nf.elf

nf.o :          nf.c forth.lex.h common.h
                $(CC) nf.c

lex.yy.o :      lex.yy.c forth.lex.h
                $(CC) lex.yy.c

# not supported, don't delete forth.lex !
lex.yy.c :      forth.lex
                -mv lex.yy.c lex.yy.c.old
                lex forth.lex
                rm -f lex.tmp
                sed "s/yylex(){/TOKEN *yylex(){/" lex.yy.c > lex.tmp
                mv -f lex.tmp lex.yy.c

forth.core :    nf forth.dict
                runelf nf.elf < forth.dict


# not needed

# l2b : convert a line file to a block file. Usage: l2b < linefile > blockfile
l2b :           l2b.c
                $(CC) -o l2b l2b.c

# b2l: convert a block file to a line file. Usage: b2l < blockfile > linefile
b2l :           b2l.c
                $(CC) -o b2l b2l.c
