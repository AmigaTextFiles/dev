®PT5¯®LS1.3¯®OF8¯®RM66¯®FD66¯®TP2¯®PL58,62,56¯®OP4¯®WD4¯®RFA®LS1¯®FC¯-®PN¯-

®FL¯

¯
®FC¯
®MDUL¯Using J's Boxed Arrays®MDNM¯

Donald B. McIntyre
Luachmhor, Church Road
Kinfauns, Perth PH2  7LD
Scotland - U.K.
Telephone:  0738-86-726

®FL¯
®MDUL¯Introduction®MDNM¯:

APL, which has been an implemented computer language for more than 25 years, grew out of the concise mathematical notation devised by Kenneth Iverson.   J is his powerful new dialect [1].   He has defined it in a Dictionary that is an essential reference [2].   Iverson has extended the language in interesting ways.   He has also rationalised features which, benefiting from so many years of hindsight, he recognised as anomalies in earlier versions of APL.   Users accustomed to APL can therefore expect to be puzzled by changes of behaviour.   For example, the sum over a table (®MDBR¯+/ table®MDNM¯) formerly gave ®MDBR¯row®MDNM¯ totals (summing over the ®MDBR¯last axis®MDNM¯), but the same expression in J gives ®MDBR¯column®MDNM¯ totals (summing over the first axis).   The reason is that the table is considered an array of ®MDBR¯items®MDNM¯, each row being an item.   The number of items is given by the ®MDBR¯tally®MDNM¯ (#) or by the first number or ®MDBR¯head®MDNM¯ ({.) of the ®MDBR¯shape®MDNM¯ ($);  a 4 by 12 table (matrix) is looked on as a collection of 4 lists (vectors), each of length 12.   Consequently the mean (sum divided by tally) is the sum down the columns (across the items) divided by the number of rows.

The use of square brackets and semicolon in indexing is anomalous;  e.g. expressions such as  ®MDBR¯V[I]®MDNM¯ or ®MDBR¯M[I;J]®MDNM¯ do not have the syntax of other verbs (®MDBR¯functions®MDNM¯).   J uses normal syntax;  e.g.  ®MDBR¯i { v®MDNM¯ (which can be read as "i ®MDBR¯from®MDNM¯ v").   In higher rank objects, which need pairs (or triplets, etc) of indexes to identify one atom in the array, the syntax is the same, but indexes identifying a single cell are ®MDBR¯boxed®MDNM¯ together.   Examples follow.

Thinking that my experience with J might help others, I have given accounts of various applications [4-7].   This further example describes one of my first attempts -- the use of boxes to create a small database.   Eugene McDonnell responded to my questions in a helpful letter, which I included in my paper for APL91 [4].


®MDUL¯Basic Techniques Relating to Boxes:®MDNM¯:

APL's index generator (®MDBR¯iota®MDNM¯) has been extended:
   ]a=. i.2 3
0 1 2
3 4 5

After being ®MDBR¯boxed®MDNM¯, this table of 2 rows (each of length 3) behaves as an atom (scalar):
   $a
2 3
   ]b=. <i.2 3
ÚÄÄÄÄÄ¿
³0 1 2³
³3 4 5³
ÀÄÄÄÄÄÙ
   $b

   
Boxes also result from ®MDBR¯link®MDNM¯ (;) 
   ]c=. 'mary';'jones';a; 1 3 5
ÚÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄ¿
³mary³jones³0 1 2³1 3 5³
³    ³     ³3 4 5³     ³
ÀÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÙ
From this list of 4 items we can make a selection:
   $c
4
   3 1 2 0{c
ÚÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄ¿
³1 3 5³jones³0 1 2³mary³
³     ³     ³3 4 5³    ³
ÀÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÙ
   
Individual words are boxed by ®MDBR¯word formation®MDNM¯ (;:)
   ;:s=. 'here we go gathering nuts in may'
ÚÄÄÄÄÂÄÄÂÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÂÄÄÂÄÄÄ¿
³here³we³go³gathering³nuts³in³may³
ÀÄÄÄÄÁÄÄÁÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÁÄÄÁÄÄÄÙ
The length of each word is found by applying ®MDBR¯tally under open®MDNM¯;  i.e. each box is opened, the tally is taken, and the box is closed again.   ®MDBR¯under®MDNM¯ (&.) is a conjunction, in this case combining ®MDBR¯tally®MDNM¯ (#) and ®MDBR¯open®MDNM¯ (>).
    wl=. #&.>@;:
®PG¯
    wl s
ÚÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
³4³2³2³9³4³2³3³
ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
   
If ®MDBR¯f®MDNM¯, ®MDBR¯g®MDNM¯, ®MDBR¯h®MDNM¯ are verbs to be applied to a list of numbers, y, then
   (f g h) y   is the same as    (f y) g (h y)

This train of three verbs is called a ®MDBR¯fork®MDNM¯, and the ®MDBR¯mean®MDNM¯ is an example [4-7].   The average word-length is found by applying the verb ®MDBR¯mean®MDNM¯ after opening the boxes containing word-lengths.
   mean=. +/%#
   mean > wl s
3.71429

Or, defining the verb ®MDBR¯mwl®MDNM¯ we get the mean word-length of any string.   This is a ®MDBR¯tacit®MDNM¯ definition, a pure functional form, with no explicit reference to the arguments.
   mwl=. mean@(>@wl)       NB.  Parentheses are required!
   mwl s
3.71429
   
When we open a list of boxes we get a table:
   > ;:s
here     
we       
go       
gathering
nuts     
in       
may      

The table is alphabetised by the dyadic verb ®MDBR¯sort®MDNM¯ (/:) using the adverb ®MDBR¯both®MDNM¯ (~) so that the left and right arguments are the same.
   sort=. /:~@(>@;:)     NB.  Parentheses are required!
   sort s
gathering
go       
here     
in       
may      
nuts     
we       
   
We must distinguish between boxing the list as a whole and boxing the individual items.   The ®MDBR¯rank®MDNM¯ conjunction (") instructs the ®MDBR¯box®MDNM¯ verb to enclose elements of specified rank (in this case  ®MDBR¯atoms®MDNM¯):
   v=. 2 3.4 5.67
   <"0 v
ÚÄÂÄÄÄÂÄÄÄÄ¿
³2³3.4³5.67³
ÀÄÁÄÄÄÁÄÄÄÄÙ
The items (in this case individual numbers) are made into vectors (raised from rank-0 to rank-1) by ®MDBR¯ravel item®MDNM¯ (,.)
   ,. v
   2
 3.4
5.67
   
A rank-3 array can be boxed with any rank from 0 to 3:
   ]m=. i.2 3 4
 0  1  2  3
 4  5  6  7
 8  9 10 11

12 13 14 15
16 17 18 19
20 21 22 23
   <"2 m
ÚÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄ¿
³0 1  2  3³12 13 14 15³
³4 5  6  7³16 17 18 19³
³8 9 10 11³20 21 22 23³
ÀÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÙ
   <"1 m
ÚÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄ¿
³0 1 2 3    ³4 5 6 7    ³8 9 10 11  ³
ÃÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄ´
³12 13 14 15³16 17 18 19³20 21 22 23³
ÀÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÙ

®PG¯
®MDUL¯Construct a Simple Database®MDNM¯:

Use "link" (;) to create the database as an array of boxed elements:
   d=.,:'E.E.';'McDonnell';'Palo Alto';27;10000; 8 3 12 25 10
   d=.d,'Ken';'Iverson';'Toronto';55;15000; 4 19 32 1 15 10
   d=.d,'Donald';'McIntyre';'U.K.';61;12000;''
   d=.d,'Roger';'Hui';'Toronto';49;20000; 32 4
   d=.d,'Anthony';'Camacho';'U.K.';45;35000; 19 23 45 4 17 13 5
   d
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³E.E.   ³McDonnell³Palo Alto³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto  ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.     ³61³12000³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto  ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho  ³U.K.     ³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

The columns can be taken as ®MDBR¯First Name®MDNM¯, ®MDBR¯Family Name®MDNM¯, ®MDBR¯Location®MDNM¯, ®MDBR¯Age®MDNM¯, and ®MDBR¯Salary®MDNM¯.   The final column illustrates a ragged array with one empty cell.   (The content of the database is fictitious.)

We can extract columns:
   col=. >@{"1
   locality=. 2&col
   locality d
Palo Alto
Toronto  
U.K.     
Toronto  
U.K.     
   
Pronouns might be convenient:
   name=. 1 [ age=. 3 [ salary=. 4
   
Because x is sorted into an order specified by y,  ®MDBR¯x /: y®MDNM¯  is the same as  ®MDBR¯(/:y) { x®MDNM¯  See [2]:
   sort=. ] /: col          NB.   Fork

It is important to remember that ®MDBR¯right®MDNM¯ (]) and ®MDBR¯left®MDNM¯ ([) are verbs and not merely placeholders;  they take arguments and produce results.

   name sort d
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³Anthony³Camacho  ³U.K.     ³45³35000³19 23 45 4 17 13 5³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto  ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto  ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³E.E.   ³McDonnell³Palo Alto³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.     ³61³12000³                  ³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

   salary sort d
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³E.E.   ³McDonnell³Palo Alto³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.     ³61³12000³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto  ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto  ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho  ³U.K.     ³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

To sort on the basis of the ragged column (5), we might use the  mean:
   mean age col d
47.4
   mean salary col d
18400
   
Using ®MDBR¯under®MDNM¯ to define the adverb ®MDBR¯each®MDNM¯
   each=. &.>
   meanr=. mean each@(5&{"1)     NB.  Means in ragged column 5
   meanr d
ÚÄÄÄÄÂÄÄÄÄÂÄÂÄÄÂÄÄ¿
³11.6³13.5³0³18³18³
ÀÄÄÄÄÁÄÄÄÄÁÄÁÄÄÁÄÄÙ

Sorting on the basis of the means in the ragged column, and appending the means:
   sortr=. ] /: >@meanr
   sortr d,"1 0 meanr d
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄ¿
³Donald ³McIntyre ³U.K.     ³61³12000³                  ³0   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄ´
³E.E.   ³McDonnell³Palo Alto³27³10000³8 3 12 25 10      ³11.6³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄ´
³Ken    ³Iverson  ³Toronto  ³55³15000³4 19 32 1 15 10   ³13.5³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄ´
³Roger  ³Hui      ³Toronto  ³49³20000³32 4              ³18  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄ´
³Anthony³Camacho  ³U.K.     ³45³35000³19 23 45 4 17 13 5³18  ³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÙ
   
Append (,"1 0) is performed here so that rank-1 cells (rows) on the left are joined to rank-0 cells (atoms) on the right.

To display the data on people at a given locality, apply the adverb ®MDBR¯each®MDNM¯ to the verb ®MDBR¯match®MDNM¯ (-:).   Because the data are boxed, the search-key must be boxed too.   ®MDBR¯Copy®MDNM¯ (the dyadic #) does the same as ®MDBR¯compress®MDNM¯ or ®MDBR¯replicate®MDNM¯ in older APL.   The adverb ®MDBR¯cross®MDNM¯ (~) interchanges the arguments, thus cutting down on parentheses:

   d #~ >(<'Toronto') -: each 2{"1  d
ÚÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³Ken  ³Iverson³Toronto³55³15000³4 19 32 1 15 10³
ÃÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger³Hui    ³Toronto³49³20000³32 4           ³
ÀÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

The following verb makes selections easier:
   place=. ] #~ >@(<@[ -: each 2&{"1 @ ])
   
   'U.K.' place d
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³Donald ³McIntyre³U.K.³61³12000³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho ³U.K.³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

®PG¯
®MDUL¯Replacement and Insertion®MDNM¯:

We first assign a "linear index" to each cell:
      i. $ d
 0  1  2  3  4  5
 6  7  8  9 10 11
12 13 14 15 16 17
18 19 20 21 22 23
24 25 26 27 28 29

      li=. [ { i.@$@]      NB.  Linear Index.   Fork

      1 4 li d             NB.  Rows 1 and 4
 6  7  8  9 10 11
24 25 26 27 28 29

      (<2 5) li d    NB.  Linear index of cell at row 2 and column 5
17

      (2 5;4 2) li d     NB.  Scattered indexing
17 26

The verb ®MDBR¯from®MDNM¯ ({) is used to select information.   Placing information into an existing cell is a more complicated process.   We use the adverb ®MDBR¯amend®MDNM¯ (}), and we need three pieces of information:  the array to be changed;  the indexes identifying the affected cells;  and the new data to be inserted.

The indexes will normally be computed from the data, but we can arbitrarily select any cell;  e.g. to place an array into the cell at row-2 column-5:

   x=. 9 8 7 6,:5 4 3 2
   (<x) ((<2 5) li d)}d
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³E.E.   ³McDonnell³Palo Alto³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto  ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.     ³61³12000³9 8 7 6           ³
³       ³         ³         ³  ³     ³5 4 3 2           ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto  ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho  ³U.K.     ³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
  
Scattered indexing presents no problem: 
   (x;'London') ((2 5;4 2)li d)} d
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³E.E.   ³McDonnell³Palo Alto³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto  ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.     ³61³12000³9 8 7 6           ³
³       ³         ³         ³  ³     ³5 4 3 2           ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto  ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho  ³London   ³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ


®MDUL¯Expansion in General, and a Digression on Reading J®MDNM¯:
   
To insert new items (new rows) the database must be expanded.   In older APL the back-slash (\) was used along with a boolean string (®MDBR¯U®MDNM¯), as in ®MDBR¯U\[0]D®MDNM¯ to expand along the first axis. J uses the back-slash for other operations, but Iverson has defined a verb that performs the operation of expansion [4]:

      exp=. /:@\:@[{#@[{.]
      1 0 1 exp 7 8
7 0 8

To someone unfamiliar with the notation, this expression is, of course, incomprehensible.   This, however, is not a reason for supposing it to be difficult.   Parse any sentence as a step towards understanding it.   Characters immediately followed by a period (.) or a colon (:) are taken as 2-character symbols.   Make this clear by inserting spaces and note the sequence of 11 symbols:
      exp=. /: @ \: @ [ { # @ [ {. ]

Square brackets ([) and (]) are not punctuation symbols (as round parentheses are), but verbs returning their ®MDBR¯left®MDNM¯ and ®MDBR¯right®MDNM¯ arguments respectively.

There being no adverbs (mondadic operators), next identify ®MDBR¯conjunctions®MDNM¯ (dyadic operators) -- in this case only ®MDBR¯atop®MDNM¯ (@) -- and insert parentheses to show that a conjunction combines the item (verb or noun) on either side of it to compose a new verb.   Put the right parentheses in first:
      exp=. /: @\:) @ [) { # @[) {. ]

Conjunctions have long left-scope and short right-scope;  for this reason, put in the left parentheses while working from left to right.   Confirm that this gives the same result as before.
      exp=. ((/:@\:)@[) { (#@[) {. ]

The expressions enclosed in parentheses are new verbs resulting from the composition of simple verbs, consequently we can now view the definition as a sequence of 5 verbs:

      p=. /:@\:@[
      q=. {
      r=. #@[
      s=. {.
      t=. ]

      1 0 1 (p q r s t) 7 8
7 0 8

Such a sequence of verbs previously had no meaning.   Iverson calls it a ®MDBR¯train®MDNM¯:  "an isolated sequence of parts of speech that does not resolve to a shorter sequence through the normal application of verbs" [2, p.5].   He assigns meanings to trains of two verbs (®MDBR¯hooks®MDNM¯) and three verbs (®MDBR¯forks®MDNM¯), and by repeated resolution to any train of verbs [2, 8, 9].   Thus
      (s t)            NB.   Hook
ÚÄÂÄ¿
³s³t³
ÀÄÁÄÙ
      (r s t)          NB.   Fork
ÚÄÂÄÂÄ¿
³r³s³t³
ÀÄÁÄÁÄÙ
      (q r s t)        NB.   Hook containing a Fork
ÚÄÂÄÄÄÄÄÄÄ¿
³q³ÚÄÂÄÂÄ¿³
³ ³³r³s³t³³
³ ³ÀÄÁÄÁÄÙ³
ÀÄÁÄÄÄÄÄÄÄÙ
      (p q r s t)      NB.   Fork containing a Fork
ÚÄÂÄÂÄÄÄÄÄÄÄ¿
³p³q³ÚÄÂÄÂÄ¿³
³ ³ ³³r³s³t³³
³ ³ ³ÀÄÁÄÁÄÙ³
ÀÄÁÄÁÄÄÄÄÄÄÄÙ


J provides two tools for investigating parsing.   The directly displayed form shows a fork within a fork:
   exp
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³ÚÄÄÄÄÄÄÄÄÄÂÄÂÄ¿³{³ÚÄÄÄÄÄÄÄÂÄÄÂÄ¿³
³³ÚÄÄÂÄÂÄÄ¿³@³[³³ ³³ÚÄÂÄÂÄ¿³{.³]³³
³³³/:³@³\:³³ ³ ³³ ³³³#³@³[³³  ³ ³³
³³ÀÄÄÁÄÁÄÄÙ³ ³ ³³ ³³ÀÄÁÄÁÄÙ³  ³ ³³
³ÀÄÄÄÄÄÄÄÄÄÁÄÁÄÙ³ ³ÀÄÄÄÄÄÄÄÁÄÄÁÄÙ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

The conjunction (5!:4) displays a tree representation:
      tree=. 5!:4 @ <
      f=. p q r s t
      tree 'f'
      ÚÄ p      
      ÃÄ q      
Ä f ÄÄ´    ÚÄ r 
      ÀÄÄÄÄÅÄ s 
           ÀÄ t 

   tree 'exp'
                    ÚÄ /: 
              ÚÄ @ ÄÁÄ \: 
        ÚÄ @ ÄÁÄ [        
        ÃÄ {              
Ä exp ÄÄ´           ÚÄ #  
        ³     ÚÄ @ ÄÁÄ [  
        ÀÄÄÄÄÄÅÄ {.       
              ÀÄ ]        

In reading the tree, remember that the conjunction ®MDBR¯atop®MDNM¯ (@) makes verbs.   Hooks and forks, on the other hand are trains of verbs.

Returning to the original form without parentheses:
      exp=. /: @ \: @ [ { # @ [ {. ]

In Iverson's words:  "Notice how this tacit definition reads in English.   The inverse of the downgrade of the left argument permutes the (over)take of the right argument by the number of items of the left argument" [4, p.270].

Had an adverb (a monadic operator) been present, we would have inserted parentheses to show that it modified the verb to its left.   This is illustrated by the adverb ®MDBR¯each®MDNM¯ in the verb ®MDBR¯meanr®MDNM¯, which we used to compute the means of the ragged items in column 5:
   meanr=. mean each @ (5&{"1)

Note first that parentheses are required to prevent the ®MDBR¯atop®MDNM¯ (@) from grabbing the 5 to its right.   Next, the conjunction ®MDBR¯with®MDNM¯ (&) takes the 5 on its left along with the verb ®MDBR¯from®MDNM¯ ({) on its right to compose a new verb.   The ®MDBR¯rank®MDNM¯ conjunction (") takes this composed verb (including the 5 that is part of it) and combines it with the noun (1) to its right.   The result (5&{"1) is a verb that returns the fifth column of the array to which it applies.

®MDBR¯each®MDNM¯ is a defined adverb, which, like any other adverb, modifies the verb to its left (®MDBR¯mean®MDNM¯) to compose a new verb (®MDBR¯mean each®MDNM¯).   This verb is the left argument of the conjunction ®MDBR¯atop®MDNM¯.

Had we defined ®MDBR¯meanr®MDNM¯:
   meanr=. +/%# each @ (5&{"1)

then ®MDBR¯each®MDNM¯ would have modified ®MDBR¯tally®MDNM¯ (#) alone, and the definition would have been parsed as a fork, which would have been quite wrong:
   (+/) % (# each @ (5&{"1))


®MDUL¯Adding New Items to the Database®MDNM¯:

First expand the array:
   ] e=. 1 0 1 1 0 1 1 exp d
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³E.E.   ³McDonnell³Palo Alto³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³       ³         ³         ³  ³     ³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto  ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.     ³61³12000³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³       ³         ³         ³  ³     ³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto  ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho  ³U.K.     ³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
   
Then amend by inserting the new items one at a time:
   t=. e (1 li d)}~  'Bob';'Bernecky';'Toronto';35;22000; 4 5
   t (4 li d)}~  'Graham';'Woyka';'U.K.';62;35000; 14 31 5 7

ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³E.E.   ³McDonnell³Palo Alto³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Bob    ³Bernecky ³Toronto  ³35³22000³4 5               ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto  ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.     ³61³12000³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Graham ³Woyka    ³U.K.     ³62³35000³14 31 5 7         ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto  ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho  ³U.K.     ³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
   
Or define another array, from which to amend the original by merging several items in one step:
x=.('Graham';'Woyka';'U.K.';1;2;3),:'Vin';'Grannell';'Los Angeles';4;5;6 7 8
   
   x (1 4 li d)} e
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³E.E.   ³McDonnell³Palo Alto  ³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Graham ³Woyka    ³U.K.       ³1 ³2    ³3                 ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto    ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.       ³61³12000³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Vin    ³Grannell ³Los Angeles³4 ³5    ³6 7 8             ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto    ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho  ³U.K.       ³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
   
Or, finally, amend the database by merging a selection from another database with equivalent fields:
   e (1 4 li e)}~ 1 0{ x
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³E.E.   ³McDonnell³Palo Alto  ³27³10000³8 3 12 25 10      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Vin    ³Grannell ³Los Angeles³4 ³5    ³6 7 8             ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Ken    ³Iverson  ³Toronto    ³55³15000³4 19 32 1 15 10   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Donald ³McIntyre ³U.K.       ³61³12000³                  ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Graham ³Woyka    ³U.K.       ³1 ³2    ³3                 ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Roger  ³Hui      ³Toronto    ³49³20000³32 4              ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÅÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Anthony³Camacho  ³U.K.       ³45³35000³19 23 45 4 17 13 5³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ


®MDUL¯Acknowledgements®MDNM¯:

Kenneth Iverson and Roger Hui provided the language and the system.   I am particularly indebted to Kenneth Iverson and Eugene McDonnell for sharing their trenchant insight at crucial points in my experience with J.

®MDUL¯References®MDNM¯
®IP4,10¯®TS10¯
[1]	J is available from Iverson Software Inc., 33 Major Street, Toronto, Ontario, Canada M5S  2K9.   Phone (416) 925-6096; Fax (416) 488-7559.   This paper was submitted in November 1991.   The examples, originally executed with J Version 3.3 have been revised for compatibility with Version 4.2.

[2]	Kenneth E. Iverson, ®MDBR¯ISI Dictionary of J®MDNM¯, Version 4 with Tutorials, Iverson Software Inc., Toronto (1991) 34pp.

[3]	Kenneth E. Iverson, ®MDBR¯Arithmetic®MDNM¯, Iverson Software Inc., Toronto (1991) 119pp.

[4]	Donald B. McIntyre, ®MDBR¯Mastering J®MDNM¯, APL91 Conference Proceedings, Stanford, California, August 1991.   APL Quote Quad Vol. 21 Number 4 (August 1991), p.264-273.   This paper includes valuable statements by K.E. Iverson and E.E. McDonnell, for which I am grateful.

[5]	Donald B. McIntyre®MDNM¯, ®MDBR¯Language as an Intellectual Tool:  From Hieroglyphics to APL®MDNM¯, IBM Systems Journal, Vol. 30, Number 4 (1991) 554-581.

[6]	Donald B. McIntyre, ®MDBR¯Hooks and Forks and the Teaching of Elementary Arithmetic®MDNM¯, Vector, Vol. 8, Number 3 (January 1992) 101-123.

[7]	Donald B. McIntyre, ®MDBR¯Using J with External Data:  two examples®MDNM¯, Vector, Vol. 8, Number 4 (April 1992) 97-110.

[8]	Kenneth E. Iverson, and E.E. McDonnell, ®MDBR¯Phrasal Forms®MDNM¯, APL89 Conference Proceedings, New York City, August 1989.   QuoteQuad, Volume 19, Number 4, (1989) p.197-199.

[9]	Roger K.W. Hui, Kenneth E. Iverson, Eugene E. McDonnell, ®MDBR¯Tacit Definition®MDNM¯, APL91 Conference Proceedings, Stanford, California, August 1991.   APL Quote Quad Vol. 21 Number 4 (August 1991), p.264-273.
