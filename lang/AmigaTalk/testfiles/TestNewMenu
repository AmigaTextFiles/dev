('   Starting TestNewMenu code...') print

)i AmigaTalk:User/UserGUI.st

intuition  <- Intuition new

('   Setting up userGUI...') print

scr <- Screen new
scr setScreenModeID: 16r40D20042
scr open: 'Testing NewMenu Class:'

userGUI <- UserGUI new
userGUI setScreen: scr

menuStrip <- MenuStrip new: 3

menu1 <- NewMenu new: nil
menu2 <- NewMenu new: #testMenu
menu3 <- NewMenu new: nil

itemType <- intuition getGadToolAttr: #NM_ITEM

menuUserData <- #( itemType 'Test NewMenu handler' #testMenu 'T' 1 )

"menuUserData at: 1 put: itemType" " Interpreter does NOT do this properly (FIXED)! "

menu1 titleMenuArray: 'PROJECT'
menu2 menuItemArray: 'Test NewMenu handler' key: 'T' flags: 0 data: menuUserData
menu3 fillNewMenuItemWith: (menu3 endOfMenuArray)

menu1 addedTo: menuStrip
menu2 addedTo: menuStrip
menu3 addedTo: menuStrip

win <- Window new: 'Select the Menu Item (or use hotKey)...'

win setFlags:  ((intuition systemTag: #WFLG_ACTIVATE) \
              + (intuition systemTag: #WFLG_CLOSEGADGET))

win setIDCMPFlags:  ((intuition systemTag: #IDCMP_MENUPICK) \
                   + (intuition systemTag: #IDCMP_CLOSEWINDOW))

win openOnScreen: scr

userGUI setWindow: win

menu1 registerTo: win
menu2 registerTo: win
menu3 registerTo: win

menuStrip attachTo: win

userGUI addMenuSelection: menu2 named: 'Test NewMenu handler'

"userGUI    addMenuHotKey: $T       to: menu2 menu"

('   Starting the IDCMP loop...') print

scr screenToFront

userGUI startUp

scr screenToBack

('   IDCMP loop terminated!') print

menuStrip hide

win close
scr close

menu1 dispose
menu2 dispose
menu3 dispose

('   Done with TestNewMenu!') print
