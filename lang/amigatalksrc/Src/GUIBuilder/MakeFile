####################################################################
#
#             MAKEFILE FOR GUIBuilder programs in AmigaTalk
#
####################################################################
#
MAKE     = SDK:c/make
#
CC       = GCC:Bin/gcc
#
ACMD     = LhArc
#
OPTS     = -x -a 
#
# -Wformat
#
CFLAGS   = -c -ISDK:Local/Include
#
# -Wformat
#
DFLAGS   = -c -ggdb -gdwarf-2 -DDEBUG=1 -ISDK:Local/Include
#
PPCLIBS  = -lm -lstringfuncs -lamiga -lauto
#
PPCGLOB1 = GlobalObjects/CommonFuncsPPC.o
#
PPCGLOB2 = GlobalObjects/IniFuncsPPC.o
#
PPCOBJS1 = GTBTranslatorPPC.o GTBGenCPPC.o GTBTemplate.o GTBGenMiscCPPC.o GadgetTagsPPC.o WindowTagsPPC.o
#
# GTBLexPPCDBG.o
#
PPCDBGOBJS = GTBTranslatorPPCDBG.o GTBGenCD.o GTBTemplateD.o GTBGenMiscCPPCDBG.o GadgetTagsPPCD.o WindowTagsPPCD.o
#
clean :
	Delete *.o *.lha QUIET
#
help :
	@echo "Targets to make here are:"
	@echo " GTBTranslatorPPC"
	@echo " GTBScannerPPC"
	@echo ""
	@echo "   Debug Targets are:"
	@echo "   GTBTranslatorPPCDBG"
	@echo "   GTBScannerPPCDBG"
	@echo "   GTBGenCPPCDBG"
	@echo "   GTBGenATalkPPCDBG"
#
targets :
	$(MAKE) GTBTranslatorPPC
	$(MAKE) GTBScannerPPC
#
finalPPC :
	$(MAKE) targets
	$(MAKE) makeArchive
#
debugTargets :
	$(MAKE) GTBTranslatorPPCDBG
	$(MAKE) GTBScannerPPCDBG
#	$(MAKE) GTBGenCPPCDBG
#	$(MAKE) GTBGenATalkPPCDBG
#
# -------------------- Lexical analyzers: --------------------------------
#
lex.yy.c      : GTBLex.flex
	FLeX -t -L -SSys:Lib/Flex252.skel GTBLex.flex >lex.yy.c
#
ATlex.yy060.c : GTBATLex.flex
	FLeX -t -L -SSys:Lib/Flex252.skel GTBATLex.flex >ATlex.yy060.c
#
ATlex.yy040.c : GTBATLex.flex
	FLeX -t -L -SSys:Lib/Flex252.skel GTBATLex.flex >ATlex.yy040.c
#
# -------------------- Misc Targets: -------------------------------------
#
GTBProjectLocale.h : GTBProject.cd
	CatComp $< CFILE  $@ NOCODE NOARRAY NOBLOCK
	CatComp $< CTFILE GTBTranslator.ct
	COPY    $< GTBTranslator.cd
#
# -------------------- PPC target: ---------------------------------------
#
# GTBGenATalkPPC.o GTBATLexPPC.o 
#
GTBTranslatorPPC : $(PPCOBJS1)
	$(CC) --strip-debug CPGM:$(PPCGLOB1) CPGM:$(PPCGLOB2) $(PPCOBJS1) -o $@ $(PPCLIBS)
	COPY $@                CPGM:Generators/GadToolsTranslator/$@
	COPY $@                Amigatalk:C/$@
	COPY GenC.template     AmigaTalk:C/GenC.template
	COPY GenC.template     CPGM:Generators/GadToolsTranslator/GenC.template
	COPY GenATalk.template AmigaTalk:C/GenATalk.template
	COPY GenATalk.template CPGM:Generators/GadToolsTranslator/GenATalk.template
	$(MAKE) GTBScannerPPC
#
GTBTranslatorPPC.o : GTBTranslator.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
GTBGenCPPC.o : GTBGenC.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
GTBLexPPC.o : lex.yy.c 
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
GTBGenMiscCPPC.o : GTBGenMiscC.c GadToolsBoxIFFs.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
GadgetTagsPPC.o : GadgetTags.c 
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
GTBTemplate.o : GTBTemplate.c GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
WindowTagsPPC.o : WindowTags.c
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
GTBScannerPPC : GTBScannerPPC.o GTBProjectPPC.o
	$(CC) CPGM:$(PPCGLOB1) GTBScannerPPC.o GTBProjectPPC.o -o $@ $(PPCLIBS)
	COPY $@ CPGM:Generators/GadToolsTranslator/$@
	COPY $@ Amigatalk:C/$@
#
GTBScannerPPC.o : GTBScanner.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
GTBProjectPPC.o : GTBProject.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(CFLAGS) -o $@ $<
#
#
# -------------------- Archive Target: -----------------------------------
#
TARGET = gtbtranslatorppc.lha
#
makeList:
	$(ACMD) list $(TARGET) >Archive.list  
#
makeArchive : GTBTranslatorPPC GTBScannerPPC
	FileNote GTBTranslatorPPC "V2.3: The main program; Copyright (c)2005 by J.T. Steichen"
	FileNote GTBTranslator.install "Requires Installer V42.9 or better!"
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslatorPPC.readme
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslatorPPC
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslatorPPC.info
	FileNote GTBScannerPPC "V2.3: Support for GTBTranslatorPPC; Copyright (c)2005 by J.T. Steichen"
	$(ACMD) $(OPTS) add $(TARGET) GTBScannerPPC
	COPY AmigaTalk:Help/GTBTranslator.guide             AmigaTalk:src/GUIBuilder/GTBTranslator.guide
	COPY AmigaTalk:Help/Amigatalk.guide.info            AmigaTalk:src/GUIBuilder/GTBTranslator.guide.info
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslator.guide
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslator.guide.info
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslator.install
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslator.install.info
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslator.cd
	$(ACMD) $(OPTS) add $(TARGET) GTBTranslator.ct
	$(ACMD) $(OPTS) add $(TARGET) TestProject.gui
	$(ACMD) $(OPTS) add $(TARGET) GenC.template
	$(ACMD) $(OPTS) add $(TARGET) GenATalk.template
	COPY CPGM:GlobalObjects/CommonFuncs#?.#?             AmigaTalk:src/GUIBuilder/
	$(ACMD) $(OPTS) add $(TARGET) CommonFuncsPPC.o
	$(ACMD) $(OPTS) add $(TARGET) CommonFuncs.h
	$(ACMD) $(OPTS) add $(TARGET) CommonFuncs.guide
	$(ACMD) $(OPTS) add $(TARGET) CommonFuncs.guide.info
	COPY SDK:Local/Include/AmigaDosErrs.h                AmigaTalk:src/GUIBuilder/AmigaDOSErrs.h
	$(ACMD) $(OPTS) add $(TARGET) AmigaDOSErrs.h
	DELETE AmigaTalk:src/GUIBuilder/AmigaDOSErrs.h
	DELETE AmigaTalk:src/GUIBuilder/CommonFuncs#?.#?
	DELETE AmigaTalk:src/GUIBuilder/GTBTranslator.guide
	DELETE AmigaTalk:src/GUIBuilder/GTBTranslator.guide.info
#
# -------------------- DEBUG-stuff: --------------------------------------
#
GTBTranslatorPPCDBG :  $(PPCDBGOBJS)
	$(CC) -ggdb CPGM:$(PPCGLOB1) CPGM:$(PPCGLOB2) $(PPCDBGOBJS) -o $@ $(PPCLIBS) -lnet -lz
	COPY GenC.template     AmigaTalk:C/GenC.template
	COPY GenC.template     CPGM:Generators/GadToolsTranslator/GenC.template
	COPY GenATalk.template AmigaTalk:C/GenATalk.template
	COPY GenATalk.template CPGM:Generators/GadToolsTranslator/GenATalk.template
	$(MAKE) GTBScannerPPCDbg
#
GTBTranslatorPPCDBG.o : GTBTranslator.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
GTBScannerPPCDBG: GTBScannerPPCDBG.o GTBProjectPPCDBG.o
	$(CC) -ggdb CPGM:$(PPCGLOB1) GTBScannerPPCDBG.o GTBProjectPPCDBG.o -o $@ $(PPCLIBS) -lnet -lz
#
GTBScannerPPCDBG.o : GTBScanner.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
GTBGenCD.o : GTBGenC.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
GTBTemplateD.o : GTBTemplate.c GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
GTBProjectPPCDBG.o : GTBProject.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
# GTBLexPPCDBG.o 
#
INIDBG = Local/Libs/IniFuncsPPCDBG.o
#
GTBGenCPPCDBG: GTBTemplateD.o GTBGenCPPCDBG.o GadgetTagsPPCD.o WindowTagsPPCD.o GTBGenMiscCPPCDBG.o
	$(CC) CPGM:$(PPCGLOB1) SDK:$(INIDBG) GTBTemplateD.o GadgetTagsPPCD.o WindowTagsPPCD.o GTBGenCPPCDBG.o GTBGenMiscCPPCDBG.o -o $@ $(PPCLIBS)
#
GTBGenCPPCDBG.o : GTBGenC.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) -DDEBUGGEN=1 $(DFLAGS) -o $@ $<
#
GTBGenMiscCPPCDBG.o : GTBGenMiscC.c GadToolsBoxIFFs.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
GTBLexPPCDBG.o : lex.yy.c
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
GadgetTagsPPCD.o : GadgetTags.c
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
WindowTagsPPCD.o : WindowTags.c
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
GTBGenATalkPPCDBG: GTBGenATalkPPCDBG.o GTBATLexPPCDBG.o GadgetTagsPPCD.o WindowTagsPPCD.o
	$(CC) CPGM:$(PPCGLOB1) GTBGenATalkPPCDBG.o GTBATLexPPCDBG.o GadgetTagsPPCD.o WindowTagsPPCD.o -o $@ $(PPCLIBS)
#
GTBGenATalkPPCDBG.o : GTBGenATalk.c GadToolsBoxIFFs.h GTBProjectLocale.h
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
GTBATLexPPCDBG.o : ATlex060.yy.c 
	EnsureASCII $<     RAM:$<
	Copy        RAM:$< $<
	Delete      RAM:$<
	$(CC) $(DFLAGS) -o $@ $<
#
