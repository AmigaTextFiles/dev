Deck "TheBrowser"
   ;made with DECK2ASCII DEMO:, (c) 1996 by Christian Effenberger - and cando.library 3.008, (c) 1994 by INOVAtronics Inc.

   Routine "ReturnToClass"
      Local numlines
      Let numlines = LinesInDocument
      While TrimString( Arg1 ) <> TrimString( TheLine ) AND TheLineNumber < numlines
         MoveCursor DOWN 
      EndLoop
   EndScript
   Routine "SetupEditorVars"
      Nop   ;"SetupEditorVars",BrowserName    subroutine.
      Let currentclass  = TextFrom( "CurrentClass" )
      Let parentclass   = TextFrom( "ParentClass" )
      WorkWithDocument "Methods"   ;Arg1 == The Browser name
      Let currentmethod = TheLine
      WorkWithDocument "EditText"
      MoveCursorTo STARTOF DOCUMENT 
      Clear DOCUMENT 
      GotoCard "EditorCard",Arg1,parentclass,currentclass,currentmethod
   EndScript
   Routine "ReportError"
      Local errnum   ;ReportError subroutine.
      Local place
      Local title
      Let errnum = Arg1
      Let place  = Arg2
      Let title  = WindowTitle
      If errnum = 1
         SetWindowTitle "ERROR: class not found in "||place
         Delay 0,4,0
         SetWindowTitle title
      ElseIf errnum = 2
         SetWindowTitle "ERROR: method not found in "||place
         Delay 0,4,0
         SetWindowTitle title
      ElseIf errnum = 3
         SetWindowTitle "ERROR: "||place
         Delay 0,4,0
         SetWindowTitle title
      ElseIf errnum = 4
         SetWindowTitle "ERROR: Keystroke not implemented: "||place
         Delay 0,4,0
         SetWindowTitle title
      EndIf
   EndScript
   Routine "DEBUG"
      Local title
      Let title = WindowTitle      ;DEBUG display subroutine.
      SetWindowTitle Arg1
      If Arg2 <> 0
         Delay 0,Arg2,0
      Else
         Delay 0,1,0
      EndIf
      SetWindowTitle title
   EndScript
   Routine "GoUpToParent"
      Local numspaces      ;Arg1 = class name
      Local parent
      Local cspace
      Let numspaces = NumberOfChars( Arg1 ) - NumberOfChars( TrimString( Arg1 ))
      
      If numspaces = 0
         ExitScript      ; Class Object has no Parent!
      EndIf
      
      WorkWithDocument "ClassesDoc"
      
      If numspaces = 1   ;Parent class is Object!!
         MoveCursorTo STARTOF DOCUMENT 
         ExitScript
      Else
         MoveCursor UP 
         Let cspace = NumberOfChars( TheLine ) - NumberOfChars( TrimString( TheLine ))
         If cspace = numspaces - 1
            ExitScript
         Else
            While cspace <> (numspaces - 1)
               MoveCursor UP 
               Let cspace = NumberOfChars( TheLine ) - NumberOfChars( TrimString( TheLine ))
            EndLoop
         EndIf
      EndIf
      
   EndScript
   Routine "SetCurrentClass_Parent"
      ; ----------------------------------------
      ;SetCurrentClass_Parent subroutine.
      ;set the CurrentClass & ParentClass
      ;field gadgets correctly.
      ; ----------------------------------------
      
      Local classname
      
      WorkWithDocument "ClassesDoc"
      
      Let classname    = TheLine
      Let CurrentClass = TrimString( classname )
      SetText "CurrentClass",CurrentClass
      Do "GoUpToParent",classname
      Let ParentClass = TrimString( TheLine )
      SetText "ParentClass",ParentClass
      Do "ReturnToClass",CurrentClass
   EndScript
   Routine "SetSearchReplaceMenu"
      SetObjectState "SearchByWord",FALSE   ;SetSearchReplaceMenu
      SetObjectState "SearchNoCase",FALSE   ;subroutine.
      SetObjectState "ReplaceByWord",FALSE
      SetObjectState "ReplaceNoCase",FALSE
      SetObjectState "ReplaceGlobal",FALSE
      If FindChars( DefaultSearch, "WHOLEWORD", 1 ) > 0
         SetObjectState "SearchByWord",TRUE
      EndIf
      If FindChars( DefaultSearch, "NOCASE", 1) > 0
         SetObjectState "SearchNoCase",TRUE
      EndIf
      If FindChars( DefaultReplace, "WHOLEWORD", 1 ) > 0
         SetObjectState "ReplaceByWord",TRUE
      EndIf
      If FindChars( DefaultReplace, "NOCASE", 1) > 0
         SetObjectState "ReplaceNoCase",TRUE
      EndIf
      If FindChars( DefaultReplace, "GLOBAL", 1 ) > 0
         SetObjectState "ReplaceGlobal",TRUE
      EndIf
   EndScript
   Routine "ResetClassLists"
      ; -------------------------
      ; ResetClassLists
      ; -------------------------
      WorkWithDocument "SourceFileList"
      Clear DOCUMENT 
      WorkWithDocument "ClassesDoc"
      Clear DOCUMENT 
   EndScript
   Routine "ARMAddMethod"
      ; ------------------------------------------------------
      ; ARMAddMethod( tempfile, classname, methodname )
      ; ------------------------------------------------------
      
      Local f
      Local c
      Local m
      Local msg
      Local test
      
      Let f    = TrimString( Arg1 )
      Let c    = TrimString( Arg2 )
      Let msg  = "AddMethod"|||f|||c|||m
      Let test = Do( "CheckForARexxPort" )
      
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "ARMGetClassFileName"
      ; ---------------------------------
      ; ARMGetClassFileName( classname )
      ; ---------------------------------
      
      Local c
      Local msg
      Local test
      
      Let c    = TrimString( Arg1 )
      Let msg  = "GetClassFileName"|||c
      Let test = Do( "CheckForARexxPort" )
      
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "ARMGetClassType"
      ; ----------------
      ; ARMGetClassType
      ; ----------------
      
      Local msg
      Local test
      
      Let msg  = "GetClassType"
      Let test = Do( "CheckForARexxPort" )
      
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "ARMPurgeClass"
      ; ---------------------------
      ; ARMPurgeClass( classname )
      ; ---------------------------
      
      Local c
      Local msg
      Local test
      
      Let c    = TrimString( Arg1 )
      Let msg  = "PurgeClass"|||c
      Let test = Do( "CheckForARexxPort" )
      
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "ARMReloadClass"
      ; --------------------------------------
      ; ARMReloadClass( tempfile, classname )
      ; --------------------------------------
      
      Local f
      Local c
      Local msg
      Local test
      
      Let f    = TrimString( Arg1 )
      Let c    = TrimString( Arg2 )
      Let msg  = "ReloadClass"|||f|||c
      Let test = Do( "CheckForARexxPort" )
      
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "ARMReloadMethod"
      ; ------------------------------------------------------
      ; ARMReloadMethod( tempfile, classname, methodname )
      ; ------------------------------------------------------
      
      Local f
      Local c
      Local m
      Local msg
      Local test
      
      Let f    = TrimString( Arg1 )
      Let c    = TrimString( Arg2 )
      Let msg  = "ReloadMethod"|||f|||c|||m
      Let test = Do( "CheckForARexxPort" )
      
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "ARMAddClass"
      ; -----------------------------------
      ; ARMAddClass( tempfile, classname )
      ; -----------------------------------
      
      Local f
      Local c
      Local msg
      Local test
      
      Let f   = TrimString( Arg1 )
      Let c   = TrimString( Arg2 )
      Let msg = "AddClass"|||f|||c
      
      Let test = Do( "CheckForARexxPort" )
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "HandleARexxError"
      ; -----------------------------
      ; HandleARexxError
      ; -----------------------------
      
      WorkWithDocument "ARexxError"
      SetPen 2
      
      Type "Error Received!",NEWLINE 
      Type "Error Code is: "||MessageErrorCode,NEWLINE 
      Type "Message: "||TheMessage,NEWLINE 
   EndScript
   Routine "CopyDoc"
      ; -------------------------------------
      ; CopyDoc( Dest, Source ) SubRoutine.
      ; -------------------------------------
      
      Local src
      Local dest
      Local safety
      Local str
      
      Let dest = TrimString( Arg1 )
      Let src  = TrimString( Arg2 )
      
      WorkWithDocument src
      MoveCursorTo STARTOF DOCUMENT 
      Let safety = LinesInDocument
      
      While safety > 0
         Let str = TheLine
         
         WorkWithDocument dest
         Type str,NEWLINE 
         
         WorkWithDocument src
         MoveCursor DOWN 
         Let safety = safety - 1
      EndLoop
   EndScript
   Routine "FindNameInSrcList"
      ; ----------------------------------------------
      ; name = FindNameInSrcList( classname )
      ; ----------------------------------------------
      
      Local classname
      
      Let classname = TrimString( ARG1 )
      
      WorkWithDocument "SourceFileList"
      MoveCursorTo STARTOF DOCUMENT 
      
      WorkWithDocument "ClassesDoc"
      MoveCursorTo STARTOF DOCUMENT 
      Let safety = LinesInDocument
      
      While safety > 0 AND TrimString( TheLine ) <> NOTHING
         
         If FindChars( TheLine, classname, 1 ) > 0
            WorkWithDocument "SourceFileList"
            ExitScript TrimString( TheLine )
         EndIf
         
         MoveCursor DOWN 
         WorkWithDocument "SourceFileList"
         MoveCursor DOWN 
         
         WorkWithDocument "ClassesDoc"
         Let safety = safety - 1
      EndLoop
      
      WorkWithDocument "SourceFileList"
      MoveCursorTo STARTOF DOCUMENT 
      
      ExitScript TrimString( TheLine ) ; Default class filename!
   EndScript
   Routine "FindClassFileName"
      ; -------------------------------------------
      ; filename = FindClassFileName( classname )
      ; -------------------------------------------
      
      Local classname
      Local safety
      Local test
      Local filename
      
      Let classname = TrimString( Arg1 )
      Let test      = Do( "CheckForARexxPort" )
      
      If test = TRUE
         ; ----  Get the filename from a reliable source:
         
         Do "SendARexxCommand","GetClassFileName"|||classname
         If MessageErrorCode = 0
            Let filename = TrimString( TheMessage )
            
            If Exists( filename ) AND filename <> NOTHING
               ExitScript filename
            Else
               Let filename = Do( "FindNameInSrcList", classname )
               ExitScript filename
            EndIf
            
         Else
            ; ARexx had a problem:
            Let filename = Do( "FindNameInSrcList", classname )
            ExitScript filename
         EndIf
      Else
         Let filename = Do( "FindNameInSrcList", classname )
         ExitScript filename
      EndIf
   EndScript
   Routine "Search"
      ; -------------------------------------------
      ; Search SubRoutine( searchstring, caseflag )
      ; -------------------------------------------
      
      Local safety
      
      MoveCursorTo STARTOF DOCUMENT 
      Let safety = LinesInDocument
      
      If Arg2 = 0                   ; Case-sensitive search:
         While FindChars( TheLine, Arg1, 1 ) <= 0 AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
      Else
         While FindChars( UpperCase( TheLine ), UpperCase( Arg1 ), 1 ) <= 0 AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
      EndIf
      
      ExitScript TrimString( TheLine )
   EndScript
   Routine "SetARexxPortList"
      ; ------------------------------
      ; SetARexxPortList
      ; ------------------------------
      
      WorkWithDocument "ARexxPortList"
      Clear DOCUMENT 
      InsertMessagePortList
      SortDocument NOCASE 
      
      Loop
         Delete LINE 
      Until TrimString( TheLine ) <> NOTHING
      
      SetWordDelimiters ""
      
      If ARexxPortName = ""
         Let ARexxPortName = "AmigaTalk_Rexx"
      EndIf
      
      Let CurrentPortName = Do( "Search", ARexxPortName, 0 )
      
      If CurrentPortName = ARexxPortName
         SpeakTo ARexxPortName
         ListenTo ARexxPortName
      Else
         Let msg   = "Couldn't find ARexx port "||ARexxPortName
         Let dummy = AskForResponse( msg , "ARexx Problem:", "OKAY" )
         Let CurrentPortName = ARexxPortName
      EndIf
      
      If CardName = "ARexxCard"
         Do "SetSpeakAddress"
      EndIf
      
   EndScript
   Routine "CopySourceCode"
      ; --------------------------------
      ; CopySourceCode( dest, source )
      ; --------------------------------
      
      Local dest
      Local src
      Local codeline
      Local test
      
      Let dest = TrimString( Arg1 )
      Let src  = TrimString( Arg2 )
      
      Let test = TRUE
      WorkWithDocument src
      
      While test = TRUE
         Let codeline = TheLine
         
         WorkWithDocument dest
         Type codeline,NEWLINE 
         
         WorkWithDocument src
         MoveCursor DOWN 
         
         Let test = Do( "CheckForMethodEnd", TheLine )
      EndLoop
   EndScript
   Routine "CheckForMethodEnd"
      Local result
      Local s
      
      Let s      = TrimString( Arg1 )
      Let result = FindChars( s, "|", 1 ) <> 1 AND FindChars( s, "]", 1 ) <> 1 AND s <> NOTHING
      
      ExitScript result
   EndScript
   Routine "SetupMethodList"
      ; ---------------------------------
      ; SetupMethodList SubRoutine.
      ; ---------------------------------
      
      Local classname
      Local methodfile
      Local termclass
      
      If BrowserDisplay = "GENERAL"
         Let methodfile = BrowserPath||"GeneralMethods"
      ElseIf BrowserDisplay = "INTUITION"
         Let methodfile = BrowserPath||"IntuitionMethods"
      ElseIf BrowserDisplay = "SYSTEM"
         Let methodfile = BrowserPath||"SystemMethods"
      ElseIf BrowserDisplay = "USER"
         Let methodfile = BrowserPath||"UserMethods"
      Else
         Let methodfile = BrowserPath||"GeneralMethods"
      EndIf
      
      WorkWithDocument "ClassesDoc"
      Let classname    = TrimString( TheLine )||":"
      Let CurrentClass = TrimString( TheLine )
      
      MoveCursor DOWN 
      Let termclass = TrimString( TheLine )||":"
      
      Do "GetCurrentMethods",methodfile,classname,termclass
      Do "SetCurrentClass_Parent"
      
      WorkWithDocument "Methods"
      MoveCursorTo STARTOF DOCUMENT 
      Let CurrentMethod = TrimString( TheLine )
   EndScript
   Routine "CheckForARexxPort"
      ; ----------------------------------
      ; BOOL = Do( "CheckForARexxPort" )
      ; ----------------------------------
      
      Local title
      
      Let title = "AmigaTalk © 1998 -- Class Browser:"
      
      WorkWithDocument "ARexxPortList"
      Clear DOCUMENT 
      InsertMessagePortList
      SortDocument NOCASE 
      
      Loop
         Delete LINE 
      Until TrimString( TheLine ) <> NOTHING
      
      SetWordDelimiters ""
      
      If ARexxPortName <> NOTHING
         SearchFor ARexxPortName,BYWORD 
         
         If SearchFound = TRUE
            Let title = title||" Port: "||ARexxPortName
            SetWindowTitle title
            
            SpeakTo ARexxPortName
            ListenTo ARexxPortName
            ExitScript TRUE
         Else
            Let title = title||" Port: NONE"
            SetWindowTitle title
            ExitScript FALSE
         EndIf
      EndIf
      
   EndScript
   Routine "SendARexxCommand"
      ; -------------------------------
      ; SendARexxCommand( command )
      ; -------------------------------
      
      Local ToBeSent
      
      If ARexxPortName <> NOTHING
         
         Let ToBeSent = TrimString( Arg1 )
         SendMessage ToBeSent
         
         If MessageErrorCode <> 0
            Let msg = "ERROR code = "||MessageErrorCode||", "||Char( 13 )
            Let msg = msg||MessageReturned
            Do "HandleARexxError"
            Let dummy = AskForResponse( msg, "ARexx ERROR:", "OKAY" )
         EndIf
         
         ; The following will not be needed for the debugged version:
         If debug = TRUE
            WorkWithDocument "ARexxResult"
            MoveCursorTo ENDOF DOCUMENT 
            Type ToBeSent,NEWLINE 
            Type MessageErrorCode||":"||MessageReturned,NEWLINE 
         EndIf
      EndIf
   EndScript
   Routine "ARMPlaceCodesInFile"
      ; ------------------------------------------------------
      ; ARMPlaceCodesInFile( tempfile, classname, methodname )
      ; ------------------------------------------------------
      
      Local f
      Local c
      Local m
      Local msg
      Local test
      
      Let f    = TrimString( Arg1 )
      Let c    = TrimString( Arg2 )
      Let m    = TrimString( Arg3 )
      Let msg  = "PlaceCodesInFile"|||f|||c|||m
      Let test = Do( "CheckForARexxPort" )
      
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "LoadClasses"
      ; -----------------------------------------
      ; LoadClasses( classfilename ) SubRoutine.
      ; -----------------------------------------
      
      Local filename
      Local safety
      Local classline
      Local srcfile
      Local classname
      
      Let filename = TrimString( Arg1 )
      
      If Exists( filename ) AND filename <> NOTHING
         LoadDocument filename,"TempClassesDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
      Else
         Let filename = AskForFileName( BrowserPath,"Which Class Group?",0,14,400,200)
         If filename = NOTHING
            Let filename = BrowserPath||"GeneralClasses"
         EndIf
         LoadDocument filename,"TempClassesDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
      EndIf
      
      While safety > 0 AND TrimString( TheLine ) <> NOTHING
         
         Let classline = TheLine
         Let classname = GetWord( classline, 1, ":" )
         Let srcfile   = GetWord( TrimString( classline ), 2, ":" )
         
         WorkWithDocument "ClassesDoc"
         Type classname,NEWLINE 
         
         WorkWithDocument "SourceFileList"
         Type srcfile,NEWLINE 
         
         Let safety = safety - 1
         
         WorkWithDocument "TempClassesDoc"
         MoveCursor DOWN 
      EndLoop
      
   EndScript
   Routine "LoadDefaultSrc"
      ; ----------------------------------------------
      ; LoadDefaultSrc( classfilename )
      ; ----------------------------------------------
      
      Local ClassFileName
      Local safety
      
      Let ClassFileName = TrimString( ARG1 )
      Let CurrentMethod = "=="
      
      If Exists( ClassFileName ) AND ClassFileName <> NOTHING
         LoadDocument ClassFileName,"TempSrcCodeDoc"
      Else
         Let ClassFileName = AskForFileName( GeneralPath, "Where is Object.st?",0,14,400,200)
         If ClassFileName = NOTHING
            ExitScript
         EndIf
         
         LoadDocument ClassFileName,"TempSrcCodeDoc"
      EndIf
      
      WorkWithDocument "TempSrcCodeDoc"
      MoveCursorTo STARTOF DOCUMENT 
      Let safety = LinesInDocument
      
      While FindChars( TheLine, CurrentMethod, 1 ) = 0 AND safety > 0
         MoveCursor DOWN 
         Let safety = safety - 1
      EndLoop
      
      If FindChars( TheLine, CurrentMethod, 1 ) > 0
         WorkWithDocument "SrcCodeDoc"
         Clear DOCUMENT 
         
         Do "CopySourceCode","SrcCodeDoc","TempSrcCodeDoc"
         
         ExitScript
      Else
         ; Do "Load1stMethod",ClassFileName
         ; Change this to a file request for GeneralPath/Object.st
         ; later.
         ;
         
      EndIf
      
   EndScript
   Routine "SetupClassFileName"
      ; --------------------------------------------
      ; filename = SetupClassFileName() SubRoutine.
      ; --------------------------------------------
      
      Local ClassFileName
      
      Let ClassFileName = Do( "FindClassFileName", CurrentClass )
      
      If BrowserDisplay = "GENERAL"
         Let ClassFileName = GeneralPath||ClassFileName
      ElseIf Browserdisplay = "INTUITION"
         Let ClassFileName = IntuitionPath||ClassFileName
      ElseIf Browserdisplay = "SYSTEM"
         Let ClassFileName = SystemPath||ClassFileName
      ElseIf Browserdisplay = "USER"
         Let ClassFileName = UserPath||ClassFileName
      Else
         Let ClassFileName = GeneralPath||ClassFileName
      EndIf
      
      ExitScript ClassFileName
   EndScript
   Routine "LoadSourceFile"
      ; ----------------------------------------------
      ; LoadSourceFile( ClassFileName )
      ; ----------------------------------------------
      
      Local ClassFileName
      
      Let ClassFileName = TrimString( ARG1 )
      
      If Exists( ClassFileName ) AND ClassFileName <> NOTHING
         LoadDocument ClassFileName,"SrcCodeDoc"
         WorkWithDocument "SrcCodeDoc"
         MoveCursorTo STARTOF DOCUMENT 
      Else
         Do "LoadDefaultSrc",GeneralPath||"Object.st"
      EndIf
   EndScript
   Routine "GetCurrentMethods"
      ; -------------------------------------------------------
      ; GetCurrentMethods( methodfile, classname, nextclass )
      ;
      ; Based on what class name is selected in the
      ; class list, determine which methods to place
      ; in the method list.
      ; -------------------------------------------------------
      
      Local methodfile
      Local classname   ;Classname with an appended colon.
      Local termclass   ;Classname with an appended colon.
      Local currentline
      
      Let termclass  = Arg3
      Let classname  = Arg2
      Let methodfile = Arg1
      
      WorkWithDocument "Methods"
      Clear DOCUMENT 
      
      LoadDocument methodfile,"TempMethods"
      MoveCursorTo STARTOF DOCUMENT 
      Let currentline = TheLine
      
      If currentline = classname ;Must be the first class in list:
         MoveCursor DOWN 
         Let currentline = TheLine
         While TrimString( currentline ) <> termclass AND currentline <> NOTHING
            WorkWithDocument "Methods"
            Type currentline,NEWLINE 
            
            WorkWithDocument "TempMethods"
            MoveCursor DOWN 
            Let currentline = TheLine
         EndLoop
      Else
         WorkWithDocument "TempMethods"
         MoveCursorTo STARTOF DOCUMENT 
         Do "Search",classname,1
         
         MoveCursor DOWN 
         Let currentline = TheLine
         
         While TrimString( currentline ) <> termclass AND currentline <> NOTHING
            WorkWithDocument "Methods"
            Type currentline,NEWLINE 
            
            WorkWithDocument "TempMethods"
            MoveCursor DOWN 
            Let currentline = TheLine
         EndLoop
      EndIf
      
      WorkWithDocument "Methods"
      MoveCursorTo STARTOF DOCUMENT 
      WorkWithDocument "ClassesDoc"
      MoveCursor UP 
      
      
      
   EndScript
   Routine "SetupSourceList"
      ; ---------------------------------------
      ; SetupSourceList SubRoutine.
      ; ---------------------------------------
      ; Check the SrcCodeDisplay flag, then
      ; 1. Display bytecodes received from
      ;    ATalkBrowser.c ARexx code or
      ; 2. Open the correct file & search
      ;    for the correct methods to display.
      ; ---------------------------------------
      
      Local ClassFileName
      
      Let ClassFileName = Do( "SetupClassFileName" )
      
      If SrcCodeDisplay = "REGULAR"
         
         Do "LoadSourceFile",ClassFileName
         
      Else
         ; Display ByteCodes instead:
         
         Do "ARMPlaceCodesInFile","RAM:tc.st",CurrentClass,CurrentMethod
         Delay 0,3,0
         If MessageErrorCode = 0
            
            If Exists( "RAM:tc.st" )
               LoadDocument "RAM:tc.st","TempSrcCodeDoc"
               Do "CopySourceCode","SrcCodeDoc","TempSrcCodeDoc"
               
               If adjustflag = TRUE
                  Let CurrentMethod = "|"
                  Let adjustflag    = FALSE
               EndIf
               
            Else
               Do "LoadSourceFile",ClassFileName
            EndIf
            
         Else
            ; Didn't find the bytecodes, display Source instead:
            
            Do "LoadSourceFile",ClassFileName
         EndIf
      EndIf
   EndScript
   Routine "SetupBrowser"
      ; ----------------------------------------
      ; SetupBrowser()  SubRoutine
      ; ----------------------------------------
      Local termclass      ;SetupBrowser subroutine.
      Local classfile
      Local classname
      
      Do "ResetClassLists"
      
      If BrowserDisplay = "GENERAL"
         Let classfile  = BrowserPath||"GeneralClasses"
      ElseIf BrowserDisplay = "INTUITION"
         Let classfile  = BrowserPath||"IntuitionClasses"
      ElseIf BrowserDisplay = "SYSTEM"
         Let classfile  = BrowserPath||"SystemClasses"
      ElseIf BrowserDisplay = "USER"
         Let classfile  = BrowserPath||"UserClasses"
      Else
         Let classfile  = BrowserPath||"GeneralClasses"
      EndIf
      
      Do "LoadClasses",classfile
      
      WorkWithDocument "ClassesDoc"
      MoveCursorTo STARTOF DOCUMENT 
      Let CurrentClass = TrimString( TheLine )
      
      Do "SetupSourceList"
      
   EndScript
   Routine "ARMQuitBrowser"
      ; --------------------------------------------------
      ; ARMQuitBrowser - Tell the ARexx Port to shut down.
      ; --------------------------------------------------
      
      Local msg
      Local test
      
      Let msg  = "Quit"
      Let test = Do( "CheckForARexxPort" )
      
      If test = TRUE
         Do "SendARexxCommand",msg
      EndIf
   EndScript
   Routine "HandleDeckError"
      ; -------------------------------
      ; HandleDeckError() SubRoutine.
      ; -------------------------------
      
      Local ans
      Local msg
      Local crl
      
      SetWindowTitle "TheBrowser has an internal ERROR:"
      Let crl = String( Char ( 10 ) )
      Let msg = "ERROR encountered:"||crl
      Let msg = msg||" Script name:  "||ErrorScriptName||crl
      Let msg = msg||" Line:  "||ErrorSourceLine||crl
      Let msg = msg||" Line #:  "||ErrorLineNumber||crl
      Let msg = msg||" Code:  "||ErrorCode||crl
      Let msg = msg||" Text:  "||ErrorText||crl||crl
      Let msg = msg||" TheBrowser will terminate!"
      
      Let ans = AskForResponse( msg, "TheBrowser problem:", "OKAY" )
      SetWindowTitle "Removing ARexx Handler..."
      Delay 0,2,0
      Do "ARMQuitBrowser"
      Quit
      
   EndScript
   Card "ClassBrowser"
      Routine "ResetClassGroupMenus"
         SetObjectState "ShowGeneral",FALSE
         SetObjectState "ShowIntuition",FALSE
         SetObjectState "ShowSystem",FALSE
         SetObjectState "ShowUser",FALSE
         
      EndScript
      Routine "ResetMethodsMenu"
         SetObjectState "DisplaySource",FALSE
         SetObjectState "DisplayByteCodes",FALSE
         
      EndScript
      Routine "DisplaySourceMI"
         Do "ResetMethodsMenu"
         SetObjectState "DisplaySource",TRUE
         Let SrcCodeDisplay = "REGULAR"
         Do "SetupSourceList"
         
      EndScript
      Routine "DisplayByteCodesMI"
         Do "ResetMethodsMenu"
         SetObjectState "DisplayByteCodes",TRUE
         Let SrcCodeDisplay = "BYTECODES"
         Do "SetupSourceList"
         
      EndScript
      Routine "LoadSource"
         ; ---------------------------------------
         ; LoadSource SubRoutine.
         ; ---------------------------------------
         ; Check the SrcCodeDisplay flag, then
         ; 1. Display bytecodes received from
         ;    ATalkBrowser.c ARexx code or
         ; 2. Open the correct file & search
         ;    for the correct methods to display.
         ; ---------------------------------------
         
         Local SrcFileName
         
         If BrowserDisplay = "GENERAL"
            Let SrcFileName = GeneralPath
         ElseIf BrowserDisplay = "INTUITION"
            Let SrcFileName = IntuitionPath
         ElseIf BrowserDisplay = "SYSTEM"
            Let SrcFileName = SystemPath
         ElseIf BrowserDisplay = "USER"
            Let SrcFileName = UserPath
         Else
            Let SrcFileName = GeneralPath
         EndIf
         
         Let SrcFileName = SrcFileName||TrimString(TextFrom( "SrcFileName"))
         
         If SrcCodeDisplay = "REGULAR"
            
            Do "LoadSourceFile",SrcFileName
            
         Else
            ; Display ByteCodes instead:
            
            Do "ARMPlaceCodesInFile","RAM:tc.st",CurrentClass,CurrentMethod
            Delay 0,3,0
            If MessageErrorCode = 0
               
               If Exists( "RAM:tc.st" )
                  LoadDocument "RAM:tc.st","TempSrcCodeDoc"
                  Do "CopySourceCode","SrcCodeDoc","TempSrcCodeDoc"
                  
               Else
                  Do "LoadSourceFile",SrcFileName
               EndIf
               
            Else
               ; Didn't find the bytecodes, display Source instead:
               
               Do "LoadSourceFile",SrcFileName
            EndIf
         EndIf
      EndScript
      Routine "RedisplayClasses"
         ; ------------------------------------
         ; RedisplayClasses( classgroup )
         ; ------------------------------------
         
         Local classgroup
         Local classfile
         
         Let classgroup     = TrimString( UpperCase( Arg1 ) )
         Let Browserdisplay = classgroup
         
         Do "ResetClassGroupMenus"
         
         If classgroup = "GENERAL"
            SetObjectState "ShowGeneral",TRUE
            Let classfile  = BrowserPath||"GeneralClasses"
         ElseIf classgroup = "INTUITION"
            SetObjectState "ShowIntuition",TRUE
            Let classfile  = BrowserPath||"IntuitionClasses"
         ElseIf classgroup = "SYSTEM"
            SetObjectState "ShowSystem",TRUE
            Let classfile  = BrowserPath||"SystemClasses"
         ElseIf classgroup = "USER"
            SetObjectState "ShowUser",TRUE
            Let classfile  = BrowserPath||"UserClasses"
         Else
            SetObjectState "ShowGeneral",TRUE
            Let classfile  = BrowserPath||"GeneralClasses"
         EndIf
         
         WorkWithDocument "ClassesDoc"
         Clear DOCUMENT 
         
         Do "LoadClasses",classfile
         
         WorkWithDocument "ClassesDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let CurrentClass = TrimString( TheLine )
         
         Do "SetBrowserDisplay"
         
      EndScript
      Routine "SetBrowserDisplay"
         ; ----------------------------------
         ; SetBrowserDisplay
         ; ----------------------------------
         Local ClassName
         Local safety
         
         WorkWithDocument "ClassesDoc"
         
         Let ClassName    = TrimString( TheLine )
         Let CurrentClass = ClassName
         SetText "CurrentClass",CurrentClass
         
         WorkWithDocument "TempClassesDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While safety > 0
                 If FindChars( TheLine, ClassName, 1 ) > 0
               Let ParentClass  = GetWord( TheLine, 3, ":" )
               Let SrcfileName  = GetWord( TheLine, 2, ":" )
               ExitLoop
            EndIf
            
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         SetText "ParentClass",ParentClass
         SetText "SrcFileName",SrcFileName
         SetText "CurrentMethod",""
         
         Do "LoadSource"
         
         Let searchTxt = "Class "||CurrentClass
         
         WorkWithDocument "SrcCodeDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While safety > 0
            If FindChars( TheLine, searchTxt, 1 ) > 0
               ExitLoop
            EndIf
            
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         If TheLineNumber <> 1
            MoveCursor DOWN ,12
         EndIf
      EndScript
      Routine "ProcessCommandLine"
         ; --------------------------------------
         ; ProcessCommandLine
         ; --------------------------------------
         
         Local args
         Local btype
         
         Let args  = TheCommandLine
         Let btype = GetWord( args, 1 )
         
         If InitializeFlag <> FALSE
            Do "ProcessToolTypes"
         EndIf
         
         ; - Override any tooltype for BrowserDisplay:
         
         If UpperCase( btype ) = "GENERAL"
            Let BrowserDisplay = UpperCase( btype )
         ElseIf UpperCase( btype ) = "INTUITION"
            Let BrowserDisplay = UpperCase( btype )
         ElseIf UpperCase( btype ) = "SYSTEM"
            Let BrowserDisplay = UpperCase( btype )
         ElseIf UpperCase( btype ) = "USER"
            Let BrowserDisplay = UpperCase( btype )
         Else
            Let BrowserDisplay = "GENERAL"
         EndIf
         
      EndScript
      Routine "ProcessToolTypes"
         ; ------------------------------------
         ; ProcessToolTypes SubRoutine
         ; ------------------------------------
         
         If InitializeFlag = FALSE
            ExitScript
         EndIf
         
         LoadIcon CommandPath||DeckName,"IconBuffer"
         MakeDocument "ToolList"
         InsertToolTypeList CommandPath||DeckName
         
         Do "Search","BROWSERPATH=",1
         If TheLine <> ""
            Let BrowserPath = RemoveChars( TheLine, 1, NumberOfChars( "BrowserPath=" ))
            Let BrowserPath = TrimString( BrowserPath )
         EndIf
         Do "Search","PROGRAMPATH=",1
         If TheLine <> ""
            Let ProgramPath = RemoveChars( TheLine, 1, NumberOfChars( "ProgramPath=" ))
            Let ProgramPath = TrimString( ProgramPath )
         EndIf
         Do "Search","GENERALPATH=",1
         If TheLine <> ""
            Let GeneralPath = RemoveChars( TheLine, 1, NumberOfChars( "GeneralPath=" ))
            Let GeneralPath = TrimString( GeneralPath )
         EndIf
         Do "Search","INTUITIONPATH=",1
         If TheLine <> ""
            Let IntuitionPath = RemoveChars( TheLine, 1, NumberOfChars( "IntuitionPath=" ))
            Let IntuitionPath = TrimString( IntuitionPath )
         EndIf
         Do "Search","SYSTEMPATH=",1
         If TheLine <> ""
            Let SystemPath = RemoveChars( TheLine, 1, NumberOfChars( "SystemPath=" ))
            Let SystemPath = TrimString( SystemPath )
         EndIf
         Do "Search","USERPATH=",1
         If TheLine <> ""
            Let UserPath = RemoveChars( TheLine, 1, NumberOfChars( "UserPath=" ))
            Let UserPath = TrimString( UserPath )
         EndIf
         Do "Search","HELPPATH=",1
         If TheLine <> ""
            Let HelpPath = RemoveChars( TheLine, 1, NumberOfChars( "HelpPath=" ))
            Let HelpPath = TrimString( HelpPath )
         EndIf
         Do "Search","EXTERNALEDITOR=",1
         If TheLine <> ""
            Let ExternalEditor = RemoveChars( TheLine, 1, NumberOfChars( "ExternalEditor=" ))
            Let ExternalEditor = TrimString( ExternalEditor )
         EndIf
         Do "Search","COMMANDPATH=",1
         If TheLine <> ""
            Let CommandPath = RemoveChars( TheLine, 1, NumberOfChars( "CommandPath=" ))
            Let CommandPath = TrimString( CommandPath )
         EndIf
         Do "Search","BROWSERDISPLAY=",1
         If TheLine <> ""
            Let BrowserDisplay = RemoveChars( TheLine, 1, NumberOfChars( "BrowserDisplay=" ))
            Let BrowserDisplay = TrimString( BrowserDisplay )
         EndIf
         Do "Search","SRCCODEDISPLAY=",1
         If TheLine <> ""
            Let SrcCodeDisplay = RemoveChars( TheLine, 1, NumberOfChars( "SrcCodeDisplay=" ))
            Let SrcCodeDisplay = TrimString( SrcCodeDisplay )
         EndIf
         Do "Search","AREXXPORTNAME=",1
         If TheLine <> ""
            Let ARexxPortName = RemoveChars( TheLine, 1, NumberOfChars( "ARexxPortName=" ))
            Let ARexxPortName = TrimString( ARexxPortName )
            Do "SetARexxPortList"
         EndIf
         Do "Search","DEFAULTSEARCH=",1
         If TheLine <> ""
            Let DefaultSearch = RemoveChars( TheLine, 1, NumberOfChars( "DefaultSearch=" ))
            Let DefaultSearch = TrimString( DefaultSearch )
         EndIf
         Do "Search","DEFAULTREPLACE=",1
         If TheLine <> ""
            Let DefaultReplace = RemoveChars( TheLine, 1, NumberOfChars( "DefaultReplace=" ))
            Let DefaultReplace = TrimString( DefaultReplace )
         EndIf
      EndScript
      Routine "SetupGlobals"
         ; --------------------------------------
         ; SetupGlobals SubRoutine.
         ; --------------------------------------
         Global ProgramPath    ; Where is the AmigaTalk programming system?
         Global BrowserPath    ; Where are the Browser files?
         Global GeneralPath    ; Where are the General Classes?
         Global SystemPath     ; Where are the Amiga OS Classes?
         Global IntuitionPath  ; Where are the Intuition Classes?
         Global UserPath       ; Where are the User Classes?
         Global CommandPath    ; Where are the AmigaTalk Commands?
         Global HelpPath       ; Where is the documentation?
         Global ARexxPortName
         Global BrowserDisplay ; What classes are we displaying?
         Global SrcCodeDisplay ; What type of source are we displaying?
         Global CurrentClass   ; What Class has the user selected?
         Global CurrentMethod  ; What Method has the user selected?
         
         Global ExternalEditor
         Global DefaultSearch  ; WHOLEWORD | NOCASE
         Global DefaultReplace ; WHOLEWORD | NOCASE | GLOBAL
         
         Global InitializeFlag ; Should we initialize the Browser?
         Global debug          ; Are we still debugging the Browser?
         
         If InitializeFlag <> FALSE
            
            If Exists( "AmigaTalk:AmigaTalk" )
               Let BrowserPath    = "AmigaTalk:Browser/"
               Let ProgramPath    = "AmigaTalk:"
               Let GeneralPath    = "AmigaTalk:General/"
               Let SystemPath     = "AmigaTalk:System/"
               Let IntuitionPath  = "AmigaTalk:Intuition/"
               Let UserPath       = "AmigaTalk:User/"
               Let CommandPath    = "AmigaTalk:C/"
               Let HelpPath       = "AmigaTalk:Help/"
            Else
               Let BrowserPath    = TheCurrentDirectory||"Browser/"
               Let ProgramPath    = TheCurrentDirectory
               Let GeneralPath    = TheCurrentDirectory||"General/"
               Let SystemPath     = TheCurrentDirectory||"System/"
               Let IntuitionPath  = TheCurrentDirectory||"Intuition/"
               Let UserPath       = TheCurrentDirectory||"User/"
               Let CommandPath    = TheCurrentDirectory||"C/"
               Let HelpPath       = TheCurrentDirectory||"Help/"
            EndIf
            
            Let BrowserDisplay = "GENERAL"
            Let SrcCodeDisplay = "REGULAR"
            Let ARexxPortName  = "AmigaTalk_Rexx"
            Let CurrentClass   = "Object"      ; The First General Class.
            Let CurrentMethod  = "=="          ; The First Method for Object.
            
            Let DefaultSearch  = "WHOLEWORD"
            Let DefaultReplace = ""
            Let ExternalEditor = "C:Ed"
            
            Let debug          = TRUE
            
            Delay 0,2,0
            If TheCommandLine <> NOTHING
               ; Started from the CLI:
               Do "ProcessCommandLine"
               Let InitializeFlag = FALSE
            Else
               ; Started from the Icon:
               Do "ProcessToolTypes"
               Let InitializeFlag = FALSE
            EndIf
         EndIf
      EndScript
      BeforeAttachment
         Do "SetupGlobals"
      EndScript
      AfterAttachment
         Do "SetupBrowser"
      EndScript
      BeforeDetachment
         Let InitializeFlag = FALSE ; Don't initialize the Program again!
      EndScript
      Window "UserWindow"
         Definition
            Origin 0,14
            Title "AmigaTalk © 1998 -- Class Browser:"
            WindowObjects CLOSEBUTTON DEPTHBUTTONS DRAGBAR 
            WindowZoom 0,14,240,16
            Size 640,340
            WindowFlags ACTIVATE TOFRONT WORKBENCH 
            VisualEffects NONE ,WAIT 
         EndScript
         OnCloseButton
            Do "ARMQuitBrowser"
            Quit
            
         EndScript
         OnResized
            Do "SetupBrowser"
            
            
         EndScript
      EndObj
      List "ClassList"
         Definition
            ListDocument "ClassesDoc"
            Origin 8,31
            Size 304,126
            Border BEVEL ,1,2
            Label "Classes:",HIGHLIGHT ABOVE 
            Font "topaz",8
            TextColors 7,0,JAM2 
            Style PLAIN ,2,3
         EndScript
         OnRelease
            Do "SetBrowserDisplay"
            
         EndScript
      EndObj
      TextField "SrcFileName"
         Definition
            InitialText ""
            Origin 333,119
            Size 250,10
            Border BEVEL ,1,2
            Label "Source File:",HIGHLIGHT ABOVE 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
      EndObj
      TextField "CurrentMethod"
         Definition
            InitialText ""
            Origin 333,90
            Size 250,10
            Border BEVEL ,1,2
            Label "Current Method:",HIGHLIGHT ABOVE 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
      EndObj
      TextField "CurrentClass"
         Definition
            InitialText "Object"
            Origin 333,61
            Size 250,10
            Border BEVEL ,1,2
            Label "Current Class:",HIGHLIGHT ABOVE 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
      EndObj
      TextField "ParentClass"
         Definition
            InitialText "Object"
            Origin 333,32
            Size 250,10
            Border BEVEL ,1,2
            Label "Parent Class:",HIGHLIGHT ABOVE 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
      EndObj
      Memo "SrcCodeList"
         Definition
            MemoDocument "SrcCodeDoc"
            ScrollBars RIGHT 
            InputStyle LOCKEDOUT 
            Origin 9,177
            Size 621,153
            Border BEVEL ,1,2
            Label "Method Source:",ABOVE 
         EndScript
         OnRelease
            WorkWithDocument "SrcCodeDoc"
            Let CurrentMethod = TrimString( TheLine )
            SetText "CurrentMethod",CurrentMethod
         EndScript
      EndObj
      TextMenu "ShowGeneral"
         Definition
            AttachTo MENU ,"CLASSES"
            Text "Show General   Classes"
            MenuFlags CHECKABLE CHECKIT 
         EndScript
         Occurred
            Do "RedisplayClasses","GENERAL"
            
         EndScript
      EndObj
      TextMenu "DisplaySource"
         Definition
            AttachTo MENU ,"METHODS"
            Text "Display Source"
            MenuFlags CHECKABLE CHECKIT 
         EndScript
         Occurred
            Do "DisplaySourceMI"
         EndScript
      EndObj
      TextMenu "ShowIntuition"
         Definition
            AttachTo MENU ,"CLASSES"
            Text "Show Intuition Classes"
            MenuFlags CHECKABLE 
         EndScript
         Occurred
            Do "RedisplayClasses","INTUITION"
            
            
         EndScript
      EndObj
      TextMenu "ShowSystem"
         Definition
            AttachTo MENU ,"CLASSES"
            Text "Show System    Classes"
            MenuFlags CHECKABLE 
         EndScript
         Occurred
            Do "RedisplayClasses","SYSTEM"
            
         EndScript
      EndObj
      TextMenu "ShowUser"
         Definition
            AttachTo MENU ,"CLASSES"
            Text "Show User      Classes"
            MenuFlags CHECKABLE 
         EndScript
         Occurred
            Do "RedisplayClasses","USER"
            
         EndScript
      EndObj
      TextMenu "GotoEditor"
         Definition
            AttachTo MENU ,"COMMANDS"
            Text "Goto Editor..."
            ShortCutKey "E"
         EndScript
         Occurred
            GotoCard "EditorCard"
         EndScript
      EndObj
      AKey "GotoARexxCard"
         Definition
            QualifiersPressed SHIFT RIGHTAMIGA 
            KeyPressed A 
         EndScript
         OnUp
            LastCard
         EndScript
      EndObj
      TextMenu "DisplayByteCodes"
         Definition
            AttachTo MENU ,"METHODS"
            Text "Display ByteCodes"
            MenuFlags CHECKABLE 
         EndScript
         Occurred
            Do "DisplayByteCodesMI"
            
         EndScript
      EndObj
      AKey "GotoHiddenFiles"
         Definition
            QualifiersPressed SHIFT RIGHTAMIGA 
            KeyPressed H 
         EndScript
         OnUp
            GotoCard "HiddenFiles"
            
         EndScript
      EndObj
      ErrorTrap "UserError_1"
         Occurred
            Do "HandleDeckError"
            
         EndScript
      EndObj
   EndObj
   Card "EditorCard"
      NoAttach
      Routine "LoadFile"
         Local filename   ;LoadFile subroutine.
         Let filename = AskForFileName( CommandPath, "Load a file...",10,12 )
         If filename <> "" AND Exists( filename ) = TRUE
            WorkWithDocument "EditText"
            Clear DOCUMENT 
            LoadDocument filename,"EditText"
            Let FileSaved       = FALSE
            Let CurrentEditFile = filename
         EndIf
      EndScript
      Routine "SaveFile"
         If Arg1 <> ""   ;SaveFile subroutine.
            WorkWithDocument "EditText"
            SaveDocument "EditText",Arg1
            Let FileSaved = TRUE
         Else
            Local filename
            Let filename = AskForFileName( CommandPath, "Save as file...",10,12)
            If filename <> ""
               WorkWithDocument "EditText"
               SaveDocument "EditText",filename
               Let FileSaved = TRUE
            EndIf
         EndIf
      EndScript
      Routine "TypeNewClassTemplate"
         Type "Class NewClassName :NewParentClass",NEWLINE 
         Type "| InstanceVariables |",NEWLINE 
         Type "[",NEWLINE 
         Type "   ClassMethods",NEWLINE 
      EndScript
      Routine "LoadFileToEditor"
         Local filename         ;LoadFileToEditor subroutine.
         Local safecounter      ;Arg1 == filename
         Local cline            ;Arg2 == classname
         Local objname
         Let objname = LowerCase( Arg1 )
         WorkWithDocument "EditText"
         Clear DOCUMENT 
         If objname = "generalclasses"
            Let filename = GeneralPath||Arg2||".st"
         ElseIf objname = "intuitionclasses"
            Let filename = IntuitionPath||Arg2||".st"
         ElseIf objname = "systemclasses"
            Let filename = SystemPath||Arg2||".st"
         ElseIf objname = "userclasses"
            Let filename = UserClassPath||Arg2||".st"
         EndIf
         If filename = ""
            ExitScript
         EndIf
         WorkWithDocument filename
         MoveCursorTo STARTOF DOCUMENT 
         Let safecounter = 1
         While safecounter <= LinesInDocument
            Let cline = TheLine
            WorkWithDocument "EditText"
            Type cline,NEWLINE 
            WorkWithDocument filename
            MoveCursor DOWN 
            Let safecounter = safecounter + 1
         EndLoop
         WorkWithDocument "EditText"
         MoveCursorTo STARTOF DOCUMENT 
      EndScript
      Routine "GetMethodFromFile"
         Nop         ;GetMethodFromFile subroutine.
         Nop         ;Arg1 == filename
         Nop         ;Arg2 == currentclass
         Nop         ;Arg3 == currentmethod template.
         Nop
         Do "LoadFileToEditor",Arg1,Arg2
         Do "FindCurrentMethod",Arg3
         Nop ;Let FromBrowser = LowerCase( Arg1 )
      EndScript
      Routine "TypeMethodList"
         Local cline      ;TypeMethodList subroutine.
         WorkWithDocument "RAM:MethodList"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument - 1
         Let cline = TheLine
         WorkWithDocument "EditText"
         MoveCursorTo STARTOF DOCUMENT 
         SearchFor "["
         MoveCursor RIGHT 
         Type "",NEWLINE 
         While safety > 0 ;AND cline <> NOTHING
            WorkWithDocument "EditText"
            Type cline||" ",NEWLINE 
            WorkWithDocument "RAM:MethodList"
            MoveCursor DOWN 
            Let cline  = TheLine
            Let safety = safety - 1
         EndLoop
         WorkWithDocument "EditText"
         Type "]",NEWLINE 
         SearchFor "ClassMethods"
         If SearchFound = TRUE
            Delete LINE 
         EndIf
         Dos "Delete RAM:MethodList" ;Clean up namespace!
      EndScript
      Routine "Instruct"
         SetPen 0      ;Instruct SubRoutine.
         PrintText Instructions,9,178
         Let Instructions = Arg1
         SetPen 13
         PrintText Instructions,9,178
      EndScript
      Routine "InsertClassReq"
         Local classfile      ;InsertClassReq SubRoutine.
         Local methodfile
         Local parentclass
         Local newclass
         Local termclass
         WorkWithDocument "EditCommList"
         MoveCursorTo STARTOF DOCUMENT 
         Clear DOCUMENT 
         Type Arg1,NEWLINE       ;Arg1 = classfile
         Type Arg2,NEWLINE       ;Arg2 = methodfile
         Type Arg3,NEWLINE       ;Arg3 = parentclass
         Type Arg4,NEWLINE       ;Arg4 = newclass
         Type Arg5,NEWLINE       ;Arg5 = termclass
         Let classfile   = Arg1
         Let methodfile  = Arg2
         Let parentclass = Arg3
         Let newclass    = Arg4
         Let termclass   = Arg5
         GotoCard "InsertNewClassReq",classfile,methodfile,parentclass,newclass,termclass
      EndScript
      Routine "InsertNewClass"
         Local pclass         ;InsertNewClass,parentclass,newclass
         Local newclass
         Local termclass
         Local classfile
         Local methodfile
         Let pclass   = Arg1
         Let newclass = Arg2
         If LowerCase( DefaultBrowser ) = "generalbrowser"
            Let classfile  = GeneralPath||"GeneralClasses"
            Let methodfile = GeneralPath||"GeneralMethods"
         ElseIf LowerCase( DefaultBrowser ) = "intuitionbrowser"
            Let classfile  = IntuitionPath||"IntuitionClasses"
            Let methodfile = IntuitionPath||"IntuitionMethods"
         ElseIf LowerCase( DefaultBrowser ) = "systembrowser"
            Let classfile  = SystemPath||"SystemClasses"
            Let methodfile = SystemPath||"SystemMethods"
         ElseIf LowerCase( DefaultBrowser ) = "userbrowser"
            Let classfile  = UserClassPath||"UserClasses"
            Let methodfile = UserClassPath||"UserMethods"
         EndIf
         LoadDocument classfile,"SearchList"
         MoveCursorTo STARTOF DOCUMENT 
         SearchFor pclass,BYWORD 
         Do "SearchForSibling",TheLine,"SearchList"
         Let termclass = TrimString( TheLine )
         Do "InsertClassReq",classfile,methodfile,pclass,newclass,termclass
      EndScript
      Routine "SaveNewClass"
         Local safety   ;SaveNewClass,classname  subroutine.
         Local Path
         Local cline
         Local title
         Let title = WindowTitle
         If LowerCase( DefaultBrowser ) = "generalbrowser"
            Let Path = GeneralPath
         ElseIf LowerCase( DefaultBrowser ) = "intuitionbrowser"
            Let Path = IntuitionPath
         ElseIf LowerCase( DefaultBrowser ) = "systembrowser"
            Let Path = SystemPath
         ElseIf LowerCase( DefaultBrowser ) = "userbrowser"
            Let Path = UserClassPath
         EndIf
         Let newclassfile = Path||Arg1||".st"
         Do "Instruct","Saving "||newclassfile||" as a new class..."
         WorkWithDocument "EditText"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         Let cline  = TheLine
         MakeDocument newclassfile
         While safety > 0
            WorkWithDocument newclassfile
            Type cline,NEWLINE 
            WorkWithDocument "EditText"
            MoveCursor DOWN 
            Let safety = safety - 1
            Let cline  = TheLine
         EndLoop
         SaveDocument newclassfile
      EndScript
      Routine "SearchForSibling"
         Local numspaces      ;SearchForSibling,parentclass,"SearchList"
         Local pclass      ;SubRoutine called from InsertNewClass.
         Local i
         Local nextnum
         Let pclass    = Arg1
         Let numspaces = 0
         Let nextnum   = 0
         Let i         = 1
         WorkWithDocument Arg2
         While FindChars( pclass, " ", i ) > 0 AND i < 20
            Let numspaces = numspaces + 1   ;Count indents.
            Let i         = i + 1
         EndLoop
         MoveCursor DOWN 
         While nextnum <> numspaces
            Let i = 1
            While FindChars( TheLine, " ", i ) > 0 AND i < 20
               Let nextnum = nextnum + 1   ;Count indents.
               Let i       = i + 1
            EndLoop
            If nextnum > numspaces   ;SubClass of ParentClass!
               MoveCursor DOWN 
               MoveCursorTo STARTOF LINE 
               Let nextnum = 0
            ElseIf nextnum <= numspaces
               ExitLoop
            EndIf
         EndLoop
      EndScript
      Routine "TypeInstanceVarList"
         Local cline      ;TypeInstanceVarList SubRoutine.
         WorkWithDocument "RAM:InstanceVarList"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument - 1
         Let cline = TheLine
         While TrimString( cline ) <> NOTHING AND safety > 0
            WorkWithDocument "EditText"
            Type cline||" "
            WorkWithDocument "RAM:InstanceVarList"
            MoveCursor DOWN 
            Let cline  = TrimString( TheLine )
            Let safety = safety - 1
         EndLoop
         Dos "Delete RAM:InstanceVarList" ;Clean up namespace!
      EndScript
      Routine "SetBrowserMenu"
         ; ---------------------------------
         ; SetBrowserMenu SubRoutine.
         ; ---------------------------------
         If BrowserDisplay = "GENERAL"
            SetObjectState "GeneralClass",TRUE
            SetObjectState "IntuitionClass",FALSE
            SetObjectState "SystemClass",FALSE
            SetObjectState "UserClass",FALSE
         ElseIf BrowserDisplay = "INTUITION"
            SetObjectState "IntuitionClass",TRUE
            SetObjectState "GeneralClass",FALSE
            SetObjectState "SystemClass",FALSE
            SetObjectState "UserClass",FALSE
         ElseIf BrowserDisplay = "SYSTEM"
            SetObjectState "SystemClass",TRUE
            SetObjectState "IntuitionClass",FALSE
            SetObjectState "GeneralClass",FALSE
            SetObjectState "UserClass",FALSE
         ElseIf BrowserDisplay = "USER"
            SetObjectState "UserClass",TRUE
            SetObjectState "IntuitionClass",FALSE
            SetObjectState "SystemClass",FALSE
            SetObjectState "GeneralClass",FALSE
         Else
            SetObjectState "GeneralClass",TRUE
            SetObjectState "IntuitionClass",FALSE
            SetObjectState "SystemClass",FALSE
            SetObjectState "UserClass",FALSE
         EndIf
      EndScript
      Routine "UseExternalEditor"
         ; ------------------------------------------
         ; UseExternalEditor SubRoutine.
         ; ------------------------------------------
         
         Local filename
         Local cmd
         
         Let filename = Do( "FindClassFileName", CurrentClass )
         
         Let cmd = ExternalEditor
         If Browserdisplay = "GENERAL"
            Let filename = GeneralPath||filename
         ElseIf Browserdisplay = "INTUITION"
            Let filename = IntuitionPath||filename
         ElseIf BrowserDisplay = "SYSTEM"
            Let filename = SystemPath||filename
         ElseIf BrowserDisplay = "USER"
            Let filename = UserPath||filename
         Else
            Let filename = GeneralPath||filename
         EndIf
         
         Let cmd = cmd|||filename
         Dos cmd
         
         Do "UpdateCurrentMethod",filename,CurrentClass,CurrentMethod
      EndScript
      Routine "DeleteAClass"
         GotoCard "DeleteClassCard"
      EndScript
      Routine "SetupDisplay"
         Local safety
         
         SetText "ParentClass",ParentClass
         SetText "CurrentClass",CurrentClass
         SetText "CurrentMethod",CurrentMethod
         WorkWithDocument "EditText"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         While TrimString( TheLine ) <> CurrentMethod AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
      EndScript
      Routine "NewCurrentMethod"
         ; -------------------------------
         ; NewCurrentMethod() SubRoutine.
         ; -------------------------------
         
         Let CurrentMethod = TrimString( TextFrom( "CurrentMethod" ))
      EndScript
      Routine "UselastMethod"
         ; ------------------------------
         ; UseLastMethod() SubRoutine.
         ; ------------------------------
         
         Local safety
         
         WorkWithDocument "EditText"
         MoveCursorTo ENDOF DOCUMENT 
         Let safety = LinesInDocument
         
         While FindChars( TheLine, "|", 1 ) <> 1 AND safety > 0
            MoveCursor UP 
            Let safety = safety - 1
         EndLoop
         
         MoveCursor DOWN 
         
         While FindChars( TheLine, String( Char( 34 )), 1 ) > 0
            MoveCursor DOWN 
         EndLoop
         
         Let CurrentMethod = TrimString( TheLine )
         SetText "CurrentMethod",TrimString( TheLine )
         
      EndScript
      Routine "SelectPrevMethod"
         ; ------------------------------
         ; SelectPrevMethod SubRoutine.
         ; ------------------------------
         
         Local cm
         Local safety
         
         Let cm = TrimString( CurrentMethod )
         
         WorkWithDocument "EditText"
         Let safety = LinesInDocument
         MoveCursorTo ENDOF DOCUMENT 
         
         While TrimString( TheLine ) <> cm AND safety > 0
            MoveCursor UP 
            Let safety = safety - 1
         EndLoop
         
         MoveCursor UP ,2         ; Goto the last line of the prev' method.
         Let safety = safety - 2
         
         While FindChars( TheLine , "|", 1 ) = 0 AND safety > 0
            MoveCursor UP 
            Let safety = safety - 1
            If FindChars( TheLine, "[", 1 ) = 1
               Do "UseFirstMethod"
               ExitScript
            EndIf
         EndLoop
         
         MoveCursor DOWN 
         SetText "CurrentMethod",TrimString( TheLine )
         Let CurrentMethod = TrimString( TheLine )
         
         
         
      EndScript
      Routine "SetupEditorCard"
         ; -------------------------------
         ; SetupEditorCard SubRoutine.
         ; -------------------------------
         
         WorkWithDocument "EditText"
         Clear DOCUMENT 
         
         Do "CopyDoc","EditText","SrcCodeDoc"
         Do "SetupDisplay"
         Do "SetBrowserMenu"
         
      EndScript
      AfterAttachment
         Do "SetupEditorCard"
      EndScript
      Routine "UseFirstMethod"
         ; ------------------------------
         ; UseFirstMethod() SubRoutine.
         ; ------------------------------
         
         Local safety
         
         WorkWithDocument "EditText"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While FindChars( TheLine, "[", 1 ) < 1 AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         MoveCursor DOWN 
         
         While FindChars( TheLine, String( Char( 34 )), 1 ) > 0 AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         Let CurrentMethod = TrimString( TheLine )
         SetText "CurrentMethod",TrimString( TheLine )
         
      EndScript
      Routine "SelectNextMethod"
         ; ------------------------------
         ; SelectNextMethod SubRoutine.
         ; ------------------------------
         
         Local cm
         Local safety
         
         Let cm = TrimString( CurrentMethod )
         
         WorkWithDocument "EditText"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         While TrimString( TheLine ) <> "[" AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         While TrimString( TheLine ) <> cm AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         While FindChars( TheLine , "|", 1 ) = 0 AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
            If FindChars( TheLine, "]", 1 ) = 1 AND TheColumnNumber = 1
               Do "UseFirstMethod"
               ExitScript
            EndIf
         EndLoop
         MoveCursor DOWN 
         
         While FindChars( TheLine, String( Char( 34 )), 1 ) > 0 AND safety > 0
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         SetText "CurrentMethod",TrimString( TheLine )
         Let CurrentMethod = TrimString( TheLine )
      EndScript
      Window "UserWindow"
         Definition
            Origin 0,14
            Title "AmigaTalk © 1998 -- Methods Editor:"
            WindowObjects CLOSEBUTTON DEPTHBUTTONS DRAGBAR 
            WindowZoom 0,14,240,16
            Size 640,300
            WindowFlags ACTIVATE TOFRONT WORKBENCH 
            VisualEffects NONE ,WAIT 
         EndScript
         OnCloseButton
            GotoCard "ClassBrowser"
            
         EndScript
         OnActivated
            Do "SetupDisplay"
         EndScript
         OnResized
            Do "SetupDisplay"
         EndScript
      EndObj
      TextMenu "Load"
         Definition
            AttachTo MENU ,"PROJECT"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 0,1,JAM1 
            Text "Load"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "L"
         EndScript
         Occurred
            Do "LoadFile"
         EndScript
      EndObj
      TextMenu "Save"
         Definition
            AttachTo MENU ,"PROJECT"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 0,1,JAM1 
            Text "Save"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "S"
         EndScript
         Occurred
            Do "SaveNewClass",TextFrom( "CurrentClass" )
            Do "Instruct","Ready!"
         EndScript
      EndObj
      TextMenu "SaveAs"
         Definition
            AttachTo MENU ,"PROJECT"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 0,1,JAM1 
            Text "Save As.."
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "A"
         EndScript
         Occurred
            Do "SaveFile",""
         EndScript
      EndObj
      TextMenu "Quit"
         Definition
            AttachTo MENU ,"PROJECT"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 0,1,JAM1 
            Text "Quit"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "Q"
         EndScript
         Occurred
            If FileSaved = FALSE
               Do "SaveFile",""
            EndIf
            Quit
         EndScript
      EndObj
      Memo "SrcCodeList"
         Definition
            MemoDocument "EditText"
            ScrollBars RIGHT BOTTOM 
            Origin 10,31
            Size 617,199
            Border DOUBLEBEVEL ,2,1
            Label "Current Method Source:",ABOVE 
            Font "topaz",8
            TextColors 7,0,JAM2 
            Style PLAIN ,2,3
         EndScript
         OnClick
            WorkWithDocument "EditText"
            Let cm = TrimString( TheLine )
            SetText "CurrentMethod",cm
            Let CurrentMethod = cm
         EndScript
      EndObj
      TextField "ParentClass"
         Definition
            InitialText ""
            Origin 133,262
            Size 180,10
            Border DOUBLEBEVEL ,2,1
            Label "Parent Class:"
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "ParentClass",""
         EndScript
         OnRelease
            Nop   ;ParentClass field Release event script.
            If UserActionMode = EnterParentClass AND TextFrom( "ParentClass" ) <> NOTHING
               WorkWithDocument "EditText"
               MoveCursorTo STARTOF DOCUMENT 
               MoveCursorTo NEXTWORD ,2
               Delete TOENDOFLINE 
               Type ":"||TextFrom( "ParentClass" )
               Let UserActionMode = EnterInstanceVars
               Do "Instruct","Click in Current Method: text gadget..."
            EndIf
         EndScript
      EndObj
      TextField "CurrentClass"
         Definition
            InitialText ""
            Origin 133,282
            Size 180,10
            Border DOUBLEBEVEL ,2,1
            Label "Current Class:"
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "CurrentClass",""
         EndScript
         OnRelease
            Nop   ;CurrentClass field Release event script.
            If UserActionMode = EnterClassName AND TextFrom( "CurrentClass" ) <> NOTHING
               WorkWithDocument "EditText"
               MoveCursorTo STARTOF DOCUMENT 
               MoveCursorTo STARTOF NEXTWORD 
               Delete TOENDOFLINE 
               Type TextFrom( "CurrentClass" )|||":NewParentClass"
               Let UserActionMode = EnterParentClass
               Do "Instruct","Click in Current Method: text gadget..."
            EndIf
         EndScript
      EndObj
      TextField "SearchText"
         Definition
            InitialText ""
            Origin 444,262
            Size 180,10
            Border DOUBLEBEVEL ,2,1
            Label "Search for:"
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "SearchText",""
         EndScript
         OnRelease
            If ObjectState( "SearchByWord" ) = TRUE
               If ObjectState( "SearchNoCase" ) = TRUE
                  SearchFor TextFrom( "SearchText" ),BYWORD NOCASE 
               Else
                  SearchFor TextFrom( "SearchText" ),BYWORD 
               EndIf
            Else
               If ObjectState( "SearchNoCase" ) = TRUE
                  SearchFor TextFrom( "SearchText" ),NOCASE 
               Else
                  SearchFor TextFrom( "SearchText" )
               EndIf
            EndIf
         EndScript
      EndObj
      TextField "ReplaceText"
         Definition
            InitialText ""
            Origin 444,282
            Size 180,10
            Border DOUBLEBEVEL ,2,1
            Label "Replace with:"
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "ReplaceText",""
         EndScript
         OnRelease
            WorkWithDocument "EditText"
            If ObjectState( "ReplaceByWord" ) = TRUE
               If ObjectState( "ReplaceNoCase" ) = TRUE
                  If ObjectState( "ReplaceGlobal" ) = TRUE
                     MoveCursorTo STARTOF DOCUMENT 
                     Replace TextFrom( "SearchText" ),TextFrom( "ReplaceText" ),BYWORD NOCASE GLOBAL 
                  Else
                     Replace TextFrom( "SearchText" ),TextFrom( "ReplaceText" ),BYWORD NOCASE 
                  EndIf
               Else
                  If ObjectState( "ReplaceGlobal" ) = TRUE
                     MoveCursorTo STARTOF DOCUMENT 
                     Replace TextFrom( "SearchText" ),TextFrom( "ReplaceText" ),BYWORD GLOBAL 
                  Else
                     Replace TextFrom( "SearchText" ),TextFrom( "ReplaceText" ),BYWORD 
                  EndIf
               EndIf
            Else
               If ObjectState( "ReplaceNoCase" ) = TRUE
                  If ObjectState( "ReplaceGlobal" ) = TRUE
                     MoveCursorTo STARTOF DOCUMENT 
                     Replace TextFrom( "SearchText" ),TextFrom( "ReplaceText" ),NOCASE GLOBAL 
                  Else
                     Replace TextFrom( "SearchText" ),TextFrom( "ReplaceText" ),NOCASE 
                  EndIf
               Else
                  If ObjectState( "ReplaceGlobal" ) = TRUE
                     MoveCursorTo STARTOF DOCUMENT 
                     Replace TextFrom( "SearchText" ),TextFrom( "ReplaceText" ),GLOBAL 
                  Else
                     Replace TextFrom( "SearchText" ),TextFrom( "ReplaceText" )
                  EndIf
               EndIf
            EndIf
         EndScript
      EndObj
      TextMenu "GeneralClass"
         Definition
            AttachTo MENU ,"INFO"
            Text "General Classes"
            Highlight NONE 
            MenuFlags CHECKABLE CHECKIT 
         EndScript
      EndObj
      TextMenu "IntuitionClass"
         Definition
            AttachTo MENU ,"INFO"
            Text "Intuition Classes"
            Highlight NONE 
            MenuFlags CHECKABLE 
         EndScript
      EndObj
      TextMenu "SystemClass"
         Definition
            AttachTo MENU ,"INFO"
            Text "System Classes"
            Highlight NONE 
            MenuFlags CHECKABLE 
         EndScript
      EndObj
      TextMenu "UserClass"
         Definition
            AttachTo MENU ,"INFO"
            Text "User Classes"
            Highlight NONE 
            MenuFlags CHECKABLE 
         EndScript
      EndObj
      TextMenu "UseExternal"
         Definition
            AttachTo MENU ,"COMMANDS"
            Text "Use External Editor..."
         EndScript
         Occurred
            Do "UseExternalEditor"
            
         EndScript
      EndObj
      TextMenu "EditToolTypes"
         Definition
            AttachTo MENU ,"COMMANDS"
            Text "Edit ToolTypes..."
         EndScript
         Occurred
            GotoCard "ToolTypesEditor"
         EndScript
      EndObj
      TextMenu "TopClass"
         Definition
            AttachTo MENU ,"EDIT"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 9,1,JAM1 
            Text "Top of Class"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "T"
         EndScript
         Occurred
            Local safety
            SetWordDelimiters " "
            WorkWithDocument "EditText"
            If LinesInDocument = 0
               ExitScript
            EndIf
            Nop ;Let safety = LinesInDocument
            While TheWord <> "Class"   ; AND safety > 0
               MoveCursorTo STARTOF PREVIOUSWORD 
               Let safety = TheLineNumber
               If safety <= 1
                  ExitLoop
               EndIf
            EndLoop
         EndScript
      EndObj
      TextMenu "TopFile"
         Definition
            AttachTo MENU ,"EDIT"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 9,1,JAM1 
            Text "Top of  File"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "F"
         EndScript
         Occurred
            WorkWithDocument "EditText"
            MoveCursorTo STARTOF DOCUMENT 
         EndScript
      EndObj
      TextMenu "EndClass"
         Definition
            AttachTo MENU ,"EDIT"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 9,1,JAM1 
            Text "End of Class"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "E"
         EndScript
         Occurred
            If LinesInDocument = 0
               ExitScript
            EndIf
            SetWordDelimiters " "
            WorkWithDocument "EditText"
            While TheWord <> "]"
               MoveCursorTo STARTOF NEXTWORD 
               If TheWord = "]" AND TheColumnNumber > 1
                  MoveCursorTo STARTOF NEXTWORD 
               EndIf
            EndLoop
         EndScript
      EndObj
      TextMenu "BotFile"
         Definition
            AttachTo MENU ,"EDIT"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 9,1,JAM1 
            Text "Bott of File"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "B"
         EndScript
         Occurred
            WorkWithDocument "EditText"
            MoveCursorTo ENDOF DOCUMENT 
         EndScript
      EndObj
      TextMenu "Kill_EOL"
         Definition
            AttachTo MENU ,"EDIT"
            Text "Kill to  EOL"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 13,1,JAM2 
            ShortCutKey "Y"
         EndScript
         Occurred
            Delete TOENDOFLINE 
         EndScript
      EndObj
      TextMenu "Kill_Line"
         Definition
            AttachTo MENU ,"EDIT"
            Text "Kill the Line"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 13,1,JAM2 
            ShortCutKey "K"
         EndScript
         Occurred
            Delete LINE 
         EndScript
      EndObj
      TextMenu "SearchByWord"
         Definition
            AttachTo MENU ,"SEARCH_REPLACE"
            Text "Search    for   WholeWords"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 9,1,JAM2 
            MenuFlags CHECKABLE 
         EndScript
      EndObj
      TextMenu "SearchNoCase"
         Definition
            AttachTo MENU ,"SEARCH_REPLACE"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 9,1,JAM1 
            Text "Search  lower = uppercase"
            MenuFlags CHECKABLE 
            Highlight COMPLEMENT 
            ShortCutKey ""
         EndScript
      EndObj
      TextMenu "ReplaceByWord"
         Definition
            AttachTo MENU ,"SEARCH_REPLACE"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 13,1,JAM1 
            Text "Replace    by   WholeWord"
            MenuFlags CHECKABLE 
            Highlight COMPLEMENT 
            ShortCutKey ""
         EndScript
      EndObj
      TextMenu "ReplaceNoCase"
         Definition
            AttachTo MENU ,"SEARCH_REPLACE"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 13,1,JAM1 
            Text "Replace lower = uppercase"
            MenuFlags CHECKABLE 
            Highlight COMPLEMENT 
            ShortCutKey ""
         EndScript
      EndObj
      TextMenu "ReplaceGlobal"
         Definition
            AttachTo MENU ,"SEARCH_REPLACE"
            Text "Replace   ALL   occurrences"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 13,1,JAM2 
            MenuFlags CHECKABLE 
         EndScript
      EndObj
      AKey "TabKey"
         Definition
            QualifiersPressed NONE 
            KeyPressed TAB 
         EndScript
         OnUp
            Local tabsize
            Let tabsize = DefaultTabSize
            WorkWithDocument "EditText"
            While tabsize > 0
               Type " "
               Let tabsize = tabsize - 1
            EndLoop
         EndScript
      EndObj
      AKey "HelpSystem"
         Definition
            QualifiersPressed NONE 
            KeyPressed HELP 
         EndScript
         OnUp
            Do "ReportError",4,"Help"
         EndScript
      EndObj
      AKey "CutKey"
         Definition
            QualifiersPressed RIGHTAMIGA 
            KeyPressed X 
         EndScript
         OnUp
            Do "ReportError",4,"A-x"
         EndScript
      EndObj
      AKey "CopyKey"
         Definition
            QualifiersPressed RIGHTAMIGA 
            KeyPressed C 
         EndScript
         OnUp
            Do "ReportError",4,"A-c"
         EndScript
      EndObj
      AKey "PasteKey"
         Definition
            QualifiersPressed RIGHTAMIGA 
            KeyPressed V 
         EndScript
         OnUp
            Do "ReportError",4,"A-v"
         EndScript
      EndObj
      TextField "CurrentMethod"
         Definition
            InitialText ""
            Origin 133,242
            Size 180,10
            Border DOUBLEBEVEL ,2,1
            Label "Current Method:"
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "CurrentMethod",""
            
         EndScript
         OnRelease
            Do "NewCurrentMethod"
            
         EndScript
      EndObj
      TextMenu "AddNewClass"
         Definition
            AttachTo MENU ,"COMMANDS"
            Text "Add New Class..."
            ShortCutKey "N"
         EndScript
         Occurred
            GotoCard "InsertNewClassReq"
         EndScript
      EndObj
      TextMenu "DeleteClass"
         Definition
            AttachTo MENU ,"COMMANDS"
            Text "Delete a Class..."
         EndScript
         Occurred
            Do "DeleteAClass"
            
         EndScript
      EndObj
      AreaButton "PrevMethod"
         Definition
            Origin 325,239
            Border BEVEL 
            Text " « Prev "
            Font "topaz",8
            Size 68,16
         EndScript
         OnRelease
            Do "SelectPrevMethod"
            
         EndScript
      EndObj
      AreaButton "NextMethod"
         Definition
            Origin 401,239
            Border BEVEL 
            Text " Next » "
            Font "topaz",8
            Size 68,16
         EndScript
         OnRelease
            Do "SelectNextMethod"
            
            
         EndScript
      EndObj
      AKey "EditBrowserFiles"
         Definition
            QualifiersPressed CONTROL ALT 
            KeyPressed E 
         EndScript
         OnUp
            Do "EditBrowserFile"
         EndScript
      EndObj
      ErrorTrap "UserError_1"
         Occurred
            Do "HandleDeckError"
         EndScript
      EndObj
   EndObj
   Card "InsertNewClassReq"
      NoAttach
      Routine "InitNewClassReq"
         Local safety   ;InitNewClassReq SubRoutine.
         Local title      ;Called from AfterAttachment event on
         Local EndCheck   ;InsertNewClassReq card.
         Let title = WindowTitle
         If Arg1 = NOTHING
            WorkWithDocument "EditCommList"
            MoveCursorTo STARTOF DOCUMENT 
            Let ClassFile    = TrimString( TheLine )
            MoveCursor DOWN 
            Let MethodFile   = TrimString( TheLine )
            MoveCursor DOWN 
            Let ParentClass  = TrimString( TheLine )
            MoveCursor DOWN 
            Let CurrentClass = TrimString( TheLine )
            MoveCursor DOWN 
            Let TermClass    = TrimString( TheLine )
         Else
            Do "DEBUG","Setting parameters..."
            Let ClassFile    = Arg1
            Let MethodFile   = Arg2
            Let ParentClass  = Arg3
            Let CurrentClass = Arg4
            Let TermClass    = Arg5
         EndIf
         WorkWithDocument "TheClassList"
         MoveCursorTo STARTOF DOCUMENT 
         Clear DOCUMENT 
         Type ParentClass,NEWLINE 
         Type TermClass,NEWLINE 
         MoveCursorTo STARTOF DOCUMENT 
         SetWindowTitle "Making Methods list..."
         WorkWithDocument "NewMethods"
         MoveCursorTo STARTOF DOCUMENT 
         Clear DOCUMENT 
         WorkWithDocument "EditText"
         MoveCursorTo STARTOF DOCUMENT 
         SearchFor "["
         MoveCursor DOWN 
         Let cline  = TheLine
         Let safety = LinesInDocument - 1
         If safety <= 0
            ExitScript
         EndIf
         WorkWithDocument "NewMethods"
         Type TrimString( cline ),NEWLINE 
         SetWindowTitle "Filtering new methods from Editor..."
         While safety >= 0
            WorkWithDocument "EditText"
            While FindChars( TheLine, "|", 1 ) <> 1 AND safety >= 0
               Let EndCheck = FindChars( TheLine, "]", 1 )
               If EndCheck = 1
                  ExitLoop
               EndIf
               MoveCursor DOWN 
               Let safety = safety - 1
            EndLoop
            MoveCursor DOWN 
            Let safety   = safety - 1
            Let cline    = TheLine
            Let EndCheck = FindChars( cline, "]", 1 )
            If EndCheck = 1
               ExitLoop
            EndIf
            WorkWithDocument "NewMethods"
            Type TrimString( cline ),NEWLINE 
         EndLoop
         SetWindowTitle title
         WorkWithDocument "NewMethods"
         MoveCursorTo STARTOF DOCUMENT 
      EndScript
      Routine "SetupFullClassList"
         ; --------------------------------
         ; SetupFullClassList
         ; --------------------------------
         
         Local safety
         Local class
         
         WorkWithDocument "FullClassList"
         Clear DOCUMENT 
         
         Do "ResetClassLists"
         
         If BrowserDisplay = "GENERAL"
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"SystemClasses"
            Do "LoadClasses",BrowserPath||"UserClasses"
         ElseIf BrowserDisplay = "INTUITION"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"SystemClasses"
            Do "LoadClasses",BrowserPath||"UserClasses"
         ElseIf BrowserDisplay = "SYSTEM"
            Do "LoadClasses",BrowserPath||"SystemClasses"
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"UserClasses"
         ElseIf BrowserDisplay = "USER"
            Do "LoadClasses",BrowserPath||"UserClasses"
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"SystemClasses"
         Else
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"SystemClasses"
            Do "LoadClasses",BrowserPath||"UserClasses"
         EndIf
         
         WorkWithDocument "ClassesDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         ; Copy ClassesDoc to FullClassList:
         
         While safety > 0
            Let class = TheLine
            
            WorkWithDocument "FullClassList"
            Type class,NEWLINE 
            
            WorkWithDocument "ClassesDoc"
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         WorkWithDocument "FullClassList"
         MoveCursorTo STARTOF DOCUMENT 
         
      EndScript
      AfterAttachment
         ; --------------------------------------------
         ; AfterAttachment script for InsertNewClassReq
         ; --------------------------------------------
         
         Do "SetupFullClassList"
         
         SetText "ParentClass",ParentClass
         SetText "ClassName",CurrentClass
      EndScript
      Routine "CheckForMethods"
         ; ------------------------------------------
         ; CheckForMethods SubRoutine.
         ; ------------------------------------------
         
         Local rval
         Local safety
         Local str
         
         Let rval = FALSE
         
         WorkWithDocument "NewMethods"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While safety > 0
            Let str = TrimString( TheLine )
            If str <> NOTHING
               Let rval = TRUE
               ExitScript rval
            EndIf
            
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         ExitScript rval
      EndScript
      Routine "FindClassFile"
         ; ------------------------------------
         ; FindClassFile( parentclassname )
         ; ------------------------------------
         
         Local rval
         Local classname
         
         Let classname = TrimString( Arg1 )
         Let rval      = BrowserPath
         
         LoadDocument BrowserPath||"GeneralClasses","tdoc"
         WorkWithDocument "tdoc"
         MoveCursorTo STARTOF DOCUMENT 
         
         Do "Search",classname,1
         If TrimString( TheLine ) = classname
            Let rval = rval||"GeneralClasses"
            ExitScript rval
         EndIf
         
         LoadDocument BrowserPath||"IntuitionClasses","tdoc"
         WorkWithDocument "tdoc"
         MoveCursorTo STARTOF DOCUMENT 
         
         Do "Search",classname,1
         If TrimString( TheLine ) = classname
            Let rval = rval||"IntuitionClasses"
            ExitScript rval
         EndIf
         
         LoadDocument BrowserPath||"SystemClasses","tdoc"
         WorkWithDocument "tdoc"
         MoveCursorTo STARTOF DOCUMENT 
         
         Do "Search",classname,1
         If TrimString( TheLine ) = classname
            Let rval = rval||"SystemClasses"
            ExitScript rval
         EndIf
         
         LoadDocument BrowserPath||"UserClasses","tdoc"
         WorkWithDocument "tdoc"
         MoveCursorTo STARTOF DOCUMENT 
         
         Do "Search",classname,1
         If TrimString( TheLine ) = classname
            Let rval = rval||"UserClasses"
            ExitScript rval
         EndIf
         
         Let rval = rval||"UserClasses"
         ExitScript rval
      EndScript
      Routine "TypeNewMethods"
         ; ------------------------------------------------
         ; TypeNewMethods( filebuffer )
         ; ------------------------------------------------
         
         Local str
         Local safety
         
         WorkWithDocument "NewMethods"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While safety > 0
            Let str = TrimString( TheLine )
            
            FileWriteLine Arg1,str
            
            If safety > 1
               FileWriteLine Arg1,"|"
            EndIf
            
            WorkWithDocument "NewMethods"
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
      EndScript
      Routine "WriteNewClass"
         ; --------------------------------------------------------
         ; WriteNewClass( dir, filename, parentclass, classname )
         ; --------------------------------------------------------
         
         Local dir
         
         Let dir = TrimString( Arg1 )
         If FindChars( UpperCase( dir ), "GENERAL", 1 ) > 0
            Let dir = GeneralPath
         ElseIf FindChars( UpperCase( dir ), "INTUITION", 1 ) > 0
            Let dir = IntuitionPath
         ElseIf FindChars( UpperCase( dir ), "SYSTEM", 1 ) > 0
            Let dir = SystemPath
         ElseIf FindChars( UpperCase( dir ), "USER", 1 ) > 0
            Let dir = UserPath
         Else
            Let dir = UserPath
         EndIf
         
         OpenFile dir||Arg2,"fbf",WRITEONLY ,NEWFILE 
         
         FileWriteLine "fbf","""New Class for AmigaTalk:"""
         FileWriteLine "fbf","Class "||TrimString( Arg4 )|||":"||TrimString( Arg3 )
         
         Do "TypeClassInstanceVars","fbf"
         
         FileWriteLine "fbf","["
         
         Do "TypeNewMethods","fbf"
         
         FileWriteLine "fbf","]"
         
         Close "fbf"
      EndScript
      Routine "TypeClassInstanceVars"
         ; ----------------------------------------------
         ; TypeClassInstanceVars( filebuffer )
         ; ----------------------------------------------
         
         Local safety
         Local str
         Local filebuff
         
         Let filebuff = TrimString( Arg1 )
         
         WorkWithDocument "InstanceVarsDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         Let str    = TrimString( TheLine )
         
         If str <> NOTHING
            FileWriteChars filebuff,"| "||str||" "
         EndIf
         
         If safety > 1
            Let safety = safety - 1
            FileWriteLine filebuff,""
            
            WorkWithDocument "InstanceVarsDoc"
            MoveCursor DOWN 
            
            While safety > 0 AND TrimString( TheLine ) <> NOTHING
               Let str = TrimString( TheLine )
               FileWriteLine filebuff,str
               
               WorkWithDocument "InstanceVarsDoc"
               MoveCursor DOWN 
               Let safety = safety - 1
            EndLoop
         EndIf
         
         FileWriteLine filebuff,"|"
      EndScript
      Routine "UpdateClassList"
         ; ---------------------------------------------------------
         ; UpdateClassList( dir, parentname, classname, filename )
         ; ---------------------------------------------------------
         
         Local safety
         Local str
         Local pline
         Local indentsize
         
         MakeDocument "NewList"
         
         LoadDocument TrimString( Arg1 ),"olddoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While TrimString( TheLine ) <> TrimString( Arg2 ) AND safety > 0
            Let str = TheLine
            WorkWithDocument "NewList"
            Type str,NEWLINE 
            
            WorkWithDocument "olddoc"
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         ; ------------------------ Type out the Parent class:
         WorkWithDocument "olddoc"
         Let pline = TheLine
         MoveCursor DOWN 
         WorkWithDocument "NewList"
         Type pline,NEWLINE 
         Let safety = safety - 1
         ; ------------------------
         
         Let indentsize = Do( "FindIndent", pline )
         While indentsize > 0
            Type " "
            Let indentsize = indentsize - 1
         EndLoop
         
         Type Arg3||":"||Arg4,NEWLINE 
         
         WorkWithDocument "olddoc"
         While TrimString( TheLine ) <> NOTHING AND safety > 0
            Let str = TheLine
            WorkWithDocument "NewList"
            Type str,NEWLINE 
            
            WorkWithDocument "olddoc"
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         SaveDocument "NewList",TrimString( Arg1 )
      EndScript
      Routine "FindIndent"
         ; ----------------------------------------
         ; FindIndent( parentname )
         ; ----------------------------------------
         
         Local rval
         
         Let rval = NumberOfChars(Arg1) - NumberOfChars( TrimString( Arg1))
         
         If rval = 0
            Let rval = 1 ; need at least one space!
         EndIf
         
         ExitScript rval
      EndScript
      Routine "InsertClass_Methods"
         ; ----------------------------------------
         ; InsertClass_Methods SubRoutine.
         ; ----------------------------------------
         
         Local ClassFile
         Local classname
         Local parentname
         Local filename
         Local dummy
         
         Let classname  = TrimString( TextFrom( "ClassName"   ) )
         Let filename   = TrimString( TextFrom( "FileName"    ) )
         Let parentname = TrimString( TextFrom( "ParentClass" ) )
         
         If classname = NOTHING
            Let dummy = AskForResponse( "Enter a Class Name first!", "User ERROR:", "OKAY" )
            ExitScript
         EndIf
         
         If parentname = NOTHING
            Let dummy = AskForResponse( "Enter a Parent Class first!", "User ERROR:", "OKAY" )
            ExitScript
         EndIf
         
         If filename = NOTHING
            Let dummy = AskForResponse( "Enter a File Name first!", "User ERROR:", "OKAY" )
            ExitScript
         EndIf
         
         Let dummy = Do( "CheckForMethods" )
         If dummy = FALSE
            Let dummy = AskForResponse( "Enter at least one Method!", "User ERROR:", "OKAY" )
            ExitScript
         EndIf
         
         Let ClassFile = Do( "FindClassFile", parentname )
         
         Do "WriteNewClass",ClassFile,filename,parentname,classname
         
         Do "UpdateClassList",ClassFile,parentname,classname,filename
         ;
         ; Update the MethodsList, the ClassInstanceVars file,
         ; & the MethodsInstanceVar file, then update the FullClassList.
         ;
      EndScript
      Window "UserWindow"
         Definition
            Origin 0,14
            Title "Submit New Class to AmigaTalk..."
            WindowObjects CLOSEBUTTON DEPTHBUTTONS DRAGBAR 
            WindowZoom 0,14,240,16
            Size 640,360
            WindowFlags ACTIVATE TOFRONT WORKBENCH 
            VisualEffects NONE ,WAIT 
         EndScript
         OnCloseButton
            GotoCard "EditorCard",ParentClass,CurrentClass
            
         EndScript
      EndObj
      List "ClassList"
         Definition
            ListDocument "FullClassList"
            Origin 328,31
            Size 284,241
            Border BEVEL ,1,2
            Label "Classes:",ABOVE 
            Font "topaz",8
            TextColors 7,0,JAM2 
            Style PLAIN ,2,3
         EndScript
         OnClick
            WorkWithDocument "FullClassList"
            Let str = TrimString( TheLine )
            SetText "ParentClass",str
         EndScript
      EndObj
      Memo "MethodsList"
         Definition
            MemoDocument "NewMethods"
            ScrollBars RIGHT 
            Origin 10,92
            Size 305,154
            Border DOUBLEBEVEL ,2,1
            Label "Enter Methods:",HIGHLIGHT ABOVE 
            Font "topaz",8
            TextColors 8,0,JAM2 
            Style PLAIN ,2,3
         EndScript
      EndObj
      TextField "ClassName"
         Definition
            InitialText ""
            Origin 118,41
            Size 200,10
            Border DOUBLEBEVEL ,2,1
            Label "Class Name:",HIGHLIGHT 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "ClassName",""
         EndScript
      EndObj
      TextField "ParentClass"
         Definition
            InitialText ""
            Origin 118,22
            Size 200,10
            Border DOUBLEBEVEL ,2,1
            Label "Parent Class:",HIGHLIGHT 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "ParentClass",""
         EndScript
      EndObj
      AreaButton "Insert"
         Definition
            Origin 330,290
            Border BEVEL ,2,1
            Text " ADD CLASS! "
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 3,0,JAM1 
            Size 100,16
         EndScript
         OnRelease
            Do "InsertClass_Methods"
            
         EndScript
      EndObj
      AreaButton "Cancel"
         Definition
            Origin 540,290
            Border BEVEL ,2,1
            Text " CANCEL! "
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 4,0,JAM1 
            Size 76,16
         EndScript
         OnRelease
            GotoCard "EditorCard",EditReq_Rval,ParentClass,CurrentClass
            
         EndScript
      EndObj
      TextField "FileName"
         Definition
            InitialText ""
            Origin 118,60
            Size 200,10
            Border DOUBLEBEVEL ,2,1
            Label "File Name:",HIGHLIGHT 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "FileName",""
         EndScript
      EndObj
      Memo "InstanceVarsList"
         Definition
            MemoDocument "InstanceVarsDoc"
            ScrollBars RIGHT 
            Origin 10,270
            Size 305,80
            Border DOUBLEBEVEL 
            Label "Class Instance Variables:",HIGHLIGHT ABOVE 
         EndScript
      EndObj
   EndObj
   Card "DeleteClassCard"
      NoAttach
      Routine "InitNewClassReq"
         Local safety   ;InitNewClassReq SubRoutine.
         Local title      ;Called from AfterAttachment event on
         Local EndCheck   ;InsertNewClassReq card.
         Let title = WindowTitle
         If Arg1 = NOTHING
            WorkWithDocument "EditCommList"
            MoveCursorTo STARTOF DOCUMENT 
            Let ClassFile    = TrimString( TheLine )
            MoveCursor DOWN 
            Let MethodFile   = TrimString( TheLine )
            MoveCursor DOWN 
            Let ParentClass  = TrimString( TheLine )
            MoveCursor DOWN 
            Let CurrentClass = TrimString( TheLine )
            MoveCursor DOWN 
            Let TermClass    = TrimString( TheLine )
         Else
            Do "DEBUG","Setting parameters..."
            Let ClassFile    = Arg1
            Let MethodFile   = Arg2
            Let ParentClass  = Arg3
            Let CurrentClass = Arg4
            Let TermClass    = Arg5
         EndIf
         WorkWithDocument "TheClassList"
         MoveCursorTo STARTOF DOCUMENT 
         Clear DOCUMENT 
         Type ParentClass,NEWLINE 
         Type TermClass,NEWLINE 
         MoveCursorTo STARTOF DOCUMENT 
         SetWindowTitle "Making Methods list..."
         WorkWithDocument "NewMethods"
         MoveCursorTo STARTOF DOCUMENT 
         Clear DOCUMENT 
         WorkWithDocument "EditText"
         MoveCursorTo STARTOF DOCUMENT 
         SearchFor "["
         MoveCursor DOWN 
         Let cline  = TheLine
         Let safety = LinesInDocument - 1
         If safety <= 0
            ExitScript
         EndIf
         WorkWithDocument "NewMethods"
         Type TrimString( cline ),NEWLINE 
         SetWindowTitle "Filtering new methods from Editor..."
         While safety >= 0
            WorkWithDocument "EditText"
            While FindChars( TheLine, "|", 1 ) <> 1 AND safety >= 0
               Let EndCheck = FindChars( TheLine, "]", 1 )
               If EndCheck = 1
                  ExitLoop
               EndIf
               MoveCursor DOWN 
               Let safety = safety - 1
            EndLoop
            MoveCursor DOWN 
            Let safety   = safety - 1
            Let cline    = TheLine
            Let EndCheck = FindChars( cline, "]", 1 )
            If EndCheck = 1
               ExitLoop
            EndIf
            WorkWithDocument "NewMethods"
            Type TrimString( cline ),NEWLINE 
         EndLoop
         SetWindowTitle title
         WorkWithDocument "NewMethods"
         MoveCursorTo STARTOF DOCUMENT 
      EndScript
      Routine "SetupFullClassList"
         ; --------------------------------
         ; SetupFullClassList
         ; --------------------------------
         
         Local safety
         Local class
         
         WorkWithDocument "FullClassList"
         Clear DOCUMENT 
         
         Do "ResetClassLists"
         
         If BrowserDisplay = "GENERAL"
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"SystemClasses"
            Do "LoadClasses",BrowserPath||"UserClasses"
         ElseIf BrowserDisplay = "INTUITION"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"SystemClasses"
            Do "LoadClasses",BrowserPath||"UserClasses"
         ElseIf BrowserDisplay = "SYSTEM"
            Do "LoadClasses",BrowserPath||"SystemClasses"
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"UserClasses"
         ElseIf BrowserDisplay = "USER"
            Do "LoadClasses",BrowserPath||"UserClasses"
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"SystemClasses"
         Else
            Do "LoadClasses",BrowserPath||"GeneralClasses"
            Do "LoadClasses",BrowserPath||"IntuitionClasses"
            Do "LoadClasses",BrowserPath||"SystemClasses"
            Do "LoadClasses",BrowserPath||"UserClasses"
         EndIf
         
         WorkWithDocument "ClassesDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         ; Copy ClassesDoc to FullClassList:
         
         While safety > 0
            Let class = TheLine
            
            WorkWithDocument "FullClassList"
            Type class,NEWLINE 
            
            WorkWithDocument "ClassesDoc"
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         WorkWithDocument "FullClassList"
         MoveCursorTo STARTOF DOCUMENT 
         
      EndScript
      Routine "CheckForMethods"
         ; ------------------------------------------
         ; CheckForMethods SubRoutine.
         ; ------------------------------------------
         
         Local rval
         Local safety
         Local str
         
         Let rval = FALSE
         
         WorkWithDocument "NewMethods"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While safety > 0
            Let str = TrimString( TheLine )
            If str <> NOTHING
               Let rval = TRUE
               ExitScript rval
            EndIf
            
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         ExitScript rval
      EndScript
      Routine "FindClassFile"
         ; ------------------------------------
         ; FindClassFile( parentclassname )
         ; ------------------------------------
         
         Local rval
         Local classname
         
         Let classname = TrimString( Arg1 )
         Let rval      = BrowserPath
         
         LoadDocument BrowserPath||"GeneralClasses","tdoc"
         WorkWithDocument "tdoc"
         MoveCursorTo STARTOF DOCUMENT 
         
         Do "Search",classname,1
         If TrimString( TheLine ) = classname
            Let rval = rval||"GeneralClasses"
            ExitScript rval
         EndIf
         
         LoadDocument BrowserPath||"IntuitionClasses","tdoc"
         WorkWithDocument "tdoc"
         MoveCursorTo STARTOF DOCUMENT 
         
         Do "Search",classname,1
         If TrimString( TheLine ) = classname
            Let rval = rval||"IntuitionClasses"
            ExitScript rval
         EndIf
         
         LoadDocument BrowserPath||"SystemClasses","tdoc"
         WorkWithDocument "tdoc"
         MoveCursorTo STARTOF DOCUMENT 
         
         Do "Search",classname,1
         If TrimString( TheLine ) = classname
            Let rval = rval||"SystemClasses"
            ExitScript rval
         EndIf
         
         LoadDocument BrowserPath||"UserClasses","tdoc"
         WorkWithDocument "tdoc"
         MoveCursorTo STARTOF DOCUMENT 
         
         Do "Search",classname,1
         If TrimString( TheLine ) = classname
            Let rval = rval||"UserClasses"
            ExitScript rval
         EndIf
         
         Let rval = rval||"UserClasses"
         ExitScript rval
      EndScript
      Routine "TypeNewMethods"
         ; ------------------------------------------------
         ; TypeNewMethods( filebuffer )
         ; ------------------------------------------------
         
         Local str
         Local safety
         
         WorkWithDocument "NewMethods"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While safety > 0
            Let str = TrimString( TheLine )
            
            FileWriteLine Arg1,str
            
            If safety > 1
               FileWriteLine Arg1,"|"
            EndIf
            
            WorkWithDocument "NewMethods"
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
      EndScript
      Routine "WriteNewClass"
         ; --------------------------------------------------------
         ; WriteNewClass( dir, filename, parentclass, classname )
         ; --------------------------------------------------------
         
         Local dir
         
         Let dir = TrimString( Arg1 )
         If FindChars( UpperCase( dir ), "GENERAL", 1 ) > 0
            Let dir = GeneralPath
         ElseIf FindChars( UpperCase( dir ), "INTUITION", 1 ) > 0
            Let dir = IntuitionPath
         ElseIf FindChars( UpperCase( dir ), "SYSTEM", 1 ) > 0
            Let dir = SystemPath
         ElseIf FindChars( UpperCase( dir ), "USER", 1 ) > 0
            Let dir = UserPath
         Else
            Let dir = UserPath
         EndIf
         
         OpenFile dir||Arg2,"fbf",WRITEONLY ,NEWFILE 
         
         FileWriteLine "fbf","""New Class for AmigaTalk:"""
         FileWriteLine "fbf","Class "||TrimString( Arg4 )|||":"||TrimString( Arg3 )
         
         Do "TypeClassInstanceVars","fbf"
         
         FileWriteLine "fbf","["
         
         Do "TypeNewMethods","fbf"
         
         FileWriteLine "fbf","]"
         
         Close "fbf"
         
         
         
         
         
         
      EndScript
      Routine "TypeClassInstanceVars"
         ; ----------------------------------------------
         ; TypeClassInstanceVars( filebuffer )
         ; ----------------------------------------------
         
         Local safety
         Local str
         Local filebuff
         
         Let filebuff = TrimString( Arg1 )
         
         WorkWithDocument "InstanceVarsDoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         Let str    = TrimString( TheLine )
         
         If str <> NOTHING
            FileWriteChars filebuff,"| "||str||" "
         EndIf
         
         If safety > 1
            Let safety = safety - 1
            FileWriteLine filebuff,""
            
            WorkWithDocument "InstanceVarsDoc"
            MoveCursor DOWN 
            
            While safety > 0 AND TrimString( TheLine ) <> NOTHING
               Let str = TrimString( TheLine )
               FileWriteLine filebuff,str
               
               WorkWithDocument "InstanceVarsDoc"
               MoveCursor DOWN 
               Let safety = safety - 1
            EndLoop
         EndIf
         
         FileWriteLine filebuff,"|"
         
         
         
         
      EndScript
      Routine "UpdateClassList"
         ; ---------------------------------------------------------
         ; UpdateClassList( dir, parentname, classname, filename )
         ; ---------------------------------------------------------
         
         Local safety
         Local str
         Local pline
         Local indentsize
         
         MakeDocument "NewList"
         
         LoadDocument TrimString( Arg1 ),"olddoc"
         MoveCursorTo STARTOF DOCUMENT 
         Let safety = LinesInDocument
         
         While TrimString( TheLine ) <> TrimString( Arg2 ) AND safety > 0
            Let str = TheLine
            WorkWithDocument "NewList"
            Type str,NEWLINE 
            
            WorkWithDocument "olddoc"
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         ; ------------------------ Type out the Parent class:
         WorkWithDocument "olddoc"
         Let pline = TheLine
         MoveCursor DOWN 
         WorkWithDocument "NewList"
         Type pline,NEWLINE 
         Let safety = safety - 1
         ; ------------------------
         
         Let indentsize = Do( "FindIndent", pline )
         While indentsize > 0
            Type " "
            Let indentsize = indentsize - 1
         EndLoop
         
         Type Arg3||":"||Arg4,NEWLINE 
         
         WorkWithDocument "olddoc"
         While TrimString( TheLine ) <> NOTHING AND safety > 0
            Let str = TheLine
            WorkWithDocument "NewList"
            Type str,NEWLINE 
            
            WorkWithDocument "olddoc"
            MoveCursor DOWN 
            Let safety = safety - 1
         EndLoop
         
         SaveDocument "NewList",TrimString( Arg1 )
      EndScript
      Routine "FindIndent"
         ; ----------------------------------------
         ; FindIndent( parentname )
         ; ----------------------------------------
         
         Local rval
         
         Let rval = NumberOfChars(Arg1) - NumberOfChars( TrimString( Arg1))
         
         If rval = 0
            Let rval = 1 ; need at least one space!
         EndIf
         
         ExitScript rval
      EndScript
      Routine "InsertClass_Methods"
         ; ----------------------------------------
         ; InsertClass_Methods SubRoutine.
         ; ----------------------------------------
         
         Local ClassFile
         Local classname
         Local parentname
         Local filename
         Local dummy
         
         Let classname  = TrimString( TextFrom( "ClassName"   ) )
         Let filename   = TrimString( TextFrom( "FileName"    ) )
         Let parentname = TrimString( TextFrom( "ParentClass" ) )
         
         If classname = NOTHING
            Let dummy = AskForResponse( "Enter a Class Name first!", "User ERROR:", "OKAY" )
            ExitScript
         EndIf
         
         If parentname = NOTHING
            Let dummy = AskForResponse( "Enter a Parent Class first!", "User ERROR:", "OKAY" )
            ExitScript
         EndIf
         
         If filename = NOTHING
            Let dummy = AskForResponse( "Enter a File Name first!", "User ERROR:", "OKAY" )
            ExitScript
         EndIf
         
         Let dummy = Do( "CheckForMethods" )
         If dummy = FALSE
            Let dummy = AskForResponse( "Enter at least one Method!", "User ERROR:", "OKAY" )
            ExitScript
         EndIf
         
         Let ClassFile = Do( "FindClassFile", parentname )
         
         Do "WriteNewClass",ClassFile,filename,parentname,classname
         
         Do "UpdateClassList",ClassFile,parentname,classname,filename
         ;
         ; Update the MethodsList, the ClassInstanceVars file,
         ; & the MethodsInstanceVar file, then update the FullClassList.
         ;
      EndScript
      AfterAttachment
         ; --------------------------------------------
         ; AfterAttachment script for DeleteClassCard
         ; --------------------------------------------
         
         Do "SetupFullClassList"
      EndScript
      Routine "DisplayWarning"
         SetPen 2
         PrintText "WARNING:  The severity of the action you",305,15
         PrintText "take increases the lower the button is in",305,25
         PrintText "the window!",305,35
      EndScript
      Window "UserWindow"
         Definition
            Origin 0,14
            Title "Delete a Class from AmigaTalk..."
            WindowObjects CLOSEBUTTON DEPTHBUTTONS DRAGBAR 
            WindowZoom 0,14,240,16
            Size 640,360
            WindowFlags ACTIVATE TOFRONT WORKBENCH 
            VisualEffects NONE ,WAIT 
         EndScript
         OnCloseButton
            GotoCard "EditorCard",ParentClass,CurrentClass
            
         EndScript
         OnActivated
            Do "DisplayWarning"
         EndScript
         OnResized
            Do "DisplayWarning"
         EndScript
      EndObj
      List "ClassList"
         Definition
            ListDocument "FullClassList"
            Origin 16,31
            Size 284,315
            Border BEVEL ,1,2
            Label "Classes:",ABOVE 
            Font "topaz",8
            TextColors 7,0,JAM2 
            Style PLAIN ,2,3
         EndScript
         OnClick
            WorkWithDocument "FullClassList"
            Let str = TrimString( TheLine )
            SetText "DeleteClass",str
            
         EndScript
      EndObj
      AreaButton "Cancel"
         Definition
            Origin 313,52
            Border BEVEL ,2,1
            Text " CANCEL! "
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 4,0,JAM1 
            Size 76,16
         EndScript
         OnRelease
            GotoCard "EditorCard",ParentClass,CurrentClass
            
         EndScript
      EndObj
      TextMenu "Kill_EOL"
         Definition
            AttachTo MENU ,"COMMANDS"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 13,1,JAM1 
            Text "Delete to EOL!"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "K"
         EndScript
         Occurred
            If ObjectState( "MethodMemo" ) = TRUE
               Delete TOENDOFLINE 
            EndIf
         EndScript
      EndObj
      TextMenu "DeleteLine"
         Definition
            AttachTo MENU ,"COMMANDS"
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 13,1,JAM1 
            Text "Delete a Line!"
            MenuFlags NONE 
            Highlight COMPLEMENT 
            ShortCutKey "Y"
         EndScript
         Occurred
            If ObjectState( "MethodMemo" ) = TRUE
               Delete LINE 
            EndIf
         EndScript
      EndObj
      AreaButton "Delete1"
         Definition
            Origin 313,76
            Border BEVEL ,2,1
            ButtonFlags BUTTONTOGGLES 
            Text " Remove Class from Browser Memory  "
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 2,0,JAM1 
            Size 284,16
         EndScript
      EndObj
      AreaButton "Delete2"
         Definition
            Origin 313,100
            Border BEVEL ,2,1
            ButtonFlags BUTTONTOGGLES 
            Text " Delete Class source file also "
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 2,0,JAM1 
            Size 252,16
         EndScript
      EndObj
      TextField "DeleteClass"
         Definition
            InitialText ""
            Origin 312,288
            Size 315,18
            Border INVERT BEVEL 
            Label "Class to Delete:",HIGHLIGHT ABOVE 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
      EndObj
      AreaButton "DeleteAction"
         Definition
            Origin 371,315
            Border BEVEL ,2,1
            Text " Delete Selected Class! "
            Font "topaz",8
            Style PLAIN ,2,3
            TextColors 3,0,JAM1 
            Size 196,16
         EndScript
         OnRelease
            Do "DeleteSelections"
            
         EndScript
      EndObj
   EndObj
   Card "ToolTypesEditor"
      NoAttach
      Routine "RestoreProgramTools"
         ; ------------------------------
         ; RestoreProgramTools
         ; ------------------------------
         
         WorkWithDocument "ProgramToolsDoc"
         Clear DOCUMENT 
         LoadIcon "AmigaTalk","ParentIconBuffer"
         InsertToolTypeList "ParentIconBuffer"
         MoveCursorTo STARTOF DOCUMENT 
         Let SaveProgramTools = FALSE
      EndScript
      Routine "SaveProgramTools"
         ; -----------------------------------
         ; SaveProgramTools
         ; -----------------------------------
         
         SetToolTypeList "ParentIconBuffer","ProgramToolsDoc"
         SaveIcon "ParentIconBuffer",ProgramPath||"AmigaTalk"
         Let SaveProgramTools = TRUE
      EndScript
      Routine "SaveBrowserTools"
         ; -----------------------------
         ; SaveBrowserTools
         ; -----------------------------
         
         SetToolTypeList "IconBuffer","BrowserToolsDoc"
         SaveIcon "IconBuffer",DeckName
         Let SaveBrowserTools = TRUE
      EndScript
      Routine "RestoreBrowserTools"
         ; ----------------------------------
         ; RestoreBrowserTools
         ; ----------------------------------
         
         LoadIcon CommandPath||DeckName,"IconBuffer"
         WorkWithDocument "BrowserToolsDoc"
         Clear DOCUMENT 
         InsertToolTypeList "IconBuffer"
         MoveCursorTo STARTOF DOCUMENT 
         Let SaveBrowserTools = FALSE
      EndScript
      Routine "CancelChanges"
         ; --------------------------
         ; CancelChanges SubRoutine
         ; --------------------------
         
         Do "RestoreProgramTools"
         Do "RestoreBrowserTools"
         
      EndScript
      Routine "SetupToolTypesEditor"
         ; ----------------------------------
         ; SetupToolTypesEditor
         ; ----------------------------------
         LoadIcon CommandPath||DeckName,"IconBuffer"
         WorkWithDocument "BrowserToolsDoc"
         Clear DOCUMENT 
         InsertToolTypeList "IconBuffer"
         MoveCursorTo STARTOF DOCUMENT 
         
         WorkWithDocument "ProgramToolsDoc"
         Clear DOCUMENT 
         LoadIcon ProgramPath||"AmigaTalk","ParentIconBuffer"
         InsertToolTypeList "ParentIconBuffer"
         MoveCursorTo STARTOF DOCUMENT 
         
         Let SaveBrowserTools = FALSE
         Let SaveProgramTools = FALSE
      EndScript
      BeforeAttachment
         Let SaveBrowserTools = FALSE
         Let SaveProgramTools = FALSE
      EndScript
      AfterAttachment
         Do "SetupToolTypesEditor"
      EndScript
      Window "UserWindow"
         Definition
            Origin 0,14
            Title "AmigaTalk © 1998 -- ToolTypes Editor:"
            WindowObjects CLOSEBUTTON DEPTHBUTTONS DRAGBAR 
            WindowZoom 0,14,240,16
            Size 640,280
            WindowFlags ACTIVATE TOFRONT WORKBENCH 
            VisualEffects NONE ,WAIT 
         EndScript
         OnCloseButton
            If SaveBrowserTools = TRUE
               Do "SaveBrowserIcon"
            EndIf
            If SaveProgramTools = TRUE
               Do "SaveProgramIcon"
            EndIf
            GotoCard "EditorCard"
            
         EndScript
         OnActivated
            Do "SetupToolTypesEditor"
         EndScript
      EndObj
      Memo "BrowserToolTypes"
         Definition
            MemoDocument "BrowserToolsDoc"
            ScrollBars RIGHT 
            Origin 10,32
            Size 303,194
            Border DOUBLEBEVEL ,2,1
            Label "Browser ToolTypes:",ABOVE 
            Font "topaz",8
            TextColors 7,0,JAM2 
            Style PLAIN ,2,3
         EndScript
      EndObj
      AKey "TabKey"
         Definition
            QualifiersPressed NONE 
            KeyPressed TAB 
         EndScript
         OnUp
            Local tabsize
            Let tabsize = DefaultTabSize
            WorkWithDocument "EditText"
            While tabsize > 0
               Type " "
               Let tabsize = tabsize - 1
            EndLoop
         EndScript
      EndObj
      AKey "HelpSystem"
         Definition
            QualifiersPressed NONE 
            KeyPressed HELP 
         EndScript
         OnUp
            Do "ReportError",4,"Help"
         EndScript
      EndObj
      AKey "CutKey"
         Definition
            QualifiersPressed RIGHTAMIGA 
            KeyPressed X 
         EndScript
         OnUp
            Do "ReportError",4,"A-x"
         EndScript
      EndObj
      AKey "CopyKey"
         Definition
            QualifiersPressed RIGHTAMIGA 
            KeyPressed C 
         EndScript
         OnUp
            Do "ReportError",4,"A-c"
         EndScript
      EndObj
      AKey "PasteKey"
         Definition
            QualifiersPressed RIGHTAMIGA 
            KeyPressed V 
         EndScript
         OnUp
            Do "ReportError",4,"A-v"
         EndScript
      EndObj
      Memo "ProgramToolTypes"
         Definition
            MemoDocument "ProgramToolsDoc"
            ScrollBars RIGHT 
            Origin 326,32
            Size 303,194
            Border DOUBLEBEVEL ,2,1
            Label "AmigaTalk ToolTypes:",ABOVE 
            Font "topaz",8
            TextColors 7,0,JAM2 
            Style PLAIN ,2,3
         EndScript
      EndObj
      AreaButton "SaveBrowserTT"
         Definition
            Origin 14,236
            Border BEVEL 
            Text " SAVE! "
            Font "topaz",8
            Style PLAIN ,2,1
            TextColors 1,0,JAM1 
            Size 60,16
         EndScript
         OnRelease
            Do "SaveBrowserTools"
            
         EndScript
      EndObj
      AreaButton "SaveProgramTT"
         Definition
            Origin 330,236
            Border BEVEL 
            Text " SAVE! "
            Font "topaz",8
            Style PLAIN ,2,1
            TextColors 1,0,JAM1 
            Size 60,16
         EndScript
         OnRelease
            Do "SaveProgramTools"
            
         EndScript
      EndObj
      AreaButton "Cancel"
         Definition
            Origin 224,259
            Border BEVEL 
            Text " CANCEL ALL CHANGES! "
            Font "topaz",8
            Style PLAIN ,2,1
            TextColors 2,0,JAM1 
            Size 172,16
         EndScript
         OnRelease
            Do "CancelChanges"
            
         EndScript
      EndObj
      AreaButton "RestoreBrowserTT"
         Definition
            Origin 225,236
            Border BEVEL 
            Text " RESTORE! "
            Font "topaz",8
            Size 84,16
         EndScript
         OnRelease
            Do "RestoreBrowserTools"
            
         EndScript
      EndObj
      AreaButton "RestoreProgramTT"
         Definition
            Origin 541,236
            Border BEVEL 
            Text " RESTORE! "
            Font "topaz",8
            Size 84,16
         EndScript
         OnRelease
            Do "RestoreProgramTools"
            
         EndScript
      EndObj
   EndObj
   Card "HiddenFiles"
      NoAttach
      Routine "ResetClassGroupMenus"
         SetObjectState "ShowGeneral",FALSE
         SetObjectState "ShowIntuition",FALSE
         SetObjectState "ShowSystem",FALSE
         SetObjectState "ShowUser",FALSE
         
      EndScript
      Routine "ResetMethodsMenu"
         SetObjectState "DisplaySource",FALSE
         SetObjectState "DisplayByteCodes",FALSE
         
      EndScript
      Routine "DisplaySourceMI"
         Do "ResetMethodsMenu"
         SetObjectState "DisplaySource",TRUE
         Let SrcCodeDisplay = "REGULAR"
         Do "SetupSourceList"
         
      EndScript
      Routine "DisplayByteCodesMI"
         Do "ResetMethodsMenu"
         SetObjectState "DisplayByteCodes",TRUE
         Let SrcCodeDisplay = "BYTECODES"
         Do "SetupSourceList"
         
      EndScript
      Routine "LoadSrcFileList"
         ; -----------------------------------------
         ; LoadSrcFileList( classgroup ) SubRoutine.
         ; -----------------------------------------
         
         Local filename
         Local safety
         Local classline
         Local srcfile
         
         Let filename = TrimString( Arg1 )
         
         If Exists( filename ) AND filename <> NOTHING
            LoadDocument filename,"TempClassesDoc"
            MoveCursorTo STARTOF DOCUMENT 
            Let safety = LinesInDocument
         Else
            Let filename = AskForFileName( BrowserPath,"Which Class Group?",0,14,400,200)
            If filename = NOTHING
               Let filename = BrowserPath||"GeneralClasses"
            EndIf
            LoadDocument filename,"TempClassesDoc"
            MoveCursorTo STARTOF DOCUMENT 
            Let safety = LinesInDocument
         EndIf
         
         While safety > 0 AND TrimString( TheLine ) <> NOTHING
            
            Let classline = TheLine
            Let srcfile   = GetWord( TrimString( classline ), 2, ":" )
            
            WorkWithDocument "SourceFileList"
            Type srcfile,NEWLINE 
            
            Let safety = safety - 1
            
            WorkWithDocument "TempClassesDoc"
            MoveCursor DOWN 
         EndLoop
      EndScript
      Routine "SetupHiddenFiles"
         ; ----------------------------------------
         ; SetupHiddenFiles()  SubRoutine
         ; ----------------------------------------
         Local classfile
         
         Do "ResetClassLists"
         
         If BrowserDisplay = "GENERAL"
            Let classfile  = BrowserPath||"GeneralClasses"
         ElseIf BrowserDisplay = "INTUITION"
            Let classfile  = BrowserPath||"IntuitionClasses"
         ElseIf BrowserDisplay = "SYSTEM"
            Let classfile  = BrowserPath||"SystemClasses"
         ElseIf BrowserDisplay = "USER"
            Let classfile  = BrowserPath||"UserClasses"
         Else
            Let classfile  = BrowserPath||"GeneralClasses"
         EndIf
         
         Do "LoadSrcFileList",classfile
         Do "SetupSourceList"
         
      EndScript
      Routine "RedisplayClasses"
         ; ------------------------------------
         ; RedisplayClasses( classgroup )
         ; ------------------------------------
         
         Local classgroup
         Local filename
         
         Let classgroup     = TrimString( UpperCase( Arg1 ) )
         
         Do "ResetClassGroupMenus"
         
         If classgroup = "GENERAL"
            SetObjectState "ShowGeneral",TRUE
            Let filename = BrowserPath||"GeneralClasses"
         ElseIf classgroup = "INTUITION"
            SetObjectState "ShowIntuition",TRUE
            Let filename = BrowserPath||"IntuitionClasses"
         ElseIf classgroup = "SYSTEM"
            SetObjectState "ShowSystem",TRUE
            Let filename = BrowserPath||"SystemClasses"
         ElseIf classgroup = "USER"
            SetObjectState "ShowUser",TRUE
            Let filename = BrowserPath||"UserClasses"
         Else
            SetObjectState "ShowGeneral",TRUE
            Let filename = BrowserPath||"GeneralClasses"
         EndIf
         
         WorkWithDocument "SourceFileList"
         Clear DOCUMENT 
         
         Do "LoadSrcFileList",filename
         
         WorkWithDocument "SourceFileList"
         MoveCursorTo STARTOF DOCUMENT 
      EndScript
      Window "UserWindow"
         Definition
            Origin 0,14
            Title "AmigaTalk © 1998 -- Hidden Files:"
            WindowObjects CLOSEBUTTON DEPTHBUTTONS DRAGBAR 
            WindowZoom 0,14,240,16
            Size 640,340
            WindowFlags ACTIVATE TOFRONT WORKBENCH 
            VisualEffects NONE ,WAIT 
         EndScript
         OnCloseButton
            FirstCard
            
         EndScript
         OnResized
            
            
         EndScript
      EndObj
      List "SourceFileList"
         Definition
            ListDocument "SourceFileList"
            Origin 9,31
            Size 304,265
            Border BEVEL ,1,2
            Label "Source File List:",HIGHLIGHT ABOVE 
            Font "topaz",8
            TextColors 7,0,JAM2 
            Style PLAIN ,2,3
         EndScript
      EndObj
      Memo "SrcCodeList"
         Definition
            MemoDocument "SrcCodeDoc"
            ScrollBars RIGHT 
            InputStyle LOCKEDOUT 
            Origin 325,31
            Size 297,265
            Border BEVEL ,1,2
            Label "Source Code:",ABOVE 
         EndScript
      EndObj
      TextMenu "ShowGeneral"
         Definition
            AttachTo MENU ,"CLASSES"
            Text "Show General   Classes"
            MenuFlags CHECKABLE CHECKIT 
         EndScript
         Occurred
            Do "RedisplayClasses","GENERAL"
            
         EndScript
      EndObj
      TextMenu "DisplaySource"
         Definition
            AttachTo MENU ,"METHODS"
            Text "Display Source"
            MenuFlags CHECKABLE CHECKIT 
         EndScript
         Occurred
            Do "DisplaySourceMI"
         EndScript
      EndObj
      TextMenu "ShowIntuition"
         Definition
            AttachTo MENU ,"CLASSES"
            Text "Show Intuition Classes"
            MenuFlags CHECKABLE 
         EndScript
         Occurred
            Do "RedisplayClasses","INTUITION"
            
            
         EndScript
      EndObj
      TextMenu "ShowSystem"
         Definition
            AttachTo MENU ,"CLASSES"
            Text "Show System    Classes"
            MenuFlags CHECKABLE 
         EndScript
         Occurred
            Do "RedisplayClasses","SYSTEM"
            
         EndScript
      EndObj
      TextMenu "ShowUser"
         Definition
            AttachTo MENU ,"CLASSES"
            Text "Show User      Classes"
            MenuFlags CHECKABLE 
         EndScript
         Occurred
            Do "RedisplayClasses","USER"
            
         EndScript
      EndObj
      AKey "GotoARexxCard"
         Definition
            QualifiersPressed SHIFT RIGHTAMIGA 
            KeyPressed A 
         EndScript
         OnUp
            LastCard
         EndScript
      EndObj
      TextMenu "DisplayByteCodes"
         Definition
            AttachTo MENU ,"METHODS"
            Text "Display ByteCodes"
            MenuFlags CHECKABLE 
         EndScript
         Occurred
            Do "DisplayByteCodesMI"
            
         EndScript
      EndObj
   EndObj
   Card "ARexxCard"
      NoAttach
      Routine "SetSpeakAddress"
         ; --------------------------------
         ; SetSpeakAddress
         ; --------------------------------
         
         WorkWithDocument "ARexxPortList"
         
         If TheLine <> NOTHING AND ARexxPortName <> TheLine
            Let ARexxPortName = TheLine
            SpeakTo TheLine
            IfError
               Do "HandleARexxError"
               ExitScript
            EndIf
            
            SetText "CurrentPort",TheLine
            WorkWithDocument "ARexxResult"
            Clear DOCUMENT 
         EndIf
      EndScript
      Routine "SendARexxMsg"
         ; -------------------------------
         ; SendARexxMsg
         ; -------------------------------
         
         If ARexxPortName <> NOTHING
            Let ToBeSent = TextFrom( "MessageField" )
            If ExpectResults = FALSE
               SendMessage ToBeSent,NORESULTS 
               If MessageErrorCode <> 0
                  Do "HandleARexxError"
               EndIf
            Else
               SendMessage ToBeSent
               If MessageErrorCode <> 0
                  Do "HandleARexxError"
               EndIf
            EndIf
            
            WorkWithDocument "ARexxResult"
            MoveCursorTo ENDOF DOCUMENT 
            Type ToBeSent,NEWLINE 
            Type MessageErrorCode||":"||MessageReturned,NEWLINE 
         EndIf
      EndScript
      Window "UserWindow"
         Definition
            Origin 0,14
            Title "ARexx Communicator © 1998:"
            WindowObjects CLOSEBUTTON DEPTHBUTTONS DRAGBAR 
            WindowZoom 0,14,240,16
            Size 640,380
            WindowFlags ACTIVATE TOFRONT WORKBENCH 
            VisualEffects NONE ,WAIT 
         EndScript
         OnCloseButton
            FirstCard
         EndScript
      EndObj
      List "Port_List"
         Definition
            ListDocument "ARexxPortList"
            Origin 12,74
            Size 304,146
            Border BEVEL ,1,2
            Label "ARexx Port List:",HIGHLIGHT ABOVE 
            Font "topaz",8
            TextColors 7,0,JAM2 
            Style PLAIN ,2,3
         EndScript
         OnClick
            Do "SetSpeakAddress"
            
         EndScript
      EndObj
      List "Result"
         Definition
            ListDocument "ARexxResult"
            Origin 12,244
            Size 293,126
            Border BEVEL ,1,2
            Label "ARexx Results:",HIGHLIGHT ABOVE 
            Font "topaz",8
            TextColors 8,0,JAM2 
            Style PLAIN ,2,3
         EndScript
      EndObj
      TextField "CurrentPort"
         Definition
            InitialText ""
            Origin 125,22
            Size 250,10
            Border BEVEL ,1,2
            Label "Current Port:",HIGHLIGHT 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
      EndObj
      TextField "MessageField"
         Definition
            InitialText ""
            Origin 125,44
            Size 250,10
            Border DOUBLEBEVEL ,2,1
            Label "Send Message:",HIGHLIGHT 
            Justification CENTER 
            MaxFieldLength 256
         EndScript
         OnClick
            SetText "MessageField",""
         EndScript
      EndObj
      Memo "Error"
         Definition
            MemoDocument "ARexxError"
            ScrollBars RIGHT 
            InputStyle LOCKEDOUT 
            Origin 316,244
            Size 311,126
            Border BEVEL ,1,2
            Label "ARexx Errors:",ABOVE 
         EndScript
      EndObj
      AreaButton "SendButton"
         Definition
            Origin 388,22
            Border BEVEL 
            Label "Send Message!",HIGHLIGHT INSIDE 
            Size 125,16
         EndScript
         OnRelease
            Do "SendARexxMsg"
            
         EndScript
      EndObj
      AreaButton "RescanButton"
         Definition
            Origin 324,73
            Border BEVEL 
            Label "ReScan Ports",HIGHLIGHT INSIDE 
            Size 137,16
         EndScript
         OnRelease
            Do "SetARexxPortList"
            
         EndScript
      EndObj
      AreaButton "ChkErrHandler"
         Definition
            Origin 474,73
            Border BEVEL 
            Text " Chk Err Handler  "
            Font "topaz",8
            Size 148,16
         EndScript
         OnRelease
            Local ans
            Local msg
            Local crl
            
            SetWindowTitle "TheBrowser has an internal ERROR:"
            Let crl = String( Char ( 10 ) )
            Let msg = "Error encountered:"||crl
            Let msg = msg||"Script name:  "||ErrorScriptName||crl
            Let msg = msg||"Line #:  "||ErrorLineNumber||crl
            Let msg = msg||"Line:  "||ErrorSourceLine||crl
            Let msg = msg||"Code:  "||ErrorCode||crl
            Let msg = msg||"Text:  "||ErrorText||crl
            Let msg = msg||"TheBrowser will terminate!"
            Let ans = AskForResponse( msg, "TheBrowser problem:", "OKAY" )
         EndScript
      EndObj
   EndObj
EndObj
