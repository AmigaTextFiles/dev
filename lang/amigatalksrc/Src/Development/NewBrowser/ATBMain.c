/*
 *  Source machine generated by GadToolsBox V2.0b
 *  which is (c) Copyright 1991-1993 Jaba Development
 *
 *  GUI Designed by : Jim Steichen
 */

#include <string.h>

#include <exec/types.h>
#include <intuition/intuition.h>
#include <intuition/classes.h>
#include <intuition/classusr.h>
#include <intuition/gadgetclass.h>

#include <libraries/gadtools.h>

#include <graphics/displayinfo.h>
#include <graphics/gfxbase.h>

#include <clib/exec_protos.h>
#include <clib/intuition_protos.h>
#include <clib/gadtools_protos.h>
#include <clib/graphics_protos.h>
#include <clib/utility_protos.h>

#include <clib/diskfont_protos.h>

#define GetString( g )      ((( struct StringInfo * )g->SpecialInfo )->Buffer  )
#define GetNumber( g )      ((( struct StringInfo * )g->SpecialInfo )->LongInt )

#define GD_ParentTxt                           0
#define GD_CurrentTxt                          1
#define GD_MethodTxt                           2
#define GD_SrcFileNameTxt                      3
#define GD_ClassLV                             4
#define GD_MethodLV                            5
#define GD_ByteCodesLV                         6
#define GD_ByteCodeBt                          7
#define GD_EditorBt                            8

#define BR_CNT 9

extern struct IntuitionBase *IntuitionBase;
extern struct Library       *GadToolsBase;


struct Screen         *Scr = NULL;
APTR                   VisualInfo = NULL;
struct Window         *BRWnd = NULL;
struct Gadget         *BRGList = NULL;
struct Menu           *BRMenus = NULL;
struct IntuiMessage    BRMsg;
struct Gadget         *BRGadgets[9];
UWORD                  BRLeft = 0;
UWORD                  BRTop = 14;
UWORD                  BRWidth = 632;
UWORD                  BRHeight = 439;
UBYTE                 *BRWdt = (UBYTE *)"AmigaTalk © 1998-2001 -- Class Browser:";
struct TextAttr       *Font, Attr;
UWORD                  FontX, FontY;
UWORD                  OffX, OffY;
struct TextFont       *BRFont = NULL;

PRIVATE int BRGeneralMI( void );
PRIVATE int BRIntuitionMI( void );
PRIVATE int BRSystemMI( void );
PRIVATE int BRUserMI( void );

struct NewMenu BRNewMenu[] = {
	NM_TITLE, (STRPTR)"CLASSES", NULL, 0, NULL, NULL,
	NM_ITEM, (STRPTR)"Show General   Classes", NULL, CHECKIT|CHECKED|MENUTOGGLE, 0L, (APTR)BRGeneralMI,
	NM_ITEM, (STRPTR)"Show Intuition Classes", NULL, CHECKIT|MENUTOGGLE, 0L, (APTR)BRIntuitionMI,
	NM_ITEM, (STRPTR)"Show System    Classes", NULL, CHECKIT|MENUTOGGLE, 0L, (APTR)BRSystemMI,
	NM_ITEM, (STRPTR)"Show User      Classes", NULL, CHECKIT|MENUTOGGLE, 0L, (APTR)BRUserMI,
	NM_END, NULL, NULL, 0, 0L, NULL };


UWORD BRGTypes[] = {
	TEXT_KIND,
	TEXT_KIND,
	TEXT_KIND,
	TEXT_KIND,
	LISTVIEW_KIND,
	LISTVIEW_KIND,
	LISTVIEW_KIND,
	BUTTON_KIND,
	BUTTON_KIND
};

PRIVATE int ClassLVClicked( void );
PRIVATE int MethodLVClicked( void );
PRIVATE int ByteCodesLVClicked( void );
PRIVATE int ByteCodeBtClicked( void );
PRIVATE int EditorBtClicked( void );

struct NewGadget BRNGad[] = {
	316, 19, 271, 18, (UBYTE *)"Parent Class:", NULL, GD_ParentTxt, PLACETEXT_ABOVE, NULL, NULL,
	316, 57, 271, 18, (UBYTE *)"Current Class:", NULL, GD_CurrentTxt, PLACETEXT_ABOVE, NULL, NULL,
	316, 94, 271, 18, (UBYTE *)"Current Method:", NULL, GD_MethodTxt, PLACETEXT_ABOVE, NULL, NULL,
	316, 131, 271, 18, (UBYTE *)"Source File:", NULL, GD_SrcFileNameTxt, PLACETEXT_ABOVE, NULL, NULL,
	6, 19, 302, 187, (UBYTE *)"Classes:", NULL, GD_ClassLV, PLACETEXT_ABOVE|NG_HIGHLABEL, NULL, (APTR)ClassLVClicked,
	6, 224, 621, 121, (UBYTE *)"Method Source:", NULL, GD_MethodLV, PLACETEXT_ABOVE|NG_HIGHLABEL, NULL, (APTR)MethodLVClicked,
	6, 362, 620, 77, (UBYTE *)"Source ByteCodes:", NULL, GD_ByteCodesLV, PLACETEXT_ABOVE, NULL, (APTR)ByteCodesLVClicked,
	316, 157, 150, 18, (UBYTE *)"Display _ByteCodes", NULL, GD_ByteCodeBt, PLACETEXT_IN, NULL, (APTR)ByteCodeBtClicked,
	450, 184, 139, 18, (UBYTE *)"Goto _Editor...", NULL, GD_EditorBt, PLACETEXT_IN, NULL, (APTR)EditorBtClicked
};


ULONG BRGTags[] = {
	(GTTX_Border), TRUE, (TAG_DONE),
	(GTTX_Border), TRUE, (TAG_DONE),
	(GTTX_Border), TRUE, (TAG_DONE),
	(GTTX_Border), TRUE, (TAG_DONE),
	(GTLV_ShowSelected), NULL, (LAYOUTA_Spacing), 2, (TAG_DONE),
	(GTLV_ShowSelected), NULL, (LAYOUTA_Spacing), 2, (TAG_DONE),
	(GTLV_ReadOnly), TRUE, (LAYOUTA_Spacing), 2, (TAG_DONE),
	(GT_Underscore), '_', (TAG_DONE),
	(GT_Underscore), '_', (TAG_DONE)
};

UWORD DriPens[] = {
	~0 };

static UWORD ComputeX( UWORD value )
{
	return(( UWORD )((( FontX * value ) + 4 ) / 8 ));
}

static UWORD ComputeY( UWORD value )
{
	return(( UWORD )((( FontY * value ) + 5 ) / 11 ));
}

static void ComputeFont( UWORD width, UWORD height )
{
	Forbid();
	Font = &Attr;
	Font->ta_Name = (STRPTR)GfxBase->DefaultFont->tf_Message.mn_Node.ln_Name;
	Font->ta_YSize = FontY = GfxBase->DefaultFont->tf_YSize;
	FontX = GfxBase->DefaultFont->tf_XSize;
	Permit();

	OffX = Scr->WBorLeft;
	OffY = Scr->RastPort.TxHeight + Scr->WBorTop + 1;

	if ( width && height ) {
		if (( ComputeX( width ) + OffX + Scr->WBorRight ) > Scr->Width )
			goto UseTopaz;
		if (( ComputeY( height ) + OffY + Scr->WBorBottom ) > Scr->Height )
			goto UseTopaz;
	}
	return;

UseTopaz:
	Font->ta_Name = (STRPTR)"topaz.font";
	FontX = FontY = Font->ta_YSize = 8;
}

int SetupScreen( void )
{
	if ( ! ( Scr = OpenScreenTags( NULL, SA_Left,	0,
					SA_Top,		0,
					SA_Width,	640,
					SA_Height,	480,
					SA_Depth,	8,
					SA_Type,	CUSTOMSCREEN,
					SA_DisplayID,	DEFAULT_MONITOR_ID|LORES_KEY,
					SA_AutoScroll,	TRUE,
					SA_Overscan,	OSCAN_TEXT,
					SA_Pens,	&DriPens[0],
					SA_Title,	"AmigaTalk Browser ©1998",
					TAG_DONE )))
		return( 1L );

	ComputeFont( 0, 0 );

	if ( ! ( VisualInfo = GetVisualInfo( Scr, TAG_DONE )))
		return( 2L );

	return( 0L );
}

void CloseDownScreen( void )
{
	if ( VisualInfo ) {
		FreeVisualInfo( VisualInfo );
		VisualInfo = NULL;
	}

	if ( Scr        ) {
		CloseScreen( Scr );
		Scr = NULL;
	}
}

PRIVATE int ClassLVClicked( void )
{
	/* routine when gadget "Classes:" is clicked. */
}

PRIVATE int MethodLVClicked( void )
{
	/* routine when gadget "Method Source:" is clicked. */
}

PRIVATE int ByteCodesLVClicked( void )
{
	/* routine when gadget "Source ByteCodes:" is clicked. */
}

PRIVATE int ByteCodeBtClicked( void )
{
	/* routine when gadget "Display _ByteCodes" is clicked. */
}

PRIVATE int EditorBtClicked( void )
{
	/* routine when gadget "Goto _Editor..." is clicked. */
}

PRIVATE int BRGeneralMI( void )
{
	/* routine when (sub)item "Show General   Classes" is selected. */
}

PRIVATE int BRIntuitionMI( void )
{
	/* routine when (sub)item "Show Intuition Classes" is selected. */
}

PRIVATE int BRSystemMI( void )
{
	/* routine when (sub)item "Show System    Classes" is selected. */
}

PRIVATE int BRUserMI( void )
{
	/* routine when (sub)item "Show User      Classes" is selected. */
}

PRIVATE int BRCloseWindow( void )
{
	/* routine for "IDCMP_CLOSEWINDOW". */
}

PRIVATE int BRVanillaKey( void )
{
	/* routine for "IDCMP_VANILLAKEY". */
}

int HandleBRIDCMP( void )
{
	struct IntuiMessage	*m;
	struct MenuItem		*n;
	int			(*func)();
	BOOL			running = TRUE;

	while( m = GT_GetIMsg( BRWnd->UserPort )) {

		CopyMem(( char * )m, ( char * )&BRMsg, (long)sizeof( struct IntuiMessage ));

		GT_ReplyIMsg( m );

		switch ( BRMsg.Class ) {

			case	IDCMP_REFRESHWINDOW:
				GT_BeginRefresh( BRWnd );
				GT_EndRefresh( BRWnd, TRUE );
				break;

			case	IDCMP_CLOSEWINDOW:
				running = BRCloseWindow();
				break;

			case	IDCMP_VANILLAKEY:
				running = BRVanillaKey();
				break;

			case	IDCMP_GADGETUP:
			case	IDCMP_GADGETDOWN:
				func = ( void * )(( struct Gadget * )BRMsg.IAddress )->UserData;
				running = func();
				break;

			case	IDCMP_MENUPICK:
				while( BRMsg.Code != MENUNULL ) {
					n = ItemAddress( BRMenus, BRMsg.Code );
					func = (void *)(GTMENUITEM_USERDATA( n ));
					running = func();
					BRMsg.Code = n->NextSelect;
				}
				break;
		}
	}
	return( running );
}

int OpenBRWindow( void )
{
	struct NewGadget	ng;
	struct Gadget	*g;
	UWORD		lc, tc;
	UWORD		wleft = BRLeft, wtop = BRTop, ww, wh;

	ComputeFont( BRWidth, BRHeight );

	ww = ComputeX( BRWidth );
	wh = ComputeY( BRHeight );

	if (( wleft + ww + OffX + Scr->WBorRight ) > Scr->Width ) wleft = Scr->Width - ww;
	if (( wtop + wh + OffY + Scr->WBorBottom ) > Scr->Height ) wtop = Scr->Height - wh;

	if ( ! ( BRFont = OpenDiskFont( Font )))
		return( 5L );

	if ( ! ( g = CreateContext( &BRGList )))
		return( 1L );

	for( lc = 0, tc = 0; lc < BR_CNT; lc++ ) {

		CopyMem((char * )&BRNGad[ lc ], (char * )&ng, (long)sizeof( struct NewGadget ));

		ng.ng_VisualInfo = VisualInfo;
		ng.ng_TextAttr   = Font;
		ng.ng_LeftEdge   = OffX + ComputeX( ng.ng_LeftEdge );
		ng.ng_TopEdge    = OffY + ComputeY( ng.ng_TopEdge );
		ng.ng_Width      = ComputeX( ng.ng_Width );
		ng.ng_Height     = ComputeY( ng.ng_Height);

		BRGadgets[ lc ] = g = CreateGadgetA((ULONG)BRGTypes[ lc ], g, &ng, ( struct TagItem * )&BRGTags[ tc ] );

		while( BRGTags[ tc ] ) tc += 2;
		tc++;

		if ( NOT g )
			return( 2L );
	}

	if ( ! ( BRMenus = CreateMenus( BRNewMenu, GTMN_FrontPen, 0L, TAG_DONE )))
		return( 3L );

	LayoutMenus( BRMenus, VisualInfo, TAG_DONE );

	if ( ! ( BRWnd = OpenWindowTags( NULL,
				WA_Left,	wleft,
				WA_Top,		wtop,
				WA_Width,	ww + OffX + Scr->WBorRight,
				WA_Height,	wh + OffY + Scr->WBorBottom,
				WA_IDCMP,	TEXTIDCMP|LISTVIEWIDCMP|BUTTONIDCMP|IDCMP_MENUPICK|IDCMP_CLOSEWINDOW|IDCMP_VANILLAKEY|IDCMP_REFRESHWINDOW,
				WA_Flags,	WFLG_DRAGBAR|WFLG_DEPTHGADGET|WFLG_CLOSEGADGET|WFLG_SMART_REFRESH|WFLG_ACTIVATE,
				WA_Gadgets,	BRGList,
				WA_Title,	BRWdt,
				WA_ScreenTitle,	"AmigaTalk Browser © 1998",
				WA_CustomScreen,	Scr,
				TAG_DONE )))
	return( 4L );

	SetMenuStrip( BRWnd, BRMenus );
	GT_RefreshWindow( BRWnd, NULL );

	return( 0L );
}

void CloseBRWindow( void )
{
	if ( BRMenus      ) {
		ClearMenuStrip( BRWnd );
		FreeMenus( BRMenus );
		BRMenus = NULL;	}

	if ( BRWnd        ) {
		CloseWindow( BRWnd );
		BRWnd = NULL;
	}

	if ( BRGList      ) {
		FreeGadgets( BRGList );
		BRGList = NULL;
	}

	if ( BRFont ) {
		CloseFont( BRFont );
		BRFont = NULL;
	}
}

