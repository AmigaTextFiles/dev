@database "NQC Guide"
@author "Uwe Ryssel"
@$VER: NQC Guide 1.0 (28. Juni 2003)

@node main "NQC Manual"

    NQC 2.5 r1 - compiler and communication tool
                 for Lego Mindstorms "smart bricks".


    NQC is Copyright (C) 1998-2002 David Baum and released under the terms of
    the Mozilla Public License.  See the documentation included with the program
    for more details.

    Amiga port by Uwe Ryssel


    @{" LICENSE         " link license} Mozilla Public License Version 1.0

    @{" Introduction    " link intro}
    @{" Requirements    " link require}
    @{" Installation    " link install}

    @{" Getting started " link start} with RCX 2, others should be similar.
    @{" Usage           " link usage} - the command line options

    @{" Author          " link author}
    @{" Bugs            " link bugs}
    @{" History         " link history} of original NQC


    This guide is a summary of the original NQC docs and other related ones.

@endnode

@node intro "Introduction"

    Introduction:
    --------------

    Not Quite C is a simple language with a C-like syntax that can be used
    to program Lego's programmable bricks RCX, RCX 2, Cybermaster, Scout and
    Spybotics.

    NQC is not a general purpose language -- there are many restrictions
    that stem from limitations of the standard firmware.

    NQC is a shell based tool which compiles the Not Quite C source code
    and takes care of the communication with the brick via the
    serial IR tower or via the USB IR tower.

@endnode

@node require "Requirements"

    Requirements:
    -------------

    - Kickstart 3.0 (V39) or higher
    - MC68020 or higher
    - ca. 1 MB free memory

    - a text editor to write NQC code

    - a programmable brick from Lego
      (supported are RCX, Cybermaster, Scout, RCX 2 and Spybotics)
    - firmware for brick

    - serial or USB IR tower from Lego

    - for serial IR tower:

        - a free serial port

    - for USB IR tower

        - a free USB port
        - Poseidon USB Stack (by Chris Hodges)

@endnode

@node install "Installation"

    Installation:
    -------------

    You needn't install NQC. Copy to somewhere on your hard disc is enough.

@endnode

@node start "Getting Started"

    Getting started with RCX 2.
    ---------------------------


    1. Get the firmware
    -------------------

    The firmware is on the "Lego Mindstorms Robotics Invention
    System 2.0" CD-ROM. But to get it you have to install the content on
    a Wind*ws system. If you haven't this possibility you can download the
    RCX 2.0 beta firmware from the Lego Mindstorms homepage:

        http://mindstorms.lego.com/sdk2beta/default.asp

    In the RCX2_SDK_BETA.zip there is a file named firm0328.lgo
    which is the firmware image.


    2. Download the firmware to the RCX2 brick
    ------------------------------------------

    In AmigaShell start NQC with following options
        (assuming firmware is in same directory):

    nqc -S<device> -firmware firm0238.lgo

    <device> is "usb" for USB IR Tower or "serial.device:0" for serial IR
    tower connected to port serial.device unit 0.

    This takes ca. 4 minutes.


    3. Compile and download test file
    ---------------------------------

    nqc -S<device> -d test.nqc

    The test program assumes there's a motor on output A and a touch sensor
    on input 1.  It turns on the motor and waits for the switch to be
    pressed, then it turns off the motor and plays a sound.

@endnode

@node usage "Usage"

    Usage:
    ------

    nqc [options] [actions] [ - | filename] [actions]


    Options:

    -1
        use NQC 1.x compatibility mode.  The RCX API changed significantly
        with version 2.0.  This flag makes the compiler grok old code.

    -T<target>
        generate code and use communications methods for "smart bricks"
        other than the RCX.  Can be either CM, Scout, RCX2 or Spy.

    -d
        download program to the RCX.  When this option is given, code is
        sent directly over the serial port (or via USB) to the brick and
        no output file is generated by default.

    -n
        prevent the standard file (rcx.nqh) from being automatically included.

    -b
        treat input file as a binary file (don't compile it)

    -D<sym>[=\<value>]
        define macro <sym> as <value>.

    -E[<filename>]
        write compiler errors to <filename> (or to stdout, if no name
        specified) instead of to stderr.

    -R<filename>
        redirect text output (datalog, etc) to <filename>

    -I<path>
        search <path> for include files.
        Can also be set with the NQC_INCLUDE environment variable.

    -L[<filename>]
        generate a human-readable bytecode listing to <filename>
        (or to stdout) instead of generating a binary file.

    -s
        include source code in listings if possible

    -O<outfile>
        output code to <outfile>.  This option causes a file to be written
        even if -d or -L is also given.  If no filename is specified, the
        output file will have the same basename as the input file but an
        extension of .rcx instead of .nqc.

    -S<device>[:<unit>]
        use serial device <device> unit <unit> for serial communication
        or "usb" for communication via usb. Default is serial.device:0.

        The port can also be specified via the RCX_PORT environment
        variable, but the command line option takes precedence.

    -U<sym>
        undefine macro <sym>.


    Actions:

    Actions look similar to options, but they have some subtle differences.
    In general, options set up things (such as a serial port) for later use,
    while actions cause something to happen.  Actions are executed in the
    order that they appear on the command line.  In addition, actions
    appearing before the source file happen before compilation, while
    actions after the source file happen after compilation.
    For historical reasons, downloading the compiled file (-d) works as an
    option and not an action.

    -run
        run the current program.  This causes the program selected on the
        RCX to execute.

    -pgm <number>
        select program number.  This changes the program slot on the RCX.

    -datalog
        get the datalog from the RCX and print it to stdout.

    -datalog-full
        same as -datalog but with more verbose output.

    -near
        set the IR port to short-range mode.

    -far
        set the IR port to long-range mode.

    -watch <time>
        set the RCX's clock to the specified time.  If you use "now", then
        the host's current time is used.

    -firmware <filename>
        downloads the firmware to the RCX.
        This will probably be necessary the first time you use your RCX,
        and whenever it's been without batteries for more than a few minutes.

        You can download the RCX 2.0beta firmware (firm0328.lgo) from the
        Lego Mindstorms Homepage:

            http://mindstorms.lego.com/sdk2beta/default.asp

        If you don't have a Wind*ws system this is the only possibility to
        get the firmware.

    -firmfast <filename>
        same as -firmware, but at quad speed.  Requires the tower to be in
        near mode (see -near).   If you have trouble getting the fast
        download to work, please revert to the older (and slower) method.

    -sleep <timeout>
        set RCX auto-shutoff timeout, in minutes.

    -msg <number>
        send IR message to RCX. The brick will respond to this just as it
        would a communication from another RCX.

    -raw <data>
        send an arbitrary packet to the RCX and print the reply (if any)
        to stdout. The data should be a hexadecimal string, with no spaces,
        zero-padded so that it is an even number of characters (although it
        may be an odd number of bytes). For example, to read the contents
        of variable 1, you could use -raw 120001. The bytecodes for raw
        messages can be found on web sites that document the RCX protocol.

    -remote <value> <repeat>
        send a repeating remote command to the RCX.

    -clear
        erase all programs and datalog from the RCX.


    Environment Variables:

    RCX_PORT

        sets the default serial port.  See the -S option.


    NQC_OPTIONS

        specifies extra options to be inserted into the command line.
        For example, setting NQC_OPTIONS to -TScout would cause nqc to
        target the Scout by default.


    NQC_INCLUDE

        specifies additional paths to search for include files.  See also the
        -I option.


    Examples:

        To compile foo.nqc, download the bytecode to program slot three,
        and make the RCX start executing it immediately:

            nqc -d -pgm 3 foo.nqc -run


        To just compile bar.nqc, resulting in bar.rcx:

            nqc bar.nqc


        To download bar.rcx to the RCX:

            nqc -d bar.rcx


        To set the IR tower to short-range mode and download the firmware
        at high speed:

            nqc -near -firmfast firm0328.lgo


        To compile test.nqc and print the resulting
        bytecode listing to the screen in human-readable format:

            nqc -L test.nqc

        This should result in the following output under nqc 2.5.r1:

            *** Task 0 = main
            000 pwr        ABC, 7                13 07 02 07
            004 dir        ABC, Fwd              e1 87
            006 sent       0, Switch             32 00 01
            009 senm       0, Boolean            42 00 20
            012 out        A, On                 21 81
            014 chkl       1 != Input(0), 14     95 82 09 01 00 00 fa ff
            022 plays      0                     51 00
            024 out        A, Off                21 41

            Total size: 26 bytes


        To use Lego USB Tower for communication:

            nqc -Susb -d test.nqc

@endnode

@node author "Author"

    The Not Quite C programming language and the nqc program were written and
    are maintained by Dave Baum.  Various contributions have been made by other
    people -- a full list of these can be found on Dave's web site.

    Homepage of NQC:

    http://www.baumfamily.org/nqc/index.html



    The Amiga port is done by:

    Uwe Ryssel
    Rottwerndorfer Str. 51a
    D-01796 Pirna
    Germany

    email: UweRyssel@gmx.de

    WWW:   http://people.freenet.de/uweryssel/

@endnode

@node history "History"

NQC Release Notes
-----------------

Please send bug reports to dfb@baumfamily.org.  Be sure to include
details about what platform you are running nqc on and a sample
file that demonstrates the bug if possible.

For updates and additional documentation, visit the NQC Web Site:
http://www.baumfamily.org/nqc.

version 2.5 r1
--------------

Functionally the same as 2.5 a5, except that it is now an official release instead of
in beta test.

version 2.5 a5
--------------

* fixed RepeatStmt to work with Spybotics
* fixed bug with writable sources and Spybotics
* fixed bug with jump optimization causing jumps to end-of-program to jump to the start of program instead
* fixed a bug with right shift of a negative operand
* added version resource in win32 build

version 2.5 a4
--------------

* added resource support for Spybotics (__res keyword)

* removed a few Spybotics features from the built-in API file.  The
  Spybotics API will be maintained as a separate file until it becomes
  more stable, at which point it will be merged back into the compiler.

version 2.5 a3
--------------

* Added optimizations for using short branches (jmp instead of jmpl and chk instead of chkl).

* Added fast firmware for USB (Mac OS X only, but framework is in place
  for other platforms to use).

* Added the -R option to redirect text output to a file (this is somewhat redundant for operating systems that provide good control over redirecting stdout and stderr).

* Added limited "goto" support.  Goto should be used with care since
  the compiler doesn't currently check to see if the goto would
  enter/leave control blocks such as acquire() and monitor().  As
  a result, those control blocks may not be properly set up or
  finished.  The bottom line is that you probably shouldn't be using
  goto in the first place, but if you need to, then you should use
  it with care.

* Removed nullable algorithm.  This was done in order to clean up some
  of the code generation code.  The only noticeable effect is that one
  previous optimization (empty repeat within a while loop) is no
  longer made.



version 2.5 a1
--------------

* Added supoprt for Spybotics.  Use -Tspy to tell NQC that you are using
  the Spybotics brick.  Currently, only serial communications are supported.
  Spybotics is very similar to an RCX 2.0 in terms of programming, except
  that it has only two motors, the sensors are pre-configured, there is
  no LCD display, and no Datalog.  There are some new capabilities with
  Spybotics, but not everything has an API in NQC yet.  Use "nqc -api"
  to view the current API definition (pay particular attention to things
  conditionally defined using __SPY).

* Fixed a bug with the Program() call.

* Removed a debugging printf (kept saying "draining") from the Unix build.

* Added a check for no firmware


version 2.4 r3
--------------

* fixed bug in RCX_PipeTransport::Open() that would sometimes pick
  the wrong pipe mode.  This would result in an error when NQC started
  to download a program.

* The Unix builds (including Mac OS X) now support disabling of calls
  to tcdrain() (which would hang on some flavors of Unix with some
  device drivers).  If NQC hangs when you try to download, append
  ":nodrain" to the device name.  For example, if your device was
  /dev/ttys0 then you would do this:

     nqc -S/dev/ttys0:nodrain -d test.nqc

* Mac OS X now defaults to enabling tcdrain().  This works fine under
  10.1.3 with the Keyspan serial drivers.  If you are using a combination
  of OS / drivers that hangs when NQC tries to download a program, add
  ":nodrain" to the serial device name (as described above).



version 2.4 r2
--------------

* added some error checking for empty -S, -I, -D, -U, and -O options
* added Mac OS 9 USB support (via the Lego Ghost API)

version 2.4 r1
--------------

* Fixed a bug that caused -D arguments not to be processed
* Improved #pragma reserve for locals
* changed -firmfast send delay to 100ms (should have better performance now)
* srecord parser is now more tolerant about line endings
* fixed bug with #elif not expanding macros if previous condition was false
* return code from main() is now an error code instead of just 0 or -1
* reorganized the Makefile

version 2.4 a4
--------------

* fixed bug that caused a crash when no serial device was specified (either
  with a -S option or the RCX_PORT environment variable).


version 2.4 a3
--------------

* added support for the Lego USB tower under some operating systems.  If
  supported, the tower is selected by specifying -Susb on the command line.
  Currently, Win32 and Mac OS X are the only platforms with USB support.
  I'll be adding Mac OS9 support as soon as Lego releases their driver for
  it.  Note that fast firmware download (-firmfast) is not allowed when
  using a USB tower.


version 2.4 a2
--------------

* added __sensor() expression for arg checking.  This fixes an old
  problem with SensorValueRaw(SENSOR_x) and other macros that can
  take a SENSOR_x as an argument.

* added the __NQC__ compile time symbol for the version number of
  NQC (for 2.4, __NQC__ is 204)

* improved the predictive timing of RCX_Link

* fixed a few minor bugs



version 2.4 a1
--------------

* added -s option, which will cause -L to emit merged source/assembly listings.
  This option only has effect when a source file is compiled/listed (it is
  ignored when binary .rcx files are listed).  The merged listing can be a bit
  confusing; especially since functions are expaned inline, and you will see
  the expanded function source mixed in with the caller's source.

* improved support for various operators and assignements (<<, >>, ^, ~).  The
  shift operators still require a constant shift amount, but the left operand
  may be any expression.  For the other operators, all constant restrictions
  have been removed.

* added new assignement operators (<<=, >>=, ^=, %=).  The shift assignments
  require a constant shift amount.

* added the ternary (?:) operator.

* some very old deprecated features from 1.x have been removed.  Specifically,
  the old syntax for tasks, subs, and function declaration has been removed. If
  you have been compiling without the -1 option and not seeing any warnings,
  then your code is fine and does not use the deprecated syntax.

* the deprecated -s and -c options (for Scout and CyberMaster support) have
  been eliminated.  The -T<target> option is now the only way to specify a
  target.

* expression evaluation when targeting RCX 2 has been optimized slightly.
  Specifically, prior to RCX 2 there were restrictions on the types of
  effective addresses that could be used in math bytecodes.  So NQC would
  typically move data from these types of addresses to a temporary variable,
  then use the temporary variable as an operand to the math bytecode.  With
  RCX 2, the restrictions have been eased, and NQC now takes advantage of this
  and uses the effective addresses directly as operands to math bytecodes
  when possible.

* Mac-only: eliminated call to LMGetUnitTableEntry() when opening serial port.
  Apparently for a brief period of time Apple forgot to include this call in
  their system ROMs (after of course telling all developers to use this call
  rather than access the low mem globals directly).



version 2.3 r1  (previously 2.3 b1)
-----------------------------------

* added the -b option to force input file to be treated as binary file
regardless of filename extension

* automatically switches a Scout to "power mode" when downloading a program

* fixed a bug with the -clear action (previously it would return an error even
though the RCX was cleared)

* fixed a bug that produced garbage when printing an error message that
occurred at the end of the source file

* fixed two bugs associated with evaluating expressions as conditions


version 2.3 a1
--------------

* merged conditions and expressions - relational operators may now be used
in expressions and the result of a calculation is a valid condition.  The
precedence and associativity is identical to that of C

* implemented partial catches for monitor statements, that is it is possible
to have multiple catch clauses to handle separate events.  This only works
for RCX 2.0.

    monitor(EVENT_MASK(1) + EVENT_MASK(2) + EVENT_MASK(3))
    {
    }
    catch (EVENT_MASK(1))
    {
      // will handle event 1
    }
    catch
    {
      // will handle any other events (2 and 3)
    }

* Added CurrentEvents() to the API.  This returns the enents that triggered
an event handler.  In general, its simpler to just use partial catches and
let the compiler do the work for you.

* Fixed a bug in the definition of DisableOutput

* rcxifile version updated to 1.0.2 (addition of target type)

* __taskid added - this expression returns the number of the task.  Note it
must be possible to determine the task number lexically at compile time for
this to be a valid expression (in other words, don't use it in a subroutine
called from multiple tasks).



version 2.2 r2
--------------


* enabled SetSleepTime() and SleepNow() in Scout API

* fixed a bug in Event()

* allow 16-bit unsigned constants (EVENT_MASK(15) now works)

* ignore ctrl-Z characters (0x1a) in input files

* error added for unterminated comments



version 2.2 r1
--------------

* removed SensorParam() from the API

* added SENSOR_TYPE_NONE to the API

* fixed a bug where CalibrateEvent() used the args in the wrong order

* fixed a bug in the disassembly listing for the chkl opcode

* fixed a bug with the code generation for repeat statments that
  used decvjnl for looping.  The offsets were not computed correctly
  (due to a sign bit) for offsets greater than 127 bytes.

* optimized code generation when __ASM_NO_LOCAL restrictor is used
  with an atomic expression of a restricted source.  Previously,
  the restricted source was moved to a local temp, then a global.  Now
  the restricted source is moved directly to a global temp.  In practice
  this means that AddToDatalog(Message()) takes two opcodes instead of
  three (and dirties one temp instead of two).


version 2.2 b1
--------------

* 'for' statement added

* simple array support for RCX2 added.  You can declare, set, and read
 array elements.  There is currently no support for initializing arrays,
 passing them as arguments, incrementing or decrementing elements with
 ++ and --, or any math assignment such as += or -=.

* SetUserDisplay() and AddToDatalog() now correctly use a global temp
 rather than a local one.  Even so, SetUserDisplay() should be used with
 care - generally a temp is the wrong thing to display!

* Most of the raw serial APIs have been changed slightly.  For the most
 part the change was replacing SerXXX with SerialXXX.

* EVENT_MASK() macro added to help in building event sets

* EVENT_TYPE_MAILBOX changed to EVENT_TYPE_MESSAGE

* Duration() changed to ClickTime()

* Most parameters, such as UpperLimit() now have calls such as
 SetUpperLimit() to set their value.

* Most of the global output commands were removed due to how confusing
 the whole system was.  There are now only three primitive commands:
 SetGlobalOutput(), SetGlobalDirection() and SetMaxPower().

* Minor changes to Scout calls for setting up the light sensor.  These
 changes make the Scout terminology align with the RCX2 calls.

* Constants for scout events, such as EVENT_1_PRESSED have been added.

* fixed bug that prevented 'continue' from working in a switch nested
 within a loop


version 2.2 a2
--------------

* "#praga reserve" may be used to prevent RCX variables from being used
by NQC.  The syntax is

#pragma reserve start [end]

For example, to reserve locations 0 and 1 (where the RCX2 counters are):

#pragma reserve 0 1


* added SetSleepTime() and SleepNow() to the API

* removed Display() from the API (SetUserDisplay() is sufficient)

* changed SetEvent and event sources...now just specify the source literally:

    SetEvent(0, SENSOR_2, EVENT_TYPE_PRESSED);


* Error checking netsted monitor or acquire statements

* monitor/acquire exits loops and functions correctly

* fixed bug where non-existant handlers could cause a crash

* MonitorStmt properly restricts event sources when generating Scout code


version 2.2 a1
--------------

* rcx1.nqh and rcx2.nqh are no longer supplied in the distribution.  Instead,
they can be generated directly from NQC (which contains ebmedded versions of
these files).  The -api option will cause NQC to emit the appropraite API
file (normally the 2.0 api, unless 1.0 compatability mode has been selected):

    nqc -api

    nqc -1 -api

* Firmware download supports large files (such as the RCX 2.0 firmware).  Also
fixed a bug in fast firmware download.

* modulo operator (%) now supported for non-constant operands

* Preliminary RCX 2.0 API - see the api file for the actual constants and
functions.  Use a target of rcx2  in order to generate RCX 2.0 code.
For example:

    nqc -Trcx2 -d test.nqc

* local variables are utilized when compiling for Scout or RCX 2

* event monitoring is supported with a monitor/catch construct...

    monitor(events)
    {
        // body
    }
    catch
    {
        // handler
    }

    'events' is the set of events to watch.  The 'catch' and handler are
    optional.  The body is executed.  If one of the monitored events occur,
    then body will be interrupted and the handler will be executed.   Events
    are only availabe for Scout and RCX 2.

* resource acquisition is supported with acquire/catch construct...

    acquire(resources)
    {
        // body
    }
    catch
    {
        // handler
    }

    'resources' is the set of resources to acquire (ACQUIRE_OUT_A, etc) and
    must be a compile-time constant.  An attempt is made to acquire the
    resources.  If sucessful, execution proceeds to the body.  If unsuccessful,
    or if during execution of the body the resources are preempted by another
    task, execution jumps to the handler (if any).  Under normal operation
    resources are released at the conclusion of the body.  Resource acqusition
    is only supported for Scout and RCX 2.


NOTE - event monitoring and resource acquisition are still in preliminary form.
There are a number of unimplemented details...

 - Nesting of monitor and/or acquire statements will almost certainly result
 in programs that don't operate as expected.

 - Statments such as break, continue, or return that cause flow control from
 inside a monitor/acquire statement to outside it will not operate properly.



version 2.1 r2
--------------

* disabled duplicate reduction code in rcxlib when sending RCX messages.  This
should only affect people using the rcxlib sources for their own projects - nqc
never directly used this behavior.

* added an error for recursive function calls

* fixed a bug in local variable allocation when one inline function calls a
second one

* orphan subs (those never invoked from any task) are now allowed to allocate
variables from the main task's pool (previously they couldn't allocate any
variables)


version 2.1 r1
--------------

* code generation for repeat() has been improved quite a bit
   - correctly implemented for Scout
   - nested repeats() are now legal
   - the repeat count can be greater than 255
   - the RCX loop counter is used whenever possible (non-nested
     repeat with compile time constant count of 0-255), otherwise
     a temporary variable is claimed to do the repeat.  Note that this
     will break code that used every single variable and then had a repeat
     count that came from a variable.  In previous versions of NQC, the
     repeat would use the built-in loop counter even though the repeat
     count (in the variable) may have exceeded 255.  The current version
     of NQC is more paranoid, and will not use the built-in loop counter
     in this case, thus a temporary variable needs to be allocated.

* total bytecode size is included in the listing


version 2.1 b3 (beta 3)
-----------------------

* Fixed bug where __SCOUT was not defined properly

* Output files now default to being placed in the current directory rather
that next to the source file.

* Trailing directory delimiter (e.g. / for Unix) is now optional with the
-I option.

* For WIN32, command line escaping of quotes (e.g. \") is disabled.  This
is a temporary measure for RcxCC compatability until RcxCC can be updated.


version 2.1 b2 (beta 2)
-----------------------

* Added the NQC_OPTIONS environment variable, which can be used to specify
extra options to be inserted into the command line.  For example, setting
NQC_OPTIONS to "-TScout" would cause nqc to target the Scout by default.

* A 'switch' statement was added. The generated code is reasonably good
considering the limitations of the RCX bytecodes.  However, some optimizations
(such as surpressing a 'break' in the last case) are not implemented [yet].

* Expressions are now coerced into conditions where appropriate.  For example,
you can do this:

  int x;

  while(x)
  {
  }


* Improved Scout support - battery level is checked on download, API file
merged into compiler so "scout.nqh" no longer needs to be included, PlayTone()
now supports both constant and variable argument for frequency.

* Switched over to official Lego mnemonics for those operations listed in the
Scout SDK.  Bytecodes not present on Scout still use the older NQC mnemonics,
but will change eventually.

* __type() operator added.  This is just a nasty low-level hack to
allow an inline function to call two different bytecodes depending on the
type of the argument passed in.  Used for PlayTone() when targeting the Scout.

* fixed a bug introduced in 2.1 b1 that caused problems using include files
with DOS line endings.


version 2.1 b1 (beta 1)
-----------------------

* Added preliminary support for Scout.  See "scout.txt" for more information
on Scout support in NQC.

* Added support for faster firmware downloading.  Firmware will download
about 4 times as fast with this option, but it requires the IR tower to
be in "near" mode.  If you have trouble getting the fast download to work,
please revert to the older (and slower) method.

  Fast:  nqc -firmfast <filename>
  Slow:  nqc -firmware <filename>

* The -o, -e, and -s options have been removed (they were deprecated quite
a while back).  If you still use these options, please change to the -O,
-E, and -S variant.

* The -c option (cybermaster support) has been deprectaed.  NQC now has a
more general option to specify the target: use -TCM for cybermaster:

  nqc -TCM -d test.nqc

Other targets include -TScout and -TRCX (the default).

* A couple of bugs relating to compiling stdin were fixed.



version 2.0.2
-------------

Fixed a bug which caused NQC to crash when compiling programs containing
functions with certain errors in them.


version 2.0.1
-------------

Fixed a bug that caused the compiler to crash when more than 32 variables
were used in a program.

The Win32 version no longer aborts due to serial driver errors - the retry
algorithm will remain in effect.  This makes download of very long programs
much more reliable (especially under WinNT).

The retry algorithm is now more forgiving if the IR tower doesn't echo the
serial data properly.  This makes very long downloads a little more reliable.


version 2.0
-----------

First official release of NQC 2.0

@endnode

@node bugs "Bugs"

    Bugs:
    -----

    Original NQC:

        - none known

    Amiga version:

        - perhaps

        This version is only tested with RCX2 and Lego USB Tower.
        The serial support is NOT tested, because I don't possess the
        serial IR tower.

        If somebody can test it, please send me reply.

@endnode

@node license "License"


                           MOZILLA PUBLIC LICENSE
                                Version 1.0

                              ----------------

1. Definitions.

     1.1. ``Contributor'' means each entity that creates or contributes to
     the creation of Modifications.

     1.2. ``Contributor Version'' means the combination of the Original
     Code, prior Modifications used by a Contributor, and the Modifications
     made by that particular Contributor.

     1.3. ``Covered Code'' means the Original Code or Modifications or the
     combination of the Original Code and Modifications, in each case
     including portions thereof.

     1.4. ``Electronic Distribution Mechanism'' means a mechanism generally
     accepted in the software development community for the electronic
     transfer of data.

     1.5. ``Executable'' means Covered Code in any form other than Source
     Code.

     1.6. ``Initial Developer'' means the individual or entity identified as
     the Initial Developer in the Source Code notice required by Exhibit A.

     1.7. ``Larger Work'' means a work which combines Covered Code or
     portions thereof with code not governed by the terms of this License.

     1.8. ``License'' means this document.

     1.9. ``Modifications'' means any addition to or deletion from the
     substance or structure of either the Original Code or any previous
     Modifications. When Covered Code is released as a series of files, a
     Modification is:

          A. Any addition to or deletion from the contents of a file
          containing Original Code or previous Modifications.

          B. Any new file that contains any part of the Original Code or
          previous Modifications.

     1.10. ``Original Code'' means Source Code of computer software code
     which is described in the Source Code notice required by Exhibit A as
     Original Code, and which, at the time of its release under this License
     is not already Covered Code governed by this License.

     1.11. ``Source Code'' means the preferred form of the Covered Code for
     making modifications to it, including all modules it contains, plus any
     associated interface definition files, scripts used to control
     compilation and installation of an Executable, or a list of source code
     differential comparisons against either the Original Code or another
     well known, available Covered Code of the Contributor's choice. The
     Source Code can be in a compressed or archival form, provided the
     appropriate decompression or de-archiving software is widely available
     for no charge.

     1.12. ``You'' means an individual or a legal entity exercising rights
     under, and complying with all of the terms of, this License or a future
     version of this License issued under Section 6.1. For legal entities,
     ``You'' includes any entity which controls, is controlled by, or is
     under common control with You. For purposes of this definition,
     ``control'' means (a) the power, direct or indirect, to cause the
     direction or management of such entity, whether by contract or
     otherwise, or (b) ownership of fifty percent (50%) or more of the
     outstanding shares or beneficial ownership of such entity.

2. Source Code License.

     2.1. The Initial Developer Grant.
     The Initial Developer hereby grants You a world-wide, royalty-free,
     non-exclusive license, subject to third party intellectual property
     claims:

          (a) to use, reproduce, modify, display, perform, sublicense and
          distribute the Original Code (or portions thereof) with or without
          Modifications, or as part of a Larger Work; and

          (b) under patents now or hereafter owned or controlled by Initial
          Developer, to make, have made, use and sell (``Utilize'') the
          Original Code (or portions thereof), but solely to the extent that
          any such patent is reasonably necessary to enable You to Utilize
          the Original Code (or portions thereof) and not to any greater
          extent that may be necessary to Utilize further Modifications or
          combinations.

     2.2. Contributor Grant.
     Each Contributor hereby grants You a world-wide, royalty-free,
     non-exclusive license, subject to third party intellectual property
     claims:

          (a) to use, reproduce, modify, display, perform, sublicense and
          distribute the Modifications created by such Contributor (or
          portions thereof) either on an unmodified basis, with other
          Modifications, as Covered Code or as part of a Larger Work; and

          (b) under patents now or hereafter owned or controlled by
          Contributor, to Utilize the Contributor Version (or portions
          thereof), but solely to the extent that any such patent is
          reasonably necessary to enable You to Utilize the Contributor
          Version (or portions thereof), and not to any greater extent that
          may be necessary to Utilize further Modifications or combinations.

3. Distribution Obligations.

     3.1. Application of License.
     The Modifications which You create or to which You contribute are
     governed by the terms of this License, including without limitation
     Section 2.2. The Source Code version of Covered Code may be distributed
     only under the terms of this License or a future version of this
     License released under Section 6.1, and You must include a copy of this
     License with every copy of the Source Code You distribute. You may not
     offer or impose any terms on any Source Code version that alters or
     restricts the applicable version of this License or the recipients'
     rights hereunder. However, You may include an additional document
     offering the additional rights described in Section 3.5.

     3.2. Availability of Source Code.
     Any Modification which You create or to which You contribute must be
     made available in Source Code form under the terms of this License
     either on the same media as an Executable version or via an accepted
     Electronic Distribution Mechanism to anyone to whom you made an
     Executable version available; and if made available via Electronic
     Distribution Mechanism, must remain available for at least twelve (12)
     months after the date it initially became available, or at least six
     (6) months after a subsequent version of that particular Modification
     has been made available to such recipients. You are responsible for
     ensuring that the Source Code version remains available even if the
     Electronic Distribution Mechanism is maintained by a third party.

     3.3. Description of Modifications.
     You must cause all Covered Code to which you contribute to contain a
     file documenting the changes You made to create that Covered Code and
     the date of any change. You must include a prominent statement that the
     Modification is derived, directly or indirectly, from Original Code
     provided by the Initial Developer and including the name of the Initial
     Developer in (a) the Source Code, and (b) in any notice in an
     Executable version or related documentation in which You describe the
     origin or ownership of the Covered Code.

     3.4. Intellectual Property Matters

          (a) Third Party Claims.
          If You have knowledge that a party claims an intellectual property
          right in particular functionality or code (or its utilization
          under this License), you must include a text file with the source
          code distribution titled ``LEGAL'' which describes the claim and
          the party making the claim in sufficient detail that a recipient
          will know whom to contact. If you obtain such knowledge after You
          make Your Modification available as described in Section 3.2, You
          shall promptly modify the LEGAL file in all copies You make
          available thereafter and shall take other steps (such as notifying
          appropriate mailing lists or newsgroups) reasonably calculated to
          inform those who received the Covered Code that new knowledge has
          been obtained.

          (b) Contributor APIs.
          If Your Modification is an application programming interface and
          You own or control patents which are reasonably necessary to
          implement that API, you must also include this information in the
          LEGAL file.

     3.5. Required Notices.
     You must duplicate the notice in Exhibit A in each file of the Source
     Code, and this License in any documentation for the Source Code, where
     You describe recipients' rights relating to Covered Code. If You
     created one or more Modification(s), You may add your name as a
     Contributor to the notice described in Exhibit A. If it is not possible
     to put such notice in a particular Source Code file due to its
     structure, then you must include such notice in a location (such as a
     relevant directory file) where a user would be likely to look for such
     a notice. You may choose to offer, and to charge a fee for, warranty,
     support, indemnity or liability obligations to one or more recipients
     of Covered Code. However, You may do so only on Your own behalf, and
     not on behalf of the Initial Developer or any Contributor. You must
     make it absolutely clear than any such warranty, support, indemnity or
     liability obligation is offered by You alone, and You hereby agree to
     indemnify the Initial Developer and every Contributor for any liability
     incurred by the Initial Developer or such Contributor as a result of
     warranty, support, indemnity or liability terms You offer.

     3.6. Distribution of Executable Versions.
     You may distribute Covered Code in Executable form only if the
     requirements of Section 3.1-3.5 have been met for that Covered Code,
     and if You include a notice stating that the Source Code version of the
     Covered Code is available under the terms of this License, including a
     description of how and where You have fulfilled the obligations of
     Section 3.2. The notice must be conspicuously included in any notice in
     an Executable version, related documentation or collateral in which You
     describe recipients' rights relating to the Covered Code. You may
     distribute the Executable version of Covered Code under a license of
     Your choice, which may contain terms different from this License,
     provided that You are in compliance with the terms of this License and
     that the license for the Executable version does not attempt to limit
     or alter the recipient's rights in the Source Code version from the
     rights set forth in this License. If You distribute the Executable
     version under a different license You must make it absolutely clear
     that any terms which differ from this License are offered by You alone,
     not by the Initial Developer or any Contributor. You hereby agree to
     indemnify the Initial Developer and every Contributor for any liability
     incurred by the Initial Developer or such Contributor as a result of
     any such terms You offer.

     3.7. Larger Works.
     You may create a Larger Work by combining Covered Code with other code
     not governed by the terms of this License and distribute the Larger
     Work as a single product. In such a case, You must make sure the
     requirements of this License are fulfilled for the Covered Code.

4. Inability to Comply Due to Statute or Regulation.

     If it is impossible for You to comply with any of the terms of this
     License with respect to some or all of the Covered Code due to statute
     or regulation then You must: (a) comply with the terms of this License
     to the maximum extent possible; and (b) describe the limitations and
     the code they affect. Such description must be included in the LEGAL
     file described in Section 3.4 and must be included with all
     distributions of the Source Code. Except to the extent prohibited by
     statute or regulation, such description must be sufficiently detailed
     for a recipient of ordinary skill to be able to understand it.

5. Application of this License.

     This License applies to code to which the Initial Developer has
     attached the notice in Exhibit A, and to related Covered Code.

6. Versions of the License.

     6.1. New Versions.
     Netscape Communications Corporation (``Netscape'') may publish revised
     and/or new versions of the License from time to time. Each version will
     be given a distinguishing version number.

     6.2. Effect of New Versions.
     Once Covered Code has been published under a particular version of the
     License, You may always continue to use it under the terms of that
     version. You may also choose to use such Covered Code under the terms
     of any subsequent version of the License published by Netscape. No one
     other than Netscape has the right to modify the terms applicable to
     Covered Code created under this License.

     6.3. Derivative Works.
     If you create or use a modified version of this License (which you may
     only do in order to apply it to code which is not already Covered Code
     governed by this License), you must (a) rename Your license so that the
     phrases ``Mozilla'', ``MOZILLAPL'', ``MOZPL'', ``Netscape'', ``NPL'' or
     any confusingly similar phrase do not appear anywhere in your license
     and (b) otherwise make it clear that your version of the license
     contains terms which differ from the Mozilla Public License and
     Netscape Public License. (Filling in the name of the Initial Developer,
     Original Code or Contributor in the notice described in Exhibit A shall
     not of themselves be deemed to be modifications of this License.)

7. DISCLAIMER OF WARRANTY.

     COVERED CODE IS PROVIDED UNDER THIS LICENSE ON AN ``AS IS'' BASIS,
     WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
     WITHOUT LIMITATION, WARRANTIES THAT THE COVERED CODE IS FREE OF
     DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR NON-INFRINGING.
     THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE COVERED CODE
     IS WITH YOU. SHOULD ANY COVERED CODE PROVE DEFECTIVE IN ANY RESPECT,
     YOU (NOT THE INITIAL DEVELOPER OR ANY OTHER CONTRIBUTOR) ASSUME THE
     COST OF ANY NECESSARY SERVICING, REPAIR OR CORRECTION. THIS DISCLAIMER
     OF WARRANTY CONSTITUTES AN ESSENTIAL PART OF THIS LICENSE. NO USE OF
     ANY COVERED CODE IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS DISCLAIMER.

8. TERMINATION.

     This License and the rights granted hereunder will terminate
     automatically if You fail to comply with terms herein and fail to cure
     such breach within 30 days of becoming aware of the breach. All
     sublicenses to the Covered Code which are properly granted shall
     survive any termination of this License. Provisions which, by their
     nature, must remain in effect beyond the termination of this License
     shall survive.

9. LIMITATION OF LIABILITY.

     UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY, WHETHER TORT
     (INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL THE INITIAL
     DEVELOPER, ANY OTHER CONTRIBUTOR, OR ANY DISTRIBUTOR OF COVERED CODE,
     OR ANY SUPPLIER OF ANY OF SUCH PARTIES, BE LIABLE TO YOU OR ANY OTHER
     PERSON FOR ANY INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
     OF ANY CHARACTER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF
     GOODWILL, WORK STOPPAGE, COMPUTER FAILURE OR MALFUNCTION, OR ANY AND
     ALL OTHER COMMERCIAL DAMAGES OR LOSSES, EVEN IF SUCH PARTY SHALL HAVE
     BEEN INFORMED OF THE POSSIBILITY OF SUCH DAMAGES. THIS LIMITATION OF
     LIABILITY SHALL NOT APPLY TO LIABILITY FOR DEATH OR PERSONAL INJURY
     RESULTING FROM SUCH PARTY'S NEGLIGENCE TO THE EXTENT APPLICABLE LAW
     PROHIBITS SUCH LIMITATION. SOME JURISDICTIONS DO NOT ALLOW THE
     EXCLUSION OR LIMITATION OF INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THAT
     EXCLUSION AND LIMITATION MAY NOT APPLY TO YOU.

10. U.S. GOVERNMENT END USERS.

     The Covered Code is a ``commercial item,'' as that term is defined in
     48 C.F.R. 2.101 (Oct. 1995), consisting of ``commercial computer
     software'' and ``commercial computer software documentation,'' as such
     terms are used in 48 C.F.R. 12.212 (Sept. 1995). Consistent with 48
     C.F.R. 12.212 and 48 C.F.R. 227.7202-1 through 227.7202-4 (June 1995),
     all U.S. Government End Users acquire Covered Code with only those
     rights set forth herein.

11. MISCELLANEOUS.

     This License represents the complete agreement concerning subject
     matter hereof. If any provision of this License is held to be
     unenforceable, such provision shall be reformed only to the extent
     necessary to make it enforceable. This License shall be governed by
     California law provisions (except to the extent applicable law, if any,
     provides otherwise), excluding its conflict-of-law provisions. With
     respect to disputes in which at least one party is a citizen of, or an
     entity chartered or registered to do business in, the United States of
     America: (a) unless otherwise agreed in writing, all disputes relating
     to this License (excepting any dispute relating to intellectual
     property rights) shall be subject to final and binding arbitration,
     with the losing party paying all costs of arbitration; (b) any
     arbitration relating to this Agreement shall be held in Santa Clara
     County, California, under the auspices of JAMS/EndDispute; and (c) any
     litigation relating to this Agreement shall be subject to the
     jurisdiction of the Federal Courts of the Northern District of
     California, with venue lying in Santa Clara County, California, with
     the losing party responsible for costs, including without limitation,
     court costs and reasonable attorneys fees and expenses. The application
     of the United Nations Convention on Contracts for the International
     Sale of Goods is expressly excluded. Any law or regulation which
     provides that the language of a contract shall be construed against the
     drafter shall not apply to this License.

12. RESPONSIBILITY FOR CLAIMS.

     Except in cases where another Contributor has failed to comply with
     Section 3.4, You are responsible for damages arising, directly or
     indirectly, out of Your utilization of rights under this License, based
     on the number of copies of Covered Code you made available, the
     revenues you received from utilizing such rights, and other relevant
     factors. You agree to work with affected parties to distribute
     responsibility on an equitable basis.

EXHIBIT A.

     ``The contents of this file are subject to the Mozilla Public License
     Version 1.0 (the "License"); you may not use this file except in
     compliance with the License. You may obtain a copy of the License at
     http://www.mozilla.org/MPL/

     Software distributed under the License is distributed on an "AS IS"
     basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
     License for the specific language governing rights and limitations
     under the License.

     The Original Code is ______________________________________.

     The Initial Developer of the Original Code is ________________________.
     Portions created by ______________________ are Copyright (C) ______
     _______________________. All Rights Reserved.

     Contributor(s): ______________________________________.''

@endnode

