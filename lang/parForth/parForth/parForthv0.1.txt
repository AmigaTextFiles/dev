parForth v0.1 by Nathan Hesterman (2022-12-20)

parForth v0.1 (pForth for AROS) is pForth v27 by Phil Burk compiled to allow calling of AROS functions.  It includes
words for executing AROS DOS commands, accessing libraries, double-linked lists, ports, windows, menus, and gadgets.
It defines ANS Forth Facility Extension words TIME&DATE and MS.  It defines RANDOMIZE so that 0 RANDOMIZE seeds CHOOSE
with a random seed based upon clock ticks (50 per second) since the start of day.  It provides extracts from 'JForth
for the Amiga' AmigaDOS 2.0 include (.j) files and words to parse these structures.  JForth is freeware that can be
downloaded from http://www.softsynth.com/jforth.  parForth defines all kinds of GadTools gadgets and provides a
demonstration program.  Everything in this system uses relocatable addresses so can be compiled or turnkeyed. 

Directory Structure:
	the fth directory provides all of the files to create pforth.dic via 'pforth -i system.fth'
		the executable pforth and default dictionary pforth.dic reside here
		parForthExt.f defines misc. words implementing DOS calls, parForth lists, switches, and words to parse
			JForth structures.  It includes time&date.f and ms.f.
		system.fth splits out a (SEE) from SEE so that you can (SEE) executable tokens
		loadp4th.fth commented out include of:
			task-member.fth and c_truct.fth in favor of using parForth structures (based upon 'Multi-Forth for the Amiga') 
			termio.fth as it is incompatible with AROS shell and causes echoing
			history.fth as it duplicates the functionality of AROS shells
	the fth/parForthExtensions directory provides:
		time&date.f which defines the ANS Forth Facility Extension word TIME&DATE (in pforth.dic)
		ms.f which defines the ANS Forth Facility Extension word MS (in pforth.dic)
		api.f which defines words to work with AROS libraries, lists, and message ports
		gadtools.f which defines words to work with AROS windows, menus, and all kinds of GadTools gadgets
	the fth/MyCode directory
		gadtoolsdemon.f is a demonstration of windows, menus, and gadgets using parForth

Differences from pForth v27:
	ARRAY redefined to allow any width, not just a CELL width
	uses the Relocation system from 'Multi-Forth for the Amiga' to handle relative addresses
	replaces words for defining and handling structures based upon 'Multi-Forth for the Amiga' syntax

Some misc. parForth words from parForthExt.f:
	R! and R,				flag addresses for an eventual RELOCATE
	0" 						creates a zero-terminated string required by AROS function calls
	CD path					changes the working directory to path
	DOS <a DOS command>		executes a DOS command
	DOS						functions like a DOS shell until exited with 'Forth' or a CR
	0" a DOS command" (DOS) executes a DOS command from within words
	( node list -- ) LINK	adds a node to the head of the given list
	( node list -- ) LINK>	adds a node to the tail of the given list
	[SWITCH Test 1 RUNS ABORT 2 RUN: ." case# 2" ;RUN 3 RUN: ." case# 3" ;RUN SWITCH] 2 test ( prints 'case# 2')
	switches are extendable case lists that are used extensively in parForth
	
	the 0$ path in -MyCodePath will become current upon startup via auto.init for fast access to your code directory
	" path-to-code" MyCodePath will install a new path to your code (default is S:)
	
	the 0$ path in -parForthPath will become current upon BYE via auto.term (for fast 'pforth -i system.fth')
	" path-to-pforth" parForthPath will install new path to your pforth & pforth.dic (default is SYS:)
	
AROS Connectivity ***************************************************************
	these tools are relocateable so can be compiled, cloned, or turnkeyed
	AROS structures are extracted from the freeware 'JForth for the Amiga' AmigaDos 2.0 include files (.j)
	JForth can be downloaded from http://www.softsynth.com/jforth
	words to parse these structures are defined in parForthExt.f

	libraries ===================================================================
		libraries are defined in API.f
		example: " intuition.library" 0 LIBRARY IntuitionBase
			this defines IntuitionBase for calling Intuition functions and adds it to the library list
			the zero means we'll accept any version of the library
		Libraries is a list of parForth library structures
		libraries will open themselves when one of their functions is called
		-1 IntuitionBase will close the intuition library
		libEnd closes all open libraries; it is a part of auto.term on BYE
		AROS function names are prefixed with an underscore
			: _DisplayBeep ( -- ) 0 16 IntuitionBase CALL1NR ;
			DisplayBeep is an intuition function which flashes the display
			it is function number 16 of the intuition library
			CALL1NR expects one parameter (screen) on the stack and provides no return value
			CALL3 expects 3 parameters on the stack and will return a value on the stack
		AROS function numbers can be found by library and function name in the AROS/rom directory of the SDK
		https://d0.se/docs is an excellent reference for Autodocs and Include files for AmigaDOS
		the AROS development site is more specific to AROS, however, as there are some differences that bite
		
	ports =======================================================================
		ports are defined in API.f
		example: PORT WindowPort DOES HandleWindows
			this creates a named parForth port (pfPort structure) in the dictionary that handles all windows' events
			it is added to the ports list
			the word WindowPort makes it the active port for further manipulation
		Ports is a list of parForth ports
		P returns the active parForth port instance
		MP returns the AROS message port associated with P
		pOpen creates and opens an AROS port for P
		pClose closes and deletes MP
		pEnd closes all ports; it is part of auto.term on BYE
		all ports should be opened before you start listening for messages
		LISTEN waits for a message for any port in the Ports list
		when a message arrives, it calls the appropriate port handler (HandleWindows for the example port)
		LISTENING OFF disables the LISTEN loop

	fonts =======================================================================
		fonts are defined in GadTools.f
		example: " arial.font" 15 FS_NORMAL FONT Arial15
			this creates a parForth font structure and adds it to the list called Fonts
			Arial15 makes this the current font
		Menus and gadgets look at the current font when defined for use when displayed
		ScreenFont makes the screen font current (user selected via font preferences)
		font styles FS_ITALIC, FS_BOLD, and FS_UNDERLINED are also possible instead of FS_NORMAL

	windows =====================================================================
		windows are defined in GadTools.f
		example: " GadTools Gadgets" WINDOW MyWindow
			this creates a named parForth window (pfWindow structure) in the dictionary entitled "GadTools Gadgets"
			it is added to the windows list
			the word MyWindow makes it the active window for further manipulation
		Windows is a list of parForth windows
		W returns the current parForth window
		WD returns the AROS window for W
		pfWindow is the parForth window structure
			w_Next points to next window in Windows list
			w_WD points to open AROS window (null if not open)
			w_Events is a switch for IDCMP events and their handlers (Events ... Events.End)
			w_Menus is a pointer to an an array of GadTools NewMenu structures (Menus ... Menus.End)
			w_MenuFont points to the parForth font to use for menu rendering
			w_Gadgets is a list of GadTools NewGadget structures (Gadgets ... Gadgets.End)
			w_Title points to the null-terminated window title for the AROS window
			w_GList is the context for creating gadgets; points to first of the AROS gadgets for WD
		wOpen opens the AROS window on the public screen for W using the DefaultWindow AROS NewWindow structure
			with user-defined port (pOpen), menus (mOpen), gadgets (gOpen), and window events (EventsOn)
		example: MyWindow Bordered #CENTER #CENTER 50 %scSize wOpen
			template: window_flags left top width height wOpen
			window_flags Bordered or Backdrop are two predefined window types
			can use constants #LEFT, #RIGHT, #CENTER for left
			can use constants #TOP, #BOTTOM, #CENTER for top
			%scSize can be used to create width and height based upon a percentage of screen size
				same for $scWidth or %scHeight
		wClose closes/frees WD including menus (mClose) and gadgets (gFree)
		wEnd closes all open windows, frees VisualInfo (viFree), and unlocks screen (scFree)
			it is part of auto.term on BYE
		wChange ( left top width height -- ) changes the position and size of W; position constants can be used
		wMove   ( left top -- ) changes the position of W; position constants can be used
		w+Move  ( dX dY -- ) changes the position of W by delta amounts
		wSize   ( width height -- ) changes the size of W

	menus ---------------------------------------------------------------------------------
	EZMenu definitions compile an array of GadTools NewMenu structures in the dictionary for W
		Menus starts then menu definition for W
		Menu", Item", and Sub" with CommKey and Bar define layout
		DOES (or DO ;DO pair) defines action for that menu item
		Menus.End ends menu definition for W
		mOpen creates/activates Intuition menu system as called in wOpen
		mClose deactivates/frees Intuition menu system as called in wClose

	gadgets -------------------------------------------------------------------------------
	EZGadget definitions compile a list of GadTools NewGadget structures in the dictionary for W
		Gadgets begins the definition of gadgets for W
		Gadgets.End finishes the definition of gadgets for W
		Cycle, ListView, and MX (radio) gadgets require a list of choices
			Choices begins the compilation of the choice list for the preceding gadget
			Choice" defines the name of a choice
			Choices.End finishes the compilation of choices for the preceeding gadget
		Button, Checkbox, Cycle, Listview, MX, AString, Integer, Slider, and Palette gadgets all end with
			DOES (or a DO: ;DO pair) to define the action for when the gadget is clicked
		AText, Label, and Number gadgets are read only so have no action to define
		all gadget definitions require left, top, width, height, title as the first parameters on the stack
		look at GadToolsDemo.f for the window, menu, and gadget definition examples
		string gadgets are defined with ASTRING (AROS STRING) so as not to conflict with the parForth word STRING
		text gadgets are defined with ATEXT (AROS TEXT) so as not to conflict with the parForth word TEXT
		the specific syntax for defining each gadget kind follows:
			l t w h " title"                 BUTTON   name        DOES|DO:_;DO
			l t w h " title"                 CHECKBOX name ON|OFF DOES|DO:_;DO
			l t w h " title"                 MX       name        DOES|DO:_;DO Choices Choice" ... Choices.End
			l t w h " title"                 CYCLE    name        DOES|DO:_;DO Choices Choice" ... Choices.End
			l t w h " title"                 LISTVIEW name        DOES|DO:_;DO Choices Choice" ... Choices.End
			l t w h " title" Default" Hello" ASTRING  name        DOES|DO:_;DO
			l t w h " title" Default" Hello" ATEXT    name
			l t w h " Hello"                 LABEL    name
			l t w h " title"               n INTEGER  name        DOES|DO:_;DO
			l t w h " title"               n NUMBER   name
			l t w h " title" #pens start_pen PALETTE  name        DOES|DO:_;DO
			Vertical ON|OFF
			l t w h " title" min max level n SLIDER   name        DOES|DO:_;DO
		changing gadget actions post-definition
			GADGET name DOES|DO:_;DO
		getting and setting gadget attributes programmatically
			attributes that can be get/set are indicated in the TagList definitions for each gadget kind in GadTools.f
			invoking the name of a gadget leaves its AROS gadget address on the stack
			if we have a Cycle gadget named CY1
				CY1 GTCY_Active gGet will leave the active entry for this cycle gadget on the stack
				the major attribute for each kind of gadget is named Choice so you don't need to remember the tag names
				so the above example can also be written CY1 Choice gGet; the same for all other gadget kinds
				3 CY1 Choice gSet will change the active entry in the cycle gadget named CY1 to 3
				FALSE CB1 Choice gSet will uncheck the checkbox named CB1, TRUE will check the checkbox 
				getting/setting other attributes will require that you know the tag name

AROS GadTools bugs
	GT_GetGadgetAttrsA returns wrong number of tags processed in some cases so return value is ignored.
	String gadget trashes display if string is longer than width of string box and you cursor left to get to start of string

todo
	automate shortcut keys for gadget activation
	use Zune windows, menus, and gadgets
	provide JForth include files
	can't provide until parForth NODE is renamed and Amiga Node is replaced with AROS Node
