%   File   : transitive.pl
%   Author : Neng-Fa ZHOU
%   Date   : 1992
%
:-determinate([select_all/2,bt/2]).

go:- true : test(100).

test(N):-
    true :
    cputime(Start),
    range(1,N,Ns),
    bt(arc_bt(Ns,Ns),false),
    functor(OldG,neibs,N),
    generate_graph(1,N,OldG),
    trans_closure(Ns,OldG),
    collect_result(Ns,C),
    cputime(End),
    T is End-Start,
    write('execution time : '), write(T),nl,
    write(C).

range(N0,N,L):-
    N0=:=N :
    L:=[N].
range(N0,N,L):-
    true :
    L:=[N0|L1],
    N1 is N0+1,
    range(N1,N,L1).

generate_graph(N0,N,G):-
    N0>N :
    true.
generate_graph(N0,N,G):-
    true :
    connected(1,N,N0,Xs),
    arg(N0,G,Xs),
    N1 is N0+1,
    generate_graph(N1,N,G).

connected(N0,N,X,Ys):-
    N0>N :
    Ys=[].
connected(N0,N,X,Ys):-
    arc(X,N0) :
    Ys:=[N0|Ys1],
    N1 is N0+1,
    connected(N1,N,X,Ys1).
connected(N0,N,X,Ys):-
    true :
    N1 is N0+1,
    connected(N1,N,X,Ys).

trans_closure([],OldG):-true : true.
trans_closure([V|Vs],OldG):-
    true :
    arg(V,OldG,Neibs),
    connected_component(V,Neibs,OldG),
    trans_closure(Vs,OldG).

connected_component(_,[],OldG):-true : true.
connected_component(U,[V|Vs],OldG):-
    true ?
    bt_true(arc_bt(U,V)),
    connected_component(U,Vs,OldG).
connected_component(U,[V|Vs],OldG):-
    true :
    bt_set_true(arc_bt(U,V)),
    arg(V,OldG,Neibs),
    connected_component(U,Neibs,OldG),
    connected_component(U,Vs,OldG).

collect_result([],G):-
    true :
    G=[].
collect_result([N|Ns],G):-
    true :
    select_all(arc_bt(N,_),Arcs),
    G:=[Arcs|G1],
    collect_result(Ns,G1).


%relation R:
arc(X,Y):-
    arcs(X,Ys),
    membchk(Y,Ys).

membchk(X,[X|_]):-
    true : true.
membchk(X,[_|L]):-
    true :
    membchk(X,L).

arcs(1,[]).
arcs(2,[7,11,15,31,35,39,47,55,59,63,67,75,79,83,87,91,95,99]).
arcs(3,[]).
arcs(4,[1,5,13,21,33,37,41,45,49,53,61,65,69,85,93]).
arcs(5,[]).
arcs(6,[3,15,23,27,35,47,51,55,59,67,71,75,83,87,99]).
arcs(7,[]).
arcs(8,[1,5,21,25,33,41,45,57,61,81,89,97]).
arcs(9,[]).
arcs(10,[3,7,19,35,39,43,55,67,71,75,79,87]).
arcs(11,[]).
arcs(12,[17,21,29,37,53,57,61,73,77,81,85,93,97]).
arcs(13,[]).
arcs(14,[7,19,23,27,31,43,47,55,59,67]).
arcs(15,[]).
arcs(16,[9,65,77,81,85,97]).
arcs(17,[]).
arcs(18,[11,15,19,31,35,39,43,67,75,83,87,99]).
arcs(19,[]).
arcs(20,[9,13,17,21,41,45,49,53,61,69,73,77,81,97]).
arcs(21,[]).
arcs(22,[3,11,15,23,31,35,39,43,47,51,63,67,75,83,87,91,95,99]).
arcs(23,[]).
arcs(24,[5,13,25,29,33,37,45,49,53,61,65,73,77,81,85,93,97]).
arcs(25,[]).
arcs(26,[11,15,23,31,35,39,43,51,59,71,75,79,83]).
arcs(27,[]).
arcs(28,[1,5,21,25,29,37,41,45,49,57,65,73,77,85,89,97]).
arcs(29,[]).
arcs(30,[7,15,27,31,35,43,51,55,63,67,75,79,83,87,91,99]).
arcs(31,[]).
arcs(32,[9,17,21,29,33,41,45,53,61,65,77,81,89,97]).
arcs(33,[]).
arcs(34,[3,7,11,15,19,27,31,35,51,55,59,63,67,71,83,87,91,95,99]).
arcs(35,[]).
arcs(36,[5,9,17,21,29,33,37,41,53,57,69,73,81,89]).
arcs(37,[]).
arcs(38,[7,15,23,27,43,47,51,55,59,63,67,75,91,95]).
arcs(39,[]).
arcs(40,[13,41,45,49,53,57,61,65,69,81,85,89,93,97]).
arcs(41,[]).
arcs(42,[3,7,11,15,19,23,31,35,39,43,47,63,71,75,79,87,91,99]).
arcs(43,[]).
arcs(44,[5,9,21,29,33,49,53,57,61,65,73,77,89]).
arcs(45,[]).
arcs(46,[3,31,35,43,55,75,87,91,99]).
arcs(47,[]).
arcs(48,[9,13,25,37,41,61,73,77,85,89,97]).
arcs(49,[]).
arcs(50,[7,31,35,39,55,59,63,71,75,79,83,87,91]).
arcs(51,[]).
arcs(52,[13,41,45,49,53,61,69,77,81,85,89,93,97]).
arcs(53,[]).
arcs(54,[3,11,15,19,27,43,47,55,71,75,83,99]).
arcs(55,[]).
arcs(56,[9,13,21,25,53,61,69,77,81,85,89,93,97]).
arcs(57,[]).
arcs(58,[3,15,19,23,31,51,59,63,75,83,87,91,99]).
arcs(59,[]).
arcs(60,[1,13,21,25,29,37,53,57,65,69,97]).
arcs(61,[]).
arcs(62,[3,11,35,43,47,51,63,67,79,83,87,91,95,99]).
arcs(63,[]).
arcs(64,[1,5,9,21,29,49,53,61,69,73,77,81,85,93,97]).
arcs(65,[]).
arcs(66,[3,11,23,35,43,47,55,67,71,79,91,99]).
arcs(67,[]).
arcs(68,[9,17,21,25,29,33,41,49,53,65,85,89,93,97]).
arcs(69,[]).
arcs(70,[3,7,27,35,43,47,75,79,83,87,99]).
arcs(71,[]).
arcs(72,[1,13,17,25,33,49,57,65,81,93]).
arcs(73,[]).
arcs(74,[3,7,11,15,27,31,47,67,83,95,99]).
arcs(75,[]).
arcs(76,[1,5,9,13,21,29,37,41,45,53,65,73,97]).
arcs(77,[]).
arcs(78,[19,27,35,39,67,71,75,83,91,95,99]).
arcs(79,[]).
arcs(80,[1,5,9,13,17,21,29,33,49,53,61,65,73,77,85,93]).
arcs(81,[]).
arcs(82,[3,7,11,19,27,31,35,47,59,75,83,87,95]).
arcs(83,[]).
arcs(84,[1,5,9,13,17,21,29,33,45,57,61,65,77,93,97]).
arcs(85,[]).
arcs(86,[7,15,19,23,27,31,39,51,55,63,67,71,75,79,87,95,99]).
arcs(87,[]).
arcs(88,[1,5,13,21,25,29,49,53,57,61,65,69,73,81,85,89,97]).
arcs(89,[]).
arcs(90,[3,7,19,31,35,43,51,59,63,67,71,79,83,91,95]).
arcs(91,[]).
arcs(92,[9,13,17,49,57,61]).
arcs(93,[]).
arcs(94,[11,15,19,23,27,35,39,51,55,63,67,71,75,79,91,99]).
arcs(95,[]).
arcs(96,[1,5,9,17,25,29,33,41,53,57,61,65,73,85,89,93,97]).
arcs(97,[]).
arcs(98,[3,7,11,19,27,31,39,43,51,55,59,79,83,87,99]).
arcs(99,[]).
arcs(100,[1,5,9,13,25,37,41,61,69,77,93,97]).




