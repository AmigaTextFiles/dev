<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>Nano vm - manual files</title>
    </head>
	<body bgcolor="white" text="black" link="#1025C3" vlink="red" alink="green">
        <center>
            <table border="0" width="640">
				<tr>
					<td align="center">
						<h1>Dateien</h1>
					</td>
				</tr>
				<tr>
                    <td align="left">
Bevor man mit Dateien arbeiten kann, muss man sie zuerst öffnen: <br><br>

    <pre>
    fopen    L0, "file", "r";
    </pre>

Register "L0" enthält die Dateinummer, der Name ist "file", und der Modus <br>
ist read (lesen) "r". Andere sind: "a" append (anfügen) und "w" write (schreiben). <br><br>

Datei schliessen: <br><br>

    <pre>
    fclose    L0;
	</pre>

Von einer Datei lesen: <br><br>

    <pre>
    fread_s    L0, string;
    </pre>

Wie du vielleicht schon gemerkt hast, "string" ist eine Stringvariable und "L0" <br>
ist die Dateinummer. <br><br><br>



    <h2>Befehle</h2>

    <pre>
    L = long Register, D = double Register, BV = byte Variable, SV = string Variable
    </pre>

    <h3>Öffnen/Schliessen</h3>

    <pre>
    fopen              L (Dateinummer), SV (Name), SV (Typ);   Datei öffnen
	
    types are:         "r"      read (lesen)
                       "w"      write (schreiben)
                       "a"      append (anfügen)
                       "rw"     read/write (lesen/schreiben)
                       "wr"     write/read (schreiben/lesen)
                       "ar"     append/read (anfügen/lesen)

    fclose             L (Dateinummer);                        Datei schliessen
	</pre>
	
	<h3>lesen/schreiben</h3>
	
	<pre>
    fread_b            L (Dateinummer), L;                   lese byte
    fread_ab           L (Dateinummer), BV, L (Länge);       lese byte array
    fread_i            L (Dateinummer), L;                   lese int
    fread_l            L (Dateinummer), L;                   lese lint
    fread_d            L (Dateinummer), D;                   lese double
    fread_s            L (Dateinummer), SV, L (Länge);       lese string
    fread_ls           L (Dateinummer), SV;                  lese line

    fwrite_b           L (Dateinummer), L;                   schreibe byte
    fwrite_ab          L (Dateinummer), BV, L (Länge);       schreibe byte array
    fwrite_i           L (Dateinummer), L;                   schreibe int
    fwrite_l           L (Dateinummer), L;                   schreibe lint
    fwrite_d           L (Dateinummer), D;                   schreibe double
    fwrite_s           L (Dateinummer), SV;                  schreibe string

    fwrite_sl          L (Dateinummer), L;                   schreibe lint als String
    fwrite_sd          L (Dateinummer), D;                   schreibe double als String

    fwrite_n           L (Dateinummer), L;                   schreibe "L" neue Zeilen
    fwrite_sp          L (Dateinummer), L;                   schreibe "L" Leerzeichen
	</pre>
	
	<h3>Sonstige</h3>

	<pre>
    fsetpos            L (Dateinummer), L;                   setze Dateiposition
    fgetpos            L (Dateinummer), L;                   gibt Dateiposition zurück

    frewind            L (Dateinummer);                      Datei auf Anfang setzen
    fsize              L (Dateinummer), L;                   gibt die Dateigrösse zurück

    fremove            L (Dateinummer), SV (Name);           Datei löschen
    frename            L (Dateinummer), SV (alt), SV (neu);  Datei umbenennen
	</pre>

Hier ist ein Beispiel: <br><br>

    <pre>
        txtsave.na

     1| string file[256];
     2| string line[256];
     3|
     4| print_s    "file to save text? ";
     5| input_s    file;
     6|
     7| push_i     0, L0;
     8| fopen      L0, file, "w";
     9|
    10| push_i     1, L1;
    11| print_s    "Enter the text. Empty line to exit...";
    12| print_n    L1;
    13|
    14| lab input;
    15|     print_s   ": ";
    16|     input_s   line;
    17|     fwrite_s  L0, line;
    18|     fwrite_n  L0, L1;
    19|     neq_s     line, "", L2;
    20|     jmp_l     L2, input;
    21|
    22| fclose    L0;
    23| push_i    0, L0;
    24| exit      L0;
    </pre>

    <h3>line feed (neue Zeile)</h3>

Der "line feed" markiert das Zeilenende in einer Textdatei. <br>
Die zwei Zeichen, um das zu markieren sind: <br>

    <pre>
    CR (carriage return, ASCII code: 13)
    LF (line feed,       ASCII code: 10)
    </pre>

Die Bezeichnungen "carriage return" und "line feed" sind aus der guten alten Schreibmaschinen Zeit. <br><br>

Jedes Betriebssystem verwendet einen ander Code:

    <pre>
    DOS, Windows:           CRLF
    Mac OS:                 CR
    Amiga OS, Unix, Linux:  LF
    ?:                      LFCR (Ja! Sogar dieser seltsame soll im Umlauf sein!)
    </pre>

Wenn wir eine Zeile mit "fread_ls" lesen, kümmert sich Nano um alle Codes. Es kommt mit allen <br>
line feeds zurecht. Einen line feed mit "fwrite_n" schreiben ist anders. Wir müssen einen Code wählen.<br>
Das kann man mit einem Programmteil wie diesem: <br>

    <pre>
    string cr[2];
    string lf[2];
    
    push_i          13, L0;
    char            L0, cr;
    push_i          10, L0;
    char            L0, lf;
    
    move_s          cr, _fnewline;
    add_s           _fnewline, lf, _fnewline;
    </pre>

Das setzt "_fnewline" auf CRLF. Der "fwrite_n" Befehl verwendet jetzt CRLF. <br>
Es gibt eine Standardeinstellung für "_fnewline". Es ist der Code des Betriebssystems. <br>
Bei einem Windows Rechner ist "_fnewline" auf CRLF gesetzt, etc. <br><br><br>


    <h3>Binärdateien</h3>

Es gibt zwei Arten Binärzahlen in einer Datei zu speichern: <br>
- little endian <br>
- big endian <br><br>

Wenn wir die long Zahl "76543" in eine Datei speichern, bekommen wir diesen HEX Code: <br><br>

    <pre>
    little endian:  FF 2A 01 00
    big endian:     00 01 2A FF
    </pre>

Die long Zahl ist vier Bytes lang. Jedes Nummernpaar ist ein Byte <br>
Der Unterschied ist: "little endian" ist andersrum als "big endian". <br><br>

Wir müssen den Endian Typ einer Datei kennen, um Zahlen lesen und schreiben <br>
zu können. Sonst würden wir falsche Zahlen lesen und schreiben. <br><br>

Der Endian Typ wird mit der Variablen "_fendian" gesetzt. Ein Beispiel: <br>

    <pre>
    #include &lt;file.nah&gt;

    #setreg_l       L0, null;
    #setreg_l       L1, file;
    #setreg_l       L2, n;
    #setreg_l       L3, endian;

    push_i          0, null;
    push_i          0, file;
    push_l          76543L, n;
    
    push_i          ENDIAN_BIG, endian;
    pull_i          endian, _fendian;

    fopen           file, "big_endian", "w";
    fwrite_l        file, n;
    fclose          file;
    
    exit            null;
    </pre>



<a href="internal_variables.html" target="page">Prev: Interne Variablen</a> | <a href="files_error.html" target="page">Next: Dateien Fehlercodes</a>
                    </td>
                </tr>
			</table>
		</center>
    </body>
</html>


