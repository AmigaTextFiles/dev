<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>Nano vm - manual arrays</title>
    </head>
	<body bgcolor="white" text="black" link="#1025C3" vlink="red" alink="green">
        <center>
            <table border="0" width="640">
				<tr>
					<td align="center">
						<h1>Arrays</h1>
					</td>
				</tr>
				<tr>
                    <td align="left">
Arrays are declared like normal variables. The only difference <br>
are the dimension numbers: <br><br>

    <pre>
	int a[10];
	</pre>

This array can store "10" short integers. To write into an array <br>
we use a special move opcode: <br><br>

    <pre>
	move_i_a    L0, a, L1;
	</pre>

The first argument is the value to write, the second is the array and <br>
the third is the array index. <br><br>

To read from an array: <br><br>

    <pre>
	move_a_i    a, L1, L0;
	</pre>

    <pre>
        array.na

     1| int a[10];
     2|
     3| push_i    0, L0;
     4| push_i    9, L1;
     5|
     6| lab init_a;
     7|     move_i_a    L0, a, L0;
     8|     inc_l       L0;
     9|     lseq_l      L0, L1, L2;
    10|     jmp_l       L2, init_a;
    11|
    12| push_i    0, L0;
    13| push_i    1, L2;
    14|
    15| lab print_a;
    16|     move_a_i    a, L0, L3;
    17|     print_l     L3;
    18|     print_n     L2;
    19|     inc_l       L0;
    20|     lseq_l      L0, L1, L4;
    21|     jmp_l       L4, print_a;
    22|
    23| push_i    0, L0;
    24| exit      L0;
    </pre>
    
    <h2>Opcodes</h2>
    
    <pre>
    L = long register, D = double register
    BV = byte variable, IV = int variable, LV = long int variable
    DV = double variable
    LI = array index
    </pre>

    <h3>register to array</h3>
    
    <pre>
    move_i_a        L, IV, LI;
    move_l_a        L, LV, LI;
    move_d_a        D, DV, LI;
    move_b_a        L, BV, LI;
    </pre>
    
    <h3>array to register</h3>
    
    <pre>
    move_a_i        IV, LI, L;
    move_a_l        LV, LI, L;
    move_a_d        DV, LI, D;
    move_a_b        BV, LI, L;
    </pre>

    <h2>Free an array</h2>
    
To free the allocated memory of an array, you can use "dealloc". <br>
If a program tries to read or write to a freed array, you get a "overflow" error message. <br><br>

    <pre>
    dealloc         a;      deallocate array "a"
    </pre>
    
Nano deallocates all variables on programm end. <br>
But you can use this to resize an array. <br><br><br>
    

    <h2>Resize an array</h2>
    
To resize an array, we have to deallocate it first. Then we declare it with a new size. <br>
This looks like this: <br><br>
    
    <pre>
    int size;

    push_i          10, L0;
    pull_i          L0, size;
    
    int a[size];                       space for 10 int variables

    ...
    
    dealloc         a;                 deallocate array

    push_i          20, L0;
    pull_i          L0, size;
    
    int a[size];                       space for 20 int variables
    </pre>



<a href="jumps.html" target="page">Prev: Jumps</a> | <a href="strings.html" target="page">Next: Strings</a>
                    </td>
                </tr>
			</table>
		</center>
    </body>
</html>

