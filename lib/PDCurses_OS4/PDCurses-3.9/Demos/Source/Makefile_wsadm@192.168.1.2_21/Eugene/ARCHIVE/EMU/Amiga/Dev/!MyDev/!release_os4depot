#Makefile for PDCurses 3.9 by Eugene aGGreSSor Sobolev
# https://github.com/wmcbrine/PDCurses

#   Default compile arguments

project = PDCurses

CC = ppc-amigaos-gcc
STRIP=ppc-amigaos-strip
version = 3.9
libs  = -lpdcurses -lSDL -lz
flags = -Wall -g

postfix =
c_files = firework.c ozdemo.c ptest.c rain.c sdltest.c worm.c xmas.c
obj = firework.o ozdemo.o ptest.o rain.o sdltest.o worm.o xmas.o

#   AmigaOS 3.1 -- AmigaOS loadseg()ble executable/binary
#   https://github.com/bebbo/amiga-gcc.git
ifeq ($(OS), AOS3)
    postfix=_aos3
    CC=m68k-amigaos-gcc
    STRIP=m68k-amigaos-strip --strip-unneeded --remove-section .comment
    libs  = -lpdcurses -lSDL -ldebug -lm
    flags = -Wall -O2 -noixemul -m68020-60 -fomit-frame-pointer -std=c99
    COPT=-O3 -fomit-frame-pointer -std=c99 -w
    LOPT=-O2 -lm -m68020-60 -noixemul -std=c99 -w
else

#   AmigaOS 4.1 -- ELF 32-bit MSB executable, PowerPC or cisco 4500, version 1 (SYSV), statically linked
#   https://github.com/sba1/adtools
ifeq ($(OS), AOS4)
    postfix=_aos4
    CC=ppc-amigaos-gcc
    STRIP=ppc-amigaos-strip --strip-unneeded --remove-section .comment
    libs  = -lpdcurses -lSDL -lz
    flags = -flto -O2 -lauto -std=c99 -w
else

#   AROS i386 --  ELF 32-bit LSB relocatable, Intel 80386, version 1 (SYSV), not stripped
#   http://archives.aros-exec.org/share/development/cross/gcc-4.2.2-i386-aros-cygwin.tar.bz2
ifeq ($(OS), AROS32)
    postfix=_aros-i386
    CC=i386-aros-gcc
    STRIP=i386-aros-strip --strip-unneeded --remove-section .comment
    libs  = -lpdcurses -lSDL -lz
    flags = -Wall -std=c99 -g
endif
endif
endif

all : files

files: ${obj} 
	@echo "Linking!"
	${CC} ${flags} firework.o ${libs} -o ../firework${postfix}.exe
	${STRIP} ../firework${postfix}.exe
	@rm -f firework.o
	${CC} ${flags} ozdemo.o ${libs} -o ../ozdemo${postfix}.exe
	${STRIP} ../ozdemo${postfix}.exe
	@rm -f ozdemo.o
	${CC} ${flags} ptest.o ${libs} -o ../ptest${postfix}.exe
	${STRIP} ../ptest${postfix}.exe
	@rm -f ptest.o
	${CC} ${flags} rain.o ${libs} -o ../rain${postfix}.exe
	${STRIP} ../rain${postfix}.exe
	@rm -f rain.o
	${CC} ${flags} sdltest.o ${libs} -o ../sdltest${postfix}.exe
	${STRIP} ../sdltest${postfix}.exe
	@rm -f sdltest.o
	${CC} ${flags} worm.o ${libs} -o ../worm${postfix}.exe
	${STRIP} ../worm${postfix}.exe
	@rm -f worm.o
	${CC} ${flags} xmas.o ${libs} -o ../xmas${postfix}.exe
	${STRIP} ../xmas${postfix}.exe
	@rm -f xmas.o

${obj}: ${c_files}
	@echo "Compiling!"
	${CC} ${flags} -c ${c_files}

clean: 
	@rm -f *.o ../*${postfix}.exe
	@echo "Deleting objects and output files"
	@echo "Objects: ${obj} | ../*${postfix}.exe"

clear: clean
