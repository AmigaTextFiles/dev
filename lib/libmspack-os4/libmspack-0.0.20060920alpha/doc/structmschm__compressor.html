<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libmspack: mschm_compressor Struct Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li id="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
  </ul></div>
<h1>mschm_compressor Struct Reference</h1><!-- doxytag: class="mschm_compressor" -->A compressor for .CHM (Microsoft HTMLHelp) files.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="mspack_8h-source.html">mspack.h</a>&gt;</code>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Fields</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate</a> )(struct <a class="el" href="structmschm__compressor.html">mschm_compressor</a> *self, struct <a class="el" href="structmschmc__file.html">mschmc_file</a> file_list[], char *output_file)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generates a CHM help file.  <a href="#8433fcde6d43e160cd652b44492200f7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmschm__compressor.html#898d71534bc34d5b2aee1442188bb1c6">use_temporary_file</a> )(struct <a class="el" href="structmschm__compressor.html">mschm_compressor</a> *self, int use_temp_file, char *temp_file)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Specifies whether a temporary file is used during CHM generation.  <a href="#898d71534bc34d5b2aee1442188bb1c6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmschm__compressor.html#bb48d706306afc67607493b850838b49">set_param</a> )(struct <a class="el" href="structmschm__compressor.html">mschm_compressor</a> *self, int param, unsigned int value)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets a CHM compression engine parameter.  <a href="#bb48d706306afc67607493b850838b49"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmschm__compressor.html#88c6c1ab6787f04cf70eb53bb8195cfb">last_error</a> )(struct <a class="el" href="structmschm__compressor.html">mschm_compressor</a> *self)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the error code set by the most recently called method.  <a href="#88c6c1ab6787f04cf70eb53bb8195cfb"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
A compressor for .CHM (Microsoft HTMLHelp) files. 
<p>
All fields are READ ONLY.<p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="mspack_8h.html#749d6b350987be706728e020e875b13f">mspack_create_chm_compressor()</a>, <a class="el" href="mspack_8h.html#05c47f6572f3966d9495810332356b94">mspack_destroy_chm_compressor()</a> </dd></dl>

<p>
<hr><h2>Field Documentation</h2>
<a class="anchor" name="8433fcde6d43e160cd652b44492200f7"></a><!-- doxytag: member="mschm_compressor::generate" ref="8433fcde6d43e160cd652b44492200f7" args=")(struct mschm_compressor *self, struct mschmc_file file_list[], char *output_file)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int(* <a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">mschm_compressor::generate</a>)(struct <a class="el" href="structmschm__compressor.html">mschm_compressor</a> *self, struct <a class="el" href="structmschmc__file.html">mschmc_file</a> file_list[], char *output_file)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Generates a CHM help file. 
<p>
The help file will contain up to two sections, an Uncompressed section and potentially an MSCompressed (LZX compressed) section.<p>
While the contents listing of a CHM file is always in lexical order, the file list passed in will be taken as the correct order for files within the sections. It is in your interest to place similar files together for better compression.<p>
There are two modes of generation, to use a temporary file or not to use one. See <a class="el" href="structmschm__compressor.html#898d71534bc34d5b2aee1442188bb1c6">use_temporary_file()</a> for the behaviour of <a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate()</a> in these two different modes.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>self</em>&nbsp;</td><td>a self-referential pointer to the <a class="el" href="structmschm__compressor.html">mschm_compressor</a> instance being called </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>file_list</em>&nbsp;</td><td>an array of <a class="el" href="structmschmc__file.html">mschmc_file</a> structures, terminated with an entry whose <a class="el" href="structmschmc__file.html#11c5bd77b0142d3c3a94c5a24126e030">mschmc_file::section</a> field is <a class="el" href="mspack_8h.html#80f996d3fbc7800630b9542d5e4620ec">MSCHMC_ENDLIST</a>. The order of the list is preserved within each section. The length of any <a class="el" href="structmschmc__file.html#b2979483302579db0111fe5cff3d4eb5">mschmc_file::chm_filename</a> string cannot exceed roughly 4096 bytes. Each source file must be able to supply as many bytes as given in the <a class="el" href="structmschmc__file.html#ee5c029845e1ce6112c8d050d9b23fda">mschmc_file::length</a> field. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>output_file</em>&nbsp;</td><td>the file to write the generated CHM helpfile to. This is passed directly to <a class="el" href="structmspack__system.html#7885678bf152f13adad6f6fec85f1653">mspack_system::open()</a> </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>an error code, or MSPACK_ERR_OK if successful </dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="structmschm__compressor.html#898d71534bc34d5b2aee1442188bb1c6">use_temporary_file()</a> <a class="el" href="structmschm__compressor.html#bb48d706306afc67607493b850838b49">set_param()</a> </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="88c6c1ab6787f04cf70eb53bb8195cfb"></a><!-- doxytag: member="mschm_compressor::last_error" ref="88c6c1ab6787f04cf70eb53bb8195cfb" args=")(struct mschm_compressor *self)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int(* <a class="el" href="structmschm__compressor.html#88c6c1ab6787f04cf70eb53bb8195cfb">mschm_compressor::last_error</a>)(struct <a class="el" href="structmschm__compressor.html">mschm_compressor</a> *self)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the error code set by the most recently called method. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>self</em>&nbsp;</td><td>a self-referential pointer to the <a class="el" href="structmschm__compressor.html">mschm_compressor</a> instance being called </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the most recent error code </dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="structmschm__compressor.html#bb48d706306afc67607493b850838b49">set_param()</a>, <a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate()</a> </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="bb48d706306afc67607493b850838b49"></a><!-- doxytag: member="mschm_compressor::set_param" ref="bb48d706306afc67607493b850838b49" args=")(struct mschm_compressor *self, int param, unsigned int value)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int(* <a class="el" href="structmschm__compressor.html#bb48d706306afc67607493b850838b49">mschm_compressor::set_param</a>)(struct <a class="el" href="structmschm__compressor.html">mschm_compressor</a> *self, int param, unsigned int value)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sets a CHM compression engine parameter. 
<p>
The following parameters are defined:<p>
<ul>
<li><a class="el" href="mspack_8h.html#a33210e31d2272c1c015849281bc8028">MSCHMC_PARAM_TIMESTAMP</a>: Sets the "timestamp" of the CHM file generated. This is not a timestamp, see <a class="el" href="structmschmd__header.html#b844b2365051d8c99ce41ae0a0f4c106">mschmd_header::timestamp</a> for a description. If this timestamp is 0, <a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate()</a> will use its own algorithm for making a unique ID, based on the lengths and names of files in the CHM itself. Defaults to 0, any value between 0 and (2^32)-1 is valid.</li><li><a class="el" href="mspack_8h.html#0ad26bd80adf64598352066814153335">MSCHMC_PARAM_LANGUAGE</a>: Sets the "language" of the CHM file generated. This is not the language used in the CHM file, but the language setting of the user who ran the HTMLHelp compiler. It defaults to 0x0409. The valid range is between 0x0000 and 0x7F7F.</li><li><a class="el" href="mspack_8h.html#0ee4a588079a3f6bf65b63ce388c9a45">MSCHMC_PARAM_LZXWINDOW</a>: Sets the size of the LZX history window, which is also the interval at which the compressed data stream can be randomly accessed. The value is not a size in bytes, but a power of two. The default value is 16 (which makes the window 2^16 bytes, or 64 kilobytes), the valid range is from 15 (32 kilobytes) to 21 (2 megabytes).</li><li><a class="el" href="mspack_8h.html#d17047eb4450c7476d29d47fb5f1ce35">MSCHMC_PARAM_DENSITY</a>: Sets the "density" of quick reference entries stored at the end of directory listing chunk. Each chunk is 4096 bytes in size, and contains as many file entries as there is room for. At the other end of the chunk, a list of "quick reference" pointers is included. The offset of every 'N'th file entry is given a quick reference, where N = (2^density) + 1. The default density is 2. The smallest density is 0 (N=2), the maximum is 10 (N=1025). As each file entry requires at least 5 bytes, the maximum number of entries in a single chunk is roughly 800, so the maximum value 10 can be used to indicate there are no quickrefs at all.</li><li><a class="el" href="mspack_8h.html#c6c61f24c4d9ad2a5a9bcdbb8057723a">MSCHMC_PARAM_INDEX</a>: Sets whether or not to include quick lookup index chunk(s), in addition to normal directory listing chunks. A value of zero means no index chunks will be created, a non-zero value means index chunks will be created. The default is zero, "don't create an index".</li></ul>
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>self</em>&nbsp;</td><td>a self-referential pointer to the <a class="el" href="structmschm__compressor.html">mschm_compressor</a> instance being called </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>param</em>&nbsp;</td><td>the parameter to set </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>value</em>&nbsp;</td><td>the value to set the parameter to </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>MSPACK_ERR_OK if all is OK, or MSPACK_ERR_ARGS if there is a problem with either parameter or value. </dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate()</a> </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="898d71534bc34d5b2aee1442188bb1c6"></a><!-- doxytag: member="mschm_compressor::use_temporary_file" ref="898d71534bc34d5b2aee1442188bb1c6" args=")(struct mschm_compressor *self, int use_temp_file, char *temp_file)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int(* <a class="el" href="structmschm__compressor.html#898d71534bc34d5b2aee1442188bb1c6">mschm_compressor::use_temporary_file</a>)(struct <a class="el" href="structmschm__compressor.html">mschm_compressor</a> *self, int use_temp_file, char *temp_file)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Specifies whether a temporary file is used during CHM generation. 
<p>
The CHM file format includes data about the compressed section (such as its overall size) that is stored in the output CHM file prior to the compressed section itself. This unavoidably requires that the compressed section has to be generated, before these details can be set. There are several ways this can be handled. Firstly, the compressed section could be generated entirely in memory before writing any of the output CHM file. This approach is not used in libmspack, as the compressed section can exceed the addressable memory space on most architectures.<p>
libmspack has two options, either to write these unknowable sections with blank data, generate the compressed section, then re-open the output file for update once the compressed section has been completed, or to write the compressed section to a temporary file, then write the entire output file at once, performing a simple file-to-file copy for the compressed section.<p>
The simple solution of buffering the entire compressed section in memory can still be used, if desired. As the temporary file's filename is passed directly to <a class="el" href="structmspack__system.html#7885678bf152f13adad6f6fec85f1653">mspack_system::open()</a>, it is possible for a custom <a class="el" href="structmspack__system.html">mspack_system</a> implementation to hold this file in memory, without writing to a disk.<p>
If a temporary file is set, <a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate()</a> performs the following sequence of events: the temporary file is opened for writing, the compression algorithm writes to the temporary file, the temporary file is closed. Then the output file is opened for writing and the temporary file is re-opened for reading. The output file is written and the temporary file is read from. Both files are then closed. The temporary file itself is not deleted. If that is desired, the temporary file should be deleted after the completion of <a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate()</a>, if it exists.<p>
If a temporary file is set not to be used, <a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate()</a> performs the following sequence of events: the output file is opened for writing, then it is written and closed. The output file is then re-opened for update, the appropriate sections are seek()ed to and re-written, then the output file is closed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>self</em>&nbsp;</td><td>a self-referential pointer to the <a class="el" href="structmschm__compressor.html">mschm_compressor</a> instance being called </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>use_temp_file</em>&nbsp;</td><td>non-zero if the temporary file should be used, zero if the temporary file should not be used. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>temp_file</em>&nbsp;</td><td>a file to temporarily write compressed data to, before opening it for reading and copying the contents to the output file. This is passed directly to <a class="el" href="structmspack__system.html#7885678bf152f13adad6f6fec85f1653">mspack_system::open()</a>. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>an error code, or MSPACK_ERR_OK if successful </dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="structmschm__compressor.html#8433fcde6d43e160cd652b44492200f7">generate()</a> </dd></dl>
    </td>
  </tr>
</table>
<hr>The documentation for this struct was generated from the following file:<ul>
<li>/home/kyz/devel/libmspack/libmspack/mspack/<a class="el" href="mspack_8h-source.html">mspack.h</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Wed Sep 20 22:45:37 2006 for libmspack by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
