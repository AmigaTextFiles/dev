<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>man getnameinfo(3)</title>

</head>
<body>
<div id="container">
<div id="top">

</div>
<div id="toplink">

</div>
<div id="contentmenu">
<table width="100%" cellpadding="0">

</table>
</div>

<div id="content">
<pre>
getnameinfo(3)           BSD Library Functions Manual           getnameinfo(3)


</pre>
<h2>NAME</h2><pre>
     <b>getnameinfo</b> -- socket address structure to hostname and service name


</pre>
<h2>SYNOPSIS</h2><pre>
     <b>#include</b> <b>&lt;sys/types.h&gt;</b>
     <b>#include</b> <b>&lt;sys/socket.h&gt;</b>
     <b>#include</b> <b>&lt;netdb.h&gt;</b>

     <i>int</i>
     <b>getnameinfo</b>(<i>const</i> <i>struct</i> <i>sockaddr</i> <i>*sa</i>, <i>socklen</i><b>_</b><i>t</i> <i>salen</i>, <i>char</i> <i>*host</i>,
         <i>size</i><b>_</b><i>t</i> <i>hostlen</i>, <i>char</i> <i>*serv</i>, <i>size</i><b>_</b><i>t</i> <i>servlen</i>, <i>int</i> <i>flags</i>);


</pre>
<h2>DESCRIPTION</h2><pre>
     The <b>getnameinfo</b>() function is used to convert a sockaddr structure to a
     pair of host name and service strings.  It is a replacement for and pro-
     vides more flexibility than the <b><a href="/man/3/gethostbyaddr/">gethostbyaddr(3)</a></b> and <b><a href="/man/3/getservbyport/">getservbyport(3)</a></b>
     functions and is the converse of the <b><a href="/man/3/getaddrinfo/">getaddrinfo(3)</a></b> function.

     The sockaddr structure <i>sa</i> should point to either a sockaddr_in or
     sockaddr_in6 structure (for IPv4 or IPv6 respectively) that is <i>salen</i>
     bytes long.

     The host and service names associated with <i>sa</i> are stored in <i>host</i> and <i>serv</i>
     which have length parameters <i>hostlen</i> and <i>servlen</i>.  The maximum value for
     <i>hostlen</i> is NI_MAXHOST and the maximum value for <i>servlen</i> is NI_MAXSERV, as
     defined by &lt;<i>netdb.h</i>&gt;.  If a length parameter is zero, no string will be
     stored.  Otherwise, enough space must be provided to store the host name
     or service string plus a byte for the NUL terminator.

     The <i>flags</i> argument is formed by <b>OR</b>'ing the following values:

     NI_NOFQDN         A fully qualified domain name is not required for local
                       hosts.  The local part of the fully qualified domain
                       name is returned instead.

     NI_NUMERICHOST    Return the address in numeric form, as if calling
                       <b><a href="/man/3/inet_ntop/">inet_ntop(3)</a></b>, instead of a host name.

     NI_NAMEREQD       A name is required.  If the host name cannot be found
                       in DNS and this flag is set, a non-zero error code is
                       returned.  If the host name is not found and the flag
                       is not set, the address is returned in numeric form.

     NI_NUMERICSERV    The service name is returned as a digit string repre-
                       senting the port number.

     NI_DGRAM          Specifies that the service being looked up is a data-
                       gram service, and causes <b><a href="/man/3/getservbyport/">getservbyport(3)</a></b> to be called
                       with a second argument of ``udp'' instead of its
                       default of ``tcp''.  This is required for the few ports
                       (512-514) that have different services for UDP and TCP.

     This implementation allows numeric IPv6 address notation with scope iden-
     tifier, as documented in chapter 11 of draft-ietf-ipv6-scoping-
     arch-02.txt.  IPv6 link-local address will appear as a string like
     ``fe80::1%ne0''.  Refer to <b><a href="/man/3/getaddrinfo/">getaddrinfo(3)</a></b> for more information.


</pre>
<h2>RETURN VALUES</h2><pre>
     <b>getnameinfo</b>() returns zero on success or one of the error codes listed in
     <b><a href="/man/3/gai_strerror/">gai_strerror(3)</a></b> if an error occurs.


</pre>
<h2>EXAMPLES</h2><pre>
     The following code tries to get a numeric host name, and service name,
     for a given socket address.  Observe that there is no hardcoded reference
     to a particular address family.

           struct sockaddr *sa;    /* input */
           char hbuf[NI_MAXHOST], sbuf[NI_MAXSERV];

           if (getnameinfo(sa, sa-&gt;sa_len, hbuf, sizeof(hbuf), sbuf,
               sizeof(sbuf), NI_NUMERICHOST | NI_NUMERICSERV)) {
                   errx(1, "could not get numeric hostname");
                   /*NOTREACHED*/
           }
           printf("host=%s, serv=%s\n", hbuf, sbuf);

     The following version checks if the socket address has a reverse address
     mapping:

           struct sockaddr *sa;    /* input */
           char hbuf[NI_MAXHOST];

           if (getnameinfo(sa, sa-&gt;sa_len, hbuf, sizeof(hbuf), NULL, 0,
               NI_NAMEREQD)) {
                   errx(1, "could not resolve hostname");
                   /*NOTREACHED*/
           }
           printf("host=%s\n", hbuf);


</pre>
<h2>SEE ALSO</h2><pre>
     <b><a href="/man/3/gai_strerror/">gai_strerror(3)</a></b>, <b><a href="/man/3/getaddrinfo/">getaddrinfo(3)</a></b>, <b><a href="/man/3/gethostbyaddr/">gethostbyaddr(3)</a></b>, <b><a href="/man/3/getservbyport/">getservbyport(3)</a></b>,
     <b><a href="/man/3/inet_ntop/">inet_ntop(3)</a></b>, <b><a href="/man/3/resolver/">resolver(3)</a></b>, <b><a href="/man/5/hosts/">hosts(5)</a></b>, <b>resolv.conf(5)</b>, <b><a href="/man/5/services/">services(5)</a></b>,
     <b><a href="/man/7/hostname/">hostname(7)</a></b>, <b><a href="/man/8/named/">named(8)</a></b>

     R. Gilligan, S. Thomson, J. Bound, and W. Stevens, <i>Basic</i> <i>Socket</i> <i>Interface</i>
     <i>Extensions</i> <i>for</i> <i>IPv6</i>, RFC 2553, March 1999.

     S. Deering, B. Haberman, T. Jinmei, E. Nordmark, and B. Zill, <i>IPv6</i> <i>Scoped</i>
     <i>Address</i> <i>Architecture</i>, internet draft, draft-ietf-ipv6-scoping-
     arch-02.txt, work in progress material.

     Craig Metz, "Protocol Independence Using the Sockets API", <i>Proceedings</i> <i>of</i>
     <i>the</i> <i>FREENIX</i> <i>track:</i> <i>2000</i> <i>USENIX</i> <i>annual</i> <i>technical</i> <i>conference</i>, June 2000.


</pre>
<h2>STANDARDS</h2><pre>
     The <b>getnameinfo</b>() function is defined by the IEEE Std 1003.1g-2000
     (``POSIX.1'') draft specification and documented in <b>RFC</b> <b>2553</b>, ``Basic
     Socket Interface Extensions for IPv6''.


</pre>
<h2>CAVEATS</h2><pre>
     <b>getnameinfo</b>() can return both numeric and FQDN forms of the address spec-
     ified in <i>sa</i>.  There is no return value that indicates whether the string
     returned in <i>host</i> is a result of binary to numeric-text translation (like
     <b><a href="/man/3/inet_ntop/">inet_ntop(3)</a></b>), or is the result of a DNS reverse lookup.  Because of
     this, malicious parties could set up a PTR record as follows:

           1.0.0.127.in-addr.arpa. IN PTR  10.1.1.1

     and trick the caller of <b>getnameinfo</b>() into believing that <i>sa</i> is 10.1.1.1
     when it is actually 127.0.0.1.

     To prevent such attacks, the use of NI_NAMEREQD is recommended when the
     result of <b>getnameinfo</b>() is used for access control purposes:

           struct sockaddr *sa;
           socklen_t salen;
           char addr[NI_MAXHOST];
           struct addrinfo hints, *res;
           int error;

           error = getnameinfo(sa, salen, addr, sizeof(addr),
               NULL, 0, NI_NAMEREQD);
           if (error == 0) {
                   memset(&amp;hints, 0, sizeof(hints));
                   hints.ai_socktype = SOCK_DGRAM; /*dummy*/
                   hints.ai_flags = AI_NUMERICHOST;
                   if (getaddrinfo(addr, "0", &amp;hints, &amp;res) == 0) {
                           /* malicious PTR record */
                           freeaddrinfo(res);
                           printf("bogus PTR record\n");
                           return -1;
                   }
                   /* addr is FQDN as a result of PTR lookup */
           } else {
                   /* addr is numeric string */
                   error = getnameinfo(sa, salen, addr, sizeof(addr),
                       NULL, 0, NI_NUMERICHOST);
           }


</pre>
<h2>BUGS</h2><pre>
     The implementation of <b>getnameinfo</b>() is not thread-safe.

BSD                            December 20, 2004                           BSD
</pre>
<hr>
Mac OS X 10.4.9 - Generated Fri Mar 16 19:15:50 CDT 2007
</div>
<div id="footer2">
	<table width="100%" cellpadding="10">

	</table>
</div>
<div id="footer">
<pre>
&copy; manpagez.com 2000-2008
Individual documents may contain additional copyright information.
</pre>
</div>
</div>
</body>
</html>
