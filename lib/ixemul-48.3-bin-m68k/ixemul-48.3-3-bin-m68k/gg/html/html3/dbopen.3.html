                                   <!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>DBOPEN(3) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>
 
<h2><a name='sect0' href='#toc0'>Name</a></h2>
dbopen - database access methods

<h2><a name='sect1' href='#toc1'>Synopsis</a></h2>
<br>
<pre>#include &lt;sys/types.h&gt;
#include &lt;limits.h&gt;
#include &lt;db.h&gt;
DB *
dbopen(const char *file, int flags, int mode, DBTYPE type,
const void *openinfo);
</pre>
<h2><a name='sect2' href='#toc2'></b>Description</a></h2>
<i>Dbopen</i> is the library interface to database files. The supported
file formats are btree, hashed and UNIX file oriented. The btree format
is a representation of a sorted, balanced tree structure. The hashed format
is an extensible, dynamic hashing scheme. The flat-file format is a byte
stream file with fixed or variable length records. The formats and file
format specific information are described in detail in their respective
manual pages <a href='btree.3'><i>btree</i>(3)</a>
, <a href='hash.3'><i>hash</i>(3)</a>
 and <a href='recno.3'><i>recno</i>(3)</a>
. <p>
Dbopen opens <i>file</i> for reading
and/or writing. Files never intended to be preserved on disk may be created
by setting the file parameter to NULL. <p>
The <i>flags</i> and <i>mode</i> arguments are
as specified to the <a href='open.2'><i>open</i>(2)</a>
 routine, however, only the O_CREAT, O_EXCL,
O_EXLOCK, O_NONBLOCK, O_RDONLY, O_RDWR, O_SHLOCK and O_TRUNC flags are
meaningful. (Note, opening a database file O_WRONLY is not possible.)   
                 <p>
The <i>type</i> argument is of type DBTYPE (as defined in the
&lt;db.h&gt; include file) and may be set to DB_BTREE, DB_HASH or DB_RECNO. <p>
The <i>openinfo</i>
argument is a pointer to an access method specific structure described
in the access method&rsquo;s manual page. If <i>openinfo</i> is NULL, each access method
will use defaults appropriate for the system and the access method. <p>
<i>Dbopen</i>
returns a pointer to a DB structure on success and NULL on error. The DB
structure is defined in the &lt;db.h&gt; include file, and contains at least the
following fields: <p>
<br>
<pre>typedef struct {
DBTYPE type;
int (*close)(const DB *db);
int (*del)(const DB *db, const DBT *key, u_int flags);
int (*fd)(const DB *db);
int (*get)(const DB *db, DBT *key, DBT *data, u_int flags);
int (*put)(const DB *db, DBT *key, const DBT *data,
u_int flags);
int (*sync)(const DB *db, u_int flags);
int (*seq)(const DB *db, DBT *key, DBT *data, u_int flags);
} DB;
</pre><p>
These elements describe a database type and a set of functions performing
various actions. These functions take a pointer to a structure as returned
by <i>dbopen</i>, and sometimes one or more pointers to key/data structures and
a flag value. 
<dl>

<dt>type </dt>
<dd>The type of the underlying access method (and file format).
</dd>

<dt>close </dt>
<dd>A pointer to a routine to flush any cached information to disk, free
any allocated resources, and close the underlying file(s). Since key/data
pairs may be cached in memory, failing to sync the file with a <i>close</i> or
<i>sync</i> function may result in inconsistent or lost information. <i>Close</i> routines
return -1 on error (setting <i>errno</i>) and 0 on success. </dd>

<dt>del </dt>
<dd>A pointer to a routine
to remove key/data pairs from the database. </dd>

<dt>The parameter </dt>
<dd><i>flag</i> may be set
to the following value: <blockquote></dd>

<dt>R_CURSOR </dt>
<dd>Delete the record referenced by the cursor.
The cursor must have previously been initialized. </dd>
</dl>
</blockquote>

<dl>

<dt><i>Delete</i> </dt>
<dd>routines return
-1 on error (setting <i>errno</i>), 0 on success, and 1 if the specified <i>key</i> was
not in the file. </dd>

<dt>fd </dt>
<dd>A pointer to a routine which returns a file descriptor
representative of the underlying database. A file descriptor referencing
the same file will be returned to all processes which call <i>dbopen</i> with
the same <i>file</i> name. This file descriptor may be safely used as an argument
to the <a href='fcntl.2'><i>fcntl</i>(2)</a>
 and <a href='flock.2'><i>flock</i>(2)</a>
 locking functions. The file descriptor is not
necessarily associated with any of the underlying files used by the access
method. No file descriptor is available for in memory databases. <i>Fd</i> routines
return -1 on error (setting <i>errno</i>), and the file descriptor on success. </dd>

<dt>get
</dt>
<dd>A pointer to a routine which is the interface for keyed retrieval from
the database. The address and length of the data associated with the specified
<i>key</i> are returned in the structure referenced by <i>data</i>. <i>Get</i> routines return
-1 on error (setting <i>errno</i>), 0 on success, and 1 if the <i>key</i> was not in the
file. </dd>

<dt>put </dt>
<dd>A pointer to a routine to store key/data pairs in the database.
</dd>

<dt>The parameter </dt>
<dd><i>flag</i> may be set to one of the following values: <blockquote></dd>

<dt>R_CURSOR
</dt>
<dd>Replace the key/data pair referenced by the cursor. The cursor must have
previously been initialized. </dd>

<dt>R_IAFTER </dt>
<dd>Append the data immediately after
the data referenced by <i>key</i>, creating a new key/data pair. The record number
of the appended key/data pair is returned in the <i>key</i> structure. (Applicable
only to the DB_RECNO access method.) </dd>

<dt>R_IBEFORE </dt>
<dd>Insert the data immediately
before the data referenced by <i>key</i>, creating a new key/data pair. The record
number of the inserted key/data pair is returned in the <i>key</i> structure. (Applicable
only to the DB_RECNO access method.) </dd>

<dt>R_NOOVERWRITE </dt>
<dd>Enter the new key/data
pair only if the key does not previously exist. </dd>

<dt>R_SETCURSOR </dt>
<dd>Store the key/data
pair, setting or initializing the position of the cursor to reference it.
(Applicable only to the DB_BTREE and DB_RECNO access methods.) </dd>
</dl>
</blockquote>

<dl>

<dt>R_SETCURSOR
is available only for the DB_BTREE and DB_RECNO access </dt>
<dd>methods because
it implies that the keys have an inherent order which does not change. </dd>

<dt>R_IAFTER
and R_IBEFORE are available only for the DB_RECNO </dt>
<dd>access method because
they each imply that the access method is able to create new keys. This
is only true if the keys are ordered and independent, record numbers for
example. </dd>

<dt>The default behavior of the </dt>
<dd><i>put</i> routines is to enter the new key/data
pair, replacing any previously existing key. </dd>

<dt><i>Put</i> </dt>
<dd>routines return -1 on error
(setting <i>errno</i>), 0 on success, and 1 if the R_NOOVERWRITE <i>flag</i> was set
and the key already exists in the file. </dd>

<dt>seq </dt>
<dd>A pointer to a routine which
is the interface for sequential retrieval from the database. The address
and length of the key are returned in the structure referenced by <i>key</i>,
and the address and length of the data are returned in the structure referenced
by <i>data</i>. </dd>

<dt>Sequential key/data pair retrieval may begin at any time, and the
</dt>
<dd>position of the &lsquo;&lsquo;cursor&rsquo;&rsquo; is not affected by calls to the <i>del</i>, <i>get</i>, <i>put</i>, or
<i>sync</i> routines. Modifications to the database during a sequential scan will
be reflected in the scan, i.e. records inserted behind the cursor will not
be returned while records inserted in front of the cursor will be returned.
</dd>

<dt>The flag value </dt>
<dd><b>must</b> be set to one of the following values: <blockquote></dd>

<dt>R_CURSOR </dt>
<dd>The
data associated with the specified key is returned. This differs from the
<i>get</i> routines in that it sets or initializes the cursor to the location
of the key as well. (Note, for the DB_BTREE access method, the returned
key is not necessarily an exact match for the specified key. The returned
key is the smallest key greater than or equal to the specified key, permitting
partial key matches and range searches.) </dd>

<dt>R_FIRST </dt>
<dd>The first key/data pair
of the database is returned, and the cursor is set or initialized to reference
it. </dd>

<dt>R_LAST </dt>
<dd>The last key/data pair of the database is returned, and the cursor
is set or initialized to reference it. (Applicable only to the DB_BTREE
and DB_RECNO access methods.) </dd>

<dt>R_NEXT </dt>
<dd>Retrieve the key/data pair immediately
after the cursor. If the cursor is not yet set, this is the same as the
R_FIRST flag. </dd>

<dt>R_PREV </dt>
<dd>Retrieve the key/data pair immediately before the cursor.
If the cursor is not yet set, this is the same as the R_LAST flag. (Applicable
only to the DB_BTREE and DB_RECNO access methods.) </dd>
</dl>
</blockquote>

<dl>

<dt>R_LAST and R_PREV are
available only for the DB_BTREE and DB_RECNO </dt>
<dd>access methods because they
each imply that the keys have an inherent order which does not change. </dd>

<dt><i>Seq</i>
</dt>
<dd>routines return -1 on error (setting <i>errno</i>), 0 on success and 1 if there
are no key/data pairs less than or greater than the specified or current
key. If the DB_RECNO access method is being used, and if the database file
is a character special file and no complete key/data pairs are currently
available, the <i>seq</i> routines return 2. </dd>

<dt>sync </dt>
<dd>A pointer to a routine to flush
any cached information to disk. If the database is in memory only, the <i>sync</i>
routine has no effect and will always succeed. </dd>

<dt>The flag value may be set
to the following value: </dt>
<dd><blockquote></dd>

<dt>R_RECNOSYNC </dt>
<dd>If the DB_RECNO access method is being
used, this flag causes the sync routine to apply to the btree file which
underlies the recno file, not the recno file itself. (See the <i>bfname</i> field
of the <a href='recno.3'><i>recno</i>(3)</a>
 manual page for more information.) </dd>
</dl>
</blockquote>

<dl>

<dt><i>Sync</i> </dt>
<dd>routines return
-1 on error (setting <i>errno</i>) and 0 on success. </dd>
</dl>

<h2><a name='sect3' href='#toc3'>Key/Data Pairs</a></h2>
Access to all
file types is based on key/data pairs. Both keys and data are represented
by the following data structure: <p>
typedef struct { <blockquote>void *data; <br>
size_t size; </blockquote>
} DBT; <p>
The elements of the DBT structure are defined as follows:

<dl>

<dt>data </dt>
<dd>A pointer to a byte string. </dd>

<dt>size </dt>
<dd>The length of the byte string. </dd>
</dl>
<p>
Key
and data byte strings may reference strings of essentially unlimited length
although any two of them must fit into available memory at the same time.
It should be noted that the access methods provide no guarantees about
byte string alignment. 
<h2><a name='sect4' href='#toc4'>Errors</a></h2>
The <i>dbopen</i> routine may fail and set <i>errno</i> for
any of the errors specified for the library routines <a href='open.2'><i>open</i>(2)</a>
 and <a href='malloc.3'><i>malloc</i>(3)</a>

or the following: 
<dl>

<dt>[EFTYPE] </dt>
<dd>A file is incorrectly formatted. </dd>

<dt>[EINVAL] </dt>
<dd>A parameter
has been specified (hash function, pad byte etc.) that is incompatible with
the current file specification or which is not meaningful for the function
(for example, use of the cursor without prior initialization) or there
is a mismatch between the version number of file and the software. </dd>
</dl>
<p>
The <i>close</i>
routines may fail and set <i>errno</i> for any of the errors specified for the
library routines <a href='close.2'><i>close</i>(2)</a>
, <a href='read.2'><i>read</i>(2)</a>
, <a href='write.2'><i>write</i>(2)</a>
, <a href='free.3'><i>free</i>(3)</a>
, or <a href='fsync.2'><i>fsync</i>(2)</a>
. <p>
The
<i>del</i>, <i>get</i>, <i>put</i> and <i>seq</i> routines may fail and set <i>errno</i> for any of the errors
specified for the library routines <a href='read.2'><i>read</i>(2)</a>
, <a href='write.2'><i>write</i>(2)</a>
, <a href='free.3'><i>free</i>(3)</a>
 or <a href='malloc.3'><i>malloc</i>(3)</a>
.
<p>
The <i>fd</i> routines will fail and set <i>errno</i> to ENOENT for in memory databases.
<p>
The <i>sync</i> routines may fail and set <i>errno</i> for any of the errors specified
for the library routine <a href='fsync.2'><i>fsync</i>(2)</a>
. 
<h2><a name='sect5' href='#toc5'>See Also</a></h2>
<a href='btree.3'><i>btree</i>(3)</a>
, <a href='hash.3'><i>hash</i>(3)</a>
, <a href='mpool.3'><i>mpool</i>(3)</a>
, <a href='recno.3'><i>recno</i>(3)</a>

<p>
<i>LIBTP: Portable, Modular Transactions for UNIX</i>, Margo Seltzer, Michael
Olson, USENIX proceedings, Winter 1992. 
<h2><a name='sect6' href='#toc6'>Bugs</a></h2>
The typedef DBT is a mnemonic
for &lsquo;&lsquo;data base thang&rsquo;&rsquo;, and was used because noone could think of a reasonable
name that wasn&rsquo;t already used. <p>
The file descriptor interface is a kluge and
will be deleted in a future version of the interface. <p>
None of the access
methods provide any form of concurrent access, locking, or transactions.
<p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Key/Data Pairs</a></li>
<li><a name='toc4' href='#sect4'>Errors</a></li>
<li><a name='toc5' href='#sect5'>See Also</a></li>
<li><a name='toc6' href='#sect6'>Bugs</a></li>
</ul>
</body>
</html>
