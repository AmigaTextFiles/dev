/*
**  Chunky 2 Planar routine (C) 2009 Fredrik Wikstrom
**/

static void c2p_8 (const uint8_t *chunky, uint16_t *planar, uint32_t plane_size,
	uint32_t width, uint32_t height)
{
	const uint32_t *cp;
	uint16_t *pp1, *pp2, *pp3, *pp4, *pp5, *pp6, *pp7, *pp8;
	uint32_t cd1, cd2, cd3, cd4;
	uint16_t pd1, pd2, pd3, pd4, pd5, pd6, pd7, pd8;
	uint32_t x, y;
	cp = (const uint32_t *)chunky;
	pp1 = planar;
	pp2 = (uint16_t *)((uint8_t *)pp1 + plane_size);
	pp3 = (uint16_t *)((uint8_t *)pp2 + plane_size);
	pp4 = (uint16_t *)((uint8_t *)pp3 + plane_size);
	pp5 = (uint16_t *)((uint8_t *)pp4 + plane_size);
	pp6 = (uint16_t *)((uint8_t *)pp5 + plane_size);
	pp7 = (uint16_t *)((uint8_t *)pp6 + plane_size);
	pp8 = (uint16_t *)((uint8_t *)pp7 + plane_size);
	for (y = 0; y < height; y++) {
		for (x = 0; x < width; x++) {
			cd1 = *cp++;
			cd2 = *cp++;
			cd3 = *cp++;
			cd4 = *cp++;
			
#ifdef WORDS_BIGENDIAN
			pd1  = ((cd1 >> 9 ) & 0x8000)|((cd2 >> 13) & 0x800)|((cd3 >> 17) & 0x80)|((cd4 >> 21) & 0x8);
			pd2  = ((cd1 >> 10) & 0x8000)|((cd2 >> 14) & 0x800)|((cd3 >> 18) & 0x80)|((cd4 >> 22) & 0x8);
			pd3  = ((cd1 >> 11) & 0x8000)|((cd2 >> 15) & 0x800)|((cd3 >> 19) & 0x80)|((cd4 >> 23) & 0x8);
			pd4  = ((cd1 >> 12) & 0x8000)|((cd2 >> 16) & 0x800)|((cd3 >> 20) & 0x80)|((cd4 >> 24) & 0x8);
			pd5  = ((cd1 >> 13) & 0x8000)|((cd2 >> 17) & 0x800)|((cd3 >> 21) & 0x80)|((cd4 >> 25) & 0x8);
			pd6  = ((cd1 >> 14) & 0x8000)|((cd2 >> 18) & 0x800)|((cd3 >> 22) & 0x80)|((cd4 >> 26) & 0x8);
			pd7  = ((cd1 >> 15) & 0x8000)|((cd2 >> 19) & 0x800)|((cd3 >> 23) & 0x80)|((cd4 >> 27) & 0x8);
			pd8  = ((cd1 >> 16) & 0x8000)|((cd2 >> 20) & 0x800)|((cd3 >> 24) & 0x80)|((cd4 >> 28) & 0x8);
			
			pd1 |= ((cd1 >> 2 ) & 0x4000)|((cd2 >> 6 ) & 0x400)|((cd3 >> 10) & 0x40)|((cd4 >> 14) & 0x4);
			pd2 |= ((cd1 >> 3 ) & 0x4000)|((cd2 >> 7 ) & 0x400)|((cd3 >> 11) & 0x40)|((cd4 >> 15) & 0x4);
			pd3 |= ((cd1 >> 4 ) & 0x4000)|((cd2 >> 8 ) & 0x400)|((cd3 >> 12) & 0x40)|((cd4 >> 16) & 0x4);
			pd4 |= ((cd1 >> 5 ) & 0x4000)|((cd2 >> 9 ) & 0x400)|((cd3 >> 13) & 0x40)|((cd4 >> 17) & 0x4);
			pd5 |= ((cd1 >> 6 ) & 0x4000)|((cd2 >> 10) & 0x400)|((cd3 >> 14) & 0x40)|((cd4 >> 18) & 0x4);
			pd6 |= ((cd1 >> 7 ) & 0x4000)|((cd2 >> 11) & 0x400)|((cd3 >> 15) & 0x40)|((cd4 >> 19) & 0x4);
			pd7 |= ((cd1 >> 8 ) & 0x4000)|((cd2 >> 12) & 0x400)|((cd3 >> 16) & 0x40)|((cd4 >> 20) & 0x4);
			pd8 |= ((cd1 >> 9 ) & 0x4000)|((cd2 >> 13) & 0x400)|((cd3 >> 17) & 0x40)|((cd4 >> 21) & 0x4);
			
			pd1 |= ((cd1 << 5 ) & 0x2000)|((cd2 << 1 ) & 0x200)|((cd3 >> 3 ) & 0x20)|((cd4 >> 7 ) & 0x2);
			pd2 |= ((cd1 << 4 ) & 0x2000)|((cd2      ) & 0x200)|((cd3 >> 4 ) & 0x20)|((cd4 >> 8 ) & 0x2);
			pd3 |= ((cd1 << 3 ) & 0x2000)|((cd2 >> 1 ) & 0x200)|((cd3 >> 5 ) & 0x20)|((cd4 >> 9 ) & 0x2);
			pd4 |= ((cd1 << 2 ) & 0x2000)|((cd2 >> 2 ) & 0x200)|((cd3 >> 6 ) & 0x20)|((cd4 >> 10) & 0x2);
			pd5 |= ((cd1 << 1 ) & 0x2000)|((cd2 >> 3 ) & 0x200)|((cd3 >> 7 ) & 0x20)|((cd4 >> 11) & 0x2);
			pd6 |= ((cd1      ) & 0x2000)|((cd2 >> 4 ) & 0x200)|((cd3 >> 8 ) & 0x20)|((cd4 >> 12) & 0x2);
			pd7 |= ((cd1 >> 1 ) & 0x2000)|((cd2 >> 5 ) & 0x200)|((cd3 >> 9 ) & 0x20)|((cd4 >> 13) & 0x2);
			pd8 |= ((cd1 >> 2 ) & 0x2000)|((cd2 >> 6 ) & 0x200)|((cd3 >> 10) & 0x20)|((cd4 >> 14) & 0x2);
			
			pd1 |= ((cd1 << 12) & 0x1000)|((cd2 << 8 ) & 0x100)|((cd3 << 4 ) & 0x10)|((cd4      ) & 0x1);
			pd2 |= ((cd1 << 11) & 0x1000)|((cd2 << 7 ) & 0x100)|((cd3 << 3 ) & 0x10)|((cd4 >> 1 ) & 0x1);
			pd3 |= ((cd1 << 10) & 0x1000)|((cd2 << 6 ) & 0x100)|((cd3 << 2 ) & 0x10)|((cd4 >> 2 ) & 0x1);
			pd4 |= ((cd1 << 9 ) & 0x1000)|((cd2 << 5 ) & 0x100)|((cd3 << 1 ) & 0x10)|((cd4 >> 3 ) & 0x1);
			pd5 |= ((cd1 << 8 ) & 0x1000)|((cd2 << 4 ) & 0x100)|((cd3      ) & 0x10)|((cd4 >> 4 ) & 0x1);
			pd6 |= ((cd1 << 7 ) & 0x1000)|((cd2 << 3 ) & 0x100)|((cd3 >> 1 ) & 0x10)|((cd4 >> 5 ) & 0x1);
			pd7 |= ((cd1 << 6 ) & 0x1000)|((cd2 << 2 ) & 0x100)|((cd3 >> 2 ) & 0x10)|((cd4 >> 6 ) & 0x1);
			pd8 |= ((cd1 << 5 ) & 0x1000)|((cd2 << 1 ) & 0x100)|((cd3 >> 3 ) & 0x10)|((cd4 >> 7 ) & 0x1);
#else
			pd1  = ((cd1 << 7 ) & 0x80)|((cd2 << 3 ) & 0x8)|((cd3 << 15) & 0x8000)|((cd4 << 11) & 0x800);
			pd2  = ((cd1 << 6 ) & 0x80)|((cd2 << 2 ) & 0x8)|((cd3 << 14) & 0x8000)|((cd4 << 10) & 0x800);
			pd3  = ((cd1 << 5 ) & 0x80)|((cd2 << 1 ) & 0x8)|((cd3 << 13) & 0x8000)|((cd4 << 9 ) & 0x800);
			pd4  = ((cd1 << 4 ) & 0x80)|((cd2      ) & 0x8)|((cd3 << 12) & 0x8000)|((cd4 << 8 ) & 0x800);
			pd5  = ((cd1 << 3 ) & 0x80)|((cd2 >> 1 ) & 0x8)|((cd3 << 11) & 0x8000)|((cd4 << 7 ) & 0x800);
			pd6  = ((cd1 << 2 ) & 0x80)|((cd2 >> 2 ) & 0x8)|((cd3 << 10) & 0x8000)|((cd4 << 6 ) & 0x800);
			pd7  = ((cd1 << 1 ) & 0x80)|((cd2 >> 3 ) & 0x8)|((cd3 << 9 ) & 0x8000)|((cd4 << 5 ) & 0x800);
			pd8  = ((cd1      ) & 0x80)|((cd2 >> 4 ) & 0x8)|((cd3 << 8 ) & 0x8000)|((cd4 << 4 ) & 0x800);
			
			pd1 |= ((cd1 >> 2 ) & 0x40)|((cd2 >> 6 ) & 0x4)|((cd3 << 6 ) & 0x4000)|((cd4 << 2 ) & 0x400);
			pd2 |= ((cd1 >> 3 ) & 0x40)|((cd2 >> 7 ) & 0x4)|((cd3 << 5 ) & 0x4000)|((cd4 << 1 ) & 0x400);
			pd3 |= ((cd1 >> 4 ) & 0x40)|((cd2 >> 8 ) & 0x4)|((cd3 << 4 ) & 0x4000)|((cd4      ) & 0x400);
			pd4 |= ((cd1 >> 5 ) & 0x40)|((cd2 >> 9 ) & 0x4)|((cd3 << 3 ) & 0x4000)|((cd4 >> 1 ) & 0x400);
			pd5 |= ((cd1 >> 6 ) & 0x40)|((cd2 >> 10) & 0x4)|((cd3 << 2 ) & 0x4000)|((cd4 >> 2 ) & 0x400);
			pd6 |= ((cd1 >> 7 ) & 0x40)|((cd2 >> 11) & 0x4)|((cd3 << 1 ) & 0x4000)|((cd4 >> 3 ) & 0x400);
			pd7 |= ((cd1 >> 8 ) & 0x40)|((cd2 >> 12) & 0x4)|((cd3      ) & 0x4000)|((cd4 >> 4 ) & 0x400);
			pd8 |= ((cd1 >> 9 ) & 0x40)|((cd2 >> 13) & 0x4)|((cd3 >> 1 ) & 0x4000)|((cd4 >> 5 ) & 0x400);
			
			pd1 |= ((cd1 >> 11) & 0x20)|((cd2 >> 15) & 0x2)|((cd3 >> 3 ) & 0x2000)|((cd4 >> 7 ) & 0x200);
			pd2 |= ((cd1 >> 12) & 0x20)|((cd2 >> 16) & 0x2)|((cd3 >> 4 ) & 0x2000)|((cd4 >> 8 ) & 0x200);
			pd3 |= ((cd1 >> 13) & 0x20)|((cd2 >> 17) & 0x2)|((cd3 >> 5 ) & 0x2000)|((cd4 >> 9 ) & 0x200);
			pd4 |= ((cd1 >> 14) & 0x20)|((cd2 >> 18) & 0x2)|((cd3 >> 6 ) & 0x2000)|((cd4 >> 10) & 0x200);
			pd5 |= ((cd1 >> 15) & 0x20)|((cd2 >> 19) & 0x2)|((cd3 >> 7 ) & 0x2000)|((cd4 >> 11) & 0x200);
			pd6 |= ((cd1 >> 16) & 0x20)|((cd2 >> 20) & 0x2)|((cd3 >> 8 ) & 0x2000)|((cd4 >> 12) & 0x200);
			pd7 |= ((cd1 >> 17) & 0x20)|((cd2 >> 21) & 0x2)|((cd3 >> 9 ) & 0x2000)|((cd4 >> 13) & 0x200);
			pd8 |= ((cd1 >> 18) & 0x20)|((cd2 >> 22) & 0x2)|((cd3 >> 10) & 0x2000)|((cd4 >> 14) & 0x200);
			
			pd1 |= ((cd1 >> 20) & 0x10)|((cd2 >> 24) & 0x1)|((cd3 >> 12) & 0x1000)|((cd4 >> 16) & 0x100);
			pd2 |= ((cd1 >> 21) & 0x10)|((cd2 >> 25) & 0x1)|((cd3 >> 13) & 0x1000)|((cd4 >> 17) & 0x100);
			pd3 |= ((cd1 >> 22) & 0x10)|((cd2 >> 26) & 0x1)|((cd3 >> 14) & 0x1000)|((cd4 >> 18) & 0x100);
			pd4 |= ((cd1 >> 23) & 0x10)|((cd2 >> 27) & 0x1)|((cd3 >> 15) & 0x1000)|((cd4 >> 19) & 0x100);
			pd5 |= ((cd1 >> 24) & 0x10)|((cd2 >> 28) & 0x1)|((cd3 >> 16) & 0x1000)|((cd4 >> 20) & 0x100);
			pd6 |= ((cd1 >> 25) & 0x10)|((cd2 >> 29) & 0x1)|((cd3 >> 17) & 0x1000)|((cd4 >> 21) & 0x100);
			pd7 |= ((cd1 >> 26) & 0x10)|((cd2 >> 30) & 0x1)|((cd3 >> 18) & 0x1000)|((cd4 >> 22) & 0x100);
			pd8 |= ((cd1 >> 27) & 0x10)|((cd2 >> 31) & 0x1)|((cd3 >> 19) & 0x1000)|((cd4 >> 23) & 0x100);
#endif
			
			*pp1++ = pd1;
			*pp2++ = pd2;
			*pp3++ = pd3;
			*pp4++ = pd4;
			*pp5++ = pd5;
			*pp6++ = pd6;
			*pp7++ = pd7;
			*pp8++ = pd8;
		}
	}
}
