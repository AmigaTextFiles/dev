<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libSPS++: /Storage/projects/sps/include/sps/sps_thread.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>/Storage/projects/sps/include/sps/sps_thread.h</h1><div class="fragment"><pre>00001 
00052 <span class="preprocessor">#ifndef SPS_THREAD_H_</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#define SPS_THREAD_H_</span>
00054 <span class="preprocessor"></span>
00055 <span class="preprocessor">#include &lt;exec/types.h&gt;</span>
00056 <span class="preprocessor">#include &lt;exec/ports.h&gt;</span>
00057 <span class="preprocessor">#include &lt;exec/tasks.h&gt;</span>
00058 <span class="preprocessor">#include &lt;exec/semaphores.h&gt;</span>
00059 
00060 <span class="preprocessor">#include &lt;dos/dos.h&gt;</span>
00061 
00062 <span class="keyword">class </span>SPS_Thread
00063 {
00064 <span class="keyword">public</span>:
00066     SPS_Thread();
00072     <span class="keyword">virtual</span> ~SPS_Thread();
00073 
00076     <span class="keyword">virtual</span> <span class="keyword">struct </span>Task* Create( <span class="keyword">const</span> <span class="keywordtype">char</span> * name,int32 pri = 0, uint32 stack = 0x2000 );
00077 
00082     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Destroy();
00083 
00084     <span class="comment">/* possibly kill the thread (if e.g. a CTRL-C is not sufficient). This is actualy just a Signal() */</span>
00085     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Signal( uint32 sig = SIGBREAKF_CTRL_C );
00086   
00088     <span class="keyword">struct </span>Task* GetTask() {
00089         <span class="keywordflow">return</span> m_Task;
00090     }
00091     
00092 <span class="keyword">protected</span>:
00093 
00094     <span class="comment">/* called before Run(). Init what you want. Return true if init is succesfull, false if not.</span>
00095 <span class="comment">     * If result is false, thread will terminate immediately. Create() will wait until OnEntry() returns</span>
00096 <span class="comment">     * and will itself return NULL in case OnEntry() fails. */</span>
00097     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> OnEntry() {
00098         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00099     }
00100     
00101     <span class="comment">/* called before exit. Cleanup what you have initialized in OnEntry().</span>
00102 <span class="comment">     * Warning! OnExit() will also be called even if OnEntry() fails! This said, make sure all</span>
00103 <span class="comment">     * pointers are initialized either in the c'tor or in the OnEntry(). */</span>
00104     <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnExit() {
00105     }
00106     
00109     <span class="keyword">virtual</span> <span class="keywordtype">void</span> Run( ) = 0;
00110 
00111 <span class="keyword">protected</span>:    
00112     <span class="comment">/* the task handle. Only valid outside the thread itself!! */</span>
00113     <span class="keyword">struct </span>Task* m_Task;
00114     <span class="comment">/* a link to its creator */</span>
00115     <span class="keyword">struct </span>Task* m_Parent;
00116 
00117 <span class="keyword">private</span>: <span class="comment">// internal only! Not available in derived classes</span>
00119 <span class="comment"></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> EntryStub( <span class="keywordtype">void</span> );
00120 
00122     <span class="keywordtype">void</span> ThreadEntry( );
00123 
00124 <span class="keyword">private</span>: <span class="comment">// internal only! Not available in derived classes</span>
00125     <span class="comment">/* internal signal to sync thread */</span>
00126     int32 m_InternalSignal;
00127     <span class="comment">/* lock to sync run/destruct */</span>
00128     <span class="keyword">struct </span>SignalSemaphore *m_InternalScopeLock;
00129 
00130 
00131 };
00132 
00133 <span class="preprocessor">#endif </span><span class="comment">/*SPS_THREAD_H_*/</span>
00134 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Sep 1 18:05:20 2006 for libSPS++ by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
