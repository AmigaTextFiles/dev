<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libSPS++: /Storage/projects/sps/sps_exception.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>/Storage/projects/sps/sps_exception.cpp</h1><div class="fragment"><pre>00001 <span class="comment">/* make sure we do not throw exceptions within exceptions! */</span>
00002 <span class="preprocessor">#define _NO_EXCEPTIONS</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#include &lt;<a class="code" href="sps__exception_8h.html">sps/sps_exception.h</a>&gt;</span>
00005 <span class="preprocessor">#include &lt;<a class="code" href="sps__types_8h.html">sps/sps_types.h</a>&gt;</span>
00006 
00007 <span class="preprocessor">#include &lt;exec/memory.h&gt;</span>
00008 <span class="preprocessor">#include &lt;exec/types.h&gt;</span>
00009 <span class="preprocessor">#include &lt;intuition/intuition.h&gt;</span>
00010 
00011 <span class="preprocessor">#include &lt;proto/exec.h&gt;</span>
00012 <span class="preprocessor">#include &lt;proto/intuition.h&gt;</span>
00013 <span class="preprocessor">#include &lt;proto/utility.h&gt;</span>
00014 
00015 <span class="preprocessor">#include &lt;string.h&gt;</span>
00016 
00017 <span class="keyword">struct </span>err
00018 {
00019     <span class="keyword">const</span> <span class="keywordtype">char</span>* code;
00020     <span class="keyword">const</span> <span class="keywordtype">char</span>* text;
00021 } <span class="keyword">static</span> cErrMsg[] = {
00022     { <span class="stringliteral">"ERR_UNKNOWN"</span>,          <span class="stringliteral">"Unknown Error"</span> },
00023     { <span class="stringliteral">"ERR_APP_EXISTS"</span>,       <span class="stringliteral">"Application exists"</span> },
00024     { <span class="stringliteral">"ERR_OPEN_LIB"</span>,         <span class="stringliteral">"Library &lt;%s&gt; open failed"</span> },
00025     { <span class="stringliteral">"ERR_OPEN_IFACE"</span>,       <span class="stringliteral">"Interface &lt;%s&gt; not available"</span> },
00026     { <span class="stringliteral">"ERR_OPEN_CATALOG"</span>,     <span class="stringliteral">"Catalog &lt;%s&gt; cannot be opened"</span> },
00027     { <span class="stringliteral">"ERR_FILE_NOT_FOUND"</span>,   <span class="stringliteral">"File &lt;%s&gt; not found"</span> },
00028     { <span class="stringliteral">"ERR_GUI"</span>,              <span class="stringliteral">"General GUI exception"</span> },
00029     { <span class="stringliteral">"ERR_GUI"</span>,              NULL },
00030     { <span class="stringliteral">"ERR_CX_IGNORE"</span>,        NULL },
00031     { <span class="stringliteral">"ERR_CX_EXCEPTION"</span>,     <span class="stringliteral">"%s\nCommodity not available."</span> }
00032 };
00033 
00034 SPS_Exception::SPS_Exception(<span class="keyword">const</span> <span class="keywordtype">char</span> *src_file, <span class="keywordtype">int</span> src_line, 
00035                              <span class="keywordtype">int</span> code, <span class="keyword">const</span> <span class="keywordtype">char</span>* message, 
00036                              <span class="keyword">const</span> <span class="keywordtype">char</span>* bt_text )
00037     :  IntuitionBase(NULL)
00038     , IIntuition(NULL)
00039     
00040     ,  UtilityBase(NULL)
00041     , IUtility(NULL)
00042      
00043     , m_Title(NULL)
00044     , m_File(NULL)
00045     , m_Line(src_line)
00046     , m_Message(NULL)
00047     , m_Code(code)
00048     , m_ButtonText(NULL)
00049 {
00050     <a class="code" href="sps__types_8h.html#a2">OPEN_IFACE</a>( Utility,   UTILITYNAME, 50 );
00051     <a class="code" href="sps__types_8h.html#a2">OPEN_IFACE</a>( Intuition, <span class="stringliteral">"intuition.library"</span>, 50 );
00052     
00053     <span class="keywordflow">if</span> ( message ) {
00054         m_Message = IUtility-&gt;ASPrintf( <span class="stringliteral">"%s"</span>, message );
00055     }
00056     <span class="keywordflow">if</span> ( src_file ) {
00057         m_File = IUtility-&gt;ASPrintf( <span class="stringliteral">"%s"</span>, src_file );
00058     }
00059     SetTitle(<span class="stringliteral">"SPS Error"</span>);
00060     SetButtonText( bt_text );
00061 }
00062 
00063 SPS_Exception::~SPS_Exception()
00064 {
00065     <span class="keywordflow">if</span> (m_Message   ) IExec-&gt;FreeVec( m_Message );
00066     <span class="keywordflow">if</span> (m_ButtonText) IExec-&gt;FreeVec( m_ButtonText );
00067     
00068     <a class="code" href="sps__types_8h.html#a3">CLOSE_IFACE</a>( Utility );
00069     <a class="code" href="sps__types_8h.html#a3">CLOSE_IFACE</a>( Intuition );
00070 }
00071 
00072 <span class="keywordtype">void</span> SPS_Exception::GetErrorText( <span class="keywordtype">int</span> code, <span class="keywordtype">char</span>* buffer, <span class="keywordtype">int</span> len )
00073 {
00074     IUtility-&gt;Strlcpy( buffer, GetErrorText( code ), len );
00075 }
00076 
00077 <span class="keyword">const</span> <span class="keywordtype">char</span>* SPS_Exception::GetErrorText( <span class="keywordtype">int</span> code )
00078 {
00079     <span class="keywordflow">if</span> ( code &gt;= 0 &amp;&amp; code &lt; ERR_MAX_CODE &amp;&amp; cErrMsg[code].text)
00080     {
00081         <span class="keywordflow">return</span> cErrMsg[code].text;
00082     }
00083     <span class="keywordflow">return</span> <span class="stringliteral">"%s"</span>;
00084 }
00085 
00086 <span class="keyword">const</span> <span class="keywordtype">char</span>* SPS_Exception::GetError( <span class="keywordtype">int</span> code )
00087 {
00088     <span class="keywordflow">if</span> ( code &gt;= 0 &amp;&amp; code &lt; ERR_MAX_CODE &amp;&amp; cErrMsg[code].code )
00089     {
00090         <span class="keywordflow">return</span> cErrMsg[code].code;
00091     }
00092     <span class="keywordflow">return</span> <span class="stringliteral">"ERR_USER"</span>;
00093 }
00094 
00095 <span class="keywordtype">void</span> SPS_Exception::SetTitle( <span class="keyword">const</span> <span class="keywordtype">char</span>* title )
00096 {
00097     <span class="keywordflow">if</span> ( title ) {
00098         <span class="keywordflow">if</span> ( m_Title) IExec-&gt;FreeVec( m_Title );
00099         m_Title = IUtility-&gt;ASPrintf( <span class="stringliteral">"%s"</span>, title );
00100     }
00101 }
00102 
00103 <span class="keywordtype">void</span> SPS_Exception::SetButtonText( <span class="keyword">const</span> <span class="keywordtype">char</span> *bt_text )
00104 {
00105     <span class="keywordflow">if</span> ( bt_text ) {
00106         <span class="keywordflow">if</span> ( m_ButtonText ) {
00107             IExec-&gt;FreeVec( m_ButtonText );
00108         }
00109         m_ButtonText = IUtility-&gt;ASPrintf( <span class="stringliteral">"%s"</span>, bt_text );
00110     }
00111 }
00112 
00113 <span class="keywordtype">void</span> SPS_Exception::FPrintF( FILE* io )
00114 {
00115     <span class="keywordtype">char</span> *buffer = IUtility-&gt;ASPrintf( GetErrorText( m_Code ), m_Message );
00116     <span class="keywordflow">if</span> ( buffer ) {
00117         fprintf(io, <span class="stringliteral">"File: %s@ Line: %d\nException: %s\nError Code %d (%s)\n"</span>,m_File,m_Line,buffer,m_Code, GetError(m_Code));
00118         IExec-&gt;FreeVec( buffer );
00119     }
00120 }
00121     
00122 <span class="keywordtype">void</span> SPS_Exception::PrintF( )
00123 {
00124     <span class="keywordtype">char</span> *buffer = IUtility-&gt;ASPrintf( GetErrorText( m_Code ), m_Message );
00125     <span class="keywordflow">if</span> ( buffer ) {
00126         IExec-&gt;DebugPrintF( <span class="stringliteral">"File: %s@ Line: %d\nException: %s\nError Code %d (%s)\n"</span>,m_File,m_Line,buffer,m_Code, GetError(m_Code));
00127         IExec-&gt;FreeVec( buffer );
00128     }
00129 }
00130 
00131 <span class="keywordtype">int</span> SPS_Exception::Warn( <span class="keyword">const</span> <span class="keywordtype">char</span>* title, <span class="keyword">const</span> <span class="keywordtype">char</span>* button_text ) 
00132 {
00133     <span class="keywordtype">int</span> result = 0;
00134     <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt = GetErrorText( m_Code );
00135     <span class="keywordtype">char</span> *buffer = IUtility-&gt;ASPrintf( fmt, m_Message );
00136     <span class="keywordflow">if</span> ( buffer == NULL ) {
00137         <span class="keywordflow">return</span> 0;
00138     }
00139     fmt = <span class="stringliteral">"File: %s @ Line: %d\n"</span>\
00140           <span class="stringliteral">"Exception: %s\nError Code: %d (%s)"</span>;
00141     <span class="keyword">const</span> <span class="keywordtype">char</span> *err = GetError( m_Code );
00142 <span class="comment">//    char *msg = IUtility-&gt;ASPrintf( fmt, m_File, m_Line, buffer, </span>
00143 <span class="comment">//                                         m_Code, err );</span>
00144     <span class="keywordtype">char</span> msg[1024];
00145     sprintf( msg, fmt, m_File, m_Line, buffer, m_Code, err);
00146     IExec-&gt;FreeVec( buffer );
00147     <span class="keywordflow">if</span> ( msg == NULL ) {
00148         <span class="keywordflow">return</span> 0;
00149     }
00150     <span class="keywordflow">if</span> (title)       SetTitle( title );
00151     <span class="keywordflow">if</span> (button_text) SetButtonText( button_text );
00152     <span class="keyword">struct </span>EasyStruct easyReq =
00153     {
00154         <span class="keyword">sizeof</span>(<span class="keyword">struct </span>EasyStruct),
00155         ESF_EVENSIZE,
00156         (STRPTR)m_Title,
00157         (STRPTR)msg,
00158         (STRPTR)m_ButtonText,
00159         NULL,
00160         NULL 
00161     };   
00162     result = IIntuition-&gt;EasyRequest(NULL,&amp;easyReq,NULL);
00163 <span class="comment">//    IExec-&gt;FreeVec( msg );</span>
00164     
00165     <span class="keywordflow">return</span> result;
00166 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Sep 1 18:05:20 2006 for libSPS++ by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
