myimagegclass v1.39
by Richard Reed
©1993 Excellent Studios
06 Jan 1994

Legal Stuff
-----------
Permission is granted to distribute the programs and data
on this disk provided the following conditions are met:

   1.  All files present in the distribution package must be redistributed
       with the package, including this documentation file.  If you
       distribute on diskette, all files must be on a single diskette.

   2.  The distributor may charge a fee to recover distribution costs.
       The fee for diskette distribution should not be more than the cost
       to obtain the same diskette from Fred Fish.

   3.  The distributor agrees to cease distributing the programs and data
       involved if requested to do so by Excellent Studios.

Excellent Studios will not be liable for any damage arising from the
failure of this program to perform as described, or any ancillary damage
suffered by other programs or data on the system running this program.

(But, really, I doubt anything nasty will happen to you)  =)

I only ask that you mention that you have used myimagegclass somewhere in
your non-commercial program's documentation.  If you wish to use the code
in a commercial project, you must get the written permission of Excellent
Studios.


Description
-----------
myimageclass is a private BOOPSI gadgetclass for use with Stefan Stunz's
Magic User Interface.  It simplifies using standard Intuition Images in
your MUI programs.

Features include the following...

- Change images using an OM_SET method with the GA_Image attribute at
ANY TIME.  You can only set an image for a standard MUI Image object at
init time, so this is particualarly useful if you need to change images due
to user interactions.

- Reports a GA_ID (if not 0) whenever a GM_RENDER method is performed,
which is especially useful for setting aside window areas where custom
drawing is needed.  Really handy when the user resizes the window, & your
custom image area needs to be redrawn.

- Unlike a standard MUI Image object, myimagegclass is resizable, centering
its GA_Image within.

New Features for v1.39

- Image scaling with a variety of settings.

- Image clipping to gadget boundaries.  Images too large to fit in the
gadget space were simply not drawn in v1.1.


Try the Demo
------------
Since Demo uses MUI, you'll have to have installed MUI first for it to work!

Run Demo and see how the scaling, clipping, and notification work.
Notification is demonstrated by beeping everytime a refresh is needed and
the beep option is set.  You can load other IFF ILBM's for experimenting by
clicking on the popfile gadget next to the image name.

demo.c uses the ReadILBM2Image() function from ILBM_Read.c to load in iff
files.  The functions in ILBM_Read.c are a convenient way of loading ILBM's
to images using the iffparse.library (standard in 2.0x).


Usage Overview
--------------
Open like any private BOOPSI class by calling Init_myimagegclass() in your
program's initialization.

Class *myimageclass;
myimagegclass = Init_myimagegclass();

Use the MyImage() macro in myimageclass.h to create an object.  Note that
any image structure you pass to the class must be an old style image, no
BOOPSI images!

(i.e. using the macros in mui.h)
Child, myImage = MyImage(minWidth,minHeight,*image,ID),

If you want to get a notification when the image must be redrawn, you can
use the NotifyFromMyImage() macro.

NotifyFromMyImage(myImage,ID);
(See myimagegclass.h for details.  Note that you could have it call a hook
if you wish using MUIM_CallHook.)

Should you want to change the image, it's simplest to use the set() macro
in mui.h.

set(myImage, GA_Image, *newImage);
(The image will refresh itself)

Finally, close the private class at your program's closing.

Free_myimagegclass(myimagegclass);

And that's really all there is to it!  There's a lot to be learned from the
demo source code, so have a look at it! =)


Linking myimagegclass.o into your program
-----------------------------------------
There are two callable functions in the object file, Init_myimagegclass() &
Free_myimagegclass().  These functions must be linked into your program via
the object file otherwise the linker won't be able to find them.


Functions
---------
Class *Init_myimagegclass(void)
   call to initialize the class.  Returns new class pointer or NULL if
   fails.

void Free_myimagegclass(Class *myimagegclass)
   pass class received from Init_myimagegclass() to free.

(Functions in ILBM_Read.c)
WORD ReadILBM2BitMap(char *name, struct BitMap *bm, UWORD *colorTable)
   Reads an IFF ILBM of name into the bm BitMap struct.  If colorTable is
   nonzero, the ILBM's palette (CMAP) will be placed there.  Returns 0 if
   successful, or an IFFERR_ if failed.

   Note that you should FreeVec(bm.Planes[0]) to free the image memory
   before closing your program!

WORD ReadILBM2Image(char *name, struct Image *image, UWORD *colorTable)
   Same as ReadILBM2BitMap() except it constructs an Image struct. Returns 0
   if successful, or an IFFERR_ if failed.

   Note that you should FreeVec(image.ImageData) to free the image memory
   before closing your program!


myimagegclass
-------------
No new methods
Changed attributes
GA_Image          [ISG] Changing this refreshes the gadget imagery.
                        Also gettable.
GA_ID             [IS]  Nonzero will report a refresh using value.

New attributes
GA_ScaleFlags     [ISG] Image scaling option bits.
GA_ScaleRelWidth  [ISG] Width for relative scaling.
GA_ScaleRelHeight [ISG] Height for relative scaling.
GA_MUIRemember    [ISG] Remember packet for MUI destroy/remake actions on
                        same object.

Flags for GA_ScaleFlags

GAFL_ScaleX, GAFL_ScaleY
   Changes an image's width or height to the current width or height of the
   object in the MUI window.

GAFL_RelX, GAFL_RelY
   Use relative scaling for width (GA_ScaleRelWidth) or height
   (GA_ScaleRelHeight).

GAFL_AspectRatio
   Preserve image's PIXEL aspect ratio.

It's a bit difficult to explain exactly how these flags work in concert -
that's why there's the Demo program.  It works in this order...

-If GAFL_Scale(X or Y) are set, then dest(Width/Height) = object->(Wd/Ht)

-If GAFL_Rel(X or Y) are set, then relative scale dest(Wd/Ht) as such...

   imageWidth   newDestWidth     In short, if relWidth is twice as large
   ---------- = ------------     as imageWidth, then newDestWidth will be
    relWidth     destWidth       twice as wide as destWidth.

 Relative scaling is useful when you wish to display a lot of images in the
 same object, but keep their sizes in relation to each other the same.
 Without relative scaling, all images would be displayed at the same size
 regardless of their original sizes since they'd be scaled to the object's
 current dimensions.

 You go about setting up relative scaling by setting GA_ScaleRelWidth &
 GA_ScaleRelHeight to the dimensions of the largest of the images that'll
 be displayed in the object, then set the appropriate GA_Rel(X/Y) flags.

-If GAFL_AspectRatio is set, then size to object's aspect ratio.

The flag effects are cumulative, so if you set GAFL_ScaleX & GAFL_RelX,
destWidth will be set to the object's current width, THEN relative scaled.
It is possible to set up some strange scaling behavior using different flag
combinations.  I've included some standard flag settings in myimagegclass.h
to make things a bit easier.

GAFL_ScaleXY
   Scale fully to XY.  Stretches to whatever rectangle you can come up with!
GAFL_RelXY
   Relative scale XY based solely off original image size.  Doesn't care
   about current object's dimensions & will clip if image doesn't fit.
GAFL_ScaleRelXY
   Relative scale XY based off current object dimensions & original image
   size.  You'll see no clipping here unless you set an image larger than
   the relative width & height!
GAFL_ScaleXYAspect
   Image will be displayed in the object aspect ratio preserved, scaled to
   the largest it can be without being clipped.
GAFL_ScaleRelXYAspect
   Same as ScaleXYAspect except for the addition of relative scaling.


Particulars
-----------
First off, let's take a look at how an instance of myimagegclass is created
in MUI...

#define MyImage(minWidth,minHeight,image,returnID)\
   BoopsiObject,\
      MUIA_Boopsi_Class, myimagegclass,\  // these are REQUIRED!
      MUIA_Boopsi_MinWidth , minWidth,\   //           |
      MUIA_Boopsi_MinHeight, minHeight,\  //           |
      MUIA_Boopsi_Remember, GA_MUIRemember,\ //        |
      GA_Left,0,GA_Top,0,GA_Width,0,GA_Height,0,\  //  |
      ICA_TARGET  , ICTARGET_IDCMP,\      //           v
      GA_Image, image,\
      GA_Left,0,GA_Top,0,GA_Width,0,GA_Height,0,\
      GA_ID, returnID,\
      ICA_TARGET  , ICTARGET_IDCMP,\
      End

MUIA_Boopsi_MinWidth & MUIA_Boopsi_MinHeight must be provided as is for all
BOOPSI objects being used in MUI (see MUI BOOPSI autodocs for info)

MUIA_Boopsi_Remember, GA_MUIRemember is needed because when MUI remakes the
BOOPSI object (as when its window is resized), this attribute allows the
object to remember all its settings with only one tag.  This has been
changed from v1.1 which required GA_Image to be remembered.

Erasing the image is performed using EraseRect() which calls the backfill
hook.  MUI background inheritance isn't accounted for in EraseRect(), so
you'll most likely get a solid background fill.


The Future
----------
This will probably be obsolete when MUI v1.5 comes out, since Stefan is
documenting the actual MUI classes.  You'll be able to construct your own
MUI classes w/o hacking through BOOPSI.  I'll be sure to convert
myimagegclass to a real MUI class when v1.5 comes out, though!


How to Reach the Author
-----------------------
Bugs, suggestions, etc. should be sent one of my various e-mail addresses.

Internet: rreed@terapin.com
Compuserve ID #:  72242,2624

Inquiries and other stuff (material things) can be sent to

Richard Reed
Excellent Studios
1933 Davis St. #309
San Leandro, CA  94577

PH: (510)632-2823
FAX:(510)632-2769

Good luck with your MUI programs!  I hope myimagegclass will make adding
image type objects to your interface a breeze.  Scaling images can only
allow for true interface resizability!
