@database HYPER:Modula-2/ExpansionD
@node Main "HYPER:Modula-2/ExpansionD"

Konstanten

   @{" bootTime " link Modul 104}                    @{" busWidth " link Modul 101}                    @{" chainedConfig " link Modul 82}
   @{" diagValid " link Modul 83}                   @{" errBadmem " link Modul 180}                   @{" errLastboard " link Modul 176}
   @{" errNoboard " link Modul 179}                  @{" errNoexpansion " link Modul 177}              @{" errNomemory " link Modul 178}
   @{" errOk " link Modul 175}                       @{" expansionBase " link Modul 61}               @{" expansionName " link Modul 11}
   @{" expansionSize " link Modul 63}               @{" expansionSlots " link Modul 64}              @{" memBit " link Modul 80}
   @{" memList " link Modul 84}                     @{" memMask " link Modul 79}                     @{" memSize " link Modul 81}
   @{" memoryBase " link Modul 65}                  @{" memorySize " link Modul 66}                  @{" memorySlots " link Modul 67}
   @{" never " link Modul 105}                       @{" newBoard " link Modul 75}                    @{" nibbleWide " link Modul 103}
   @{" slotMask " link Modul 58}                    @{" slotShift " link Modul 59}                   @{" slotSize " link Modul 56}
   @{" startProc " link Modul 165}                   @{" typeBit " link Modul 73}                     @{" typeMask " link Modul 72}
   @{" typeSize " link Modul 74}                    @{" z3ConfigArea " link Modul 68}                @{" z3ConfigAreaEnd " link Modul 69}
   @{" z3ExpansionBase " link Modul 62}             @{" z3SizeGranularity " link Modul 70}           @{" zoroIII " link Modul 77}
   @{" zorroII " link Modul 76}                  

Typ-Deklarationen

   @{" BootNode " link Modul 140}                    @{" BootNodePtr " link Modul 146}                 @{" ConfigDev " link Modul 115}
   @{" ConfigDevFlagSet " link Modul 113}            @{" ConfigDevFlags " link Modul 109}              @{" ConfigDevPtr " link Modul 114}
   @{" ConfigFlagSet " link Modul 89}               @{" ConfigFlags " link Modul 87}                 @{" CurrentBinding " link Modul 129}
   @{" CurrentBindingPtr " link Modul 136}           @{" DiagArea " link Modul 90}                    @{" ExpansionBase " link Modul 153}
   @{" ExpansionBaseFlagSet " link Modul 152}        @{" ExpansionBaseFlags " link Modul 148}          @{" ExpansionBasePtr " link Modul 163}
   @{" ExpansionControl " link Modul 37}            @{" ExpansionRom " link Modul 20}                @{" ExpansionRomFlagSet " link Modul 19}
   @{" ExpansionRomFlags " link Modul 14}           @{" InterruptFlagSet " link Modul 36}            @{" InterruptFlags " link Modul 33}
   @{" ParameterPkt " link Modul 182}                @{" ParameterPktPtr " link Modul 190}          

@endnode
@node Modul "HYPER:Modula-2/ExpansionD.def.guide"
DEFINITION MODULE ExpansionD; (*$ Implementation:=FALSE *)
(* 10-Mar-1992/cn *)

FROM SYSTEM IMPORT ADDRESS,BITSET,LONGSET,SHORTSET;

FROM DosD IMPORT
 @{" DeviceNodePtr " link HYPER:Modula-2/DosD.def.guide/Modul 579},@{" DosEnvec " link HYPER:Modula-2/DosD.def.guide/Modul 514};

FROM ExecD IMPORT
 @{" ExecBasePtr " link HYPER:Modula-2/ExecD.def.guide/Modul 631},@{" Interrupt " link HYPER:Modula-2/ExecD.def.guide/Modul 51},@{" Library " link HYPER:Modula-2/ExecD.def.guide/Modul 400},@{" List " link HYPER:Modula-2/ExecD.def.guide/Modul 30},@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18},@{" SignalSemaphore " link HYPER:Modula-2/ExecD.def.guide/Modul 504};

CONST
 expansionName="expansion.library";

TYPE
 @{" ExpansionRomFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 14}=(
  erf0,erf1,erf2,erf3,
  zorro3,extended,noShutup,memSpace
 );
 @{" ExpansionRomFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 19}=SET OF @{" ExpansionRomFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 14};
 @{" ExpansionRom " link HYPER:Modula-2/ExpansionD.def.guide/Modul 20}=RECORD
  type:SHORTCARD;
  product:SHORTCARD;
  flags:@{" ExpansionRomFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 19};
  reserved03:SHORTCARD;
  manufacturer:CARDINAL;
  serialNumber:LONGCARD;
  initDiagVec:CARDINAL;
  reserved0c:SHORTCARD;
  reserved0d:SHORTCARD;
  reserved0e:SHORTCARD;
  reserved0f:SHORTCARD
 END;
 @{" InterruptFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 33}=(
  if0,intena,if2,reset,int2pend,int6pend,int7pend,interrupting
 );
 @{" InterruptFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 36}=SET OF @{" InterruptFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 33};
 @{" ExpansionControl " link HYPER:Modula-2/ExpansionD.def.guide/Modul 37}=RECORD
  interrupt:@{" InterruptFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 36};
  z3HighBase:SHORTCARD;
  baseAddress:SHORTCARD;
  shutup:SHORTCARD;
  reserved14:SHORTCARD;
  reserved15:SHORTCARD;
  reserved16:SHORTCARD;
  reserved17:SHORTCARD;
  reserved18:SHORTCARD;
  reserved19:SHORTCARD;
  reserved1a:SHORTCARD;
  reserved1b:SHORTCARD;
  reserved1c:SHORTCARD;
  reserved1d:SHORTCARD;
  reserved1e:SHORTCARD;
  reserved1f:SHORTCARD;
 END;

CONST
 slotSize=10000H;
 slotMask=0FFFFH;
 slotShift=16;

 expansionBase=0E80000H;
 z3ExpansionBase=0FF000000H;
 expansionSize=080000H;
 expansionSlots=8;
 memoryBase=200000H;
 memorySize=800000H;
 memorySlots=128;
 z3ConfigArea     =40000000H;
 z3ConfigAreaEnd  =7FFFFFFFH;
 z3SizeGranularity=00080000H;

 typeMask=0C0H;
 typeBit=6;
 typeSize=2;
 newBoard=0C0H;
 zorroII=newBoard;
 zoroIII=080H;

 memMask=07H;
 memBit=0;
 memSize=3;
 chainedConfig=3;
 diagValid=4;
 memList=5;


TYPE
 @{" ConfigFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 87}=(cf0,cf1,cf2,cf3,configTime,bindTime,byteWide,wordWide);
 @{" ConfigFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 89}=SET OF @{" ConfigFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 87};
 @{" DiagArea " link HYPER:Modula-2/ExpansionD.def.guide/Modul 90}=RECORD
  config:@{" ConfigFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 89};
  flags:SHORTCARD;
  size:CARDINAL;
  diagPoint:CARDINAL;
  bootPoint:CARDINAL;
  name:CARDINAL;
  reserved01:CARDINAL;
  reserved02:CARDINAL
 END;

CONST
 busWidth=@{" ConfigFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 89}{byteWide,wordWide};
 nibbleWide=@{" ConfigFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 89}{};
 bootTime=@{" ConfigFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 89}{configTime,bindTime};
 never=@{" ConfigFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 89}{};

(* ----- *)

TYPE
 @{" ConfigDevFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 109}=(
  shutup,configMe,badMemory,processed,cdf4,cdf5,cdf6,cdf7
 );
 @{" ConfigDevFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 113}=SET OF @{" ConfigDevFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 109};
 @{" ConfigDevPtr " link HYPER:Modula-2/ExpansionD.def.guide/Modul 114}=POINTER TO @{" ConfigDev " link HYPER:Modula-2/ExpansionD.def.guide/Modul 115};
 @{" ConfigDev " link HYPER:Modula-2/ExpansionD.def.guide/Modul 115}=RECORD
  node:@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18};
  flags:@{" ConfigDevFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 113};
  pad:SHORTCARD;
  rom:@{" ExpansionRom " link HYPER:Modula-2/ExpansionD.def.guide/Modul 20};
  boardAddr:ADDRESS;
  boardSize:LONGCARD;
  slotAddr:CARDINAL;
  slotSize:CARDINAL;
  driver:ADDRESS;
  nextCD:@{" ConfigDevPtr " link HYPER:Modula-2/ExpansionD.def.guide/Modul 114};
  unused:ARRAY [0..3] OF LONGINT;
 END;

TYPE
 @{" CurrentBinding " link HYPER:Modula-2/ExpansionD.def.guide/Modul 129}=RECORD
  configDev:@{" ConfigDevPtr " link HYPER:Modula-2/ExpansionD.def.guide/Modul 114};
  fileName:ADDRESS;
  productString:ADDRESS;
  toolTypes:ADDRESS;
 END;
 @{" CurrentBindingPtr " link HYPER:Modula-2/ExpansionD.def.guide/Modul 136}=POINTER TO @{" CurrentBinding " link HYPER:Modula-2/ExpansionD.def.guide/Modul 129};

(* ------ *)

TYPE
 @{" BootNode " link HYPER:Modula-2/ExpansionD.def.guide/Modul 140}=RECORD
  node:@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18};
  flags:BITSET;
  deviceNode:ADDRESS
 END;
 @{" BootNodePtr " link HYPER:Modula-2/ExpansionD.def.guide/Modul 146}=POINTER TO @{" BootNode " link HYPER:Modula-2/ExpansionD.def.guide/Modul 140};

 @{" ExpansionBaseFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 148}=(
  clogged,shortmem,badmem,dosflag,kickback33,kickback36,silentStart
  ,startCC0
 );
 @{" ExpansionBaseFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 152}=SET OF @{" ExpansionBaseFlags " link HYPER:Modula-2/ExpansionD.def.guide/Modul 148};
 @{" ExpansionBase " link HYPER:Modula-2/ExpansionD.def.guide/Modul 153}=RECORD
  libNode:@{" Library " link HYPER:Modula-2/ExecD.def.guide/Modul 400};
  flags:@{" ExpansionBaseFlagSet " link HYPER:Modula-2/ExpansionD.def.guide/Modul 152};
  private01:SHORTCARD;
  private02:LONGCARD;
  private03:LONGCARD;
  private04:@{" CurrentBinding " link HYPER:Modula-2/ExpansionD.def.guide/Modul 129};
  private05:@{" List " link HYPER:Modula-2/ExecD.def.guide/Modul 30};
  mountList:@{" List " link HYPER:Modula-2/ExecD.def.guide/Modul 30};
 END;
 @{" ExpansionBasePtr " link HYPER:Modula-2/ExpansionD.def.guide/Modul 163}=POINTER TO @{" ExpansionBase " link HYPER:Modula-2/ExpansionD.def.guide/Modul 153};

CONST
(*
 Möglicher Wert für den Parameter flags von AddBootNode und AddDosNode,
 z.B. AddBootNode(0,LONGSET{startProc},..).
*)
 startProc=0;

(*
 Mögliche Rückgabewerte von ConfigBoard
*)
 errOk=0;
 errLastboard=40;
 errNoexpansion=41;
 errNomemory=42;
 errNoboard=43;
 errBadmem=44;

TYPE
 @{" ParameterPkt " link HYPER:Modula-2/ExpansionD.def.guide/Modul 182}=RECORD
  dosName:ADDRESS;
  execName:ADDRESS;
  unit:LONGCARD;
  flags:LONGSET;
  env:@{" DosEnvec " link HYPER:Modula-2/DosD.def.guide/Modul 514};
 END;
 @{" ParameterPktPtr " link HYPER:Modula-2/ExpansionD.def.guide/Modul 190}=POINTER TO @{" ParameterPkt " link HYPER:Modula-2/ExpansionD.def.guide/Modul 182};

END ExpansionD.noimp

@endnode
