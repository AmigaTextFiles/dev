@database HYPER:Modula-2/Resources
@node Main "HYPER:Modula-2/Resources"

Prozeduren

   @{" AbleICR " link Modul 86}                     @{" AddICRVector " link Modul 90}                @{" AllocMiscResource " link Modul 246}
   @{" AllocPotBits " link Modul 266}                @{" AllocUnit " link Modul 149}                   @{" FreeMiscResource " link Modul 251}
   @{" FreePotBits " link Modul 270}                 @{" FreeUnit " link Modul 153}                    @{" GetUnit " link Modul 157}
   @{" GetUnitID " link Modul 162}                   @{" GiveUnit " link Modul 166}                    @{" ObtainBattSemaphore " link Modul 59}
   @{" ReadBattClock " link Modul 26}               @{" ReadBattMem " link Modul 61}                 @{" ReadUnitID " link Modul 168}
   @{" ReleaseBattSemaphore " link Modul 67}        @{" RemICRVector " link Modul 95}                @{" ResetBattClock " link Modul 28}
   @{" SetICR " link Modul 100}                      @{" WriteBattClock " link Modul 30}              @{" WriteBattMem " link Modul 69}
   @{" WritePotgo " link Modul 274}               

Konstanten

   @{" amiga " link Modul 144}                       @{" battclockName " link Modul 23}               @{" battmemAmigaAmnesiaAddr " link Modul 41}
   @{" battmemAmigaAmnesiaLen " link Modul 42}      @{" battmemName " link Modul 38}                 @{" battmemScsiHostIdAddr " link Modul 53}
   @{" battmemScsiHostIdLen " link Modul 54}        @{" battmemScsiLunsAddr " link Modul 47}         @{" battmemScsiLunsLen " link Modul 48}
   @{" battmemScsiSyncXferAddr " link Modul 56}     @{" battmemScsiSyncXferLen " link Modul 57}      @{" battmemScsiTimeoutAddr " link Modul 44}
   @{" battmemScsiTimeoutLen " link Modul 45}       @{" battmemSharedAmnesiaAddr " link Modul 50}    @{" battmemSharedAmnesiaLen " link Modul 51}
   @{" ciaaName " link Modul 79}                    @{" ciabName " link Modul 81}                    @{" diskName " link Modul 139}
   @{" drt150rpm " link Modul 146}                   @{" drt37422D2S " link Modul 145}                 @{" dskDmaOff " link Modul 142}
   @{" empty " link Modul 147}                       @{" fsrName " link Modul 176}                     @{" mathIEEEName " link Modul 206}
   @{" miscName " link Modul 233}                    @{" potgoName " link Modul 259}                

Typ-Deklarationen

   @{" CiaResourcePtr " link Modul 83}              @{" DiscResource " link Modul 123}                @{" DiscResourceFlagSet " link Modul 121}
   @{" DiscResourceFlags " link Modul 118}           @{" DiscResourcePtr " link Modul 137}             @{" DiscResourceUnit " link Modul 109}
   @{" DiscResourceUnitPtr " link Modul 116}         @{" FileSysEntry " link Modul 186}                @{" FileSysResource " link Modul 179}
   @{" MathIEEEResource " link Modul 216}            @{" MathIEEEResourceFlagSet " link Modul 214}     @{" MathIEEEResourceFlags " link Modul 209}
   @{" MathIEEEResourcePtr " link Modul 227}         @{" MiscResource " link Modul 240}                @{" MiscResourcePtr " link Modul 244}
   @{" PotgoBitSet " link Modul 264}                 @{" PotgoBits " link Modul 262}                   @{" ResourceTypes " link Modul 236}
   @{" StrPtr " link Modul 16}                   

@endnode
@node Modul "HYPER:Modula-2/Resources.def.guide"
DEFINITION MODULE Resources; (*$Implementation:=FALSE*)
(* 12-May-1992/cn *)

FROM SYSTEM IMPORT ADDRESS,BPTR,LONGSET;

FROM DosD IMPORT
 @{" BSTR " link HYPER:Modula-2/DosD.def.guide/Modul 184},@{" FileLockPtr " link HYPER:Modula-2/DosD.def.guide/Modul 206};

FROM ExecD IMPORT vectSize,@{" Interrupt " link HYPER:Modula-2/ExecD.def.guide/Modul 51},@{" InterruptPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 56},@{" Library " link HYPER:Modula-2/ExecD.def.guide/Modul 400},@{" LibraryPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 412},
 @{" List " link HYPER:Modula-2/ExecD.def.guide/Modul 30},@{" Message " link HYPER:Modula-2/ExecD.def.guide/Modul 376},@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18},@{" TaskPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 176};

FROM Hardware IMPORT
 @{" CiaIcrFlags " link HYPER:Modula-2/Hardware.def.guide/Modul 295},@{" CiaIcrFlagSet " link HYPER:Modula-2/Hardware.def.guide/Modul 297},@{" PotFlags " link HYPER:Modula-2/Hardware.def.guide/Modul 162},@{" PotFlagSet " link HYPER:Modula-2/Hardware.def.guide/Modul 167};

IMPORT R;

TYPE
 @{" StrPtr " link HYPER:Modula-2/Arts.def.guide/Modul 20}=ADDRESS;

(*
 battclock resource
*)

CONST
 battclockName="battclock.resource";

PROCEDURE @{" ReadBattClock " link HYPER:Autodocs/battclock/ReadBattClock() }(base{R.A6}:ADDRESS):LONGCARD; CODE -12;

PROCEDURE @{" ResetBattClock " link HYPER:Autodocs/battclock/ResetBattClock() }(base{R.A6}:ADDRESS); CODE -6;

PROCEDURE @{" WriteBattClock " link HYPER:Autodocs/battclock/WriteBattClock() }(
           base{R.A6}:ADDRESS;
           time{R.D0}:LONGCARD); CODE -18;

(*
 battmem resource
*)

CONST
 battmemName="battmem.resource";

 battmemAmigaAmnesiaAddr=0;
 battmemAmigaAmnesiaLen=1;

 battmemScsiTimeoutAddr=1;
 battmemScsiTimeoutLen=1;

 battmemScsiLunsAddr=2;
 battmemScsiLunsLen=1;

 battmemSharedAmnesiaAddr=64;
 battmemSharedAmnesiaLen=1;

 battmemScsiHostIdAddr=65;
 battmemScsiHostIdLen=3;

 battmemScsiSyncXferAddr=68;
 battmemScsiSyncXferLen=1;

PROCEDURE @{" ObtainBattSemaphore " link HYPER:Autodocs/battmem/ObtainBattSemaphore() }(base{R.A6}:ADDRESS); CODE -6;

PROCEDURE @{" ReadBattMem " link HYPER:Autodocs/battmem/ReadBattMem() }(
           base{R.A6}:ADDRESS;
           buffer{R.A0}:ADDRESS;
           offset{R.D0}:LONGCARD;
           length{R.D1}:LONGCARD):LONGCARD; CODE -18;

PROCEDURE @{" ReleaseBattSemaphore " link HYPER:Autodocs/battmem/ReleaseBattSemaphore() }(base{R.A6}:ADDRESS); CODE -12;

PROCEDURE @{" WriteBattMem " link HYPER:Autodocs/battmem/WriteBattMem() }(
           base{R.A6}:ADDRESS;
           buffer{R.A0}:ADDRESS;
           offset{R.D0}:LONGCARD;
           length{R.D1}:LONGCARD):LONGCARD; CODE -24;

(*
 cia resources
*)

CONST
 ciaaName="ciaa.resource";
 ciabName="ciab.resource";

TYPE
 @{" CiaResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 83}=ADDRESS;

PROCEDURE @{" AbleICR " link HYPER:Autodocs/cia/AbleICR() }(
           cia{R.A6}:@{" CiaResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 83};
           mask{R.D0}:@{" CiaIcrFlagSet " link HYPER:Modula-2/Hardware.def.guide/Modul 297}):@{" CiaIcrFlagSet " link HYPER:Modula-2/Hardware.def.guide/Modul 297}; CODE -18;

PROCEDURE @{" AddICRVector " link HYPER:Autodocs/cia/AddICRVector() }(
           cia{R.A6}:@{" CiaResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 83};
           icrBit{R.D0}:@{" CiaIcrFlags " link HYPER:Modula-2/Hardware.def.guide/Modul 295};
           interrupt{R.A1}:@{" InterruptPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 56}):@{" InterruptPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 56}; CODE -6;

PROCEDURE @{" RemICRVector " link HYPER:Autodocs/cia/RemICRVector() }(
           cia{R.A6}:@{" CiaResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 83};
           icrBit{R.D0}:@{" CiaIcrFlags " link HYPER:Modula-2/Hardware.def.guide/Modul 295};
           interrupt{R.A1}:@{" InterruptPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 56}); CODE -12;

PROCEDURE @{" SetICR " link HYPER:Autodocs/cia/SetICR() }(
           cia{R.A6}:@{" CiaResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 83};
           mask{R.D0}:@{" CiaIcrFlagSet " link HYPER:Modula-2/Hardware.def.guide/Modul 297}):@{" CiaIcrFlagSet " link HYPER:Modula-2/Hardware.def.guide/Modul 297}; CODE -24;


(*
 disk resource
*)

TYPE
 @{" DiscResourceUnit " link HYPER:Modula-2/Resources.def.guide/Modul 109}=RECORD
  message:@{" Message " link HYPER:Modula-2/ExecD.def.guide/Modul 376};
  discBlock:@{" Interrupt " link HYPER:Modula-2/ExecD.def.guide/Modul 51};
  discSync:@{" Interrupt " link HYPER:Modula-2/ExecD.def.guide/Modul 51};
  index:@{" Interrupt " link HYPER:Modula-2/ExecD.def.guide/Modul 51}
 END;
 @{" DiscResourceUnitPtr " link HYPER:Modula-2/Resources.def.guide/Modul 116}=POINTER TO @{" DiscResourceUnit " link HYPER:Modula-2/Resources.def.guide/Modul 109};

 @{" DiscResourceFlags " link HYPER:Modula-2/Resources.def.guide/Modul 118}=(
  alloc0,alloc1,alloc2,alloc3,drf4,drf5,drf6,active
 );
 @{" DiscResourceFlagSet " link HYPER:Modula-2/Resources.def.guide/Modul 121}=SET OF @{" DiscResourceFlags " link HYPER:Modula-2/Resources.def.guide/Modul 118};

 @{" DiscResource " link HYPER:Modula-2/Resources.def.guide/Modul 123}=RECORD
  library:@{" Library " link HYPER:Modula-2/ExecD.def.guide/Modul 400};
  current:@{" DiscResourceUnitPtr " link HYPER:Modula-2/Resources.def.guide/Modul 116};
  flags:@{" DiscResourceFlagSet " link HYPER:Modula-2/Resources.def.guide/Modul 121};
  pad:SHORTCARD;
  sysLib:@{" LibraryPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 412};
  ciaResource:@{" LibraryPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 412};
  unitID:ARRAY [alloc0..alloc3] OF LONGCARD;
  waiting:@{" List " link HYPER:Modula-2/ExecD.def.guide/Modul 30};
  discBlock:@{" Interrupt " link HYPER:Modula-2/ExecD.def.guide/Modul 51};
  discSync:@{" Interrupt " link HYPER:Modula-2/ExecD.def.guide/Modul 51};
  index:@{" Interrupt " link HYPER:Modula-2/ExecD.def.guide/Modul 51};
  currTask:@{" TaskPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 176};
 END;
 @{" DiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 137}=POINTER TO @{" DiscResource " link HYPER:Modula-2/Resources.def.guide/Modul 123};

CONST
 diskName="disk.resource";

 dskDmaOff=4000H;

 amiga=0;
 drt37422D2S=55555555H;
 drt150rpm=0AAAAAAAAH;
 empty=0FFFFFFFFH;

PROCEDURE @{" AllocUnit " link HYPER:Autodocs/disk/AllocUnit() }(
           disk{R.A6}:@{" DiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 137};
           unitNum{R.D0}:LONGINT):BOOLEAN; CODE -6;

PROCEDURE @{" FreeUnit " link HYPER:Autodocs/disk/FreeUnit() }(
           disk{R.A6}:@{" DiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 137};
           unitNum{R.D0}:LONGINT); CODE -12;

PROCEDURE @{" GetUnit " link HYPER:Autodocs/disk/GetUnit() }(
           disk{R.A6}:@{" DiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 137};
           unitPointer{R.A1}:@{" DiscResourceUnitPtr " link HYPER:Modula-2/Resources.def.guide/Modul 116}
          ):@{" DiscResourceUnitPtr " link HYPER:Modula-2/Resources.def.guide/Modul 116}; CODE -18;

PROCEDURE @{" GetUnitID " link HYPER:Autodocs/disk/GetUnitID() }(
           disk{R.A6}:@{" DiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 137};
           unitNum{R.D0}:LONGINT):LONGCARD; CODE -30;

PROCEDURE @{" GiveUnit " link HYPER:Autodocs/disk/GiveUnit() }(disk{R.A6}:@{" DiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 137}); CODE -24;

PROCEDURE(*37*) @{" ReadUnitID " link HYPER:Autodocs/disk/ReadUnitID() }(
                 disk{R.A6}:@{" DiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 137};
                 unitNum{R.D0}:LONGINT):LONGCARD; CODE -36;

(*
 filesystem resource
*)

CONST
 fsrName="FileSystem.resource";

TYPE
 @{" FileSysResource " link HYPER:Modula-2/Resources.def.guide/Modul 179}=RECORD
  node:@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18};
  creator:@{" StrPtr " link HYPER:Modula-2/Arts.def.guide/Modul 20};
  fileSysEntries:@{" List " link HYPER:Modula-2/ExecD.def.guide/Modul 30};
 END;

 @{" FileSysEntry " link HYPER:Modula-2/Resources.def.guide/Modul 186}=RECORD
  node:@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18};
  dosType:LONGCARD;
  version:LONGCARD;
  patchFlags:LONGSET;
  type:LONGCARD;
  task:@{" TaskPtr " link HYPER:Modula-2/ExecD.def.guide/Modul 176};
  lock:@{" FileLockPtr " link HYPER:Modula-2/DosD.def.guide/Modul 206};
  handler:@{" BSTR " link HYPER:Modula-2/DosD.def.guide/Modul 184};
  stackSize:LONGCARD;
  priority:LONGINT;
  startup:BPTR;
  segList:BPTR;
  globalVec:BPTR;
 END;

(*
 mathieee resource
*)

CONST
 mathIEEEName="MathIEEE.resource";

TYPE
 @{" MathIEEEResourceFlags " link HYPER:Modula-2/Resources.def.guide/Modul 209}=(
  dblbas,dbltrans,sglbas,sgltrans,extbas,exttrans,mirf6,mirf7,
  mirf8,mirf9,mirf10,mirf11,mirf12,mirf13,mirf14,mirf15
 );
 @{" MathIEEEResourceFlagSet " link HYPER:Modula-2/Resources.def.guide/Modul 214}=SET OF @{" MathIEEEResourceFlags " link HYPER:Modula-2/Resources.def.guide/Modul 209};

 @{" MathIEEEResource " link HYPER:Modula-2/Resources.def.guide/Modul 216}=RECORD
  node:@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18};
  flags:@{" MathIEEEResourceFlagSet " link HYPER:Modula-2/Resources.def.guide/Modul 214};
  baseAddr:ADDRESS;
  dblBasInit:PROC;
  dblTransInit:PROC;
  sglBasInit:PROC;
  sglTransInit:PROC;
  extBasInit:PROC;
  extTransInit:PROC;
 END;
 @{" MathIEEEResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 227}=POINTER TO @{" MathIEEEResource " link HYPER:Modula-2/Resources.def.guide/Modul 216};

(*
 misc resource
*)

CONST
 miscName="misc.resource";

TYPE
 @{" ResourceTypes " link HYPER:Modula-2/Resources.def.guide/Modul 236}=(
  serialPort,serialBits,parallelPort,parallelBits
 );
  @{" MiscResource " link HYPER:Modula-2/Resources.def.guide/Modul 240}=RECORD
    library: @{" Library " link HYPER:Modula-2/ExecD.def.guide/Modul 400};
    allocArray: ARRAY @{" ResourceTypes " link HYPER:Modula-2/Resources.def.guide/Modul 236} OF ADDRESS;
  END;
  @{" MiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 244}=POINTER TO @{" MiscResource " link HYPER:Modula-2/Resources.def.guide/Modul 240};

PROCEDURE @{" AllocMiscResource " link HYPER:Autodocs/misc/AllocMiscResource() }(
           misc{R.A6}:@{" MiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 244};
           unitNum{R.D0}:LONGINT;
           name{R.A1}:@{" StrPtr " link HYPER:Modula-2/Arts.def.guide/Modul 20}):ADDRESS; CODE -6;

PROCEDURE @{" FreeMiscResource " link HYPER:Autodocs/misc/FreeMiscResource() }(
           misc{R.A6}:@{" MiscResourcePtr " link HYPER:Modula-2/Resources.def.guide/Modul 244};
           unitNum{R.D0}:LONGINT); CODE -12;

(*
 potgo resource
*)

CONST
 potgoName="potgo.resource";

TYPE
 @{" PotgoBits " link HYPER:Modula-2/Resources.def.guide/Modul 262}=@{" PotFlags " link HYPER:Modula-2/Hardware.def.guide/Modul 162};
 @{" PotgoBitSet " link HYPER:Modula-2/Resources.def.guide/Modul 264}=@{" PotFlagSet " link HYPER:Modula-2/Hardware.def.guide/Modul 167};

PROCEDURE @{" AllocPotBits " link HYPER:Autodocs/potgo/AllocPotBits() }(
           potgo{R.A6}:ADDRESS;
           bits{R.D0}:@{" PotgoBitSet " link HYPER:Modula-2/Resources.def.guide/Modul 264}):@{" PotgoBitSet " link HYPER:Modula-2/Resources.def.guide/Modul 264}; CODE -6;

PROCEDURE @{" FreePotBits " link HYPER:Autodocs/potgo/FreePotBits() }(
           potgo{R.A6}:ADDRESS;
           allocated{R.D0}:@{" PotgoBitSet " link HYPER:Modula-2/Resources.def.guide/Modul 264}); CODE -12;

PROCEDURE @{" WritePotgo " link HYPER:Autodocs/potgo/WritePotgo() }(
           potgo{R.A6}:ADDRESS;
           word{R.D0}:@{" PotgoBitSet " link HYPER:Modula-2/Resources.def.guide/Modul 264};
           mask{R.D1}:@{" PotgoBitSet " link HYPER:Modula-2/Resources.def.guide/Modul 264}); CODE -18;

END Resources.noimp

@endnode
