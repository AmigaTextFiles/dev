@database HYPER:Modula-2/KeyMapD
@node Main "HYPER:Modula-2/KeyMapD"

Konstanten

   @{" badChar " link Modul 7}                     @{" buffOvfl " link Modul 10}                    @{" dp2dFacShift " link Modul 27}
   @{" dp2dIndexMask " link Modul 25}               @{" internalErr " link Modul 11}                 @{" maxKeys " link Modul 29}
   @{" noQual " link Modul 17}                      @{" vanilla " link Modul 19}                  

Typ-Deklarationen

   @{" BitTable " link Modul 45}                    @{" BitTablePtr " link Modul 46}                 @{" DeadPrefixByteSet " link Modul 23}
   @{" DeadPrefixBytes " link Modul 21}             @{" Info " link Modul 42}                        @{" InfoPtr " link Modul 43}
   @{" KeyInfo " link Modul 35}                     @{" KeyMap " link Modul 48}                      @{" KeyMapNode " link Modul 60}
   @{" KeyMapPtr " link Modul 58}                   @{" KeyMapResource " link Modul 65}              @{" KeyMapTypeSet " link Modul 15}
   @{" KeyMapTypes " link Modul 13}                 @{" Types " link Modul 31}                       @{" TypesPtr " link Modul 33}


@endnode
@node Modul "HYPER:Modula-2/KeyMapD.def.guide"
DEFINITION MODULE KeyMapD; (*$ Implementation:=FALSE *)
(* 17-Apr-1992/cn *)

FROM SYSTEM IMPORT ADDRESS,LONGSET;

FROM ExecD IMPORT @{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18},@{" List " link HYPER:Modula-2/ExecD.def.guide/Modul 30};

CONST
(* Mögliche Resultatwerte der Funktionen MapANSI und MapRawKey *)
 badChar=0;
 buffOvfl=-1;
 internalErr=-2;

TYPE
 @{" KeyMapTypes " link HYPER:Modula-2/KeyMapD.def.guide/Modul 13}=(shift,alt,control,downup,kmp4,dead,string,nop);
 @{" KeyMapTypeSet " link HYPER:Modula-2/KeyMapD.def.guide/Modul 15}=SET OF @{" KeyMapTypes " link HYPER:Modula-2/KeyMapD.def.guide/Modul 13};

CONST
 noQual=@{" KeyMapTypeSet " link HYPER:Modula-2/KeyMapD.def.guide/Modul 15}{};
 vanilla=@{" KeyMapTypeSet " link HYPER:Modula-2/KeyMapD.def.guide/Modul 15}{shift,alt,control};

TYPE
 @{" DeadPrefixBytes " link HYPER:Modula-2/KeyMapD.def.guide/Modul 21}=(dpbMod,dpb1,dpb2,dpbDead);
 @{" DeadPrefixByteSet " link HYPER:Modula-2/KeyMapD.def.guide/Modul 23}=SET OF @{" DeadPrefixBytes " link HYPER:Modula-2/KeyMapD.def.guide/Modul 21};

CONST
 dp2dIndexMask=0FH;
 dp2dFacShift=4;

 maxKeys=64;

TYPE
 @{" Types " link HYPER:Modula-2/KeyMapD.def.guide/Modul 31}=ARRAY [0..maxKeys-1] OF @{" KeyMapTypeSet " link HYPER:Modula-2/KeyMapD.def.guide/Modul 15};
 @{" TypesPtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 33}=POINTER TO @{" Types " link HYPER:Modula-2/KeyMapD.def.guide/Modul 31};

 @{" KeyInfo " link HYPER:Modula-2/KeyMapD.def.guide/Modul 35}=RECORD
  CASE :INTEGER OF
  |0: ch:ARRAY [0..3] OF CHAR;
  |1: st:ADDRESS
  END
 END;

 @{" Info " link HYPER:Modula-2/KeyMapD.def.guide/Modul 42}=ARRAY [0..maxKeys-1] OF @{" KeyInfo " link HYPER:Modula-2/KeyMapD.def.guide/Modul 35};
 @{" InfoPtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 43}=POINTER TO @{" Info " link HYPER:Modula-2/KeyMapD.def.guide/Modul 42};

 @{" BitTable " link HYPER:Modula-2/KeyMapD.def.guide/Modul 45}=ARRAY [0..maxKeys DIV (8*SIZE(LONGSET))-1] OF LONGSET;
 @{" BitTablePtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 46}=POINTER TO @{" BitTable " link HYPER:Modula-2/KeyMapD.def.guide/Modul 45};

 @{" KeyMap " link HYPER:Modula-2/KeyMapD.def.guide/Modul 48}=RECORD
  loKeyMapTypes:@{" TypesPtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 33};
  loKeyMap:@{" InfoPtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 43};
  loCapsable:@{" BitTablePtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 46};
  loRepeatable:@{" BitTablePtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 46};
  hiKeyMapTypes:@{" TypesPtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 33};
  hiKeyMap:@{" InfoPtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 43};
  hiCapsable:@{" BitTablePtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 46};
  hiRepeatable:@{" BitTablePtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 46};
 END;
 @{" KeyMapPtr " link HYPER:Modula-2/KeyMapD.def.guide/Modul 58}=POINTER TO @{" KeyMap " link HYPER:Modula-2/KeyMapD.def.guide/Modul 48};

 @{" KeyMapNode " link HYPER:Modula-2/KeyMapD.def.guide/Modul 60}=RECORD
  node:@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18};
  keyMap:@{" KeyMap " link HYPER:Modula-2/KeyMapD.def.guide/Modul 48};
 END;

 @{" KeyMapResource " link HYPER:Modula-2/KeyMapD.def.guide/Modul 65}=RECORD
  node:@{" Node " link HYPER:Modula-2/ExecD.def.guide/Modul 18};
  list:@{" List " link HYPER:Modula-2/ExecD.def.guide/Modul 30};
 END;

END KeyMapD.noimp

@endnode
