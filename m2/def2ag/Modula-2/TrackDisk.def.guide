@database HYPER:Modula-2/TrackDisk
@node Main "HYPER:Modula-2/TrackDisk"

Konstanten

   @{" addChangeInt " link Modul 22}                @{" allowNon35 " link Modul 53}                  @{" badDriveType " link Modul 72}
   @{" badHdrSum " link Modul 63}                   @{" badSecHdr " link Modul 66}                   @{" badSecId " link Modul 62}
   @{" badSecPreamble " link Modul 61}              @{" badSecSum " link Modul 64}                   @{" badUnitNum " link Modul 71}
   @{" cdrom " link Modul 100}                       @{" changeNum " link Modul 15}                   @{" changeState " link Modul 16}
   @{" communication " link Modul 104}               @{" directAccess " link Modul 94}                @{" diskChanged " link Modul 68}
   @{" drive35 " link Modul 55}                     @{" drive35rpm150 " link Modul 57}               @{" drive525 " link Modul 56}
   @{" driveInUse " link Modul 73}                  @{" eject " link Modul 25}                       @{" extClear " link Modul 36}
   @{" extCom " link Modul 28}                      @{" extFormat " link Modul 34}                   @{" extMotor " link Modul 32}
   @{" extRawRead " link Modul 37}                  @{" extRawWrite " link Modul 38}                 @{" extRead " link Modul 31}
   @{" extSeek " link Modul 33}                     @{" extUpdate " link Modul 35}                   @{" extWrite " link Modul 30}
   @{" format " link Modul 13}                      @{" getDriveType " link Modul 20}                @{" getGeometry " link Modul 24}
   @{" getNumTracks " link Modul 21}                @{" index " link Modul 49}                       @{" indexSync " link Modul 48}
   @{" labelSize " link Modul 46}                   @{" lastComm " link Modul 26}                    @{" mediumChanger " link Modul 103}
   @{" motor " link Modul 11}                       @{" noMem " link Modul 70}                       @{" noSecHdr " link Modul 60}
   @{" notSpecified " link Modul 59}                @{" numSecs " link Modul 40}                     @{" numUnits " link Modul 41}
   @{" opticalDisk " link Modul 102}                 @{" postReset " link Modul 74}                   @{" printer " link Modul 97}
   @{" processor " link Modul 98}                   @{" protStatus " link Modul 17}                  @{" rawRead " link Modul 18}
   @{" rawWrite " link Modul 19}                    @{" remChangeInt " link Modul 23}                @{" remove " link Modul 14}
   @{" scanner " link Modul 101}                     @{" secShift " link Modul 44}                    @{" sector " link Modul 43}
   @{" seek " link Modul 12}                        @{" seekError " link Modul 69}                   @{" sequentialAccess " link Modul 96}
   @{" tooFewSecs " link Modul 65}                  @{" trackDiskName " link Modul 8}               @{" unknown " link Modul 105}
   @{" word " link Modul 51}                        @{" wordSync " link Modul 50}                    @{" worm " link Modul 99}
   @{" writeProt " link Modul 67}                

Typ-Deklarationen

   @{" DgFlagSet " link Modul 78}                   @{" DgFlags " link Modul 76}                     @{" DriveGeometry " link Modul 80}
   @{" DriveGeometryPtr " link Modul 92}            @{" IOExtTD " link Modul 111}                     @{" IOExtTDPtr " link Modul 116}
   @{" IOTrackDisk " link Modul 135}                 @{" IOTrackDiskPtr " link Modul 136}              @{" PubFlagSet " link Modul 109}
   @{" PubFlags " link Modul 107}                    @{" TDUPublicUnit " link Modul 118}            

@endnode
@node Modul "HYPER:Modula-2/TrackDisk.def.guide"
DEFINITION MODULE TrackDisk; (*$Implementation:=FALSE*)
(* 16-May-1992/cn *)

FROM SYSTEM IMPORT BYTE,LONGSET,SHIFT;

FROM ExecD IMPORT
 clear,read,update,write,nonstd,@{" IOFlagSet " link HYPER:Modula-2/ExecD.def.guide/Modul 431},@{" IOStdReq " link HYPER:Modula-2/ExecD.def.guide/Modul 447},@{" MemReqSet " link HYPER:Modula-2/ExecD.def.guide/Modul 86},@{" Unit " link HYPER:Modula-2/ExecD.def.guide/Modul 423};

CONST
 trackDiskName="trackdisk.device";

 motor=nonstd;
 seek=nonstd+1;
 format=nonstd+2;
 remove=nonstd+3;
 changeNum=nonstd+4;
 changeState=nonstd+5;
 protStatus=nonstd+6;
 rawRead=nonstd+7;
 rawWrite=nonstd+8;
 getDriveType=nonstd+9;
 getNumTracks=nonstd+10;
 addChangeInt=nonstd+11;
 remChangeInt=nonstd+12;
 (*36*)getGeometry=nonstd+13;
 (*36*)eject=nonstd+14;
 lastComm=nonstd+15;

 extCom=8000H;

 extWrite=write+extCom;
 extRead=read+extCom;
 extMotor=motor+extCom;
 extSeek=seek+extCom;
 extFormat=format+extCom;
 extUpdate=update+extCom;
 extClear=clear+extCom;
 extRawRead=rawRead+extCom;
 extRawWrite=rawWrite+extCom;

 numSecs=11;
 numUnits=4;

 sector=512;
 secShift=9;

 labelSize=16;

 indexSync=4;
 index=@{" IOFlagSet " link HYPER:Modula-2/ExecD.def.guide/Modul 431}{4};
 (*36*)wordSync=5;
 (*36*)word=@{" IOFlagSet " link HYPER:Modula-2/ExecD.def.guide/Modul 431}{5};

 allowNon35=LONGSET{0};

 drive35=1;
 drive525=2;
 (*36*)drive35rpm150=3;

 notSpecified=20;
 noSecHdr=21;
 badSecPreamble=22;
 badSecId=23;
 badHdrSum=24;
 badSecSum=25;
 tooFewSecs=26;
 badSecHdr=27;
 writeProt=28;
 diskChanged=29;
 seekError=30;
 noMem=31;
 badUnitNum=32;
 badDriveType=33;
 driveInUse=34;
 postReset=35;

TYPE
 @{" DgFlags " link HYPER:Modula-2/TrackDisk.def.guide/Modul 76}=(removable,dg1,dg2,dg3,dg4,dg5,dg6,dg7);
 @{" DgFlagSet " link HYPER:Modula-2/TrackDisk.def.guide/Modul 78}=SET OF @{" DgFlags " link HYPER:Modula-2/TrackDisk.def.guide/Modul 76};

 @{" DriveGeometry " link HYPER:Modula-2/TrackDisk.def.guide/Modul 80}=RECORD
  sectorSize:LONGCARD;
  totalSectors:LONGCARD;
  cylinders:LONGCARD;
  cylSectors:LONGCARD;
  heads:LONGCARD;
  trackSectors:LONGCARD;
  bufMemType:@{" MemReqSet " link HYPER:Modula-2/ExecD.def.guide/Modul 86};
  deviceType:SHORTCARD;
  flags:@{" DgFlagSet " link HYPER:Modula-2/TrackDisk.def.guide/Modul 78};
  reserved:CARDINAL;
 END;
 @{" DriveGeometryPtr " link HYPER:Modula-2/TrackDisk.def.guide/Modul 92}=POINTER TO @{" DriveGeometry " link HYPER:Modula-2/TrackDisk.def.guide/Modul 80};

CONST
 directAccess=0;
 sequentialAccess=1;
 printer=2;
 processor=3;
 worm=4;
 cdrom=5;
 scanner=6;
 opticalDisk=7;
 mediumChanger=8;
 communication=9;
 unknown=31;

TYPE
 @{" PubFlags " link HYPER:Modula-2/TrackDisk.def.guide/Modul 107}=(noClick,pf1,pf2,pf3,pf4,pf5,pf6,pf7);
 @{" PubFlagSet " link HYPER:Modula-2/TrackDisk.def.guide/Modul 109}=SET OF @{" PubFlags " link HYPER:Modula-2/TrackDisk.def.guide/Modul 107};

 @{" IOExtTD " link HYPER:Modula-2/TrackDisk.def.guide/Modul 111}=RECORD
  req:@{" IOStdReq " link HYPER:Modula-2/ExecD.def.guide/Modul 447};
  count:LONGCARD;
  secLabel:LONGCARD;
 END;
 @{" IOExtTDPtr " link HYPER:Modula-2/TrackDisk.def.guide/Modul 116}=POINTER TO @{" IOExtTD " link HYPER:Modula-2/TrackDisk.def.guide/Modul 111};

 @{" TDUPublicUnit " link HYPER:Modula-2/TrackDisk.def.guide/Modul 118}=RECORD
  unit:@{" Unit " link HYPER:Modula-2/ExecD.def.guide/Modul 423};
  comp01Track:CARDINAL;
  comp10Track:CARDINAL;
  comp11Track:CARDINAL;
  stepDelay:LONGCARD;
  settleDelay:LONGCARD;
  retryCnt:[0..255];
  (*36*)pubFlags:@{" PubFlagSet " link HYPER:Modula-2/TrackDisk.def.guide/Modul 109};
  (*36*)currTrk:CARDINAL;
  (*36*)calibrateDelay:LONGCARD;
  (*36*)counter:LONGCARD;
 END;

(*
 Synonyme zur einheitlichen Namesgebung
*)
 @{" IOTrackDisk " link HYPER:Modula-2/TrackDisk.def.guide/Modul 135}=@{" IOExtTD " link HYPER:Modula-2/TrackDisk.def.guide/Modul 111};
 @{" IOTrackDiskPtr " link HYPER:Modula-2/TrackDisk.def.guide/Modul 136}=@{" IOExtTDPtr " link HYPER:Modula-2/TrackDisk.def.guide/Modul 116};

END TrackDisk.noimp

@endnode
