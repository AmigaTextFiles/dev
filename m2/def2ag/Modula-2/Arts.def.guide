@database HYPER:Modula-2/Arts
@node Main "HYPER:Modula-2/Arts"

Prozeduren

   @{" Assert " link Modul 136}                      @{" BreakPoint " link Modul 137}                  @{" CloseLib " link Modul 133}
   @{" Divs32 " link Modul 129}                      @{" Divu32 " link Modul 126}                      @{" Error " link Modul 138}
   @{" Exit " link Modul 141}                        @{" Muls32 " link Modul 127}                      @{" Mulu32 " link Modul 124}
   @{" OpenLib " link Modul 131}                     @{" Requester " link Modul 139}                   @{" Startup " link Modul 118}
   @{" StkChk " link Modul 121}                      @{" SystemError " link Modul 123}                 @{" Terminate " link Modul 140}


Konstanten

   @{" maxKeys " link Modul 18}                     @{" maxModName " link Modul 17}               

Variablen

   @{" dosCmdBuf " link Modul 70}                   @{" dosCmdLen " link Modul 71}                   @{" errorFrame " link Modul 93}
   @{" kickVersion " link Modul 100}                 @{" oldCurrentDir " link Modul 88}               @{" programName " link Modul 77}
   @{" reserved2 " link Modul 111}                   @{" reserved3 " link Modul 112}                   @{" reserved4 " link Modul 113}
   @{" returnVal " link Modul 55}                   @{" startupMsg " link Modul 63}                  @{" thisTask " link Modul 83}
   @{" wbStarted " link Modul 42}                

Typ-Deklarationen

   @{" ErrorFrame " link Modul 26}                  @{" ErrorType " link Modul 23}                   @{" ModKeys " link Modul 39}
   @{" ModName " link Modul 40}                     @{" ModType " link Modul 38}                     @{" StrPtr " link Modul 20}
   @{" SysErr " link Modul 25}                   

@endnode
@node Modul "HYPER:Modula-2/Arts.def.guide"
(*          ____________________________________
 *      // /                                    \      //
 *     //  \       Amiga Run Time System        /     //
 * \\ //   /        4.02 / 23.02.91 / bp        \ \\ //
 *  \X/    \____________________________________/  \X/
 *)

DEFINITION MODULE Arts;

(*$ LargeVars:=FALSE
    LongAlign:=FALSE
    NameChk:=FALSE
 *)

FROM SYSTEM IMPORT
  ADDRESS,LONGSET,BPTR;

CONST
  maxModName=32; maxKeys=3;

TYPE
  (* Typ für M2Debug: Arts.StrPtr *)
  @{" StrPtr " link HYPER:Modula-2/Arts.def.guide/Modul 20}=POINTER TO ARRAY [0..63] OF CHAR;
  @{" ErrorType " link HYPER:Modula-2/Arts.def.guide/Modul 23}=
   (trap,exception,system,assertion,breakPoint,explicit);
  @{" SysErr " link HYPER:Modula-2/Arts.def.guide/Modul 25}=(halt,illCase,fctReturn,stkOvl,illCall);
  @{" ErrorFrame " link HYPER:Modula-2/Arts.def.guide/Modul 26}=RECORD
    pc: ADDRESS;
    dRegs: ARRAY [0..7] OF LONGINT;
    aRegs: ARRAY [8..15] OF ADDRESS;
    CASE error: @{" ErrorType " link HYPER:Modula-2/Arts.def.guide/Modul 23} OF
    | trap: trapNr: INTEGER;
    | exception: exceptionMask: LONGSET
    | system: sysErr: @{" SysErr " link HYPER:Modula-2/Arts.def.guide/Modul 25}
    | assertion,breakPoint,explicit:
    END;
    header,body: ADDRESS
  END;
  @{" ModType " link HYPER:Modula-2/Arts.def.guide/Modul 38}=(none,mod,lib,noImp);
  @{" ModKeys " link HYPER:Modula-2/Arts.def.guide/Modul 39}=ARRAY [0..maxKeys-1] OF CARDINAL;
  @{" ModName " link HYPER:Modula-2/Arts.def.guide/Modul 40}=ARRAY [0..maxModName-1] OF CHAR;

VAR
 (*
  *   Umgebungsvariablen von M2Amiga.
  *
  *   Einzig returnVal darf verändert,
  *   alle anderen nur gelesen werden!!
  *)

  wbStarted: BOOLEAN;
 (*
  *  TRUE: Start von Workbench, FALSE: Start von CLI
  *)

  returnVal: LONGINT;
 (*
  *  Dies ist der Rückgabewert an das Dos,
  *  kann beliebig gesetzt werden.
  *  Bei Workbench-Start wird returnVal als INTEGER
  *  in das Feld length der WBStartupMsg eingetragen.
  *)

  startupMsg: ADDRESS;
 (*
  *  Zeiger auf die Workbench.WBStartup Message
  *  Nur gültig bei Workbench-Start (wbStarted),
  *  sonst NIL!
  *)

  dosCmdBuf: ADDRESS;
  dosCmdLen: LONGINT;
 (*
  *  Adresse und Länge der CLI-Argumente.
  *  Nur gültig bei CLI-Start (NOT wbStarted)!
  *)

  programName: ADDRESS;
 (*
  * Zeiger auf den Aufrufnamen des Programmes.
  * Der String endet mit 0C.
  *)

  thisTask:  ADDRESS;
 (*
  *  Zeiger auf den eigenen Task/Process
  *)

  oldCurrentDir:BPTR;
 (*
  *  CurrentDir bei Programmstart
  *)

  errorFrame: @{" ErrorFrame " link HYPER:Modula-2/Arts.def.guide/Modul 26};
 (*
  * errorFrame wird bei einem Laufzeitfehler mit den
  * aktuellen Werten gefüllt.
  *)


  kickVersion: INTEGER;
 (*
  * Die Version der exec.library (32,33,36,...)
  * Hiermit kann die Version von Kickstart,Workbench
  * festgestellt werden.
  *)

 (*
  * Für Erweiterungen der ENTWICKLER!
  * Verhindert eine ständige Neudefinition von Arts.
  *)
  reserved2: ADDRESS;
  reserved3: ADDRESS;
  reserved4: ADDRESS;

(* Diese Prozedur ist IMMER die erste jedes Programms,
 * NIEMALS aufrufen!!!!
 *)
PROCEDURE Startup(cl{0}:LONGINT; cb{8}:ADDRESS): LONGINT;

(* Compiler Unterstützung *)
PROCEDURE StkChk(need{0}: LONGINT);
 (* SystemError(halt) = HALT *)
PROCEDURE SystemError(err{0}: @{" SysErr " link HYPER:Modula-2/Arts.def.guide/Modul 25});
PROCEDURE Mulu32(x{0},y{1}: LONGINT): LONGINT;
 (* D0=REM, D1=QUO *)
PROCEDURE Divu32(x{0},y{1}: LONGINT): LONGINT;
PROCEDURE Muls32(x{0},y{1}: LONGINT): LONGINT;
 (* D0=REM, D1=QUO *)
PROCEDURE Divs32(x{0},y{1}: LONGINT): LONGINT;
(* Nur für die "automatischen" Libraries! *)
PROCEDURE OpenLib(version{0}:LONGINT;
                  name{9}:ADDRESS):ADDRESS;
PROCEDURE CloseLib(base{9}:ADDRESS);

(* Laufzeitunterstützung *)
PROCEDURE Assert(condition: BOOLEAN; msg: ADDRESS);
PROCEDURE BreakPoint(msg: ADDRESS);
PROCEDURE Error(header,body: ADDRESS);
PROCEDURE Requester(header,body,pos,neg:ADDRESS):BOOLEAN;
PROCEDURE Terminate;
PROCEDURE @{" Exit " link HYPER:Autodocs/dos/Exit() }(retVal{0}:LONGINT);

END Arts.

@endnode
