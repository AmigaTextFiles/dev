@database Timer
@node Main "Timer"

Procedures

   @{" AddTime " link Modul 45}                     @{" CmpTime " link Modul 51}                     @{" GetSysTime " link Modul 57}
   @{" ReadEClock " link Modul 55}                  @{" SubTime " link Modul 48}                  

Constants

   @{" addRequest " link Modul 15}                  @{" eClock " link Modul 21}                      @{" getSysTime " link Modul 16}
   @{" microHz " link Modul 19}                     @{" setSysTime " link Modul 17}                  @{" timerName " link Modul 10}
   @{" vBlank " link Modul 20}                      @{" waitEClock " link Modul 23}                  @{" waitUntil " link Modul 22}


Type-Declarations

   @{" EClockVal " link Modul 32}                   @{" EClockValPtr " link Modul 36}                @{" TimeRequest " link Modul 39}
   @{" TimeRequestPtr " link Modul 43}              @{" TimeVal " link Modul 25}                     @{" TimeValPtr " link Modul 30}


@endnode
@node Modul "am2:ModuleRefs/Timer.def"
(*$ Implementation- *)
DEFINITION MODULE Timer;

(* (C) Copyright 1994 Marcel Timmermans. All rights reserved. *)

FROM SYSTEM IMPORT
 ADDRESS;
FROM ExecD IMPORT
 nonstd,IORequest;

CONST
 timerName="timer.device";

(* IO_COMMAND to use for adding a timer *)

 addRequest=nonstd+0;
 getSysTime=nonstd+1;
 setSysTime=nonstd+2;

 microHz=0;
 vBlank=1;
 eClock=2;
 waitUntil=3;
 waitEClock=4;

TYPE
 TimeVal=RECORD
  secs:LONGCARD;
  micro:LONGCARD;
 END;
 TimeValPtr=POINTER TO TimeVal;

 EClockVal=RECORD
  hi:LONGCARD;
  lo:LONGCARD;
 END;
 EClockValPtr=POINTER TO EClockVal;


 TimeRequest=RECORD
  node:IORequest;
  time:TimeVal
 END;
 TimeRequestPtr=POINTER TO TimeRequest;

PROCEDURE AddTime(timer{14}:ADDRESS;
                  dest{8},source{9}:TimeValPtr); CODE -42;

PROCEDURE SubTime(timer{14}:ADDRESS; 
                  dest{8},source{9}:TimeValPtr); CODE -48;

PROCEDURE CmpTime(timer{14}:ADDRESS;
                  tv1{8},
                  tv2{9}:TimeValPtr):INTEGER; CODE -54;

PROCEDURE ReadEClock(timer{14}:ADDRESS; dest{8}:EClockValPtr):LONGCARD; CODE -60;

PROCEDURE GetSysTime(timer{14}:ADDRESS;dest{8}:TimeValPtr); CODE -66;

 
END Timer.

@endnode
