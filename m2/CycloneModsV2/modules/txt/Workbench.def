(*$ Implementation- *)
DEFINITION MODULE Workbench;

(* (C) Copyright 1993 Marcel Timmermans. All rights reserved. *)

FROM SYSTEM IMPORT ADDRESS,LONGSET;

FROM DosD       IMPORT FileLockPtr;
FROM IntuitionD IMPORT Gadget,GadgetFlags,GadgetFlagSet,NewWindow;
FROM ExecD      IMPORT List,Message,MsgPortPtr;
FROM GraphicsD  IMPORT ViewModeSet;

CONST
(* workbench now is a library.	this is it's name *)
 workbenchName="workbench.library";


 diskMagic      = 0E310H;   (* a magic number, not easily impersonated *)
 diskVersion    = 1;        (* our current version number *)
 diskRevision   = 1;        (* our current revision number *)             

(* I only use the lower 8 bits of Gadget.UserData for the revision # *)
 diskRevisionMask = 255; 

(* if an icon does not really live anywhere, set its current position
 * to here *)
 noIconPosition = MIN(LONGINT);

TYPE
 BPTR=BPOINTER TO LONGINT;

 OldDrawerData=RECORD   (* pre V36 definition *)
  newWindow:NewWindow;  (* Args to open window *) 
  currentX:LONGINT;     (* current x coordinate of origin *)
  currentY:LONGINT;     (* current y coordinate of origin *)
 END;
 OldDrawerDataPtr=POINTER TO OldDrawerData;

CONST
(* the amount of DrawerData actually written to disk *)
 oldDrawerDataFileSize=SIZE(OldDrawerData);

TYPE
 DrawerData=RECORD
  newWindow:NewWindow;  (* args to open window *)
  currentX:LONGINT;     (* current x coordinate of origin *)
  currentY:LONGINT;     (* current y coordinate of origin *)
  flags:LONGSET;        (* flags for drawer *)
  viewModes:ViewModeSet;(* view mode for drawer *)           
 END;
 DrawerDataPtr=POINTER TO DrawerData;

CONST
(* the amount of DrawerData actually written to disk *)
 drawerDataFileSize=SIZE(DrawerData);

TYPE
 WBObjectType=(
  wb0,disk,drawer,tool,project,garbage,device,kick
 );

CONST        
  pstd          = 1;      (* a "standard Potion" message *)
  toolExit      = 2;      (* exit message from our tools *)
  diskChange    = 3;      (* dos telling us of a disk change *)
  timer         = 4;      (* we got a timer tick *)
  closeDown     = 5;      (* <unimplemented> *)
  ioProc        = 6;      (* <unimplemented> *)
  appWindow     = 7;      (* msg from an app window *)
  appIcon       = 8;      (* msg from an app icon *)
  appMenuItem   = 9;      (* msg from an app menuitem *)
  copyExit      = 10;     (* exit msg from copy process *)
  iConPut       = 11;     (* msg from PutDiskObject in icon.library *)

(* workbench does different complement modes for its gadgets.
 * It supports separate images, complement mode, and backfill mode.
 * The first two are identical to intuitions GADGIMAGE and GADGHCOMP.
 * backfill is similar to GADGHCOMP, but the region outside of the
 * image (which normally would be color three when complemented)
 * is flood-filled to color zero.
 *)
 gadgetBackFill = GadgetFlagSet{gadgHBox};

TYPE

 DiskObjectPtr=POINTER TO DiskObject;
 FreeListPtr=POINTER TO FreeList;
 WBArgPtr=POINTER TO WBArg;
 WBStartupPtr=POINTER TO WBStartup;
 WBArg=RECORD
  lock:FileLockPtr;
  name:ADDRESS
 END;
 WBArgumentsPtr=POINTER TO ARRAY [0..255] OF WBArg;
 WBStartup=RECORD
  message:Message;
  process:MsgPortPtr;
  segment:BPTR;
  numArgs:LONGINT;
  toolWindow:ADDRESS;
  argList:WBArgumentsPtr;
 END;
 FreeList=RECORD
  numFree:INTEGER;
  memList:List
 END;
 DiskObject=RECORD
  magic:CARDINAL;       (* a magic number at the start of the file *)
  version:CARDINAL;     (* a version number, so we can change it *)
  gadget:Gadget;        (* a copy of in core gadget *)                
  type:WBObjectType;
  defaultTool:ADDRESS;
  toolTypes:ADDRESS;
  currentX:LONGINT;
  currentY:LONGINT;
  drawerData:DrawerDataPtr;
  toolWindow:ADDRESS;
  stackSize:LONGINT
 END;

CONST
(* If you find am_Version >= AM_VERSION, you know this structure has
 * at least the fields defined in this version of the include file
 *)
amVersion=1;

TYPE
 AppMessage=RECORD
  message:Message;                  (* standard message structure *)
  type:CARDINAL;                    (* message type *)
  userData:LONGINT;                 (* application specific *)
  id:LONGCARD;                      (* application definable ID *)
  numArgs:LONGINT;                  (* # of elements in arglist *)
  argList:WBArgumentsPtr;           (* the arguements themselves *)
  version:CARDINAL;                 (* will be AM_VERSION *)
  class:CARDINAL;                   (* message class *)
  mouseX:INTEGER;                   (* mouse x position of event *)
  mouseY:INTEGER;                   (* mouse y position of event *)
  seconds:LONGCARD;                 (* current system clock time *)
  micros:LONGCARD;                  (* current system clock time *)
  reserved:ARRAY[0..7] OF LONGINT;  (* avoid recompilation *)        
 END;
 AppMessagePtr=POINTER TO AppMessage;

 AppWindowPtr;

END Workbench.
